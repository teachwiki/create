!function(){"use strict";function e(){function e(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],r=!0,a=!1,n=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(i.push(o.value),!t||i.length!==t);r=!0);}catch(e){a=!0,n=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw n}}return i}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return r(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var a={system:["Abadi MT Condensed","Agency FB","Aharoni","Aldhabi","Algerian","American Typewriter","Andale Mono","Apple Casual","Apple Chancery","Arial","Arial Black","Arial Narrow","Athelas","Avenir","Avenir Next","Avenir Next Condensed","Bangla","Baskerville","Batang","Bell MT","Bodoni","Book Antigua","Brush Script MT","Calibri","Californian FB","Calisto MT","Cambria","Century Schoolbook","Chalkboard","Chalkduster","Charter","Chiller","Colonna MT","Comic Sans MS","Copperplate","Courier New","Didot","Diwan","Estrangelo Edessa","Euphemia","Farah","Franklin Gothic","Futura","Garamond","Gautami","Geeza","Georgia","Gill Sans","Gill Sans MT","Goudy Old Style","Harrington","Helvetica","Helvetica Neue","Hoefler","Hoefler Text","Impact","Iowan Old Style","Jokerman","Juice ITC","Kohinoor Bangla","Latha","Lucida Sans","Magneto","Marion","Marker Felt","Menlo","Modern No. 20","Noteworthy","Optima","Palatino","Papyrus","PingFang HK","Rockwell","Savoye Let","Snell RoundHand","Superclarendon","Tahoma","Telugu","Thonburi","Times","Times New Roman","Trebuchet MS","Verdana","Vivaldi","Wide Latin"],befunky:[{name:"Amble",file:"amble"},{name:"Bear and Loupe",file:"bearandloupe"},{name:"Bebas Neue",file:"bebasneue"},{name:"Bellota",file:"bellota"},{name:"Big Snow",file:"bigsnow"},{name:"Capture It",file:"captureit"},{name:"Carbon Type",file:"carbontype"},{name:"Carrington",file:"carrington"},{name:"Caviar dreams",file:"caviardreams"},{name:"Chomsky",file:"chomsky"},{name:"ChunkFive",file:"chunkfive"},{name:"Costura Light",file:"costuralight"},{name:"Crass Roots",file:"crassroots"},{name:"Deutsch Gothic",file:"deutschgothic"},{name:"Digna’s Handwriting",file:"dignashand"},{name:"Eczar SemiBold",file:"eczarsemibold"},{name:"Edo",file:"edo"},{name:"Eutemia I",file:"eutemia"},{name:"Free Universal",file:"freeuniversal"},{name:"Frente H1",file:"frenteh1"},{name:"Gothic Ultra",file:"gothicultra"},{name:"Gputeks",file:"gputeks"},{name:"Handserif",file:"handserif"},{name:"Harting",file:"harting"},{name:"Helsinki",file:"helsinki"},{name:"Henry Morgan Hand",file:"henrymorganhand"},{name:"Holitter Gothic",file:"holitter"},{name:"Hominis",file:"hominis"},{name:"HVD Comic Serif Pro",file:"hvdcomic"},{name:"Inkcalig",file:"inkcalig"},{name:"Itsadzoke",file:"itsadzoke"},{name:"Kawoszeh",file:"kawoszeh"},{name:"Kingthings Trypewriter",file:"kingthings"},{name:"Komika Axis",file:"komikaaxis"},{name:"Langdon",file:"langdon"},{name:"League Gothic",file:"leaguegothic"},{name:"League Spartan Bold",file:"leaguespartanbold"},{name:"Let’s Trace",file:"letstrace"},{name:"Mathlete Bulky",file:"mathletebulky"},{name:"Miama",file:"miama"},{name:"Norwester",file:"norwester"},{name:"Odstemplik",file:"odstemplik"},{name:"Okolaks",file:"okolaks"},{name:"Ostrich Sans",file:"ostrichsans"},{name:"Palitoon",file:"palitoon"},{name:"Peace Sans",file:"peacesans"},{name:"Pirou Regular",file:"pirouregular"},{name:"Pix Antiqua",file:"pixantiqua"},{name:"Playlist Script",file:"playlistscript"},{name:"Qwigley Regular",file:"qwigleyregular"},{name:"Raustila Regular",file:"raustilaregular"},{name:"Selima",file:"selima"},{name:"Silkscreen",file:"silkscreen"},{name:"Temporarium",file:"temporarium"},{name:"The Art of Illuminating",file:"artofillum"},{name:"Vavont",file:"vavont"},{name:"Veggieburger",file:"veggieburger"}],google:["Abel","Abhaya Libre:400,500,600,700,800","Abril Fatface","Alegreya:400,500,700,800,900","Alegreya Sans:100,300,400,500,700,800,900","Alfa Slab One","Allerta Stencil","Amaranth:400,700","Amatic SC:400,700","Amita:400,700","Annie Use Your Telescope","Anonymous Pro:400,700","Anton","Arapey","Architects Daughter","Archivo Black","Arima Madurai:100,200,300,400,500,700,800,900","Arizonia","Arvo:400,700","Arya:400,700","Averia Serif Libre:300,400,700","Bad Script","Bahianita","Berkshire Swash","Beth Ellen","Bigelow Rules","BioRhyme Expanded:200,300,400,700,800","Boogaloo","Bowlby One","Bungee","Bungee Shade","Butcherman","Butterfly Kids","Cabin:400,500,600,700","Cairo:200,300,400,600,700,900","Candal","Caveat:400,700","Chango","Charmonman:400,700","Chewy","Chilanka","Cinzel:400,700,900","Cinzel Decorative:400,700,900","Coiny","Comfortaa:300,400,500,600,700","Concert One","Cookie","Cormorant Unicase:300,400,500,600,700","Creepster","Croissant One","Cutive Mono","Dancing Script:400,500,600,700","Darker Grotesque:300,400,500,600,700,800,900","Didact Gothic","Domine:400,700","Dosis:200,300,400,500,600,700,800","Economica:400,700","Elsie Swash Caps:400,900","Emblema One","Englebert","Euphoria Script","Exo:100,200,300,400,500,600,700,800,900","Exo 2:100,200,300,400,500,600,700,800,900","Fahkwang:200,300,400,500,600,700","Fjalla One","Fredericka the Great","Fredoka One","Fugaz One","Galada","Gochi Hand","Graduate","Grand Hotel","Gravitas One","Great Vibes","Gruppo","Handlee","Heebo:100,300,400,500,700,800,900","Hind:300,400,500,600,700","Homemade Apple","Indie Flower","Josefin Sans:100,300,400,600,700","Josefin Slab:100,300,400,600,700","Julius Sans One","Jura:300,400,500,600,700","Just Another Hand","Just Me Again Down Here","Kalam:300,400,700","Kameron:400,700","Karla:400,700","Khand:300,400,500,600,700","Krona One","Kumar One Outline","La Belle Aurore","Lato:100,300,400,700,900","Leckerli One","Lexend Exa","Libre Baskerville:400,700","Life Savers:400,700,800","Lily Script One","Limelight","Lobster","Lobster Two:400,700","Londrina Outline","Londrina Shadow","Londrina Sketch","Londrina Solid:100,300,400,900","Lora:400,700","Luckiest Guy","Maiden Orange","Marvel:400,700","Medula One","Megrim","Merriweather:300,400,700,900","Metamorphous","Modak","Monoton","Montserrat:100,200,300,400,500,600,700,800,900","Montserrat Alternates:100,200,300,400,500,600,700,800,900","Mountains of Christmas:400,700","Mr Bedfort","Mrs Sheppards","Muli:200,300,400,500,600,700,800,900","Niconne","Nixie One","Nothing You Could Do","Nova Cut","Numans","Nunito:200,300,400,600,700,800,900","Old Standard TT:400,700","Oleo Script:400,700","Open Sans:300,400,600,700,800","Open Sans Condensed:300,700","Oranienbaum","Orbitron:400,500,600,700,800,900","Oswald:200,300,400,500,600,700","Overlock:400,700,900","Oxygen:300,400,700","Pacifico","Parisienne","Passion One:400,700,900","Pathway Gothic One","Pavanam","Paytone One","Permanent Marker","Petit Formal Script","Plaster","Playball","Playfair Display:400,700,900","Poller One","Poppins:100,200,300,400,500,600,700,800,900","Prata","Quattrocento:400,700","Questrial","Quicksand:300,400,500,600,700","Racing Sans One","Raleway:100,200,300,400,500,600,700,800,900","Rammetto One","Ravi Prakash","Red Hat Display:400,500,700,900","Righteous","Roboto:100,300,400,500,700,900","Roboto Mono:100,300,400,500,700","Roboto Slab:100,200,300,400,500,600,700,800,900","Rock Salt","Rokkitt:100,200,300,400,500,600,700,800,900","Rubik Mono One","Sacramento","Sanchez","Sancreek","Satisfy","Shadows Into Light","Shrikhand","Sigmar One","Six Caps","Slabo 27px","Slackey","Smokum","Sofia","Source Code Pro:200,300,400,500,600,700,900","Spicy Rice","Stint Ultra Expanded","Syncopate:400,700","Tangerine:400,700","Teko:300,400,500,600,700","Tenali Ramakrishna","Tenor Sans","Ubuntu:300,400,500,700","Ultra","Underdog","Unica One","Vampiro One","Varela","Varela Round","Vast Shadow","Vidaloka","Vollkorn:400,600,700,900","Wire One","Work Sans:100,200,300,400,500,600,700,800,900","Yantramanav:100,300,400,500,700,900","Yatra One","Yellowtail"],fontNameAliases:{"ChunkFive Roman":"ChunkFive",Sigmar:"Sigmar One","Bowlby One SC":"Bowlby One","Londrina Sketche":"Londrina Sketch","Mr Bedford":"Mr Bedfort"},copyrightedFontReplacements:{"Bookman Old Style":{name:"Quattrocento"},"Claire Hand":{name:"Chilanka",isAllCaps:!0,sizeScale:.8,lineHeightScale:1.25},Forque:{name:"Anton",isAllCaps:!0,sizeScale:.83,lineHeightScale:1.25},"Good Foot":{name:"Caveat"},Idolwild:{name:"Life Savers",isBold:!0,sizeScale:.88,charSpacingIncrement:100,lineHeightScale:1.18},"My Underwood":{name:"Kingthings Trypewriter",sizeScale:.96},"Myriad Pro":{name:"Yantramanav"},Teen:{name:"Questrial",isBold:!0},"Teen Light":{name:"Questrial"}},uploadedFontTypes:[{extension:"otf",cssFormat:"opentype",mimeType:"application/font-sfnt"},{extension:"ttf",cssFormat:"truetype",mimeType:"application/font-sfnt"},{extension:"woff",cssFormat:"woff",mimeType:"application/font-woff"}],weightToStyleMap:{100:"Thin",200:"Extra Light",300:"Light",400:"Regular",500:"Medium",600:"Semi Bold",700:"Bold",800:"Extra Bold",900:"Black"},weightToStyleTranslationMap:{100:"font_thickness_thin",200:"font_thickness_extra_light",300:"font_thickness_light",400:"font_thickness_regular",500:"font_thickness_medium",600:"font_thickness_semi_bold",700:"font_thickness_bold",800:"font_thickness_extra_bold",900:"font_thickness_black"},getDefaultWeight:function(e){if(!e.length)return 400;if(e.includes(400))return 400;if(e.includes(500))return 500;var t=e.filter(e=>e<400);return t.length?Math.max(...t):Math.min(...e)},isValidWeight:function(e){return"number"==typeof e&&e%100==0&&e>=100&&e<=900},unquoteFont:n,quoteFont:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=(e=n(e)).replace(/\\/g,"");var i=/^[a-z][a-z0-9_]+$/i,r=/^(inherit|serif|sans-serif|monospace|fantasy|cursive|initial|default)$/i;return t||(e=>e.split(" ").some(e=>!e||!i.test(e)||r.test(e)))(e)?'"'.concat(e,'"'):e}};function n(e){return e.replace(/"/g,"").trim().replace(/(^'+)|('+$)/g,"").trim()}var o=a.google,s=a.fontNameAliases,l=a.copyrightedFontReplacements,h=a.uploadedFontTypes,c=a.weightToStyleMap,u=a.weightToStyleTranslationMap,d=a.getDefaultWeight,m=a.isValidWeight,p=a.unquoteFont,g=a.quoteFont;class f{constructor(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=r.isUserDefined,n=void 0!==a&&a,o=r.fileName,s=r.files,l=r.bgYOffset;this._name=this.validate("name",e),this._type=this.validate("type",t),"befunky"===t&&(this._fileName=this.validate("fileName",o)),this._isUserDefined=this.validate("isUserDefined",n),this.weights=i,s&&(this.files=s),"system"===t&&(this.isAvailable=null),n||"google"!==t&&"befunky"!==t||(this._bgYOffset=this.validate("bgYOffset",l))}validate(e,t){var i=this,r=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";throw console.log("FontVO:",i),console.log("Value:",t),new Error('Invalid FontVO property "'.concat(e,'". ').concat(r))},a={name:()=>("string"!=typeof t&&r("Not string"),(t=p(t))||r("empty"),t),type:()=>{return["google","befunky","system","uploaded"].includes(t)||r(),t},fileName:()=>(t&&"string"==typeof t||r(),t),isUserDefined:()=>("boolean"!=typeof t&&r(),t&&"befunky"===this.type&&r(),t),isAvailable:()=>("boolean"!=typeof t&&null!==t&&r(),"system"!==this.type&&r(),t),weights:()=>(Array.isArray(t)&&t.every(m)||r(),t.unique().sort()),files:()=>{return Array.isArray(t)&&t.every(e=>{var t=e.weight,i=e.fileName;return m(t)&&i&&"string"==typeof i})||r(),"uploaded"!==this.type&&r(),t},replacedDefaultFont:()=>(t instanceof f&&(!t.isUserDefined||"system"===t.type)||r(),t),bgYOffset:()=>("number"!=typeof t&&r(),!this.isUserDefined&&["befunky","google"].includes(this.type)||r(),t)};return a[e]||r("Property not supported"),a[e]()}get name(){return this._name}get type(){return this._type}get fileName(){return this._fileName}get isUserDefined(){return this._isUserDefined}get bgYOffset(){return this._bgYOffset}set weights(e){this._weights=this.validate("weights",e)}get weights(){return this._weights}set files(e){this._files=this.validate("files",e)}get files(){return this._files}set isAvailable(e){this._isAvailable=this.validate("isAvailable",e)}get isAvailable(){return this._isAvailable}set replacedDefaultFont(e){this._replacedDefaultFont=this.validate("replacedDefaultFont",e)}get replacedDefaultFont(){return this._replacedDefaultFont}}function v(){}window.BFN={},BFN.CSS={leftMenuBarWidth:56,topMenuBarHeight:56,imageManagerThumbSize:102,historyMenuThumbSize:20,historyMenuPreviewSize:240,secondaryMenuWidth:262,tertiaryMenuWidth:262,footerHeight:44,floatingElementBaseZIndex:12,appViewportBGZIndex:2e3,appViewportZIndex:2001,modalZIndex:1e3,dialogZIndex:9999999999},BFN.UI={},BFN.filters={},BFN.effects={},BFN.AppBackgroundColor=1974308,BFN.baseFrameRate=BeFunky.isEdgeHTML?24:40,BFN.maxZipSizeMB=500,BFN.minImageSize=32,BFN.maxImageSize=window.BfnmaxImageSize||4096,BFN.maxImageSizeForArtsy=BFN.maxImageSize,BFN.maxImageUploadSizeFreeUser=2500,BFN.maxImageSizeLayer=Math.min(window.BfnmaxImageSize,3264),BFN.minCollageSize=128,BFN.defaultCollageSize=3264,BFN.openedSections=[],BFN.imageTypes=["computer","sample","befunky_photo","befunky_layer","befunky_project","pixabay","unsplash","pexels","facebook","google_photos","patterns","graphic","text_mask","alpha_mask","collage_photo","mask_image","image","designer","template_svg","designer_template"],BFN._updatingTextTransformItem=null,Object.defineProperty(BFN,"updatingTextTransformItem",{set(e){UIToggler.showLoadScreenWhileTrue(BFN.checkUpdatingTextTransformItem,200),BFN._updatingTextTransformItem=e},get:()=>BFN._updatingTextTransformItem}),BFN.checkUpdatingTextTransformItem=function(){return BFN._updatingTextTransformItem||BFN.updatingTextQueue.length||BFN.accurateBoundsQueue.length},BFN.nextUid=0,BFN.uid=function(){return++BFN.nextUid},BFN.renderTexturesPool=null,BFN.renderTextureResolution=1,BFN.renderTextureResolutionLarge=1,BFN.updatingShapeQueue=[],BFN.updatingTextQueue=[],BFN.accurateBoundsQueue=[],BFN.floatingElements=[],BFN.addFloatingElement=(e=>{BFN.floatingElements.includes(e)||(BFN.floatingElements.push(e),BFN.updateFloatingElementDisplay())}),BFN.focusFloatingElement=(e=>{if(BFN.floatingElements.includes(e)){var t=BFN.floatingElements.indexOf(e);BFN.floatingElements.splice(t,1),BFN.floatingElements.push(e),BFN.updateFloatingElementDisplay()}}),BFN.updateFloatingElementDisplayImmediately=(()=>{BFN.floatingElements.forEach((e,t)=>{if(e.hasClass("active")||"alternateContainer"===e.id){var i=BFN.CSS.floatingElementBaseZIndex+t;BFN.FabricManager&&BFN.FabricManager.currentTextTransformItem&&e.zIndexOverFabric&&(i=BFN.CSS.appViewportZIndex+t+1),BeFunky.isModalOpen()&&e.zIndexOverModal&&(i=BFN.CSS.modalZIndex+t+1),e===UIToggler.alternateContainer&&BFN.FontManager.fontMenuComponent&&BFN.FontManager.fontMenuComponent.setStyles({zIndex:i+1}),e.setStyles({zIndex:i})}else e.setStyles({zIndex:-1})})}),BFN.updateFloatingElementDisplay=BeFunky.debounce(BFN.updateFloatingElementDisplayImmediately,"ric"),BFN.tabRecentlyReopened=!1,BFN.hasEnteredEditor=!1,BFN.hasEnteredCollage=!1,BFN.hasEnteredDesigner=!1,BFN.hasFullyOpenedEditor=!1,BFN.toolViewstates={},BFN._applyCancelMenu=null,Object.defineProperty(BFN,"applyCancelMenu",{get:()=>(BFN._applyCancelMenu||(BFN._applyCancelMenu=document.getElementById("editor_apply_cancel_menu")),BFN._applyCancelMenu)}),BFN.sectionMemoryLimitMB=navigator.deviceMemory>=8?1500:1e3,BFN._smoothPicture=window.webglTextureSize&&window.webglTextureSize>8192?"always":"auto",Object.defineProperty(BFN,"smoothPicture",{set(e){["auto","always","never"].includes(e)&&(BFN._smoothPicture=e,BFN.smoothPictureDisabled=BFN.smoothPictureDisabled)},get:()=>BFN._smoothPicture}),BFN._smoothPictureDisabled=!1,Object.defineProperty(BFN,"smoothPictureDisabled",{set(e){BFN._smoothPictureDisabled="auto"==BFN._smoothPicture?e:"always"!=BFN._smoothPicture,BFN.MainUI.requestRender()},get:()=>BFN._smoothPictureDisabled}),BFN.retrievePresetThumbHelperGraphics=(e=>{if(BFN.XMLGraphicLoader)switch(e){case"texture":BFN.XMLGraphicLoader.texturesThumbCalled||(BFN.XMLGraphicLoader.texturesThumbCalled=!0,BFN.XMLGraphicLoader.xmlPath="".concat(BFN.remoteImagesURL,"app/texturemodel/textures_thumbs.xml"));break;case"effect":if(!BFN.XMLGraphicLoader.effectsThumbCalled){BFN.XMLGraphicLoader.effectsThumbCalled=!0;var t="effect_thumbs".concat(BFN.assetsDataVersions.effects_thumbs_data,".json");BFN.XMLGraphicLoader.jsonPath="".concat(BFN.assetsURL,"datas/").concat(t)}}}),BFN.PhotoEditorCanvasModelViewStates={VIEWING_CANVAS:"VIEWING_CANVAS",VIEWING_TOUCH_UP:"VIEWING_TOUCH_UP",VIEWING_EFFECT:"VIEWING_EFFECT",VIEWING_ARTSY:"VIEWING_ARTSY",VIEWING_BORDER:"VIEWING_BORDER",VIEWING_DROP_SHADOW:"VIEWING_DROP_SHADOW",VIEWING_FRAME:"VIEWING_FRAME",VIEWING_TEXTURE:"VIEWING_TEXTURE",VIEWING_OVERLAY:"VIEWING_OVERLAY",VIEWING_LENS_FLARE:"VIEWING_LENS_FLARE",VIEWING_PAINT_BRUSH:"VIEWING_PAINT_BRUSH",VIEWING_CLONE:"VIEWING_CLONE",VIEWING_BLEMISH_FIX:"VIEWING_BLEMISH_FIX",VIEWING_BACKGROUND:"VIEWING_BACKGROUND",VIEWING_CUTOUT:"VIEWING_CUTOUT",VIEWING_CROP:"VIEWING_CROP",VIEWING_ROTATE:"VIEWING_ROTATE",VIEWING_RESIZE:"VIEWING_RESIZE",VIEWING_SLIMMING:"VIEWING_SLIMMING",VIEWING_RESHAPE:"VIEWING_RESHAPE",VIEWING_TILT:"VIEWING_TILT",VIEWING_FOCUS:"VIEWING_FOCUS",VIEWING_VIGNETTE:"VIEWING_VIGNETTE"},BFN.CONST={BLEND_MODES:{NORMAL:0,ADD:1,SUBTRACT:2,MULTIPLY:3,DARKEN:4,COLOR_BURN:5,LINEAR_BURN:6,LIGHTEN:7,SCREEN:8,COLOR_DODGE:9,LINEAR_DODGE:10,OVERLAY:11,SOFT_LIGHT:12,HARD_LIGHT:13,VIVID_LIGHT:14,LINEAR_LIGHT:15,PIN_LIGHT:16,DIFFERENCE:17,EXCLUSION:18,ERASE:19,ALPHA:20},PICTURE_RENDERER_FILTERS:{BLACK_WHITE:0,COLOR:1},ANALOG_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10},BWFX_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_12:12,PRESET_13:13,PRESET_14:14,PRESET_15:14},WARMFX_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11},CINEMATIC_PRESETS:{FILM_GRAIN:1,COLOR_GRADING:2,ANAMORPHIC:3,LENS_DISTORTION:4,WARPED_BLUR:5,CHROMATIC_ABERRATION:6},MULTIMEDIA_PRESETS:{SCAN_LINES:1,TELEVISION:2,HALFTONE_DUO:3},GLITCH_ART_PRESETS:{CORRUPTED:1,DISTORTED:2,SEGMENTED:3,FRAGMENTED:4,DIGITIZED:5},BLACK_WHITE_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9},CHROMATIC_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10},CHARCOAL_PRESETS:{PRESET_1:1,PRESET_2:2},CYANOTYPE_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6},VIEWFINDER_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_12:12},SUMMER_PRESETS:{PRESET_1:1,PRESET_2:2},UNITED_COLORS_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6},INSTANT_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_10:10,PRESET_11:11,PRESET_13:13},VINTAGE_COLORS_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9},HOLGA_ART_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5},LINE_ARTOPIA_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4},PINHOLE_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5},STENCILER_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11},GRUNGE_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_13:13,PRESET_15:15,PRESET_16:16,PRESET_17:17},SUNBURST_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6},OLD_PHOTO_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_12:12,PRESET_13:13,PRESET_14:14,PRESET_15:15,PRESET_16:16,PRESET_17:17,PRESET_18:18,PRESET_19:19,PRESET_20:20},WINTER_PRESETS:{PRESET_1:1,PRESET_2:2},TILT_SHIFT_PRESETS:{PRESET_1:1,PRESET_2:2},PATRIOTIC_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7},POPART_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_13:13,PRESET_14:14,PRESET_15:15,PRESET_16:16,PRESET_17:17,PRESET_18:18,PRESET_19:19,PRESET_20:20},MOTION_COLOR_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5},LOMO_ART_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_6:6,PRESET_7:7},TOUCH_UP_PRESETS:{wrinkles:1,bronzer:2,blush:3,flashspot:4,mascara:6,eye_color:7,eye_brighten:8,eyebrow_pencil:9,fix_redeye:10,lipstick:11,teeth_whiten:12,haircolor:13,perfectskin:14},PALETTE_MAPS:{retroCol1:[[[0,28],[25,60],[44,83],[65,116],[85,135],[126,184],[148,198],[174,212],[190,223],[214,233],[234,244],[255,255]],[[0,0],[25,30],[41,53],[60,75],[88,113],[104,134],[134,173],[153,187],[169,196],[196,211],[216,219],[235,235],[255,240]],[[0,17],[23,38],[65,76],[93,104],[111,121],[121,131],[150,153],[165,171],[212,196],[232,203],[255,211]]],retroCol2:[[[0,0],[23,13],[44,28],[63,48],[83,71],[106,102],[128,131],[149,160],[170,185],[187,209],[214,231],[235,246],[255,255]],[[0,0],[23,13],[44,28],[63,48],[83,71],[106,102],[128,131],[149,160],[170,185],[187,209],[214,231],[235,246],[255,255]],[[0,31],[22,47],[41,62],[64,79],[82,95],[105,111],[128,129],[150,145],[170,161],[191,180],[212,196],[234,212],[255,224]]],retroCol3:[[[0,20],[24,46],[52,80],[61,90],[87,121],[110,143],[129,162],[152,184],[166,193],[196,209],[213,225],[232,232],[255,242]],[[0,0],[19,15],[41,43],[62,72],[88,106],[105,129],[123,152],[148,178],[172,197],[189,213],[212,226],[234,240],[255,255]],[[0,19],[22,41],[42,61],[64,86],[82,104],[104,124],[125,144],[151,164],[173,183],[215,209],[232,221],[255,232]]],retroCol4:[[[0,25],[22,56],[31,72],[78,149],[87,157],[101,175],[110,182],[129,194],[150,201],[172,202],[189,210],[214,223],[234,236],[255,255]],[[0,25],[31,55],[54,96],[65,118],[86,146],[127,185],[152,196],[169,203],[191,218],[212,230],[234,240],[255,255]],[[0,35],[23,54],[41,75],[65,107],[84,126],[108,156],[120,164],[143,182],[175,190],[198,201],[215,214],[234,225],[255,232]]],retroCol5:[[[0,0],[25,17],[44,34],[62,56],[86,95],[108,122],[130,154],[144,170],[165,193],[176,202],[211,229],[236,243],[234,236],[255,255]],[[0,0],[21,9],[46,24],[65,42],[85,65],[103,91],[128,127],[153,160],[172,182],[193,201],[213,222],[235,241],[255,255]],[[0,0],[21,9],[44,17],[66,32],[87,54],[104,75],[126,107],[150,143],[171,166],[192,189],[217,211],[238,225],[255,243]]],retroCol6:[[[0,139],[32,170],[51,173],[65,183],[76,186],[106,197],[126,208],[146,216],[168,223],[188,233],[213,240],[234,248],[255,255]],[[0,0],[24,61],[46,103],[60,124],[78,144],[102,166],[127,179],[146,193],[173,210],[195,226],[220,238],[234,244],[255,255]],[[0,58],[18,59],[42,60],[60,76],[81,105],[105,133],[126,151],[150,164],[170,179],[186,188],[207,195],[234,209],[255,211]]],retro6mask:[[[0,0],[108,137],[255,255]],[[0,0],[131,121],[255,255]],[[0,0],[33,50],[133,116],[255,255]]],retroCol7:[[[0,75],[22,81],[43,82],[63,113],[75,128],[96,151],[119,168],[147,201],[164,220],[191,222],[209,219],[235,225],[255,231]],[[0,54],[16,59],[30,55],[43,58],[77,87],[89,104],[111,124],[130,144],[155,169],[176,190],[188,202],[216,221],[237,240],[255,244]],[[0,65],[23,61],[40,65],[67,84],[90,118],[108,134],[134,167],[153,188],[175,209],[195,213],[211,210],[234,214],[255,208]]],retroCol8:[[[0,26],[15,43],[32,64],[65,114],[83,149],[109,178],[127,192],[147,201],[170,208],[195,218],[215,229],[234,242],[255,251]],[[0,0],[26,32],[49,72],[72,123],[89,147],[115,188],[148,205],[160,210],[177,222],[189,224],[215,235],[234,246],[255,254]],[[1,29],[30,72],[57,124],[74,147],[87,162],[108,175],[130,184],[152,189],[172,195],[187,203],[215,216],[239,237],[255,247]]],MegaContrast1:[[[0,0],[255,255]],[[0,0],[255,255]],[[0,0],[255,255]]],MegaContrast2:[[[0,0],[75,29],[178,204],[255,255]],[[0,25],[255,230]],[[0,0],[49,76],[255,255]]],crossProcess1:[[[0,0],[60,30],[210,255],[255,255]],[[0,0],[47,38],[101,111],[187,206],[255,255]],[[0,32],[255,216]]],crossProcess2:[[[0,0],[66,79],[195,182],[255,255]],[[0,0],[77,73],[199,177],[255,255]],[[0,0],[77,63],[186,200],[255,255]]],darkerMap:[[[0,0],[132,134],[203,173],[255,255]],[[0,0],[55,43],[171,180],[255,255]],[[0,0],[63,76],[159,138],[193,171],[255,255]]],contrast:[[[0,0],[78,51],[181,191],[255,255]],[[0,0],[78,51],[181,191],[255,255]],[[0,0],[78,51],[181,191],[255,255]]],contrastHigh:[[[0,0],[93,63],[168,195],[255,255]],[[0,0],[93,63],[168,195],[255,255]],[[0,0],[93,63],[168,195],[255,255]]],blackenCurve:[[[0,0],[201,85],[255,255]],[[0,0],[201,85],[255,255]],[[0,0],[201,85],[255,255]]]}},BFN.CONST.FONT_LIST=function(){return[...a.google.map((e,i)=>{var r=t(e.split(":"),2),a=r[0],n=r[1];return new f(a,"google",function(e){return e.split(",").map(e=>parseInt(e))}(void 0===n?"400":n),{bgYOffset:36*i})}),...a.system.map(e=>new f(e,"system",[])),...a.befunky.map((e,t)=>{var i=e.name,r=e.file;return new f(i,"befunky",[400],{fileName:r,bgYOffset:36*t})})].sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1)}(),BFN.assetsURL=BeFunky.Params.globalAssetsPath,BFN.imagesURL=BeFunky.Params.globalImagesPath,BFN.remoteImagesURL=BeFunky.Params.IS_LC?BeFunky.Params.remoteImagesPath:BeFunky.Params.globalImagesPath,BFN.jsURL="".concat(BFN.assetsURL,"js/"),BFN.originalTextureURl="".concat(BFN.remoteImagesURL,"app/textures/sml/"),BFN.thumbTextureURl="".concat(BFN.remoteImagesURL,"app/textures/texture_78/"),BFN.folderNames={goodies:"6JAN2020/",overlays:"19DEC17/",patterns:"02FEB18/"},BFN.goodiesUrl="".concat(BFN.remoteImagesURL,"app/graphics/goodies/").concat(BFN.folderNames.goodies),BFN.overlaysUrl="".concat(BFN.remoteImagesURL,"app/graphics/overlays/").concat(BFN.folderNames.overlays),BFN.patternsUrl="".concat(BFN.remoteImagesURL,"app/graphics/patterns/").concat(BFN.folderNames.patterns),BFN.artsyThumbURL="".concat(BFN.remoteImagesURL,"app/graphics/artsy/preview_v3/"),BFN.designerElementsUrl="".concat(BFN.remoteImagesURL,"app/graphics/designer_elements/svg/"),BFN.designerSourceTemplateURL="".concat(BeFunky.Params.remoteAssetsPath,"designer_templates_v2/"),BFN.designerTemplateFlashURL="".concat(BeFunky.Params.remoteAssetsPath,"designer_source_templates_flash/"),BFN.designerTemplatePreviewsUrl="".concat(BFN.remoteImagesURL,"app/designer_templates_v2/previews/"),BFN.assetsDataVersions={overlays_thumb:"",overlays_data:"",patterns_thumb:"",patterns_data:"",effects_thumbs_data:"_v1"},BFN.goodiesAssetsFolder={original:"org/",thumb:"t/"},BFN._appRect=null,BFN._appRectDiv=null,BFN._appRectMinSize=null,window.addEventListener("resize",()=>{BFN._appRect=null}),Object.defineProperty(BFN,"appRect",{get(){var e=this._appRect;if(e&&!e.usingFallback)return e;if(this._appRectDiv=this._appRectDiv||BFN.appContainer,!this._appRectDiv)return i();var t=this._appRectDiv.getBoundingClientRect();return t&&t.width?r(t):i();function i(){if(e&&e.usingFallback)return e;var t=window.innerWidth,i=window.innerHeight;return r({usingFallback:!0,x:0,y:0,top:0,left:0,width:t,right:t,height:i,bottom:i})}function r(e){var t=BFN._appRectMinSize,i=e.x,r=e.y,a=e.top,n=e.left,o=e.bottom,s=e.right,l=e.width,h=e.height;return s=n+(l=Math.max(t,l)),o=a+(h=Math.max(t,h)),BFN._appRect={x:i,y:r,top:a,left:n,bottom:o,right:s,width:l,height:h},e}}}),Object.defineProperty(BFN,"appViewportRect",{get(){var e=BFN.appRect,t=e.x,i=e.y,r=e.top,a=e.left,n=e.bottom,o=e.right,s=e.width,l=e.height,h=BFN.CSS.topMenuBarHeight;r+=h,i+=h,l-=h;var c=BFN.CSS.footerHeight;l-=c,n-=c;var u,d,m=BFN.getAppViewportLeftOffset();return u={x:t+=m,y:i,top:r,left:a+=m,bottom:n,right:o,width:s-=m,height:l},d=BFN._appRectMinSize,u.width=Math.max(d,u.width),u.height=Math.max(d,u.height),u.right=u.left+u.width,u.bottom=u.top+u.height,u}}),BFN.getAppViewportLeftOffset=(()=>BFN.CSS.leftMenuBarWidth),BFN.XHelpers={},BFN.XHelpers.emptyContainer=new PIXI.Container,PIXI.RenderTexture.prototype.clear=function(){BFN.Stage.render(BFN.XHelpers.emptyContainer,this,!0),this.undetermineTransparency()},BFN.XHelpers.clearRect=null,PIXI.Texture.prototype.clearRect=PIXI.RenderTexture.prototype.clearRect=function(e,t,i,r){var a=BFN.Stage.gl;if(a){a.disable(a.BLEND),BFN.XHelpers.clearRect||(BFN.XHelpers.clearRect=new PIXI.Graphics,BFN.XHelpers.clearRect.beginFill(0,0),BFN.XHelpers.clearRect.drawRect(0,0,100,100),BFN.XHelpers.clearRect.endFill());var n=BFN.XHelpers.clearRect;n.x=e,n.y=t,n.width=i,n.height=r,BFN.Stage.render(n,this,!1),a.enable(a.BLEND),this.undetermineTransparency()}},BFN.XHelpers.fillRect=new PIXI.Graphics,PIXI.RenderTexture.prototype.fillRect=function(e,t,i,r,a,n){var o=BFN.Stage.gl;if(o){o.disable(o.BLEND);var s=BFN.XHelpers.fillRect;s.clear(),s.beginFill(a,n),s.drawRect(0,0,i,r),s.endFill(),s.x=e,s.y=t,BFN.Stage.render(s,this,!1),o.enable(o.BLEND),this.undetermineTransparency()}},PIXI.RenderTexture.prototype.fillColor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=BFN.Stage.gl;i.disable(i.BLEND);var r=BFN.XHelpers.fillRect;r.clear(),r.beginFill(e,t),r.drawRect(0,0,this.width,this.height),r.endFill(),r.x=0,r.y=0,BFN.Stage.render(r,this,!1),i.enable(i.BLEND),this.undetermineTransparency()},PIXI.RenderTexture.prototype.fillColorOverlap=function(e,t,i,r,a,n){e=e||0,t=t||1,i=i||0,r=r||0,a=a||this.width,n=n||this.height;var o=BFN.XHelpers.fillRect;o.clear(),o.beginFill(e,t),o.drawRect(0,0,a,n),o.endFill(),o.x=i,o.y=r,BFN.Stage.render(o,this,!1),this.undetermineTransparency()},PIXI.RenderTexture.prototype.determineTransparency=PIXI.Texture.prototype.determineTransparency=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:48;if(!this.baseTexture)return!1;if(this.baseTexture.hasOwnProperty("isTransparent")&&!e)return this.baseTexture.isTransparent;var i=BFN.Util.getThumbTexture(this,Math.min(t,this.width,this.height),!1,!1);return this.isTransparent=BFN.Util.isTransparent(i),i.destroyGC(!0),this.isTransparent},PIXI.RenderTexture.prototype.undetermineTransparency=PIXI.Texture.prototype.undetermineTransparency=function(){this.baseTexture&&this.baseTexture.hasOwnProperty("isTransparent")&&delete this.baseTexture.isTransparent},Object.defineProperty(PIXI.Texture.prototype,"isTransparent",{set:function(e){this.baseTexture&&(this.baseTexture.isTransparent=!!e)},get:function(){return this.baseTexture?!!this.baseTexture.isTransparent:void 0}}),Object.defineProperty(PIXI.RenderTexture.prototype,"isTransparent",{set:function(e){this.baseTexture&&(this.baseTexture.isTransparent=!!e)},get:function(){return this.baseTexture?this.baseTexture.isTransparent:void 0}}),BFN.XHelpers.renderSprite=new PIXI.Sprite,BFN.XHelpers.renderSprite.pluginName="smooth_picture",BFN.XHelpers.renderContainer=new PIXI.Container,BFN.XHelpers.renderContainer.addChild(BFN.XHelpers.renderSprite),PIXI.RenderTexture.prototype.copyPixels=function(e,t,i,r,a,n){null==t&&(t={x:0,y:0}),null==i&&(i=!0),null==r&&(r=1),null==a&&(a=1);var o="object"==typeof a&&a.hasOwnProperty("x")?a.x:a,s="object"==typeof a&&a.hasOwnProperty("y")?a.y:a;null==n&&(n=16777215);var l=BFN.XHelpers.renderSprite,h=BFN.XHelpers.renderContainer;l.texture=e,l.x=t.x,l.y=t.y,l.alpha=r,l.scale.x=l.currentScale=o,l.scale.y=l.currentScaleY=s,l.tint=n,BFN.Stage.render(h,this,i),l.texture=null,this.undetermineTransparency()},PIXI.RenderTexture.prototype.invert=function(){var e=new PIXI.Container,t=new PIXI.Graphics;t.beginFill(16777215),t.drawRect(0,0,this.width,this.height),e.addChild(t);var i=new PIXI.Sprite(this);i.pluginName="blend_picture",i.blendMode=BFN.CONST.BLEND_MODES.DIFFERENCE,e.addChild(i);var r=PIXI.RenderTexture.create(this.width,this.height);BFN.Stage.render(i,r),BFN.Stage.render(e,r),this.copyPixels(r),e.removeChild(i),i.destroy(!1),e.removeChild(t),t.clear()},PIXI.RenderTexture.prototype.convertLumaToAlpha=function(){var e=new PIXI.Container,t=new PIXI.Graphics;t.beginFill(16777215),t.drawRect(0,0,this.width,this.height),t.endFill(),e.addChild(t);var i=new PIXI.Sprite(this);e.addChild(i),t.mask=i;var r=PIXI.RenderTexture.create(this.width,this.height);BFN.Stage.render(i,r),BFN.Stage.render(e,r),this.copyPixels(r),e.removeChild(i),i.destroy(!1),e.removeChild(t),t.clear()},PIXI.RenderTexture.prototype.convertAlphaToLuma=function(){var e=new PIXI.Container,t=new PIXI.Graphics;t.beginFill(0),t.drawRect(0,0,this.width,this.height),t.endFill(),e.addChild(t);var i=new PIXI.Sprite(this);i.pluginName="blend_picture",i.fillColor=16777215,i.intensity=1,e.addChild(i);var r=PIXI.RenderTexture.create(this.width,this.height);BFN.Stage.render(i,r),BFN.Stage.render(e,r),this.copyPixels(r),e.removeChild(i),i.destroy(!1),e.removeChild(t),t.clear()},PIXI.Texture.prototype.renderClone=function(){var e=PIXI.RenderTexture.create(this.width,this.height);return e.copyPixels(this),this.baseTexture&&this.baseTexture.hasOwnProperty("isTransparent")&&(e.isTransparent=this.isTransparent),e},PIXI.RenderTexture.prototype.save=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"saved_render_texture",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];void 0!==window.saveTexture&&window.saveTexture(this,e,t,i,r)},PIXI.RenderTexture.prototype.destroyGC=function(e){if(this.baseTexture&&this.baseTexture.maskTexture){try{this.baseTexture.maskTexture.destroyGC(!0)}catch(e){}delete this.baseTexture.maskTexture}this.destroy(e)},PIXI.Texture.prototype.save=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"saved_texture",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;void 0!==window.saveTexture&&window.saveTexture(this,e,t,i)},PIXI.Texture.prototype.destroyGC=function(e){if(this.baseTexture&&this.baseTexture.maskTexture){try{this.baseTexture.maskTexture.destroyGC(!0)}catch(e){}delete this.baseTexture.maskTexture}this.destroy(e)},PIXI.Texture.prototype.setScaleMode=function(e){switch(BFN.Stage.bindTexture(this,null,!0),e){case PIXI.SCALE_MODES.NEAREST:this.baseTexture._glTextures[0].enableNearestScaling();break;case PIXI.SCALE_MODES.LINEAR:this.baseTexture._glTextures[0].enableLinearScaling()}BFN.Stage.unbindTexture(this)},PIXI.Container.prototype.getMousePosition=function(){return BFN.Stage.plugins.interaction.mouse.getLocalPosition(this)},PIXI.Container.prototype.getPointerPosition=function(e){return e.data.getLocalPosition(this)},PIXI.Graphics.prototype.getMousePosition=function(){return BFN.Stage.plugins.interaction.mouse.getLocalPosition(this)},PIXI.Graphics.prototype.getPointerPosition=function(e){var t=null;return e?t=e.data.getLocalPosition(this):BFN.MainUI.pointerEvent&&(t=BFN.MainUI.pointerEvent.data.getLocalPosition(this)),t||new PIXI.Point},PIXI.WebGLRenderer.prototype.uploadTextureData=function(e,t){BFN.PIXITicker.started||BFN.PIXITicker.start(),BFN.PIXITicker.keepRunning=!0,this.plugins.prepare.upload(e,()=>{BFN.PIXITicker.keepRunning=!1,BFN.PIXITicker.started&&!BFN.PIXITicker.stopPending&&BFN.PIXITicker.stop(),t&&t()})},fabric.TextboxPad=fabric.util.createClass(fabric.Textbox,{_renderBackground(e){if(this.hasOwnProperty("backgroundOverrideColor")||(this.backgroundOverrideColor=""),this.hasOwnProperty("backgroundOverridePadding")||(this.backgroundOverridePadding=0),this.backgroundColor||this.backgroundOverrideColor){var t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundOverrideColor?this.backgroundOverrideColor:this.backgroundColor;var i=this.backgroundOverrideColor?this.backgroundOverridePadding:this.padding;e.fillRect(-t.x/2-i,-t.y/2-i,t.x+2*i,t.y+2*i),this._removeShadow(e)}}}),fabric.util.object.extend(fabric.TextboxPad.prototype,{initDimensions:function(){if(!this.__skipDimension){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}),this.prevScaledHeight=this.prevScaledHeight||0;var e=this.height*this.scaleY;Math.abs(e-this.prevScaledHeight)>.1&&(this.fire("height:changed",{target:this,before:this.prevScaledHeight||0,after:e}),this.prevScaledHeight=e)}}}),fabric.enableWordBreaks=!0,fabric.wordBreakMethods={wordBreaksEnabled:!0,updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.preventWrapTextSelectionModify=!0,this.initDimensions(),this.preventWrapTextSelectionModify=!1,this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=this.hiddenTextarea.prevSelectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=this.hiddenTextarea.prevSelectionEnd=e.selectionEnd}this.updateTextareaPosition()}},fromStringToGraphemeSelection:function(e,t,i){if(this.wordBreakIndices)for(var r=0,a=0;a<this.wordBreakIndices.length;a++){var n=this.wordBreakIndices[a]+r;e>=n&&(e=Math.min(this.textLength,e+1)),t>=n&&(t=Math.min(this.textLength,t+1)),r+=1}return{selectionStart:e,selectionEnd:t}},fromGraphemeToStringSelection:function(e,t,i){if(this.wordBreakIndices)for(var r=0;r<this.wordBreakIndices.length;r++){var a=this.wordBreakIndices[r];e>a&&(e=Math.max(0,e-1)),t>a&&(t=Math.max(0,t-1))}return{selectionStart:e,selectionEnd:t}},trackStyles:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"trackStyles";console.log(e);var t={};for(var i in this.styles){t[i]={};var r=this.styles[i],a=0;for(var n in r)t[i][n]=Object.assign(this.styles[i][n]),a++;console.log(i,":",a)}console.log(t),console.log("")},getSelectionStartFromPointer:function(e){var t=this.getLocalPointer(e),i=0,r=0,a=0,n=0,o=0;this.flipX&&(t.x=this.width*this.scaleX-t.x),this.flipY&&(t.y=this.height*this.scaleY-t.y);for(var s=0,l=this._textLines.length;s<l&&a<=t.y;s++)a+=this.getHeightOfLine(s)*this.scaleY,o=s,s>0&&(n+=this._textLines[s-1].length+1);r=this._getLineLeftOffset(o)*this.scaleX;for(var h=0,c=this._textLines[o].length;h<c&&(i=r,(r+=this.__charBounds[o][h].kernedWidth*this.scaleX)<=t.x);h++)n++;return this._getNewSelectionStartFromOffset(t,i,r,n,c)},_getNewSelectionStartFromOffset:function(e,t,i,r,a){var n=e.x-t,o=i-e.x,s=r+(o>n||o<0?0:1);return s>(this.textLength||this._text.length)&&(s=this.textLength||this._text.length),s},onKeyDown:function(e){if(this.isEditing&&!this.inCompositionMode){if(e.keyCode in this.keysMap){var t=["moveCursorLeft","moveCursorRight"],i=["moveCursorUp","moveCursorDown"],r=this.keysMap[e.keyCode];this.flipX&&t.includes(r)&&(r=t[(t.indexOf(r)+1)%t.length]),this.flipY&&i.includes(r)&&(r=i[(i.indexOf(r)+1)%i.length]),this[r](e)}else{if(!(e.keyCode in this.ctrlKeysMapDown&&(e.ctrlKey||e.metaKey)))return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),this.isEditing){this.preventWrapTextSelectionModify=!0;var i,r,a=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,n=this._text.length,o=a.length,s=o-n;if(this.preventWrapTextSelectionModify=!1,""===this.hiddenTextarea.value)return this.inputErase=!0,this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var l={selectionStart:this.hiddenTextarea.selectionStart,selectionEnd:this.hiddenTextarea.selectionEnd},h={selectionStart:this.hiddenTextarea.prevSelectionStart,selectionEnd:this.hiddenTextarea.prevSelectionEnd};this.hiddenTextarea.prevSelectionStart=this.hiddenTextarea.selectionStart,this.hiddenTextarea.prevSelectionEnd=this.hiddenTextarea.selectionEnd;var c=h.selectionStart>l.selectionStart,u=h.selectionStart===l.selectionStart&&l.selectionStart===l.selectionEnd;if(this.inputErase=c||u,h.selectionStart!==h.selectionEnd?(i=this._text.slice(h.selectionStart,h.selectionEnd),s+=h.selectionEnd-h.selectionStart):o<n&&(i=c?this._text.slice(h.selectionEnd+s,h.selectionEnd):this._text.slice(h.selectionStart,h.selectionStart-s)),r=a.slice(l.selectionEnd-s,l.selectionEnd),i&&i.length&&(h.selectionStart!==h.selectionEnd?this.removeStyleFromTo(h.selectionStart,h.selectionEnd):c?this.removeStyleFromTo(h.selectionEnd-i.length,h.selectionEnd):this.removeStyleFromTo(h.selectionEnd,h.selectionEnd+i.length)),r.length)if(t&&r.join("")===fabric.copiedText)this.insertNewStyleBlock(r,h.selectionStart,fabric.copiedTextStyle);else if(t)for(var d=this.hiddenTextarea.value.split("\n"),m=0;m<d.length;m++){this.styles.hasOwnProperty(m)||(this.styles[m]={});for(var p=0;p<=d[m].length;p++)this.styles[m].hasOwnProperty(p)||(this.styles[m][p]={})}else this.insertNewStyleBlock(r,h.selectionStart);this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},_wrapLine:function(e,t,i,r){i-=r=r||0,t||(this.dynamicMinWidthWord=0,this.dynamicMinWidthWordChar=0,this.textLength=this.text.length,this.wordWrapped=!1,this.wordBreaks=0,this.wordBreakIndices?this.wordBreakIndices.splice(0):this.wordBreakIndices=[],this.isEditing&&this.hiddenTextarea&&!this.preventWrapTextSelectionModify&&(this.selectionStart=this.hiddenTextarea.selectionStart,this.selectionEnd=this.hiddenTextarea.selectionEnd));var a=this.text.split(this._reNewline),n=0;if(t<a.length)for(var o=0;o<=t;o++){var s=a[o];o<t?n+=s.length+1:n+s.length}var l,h,c,u,d,m,p,g,f=[],v=[],y=0,x=!0,_=0,I=0,T=0,b=0,S=0,C=this._getWidthOfCharSpacing(),B=e.split(this._reSpaceAndTab);for(o=0;o<B.length;o++){if(h=B[o],c=fabric.util.string.graphemeSplit(h),u=this._measureWord(c,t,S),(d=this.wordBreaksEnabled&&u-C>i)||(S+=c.length),(y+=u+b-C)>=i&&!x?(f.push(v),v=[],y=u,x=!0):y+=C,!x&&v.push(" "),b=this._measureWord([" "],t,S),d)for(this.wordWrapped=!0,y=0,null,l=0;l<c.length;l++)m=c[l],(y+=(p=this._measureWord([m],t,S,null))-(l===c.length-1?C:0))>=i&&!x?(f.push(v),v=[],y=p,x=!0,g=n+S,this.wordBreakIndices.push(g),this.isEditing&&!this.preventWrapTextSelectionModify&&(g+this.wordBreaks+_<=this.selectionStart&&this.selectionStart++,g+this.wordBreaks+_<this.selectionEnd&&this.selectionEnd++),_++):y+=l===c.length-1?C:0,v.push(m),S++,x=!1,p>T&&(T=p);else v=v.concat(c);S++,x=!1,u>I&&(I=u)}return o&&f.push(v),this.textLength+=_,this.wordBreaks+=_,I+r>this.dynamicMinWidthWord&&(this.dynamicMinWidthWord=I-C+r),T+r>this.dynamicMinWidthWordChar&&(this.dynamicMinWidthWordChar=T-C+r),this.dynamicMinWidth=this.wordWrapped?this.dynamicMinWidthWordChar:this.dynamicMinWidthWord,f},_measureWord:function(e,t,i,r){var a=0;i=i||0;for(var n=0,o=e.length;n<o;n++){a+=this._getGraphemeBox(e[n],t,n+i,r,!0).kernedWidth,r=e[n]}return a},getSelectedText:function(){if(this.hiddenTextarea)return this.hiddenTextarea.value.substring(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd)},_extendStyles:function(e,t){var i=this.get2DCursorLocation(e,!0);this.styles[i.lineIndex]||(this.styles[i.lineIndex]={}),this.styles[i.lineIndex][i.charIndex]?this.isEditing&&(e=this.modifySelectionIndex(e,-1),i=this.get2DCursorLocation(e,!0)):this.styles[i.lineIndex][i.charIndex]={},this.styles[i.lineIndex][i.charIndex]&&fabric.util.object.extend(this.styles[i.lineIndex][i.charIndex],t)},getSelectionStyles:function(e,t,i){void 0===e&&(e=this.selectionStart||0),void 0===t&&(t=this.selectionEnd||e),(e=this.modifySelectionIndex(e,-1))===(t=this.modifySelectionIndex(t,-1))&&(e>0?e--:t<this.text.length&&t++),e===t-1&&this.text.length&&t<=this.text.length&&this._reNewline.test(this.text.substring(e,t))&&t<this.text.length&&!this._reNewline.test(this.text.substring(e+1,t+1))&&(e++,t++);for(var r=[],a=e;a<t;a++)r.push(this.getStyleAtPosition(a,i,!0));return r},getStyleAtPosition:function(e,t,i){var r=this.get2DCursorLocation(e,i);this.gettingStyleAtPosition=!0;var a=t?this.getCompleteStyleDeclaration(r.lineIndex,r.charIndex):this._getStyleDeclaration(r.lineIndex,r.charIndex);return this.gettingStyleAtPosition=!1,a||{}},_getStyleDeclaration:function(e,t){if(this._styleMap&&!this.isWrapping&&!this.gettingStyleAtPosition){var i=this._styleMap[e];if(!i)return null;e=i.line,t=i.offset+t}var r=this.styles&&this.styles[e];return r?r[t]:null},modifySelectionIndex:function(e,t){if(this.wordBreakIndices){for(var i=0;i<this.wordBreakIndices.length;i++)e+=this.wordBreakIndices[i]<e?t:0;e=Math.max(0,Math.min(this.textLength,e))}return e},searchWordBoundary:function(e,t){for(var i=this._reSpace.test(this.text.charAt(e))?e-1:e,r=this.text.charAt(i),a=/[ \n\.,;!\?\-]/;!a.test(r)&&i>0&&i<this.text.length;)if(i+=t,r=this.text.charAt(i),-1===t&&a.test(r)){i-=t,r=this.text.charAt(i);break}return a.test(r)&&"\n"!==r&&(i+=1===t?0:1),i},selectWord:function(e){e=this.modifySelectionIndex(e||this.selectionStart,-1),this.selectionStart=this.modifySelectionIndex(this.searchWordBoundary(e,-1),1),this.selectionEnd=this.modifySelectionIndex(this.searchWordBoundary(e,1),1),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){return e=this.modifySelectionIndex(e||this.selectionStart,-1),this.selectionStart=this.modifySelectionIndex(this.findLineBoundaryLeft(e),1),this.selectionEnd=this.modifySelectionIndex(this.findLineBoundaryRight(e),1),this._fireSelectionChanged(),this._updateTextarea(),this}},fabric.enableWordBreaks&&fabric.util.object.extend(fabric.TextboxPad.prototype,fabric.wordBreakMethods),BFN.getCanvasCoordinates=function(e,t,i){e="number"==typeof e&&e>=0?e:0,t="number"==typeof t&&t>=0?t:0;var r=(i=i||BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas)).scale.x,a=(e-BFN.CSS.leftMenuBarWidth-BFN.MainUI.x-i.x)/r,n=(t-BFN.CSS.topMenuBarHeight-BFN.MainUI.y-i.y)/r;return new PIXI.Point(a,n)},BFN.getImageType=function(e){if("string"==typeof e){var t=BFN.imageTypes.find(t=>e.startsWith("".concat(t,"_")));if(t)return t;BeFunky.throwError('MenuImageVO id "'.concat(e,'" does not have a valid type'))}else BeFunky.throwError("MenuImageVO id must be a string: ".concat(e," (").concat(BeFunky.getType(e),")"))},BFN.toTitleCase=function(e){var t=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return e.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,(e,i,r)=>i>0&&i+e.length!==r.length&&e.search(t)>-1&&":"!==r.charAt(i-2)&&("-"!==r.charAt(i+e.length)||"-"===r.charAt(i-1))&&r.charAt(i-1).search(/[^\s-]/)<0?e.toLowerCase():e.substr(1).search(/[A-Z]|\../)>-1?e:e.charAt(0).toUpperCase()+e.substr(1))},BFN.getDateParts=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t="".concat(e.getMonth()+1),i="".concat(e.getDate()),r="".concat(e.getFullYear());return t.length<2&&(t="0".concat(t)),i.length<2&&(i="0".concat(i)),[r,t,i,...e.toTimeString().split(" ")[0].split(":")]},BFN.getExtension=(e=>{if(!e.includes("."))return"";var t;try{if("jpg_large"===(t=e.split(".").pop().toLowerCase())&&(t="jpg"),!/^[a-z0-9]{1,10}$/.test(t))throw"invalid_extension"}catch(i){BeFunky.throwError("Unable to get file extension",e,i),t=""}return t}),Object.assign(v.prototype,{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.dispatcher=this;for(var i=t.slice(0),r=0,a=i.length;r<a;r++)i[r].call(this,e)}}}}),BFN.EventDispatcher=v,BFN.FilterHelper={getNextPowerOfTwo:function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},hex2rgb:function(e,t){-1==e.indexOf("0x")&&(e="0x"+e);var i=[];return i[0]=(e>>16&255)/255,i[1]=(e>>8&255)/255,i[2]=(255&e)/255,1==t&&(e.length>8?i[3]=(e>>24&255)/255:i[3]=1),i},hex2rgbForPlugin:(e,t)=>((t=t||[])[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t),hex32torgba:function(e){var t=[];return t[3]=((4278190080&e)>>>24)/255,t[0]=((16711680&e)>>>16)/255,t[1]=((65280&e)>>>8)/255,t[2]=(255&e)/255,t},hex2rgbFactor:function(e){var t=[];return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t},normalize:function(e,t,i){return(e-t)/(i-t)},calculateFilterClamp:function(e,t,i){var r=e.size.width-t.destinationFrame.width,a=e.size.height-t.destinationFrame.height,n=0==r?1:1-r/e.size.width,o=0==a?1:1-a/e.size.height;if(null!=i){var s=i.width!=t.defaultFrame.width?Math.abs(t.defaultFrame.width-i.width):i.height!=t.defaultFrame.height?Math.abs(t.defaultFrame.height-i.height):null;null!=s&&(n+=s/e.size.width,o+=s/e.size.height)}return{x:1/n,y:1/o}},createLinearGradient:function(e,t,i,r,a,n,o,s,l,h,c){if(null==e&&(e=["rgba(255, 0 ,0, 1.0)","rgba(255, 0 ,255, 1.0)","rgba(0, 0 ,255, 1.0)","rgba(0, 255 ,255, 1.0)","rgba(0, 255 ,0, 1.0)","rgba(255, 255 ,0, 1.0)","rgba(255, 0 ,0, 1.0)"]),null==t&&(t=[0,38,85,128,170,214,255],h=!0),t=BFN.FilterHelper.copy(t),1==h)for(var u=0;u<t.length;u++)t[u]=t[u]/255;null==i&&(i=0),null==r&&(r=0),null==a&&(a=256),null==n&&(n=3);var d=document.createElement("canvas");d.width=a<<1,d.height=n<<1,d.ctx=d.getContext("2d"),d.ctx.save();var m=null;m=l==-Math.PI/2?d.ctx.createLinearGradient(0,n,0,0):l==-Math.PI/4?d.ctx.createLinearGradient(0,n,a,0):d.ctx.createLinearGradient(0,0,a,0);for(var p=0,g=e.length;p<g;p++)m.addColorStop(t[p],e[p]);d.ctx.fillStyle=m,d.ctx.fillRect(i,r,a,n);var f=null;if(1==c){var v=new PIXI.Sprite(PIXI.Texture.fromCanvas(d,BFN.PIXIScaleMode));f=PIXI.RenderTexture.create(o,s),BFN.Stage.render(v,f)}else f=PIXI.Texture.fromCanvas(d,BFN.PIXIScaleMode);return d.ctx.clearRect(0,0,a,n),d.ctx.restore(),f},GetCurvesTexture:function(e,t,i){var r=function(e){for(var t,i,r,a=new BFN.FilterHelper.SplineInterpolator(e),n=[],o=0;o<256;o++)n.push((t=0,i=Math.floor(256*a.interpolate(o/255)),r=255,Math.max(t,Math.min(i,r))));return n},a=null!=e?BFN.FilterHelper.copy(e):null,n=null!=t?BFN.FilterHelper.copy(t):null,o=null!=i?BFN.FilterHelper.copy(i):null;if(null!=a)for(var s=0;s<a.length;s++)a[s][0]/=255,a[s][1]/=255;if(null!=n)for(s=0;s<n.length;s++)n[s][0]/=255,n[s][1]/=255;if(null!=o)for(s=0;s<o.length;s++)o[s][0]/=255,o[s][1]/=255;a=r(a),1==arguments.length?n=o=a:(n=r(n),o=r(o));for(var l=[],h=0;h<256;h++)l.splice(l.length,0,a[h],n[h],o[h],255);var c=document.createElement("canvas");c.width=256,c.height=1;var u=new PIXI.BaseTexture(c);BFN.Stage.textureManager.updateTexture(u),u._glTextures[0].uploadData(new Uint8Array(l),256,1);var d=new PIXI.Sprite(new PIXI.Texture(u)),m=PIXI.RenderTexture.create(d.texture.width,d.texture.height);BFN.Stage.render(d,m),d.destroy(!0);try{u.destroyGC(!0)}catch(e){}return u=null,d=null,c=null,l=null,a=null,n=null,o=null,m},SplineInterpolator:function(e){var t=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[],e.sort(function(e,t){return e[0]-t[0]});for(var i=0;i<t;i++)this.xa.push(e[i][0]),this.ya.push(e[i][1]);this.u[0]=0,this.y2[0]=0;for(i=1;i<t-1;++i){var r=this.xa[i+1]-this.xa[i-1],a=(this.xa[i]-this.xa[i-1])/r,n=a*this.y2[i-1]+2;this.y2[i]=(a-1)/n;var o=(this.ya[i+1]-this.ya[i])/(this.xa[i+1]-this.xa[i])-(this.ya[i]-this.ya[i-1])/(this.xa[i]-this.xa[i-1]);this.u[i]=(6*o/r-a*this.u[i-1])/n}this.y2[t-1]=0;for(i=t-2;i>=0;--i)this.y2[i]=this.y2[i]*this.y2[i+1]+this.u[i]},copy:function(e){var t,i,r;for(r in t=Array.isArray(e)?[]:{},e)i=e[r],t[r]="object"==typeof i?BFN.FilterHelper.copy(i):i;return t},getUnmaskedInfo:function(){var e=BFN.Stage.gl,t={renderer:"",vendor:""},i=e.getExtension("WEBGL_debug_renderer_info");return null!=i&&(t.renderer=e.getParameter(i.UNMASKED_RENDERER_WEBGL),t.vendor=e.getParameter(i.UNMASKED_VENDOR_WEBGL)),t},emptyPoolForFilter(){BFN.Stage.filterManager.emptyPool()}},BFN.FilterHelper.SplineInterpolator.prototype.interpolate=function(e){for(var t=0,i=this.ya.length-1;i-t>1;){var r=i+t>>1;this.xa[r]>e?i=r:t=r}var a=this.xa[i]-this.xa[t],n=(this.xa[i]-e)/a,o=(e-this.xa[t])/a;return n*this.ya[t]+o*this.ya[i]+((n*n*n-n)*this.y2[t]+(o*o*o-o)*this.y2[i])*(a*a)/6};var y="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",x="#define GLSLIFY 1\nconst int kSize = 2;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color) {\n   return pow( color, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color) {\n   return pow( color, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_0/eDimensions_0.x,gap_0/eDimensions_0.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_0-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_1/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_1/adjDimensions);\n\n    vec2 st = vTextureCoord_1-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvoid main(void)\n{\n\n   vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n   vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n   vec4 src = smoothImage(uSampler,textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n   gl_FragColor = alphaMask(src,textureCoord,eDimensions, gap, isRotated, uTextureClamp);\n   //texture2D(uSampler, textureCoord);\n\n}\n";class _ extends PIXI.Shader{constructor(e,t,i,r){super(e,t,i),this.bind(),this.tilingMode=r,this.tempQuad=new PIXI.Quad(e),this.tempQuad.initVao(this),this.uniforms.uColor=new Float32Array([1,1,1,1]),this.uniforms.uSampler=[0,1],this.uniforms.fillColor=new Float32Array([0,0,0,1]),this.uniforms.intensity=0}}class I extends _{constructor(e,t){super(e,y,x,t),this.bind(),this.uniforms.uColor=new Float32Array(1,1,1,1)}}var T="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize = 2;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 addBlend (vec3 src, vec3 dst)\n{\n    return src + dst;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n\n    //unpremultiply\n    if (src.a == 0.0) {\n            gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    //src.rgb/src.a;\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    //dst.rgb / (dst.a + 0.000001);\n    //\n\n    //blend\n    vec3 colour = clamp(addBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n\n    //premultiply and blend image alphas\n//    vec4 res;\n//    res.xyz = (1.0 - src.a) * Cs + src.a * colour;\n//    res.a = src.a + dst.a * (1.0-src.a);\n\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n\n}\n",b="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 subtractBlend (vec3 src, vec3 dst)\n{\n    return dst-src;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(subtractBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n\n",S="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 multiplyBlend (vec3 src, vec3 dst)\n{\n    return src * dst;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(multiplyBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n\n}\n",C="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 darkenBlend (vec3 src, vec3 dst)\n{\n    return min(src, dst);\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(darkenBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n\n}\n",B="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 colorBurnBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.x) / src.x)),\n           \t\t\t\t(src.y == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.y) / src.y)),\n           \t\t\t\t(src.z == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.z) / src.z)));\n}\n\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n   if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(colorBurnBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",F="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 linearBurnBlend (vec3 src, vec3 dst)\n{\n    return (src + dst) - 1.0;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(linearBurnBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",E="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 lightenBlend (vec3 src, vec3 dst)\n{\n    return max(src, dst);\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(lightenBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",P="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 screenBlend (vec3 src, vec3 dst)\n{\n    return (src + dst) - (src * dst);\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(screenBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",N="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 colordodgeBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x == 1.0) ? 1.0 : min(1.0, dst.x / (1.0 - src.x)),\n           \t\t\t\t(src.y == 1.0) ? 1.0 : min(1.0, dst.y / (1.0 - src.y)),\n           \t\t\t\t(src.z == 1.0) ? 1.0 : min(1.0, dst.z / (1.0 - src.z)));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(colordodgeBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n\n}\n",M="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 lineardodgeBlend (vec3 src, vec3 dst)\n{\n    return src + dst;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(lineardodgeBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",D="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 overlayBlend (vec3 src, vec3 dst)\n{\n    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),\n           \t\t\t\t(dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),\n           \t\t\t\t(dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(overlayBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",w="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 softlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x <= 0.5) ? (dst.x - (1.0 - 2.0 * src.x) * dst.x * (1.0 - dst.x)) : (((src.x > 0.5) && (dst.x <= 0.25)) ? (dst.x + (2.0 * src.x - 1.0) * (4.0 * dst.x * (4.0 * dst.x + 1.0) * (dst.x - 1.0) + 7.0 * dst.x)) : (dst.x + (2.0 * src.x - 1.0) * (sqrt(dst.x) - dst.x))),\n           \t\t\t\t(src.y <= 0.5) ? (dst.y - (1.0 - 2.0 * src.y) * dst.y * (1.0 - dst.y)) : (((src.y > 0.5) && (dst.y <= 0.25)) ? (dst.y + (2.0 * src.y - 1.0) * (4.0 * dst.y * (4.0 * dst.y + 1.0) * (dst.y - 1.0) + 7.0 * dst.y)) : (dst.y + (2.0 * src.y - 1.0) * (sqrt(dst.y) - dst.y))),\n           \t\t\t\t(src.z <= 0.5) ? (dst.z - (1.0 - 2.0 * src.z) * dst.z * (1.0 - dst.z)) : (((src.z > 0.5) && (dst.z <= 0.25)) ? (dst.z + (2.0 * src.z - 1.0) * (4.0 * dst.z * (4.0 * dst.z + 1.0) * (dst.z - 1.0) + 7.0 * dst.z)) : (dst.z + (2.0 * src.z - 1.0) * (sqrt(dst.z) - dst.z))));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(softlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",k="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 hardlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - src.x) * (1.0 - dst.x)),\n           \t\t\t\t(src.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - src.y) * (1.0 - dst.y)),\n           \t\t\t\t(src.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - src.z) * (1.0 - dst.z)));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(hardlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",L="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 vividlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x <= 0.5) ? (1.0 - (1.0 - dst.x) / (2.0 * src.x)) : (dst.x / (2.0 * (1.0 - src.x))),\n           \t\t\t\t(src.y <= 0.5) ? (1.0 - (1.0 - dst.y) / (2.0 * src.y)) : (dst.y / (2.0 * (1.0 - src.y))),\n           \t\t\t\t(src.z <= 0.5) ? (1.0 - (1.0 - dst.z) / (2.0 * src.z)) : (dst.z / (2.0 * (1.0 - src.z))));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(vividlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",O="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 linearlightBlend (vec3 src, vec3 dst)\n{\n    return 2.0 * src + dst - 1.0;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(linearlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",R="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 pinlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x > 0.5) ? max(dst.x, 2.0 * (src.x - 0.5)) : min(dst.x, 2.0 * src.x),\n           \t\t\t\t(src.x > 0.5) ? max(dst.y, 2.0 * (src.y - 0.5)) : min(dst.y, 2.0 * src.y),\n           \t\t\t\t(src.z > 0.5) ? max(dst.z, 2.0 * (src.z - 0.5)) : min(dst.z, 2.0 * src.z));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(pinlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",A="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 differenceBlend (vec3 src, vec3 dst)\n{\n    return abs(dst - src);\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(differenceBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",V="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n       // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        result2 *= bottomRight.x * bottomRight.y;\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec3 exclusionBlend (vec3 src, vec3 dst)\n{\n    return src + dst - 2.0 * src * dst;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(exclusionBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, isRotated, uTextureClamp) : result;\n}\n",U="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 mapMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMapCoord = (mapMatrix * vec3(aVertexPosition, 1.0)).xy;\n}\n";class G extends _{constructor(e,t,i){var r=T;switch(i){case BFN.CONST.BLEND_MODES.SUBTRACT:r=b;break;case BFN.CONST.BLEND_MODES.MULTIPLY:r=S;break;case BFN.CONST.BLEND_MODES.DARKEN:r=C;break;case BFN.CONST.BLEND_MODES.COLOR_BURN:r=B;break;case BFN.CONST.BLEND_MODES.LINEAR_BURN:r=F;break;case BFN.CONST.BLEND_MODES.LIGHTEN:r=E;break;case BFN.CONST.BLEND_MODES.SCREEN:r=P;break;case BFN.CONST.BLEND_MODES.COLOR_DODGE:r=N;break;case BFN.CONST.BLEND_MODES.LINEAR_DODGE:r=M;break;case BFN.CONST.BLEND_MODES.OVERLAY:r=D;break;case BFN.CONST.BLEND_MODES.SOFT_LIGHT:r=w;break;case BFN.CONST.BLEND_MODES.HARD_LIGHT:r=k;break;case BFN.CONST.BLEND_MODES.VIVID_LIGHT:r=L;break;case BFN.CONST.BLEND_MODES.LINEAR_LIGHT:r=O;break;case BFN.CONST.BLEND_MODES.PIN_LIGHT:r=R;break;case BFN.CONST.BLEND_MODES.DIFFERENCE:r=A;break;case BFN.CONST.BLEND_MODES.EXCLUSION:r=V}super(e,U,r,t),this.bind(),this.uniforms.uSampler=[0,1]}}var H=PIXI.WRAP_MODES;function z(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}class X extends PIXI.ObjectRenderer{constructor(e){super(e)}onContextChange(){this._tempClamp=new Float32Array(4),this._tempColor=new Float32Array(4),this._tempRect=new PIXI.Rectangle,this._tempRect2=new PIXI.Rectangle,this._tempRect3=new PIXI.Rectangle,this._tempMatrix=new PIXI.Matrix,this._tempMatrix2=new PIXI.Matrix,this._bigBuf=new Uint8Array(1<<20);var e=this.renderer.gl;this.drawModes=[],this.normalShader=[new I(e,0)],this._renderTexture=new PIXI.BaseRenderTexture(1024,1024)}start(){}flush(){}_getRenderTexture(e,t){return(this._renderTexture.width<e||this._renderTexture.height<t)&&(e=z(e),t=z(t),this._renderTexture.resize(e,t)),this._renderTexture}_getBuf(e){var t=this._bigBuf;return t.length<e&&(e=z(e),t=new Uint8Array(e),this._bigBuf=t),t}render(e){if(e.texture.valid){var t=0;e.tileTransform&&(t=this._isSimpleSprite(e)?1:2);var i=null;if(e.blendMode){if(e.blendMode=parseInt(e.blendMode),this.drawModes.length<1||!this.drawModes[e.blendMode]){var r=this.renderer.gl;this.drawModes=function(e,t,i){t=t||[];var r=[BFN.CONST.BLEND_MODES.ADD,BFN.CONST.BLEND_MODES.SUBTRACT,BFN.CONST.BLEND_MODES.MULTIPLY,BFN.CONST.BLEND_MODES.DARKEN,BFN.CONST.BLEND_MODES.COLOR_BURN,BFN.CONST.BLEND_MODES.LINEAR_BURN,BFN.CONST.BLEND_MODES.LIGHTEN,BFN.CONST.BLEND_MODES.SCREEN,BFN.CONST.BLEND_MODES.COLOR_DODGE,BFN.CONST.BLEND_MODES.LINEAR_DODGE,BFN.CONST.BLEND_MODES.OVERLAY,BFN.CONST.BLEND_MODES.SOFT_LIGHT,BFN.CONST.BLEND_MODES.HARD_LIGHT,BFN.CONST.BLEND_MODES.VIVID_LIGHT,BFN.CONST.BLEND_MODES.LINEAR_LIGHT,BFN.CONST.BLEND_MODES.PIN_LIGHT,BFN.CONST.BLEND_MODES.DIFFERENCE,BFN.CONST.BLEND_MODES.EXCLUSION];return null!=i&&r[i]&&!t[i]&&(t[i]=[new G(e,0,i)]),t}(r,this.drawModes,e.blendMode)}this.drawModes[e.blendMode]&&(i=this.drawModes[e.blendMode])}i?this._renderBlend(e,i[t]):this._renderNormal(e,this.normalShader[t])}}_renderNormal(e,t){var i=this.renderer;i.bindShader(t),i.state.setBlendMode(e.blendMode),this._renderInner(e,t)}_renderBlend(e,t){var i=this.renderer,r=e.getBounds(),a=i._activeRenderTarget,n=a.projectionMatrix,o=n.a<0,s=n.d<0,l=a.resolution,h=this._tempRect,c=a.sourceFrame||a.destinationFrame;h.x=0,h.y=0,h.width=c.width*l,h.height=c.height*l;var u=this._tempRect2,d=c.width*l,m=c.height*l;u.x=(r.x+n.tx/n.a)*l+d/2,u.y=(r.y+n.ty/n.d)*l+m/2,u.width=r.width*l,u.height=r.height*l,o&&(u.y=d-u.width-u.x),s&&(u.y=m-u.height-u.y);this._tempRect3;var p=Math.floor(Math.max(h.x,u.x)),g=Math.ceil(Math.min(h.x+h.width,u.x+u.width)),f=Math.floor(Math.max(h.y,u.y)),v=g-p,y=Math.ceil(Math.min(h.y+h.height,u.y+u.height))-f;if(!(v<=0||y<=0)){var x=this._getRenderTexture(v,y);i.bindTexture(x,1,!0);var _=i.gl;if(i.renderingToScreen&&a.root){this._getBuf(v*y*4);_.readPixels(p,f,v,y,_.RGBA,_.UNSIGNED_BYTE,this._bigBuf),_.texSubImage2D(_.TEXTURE_2D,0,0,0,v,y,_.RGBA,_.UNSIGNED_BYTE,this._bigBuf)}else _.copyTexSubImage2D(_.TEXTURE_2D,0,0,0,p,f,v,y);if(i.bindShader(t),i.state.setBlendMode(PIXI.BLEND_MODES.NORMAL),t.uniforms.mapMatrix){var I=this._tempMatrix;I.a=u.width/x.width/r.width,o?(I.a=-I.a,I.tx=(u.x-p)/x.width-(r.x+r.width)*I.a):I.tx=(u.x-p)/x.width-r.x*I.a,I.d=u.height/x.height/r.height,s?(I.d=-I.d,I.ty=(u.y-f)/x.height-(r.y+r.height)*I.d):I.ty=(u.y-f)/x.height-r.y*I.d,t.uniforms.mapMatrix=I.toArray(!0)}this._renderInner(e,t)}}_renderInner(e,t){this.renderer;t.tilingMode>0?this._renderWithShader(e,1===t.tilingMode,t):this._renderSprite(e,t)}_renderSprite(e,t){var i=this.renderer,r=t.tempQuad;i.bindVao(r.vao);var a,n,o,s,l=e.texture._uvs,h=(r.vertices,e.vertexData,Math.abs(e.transform.worldTransform.b)),c=!e.hasOwnProperty("smoothEdges")||e.smoothEdges;h>1e-5&&c?(a=1,n=BFN.Util.expandVertices(e.vertexData,a),o=BFN.Util.getDistance(n[0],n[1],n[2],n[3]),s=BFN.Util.getDistance(n[2],n[3],n[4],n[5]),t.uniforms.isRotated=1):(a=0,n=e.vertexData,o=e.texture.baseTexture.width,s=e.texture.baseTexture.height,t.uniforms.isRotated=0),r.vertices[0]=n[0],r.vertices[1]=n[1],r.vertices[2]=n[2],r.vertices[3]=n[3],r.vertices[4]=n[4],r.vertices[5]=n[5],r.vertices[6]=n[6],r.vertices[7]=n[7];var u=e.texture.frame,d=e.texture.baseTexture;if(t.uniforms.eDimensions=[o,s],t.uniforms.gap=a,r.uvs[0]=l.x0,r.uvs[1]=l.y0,r.uvs[2]=l.x1,r.uvs[3]=l.y1,r.uvs[4]=l.x2,r.uvs[5]=l.y2,r.uvs[6]=l.x3,r.uvs[7]=l.y3,r.upload(),u&&d){var m=this._tempClamp,p=0/d.resolution;m[0]=(u.x-p)/d.width,m[1]=(u.y-p)/d.height,m[2]=(u.x+u.width+p)/d.width,m[3]=(u.y+u.height+p)/d.height,t.uniforms.uTextureClamp=m;var g=this._tempColor;PIXI.utils.hex2rgb(e.tint,g);var f=e.worldAlpha;g[0]*=f,g[1]*=f,g[2]*=f,g[3]=f,t.uniforms.uColor=g;var v=e.hasOwnProperty("fillColor")?PIXI.utils.hex2rgb(e.fillColor):new Float32Array([0,0,0,1]);v[0]*=f,v[1]*=f,v[2]*=f,v[3]=f;var y=e.hasOwnProperty("intensity")?e.intensity:0;t.uniforms.fillColor=v,t.uniforms.intensity=y,t.uniforms.dims=[d.width,d.height];var x=BFN.smoothPictureDisabled?1:e.hasOwnProperty("currentScale")?e.currentScale:1,_=BFN.smoothPictureDisabled?1:e.hasOwnProperty("currentScaleY")?e.currentScaleY:x;t.uniforms.smoothingScaleFactor=[x*window.bfn_resolution,_*window.bfn_resolution],i.bindTexture(d,0,!0),r.vao.draw(this.renderer.gl.TRIANGLES,6,0)}}_isSimpleSprite(e){var t=this.renderer,i=e._texture,r=i.baseTexture,a=r.isPowerOfTwo&&i.frame.width===r.width&&i.frame.height===r.height;return a&&(r._glTextures[t.CONTEXT_UID]?a=r.wrapMode!==H.CLAMP:r.wrapMode===H.CLAMP&&(r.wrapMode=H.REPEAT)),a}_renderWithShader(e,t,i){var r=i.tempQuad,a=this.renderer;a.bindVao(r.vao);var n=r.vertices,o=e._width,s=e._height,l=e._anchor._x,h=e._anchor._y,c=o*(1-l),u=o*-l,d=s*(1-h),m=s*-h,p=e.transform.worldTransform,g=p.a,f=p.b,v=p.c,y=p.d,x=p.tx,_=p.ty;n[0]=g*u+v*m+x,n[1]=y*m+f*u+_,n[2]=g*c+v*m+x,n[3]=y*m+f*c+_,n[4]=g*c+v*d+x,n[5]=y*d+f*c+_,n[6]=g*u+v*d+x,n[7]=y*d+f*u+_,(n=r.uvs)[0]=n[6]=-e.anchor.x,n[1]=n[3]=-e.anchor.y,n[2]=n[4]=1-e.anchor.x,n[5]=n[7]=1-e.anchor.y,r.upload();var I=e._texture,T=e.tileTransform.localTransform,b=e.uvTransform,S=b.mapCoord,C=b.uClampFrame,B=b.uClampOffset,F=I.width,E=I.height,P=o,N=s,M=this._tempMatrix2;M.set(T.a*F/P,T.b*F/N,T.c*E/P,T.d*E/N,T.tx/P,T.ty/N),M.invert(),t?M.append(S):(i.uniforms.uMapCoord=S.toArray(!0),i.uniforms.uClampFrame=C,i.uniforms.uClampOffset=B),i.uniforms.uTransform=M.toArray(!0);var D=this._tempColor,w=e.worldAlpha;PIXI.utils.hex2rgb(e.tint,D),D[0]*=w,D[1]*=w,D[2]*=w,D[3]=w,i.uniforms.uColor=D;var k=e.hasOwnProperty("fillColor")?PIXI.utils.hex2rgb(e.fillColor):new Float32Array([0,0,0,1]);k[0]*=w,k[1]*=w,k[2]*=w,k[3]=w;var L=e.hasOwnProperty("intensity")?e.intensity:0;i.uniforms.fillColor=k,i.uniforms.intensity=L,a.bindTexture(I,0,!0),r.vao.draw(this.renderer.gl.TRIANGLES,6,0)}}PIXI.WebGLRenderer.registerPlugin("blend_picture",X);var j={PictureSprite:class extends PIXI.Sprite{constructor(e){super(e)}_renderWebGL(e){this.updateGeometry?this.updateGeometry():this.calculateVertices(),e.setObjectRenderer(e.plugins.picture),e.plugins.picture.render(this)}},PictureTilingSprite:class extends PIXI.extras.TilingSprite{constructor(e,t,i){super(e,t,i)}_renderWebGL(e){this.updateGeometry&&this.updateGeometry();var t=this._texture;t&&t.valid&&(this.tileTransform.updateLocalTransform(),this.uvTransform.update(),e.setObjectRenderer(e.plugins.picture),e.plugins.picture.render(this))}},PictureRenderer:X};Object.assign(PIXI.extras,j);var W="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform vec2 kernelDim;\nuniform vec2 gapRatio;\nuniform vec2 scaleRatio;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 gapTextureCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    gapTextureCoord = (aTextureCoord-gapRatio) / scaleRatio;\n    vSmoothTexCoordsLeft = gapTextureCoord + vec2(-kernelDim.x,0.0);\n    vSmoothTexCoordsRight = gapTextureCoord + vec2(kernelDim.x,0.0);\n    vSmoothTexCoordsTop = gapTextureCoord + vec2(0.0,kernelDim.y);\n    vSmoothTexCoordsBottom = gapTextureCoord + vec2(0.0,-kernelDim.y);\n\n    vTextureCoord = aTextureCoord;\n}\n",Y="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 gapTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\n//for kernel 3\n//const vec4 gaussWeights = vec4(0.4403113, 0.2988043, 0.0453564, -0.0643164);\n\n//for kernel 2\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 1;\n\nvec4 alphaMask(vec4 inputColor) {\n    vec4 result;\n    if(gap==0.0) {\n        result = inputColor;\n\n    } else {\n            vec2 gapRatio = vec2(gap/eDimensions.x,gap/eDimensions.y);\n            vec2 st = vTextureCoord;\n            vec2 edgeOne; vec2 edgeTwo;\n            vec2 topLeft; float result2; vec2 bottomRight;\n\n            //checks if sprite is rotated, if rotated apply interpolation\n            if(isRotated==0.0) {\n                edgeOne = gapRatio;\n\n                topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n                result2 = topLeft.x * topLeft.y;\n                bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n                result2 *= bottomRight.x * bottomRight.y;\n\n            }\n            else {\n\n                edgeOne = max(gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y),vec2(0.0,0.0));\n                edgeTwo = gapRatio + gapRatio/gap;\n\n                topLeft = smoothstep(edgeOne,edgeTwo,st);\n                result2 = topLeft.x * topLeft.y;\n                bottomRight = smoothstep(edgeOne,edgeTwo,1.0-st);\n                result2 *= bottomRight.x * bottomRight.y;\n            }\n\n            //gamma correct mask, increase this value for sharper less smooth edges\n            result2 = pow(result2,1.5);\n\n            //apply mask\n            result = mix(vec4(0.0),inputColor,result2);\n\n    }\n    return result;\n\n}\n\nvoid main(void)\n{\n    //apply smoothing, corrdinates passed by vertex\n    vec4 color = vec4(0.0);\n    color = texture2D(uSampler, gapTextureCoord) * 0.20;\n    color += texture2D(uSampler, vSmoothTexCoordsLeft) * 0.20;\n    color += texture2D(uSampler, vSmoothTexCoordsRight) * 0.20;\n    color += texture2D(uSampler, vSmoothTexCoordsTop) * 0.20;\n    color += texture2D(uSampler, vSmoothTexCoordsBottom) * 0.20;\n\n    gl_FragColor = isRotated == 1.0 ? alphaMask(color*uColor) : color*uColor;\n}\n";class q extends PIXI.Shader{constructor(e){super(e,W,Y),this.bind(),this.uniforms.uColor=new Float32Array(1,1,1,1)}}var K="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nuniform vec2 kernelDim;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vSmoothTexCoordsLeft = aTextureCoord + vec2(-kernelDim.x,0.0);\n    vSmoothTexCoordsRight = aTextureCoord + vec2(kernelDim.x,0.0);\n    vSmoothTexCoordsTop = aTextureCoord + vec2(0.0,kernelDim.y);\n    vSmoothTexCoordsBottom = aTextureCoord + vec2(0.0,-kernelDim.y);\n\n    vTextureCoord = aTextureCoord;\n}\n",Q="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvec4 gamma (vec4 color) {\n   return pow( color, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color) {\n   return pow( color, vec4(2.2) );\n\n}\n\nvoid main(void)\n{\n    //apply smoothing, corrdinates passed by vertex\n    vec4 color = vec4(0.0);\n    color = deGamma(texture2D(uSampler, vTextureCoord)) * 0.20;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsLeft)) * 0.20;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsRight)) * 0.20;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsTop)) * 0.20;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsBottom)) * 0.20;\n\n    gl_FragColor = gamma(color)*uColor;\n}\n";class Z extends PIXI.Shader{constructor(e){super(e,K,Q),this.bind(),this.uniforms.uColor=new Float32Array(1,1,1,1)}}var J="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nuniform vec2 kernelDim;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 vSmoothTexCoordsTopLeft;\nvarying vec2 vSmoothTexCoordsTopRight;\nvarying vec2 vSmoothTexCoordsBottomLeft;\nvarying vec2 vSmoothTexCoordsBottomRight;\n\nvarying vec2 vTextureCoord;\n\n/*\n\n0.077847\t0.123317\t0.077847\n0.123317\t0.195346\t0.123317\n0.077847\t0.123317\t0.077847\n\n*/\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vSmoothTexCoordsLeft = aTextureCoord + vec2(-kernelDim.x,0.0);\n    vSmoothTexCoordsRight = aTextureCoord + vec2(kernelDim.x,0.0);\n    vSmoothTexCoordsTop = aTextureCoord + vec2(0.0,kernelDim.y);\n    vSmoothTexCoordsBottom = aTextureCoord + vec2(0.0,-kernelDim.y);\n\n    vSmoothTexCoordsTopLeft = aTextureCoord + vec2(-kernelDim.x,-kernelDim.y);\n    vSmoothTexCoordsTopRight = aTextureCoord + vec2(kernelDim.x,-kernelDim.y);\n    vSmoothTexCoordsBottomLeft = aTextureCoord + vec2(-kernelDim.x,kernelDim.y);\n    vSmoothTexCoordsBottomRight = aTextureCoord + vec2(kernelDim.x,kernelDim.y);\n\n    vTextureCoord = aTextureCoord;\n}\n",$="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 vSmoothTexCoordsTopLeft;\nvarying vec2 vSmoothTexCoordsTopRight;\nvarying vec2 vSmoothTexCoordsBottomLeft;\nvarying vec2 vSmoothTexCoordsBottomRight;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\n/*\n\n0.077847\t0.123317\t0.077847\n0.123317\t0.195346\t0.123317\n0.077847\t0.123317\t0.077847\n\n*/\n\nvec4 gamma (vec4 color) {\n   return pow( color, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color) {\n   return pow( color, vec4(2.2) );\n\n}\n\nvoid main(void)\n{\n    //apply smoothing, corrdinates passed by vertex\n    vec4 color = vec4(0.0);\n    color = deGamma(texture2D(uSampler, vTextureCoord)) * 0.195346;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsLeft)) * 0.123317;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsRight)) * 0.123317;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsTop)) * 0.123317;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsBottom)) * 0.123317;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsTopLeft)) * 0.077847;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsTopRight)) * 0.077847;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsBottomLeft)) * 0.077847;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsBottomRight)) * 0.077847;\n\n    gl_FragColor = gamma(color)*uColor;\n}\n";class ee extends PIXI.Shader{constructor(e){super(e,J,$),this.bind(),this.uniforms.uColor=new Float32Array(1,1,1,1)}}var te="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",ie="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec4 alphaMask(vec4 inputColor) {\n\n    vec4 result;\n    if(gap==0.0) {\n        result = inputColor;\n\n    } else {\n            vec2 gapRatio = vec2(gap/eDimensions.x,gap/eDimensions.y);\n            vec2 st = vTextureCoord;\n            vec2 edgeOne; vec2 edgeTwo;\n            vec2 topLeft; float result2; vec2 bottomRight;\n\n            //checks if sprite is rotated, if rotated apply interpolation\n            if(isRotated==0.0) {\n                edgeOne = gapRatio;\n\n                topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n                result2 = topLeft.x * topLeft.y;\n                bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n                result2 *= bottomRight.x * bottomRight.y;\n\n            }\n            else {\n\n                edgeOne = max(gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y),vec2(0.0,0.0));\n                edgeTwo = gapRatio + gapRatio/gap;\n\n                topLeft = smoothstep(edgeOne,edgeTwo,st);\n                result2 = topLeft.x * topLeft.y;\n                bottomRight = smoothstep(edgeOne,edgeTwo,1.0-st);\n                result2 *= bottomRight.x * bottomRight.y;\n            }\n\n            //gamma correct mask, increase this value for sharper less smooth edges\n            result2 = pow(result2,1.5);\n\n            //apply mask\n            result = mix(vec4(0.0),inputColor,result2);\n\n    }\n    return result;\n\n}\n\nvoid main(void)\n{\n    vec2 gapRatio = vec2(gap/eDimensions.x,gap/eDimensions.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord;\n    if(gap==0.0) {\n        textureCoord =vTextureCoord;\n    }\n    else {\n       textureCoord = (vTextureCoord-gapRatio) / scaleRatio;\n    }\n\n    vec4 inputColor = texture2D(uSampler, textureCoord)*uColor;\n    gl_FragColor = isRotated == 1.0 ? alphaMask(inputColor) : inputColor;\n}\n";class re extends PIXI.Shader{constructor(e){super(e,te,ie),this.bind(),this.uniforms.uColor=new Float32Array(1,1,1,1)}}var ae="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",ne="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 inputColor = texture2D(uSampler, vTextureCoord)*uColor;\n    gl_FragColor = inputColor;\n}\n";class oe extends PIXI.Shader{constructor(e){super(e,ae,ne),this.bind(),this.uniforms.uColor=new Float32Array(1,1,1,1)}}PIXI.glCore;class se extends PIXI.ObjectRenderer{constructor(e){super(e)}onContextChange(){var e=this.renderer.gl;this.quad=new PIXI.Quad(e),this.smoothRotationShader=new q(e),this.smoothShader=new Z(e),this.smoothResizeShader=new ee(e),this.normalShader=new oe(e),this.normalRotationShader=new re(e),this.quad.initVao(this.normalShader),this._tempColor=new Float32Array(4)}start(){}flush(){}render(e){if(e.texture.valid){var t=e.hasOwnProperty("currentScale")?e.currentScale:1,i=e.hasOwnProperty("currentScaleY")?e.currentScaleY:t,r=Math.abs(e.transform.worldTransform.b),a=!e.hasOwnProperty("smoothEdges")||e.smoothEdges,n=!!e.hasOwnProperty("isResize")&&e.isResize;t<1&&!BFN.smoothPictureDisabled?r>1e-5&&a?this._renderSmoothRotation(e,this.smoothRotationShader,t,i,r,a):n?this._renderSmooth(e,this.smoothResizeShader,t,i):this._renderSmooth(e,this.smoothShader,t,i):r>1e-5&&a?this._renderNormalRotation(e,this.normalRotationShader,r,a):this._renderNormal(e,this.normalShader)}}_renderNormal(e,t){var i=this.renderer;i.bindShader(t),i.state.setBlendMode(e.blendMode);var r=this.quad;i.bindVao(r.vao);for(var a=e.vertexData,n=0;n<8;n++)r.vertices[n]=a[n];var o=e.texture._uvs;r.uvs[0]=o.x0,r.uvs[1]=o.y0,r.uvs[2]=o.x1,r.uvs[3]=o.y1,r.uvs[4]=o.x2,r.uvs[5]=o.y2,r.uvs[6]=o.x3,r.uvs[7]=o.y3,r.upload();var s=this._tempColor;PIXI.utils.hex2rgb(e.tint,s);var l=e.worldAlpha;s[0]*=l,s[1]*=l,s[2]*=l,s[3]=l,t.uniforms.uColor=s;var h=e.texture.baseTexture;i.bindTexture(h,0,!0),r.vao.draw(this.renderer.gl.TRIANGLES,6,0)}_renderNormalRotation(e,t,i,r){var a=this.renderer;a.bindShader(t),a.state.setBlendMode(e.blendMode);var n=this.quad;a.bindVao(n.vao);var o,s,l,h,c=e.texture._uvs;i>1e-5&&r?(o=1,s=BFN.Util.expandVertices(e.vertexData,o),l=BFN.Util.getDistance(s[0],s[1],s[2],s[3]),h=BFN.Util.getDistance(s[2],s[3],s[4],s[5]),t.uniforms.isRotated=1):(o=0,s=e.vertexData,l=e.texture.baseTexture.width,h=e.texture.baseTexture.height,t.uniforms.isRotated=0),n.uvs[0]=c.x0,n.uvs[1]=c.y0,n.uvs[2]=c.x1,n.uvs[3]=c.y1,n.uvs[4]=c.x2,n.uvs[5]=c.y2,n.uvs[6]=c.x3,n.uvs[7]=c.y3,n.vertices[0]=s[0],n.vertices[1]=s[1],n.vertices[2]=s[2],n.vertices[3]=s[3],n.vertices[4]=s[4],n.vertices[5]=s[5],n.vertices[6]=s[6],n.vertices[7]=s[7],t.uniforms.eDimensions=[l,h],t.uniforms.gap=o,n.upload();var u=this._tempColor;PIXI.utils.hex2rgb(e.tint,u);var d=e.worldAlpha;u[0]*=d,u[1]*=d,u[2]*=d,u[3]=d,t.uniforms.uColor=u;var m=e.texture.baseTexture;a.bindTexture(m,0,!0),n.vao.draw(this.renderer.gl.TRIANGLES,6,0)}_renderSmooth(e,t,i,r){var a=this.renderer;a.bindShader(t),a.state.setBlendMode(e.blendMode);var n=this.quad;a.bindVao(n.vao);for(var o=e.vertexData,s=0;s<8;s++)n.vertices[s]=o[s];var l=e.texture._uvs;n.uvs[0]=l.x0,n.uvs[1]=l.y0,n.uvs[2]=l.x1,n.uvs[3]=l.y1,n.uvs[4]=l.x2,n.uvs[5]=l.y2,n.uvs[6]=l.x3,n.uvs[7]=l.y3,n.upload();var h=e.texture.baseTexture;t.uniforms.kernelDim=[1/h.width/i/window.bfn_resolution*.25,1/h.height/r/window.bfn_resolution*.25];var c=this._tempColor;PIXI.utils.hex2rgb(e.tint,c);var u=e.worldAlpha;c[0]*=u,c[1]*=u,c[2]*=u,c[3]=u,t.uniforms.uColor=c,a.bindTexture(h,0,!0),n.vao.draw(this.renderer.gl.TRIANGLES,6,0)}_renderSmoothRotation(e,t,i,r,a,n){var o=this.renderer;o.bindShader(t),o.state.setBlendMode(e.blendMode);var s=this.quad;o.bindVao(s.vao);var l,h,c,u,d=e.texture._uvs;a>1e-5&&n?(u=1,l=BFN.Util.expandVertices(e.vertexData,u),h=BFN.Util.getDistance(l[0],l[1],l[2],l[3]),c=BFN.Util.getDistance(l[2],l[3],l[4],l[5]),t.uniforms.isRotated=1):(u=0,l=e.vertexData,h=e.texture.baseTexture.width,c=e.texture.baseTexture.height,t.uniforms.isRotated=0),s.uvs[0]=d.x0,s.uvs[1]=d.y0,s.uvs[2]=d.x1,s.uvs[3]=d.y1,s.uvs[4]=d.x2,s.uvs[5]=d.y2,s.uvs[6]=d.x3,s.uvs[7]=d.y3,s.vertices[0]=l[0],s.vertices[1]=l[1],s.vertices[2]=l[2],s.vertices[3]=l[3],s.vertices[4]=l[4],s.vertices[5]=l[5],s.vertices[6]=l[6],s.vertices[7]=l[7],t.uniforms.gap=u,t.uniforms.eDimensions=[h,c],t.uniforms.gapRatio=[u/h,u/c],t.uniforms.scaleRatio=[1-2*t.uniforms.gapRatio[0],1-2*t.uniforms.gapRatio[1]],s.upload();var m=e.texture.baseTexture;t.uniforms.kernelDim=[1/m.width/i*.25,1/m.height/r*.25];var p=this._tempColor;PIXI.utils.hex2rgb(e.tint,p);var g=e.worldAlpha;p[0]*=g,p[1]*=g,p[2]*=g,p[3]=g,t.uniforms.uColor=p,o.bindTexture(m,0,!0),s.vao.draw(this.renderer.gl.TRIANGLES,6,0)}}PIXI.WebGLRenderer.registerPlugin("smooth_picture",se),PIXI.CanvasRenderer.registerPlugin("smooth_picture",PIXI.CanvasSpriteRenderer);var le={SmoothPictureRenderer:se};Object.assign(PIXI.extras,le);class he extends PIXI.ObjectRenderer{constructor(e){super(e)}onContextChange(){BFN.ObjectRenderer=this.renderer}bindShaderParams(e){if(!e.tempQuad){if(e.tempQuad=new PIXI.Quad(this.renderer.gl),e.tempQuad.initVao(e),e.bind(),void 0!==e.channelTextures&&null!=e.channelTextures){var t=[];for(var i in e.channelTextures)t.push(parseInt(i));e.uniforms.uSampler=t}if(void 0!==e.initParams)try{e.initParams()}catch(e){}}}render(e){var t=this.renderer,i=e.bfn_shaders[0];this.bindShaderParams(i),t.bindShader(i),t.state.setBlendMode(e.blendMode);var r=i.tempQuad;t.bindVao(r.vao);for(var a=e.vertexData,n=0;n<8;n++)r.vertices[n]=a[n];var o=e.texture._uvs;r.uvs[0]=o.x0,r.uvs[1]=o.y0,r.uvs[2]=o.x1,r.uvs[3]=o.y1,r.uvs[4]=o.x2,r.uvs[5]=o.y2,r.uvs[6]=o.x3,r.uvs[7]=o.y3,r.upload();var s=e.texture.baseTexture;if(void 0!==i.applyParams)try{i.applyParams(s)}catch(e){}if(t.bindTexture(s,0,!0),void 0!==i.channelTextures&&null!==i.channelTextures)for(var l in i.channelTextures)"def"!=i.channelTextures[parseInt(l)]&&t.bindTexture(i[i.channelTextures[parseInt(l)]].baseTexture,parseInt(l),!0);r.vao.draw(this.renderer.gl.TRIANGLES,6,0)}}PIXI.WebGLRenderer.registerPlugin("filter_renderer",he);var ce={FilterRenderer:he};Object.assign(PIXI.extras,ce);function ue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._x=e,this._y=t,this._width=i,this._height=r,this._left=e,this._top=t,this._right=e+i,this._bottom=t+r,this._minX=Math.min(this._left,this._right),this._minY=Math.min(this._top,this._bottom),this._maxX=Math.max(this._left,this._right),this._maxY=Math.max(this._top,this._bottom)}function de(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.x1=e,this.y1=t,this.x2=i,this.y2=r,this.x3=a,this.y3=n}function me(){PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.init()}function pe(){BFN.EventDispatcher.call(this),this.init()}function ge(){this.username=null,this.email=null,this.isCfrmInner=!1,this.X34kgHS12YTuViYZ=!1,this.language="en",this.uplUri=null}BFN.SingletonQueue=new class{constructor(){this.init()}init(){BeFunky.log("SingletonQueue Init"),this.queue=[]}add(e){this.queue.push(e)}process(){for(;this.queue.length;)this.queue.shift()()}},ue.prototype.contains=function(e,t){return e>=this.minX&&e<=this.maxX&&t>=this.minY&&t<=this.maxY},ue.prototype.containsRect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e&&e.left>=this.left&&e.right<=this.right&&e.top>=this.top&&e.bottom<=this.bottom},ue.prototype.intersects=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e)try{if(i){if(this.minX>e.maxX+t||e.minX>this.maxX+t)return!1;if(this.minY>e.maxY+t||e.minY>this.maxY+t)return!1}else{if(this.minX>=e.maxX+t||e.minX>=this.maxX+t)return!1;if(this.minY>=e.maxY+t||e.minY>=this.maxY+t)return!1}return!0}catch(e){}return!1},ue.prototype.overlaps=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e)try{return!(!t(this.left,this.right,e.left)||!t(this.top,this.bottom,e.top)&&!t(this.top,this.bottom,e.bottom))||(!(!t(this.top,this.bottom,e.top)||!t(this.left,this.right,e.left)&&!t(this.left,this.right,e.right))||(!(!t(this.left,this.right,e.right)||!t(this.top,this.bottom,e.top)&&!t(this.top,this.bottom,e.bottom))||!(!t(this.top,this.bottom,e.bottom)||!t(this.left,this.right,e.left)&&!t(this.left,this.right,e.right))))}catch(e){}function t(e,t,i){return i>e&&i<t}return!1},ue.prototype.intersectsH=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!(Math.floor(this.top)>Math.ceil(e.bottom)||Math.floor(e.top)>Math.ceil(this.bottom))},ue.prototype.intersectsV=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!(Math.floor(this.left)>Math.ceil(e.right)||Math.floor(e.left)>Math.ceil(this.right))},ue.prototype.neighbors=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e)try{var i=new BFN.Rectangle;if(this.intersectsH(e)){if(e.right<this.left){if(!t)return"left";i.x=e.right,i.y=Math.min(this.top,e.top),i.width=this.left-e.right,i.height=Math.max(this.bottom,e.bottom)-Math.min(this.top,e.top);var r=i.clone();return r.y=Math.max(this.top,e.top),r.height=Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top),{side:"left",direction:"horizontal",distance:i.width,rect:e,gapRect:i,intersectRect:r}}if(e.left>this.right){if(!t)return"right";i.x=this.right,i.y=Math.min(this.top,e.top),i.width=e.left-this.right,i.height=Math.max(this.bottom,e.bottom)-Math.min(this.top,e.top);var a=i.clone();return a.y=Math.max(this.top,e.top),a.height=Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top),{side:"right",direction:"horizontal",distance:i.width,rect:e,gapRect:i,intersectRect:a}}}if(this.intersectsV(e)){if(e.bottom<this.top){if(!t)return"top";i.x=Math.min(this.left,e.left),i.y=e.bottom,i.width=Math.max(this.right,e.right)-Math.min(this.left,e.left),i.height=this.top-e.bottom;var n=i.clone();return n.x=Math.max(this.left,e.left),n.width=Math.min(this.right,e.right)-Math.max(this.left,e.left),{side:"top",direction:"vertical",distance:i.height,rect:e,gapRect:i,intersectRect:n}}if(e.top>this.bottom){if(!t)return"bottom";i.x=Math.min(this.left,e.left),i.y=this.bottom,i.width=Math.max(this.right,e.right)-Math.min(this.left,e.left),i.height=e.top-this.bottom;var o=i.clone();return o.x=Math.max(this.left,e.left),o.width=Math.min(this.right,e.right)-Math.max(this.left,e.left),{side:"bottom",direction:"vertical",distance:i.height,rect:e,gapRect:i,intersectRect:o}}}}catch(e){}return null},ue.prototype.clone=function(){return new BFN.Rectangle(this._x,this._y,this._width,this._height)},ue.prototype.updateAttributes=function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null){case"x":this._left=this._x,this._right=this._left+this._width;break;case"y":this._top=this._y,this._bottom=this._top+this._height;break;case"width":this._right=this._left+this._width;break;case"height":this._bottom=this._top+this._height;break;case"left":this._x=this._left,this._width=this._right-this._left;break;case"right":this._width=this._right-this._left;break;case"top":this._y=this._top,this._height=this._bottom-this._top;break;case"bottom":this._height=this._bottom-this._top}this._minX=Math.min(this._left,this._right),this._minY=Math.min(this._top,this._bottom),this._maxX=Math.max(this._left,this._right),this._maxY=Math.max(this._top,this._bottom)},Object.defineProperty(ue.prototype,"x",{set:function(e){this._x=e,this.updateAttributes("x")},get:function(){return this._x}}),Object.defineProperty(ue.prototype,"y",{set:function(e){this._y=e,this.updateAttributes("y")},get:function(){return this._y}}),Object.defineProperty(ue.prototype,"width",{set:function(e){this._width=e,this.updateAttributes("width")},get:function(){return this._width}}),Object.defineProperty(ue.prototype,"height",{set:function(e){this._height=e,this.updateAttributes("height")},get:function(){return this._height}}),Object.defineProperty(ue.prototype,"left",{set:function(e){this._left=e,this.updateAttributes("left")},get:function(){return this._left}}),Object.defineProperty(ue.prototype,"right",{set:function(e){this._right=e,this.updateAttributes("right")},get:function(){return this._right}}),Object.defineProperty(ue.prototype,"center",{get:function(){return this.centerX}}),Object.defineProperty(ue.prototype,"top",{set:function(e){this._top=e,this.updateAttributes("top")},get:function(){return this._top}}),Object.defineProperty(ue.prototype,"bottom",{set:function(e){this._bottom=e,this.updateAttributes("bottom")},get:function(){return this._bottom}}),Object.defineProperty(ue.prototype,"middle",{get:function(){return this.centerY}}),Object.defineProperty(ue.prototype,"centerX",{get:function(){return this._x+this._width/2}}),Object.defineProperty(ue.prototype,"centerY",{get:function(){return this._y+this._height/2}}),Object.defineProperty(ue.prototype,"minX",{get:function(){return this._minX}}),Object.defineProperty(ue.prototype,"maxX",{get:function(){return this._maxX}}),Object.defineProperty(ue.prototype,"minY",{get:function(){return this._minY}}),Object.defineProperty(ue.prototype,"maxY",{get:function(){return this._maxY}}),Object.defineProperty(ue.prototype,"rectangleObject",{get:function(){return{x:this._x,y:this._y,width:this._width,height:this._height}}}),BFN.Rectangle=ue,de.prototype.contains=function(e,t){var i=(t-this.y1)*(this.x2-this.x1)-(e-this.x1)*(this.y2-this.y1),r=(t-this.y3)*(this.x1-this.x3)-(e-this.x3)*(this.y1-this.y3),a=(t-this.y2)*(this.x3-this.x2)-(e-this.x2)*(this.y3-this.y2);return i*a>0&&r*a>0},de.prototype.clone=function(){return new BFN.Triangle(this.x1,this.y1,this.x2,this.y2,this.x3,this.y3)},Object.defineProperty(de.prototype,"width",{get:function(){return Math.max(this.x1,this.x2,this.x3)-Math.min(this.x1,this.x2,this.x3)}}),Object.defineProperty(de.prototype,"height",{get:function(){return Math.max(this.y1,this.y2,this.y3)-Math.min(this.y1,this.y2,this.y3)}}),Object.defineProperty(de.prototype,"left",{get:function(){return Math.min(this.x1,this.x2,this.x3)}}),Object.defineProperty(de.prototype,"right",{get:function(){Math.max(this.x1,this.x2,this.x3)}}),Object.defineProperty(de.prototype,"top",{get:function(){return Math.min(this.y1,this.y2,this.y3)}}),Object.defineProperty(de.prototype,"bottom",{get:function(){Math.max(this.y1,this.y2,this.y3)}}),Object.defineProperty(de.prototype,"centerX",{get:function(){return this.left+this.width/2}}),Object.defineProperty(de.prototype,"centerY",{get:function(){return this.top+this.height/2}}),Object.defineProperty(de.prototype,"minX",{get:function(){return this.left}}),Object.defineProperty(de.prototype,"maxX",{get:function(){return this.right}}),Object.defineProperty(de.prototype,"minY",{get:function(){return this.top}}),Object.defineProperty(de.prototype,"maxY",{get:function(){return this.bottom}}),Object.defineProperty(de.prototype,"triangleObject",{get:function(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,x3:this.x3,y3:this.y3}}}),BFN.Triangle=de,BFN.FrameDisplayEvents={FRAME_LOADED:new Event("FRAME_LOADED"),FRAME_UPDATED:new Event("FRAME_UPDATED")},me.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),me.prototype.init=function(){BeFunky.log("FrameDisplay Init"),this.initDefaultValues(),this.initGraphicLoader(),this.initDisplay(),this.initWindow(),this.initFrame()},me.prototype.initDefaultValues=function(){this._scale=1,this._itemWidth=0,this._itemHeight=0,this.minW=this.minH=10,this.maxW=this.maxH=BFN.maxImageSize,this.isThumb=!1,this.scaleOffsetFactor=1,this.smoothPadding=20,this.windowTexture=null,this.frameTexture=null,this.frameTextureData=null,this.frameW=0,this.frameH=0,this.windowX=0,this.windowY=0,this.windowW=0,this.windowH=0,this.frameScale=1,this.windowScale=1,this.frameAngle=0,this.renderPending=!1,this.colorOverlayFilter=new BFN.filters.ColorOverlayFilter,this.handleGraphicCompleteBind=this.handleGraphicComplete.bind(this),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},me.prototype.initGraphicLoader=function(){this.graphicLoader=new BFN.GraphicLoader},me.prototype.initDisplay=function(){this.displayContainer=new PIXI.Container,this.addChild(this.displayContainer)},me.prototype.initWindow=function(){this.windowContainer=new PIXI.Container,this.displayContainer.addChild(this.windowContainer),this.windowSprite=new PIXI.Sprite,this.windowSprite.pluginName="blend_picture",this.windowSprite.currentScale=1,this.windowSprite.anchor.x=this.windowSprite.anchor.y=.5,this.windowContainer.addChild(this.windowSprite),this.windowMask=new PIXI.Sprite(PIXI.RenderTexture.create(32,32)),this.windowMask.pluginName="blend_picture",this.windowMask.currentScale=1,this.windowContainer.addChild(this.windowMask),this.windowSprite.mask=this.windowMask},me.prototype.initFrame=function(){this.frameTextureSprite=new PIXI.Sprite,this.frameSprite=new PIXI.Sprite,this.frameSprite.pluginName="blend_picture",this.frameSprite.currentScale=1,this.frameSprite.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.displayContainer.addChild(this.frameSprite)},me.prototype.setupFrame=function(e,t,i,r,a,n,o,s){this.windowTexture=e,this.frameTextureData=i,this.minW=r,this.minH=a,this.maxW=n,this.maxH=o,this.isThumb=s,this.scaleOffsetFactor=1,s&&i.hasOwnProperty("frameW")&&i.hasOwnProperty("frameH")&&(this.scaleOffsetFactor=Math.max(i.frameW/186,i.frameH/120)),this.updateFrame();try{this.frameTextureSprite.texture.destroyGC(!0),this.frameSprite.texture.destroyGC(!0)}catch(e){}this.frameTextureSprite.texture=PIXI.Texture.EMPTY,this.frameSprite.texture=PIXI.Texture.EMPTY,this.graphicLoader.reset(),this.graphicLoader.graphicsData[t]=t,this.graphicLoader.addEventListener(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type,this.handleGraphicCompleteBind),this.graphicLoader.loadGraphics()},me.prototype.updateFrame=function(){if(this.frameW=this.frameTextureData.hasOwnProperty("frameW")?this.frameTextureData.frameW:this.windowTexture.width,this.frameH=this.frameTextureData.hasOwnProperty("frameH")?this.frameTextureData.frameH:this.windowTexture.height,this.windowX=this.frameTextureData.hasOwnProperty("windowX")?this.frameTextureData.windowX:0,this.windowY=this.frameTextureData.hasOwnProperty("windowY")?this.frameTextureData.windowY:0,this.windowW=this.frameTextureData.hasOwnProperty("windowW")?this.frameTextureData.windowW:this.frameTextureData.frameW,this.windowH=this.frameTextureData.hasOwnProperty("windowH")?this.frameTextureData.windowH:this.frameTextureData.frameH,this.frameAngle>0){var e;switch(this.frameAngle){case 90:e=this.windowX,this.windowX=this.frameH-this.windowH-this.windowY,this.windowY=e;break;case 180:this.windowX=this.frameW-this.windowW-this.windowX,this.windowY=this.frameH-this.windowH-this.windowY;break;case 270:e=this.windowX,this.windowX=this.windowY,this.windowY=this.frameW-this.windowW-e}this.frameAngle%180&&(e=this.frameW,this.frameW=this.frameH,this.frameH=e,e=this.windowW,this.windowW=this.windowH,this.windowH=e)}this.frameAngle%180?(this.frameTextureSprite.scale.y<0&&(this.windowX=this.frameW-(this.windowX+this.windowW)),this.frameTextureSprite.scale.x<0&&(this.windowY=this.frameH-(this.windowY+this.windowH))):(this.frameTextureSprite.scale.x<0&&(this.windowX=this.frameW-(this.windowX+this.windowW)),this.frameTextureSprite.scale.y<0&&(this.windowY=this.frameH-(this.windowY+this.windowH)));var t=Math.min(this.maxW/this.frameW,this.maxH/this.frameH),i=Math.max(this.minW/this.frameW,this.minH/this.frameH),r=Math.min(this.windowTexture.width/this.windowW,this.windowTexture.height/this.windowH);this.frameScale=Math.min(t,Math.max(i,r)),this.frameW=Math.round(this.frameW*this.frameScale),this.frameH=Math.round(this.frameH*this.frameScale),this.windowX=Math.round(this.windowX*this.frameScale),this.windowY=Math.round(this.windowY*this.frameScale),this.windowW=Math.round(this.windowW*this.frameScale),this.windowH=Math.round(this.windowH*this.frameScale),this.windowScale=Math.max(this.windowW/this.windowTexture.width,this.windowH/this.windowTexture.height),this.frameSprite.scale.x=this.frameSprite.scale.y=this.frameScale*this.scaleOffsetFactor,this.windowSprite.texture=this.windowTexture,this.windowSprite.scale.x=this.windowSprite.scale.y=this.windowScale,this.windowSprite.x=this.windowX+this.windowW/2,this.windowSprite.y=this.windowY+this.windowH/2,this.windowMask.texture.resize(this.windowW+2*this.smoothPadding,this.windowH+2*this.smoothPadding),this.windowMask.x=this.windowX-this.smoothPadding,this.windowMask.y=this.windowY-this.smoothPadding,BFN.graphics.drawShape("roundedRect",this.windowMask.texture,{fillColor:4294967295,edgePadding:0,paddingX:this.smoothPadding,paddingY:this.smoothPadding}),this.updateSmoothing(),this._itemWidth=this.frameW,this._itemHeight=this.frameH,this.dispatchEvent(BFN.FrameDisplayEvents.FRAME_UPDATED),BFN.MainUI.requestRender()},me.prototype.updateSmoothing=function(){this.frameSprite.currentScale=this.frameScale*this.scaleOffsetFactor*this._scale,this.windowSprite.currentScale=this.windowScale*this._scale,this.windowMask.currentScale=this.windowScale*this._scale,BFN.MainUI.requestRender()},me.prototype.resetFrame=function(){this.setColor(-1),this.setOpacity(1),this.setBlendMode(BFN.CONST.BLEND_MODES.NORMAL),this.setPosition(0),this.frameAngle=0,this.frameTextureSprite.x=this.frameTextureSprite.y=0,this.frameTextureSprite.scale.x=this.frameTextureSprite.scale.y=1,this.updateFrame(),this.updateFrameOrientation(),this.updateFrameTexture()},me.prototype.setColor=function(e,t){t=null!=t&&null!=t&&t>=0?t:1,e>=0?(this.colorOverlayFilter.color=e,this.colorOverlayFilter.intensity=t,this.frameTextureSprite.filters=[this.colorOverlayFilter]):this.frameTextureSprite.filters=[],this.updateFrameTexture()},me.prototype.setOpacity=function(e){this.frameSprite.alpha=e,BFN.MainUI.requestRender()},me.prototype.setBlendMode=function(e){this.frameSprite.blendMode=e,BFN.MainUI.requestRender()},me.prototype.setPosition=function(e){var t=(this.windowSprite.texture.width*this.windowSprite.scale.x-this.windowW)/2/this.windowSprite.texture.width,i=(this.windowSprite.texture.height*this.windowSprite.scale.y-this.windowH)/2/this.windowSprite.texture.height;this.windowSprite.anchor.x=.5-t*e,this.windowSprite.anchor.y=.5-i*e,BFN.MainUI.requestRender()},me.prototype.rotateCounterClockwise=function(){this.frameAngle=(this.frameAngle-90+360)%360,this.updateFrame(),this.updateFrameOrientation()},me.prototype.rotateClockwise=function(){this.frameAngle=(this.frameAngle+90)%360,this.updateFrame(),this.updateFrameOrientation()},me.prototype.flipHorizontal=function(){this.frameAngle%180?(this.frameTextureSprite.scale.y*=-1,this.frameTextureSprite.y=this.frameTextureSprite.scale.y>0?0:this.frameTextureSprite.texture.height):(this.frameTextureSprite.scale.x*=-1,this.frameTextureSprite.x=this.frameTextureSprite.scale.x>0?0:this.frameTextureSprite.texture.width),this.updateFrame(),this.updateFrameTexture()},me.prototype.flipVertical=function(){this.frameAngle%180?(this.frameTextureSprite.scale.x*=-1,this.frameTextureSprite.x=this.frameTextureSprite.scale.x>0?0:this.frameTextureSprite.texture.width):(this.frameTextureSprite.scale.y*=-1,this.frameTextureSprite.y=this.frameTextureSprite.scale.y>0?0:this.frameTextureSprite.texture.height),this.updateFrame(),this.updateFrameTexture()},me.prototype.updateFrameTexture=function(){try{BFN.Stage.render(this.frameTextureSprite,this.frameSprite.texture),BFN.MainUI.requestRender()}catch(e){}},me.prototype.updateFrameOrientation=function(){switch(this.frameAngle){case 0:this.frameSprite.x=0,this.frameSprite.y=0;break;case 90:this.frameSprite.x=this.itemWidth,this.frameSprite.y=0;break;case 180:this.frameSprite.x=this.itemWidth,this.frameSprite.y=this.itemHeight;break;case 270:this.frameSprite.x=0,this.frameSprite.y=this.itemHeight}this.frameSprite.rotation=this.frameAngle*(Math.PI/180),BFN.MainUI.requestRender()},me.prototype.handleGraphicComplete=function(e){if(this.graphicLoader.removeEventListener(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type,this.handleGraphicCompleteBind),this.isThumb)this.frameTextureSprite.texture=e.data.graphic.renderClone();else{var t=PIXI.RenderTexture.create(e.data.graphic.width+2*this.smoothPadding,e.data.graphic.height+2*this.smoothPadding);t.copyPixels(e.data.graphic,new PIXI.Point(this.smoothPadding,this.smoothPadding),!1),this.frameTextureSprite.texture=t}this.frameSprite.texture=this.frameTextureSprite.texture.renderClone(),this.frameSprite.anchor.x=this.isThumb?0:this.smoothPadding/this.frameSprite.texture.width,this.frameSprite.anchor.y=this.isThumb?0:this.smoothPadding/this.frameSprite.texture.height,this.graphicLoader.reset(),this.dispatchEvent(BFN.FrameDisplayEvents.FRAME_LOADED),BFN.MainUI.requestRender()},me.prototype.handleMainUIPreRender=function(e){this.renderPending&&(this.renderPending=!1,BFN.Stage.render(this.displayContainer,this.displayTexture))},Object.defineProperty(me.prototype,"canvasScale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(me.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(me.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.FrameDisplay=me,BFN.ImagePainterRegionVO=function(){this.originPoint=new PIXI.Point,this.undoRegionTexture=null,this.redoRegionTexture=null,this.totalPixels=0},BFN.GlobalHistoryVO=function(){this.timestamp=0,this.historyTag=null,this.thumbImage=null,this.previewImage=null,this.isText=!1,this.isGroup=!1,this.useTextIcon=!1,this.useGroupIcon=!1},BFN.HistoryVO=function(){this.id=-1,this.name=null,this.historyAction=null,this.timestamp=Date.now(),this.imageTexture=null,this.imageW=0,this.imageH=0,this.thumbTexture=null,this.thumbImage=null,this.thumbW=0,this.thumbH=0,this.previewTexture=null,this.previewImage=null,this.previewW=0,this.previewH=0},BFN.TransformItemStateVO=function(){this.parent=null,this.zIndex=null,this.locked=!1,this.creationTime=performance.now(),this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.accurateBounds=null,this.basicShapeValues=null,this.shapeColorMap=null,this.opacity=1,this.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.tint=-1,this.overlayColor=-1,this.overlayColorIntensity=0,this.flippedHorizontal=!1,this.flippedVertical=!1,this.text=null,this.textStyle=null,this.textWidth=0,this.textScale=1,this.textItemScale=1,this.textBackgroundColor=-1,this.textBackgroundIntensity=1,this.textBackgroundPadding=0,this.imageID=null,this.imageTexture=null,this.maskImageFrameWidth=0,this.maskImageFrameHeight=0,this.maskImageOffsetFactorX=.5,this.maskImageOffsetFactorY=.5,this.maskImageTextureScale={x:1,y:1},this.collageSettings={},this.designerSettings={}},BFN.TransformItemTransitionVO=function(){this.id=null,this.batchID=null,this.batchIDPlaceholder=null,this.timestamp=Date.now(),this.transformItem=null,this.startState=new BFN.TransformItemStateVO,this.endState=new BFN.TransformItemStateVO,this.isCreateTransition=!1,this.isGroupTransition=!1,this.isSettingsTransition=!1,this.useGroupIcon=!1,this.useTextIcon=!1,this.alternateHistoryAction=null,this.previewTexture=null,this.previewImage=null,this.thumbTexture=null,this.thumbImage=null},BFN.TransformItemGroupVO=function(){this.id=null,this.name=null,this.itemIDs=[]},BFN.UploadVO=function(){this.url=null,this.width=0,this.height=0,this.size=0,this.resizedUrl=null,this.resizedWidth=0,this.resizedHeight=0,this.resizedSize=0},BFN.ArtsyImageVO=function(){this.url=null,this.width=0,this.height=0,this.size=0,this.renderedTexture=null},BFN.LensFlareAssetVO=function(){this.categoryID=null,this.assetID=null,this.static=!1,this.imageURL=null,this.thumbURL=null,this.imageTexture=null,this.thumbTexture=null},BFN.LensFlarePresetVO=function(){this.presetID=null,this.presetName=null,this.isPlus=!1,this.elementVOs=[]},BFN.LensFlareElementVOConstants={propertyOrder:["assetID","active","color","colorGlobal","colorGlobalGroup","blendMode","intensityFactor","intensityFactorGlobal","sizeFactor","sizeFactorGlobal","rotationOffset","rotationLock","stretchXFactor","stretchYFactor","sourceDistanceFactor","centerDistanceFactor"],defaultProperties:{assetID:null,active:!0,color:-1,colorGlobal:-1,colorGlobalGroup:0,blendMode:"screen",intensityFactor:1,intensityFactorGlobal:0,sizeFactor:1,sizeFactorGlobal:0,rotationOffset:0,rotationLock:!1,stretchXFactor:1,stretchYFactor:1,sourceDistanceFactor:0,centerDistanceFactor:0}},BFN.LensFlareElementVOEvents={ASSET_UPDATED:new Event("ASSET_UPDATED"),PROPERTY_UPDATED:new Event("PROPERTY_UPDATED"),POSITION_UPDATED:new Event("POSITION_UPDATED")},pe.prototype=Object.create(BFN.EventDispatcher.prototype),pe.prototype.init=function(){this.initDefaultValues()},pe.prototype.initDefaultValues=function(){for(var e in this.properties={},BFN.LensFlareElementVOConstants.defaultProperties)this.properties[e]=BFN.LensFlareElementVOConstants.defaultProperties[e]},pe.prototype.setProperty=function(e,t){this.properties.hasOwnProperty(e)&&(this.properties[e]=t,"assetID"==e||"color"==e||"colorGlobal"==e?this.dispatchEvent(BFN.LensFlareElementVOEvents.ASSET_UPDATED):"sourceDistanceFactor"==e||"centerDistanceFactor"==e?this.dispatchEvent(BFN.LensFlareElementVOEvents.POSITION_UPDATED):this.dispatchEvent(BFN.LensFlareElementVOEvents.PROPERTY_UPDATED))},pe.prototype.getProperty=function(e){return this.properties.hasOwnProperty(e)?this.properties[e]:null},pe.prototype.clone=function(){var e=new BFN.LensFlareElementVO;for(var t in this.properties)e.properties[t]=this.properties[t];return e},BFN.LensFlareElementVO=pe,Object.defineProperties(ge.prototype,{pl:{get(){return this.X34kgHS12YTuViYZ},set(e){1==this.isCfrmInner&&(this.isCfrmInner=!1,this.X34kgHS12YTuViYZ=e)}}}),BFN.UserVO=ge;function fe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.timestamp=e,this.baseTextures=[]}function ve(){this.originalName=null,this.originalTransparent=!1,this.name=null,this.extension=null,this.imageBlob=null,this.imageW=0,this.imageH=0,this.thumbSRC=null,this.thumbTexture=null,this.thumbW=0,this.thumbH=0,this.backgroundColor=-1,this.imageType="jpg",this.resizeData={},this.cropData={},this.actions=null}function ye(){this.active=!0,this.eventID=null,this.eventObject=null,this.superObject=null,this.peopleObject=null,this.actionSection=null,this.actionTimestamp=null,this.transformItem=null,this.transformItems=null}function xe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type=BFN.BasicShapeManager.validShapeTypes.includes(e)?e:"ellipse",this.fill="FFFFFF",this.fillAlpha=1,this.stroke="000000",this.strokeAlpha=1,this.strokeWidth=10,this.shape=new PIXI.Graphics,this.shapeW=64,this.shapeH=64,this.attributes={},this.maxShapeSize=BFN.maxImageSize,this.fitScale=1,"line"===e&&(this.shapeH=Math.max(20,t.hasOwnProperty("strokeWidth")?t.strokeWidth:this.strokeWidth)),"arrow"===e&&(this.shapeH/=2),this.setValues(t)}BFN.MenuImageVO=class{constructor(){this.name=null,this.extension=null,this.id=null,this.indexedDBKey=null,this.imageURL=null,this.imageTexture=null,this.imageWidth=null,this.imageHeight=null,this.thumbURL=null,this.thumbTexture=null,this.thumbWidth=null,this.thumbHeight=null,this.isRemovable=!0,this.isSaved=!1,this.isTransparent=!1,this.isSVG=!1,this.date=null,this.isPattern=!1,this.author=null,this.authorURL=null}createId(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BeFunky.randomString(10);if(!BFN.imageTypes.includes(e))throw new Error("Invalid MenuImageVO type: ".concat(BeFunky.stringValue(e)));return this.id="".concat(e,"_").concat(t),this.id}hasUsableTexture(){return this.imageTexture&&this.imageTexture.valid&&this.imageTexture.baseTexture&&!this.imageTexture.baseTexture._destroyed}getObject(){return Object.assign({},this,{imageTexture:null})}setObject(e){var t=Object.keys(this);t.push("isPlus","trackingID"),t.forEach(t=>{e.hasOwnProperty(t)&&(this[t]=e[t])})}},BFN.TemplateVO=function(){this.name=null,this.categoryID=null,this.isPlus=null,this.preset=null,this.spritePosition=null,this.menuItems=[]},BFN.TemplateCategoryVO=function(){this.id=null,this.name=null,this.graphic=null,this.templateVOs=[]},BFN.PhotoGridSnapshotChildVO=function(){this.rect=new BFN.Rectangle,this.texture=null,this.offsetFactorX=.5,this.offsetFactorY=.5,this.rotate=0,this.textureScale=1,this.menuImageVO=null},BFN.PhotoGridSnapshotVO=function(){this.historyAction=null,this.snapshotWidth=0,this.snapshotHeight=0,this.gridWidth=0,this.gridHeight=0,this.rounding=0,this.gap=0,this.backgroundColor="FFFFFF",this.backgroundPatternBaseTexture=null,this.timestamp=Date.now(),this.thumbTexture=null,this.thumbImage=null,this.previewTexture=null,this.previewImage=null,this.snapshotChildren=[]},BFN.ProjectVO=function(){this.filename=null,this.time=Date.now(),this.sourceTemplateID=null,this.version=null,this.section=null,this.thumbBase64=null,this.projectWidth=0,this.projectHeight=0,this.printDPI=null,this.editorImageBase64=null,this.collageFreeform=!1,this.collageBackgroundColor=-1,this.collageBackgroundPatternBase64=null,this.collageGridWidth=0,this.collageGridHeight=0,this.collageRounding=0,this.collageGap=0,this.collageGridChildren=[],this.designerBackgroundColor=-1,this.transformGraphics=[],this.transformImages=[],this.transformMaskImages=[],this.transformLabels=[],this.transformGroups=[],this.transformGuides=[],this.transformGuidesLocked=!1,this.imageDataKeys=[],this.imageData={},this.svgDataKeys=[],this.svgData={}},BFN.ProjectItemVO=function(){this.itemID=null,this.type=null,this.layerName=null,this.layerNum=-1,this.basicShapeValues=null,this.graphicID=null,this.graphicStyle=null,this.shapeColorMap=null,this.imageID=null,this.isGoodie=!1,this.maskImageID=null,this.maskImageMaskID=null,this.maskImageMaskFlippedHorizontal=!1,this.maskImageMaskFlippedVertical=!1,this.maskImageFrameWidth=0,this.maskImageFrameHeight=0,this.maskImageOffsetFactorX=.5,this.maskImageOffsetFactorY=.5,this.maskImageTextureScale=1,this.labelText="",this.labelTextStyles={},this.labelWidth=0,this.labelTextScale=1,this.labelTextItemScale=1,this.labelTextBackgroundColor=-1,this.labelTextBackgroundIntensity=1,this.labelTextBackgroundPadding=0,this.labelWordBreaksEnabled=!1,this.gridCellImageID=null,this.gridCellRect=null,this.gridCellTextureOffsetFactorX=.5,this.gridCellTextureOffsetFactorY=.5,this.gridCellTextureRotate=0,this.gridCellTextureScale=1,this.gridCellTextureTint=-1,this.transformZIndex=0,this.transformLocked=!1,this.transformX=0,this.transformY=0,this.transformRotation=0,this.transformScaleX=1,this.transformScaleY=1,this.transformWidth=0,this.transformHeight=0,this.transformFlippedHorizontal=!1,this.transformFlippedVertical=!1,this.transformOpacity=100,this.transformBlendMode=0,this.transformOverlayColor=-1,this.transformOverlayColorIntensity=0,this.transformTintColor=-1},fe.prototype.addUsedTexture=function(e,t){e&&e.baseTexture&&!this.baseTextures.includes(e.baseTexture)&&this.baseTextures.push(e.baseTexture)},fe.prototype.addUsedBaseTexture=function(e,t){e&&!this.baseTextures.includes(e)&&this.baseTextures.push(e)},fe.prototype.clear=function(){this.baseTextures.splice(0)},BFN.TextureHistoryVO=fe,ve.prototype.addAction=function(e){e&&"string"==typeof e&&(this.actions||(this.actions=[]),this.actions.includes(e)||this.actions.push(e))},BFN.BatchImageVO=ve,ye.prototype.register=function(){this.isValid&&BFN.UserActionManager.registerUserAction(this)},ye.prototype.track=function(){this.isValid&&window.bfn_mp&&BFN.UserActionManager.isTrackable&&(window.bfn_mp.track(this.eventID,this.eventObject,this.superObject,this.peopleObject),console.log("Mixpanel tracked: ".concat(this.eventID),this.eventObject))},Object.defineProperty(ye.prototype,"isValid",{get(){return!!(this.eventID&&window.bfn_mp&&window.bfn_mp.property_map.hasOwnProperty(this.eventID))}}),BFN.UserActionVO=ye,xe.prototype.setValues=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.type=e.hasOwnProperty("type")&&BFN.BasicShapeManager.validShapeTypes.includes(e.type)?e.type:this.type,this.fill=e.hasOwnProperty("fill")?e.fill:this.fill,this.fillColor=-1!==this.fill?parseInt("0x"+this.fill):null,this.fillAlpha=e.hasOwnProperty("fillAlpha")?e.fillAlpha:this.fillAlpha,this.stroke=e.hasOwnProperty("stroke")?e.stroke:this.stroke,this.strokeColor=-1!==this.stroke?parseInt("0x"+this.stroke):null,this.strokeAlpha=e.hasOwnProperty("strokeAlpha")?e.strokeAlpha:this.strokeAlpha,this.strokeWidth=e.hasOwnProperty("strokeWidth")?e.strokeWidth:this.strokeWidth;var t=(t,i)=>{this.attributes[t]=e.hasOwnProperty(t)?e[t]:this.attributes.hasOwnProperty(t)?this.attributes[t]:i};switch(this.type){case"line":t("lineStyle","solid"),t("lineSegmentWidth",3),t("lineGapSize",.5);break;case"rectangle":t("rectangleCornerRounding",0);break;case"polygon":t("polygonSides",6),t("polygonShiftOrientation",!1);break;case"star":t("starPoints",5),t("starInsetWeight",.5),t("starShiftOrientation",!1);break;case"arrow":t("arrowStyle","thick"),t("arrowWeight",.25),t("arrowDoubleSided",!1)}this.drawShape()},xe.prototype.getValues=function(){var e={type:this.type,fill:this.fill,fillAlpha:this.fillAlpha,stroke:this.stroke,strokeAlpha:this.strokeAlpha,strokeWidth:this.strokeWidth};return Object.assign(e,this.attributes),e},xe.prototype.resize=function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&t?(e=Math.abs(e),t=Math.abs(t),this.fitScale=Math.min(1,this.maxShapeSize/Math.max(e,t)),this.shapeW=Math.round(this.fitScale*e),this.shapeH=Math.round(this.fitScale*t),i&&this.drawShape()):this.shape.clear()},xe.prototype.drawShape=function(){"group"!==this.type&&BFN.BasicShapeManager.drawShape(this)},xe.prototype.updateTexture=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e&&t&&i)if(t=Math.abs(t),i=Math.abs(i),this.shapeW==t&&this.shapeH==i||this.resize(t,i,!1),e.width==this.shapeW&&e.height==this.shapeH||e.resize(this.shapeW,this.shapeH),this.drawShape(),r){var a=this.getCanvasTexture(),n={x:(e.width-a.width)/2,y:(e.height-a.height)/2};e.copyPixels(a,n),a.destroyGC(!0)}else BFN.Stage.render(this.shape,e)},xe.prototype.getCanvasTexture=function(){return BFN.BasicShapeManager.dummyTexture||(BFN.BasicShapeManager.dummyTexture=PIXI.RenderTexture.create(16,16)),BFN.Stage.render(this.shape,BFN.BasicShapeManager.dummyTexture),this.shape.generateCanvasTexture()},xe.prototype.clone=function(){return new BFN.BasicShapeVO(this.type,this.getValues())},BFN.BasicShapeVO=xe;var _e,Ie,Te=BeFunky.loggingFlags.includes("blob_perf"),be={},Se=Te?e=>{be[e]=Date.now()}:()=>{},Ce=Te?e=>{BeFunky.logFeature("blob_perf",e,Date.now()-be[e]),delete be[e]}:()=>{};BFN.BlobUtils={blobToBase64:(e,t)=>BFN.BlobUtils.fileReader("readAsDataURL",e,t),blobToArrayBuffer:(e,t,i)=>{BFN.BlobUtils.fileReader("readAsArrayBuffer",e,i).then(e=>t({arrayBuffer:e}),e=>t({error:"Unable to read blob as array buffer: ".concat(BeFunky.stringValue(e))}))},blobToText:(e,t,i)=>{BFN.BlobUtils.fileReader("readAsText",e,i).then(e=>t({text:e}),e=>t({error:"Unable to read blob as string: ".concat(BeFunky.stringValue(e))}))},blobToBinaryString:(e,t,i)=>{BFN.BlobUtils.fileReader("readAsBinaryString",e,i).then(e=>t({binaryString:e}),e=>t({error:"Unable to read blob as binary string: ".concat(BeFunky.stringValue(e))}))},blobToImage(e,t){var i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).cleanUpMemory,r=void 0===i||i,a=e.type.startsWith("image/svg+xml"),n="Blob ".concat(e.name?"".concat(e.name," "):"").concat(BeFunky.formatBytes(e.size)," -> ImageBitmap");BeFunky.isImageBitmapSupported&&!a?(Se(n),createImageBitmap(e).then(e=>{Ce(n),t({imageBitmap:e}),r&&e.close()},i=>{Ce(n),BeFunky.logError("Unable to create ImageBitmap from blob:",i,"\nFalling back to Image Element w/ object URL"),BFN.BlobUtils.blobToImageElement(e,t,{cleanUpMemory:r})})):BFN.BlobUtils.blobToImageElement(e,t,{cleanUpMemory:r})},blobToImageElement(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.cleanUpMemory,a=void 0===r||r,n=i.isSvgSanitized,o=void 0!==n&&n,s=new Image,l=1,h="",c="Blob ".concat(e.name?"".concat(e.name," "):"").concat(BeFunky.formatBytes(e.size)," -> ImageElement");function u(){try{h=URL.createObjectURL(e)}catch(e){return BeFunky.logError("Unable to create object URL from blob",e),t({error:e})}s.src=h}Se(c),s.onerror=(e=>{Ce(c),URL.revokeObjectURL(h),l<3?(BeFunky.logError("Unable to load image from object URL on attempt #".concat(l,". Trying again...")),l++,BFN.MainUI.addIdleRenderFunction(u)):(BeFunky.logError("Unable to load image from object URL after ".concat(3," attempts"),e),t({error:e}))}),s.onload=(()=>{Ce(c),BeFunky.isFirefox&&!o&&!s.naturalWidth&&e.type.startsWith("image/svg+xml")?(URL.revokeObjectURL(h),BeFunky.logError("Re-attempting SVG -> Image conversion in Firefox b/c resulting image is missing dimensions"),BFN.BlobUtils.blobToText(e,e=>{var i=e.text,r=e.error;if(r)return t({error:r});var n=BFN.SVGManager.sanitizeSVG(i);if(!n)return t({error:"Unable to parse SVG"});var o=new Blob([n],{type:"image/svg+xml"});BFN.BlobUtils.blobToImageElement(o,t,{cleanUpMemory:a,isSvgSanitized:!0})})):t({imageElement:s}),a&&URL.revokeObjectURL(h),s.onerror=void 0}),u()},getOrientationAndEXIF:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i={orientation:1,exif:void 0};return new Promise(a=>{if("image/jpeg"!==e.type)return a(i);BFN.ExifTool.load(e,n=>{var o=n.error,s=n.exif;if(o)return BeFunky.logError("Unable to read EXIF data from Blob:",BeFunky.stringValue(o)),t?a(i):function(t){var i=Date.now();!function(t){BFN.BlobUtils.blobToArrayBuffer(e,e=>{var i=e.error,r=e.arrayBuffer;if(i)return t(-3);var a=new DataView(r);if(65496!==a.getUint16(0,!1))return t(-2);for(var n=a.byteLength,o=2;o<n;){if(a.getUint16(o+2,!1)<=8)return t(-1);var s=a.getUint16(o,!1);if(o+=2,65505===s){if(1165519206!==a.getUint32(o+=2,!1))return t(-1);var l=18761===a.getUint16(o+=6,!1);o+=a.getUint32(o+4,l);var h=a.getUint16(o,l);o+=2;for(var c=0;c<h;c++)if(274===a.getUint16(o+12*c,l))return t(a.getUint16(o+12*c+8,l))}else{if(65280!=(65280&s))break;o+=a.getUint16(o,!1)}}return t(-1)},{timeoutMs:2e3,reportErrors:!1})}(a=>{var n=r(a);return BeFunky.logError("Blob size = ".concat(BeFunky.formatBytes(e.size),". Detected orientation = ").concat(a,". Time = ").concat(Date.now()-i,"ms")),n===a?BeFunky.logError("Orientation fallback was successful"):BeFunky.logError("Orientation fallback failed"),t({orientation:n,exif:void 0})})}(a);if(!s)return a(i);try{var l=r(BFN.ExifTool.getOrientation(s));return a({orientation:l,exif:s})}catch(e){return a(i)}})});function r(e){return Number.isInteger(e)?e<1||e>8?1:e:1}},base64ToBlob:e=>{for(var t=e.split(","),i=t[0].includes("base64")?atob(t[1]):decodeURIComponent(t[1]),r=t[0].split(":")[1].split(";")[0],a=new Uint8Array(i.length),n=0;n<i.length;n++)a[n]=i.charCodeAt(n);return new Blob([a],{type:r})},fileReader:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.timeoutMs,a=void 0===r?15e3:r,n=i.reportErrors,o=void 0===n||n,s=new FileReader;return new Promise((i,r)=>{if(!(t instanceof Blob))throw new Error("".concat(BeFunky.stringValue(t)," passed to FileReader"));var n;a>9e3&&(n=setTimeout(()=>{console.log("Blob size: ".concat(BeFunky.formatBytes(t.size),"  Blob type: ").concat(t.type)),console.log("FileReader readystate:",s.readyState);var i="FileReader ".concat(e," took over 9 seconds");o?BeFunky.throwError(i):BeFunky.logError(i)},9e3));var l=!1,h=setTimeout(()=>{l=!0,console.log("Blob size: ".concat(BeFunky.formatBytes(t.size),"  Blob type: ").concat(t.type)),console.log("FileReader readystate:",s.readyState);var i="FileReader ".concat(e," timed out after ").concat(a,"ms");o?BeFunky.reportWarning(i):BeFunky.logError(i),s.abort(),r(new Error(i))},a);s.onload=(()=>c({result:s.result})),s.onerror=(e=>c({error:e}));try{s[e](t)}catch(e){c({error:e})}function c(e){var t=e.result,s=e.error;if(clearTimeout(n),clearTimeout(h),!l)return t?i(t):r(s);var c="FileReader called ".concat(t?"onload":"onerror"," after ").concat(a,"ms timeout rejected Promise. Consider increasing timeout period.");o?BeFunky.throwError(c):BeFunky.logError(c)}})},downsizeImageBlob(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.maxSize,a=void 0===r?BFN.maxImageSizeLayer:r,n=i.quality,o=void 0===n?.95:n,s=i.skipSmallImages,l=void 0===s||s,h=Date.now(),c=new Promise((t,i)=>{this.blobToImageElement(e,e=>{var r=e.error,a=e.imageElement;r?i(r):t(a)})}),u=BeFunky.safariVersion>=13.1||BeFunky.chromiumVersion>=81||BeFunky.firefoxVersion>=77?Promise.resolve({orientation:1}):this.getOrientationAndEXIF(e,!0);return Promise.all([c,u]).then(i=>{var r=t(i,2),n=r[0],s=r[1].orientation,c=n.naturalWidth,u=n.naturalHeight,d="".concat(e.size/1e6,"MB (").concat(c," x ").concat(u,")"),m=Math.min(a/c,a/u);if(m>=1){if(l)throw console.log('Blob "'.concat(e.name,'" ').concat(d," is already smaller than maxSize (").concat(a,"px). Skipping downsizing...")),"skipped_small_image";console.log('Blob "'.concat(e.name,'" ').concat(d," is smaller than maxSize (").concat(a,"px), but will still be compressed to desired quality.")),m=1}var p=document.createElement("canvas"),g=p.getContext("2d"),f=Math.round(c*m),v=Math.round(u*m);return function(e,t,i,r,a){[5,6,7,8].includes(i)?(e.width=a,e.height=r):(e.width=r,e.height=a);var n={2:()=>t.transform(-1,0,0,1,r,0),3:()=>t.transform(-1,0,0,-1,r,a),4:()=>t.transform(1,0,0,-1,0,a),5:()=>t.transform(0,1,1,0,0,0),6:()=>t.transform(0,1,-1,0,a,0),7:()=>t.transform(0,-1,-1,0,a,r),8:()=>t.transform(0,-1,1,0,0,r)};n[i]&&n[i]()}(p,g,s,f,v),g.mozImageSmoothingEnabled=!0,g.imageSmoothingQuality="medium",g.webkitImageSmoothingEnabled=!0,g.msImageSmoothingEnabled=!0,g.imageSmoothingEnabled=!0,g.drawImage(n,0,0,f,v),this.canvasToBlob(p,e.type,o).then(t=>{var i="".concat(t.size/1e6,"MB (").concat(p.width," x ").concat(p.height,")");return console.log('Blob "'.concat(e.name,'" resized ').concat(d," -> ").concat(i," in ").concat(Date.now()-h,"ms ").concat("image/jpeg"===e.type?"at ".concat(100*o,"% quality"):"")),t})})},canvasToBlob:(e,t,i)=>new Promise((r,a)=>{e.toBlob(e=>{e instanceof Blob?r(e):a("canvas_to_blob_failed")},t,i)})};class Be{constructor(){this.init()}init(){}getJSON(e,t){var i="".concat(e).concat(e.includes("?")?"&":"?","nocache=").concat(Math.random().toString().split(".")[1]),r={fallbackURLs:[i]};BeFunky.request(e,r,r=>{var a=r.error,n=r.response;return a?("request_failed"!==a&&(console.log({url:e,noCacheURL:i}),BeFunky.throwError("Unable to get valid JSON from server: ".concat(a))),t({error:a})):t({response:n})})}getBlob(e,t){return BeFunky.request(e,{responseType:"blob"},e=>{var i=e.response,r=e.error;return r?t({error:r}):i instanceof Blob?i.size?void t({blob:i}):(BeFunky.logError("Server responded with an empty Blob"),t({error:"invalid_response"})):(BeFunky.logError("Blob requested but server retured a different type of response"),t({error:"invalid_response"}))})}getTexture(e,t,i){BFN.RequestUtils.getBlob(e,e=>{var r=e.error,a=e.blob;if(r)return i({error:r});BFN.TextureUtils.blobOrBase64ToTexture(a,e=>{var t=e.texture,r=e.error;if(r)return i({error:r});i({texture:t})},t)})}getBlobWithFallback(e,t,i){this.getBlob(e,e=>{var r=e.blob;r?i({blob:r}):this.getBlob(t,i)})}getBase64(e,t){this.getBlob(e,e=>{var i=e.blob,r=e.error;if(r)return t({error:r});BFN.BlobUtils.blobToBase64(i).then(e=>t({base64:e}),e=>t({error:e}))})}getBase64WithFallback(e,t,i){this.getBase64(e,e=>{var r=e.base64;r?i({base64:r}):this.getBase64(t,i)})}getText(e,t){BeFunky.request(e,{responseType:"blob"},e=>{var i=e.response,r=e.error;if(r)return t({error:r});BFN.BlobUtils.blobToText(i,t)})}loadScript(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!1;return BeFunky.loadScript("".concat(BFN.jsURL).concat(e),t)}}BFN.SingletonQueue.add(()=>{BFN.RequestUtils=new Be});var Fe,Ee=BeFunky.loggingFlags.includes("texture_perf"),Pe={},Ne=Ee?e=>{Pe[e]=Date.now()}:()=>{},Me=Ee?e=>{BeFunky.logFeature("texture_perf",e,Date.now()-Pe[e]),delete Pe[e]}:()=>{};BFN.TextureUtils={setupReusableImageTexture(){_e=BFN.renderTexturesPool[1].texture,BFN.Stage.uploadTextureData(_e.baseTexture)},blobOrBase64ToTexture(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.textureSize,a=void 0===r?BFN.maxImageSizeLayer:r,n=i.readEXIF,o=void 0===n||n;if(!e)return BeFunky.logError("No blob or base64 provided"),t({error:"No blob or base64 provided"});var s=e;if("string"==typeof e)try{s=BFN.BlobUtils.base64ToBlob(e)}catch(e){return t({error:"Unable to convert base64 to blob: ".concat(e)})}var l=o?BFN.BlobUtils.getOrientationAndEXIF(s):Promise.resolve({orientation:1,exif:void 0});BFN.BlobUtils.blobToImage(s,e=>{var i=e.error,r=e.imageBitmap,n=e.imageElement;if(i)return t({error:i});var o=r?r.width:n.naturalWidth,h=r?r.height:n.naturalHeight,c=s.type.startsWith("image/svg+xml"),u=BFN.TextureUtils.imageToTexture(r||n,{textureSize:a,scaleUp:c,couldBeTransparent:"image/jpeg"!==s.type});Math.min(u.width,u.height)<BFN.minImageSize&&BeFunky.throwError("Texture is too small","Dimensions = ".concat(u.width," x ").concat(u.height,". Blob type = ").concat(s.type)),l.then(e=>{var i=e.orientation,a=e.exif,s=n&&(BeFunky.safariVersion>=13.1||BeFunky.chromiumVersion>=81||BeFunky.firefoxVersion>=77)||r&&(BeFunky.chromiumVersion>=84||BeFunky.firefoxVersion>=77);if(1===i||s)return t({texture:u,exif:a,imageWidth:o,imageHeight:h});var l=u.width;if(BFN.Util.orientTexture(u,i),u.width!==l){var c=o;o=h,h=c}return t({texture:u,exif:a,imageWidth:o,imageHeight:h})})})},imageToTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.textureSize,r=void 0===i?BFN.maxImageSizeLayer:i,a=t.scaleUp,n=void 0!==a&&a,o=t.couldBeTransparent,s=void 0===o||o,l=BFN.Stage.gl.getParameter(BFN.Stage.gl.MAX_TEXTURE_SIZE)||BFN.maxImageSize,h=e instanceof HTMLImageElement?e.naturalWidth:e.width,c=e instanceof HTMLImageElement?e.naturalHeight:e.height,u=Math.max(h,c),d="".concat(e instanceof HTMLImageElement?"ImageElement":"ImageBitmap"," ").concat(h," x ").concat(c," -> Texture");Ne(d),r=Math.min(r,l),n||(r=Math.min(r,u));var m=h/c,p=(r=Math.max(r,Math.ceil(BFN.minImageSize*(m>1?m:1/m))))/u;if(1!==p&&BeFunky.Params.IS_LC&&console.log("Scaling ".concat(p>1?"up":"down"," image ").concat(p.toFixed(1),"x"),{width:h,height:c},"->",{width:Math.round(h*p),height:Math.round(c*p)}),e instanceof HTMLImageElement||u>l){var g=document.createElement("canvas"),f=g.getContext("2d");g.width=Math.round(h*p),g.height=Math.round(c*p),f.drawImage(e,0,0,g.width,g.height);var v=!0;if(!s&&BeFunky.chromiumVersion>=87)f.getImageData(0,0,1,1).data.every(e=>0===e)&&(u<=l?(v=!1,BeFunky.reportWarning("drawImage failed due to Chromium bug - rendering directly to texture")):BeFunky.throwError("drawImage failed due to Chromium bug - image too large"));var y=v?PIXI.Texture.fromCanvas(g):new PIXI.Texture(new PIXI.BaseTexture(e));_e.resize(g.width,g.height,!1),_e.frame=new PIXI.Rectangle(0,0,_e.width,_e.height),v?_e.copyPixels(y):_e.copyPixels(y,null,null,null,{x:g.width/y.width,y:g.height/y.height}),y.destroyGC(!0)}else{var x=new PIXI.Texture(new PIXI.BaseTexture(e)),_=Math.floor(x.width*p),I=Math.floor(x.height*p);_e.resize(_,I,!1),_e.frame=new PIXI.Rectangle(0,0,_e.width,_e.height),_e.copyPixels(x,null,null,null,{x:_/x.width,y:I/x.height}),x.destroyGC(!0)}var T=PIXI.RenderTexture.create(_e.width,_e.height);return T.copyPixels(_e),_e.resize(512,512),Me(d),T},svgStringToTexture(e,t){var i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).textureSize,r=void 0===i?BFN.maxImageSizeLayer:i;if("string"!=typeof e)return BeFunky.logError("Invalid svgString provided: ".concat(BeFunky.getType(e))),t({error:"Invalid svgString provided"});BFN.SVGManager.getSVGShape(e,i=>{var a=BFN.SVGManager.getTexture(i,()=>{if(i.width&&i.height){var n=i.width/i.height,o=n>1?r:r*n,s=n<1?r:r/n;return BFN.SVGManager.updateTexture(a,1,1,o,s),t({texture:a})}BeFunky.logError("Unable to convert SVG to Fabric Shape. Falling back to rendering it in an ImageElement");var l=new Blob([e],{type:"image/svg+xml"});BFN.TextureUtils.blobOrBase64ToTexture(l,t,{textureSize:r,readEXIF:!1})})},null,!0)},textureToBlob(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.validateQualityAndMimeType(t),r=i.isTransparent,a=i.quality,n=i.mimeType,o=BFN.TextureUtils.textureToCanvas(e,{isTransparent:r});return new Promise(e=>{o.toBlob(e,n,a)})},textureToBlobWithErrorHandling(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((i,r)=>{var a=this.validateQualityAndMimeType(t),n=a.isTransparent,o=a.quality,s=a.mimeType;BFN.TextureUtils.textureToCanvas(e,{isTransparent:n}).toBlob(e=>{e instanceof Blob?i(e):r("canvas.toBlob failed")},s,o)})},textureToBase64(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.validateQualityAndMimeType(t),r=i.isTransparent,a=i.quality,n=i.mimeType;return BFN.TextureUtils.textureToCanvas(e,{isTransparent:r}).toDataURL(n,a)},validateQualityAndMimeType(e){var t=e.isTransparent,i=e.mimeType,r=void 0===i?"image/png":i,a=e.quality,n=void 0===a?.99:a;if("boolean"==typeof t?r=t?"image/png":"image/jpeg":t="image/png"===r,!["image/png","image/jpeg"].includes(r))throw new Error("Invalid mime-type: ".concat(r));if("image/jpeg"===r&&(!(n=parseFloat(n))||n<0||n>1))throw new Error("Invalid quality: ".concat(n));return{isTransparent:t,quality:n,mimeType:r}},textureToCanvas(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isTransparent;if(!(void 0!==t&&t)){var i=PIXI.RenderTexture.create(e.width,e.height);i.fillColor(16777215),i.copyPixels(e,null,!1);var r=BFN.Stage.extract.canvas(i);return i.destroyGC(!0),r}Ie||((Ie=new PIXI.Sprite).filters=[new BFN.filters.UnPremultiplyFilter]),Ie.texture=e;var a=e.renderClone();BFN.Stage.render(Ie,a);var n=BFN.Stage.extract.canvas(a);return Ie.texture=PIXI.Texture.EMPTY,a.destroyGC(!0),n},getScaledDimensions(e,t){var i,r,a,n=t.maxWidth,o=t.maxHeight,s=t.scaleUp,l=void 0!==s&&s;return e.width/e.height>n/o?(r=(i=l?n:Math.min(n,e.width))/e.width,a=Math.round(e.height*r)):(r=(a=l?o:Math.min(o,e.height))/e.height,i=Math.round(e.width*r)),[i,a]}};class De{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"keyval-store",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";this.storeName=t,this._dbp=new Promise((i,r)=>{var a=indexedDB.open(e,1);a.onerror=(()=>r(a.error)),a.onsuccess=(()=>i(a.result)),a.onupgradeneeded=(()=>{a.result.createObjectStore(t)})})}_withIDBStore(e,t){return this._dbp.then(i=>new Promise((r,a)=>{var n=i.transaction(this.storeName,e);n.oncomplete=(()=>r()),n.onabort=n.onerror=(()=>a(n.error)),t(n.objectStore(this.storeName))}))}}function we(){return Fe||(Fe=new De),Fe}function ke(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:we())._withIDBStore("readwrite",i=>{i.put(t,e)})}function Le(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:we())._withIDBStore("readwrite",e=>{e.clear()})}function Oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:we(),t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}class Re{constructor(){this.init()}init(){var e=this;this.version="0.4",this.fallbackStore={},this.disabledReason=null,this.errorsRemaining=10,this.indexedDBReady=new Promise(t=>{var i=(e,i)=>{this.logError("Disabling IndexedDB during initial setup:",e),i&&this.reportError("Failed to setup IndexedDB",i),this.disabledReason=e,t(!1)},r=e=>{this.forceLog("Handing QuotaExceededError during startup");var t=e=>this.get(e,{readyPromise:Promise.resolve(!0)}).then(t=>{this.fallbackStore[e]=t}).catch(t=>this.logError("Unable to copy ".concat(e," into memory"),t));Oe(this.store).then(e=>Promise.all(e.map(t))).then(()=>Le(this.store)).then(()=>{this.forceLog("Successfully copied all keys into memory & cleared IndexedDB")}).catch(e=>{this.reportError("Failed to handle QuotaExceededError during startup",e)}).then(e)},a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return BeFunky.isFirefox&&"InvalidStateError"===a.name?(e.setPrivateBrowsingTag(!0),i("Firefox is in Private Browsing mode.")):BeFunky.isFirefox&&"UnknownError"===a.name?i("Firefox ESR user profile might be corrupted."):BeFunky.isEdgeHTML&&void 0===window.indexedDB?(e.setPrivateBrowsingTag(!0),i("Microsoft Edge is in Private Browsing mode.")):BeFunky.isSafari&&a.message.includes("BlobURLs are not yet supported.")?(e.setPrivateBrowsingTag(!0),i("Safari is in Private Browsing mode.")):"QuotaExceededError"===a.name?r(()=>i(t,a)):void i(t,a)},n=()=>{ke("test_blob",new Blob,this.store).then(()=>t(!0),e=>a("Unable to set empty Blob",e))};if(BeFunky.testingFlags.includes("disable_indexeddb"))return i("Automated testing");try{this.store=new De}catch(e){return a("new idbKeyval.Store failed",e)}this.store._dbp.then(()=>{this.log("Connected");var e,t="__IndexedDB_version",r=this.version;try{e=localStorage.getItem(t)}catch(e){return i("Unable to read ".concat(t," from localStorage"),e)}if(e===r)return n();e!==r&&(null!==e&&this.logError("Clearing IndexedDB while upgrading version",e,"->",r),Le(this.store).then(()=>{try{localStorage.setItem(t,r)}catch(e){return i("Unable to write ".concat(t," to localStorage"),e)}n()}).catch(e=>{a("Unable to clear keys while upgrading version",e)}))},e=>a("indexedDB.open failed",e))}),this.usagePercent=null,this.hasLoggedUsage=!1,navigator.storage&&navigator.storage.estimate?this.logUsage=BeFunky.debounce(this.logUsage.bind(this),1e3):(BeFunky.logWarning("Unable to calculate storage usage or quota in this browser"),this.logUsage=(()=>{}),this.hasLoggedUsage=!0),this.newBeFunkyTabOpened=!1,this.indexedDBReady.then(e=>{e?this.log("Allowing IndexedDB lookups"):this.logError("Using memory store b/c IndexedDB failed to initialize"),this.logUsage(),e&&this.listenForNewTabOpen()}),BeFunky.loggingFlags.includes("indexeddb")&&this.monitorLookups()}disable(e,t){t?this.reportError("Disabling IndexedDB",t,e):this.logError("Disabling IndexedDB",t,e),this.indexedDBReady=Promise.resolve(!1),this.disabledReason=e}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];BeFunky.logFeature("indexeddb",...t)}forceLog(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];BeFunky.loggingFlags.includes("indexeddb")?BeFunky.logFeature("indexeddb",...t):console.log("IndexedDB >",...t)}logError(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];BeFunky.loggingFlags.includes("indexeddb")?BeFunky.logFeature("indexeddb",...t):BeFunky.logError("IndexedDB >",...t)}retryAndTimeout(e){var t=e.attempt,i=e.retryAfter,r=e.onRetry,a=e.timeoutAfter,n=e.onTimeout;return new Promise((e,o)=>{t().then(e,o).then(h,h);var s=setTimeout(()=>{t().then(e,o).then(h,h),r()},i),l=setTimeout(()=>{o("timeout"),n(),h()},a);function h(){clearTimeout(s),clearTimeout(l)}})}reportError(e,t){var i=t&&t.name?t.name:t;"string"==typeof i&&t&&t.message&&(i="".concat(i,": ").concat(t.message));for(var r=arguments.length,a=new Array(r>2?r-2:0),n=2;n<r;n++)a[n-2]=arguments[n];this.errorsRemaining>0?(BeFunky.throwError("".concat(e," - ").concat(i),...a),this.errorsRemaining--):BeFunky.logError("".concat(e," - ").concat(i),...a)}get(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.useFallback,r=void 0===i||i,a=t.readyPromise;return(void 0===a?this.indexedDBReady:a).then(t=>r&&this.fallbackStore.hasOwnProperty(e)?this.fallbackStore[e]:t?this.retryAndTimeout({attempt:()=>(function(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:we())._withIDBStore("readonly",i=>{t=i.get(e)}).then(()=>t.result)})(e,this.store),retryAfter:3e3,onRetry:()=>this.logError("IndexedDB.get retried after 3 seconds",e),timeoutAfter:1e4,onTimeout:()=>this.reportError("IndexedDB.get took over 10 seconds","timeout",e)}):void 0)}set(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.useFallback,a=void 0===r||r;i.saveAttempt;return new Promise((i,r)=>{this.indexedDBReady.then(n=>{if(this.fallbackStore.hasOwnProperty(e)&&delete this.fallbackStore[e],!n)return a?(this.fallbackStore[e]=t,i({store:"memory"})):r(this.disabledReason);var o,s=()=>{ke(e,t,this.store).then(()=>{i({store:"IndexedDB"}),this.logUsage()},n=>{if(!a)return r(n);this.fallbackStore[e]=t,i({store:"memory"});var o=n&&n.name?n.name:n;this.logError(o,"Storing ".concat(e," (").concat(BeFunky.getType(t),") in memory storage instead of IndexedDB"));var s=()=>this.reportError("IndexedDB set failed",n);BeFunky.isChrome?BeFunky.waitUntil({condition:()=>this.hasLoggedUsage,onSuccess:s,onTimeout:s}):s()})};if(t instanceof Blob&&(o=t),!o||!BeFunky.isSafari)return s();BeFunky.Params.IS_LC&&console.log("IDB -> Reading blob before saving",e),BFN.BlobUtils.blobToArrayBuffer(o,t=>{var i=t.error;t.arrayBuffer;if(i)return this.logError("Unable to read Blob ".concat(e," (size = ").concat(BeFunky.formatBytes(o.size),") as ArrayBuffer before saving to IndexedDB.")),r("invalid_blob");s()})})})}delete(e){return this.indexedDBReady.then(t=>{if(this.fallbackStore.hasOwnProperty(e))delete this.fallbackStore[e];else if(t)return function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:we())._withIDBStore("readwrite",t=>{t.delete(e)})}(e,this.store)})}keys(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.prefix,i=e.includeFallback,r=void 0===i||i;return this.indexedDBReady.then(e=>{var i=e=>(r&&(e=e.concat(Object.keys(this.fallbackStore))),t&&(e=e.filter(e=>"string"==typeof e&&e.startsWith(t))),e);return e?Oe(this.store).then(i).catch(e=>r?(this.logError("Unable to list IndexedDB keys",e),i([])):Promise.reject(e)):i([])})}clear(){return this.indexedDBReady.then(e=>{if(this.fallbackStore={},e)return Le(this.store)})}getFile(e,t,i){return new Promise((r,a)=>{this.indexedDBReady.then(n=>{var o="".concat(e,"__").concat(t);if(!n)return s();function s(){BFN.RequestUtils.getJSON(i,e=>{var t=e.error,i=e.response;if(t)return BeFunky.logError("Unable to fetch valid JSON file from server",t),n?h(e=>{if(!e.length)return a(t);BFN.IndexedDB.get(e[e.length-1]).then(t=>{t&&(BeFunky.logError("Falling back to outdated file",e[e.length-1]),l(t,!1))})}):a(t);l(i),n&&BFN.IndexedDB.set(o,i,{useFallback:!1}).catch(e=>BeFunky.logError("Unable to store file in IndexedDB",o,e))})}function l(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r(e),t&&h(e=>e.forEach(e=>BFN.IndexedDB.delete(e)))}function h(t){BFN.IndexedDB.keys({prefix:e,includeFallback:!1}).then(e=>t(e.filter(e=>e!==o))).catch(()=>t([]))}BFN.IndexedDB.get(o).then(e=>{e?l(e):s()}).catch(e=>{BeFunky.logError("Unable lookup key in IndexedDB:",o,e),s()})})})}listenForNewTabOpen(){var e=Date.now().toString();try{localStorage.setItem("__latest_tab",e)}catch(e){this.disable("Unable to write ".concat("__latest_tab"," to localStorage"),e)}var t=i=>{"__latest_tab"===i.key&&BeFunky.getLocal("__latest_tab")!==e&&(this.newBeFunkyTabOpened=!0,console.log("A new tab was opened. Timestamp = ",i.newValue),window.removeEventListener("storage",t),this.keys({includeFallback:!1}).then(e=>Promise.all(e.map(e=>this.get(e).then(t=>{this.fallbackStore[e]=t})))).catch(e=>{this.reportError("Unable to copy IndexedDB values to memory when new tab was opened",e)}).then(()=>{this.disable("A new tab was opened")}),BeFunky.acknowledge("auto_save_disabled"))};window.addEventListener("storage",t)}logUsage(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];requestIdleCallback(()=>{navigator.storage.estimate().then(t=>{var i=t.usage,r=t.quota,a=(100*i/r).toFixed(2);if(e||a!==this.usagePercent){this.usagePercent=a;var n=["Using ".concat(a,"% of allowed storage, ").concat(BeFunky.formatBytes(i)," of ").concat(BeFunky.formatBytes(r))];a>100?this.logError(...n):e||!this.hasLoggedUsage?this.forceLog(...n):this.log(...n),BeFunky.isChrome&&!this.hasLoggedUsage&&this.setPrivateBrowsingTag(r/Math.pow(1024,2)<110)}},e=>{this.logError("Unable to calculate storage usage or quota",e)}).then(()=>{this.hasLoggedUsage=!0})})}monitorLookups(){var e=this,t=[],i=i=>{var r=this[i];this[i]=function(){for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];var s=[i,...n],l=setTimeout(()=>{e.log("Lookup taking a long time",s)},3e3);return t.push(s),r.call(e,...n).then(function(){return clearTimeout(l),t=t.filter(e=>e!==s),Promise.resolve(...arguments)},function(){return clearTimeout(l),t=t.filter(e=>e!==s),Promise.reject(...arguments)})}};i("get"),i("set"),i("clear"),i("delete"),i("keys"),Object.defineProperty(this,"pendingLookups",{get:()=>t.slice()})}setPrivateBrowsingTag(e){window.Sentry&&(Sentry.configureScope(t=>{t.setTag("private_browsing",e)}),this.log("Private browsing =",e))}}BFN.SingletonQueue.add(()=>{BFN.IndexedDB=new Re}),BFN.ExtractImageEvents={IMAGE_COMPRESS_FINISHED:new Event("IMAGE_COMPRESS_FINISHED"),WAITING_COMPRESS_STARTED:new Event("WAITING_COMPRESS_STARTED"),UPLOAD_STARTED:new Event("UPLOAD_STARTED"),UPLOAD_CANCELLED:new Event("UPLOAD_CANCELLED"),UPLOAD_FAILED:new Event("UPLOAD_FAILED"),UPLOAD_COMPLETED:new Event("UPLOAD_COMPLETED")};class Ae extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.quality=.95,this.mimeType="image/jpeg",this.fileName="BeFunkyArtwork",this._currentTexture=null,this.xhr=null,BFN.uploadVo=null,this.binaryData=null,this.UPDATE_PGOGRESS_EVENT_HANDLER=this.updateProgress.bind(this),this.TRANSFER_FAILED_HANDLER=this.transferFailed.bind(this),this.TRANSFER_CANCELED_HANDLER=this.transferCanceled.bind(this)}compress(e,t,i,r){if(null!=e&&e!=this.quality&&(this.quality=e),null!=t&&t!=this.mimeType&&(this.mimeType=t),!0!==i&&(this.blobData=null),null!=this.currentTexture){var a,n=null;if("image/png"===this.mimeType){var o=new BFN.filters.UnPremultiplyFilter;(a=new PIXI.Sprite(this.currentTexture)).filters=[o],n=PIXI.RenderTexture.create(this.currentTexture.width,this.currentTexture.height),BFN.Stage.render(a,n);try{a.texture=null,a=null}catch(e){}o=null;try{BFN.FilterHelper.emptyPoolForFilter()}catch(e){}}else(n=PIXI.RenderTexture.create(this.currentTexture.width,this.currentTexture.height)).fillColor(16777215),n.copyPixels(this.currentTexture,null,!1);var s=null!==n?BFN.Stage.extract.canvas(n):BFN.Stage.extract.canvas(this.currentTexture),l=this;if(!0===i){var h=s.toDataURL(this.mimeType,this.quality);return h=h.replace("data:".concat(this.mimeType,";base64,"),"")}setTimeout(()=>{s.toBlob(e=>{l.blobData=e,null!==n&&(n.destroyGC(!0),n=null),null!=r?r(l.blobData):l.dispatchEvent(BFN.ExtractImageEvents.IMAGE_COMPRESS_FINISHED)},l.mimeType,l.quality)},0)}else console.warn("-[ExtractImage:compress] : currentTexture parameter is null");if(1==i)return null}saveToDesktop(){if(null!=this.blobData){this.fileName.length<1&&(this.fileName="BeFunky-artwork");var e=this.fileName.replace(/\.(jpe?g|png)$/,"")+("image/jpeg"===this.mimeType?".jpg":".png");saveAs(this.blobData,e)}}upload(e,t){BFN.uploadVo=null;var i=null==e?"https://upload.befunky.com/restupload/uploadbinv6.bfn?fromFlash=1&method=befunky.uploadFile":e;t.CSRFtoken=getCsToken();var r=this;if(null!=this.currentTexture){this.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_STARTED);var a=BFN.Stage.extract.canvas(this.currentTexture);a.toBlob(e=>{r.binaryData=e,a=null,r.xhr=new XMLHttpRequest,r.xhr.onload=(()=>{var e=null!=r.xhr.response?r.xhr.response:r.xhr.responseText;if(null!=e){e=e.replace("\n","");var t=null;try{t=window.parseXml(e)}catch(e){return void r.transferFailed()}if(null!=t){var i=null;try{i=t}catch(e){return void r.transferFailed()}null==i||null!=i.getElementsByTagName("url")&&i.getElementsByTagName("url")[0].childNodes[0].nodeValue.length<1?this.transferFailed():(BFN.uploadVo=new BFN.UploadVO,BFN.uploadVo.url=i.getElementsByTagName("url")[0].childNodes[0].nodeValue,BFN.uploadVo.width=i.getElementsByTagName("width")[0].childNodes[0].nodeValue,BFN.uploadVo.height=i.getElementsByTagName("height")[0].childNodes[0].nodeValue,BFN.uploadVo.size=i.getElementsByTagName("size")[0].childNodes[0].nodeValue,BFN.uploadVo.resizedUrl=i.getElementsByTagName("url")[1].childNodes[0].nodeValue,BFN.uploadVo.resizedWidth=i.getElementsByTagName("width")[1].childNodes[0].nodeValue,BFN.uploadVo.resizedHeight=i.getElementsByTagName("height")[1].childNodes[0].nodeValue,BFN.uploadVo.resizedSize=i.getElementsByTagName("size")[1].childNodes[0].nodeValue,r.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_COMPLETED),r.removeUploadEvent(),BeFunky.log("Upload completed : ".concat(BFN.uploadVo.url)))}else r.transferFailed()}else r.transferFailed()}),r.xhr.upload.addEventListener("progress",r.UPDATE_PGOGRESS_EVENT_HANDLER),r.xhr.upload.addEventListener("error",r.TRANSFER_FAILED_HANDLER),r.xhr.upload.addEventListener("abort",r.TRANSFER_CANCELED_HANDLER),r.xhr.withCredentials=!0,r.xhr.open("POST",i,!0),r.xhr.setRequestHeader("Content-Type","application/octet-stream"),r.xhr.responseType="text",r.xhr.send(r.binaryData)},"image/jpeg",1)}else this.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_FAILED)}cancelUpload(){if(null!=this.xhr)try{this.xhr.abort()}catch(e){}}removeUploadEvent(){try{this.xhr.upload.removeEventListener("progress",this.UPDATE_PGOGRESS_EVENT_HANDLER),this.xhr.upload.removeEventListener("error",this.TRANSFER_FAILED_HANDLER),this.xhr.upload.removeEventListener("abort",this.TRANSFER_CANCELED_HANDLER)}catch(e){}try{this.xhr.onload=null}catch(e){}this.xhr=null,this.binaryData=null}updateProgress(e){if(e.lengthComputable){var t=e.loaded/e.total*100;BeFunky.log("uploading progress : %".concat(t))}else BeFunky.log("Unable to compute progress information since the total size is unknown")}transferFailed(e){BeFunky.log("An error occurred while transferring the file."),this.removeUploadEvent(),this.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_FAILED)}transferCanceled(e){BeFunky.log("The transfer has been canceled by the user."),this.removeUploadEvent(),this.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_CANCELLED)}set quality(e){this._quality=e}get quality(){return this._quality}set mimeType(e){this._mimeType=e}get mimeType(){return this._mimeType}set fileName(e){this._fileName=e}get fileName(){return this._fileName}set binaryData(e){this._binaryData=e}get binaryData(){return this._binaryData}set blobData(e){this._blobData=e}get blobData(){return this._blobData}set currentTexture(e){this._currentTexture=e}get currentTexture(){return this._currentTexture}}BFN.SingletonQueue.add(()=>{BFN.ExtractImage=new Ae}),BFN.ArtsyServiceEvents={STARTED:new Event("ARTSY_SERVICE_STARTED"),CANCELLED:new Event("ARTSY_SERVICE_CANCELLED"),FAILED:new Event("ARTSY_SERVICE_FAILED"),COMPLETED:new Event("ARTSY_SERVICE_COMPLETED")};class Ve extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.isStarted=!1,this.isArtsy=!0,this.maxPixels=null,this.xhr=null,this.isTriedOnce=0,this._currentTexture=null,this._uploadTexture=null,this.artsyServiceURL="https://upload.befunky.com/artsy/",BFN.artsyImageVo=null,this.currentArtsyID=233,this.currentArtsyParams={color_detail:350,sketch_smoothness:20,clutter_cleaner:3,sketch_brightness:35,sketch_detail:17,color_smoothness:100},this.donwloadImage=null,this.PROCESS_FAILED_EVENT_HANDLER=this.processFailed.bind(this),this.PROCESS_ABORTED_EVENT_HANDLER=this.processAborted.bind(this),this.UPLOAD_COMPLETE_EVENT_HANDLER=this.processImage.bind(this)}processImage(e){var t=this;if(this.isTriedOnce=e?1:0,BFN.artsyImageVo=null,0==t.isStarted&&(t.isStarted=!0,t.dispatchEvent(BFN.ArtsyServiceEvents.STARTED)),null!=BFN.uploadVo){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}t.isArtsy?UIMessages.display("processing_image"):UIMessages.display("enhancing_your_photo"),t.removeUploadEvent(),null!=t.xhr&&t.removeArtsyEvent(),t.xhr=new XMLHttpRequest,t.xhr.onload=(()=>{t.processCompleted()}),t.xhr.onerror=(()=>{t.processFailed("error")}),t.xhr.upload.addEventListener("error",t.PROCESS_FAILED_EVENT_HANDLER),t.xhr.upload.addEventListener("abort",t.PROCESS_ABORTED_EVENT_HANDLER),t.xhr.withCredentials=!0,t.xhr.open("POST",t.artsyServiceURL,!0);var i=getCsToken(),r="";if(["a_i_enhancer","a_i_portrait"].includes(t.currentArtsyID)){var a="a_i_enhancer"===t.currentArtsyID?"enhancer":"portrait";r="method=api/auto-enhancer/&image=".concat(BFN.uploadVo.url,"&model=").concat(a,"&CSRFtoken=").concat(i)}else if(t.currentArtsyID.startsWith("AI_ARTSY_STYLE_")){var n=t.currentArtsyID.replace("AI_ARTSY_STYLE_","");r="method=api/artsy-style/&image=".concat(BFN.uploadVo.url,"&style=").concat(n,"&CSRFtoken=").concat(i)}else r="method=befunky.runTemplateEffect&template_id=".concat(t.currentArtsyID,"&adjustment=&url=").concat(BFN.uploadVo.url,"&psize=&vm=&CSRFtoken=").concat(i);for(var o in BeFunky.Params.isAdmin&&(r+="&is_beta=1"),t.currentArtsyParams)r="".concat(r,"&").concat(o,"=").concat(t.currentArtsyParams[o]);t.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.xhr.setRequestHeader("X-CSRF-Token",i),t.xhr.responseType="json",t.xhr.send(r)}else t.uploadImage()}uploadImage(){if(this._currentTexture){var e=this._currentTexture.determineTransparency(),t=this._currentTexture.renderClone();if(e){var i=PIXI.RenderTexture.create(t.width,t.height);i.fillColor(16777215),i.copyPixels(t,null,!1);try{t.destroyGC(!0)}catch(e){}t=i}var r=BFN.BfnService.userIsPlus;if(r||t.width<BFN.maxImageUploadSizeFreeUser&&t.height<BFN.maxImageUploadSizeFreeUser)if(null!=this.maxPixels&&this.maxPixels>0){var a=BFN.Util.conformImageSizeMegaPixels(t,BFN.minImageSize,this.maxPixels);t.destroyGC(!0),t=a}else{var n=BFN.Util.conformImageSize(t,BFN.minImageSize,BFN.maxImageSizeForArtsy);t.destroyGC(!0),t=n}else if(r&&null!=this.maxPixels&&this.maxPixels>0){var o=BFN.Util.conformImageSizeMegaPixels(t,BFN.minImageSize,this.maxPixels);t.destroyGC(!0),t=o}else{var s=BFN.maxImageUploadSizeFreeUser;(["a_i_enhancer","a_i_portrait"].includes(this.currentArtsyID)||this.currentArtsyID.startsWith("AI_ARTSY_STYLE_"))&&(s=BFN.maxImageSizeForArtsy),t=BFN.Util.conformImageSize(t,BFN.minImageSize,s)}if(this._uploadTexture=t,void 0===window.DirectUPL)BFN.ExtractImage.currentTexture=this._uploadTexture,BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER),BFN.ExtractImage.upload();else{var l=this,h=null,c=BFN.Stage.extract.canvas(this._uploadTexture);c.toBlob(e=>{h=e,c=null,window.DirectUPL.upload(e=>{if(h=null,e&&e.url&&e.s3_name)BFN.uploadVo=new BFN.UploadVO,BFN.uploadVo.url=e.url,l.processImage();else try{if("abort"!=e&&void 0!==e&&void 0===e.abort)try{BFN.ExtractImage.currentTexture=l._uploadTexture,BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,l.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,l.UPLOAD_COMPLETE_EVENT_HANDLER),BFN.ExtractImage.upload()}catch(e){l.processFailed("error")}else l.processFailed()}catch(e){l.processFailed()}},{bucket:["a_i_enhancer","a_i_portrait"].includes(l.currentArtsyID)||l.currentArtsyID.startsWith("AI_ARTSY_STYLE_")?"ai-enhancer":"artsyupload",content_type:"image/jpeg",blob:h})},"image/jpeg",["a_i_enhancer","a_i_portrait"].includes(l.currentArtsyID)||l.currentArtsyID.startsWith("AI_ARTSY_STYLE_")?.99:.9)}UIMessages.display("preparing_image")}}processCompleted(){var e=this;e.isStarted=!1,e.removeUploadEvent();try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}function t(t,i){console.log(t,i),e.processFailed("error")}var i=null;try{i=null!=e.xhr.response?e.xhr.response:e.xhr.responseText}catch(e){}if(i&&i.error)return t("Artsy request failed",i.error);if(!1===(i&&i.data)||!i)return t("Artsy request failed","no_response");if(!(i=i.data).url&&!i.image)return e.processFailed("error");BFN.artsyImageVo=new BFN.ArtsyImageVO,BFN.artsyImageVo.url=i.url?i.url:i.image,BFN.artsyImageVo.width=i.width||0,BFN.artsyImageVo.height=i.height||0,BFN.artsyImageVo.size=i.size||0,UIMessages.display("downloading_processed_image"),this.donwloadImage=null;var r=document.createElement("img");r.setAttribute("crossOrigin","Anonymous"),r.onload=(()=>{var t=new PIXI.Texture(new PIXI.BaseTexture(r)),i=t.renderClone();t.destroyGC(!0),BFN.ArtsyServiceEvents.COMPLETED.data=i,e.dispatchEvent(BFN.ArtsyServiceEvents.COMPLETED),BFN.ArtsyServiceEvents.COMPLETED.data=null,i.destroyGC(!0)}),r.onerror=(()=>{e.processFailed("error")}),r.src=BFN.artsyImageVo.url,this.donwloadImage=r,e.removeArtsyEvent()}processFailed(e){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}this.isStarted=!1,this.removeUploadEvent(),this.removeArtsyEvent(),this.donwloadImage=null,this.dispatchEvent(BFN.ArtsyServiceEvents.FAILED);try{void 0!==e&&null!=e&&"error"==e&&setTimeout(()=>{UIMessages.display("error_invalid_response")},666)}catch(e){}}cancel(){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}if(this.isStarted=!1,this.removeUploadEvent(),BFN.ExtractImage.cancelUpload(),null!=this.donwloadImage&&(this.donwloadImage.src="",this.donwloadImage=null),void 0!==window.DirectUPL)try{if(void 0!==window.DirectUPL.signReq&&null!=window.DirectUPL.signReq){try{window.DirectUPL.signReq.abort()}catch(e){}window.DirectUPL.signReq=null}if(void 0!==window.DirectUPL.uploadReq&&null!=window.DirectUPL.uploadReq){try{window.DirectUPL.uploadReq.abort()}catch(e){}window.DirectUPL.uploadReq=null}}catch(e){}if(null!=this.xhr)try{this.xhr.abort()}catch(e){}this.removeArtsyEvent(),this.dispatchEvent(BFN.ArtsyServiceEvents.CANCELLED)}reset(){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}null!=BFN.uploadVo&&(BFN.uploadVo=null),null!=BFN.artsyImageVo&&(BFN.artsyImageVo=null),this._currentTexture=null,this.donwloadImage=null}processAborted(){this.isStarted=!1,this.removeUploadEvent(),this.removeArtsyEvent(),BFN.ExtractImage.cancelUpload();try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}this.donwloadImage=null,this.dispatchEvent(BFN.ArtsyServiceEvents.CANCELLED)}removeUploadEvent(){try{BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER)}catch(e){}}removeArtsyEvent(){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}if(this.xhr){try{this.xhr.upload.removeEventListener("error",this.PROCESS_FAILED_EVENT_HANDLER),this.xhr.upload.removeEventListener("abort",this.PROCESS_ABORTED_EVENT_HANDLER)}catch(e){}try{this.xhr.onload=null}catch(e){}this.xhr=null}}set currentArtsyID(e){this._currentArtsyID=e}get currentArtsyID(){return this._currentArtsyID}set currentArtsyParams(e){this._currentArtsyParams=e}get currentArtsyParams(){return this._currentArtsyParams}set currentTexture(e){this._currentTexture=e}get currentTexture(){return this._currentTexture}}BFN.SingletonQueue.add(()=>{BFN.ArtsyService=new Ve}),BFN.BfnServiceEvents={USER_DATA_CHANGED:new Event("USER_DATA_CHANGED"),CUSTOM_RESIZE_EVENT:new Event("CUSTOM_RESIZE_EVENT"),TRANSFER_FAILED:new Event("TRANSFER_FAILED"),TRANSFER_CANCELLED:new Event("TRANSFER_CANCELLED"),TRANSFER_COMPLETED:new Event("TRANSFER_COMPLETED")};class Ue extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.xhr=null,this.UPDATE_PGOGRESS_EVENT_HANDLER=this.updateProgress.bind(this),this.TRANSFER_FAILED_HANDLER=this.transferFailed.bind(this),this.TRANSFER_CANCELED_HANDLER=this.transferCanceled.bind(this),this.UPLOAD_FAILED_EVENT_HANDLER=this.onUploadFailed.bind(this),this.UPLOAD_COMPLETE_EVENT_HANDLER=this.onUploadComplete.bind(this),this.hashtagRegExp=/(#[a-zA-Z0-9_%-]*)/g,this.getUserData(!0)}getUserData(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];BFN.userVo=new BFN.UserVO;var t=BeFunky.User.FlashVarsObject,i=BeFunky.Params.swfFlashVars;BFN.userVo.email=t.email||i.email||null,BFN.userVo.username=t.user_name||i.user_name||null,BFN.userVo.isCfrmInner=!0,BFN.userVo.pl=BeFunky.ConvertToBool(t.pl)||BeFunky.ConvertToBool(i.pl),BFN.userVo.language=i.language||"en",BFN.userVo.uplUri=BeFunky.Params.uplUri,e?setTimeout(()=>{window.addEventListener("INIT_COMPLETE",()=>{this.dispatchEvent(BFN.BfnServiceEvents.USER_DATA_CHANGED)})},0):this.dispatchEvent(BFN.BfnServiceEvents.USER_DATA_CHANGED)}login(e){var t=!1;e&&(t=(()=>{BeFunky.befunkyPopupContainerClose(),e()})),BeFunky.openLoginPanel("SIGNIN",t)}register(e){BeFunky.openLoginPanel("REGISTER",e||!1)}signOut(){function e(){BeFunky.signOut()}BFN.IndexedDB.indexedDBReady.then(t=>{if(!t)return e();BeFunky.confirm("confirm_keep_projects",{onConfirm:e,onCancel:()=>(function(){Object.values(BFN.ProjectManager.autoSave).forEach(e=>{e.allowAutoSave=!1});var e=["editor","collage","designer"].map(e=>BFN.IndexedDB.delete("project__".concat(e))),t=BFN.ProjectService.clearLocalAssets("all"),i=BFN.IndexedDB.delete("options__selectedMenuImageVOs"),r=BFN.IndexedDB.delete("options__selectedGraphics");return Promise.all([...e,t,i,r]).catch(e=>{BeFunky.logError("Unable to delete all projects and their assets:",e)})})().then(e),confirmText:"yes",cancelText:"no_clear_them",isCritical:!0})})}upgrade(e,t,i){"string"==typeof e&&BFN.BfnService.track("CREATE",e.toUpperCase(),t?t.toUpperCase():"UPGRADE"),BeFunky.openTeaserModal(i)}onUserLogin(e){if(this.userLoggedIn)return e(this.userIsPlus);var t=()=>{this.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,t),this.userLoggedIn&&e(this.userIsPlus)};this.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,t)}importDropBoxImage(){window.dBoxOpenPicker()}importGoogleDriveImage(){window.drv_OpenPicker()}hideEditor(){window.hideEditor(),BFN.BfnService.track("CREATE","GLOBALMENU","HIDE_APP")}callbackFromJs(e,t){t?(this.googleDriveObj={insertUrl:e,access_token:t},null!=this.tmpInternalCallback&&(this.tmpInternalCallback(),this.tmpInternalCallback=null)):null!=this.tmpCallback&&(this.tmpCallback("cancel"),this.tmpCallback=null)}callbackDriveInsertFile(e){if(this.googleDriveObj.base64=null,null!=this.tmpCallback){if("error"!==e){var t=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");BFN.BfnService.track("CREATE",t,"GOOGLE_DRIVE")}this.tmpCallback("error"===e?"error":"cancel"===e?"cancel":null),this.tmpCallback=null,this.tempParams=null}}getGoogleDriveAccessToken(){try{window.driveInmediateDisplay(!0)}catch(e){}}saveGoogleDriveImage(e,t){try{window.insertDriveFile(e,t)}catch(e){}}ToJsBase64Uploader(e,t,i){BFN.AppModel.viewingEditor||BeFunky.throwError("ToJsBase64Uploader requested while not in Editor"),e.includes("data:image")||(e="data:image/png;base64,".concat(e)),"string"==typeof i?BFN.BfnService.trackMediaOpened("image",i):BeFunky.logError("Unable to track ToJsBase64Uploader media open b/c no source was provided"),"string"==typeof t&&t.includes(".")&&(t=t.split(".").slice(0,-1).join(".")),BFN.BfnService.ToJsUrlUploader(e,t,!0,i)}ToJsUrlUploader(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(BFN.AppModel.viewingEditor||BeFunky.throwError("ToJsUrlUploader requested while not in Editor"),!BFN.hasFullyOpenedEditor)return console.log("Waiting for Photo Editor to initialize before opening external image"),void(BeFunky.editorExternalImage={ignoreExistingProject:i,loadImage:()=>{if(!BFN.hasFullyOpenedEditor)return BeFunky.throwError("BeFunky.editorExternalImage.loadImage called before hasFullyOpenedEditor");this.ToJsUrlUploader(e,t,!0,r)}});var a=()=>{if(e.startsWith("data:image"))BFN.PhotoEditorModel.loadBase64OrBlob(e,{filename:t});else{if(!this.isUrl(e))return BeFunky.logError("Invalid url provided",e),n();"string"==typeof r?BFN.BfnService.track("CREATE","UPLOAD",r.toUpperCase()):BFN.BfnService.track("CREATE","UPLOAD","WEB"),"string"==typeof r?BFN.BfnService.trackMediaOpened("image",r):BeFunky.logError("Unable to track ToJsUrlUploader media open b/c no source was provided");var i=!1;BeFunky.showLoadScreen({onCancel:()=>{i=!0,n()}}),"string"!=typeof t&&(t=e.substring(e.lastIndexOf("/")+1).replace(/\.[^\/.]+$/,"").trim()||"External Image");var a="".concat(BFN.userVo.uplUri,"/loadImage.php?c=").concat(encodeURIComponent(e));BFN.RequestUtils.getBlobWithFallback(e,a,e=>{var r=e.error,a=e.blob;if(!i)return r?(BeFunky.logError(r),BeFunky.hideLoadScreen(),void n()):void BFN.PhotoEditorModel.loadBase64OrBlob(a,{filename:t})})}};function n(){BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture&&UIToggler.toggleSampleImagePopover(!0)}i?a():BFN.IndexedDB.get("project__editor").then(e=>{if(!BFN.ProjectManager.validateProject(e,{requireEditorMainImage:!1}))throw"No valid editor project";BeFunky.logError("Ignoring ToJsUrlUploader() b/c Editor Project already exists")}).catch(()=>{a()})}track(e,t,i,r){BeFunky.log("TRACKING:",e,t,i),window.bf_eventTrack(e,t,i,r)}trackMediaOpened(e,t){BFN.imageTypes.includes(t)&&t.startsWith("befunky_")&&(t="befunky");var i={image:"Image",project:"Project"},r={computer:"Computer",facebook:"Facebook",drive:"Drive",dropbox:"Dropbox",befunky:"BeFunky",webcam:"Webcam",sample:"Sample",unsplash:"Unsplash",pixabay:"Pixabay",pexels:"Pexels",chrome_extension:"chrome_extension",google_photos:"Google Photos"};if(!i.hasOwnProperty(e))return BeFunky.throwError("Invalid media type: ".concat(e));if(!r.hasOwnProperty(t))return BeFunky.throwError("Invalid media source: ".concat(t));var a=new BFN.UserActionVO;a.eventID="media_opened",a.eventObject={mediaType:i[e],mediaOpenLocation:r[t]},a.peopleObject={lastMediaOpenDate:window.bfn_mp?window.bfn_mp.getISODate():"n/a",lifetimeMediaOpenCount:1,lifetimeImagesOpenCount:"project"===e?0:1},a.track()}saveToBeFunky(e,t){if(BFN.BfnService.userLoggedIn){var i=e.text.slice(0,100),r="";try{for(var a={},n=[];a=this.hashtagRegExp.exec(i);){var o=a[0].replace("#","").toLowerCase();n.push(o)}r=n.join(",")}catch(e){}var s=this;e.quality=void 0!==e.quality?e.quality:.9,e.mimeType=void 0!==e.mimeType?e.mimeType:"image/jpeg";var l,h;l=e.blob,h={},BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&(h.apptype="collage"),h.Title=i,h.bftags="",h.preset_id="0",h.isPublic=e.isPublic?1:0,h.tags=r,h.image=l,h.image_type=e.mimeType,h.CSRFtoken=getCsToken(),s.multipartUpload("".concat(BFN.userVo.uplUri,"/restupload/savegallery.bfn"),h,e=>{if(0==(null!=e)){var i=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");BFN.BfnService.track("CREATE",i,"BEFUNKY")}null!=t&&(t(e),s.multipartCallBack=null),h=null,"not_login"===e&&BeFunky.UserManager.checkUserToken("not_logged_in","API")})}}saveToGoogleDrive(e,t){var i=this;i.tempParams=i.tempParams||e,i.tmpCallback=i.tmpCallback||t;var r=i.tempParams.text;this.tmpInternalCallback=(()=>{BFN.ExtractImage.currentTexture=i.tempParams.texture,BFN.ExtractImage.compress(1,"image/jpeg",!1,e=>{var t=new FileReader;t.onload=(e=>{try{i.googleDriveObj.base64=e.target.result.replace("data:image/jpeg;base64,",""),i.saveGoogleDriveImage(i.googleDriveObj.base64,r),t=null}catch(e){null!=i.tmpCallback&&(i.tmpCallback("error"),i.tempParams=null,i.tmpCallback=null)}}),t.readAsDataURL(e)})}),this.getGoogleDriveAccessToken()}prepareDropboxSave(e,t){if(this.tmpCallback=t,null==e)null!=t&&(t(),this.tmpCallback=null);else if(void 0===window.DirectUPL)BFN.ExtractImage.currentTexture=e,BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.UPLOAD_FAILED_EVENT_HANDLER),BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER),BFN.ExtractImage.upload();else{var i=this,r=null,a=BFN.Stage.extract.canvas(e);a.toBlob(e=>{r=e,a=null,window.DirectUPL.upload(e=>{r=null,e&&e.url&&e.s3_name?(BFN.uploadVo=new BFN.UploadVO,BFN.uploadVo.url=e.url,i.onUploadComplete()):i.onUploadFailed()},{bucket:"artsyupload",content_type:"image/jpeg",blob:r})},"image/jpeg",.9)}}onUploadFailed(){try{BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER)}catch(e){}null!=this.tmpCallback&&(this.tmpCallback(),this.tempParams=null,this.tmpCallback=null)}onUploadComplete(){try{BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER)}catch(e){}null!=this.tmpCallback&&(this.tmpCallback(),this.tempParams=null,this.tmpCallback=null)}saveToDropBox(e,t){this.tempParams=this.tempParams||e,this.tmpCallback=this.tmpCallback||t,BFN.uploadVo&&null!=BFN.uploadVo.url?window.dBoxSaveFile(BFN.uploadVo.url,"".concat(this.tempParams.text,".jpg")):null!=this.tmpCallback&&(this.tmpCallback("error"),this.tempParams=null,this.tmpCallback=null)}handlerDropBoxInsert(e){if("error"===e)null!=this.tmpCallback&&this.tmpCallback("error");else if("cancel"===e)null!=this.tmpCallback&&this.tmpCallback("cancel");else{var t=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");BFN.BfnService.track("CREATE",t,"DROP_BOX"),null!=this.tmpCallback&&this.tmpCallback()}this.tempParams=null,this.tmpCallback=null}shareToFacebookOrPinterest(e,t){var i=this;i.tempParams=i.tempParams||e,i.tmpCallback=i.tmpCallback||t;var r=i.tempParams.text;BFN.ExtractImage.currentTexture=i.tempParams.texture;var a=i.tempParams.hasOwnProperty("mimeType")?i.tempParams.mimeType:"image/jpeg";BFN.ExtractImage.compress(1,a,!1,e=>{var t={};t.title=r,t.image_type=a,t.image=e,t.CSRFtoken=getCsToken(),UIToggler.onLoadScreenCancel=i.transferCanceled,i.multipartUpload("".concat(BFN.userVo.uplUri,"/restupload/savetoanonymous.bfn"),t,(e,a)=>{if(0==(null!=e)){var n=BFN.AppModel.sectionValue("SHARE","SHARE_COLLAGE","SHARE_DESIGNER");if(BFN.BfnService.track("CREATE",n,i.tempParams.apptype.toUpperCase()),null!=a&&a.hasOwnProperty("link")){var o=encodeURIComponent(r),s=encodeURIComponent(a.fileurl),l=encodeURI(a.link);BeFunky.shareLink(i.tempParams.apptype,l,s,o)}}null!=i.tmpCallback&&(i.tmpCallback(e),i.tmpCallback=null),i.multipartCallBack=null,t=null,i.tempParams=null},null,null,"json",!0)})}multipartUpload(e,t,i,r,a,n,o){var s=this;this.multipartCallBack=i,this.xhr=new XMLHttpRequest,this.xhr.onload=function(){var e=null;try{e=null!=s.xhr.response?s.xhr.response:s.xhr.responseText}catch(e){}null!=e?e.hasOwnProperty("err")?s.transferFailed(e.err):e.hasOwnProperty("error")?s.transferFailed("error"):e.hasOwnProperty("errors")?s.transferFailed("errors"):(s.clearXHR(),null!=s.multipartCallBack?o?s.multipartCallBack(null,e):s.multipartCallBack():s.dispatchEvent(BFN.BfnServiceEvents.TRANSFER_COMPLETED)):s.transferFailed("err")},this.xhr.upload.addEventListener("progress",this.UPDATE_PGOGRESS_EVENT_HANDLER),this.xhr.upload.addEventListener("error",this.TRANSFER_FAILED_HANDLER),this.xhr.upload.addEventListener("abort",this.TRANSFER_CANCELED_HANDLER),r||(this.xhr.withCredentials=!0),this.xhr.open("POST",e,!0),null!=a&&this.xhr.setRequestHeader("Content-Type",a),this.xhr.responseType=n||"json";var l=new FormData;for(var h in t)l.append(h,t[h]);this.xhr.send(l)}updateProgress(e){if(e.lengthComputable){var t=e.loaded/e.total*100;BeFunky.log("uploading progress : %".concat(t))}else BeFunky.log("Unable to compute progress information since the total size is unknown")}transferFailed(e){BeFunky.log("An error occurred while transferring the file."),this.clearXHR(),null!=this.multipartCallBack?this.multipartCallBack(null!=e&&("string"==typeof e||e instanceof String)?e:"error"):this.dispatchEvent(BFN.BfnServiceEvents.TRANSFER_FAILED)}transferCanceled(e){BeFunky.log("The transfer has been canceled by the user."),BFN.BfnService.clearXHR(),null!=BFN.BfnService.multipartCallBack?BFN.BfnService.multipartCallBack():BFN.BfnService.dispatchEvent(BFN.BfnServiceEvents.TRANSFER_CANCELLED)}clearXHR(){try{if(null!=this.xhr){this.xhr.upload.removeEventListener("progress",this.UPDATE_PGOGRESS_EVENT_HANDLER),this.xhr.upload.removeEventListener("error",this.TRANSFER_FAILED_HANDLER),this.xhr.upload.removeEventListener("abort",this.TRANSFER_CANCELED_HANDLER);try{this.xhr.abort()}catch(e){}this.xhr.onload=null,this.xhr=null}}catch(e){}}isUrl(e){return/^(ftp|http|https):\/\/(\w+:?\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@\-\/]))?/.test(e)}getImageBlobOrSVG(e,t){var i=()=>{var i=e.imageURL,r="".concat(BFN.userVo.uplUri,"/loadImage.php?c=").concat(encodeURIComponent(e.imageURL));BFN.RequestUtils.getBlobWithFallback(i,r,i=>{var r=i.error,a=i.blob;return r?"pixabay"===BFN.getImageType(e.id)?(BeFunky.logError("Failed to load expired Pixabay full-size image. Trying again..."),void BFN.ImageLibraryService.getPixabayImageById(e.id.replace("pixabay_","")).then(i=>{e.imageURL=i.imageURL,e.thumbURL=i.thumbURL,requestIdleCallback(()=>BFN.ImageLibraryManager.updateImageStore());var r=e.imageURL,a="".concat(BFN.userVo.uplUri,"/loadImage.php?c=").concat(encodeURIComponent(e.imageURL));BFN.RequestUtils.getBlobWithFallback(r,a,e=>{var i=e.error,r=e.blob;if(i)return t({error:i});t({blob:r})})},e=>(BeFunky.reportWarning("Unable to get updated Pixabay image",e),t({error:e})))):t({error:r}):e.isPattern?BFN.CollageMakerPatternManager.doubleBlobDimensions(e,a,t):e.isSVG?BFN.BlobUtils.blobToText(a,e=>{var i=e.error,r=e.text;if(i)return t({error:i});var a=BFN.SVGManager.sanitizeSVG(r);return t(a?{svgString:a}:{error:"Unable to parse SVG"})}):t({blob:a})})};(i=>{if(!e.indexedDBKey)return i({error:"Missing IndexedDBKey"});var r=e.isSVG;r!==e.indexedDBKey.startsWith("svg__")?i({error:"SVG MenuImageVO has invalid IndexedDBKey"}):BFN.IndexedDB.get(e.indexedDBKey).then(a=>{if(a instanceof Blob)return i({blob:a});if("string"==typeof a){if(r)return t({svgString:a});try{var n=BFN.BlobUtils.base64ToBlob(a);return BeFunky.logError("Converted stored base64 -> blob for MenuImageVO ".concat(e)),i({blob:n})}catch(e){return i({error:"Unable to convert string to blob: ".concat(e)})}}return i({error:"Unable to get valid blob/base64/SVG from IndexedDB key ".concat(e.indexedDBKey)})}).catch(e=>i({error:e}))})(r=>{var a=r.error,n=r.blob;return n?t({blob:n}):e.imageURL?void i():t({error:a})})}getTexturesForMenuImageVOs(e,t){var i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).saveAssetsSectionID;UIToggler.toggleLoadScreen(!0);var r=[],a=0,n=e.length,o=()=>{++a===n&&(UIToggler.toggleLoadScreen(!1),i?Promise.all(r).catch(BeFunky.logError).then(()=>t(e)):t(e))};e.forEach(e=>{if(e.hasUsableTexture())return o();this.getImageBlobOrSVG(e,t=>{var a=t.error,n=t.blob,s=t.svgString;if(a)return BeFunky.throwError("Unable to get blob or SVG string for ".concat(BFN.getImageType(e.id)," MenuImageVO"),e,a),o();var l=n?"image":"svg",h=n||s;if(i){var c=BFN.ProjectService.localAssetExists(l,e.id);r.push(c),c.then(t=>{t||BFN.ProjectService.setLocalAsset(i,l,e.id,h)})}return e.hasUsableTexture()?o():"image"===l?BFN.TextureUtils.blobOrBase64ToTexture(n,t=>{var i=t.error,r=t.texture;return i?(BeFunky.logError("Unable to generate texture for MenuImageVO image",i),o()):(e.imageTexture=r,o())}):void BFN.TextureUtils.svgStringToTexture(s,t=>{var i=t.error,r=t.texture;return i?(BeFunky.logError("Unable to generate texture for MenuImageVO SVG",i),o()):(e.imageTexture=r,o())})})})}storeBlobForMenuImageVO(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},r=e.isSVG?"svg":"image";BFN.ProjectService.localAssetExists(r,e.id).then(a=>{if(a)return i();BFN.BfnService.getImageBlobOrSVG(e,a=>{var n=a.error,o=a.blob,s=a.svgString;if(n)return BeFunky.logError("Unable to get ".concat("svg"===r?"SVG string":"blob"," from MenuImageVO ").concat(e.id),n);var l=!1;BFN.ProjectService.setLocalAsset(t,r,e.id,o||s).then(()=>{l=!0,i()}).catch(t=>{l||BeFunky.logError("Unable to store ".concat("svg"===r?"SVG string":"blob"," from MenuImageVO ").concat(e.id," in IndexedDB"),t)})})})}get userLoggedIn(){var e=Boolean(BFN.userVo&&BFN.userVo.email&&BFN.userVo.email.length>0);return e!==BeFunky.isLoggedIn()&&(BeFunky.Params.isBeta?BeFunky.reportWarning("userLoggedIn != isLoggedIn",BFN.userVo,window.latestUserData):BeFunky.logWarning("userLoggedIn != isLoggedIn",BFN.userVo,window.latestUserData)),e}get userIsPlus(){var e=Boolean(this.userLoggedIn&&BFN.userVo.pl);return e!==BeFunky.isPlus()&&(BeFunky.Params.isBeta?BeFunky.reportWarning("userIsPlus != isPlus",BFN.userVo,window.latestUserData):BeFunky.logWarning("userIsPlus != isPlus",BFN.userVo,window.latestUserData)),Boolean(e||BeFunky.isPaywallEnabled())}}BFN.SingletonQueue.add(()=>{BFN.BfnService=new Ue});var Ge="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function He(e,t){return e(t={exports:{}},t.exports),t.exports}var ze=He(function(e){var t,i;t=Ge,i=function(){var e={strSeed:null,shuffle:function(e,t,i){if("Array"==this.getType(e)&&this.setSeed(t)){for(var r=i?e.slice(0):e,a=r.length,n=this.genMap(a),o=a-1;o>0;o--)r[o]=r.splice(n[a-1-o],1,r[o])[0];return r}return null},unshuffle:function(e,t,i){if("Array"==this.getType(e)&&this.setSeed(t)){for(var r=i?e.slice(0):e,a=r.length,n=this.genMap(a),o=1;o<a;o++)r[o]=r.splice(n[a-1-o],1,r[o])[0];return r}return null},genMap:function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=(this.__seed=(9301*this.__seed+49297)%233280)/233280*e|0;return t},setSeed:function(e){if(!/(number|string)/i.test(this.getType(e)))return!1;if(isNaN(e))e=String(this.strSeed=e).split("").map(function(e){return e.charCodeAt(0)}).join("");return this.__seed=this.seed=Number(e)},getType:function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1]}};return Object.create(e)},e.exports?e.exports=i():t.SeededShuffle=i()});class Xe{constructor(){this.init()}init(){this.imagesPerPage=50,this.shuffleSeed=Math.random(),this.stockImageCache={},this.stockImagePageCounts={},this.pixabayKey="c29a6650081dcabb5c5d",this.unsplashRequestOptions={headers:{Authorization:"Client-ID 3f2a6b79c3a00722090d52eb4bf3e932ecfe712cf3d52b57652f2f1b8cc95351"}},this.unsplashDownloadEndpoint="https://api.unsplash.com/photos/{{id}}/download",this.unsplashDownloadIds=[],this.pexelsAPIKey="563492ad6f917000010000014a77ae091e0b4c91a1fe80aafee7f864",this.hasHitPexelsRateLimit=!1}deleteBeFunkyPhoto(e,t){return BFN.BfnService.userLoggedIn?BeFunky.requestAPI("photo/delete-image",{imgIds:e},t).then(e=>{if("success"!==e.data)throw"invalid_response";return e}):Promise.reject("not_logged_in")}getStockImages(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;if([/black leaders?/i,/black power/i].find(e=>e.test(t)))return i({error:"no_relevant_results"});var r={pixabay:this.getPixabayImages.bind(this),unsplash:this.getUnsplashImages.bind(this),pexels:this.getPexelsImages.bind(this)},a=Object.keys(r),n=[];function o(e){if(n.push(e),!(n.length<a.length)){var t=n.map(e=>e.error).filter(Boolean);if(t.length===a.length){var r="no_results";return t.every(e=>"no_results"!==e)&&(r=t[0]),i({error:r})}var o=[],l=0;n.filter(e=>!e.error).forEach(e=>{var t=e.data,i=e.totalPages;o=o.concat(t),l=Math.max(l,i)}),i({data:s(o),totalPages:l})}}function s(e){return e.sort((e,t)=>e.imageURL>t.imageURL),ze.shuffle(e,this.shuffleSeed),e}o=o.bind(this),s=s.bind(this),this.stockImagePageCounts[t]=this.stockImagePageCounts[t]||{},a.forEach(i=>{var a=this.stockImagePageCounts[t];a.hasOwnProperty(i)&&a[i]<e?o({error:"no_results"}):r[i]({page:e,imagesPerPage:25,keywords:t},e=>{e.hasOwnProperty("totalPages")?a[i]=e.totalPages:e.error&&"no_results"===e.error&&(a[i]=0),o(e)})})}getPixabayImages(e,t){var i=e.page,r=void 0===i?1:i,a=e.imagesPerPage,n=e.keywords;"featured"===n&&(n="urban");var o="https://pixabay.com/api/?".concat(["username=BeFunky","key=".concat(this.pixabayKey),"response_group=high_resolution","image_type=photo","per_page=".concat(a),"page=".concat(r),"q=".concat(n)].join("&")),s="".concat(BFN.userVo.uplUri,"/pixabay.php?q=").concat(encodeURIComponent(o));if(this.stockImageCache.hasOwnProperty(s))return t(this.stockImageCache[s]);BeFunky.request(s,{},e=>{var i=e.response,r=e.error;if(r)return t({error:r});if(!i||!Array.isArray(i.hits)||"number"!=typeof i.totalHits)return t({error:"invalid_response"});if(!i.hits.length)return t({error:"no_results"});var n={data:i.hits.map(this.createPixabayMenuImageVO.bind(this)),totalImages:i.totalHits,totalPages:Math.ceil(i.totalHits/a)};return this.stockImageCache[s]=n,t(n)})}createPixabayMenuImageVO(e){var t=new BFN.MenuImageVO;t.createId("pixabay",e.id_hash),t.imageURL=a(e.fullHDURL?e.fullHDURL:e.largeImageURL);var i=BFN.getExtension(t.imageURL.split("?")[0]);t.isTransparent="png"===i;var r=e.imageWidth/e.imageHeight;return t.thumbURL=a(e.webformatURL.replace("_640","_".concat(180))),t.thumbWidth=180*r,t.thumbHeight=180,t.author=e.user,t.authorURL="https://pixabay.com/en/users/".concat(e.user,"-").concat(e.user_id,"/"),t;function a(e){return e.startsWith("http://")&&(e=e.replace("http://","https://")),"".concat(e,"?permalink=befunky")}}getPixabayImageById(e){return new Promise((t,i)=>{var r="https://pixabay.com/api/?".concat(["username=BeFunky","key=".concat(this.pixabayKey),"id=".concat(e)].join("&")),a="".concat(BFN.userVo.uplUri,"/pixabay.php?q=").concat(encodeURIComponent(r));BeFunky.request(a,{},e=>{var r=e.response,a=e.error;if(a)return i(a);if(!r||!Array.isArray(r.hits)||"number"!=typeof r.totalHits)return i("invalid_response");if(!r.hits.length)return i("no_results");var n=this.createPixabayMenuImageVO(r.hits[0]);t(n)})})}getUnsplashImages(e,t){var i=e.page,r=void 0===i?1:i,a=e.imagesPerPage,n=e.keywords,o=["query=".concat(encodeURIComponent(n)),"page=".concat(r),"per_page=".concat(a)].join("&"),s="https://api.unsplash.com/search/photos/?".concat(o);if(this.stockImageCache.hasOwnProperty(s))return t(this.stockImageCache[s]);BeFunky.request(s,this.unsplashRequestOptions,e=>{var i=e.response,r=e.error;if(r)return t({error:r});if(!i||!Array.isArray(i.results)||"number"!=typeof i.total_pages)return t({error:"invalid_response"});if(!i.results.length)return t({error:"no_results"});var a={data:i.results.map(e=>{var t=new BFN.MenuImageVO;t.createId("unsplash",e.id),t.imageURL=e.urls.full;var i=e.width/e.height;return t.thumbURL=e.urls.small,t.thumbWidth=400,t.thumbHeight=400/i,t.author=e.user.name,t.authorURL="https://unsplash.com/@".concat(e.user.username,"?utm_source=befunky&utm_medium=referral"),this.unsplashDownloadEndpoint!==e.links.download_location.replace(e.id,"{{id}}")&&BeFunky.logError("Unsplash download reporting endpoint outdated."),t}),totalImages:i.total,totalPages:i.total_pages};return this.stockImageCache[s]=a,t(a)})}reportUnsplashImageDownload(e){if(e.startsWith("unsplash_")&&(e=e.replace("unsplash_","")),!this.unsplashDownloadIds.includes(e)){this.unsplashDownloadIds.push(e);var t=this.unsplashDownloadEndpoint.replace("{{id}}",e);BFN.MainUI.addIdleRenderFunction(()=>BeFunky.request(t,this.unsplashRequestOptions,e=>{var t=e.error;t&&BeFunky.logError("Unable to report image download to Unsplash: ".concat(t))}))}}getPexelsImages(e,t){var i=e.page,r=void 0===i?1:i,a=e.imagesPerPage,n=e.keywords;"featured"===n&&(n="outdoors");var o=BeFunky.addParamsToURL("https://api.pexels.com/v1/search",{page:r,per_page:a,query:n}),s={headers:{Authorization:this.pexelsAPIKey}};return this.stockImageCache.hasOwnProperty(o)?t(this.stockImageCache[o]):this.hasHitPexelsRateLimit?t({error:"no_results"}):void BeFunky.request(o,s,e=>{var i=e.response,r=e.error;if(r)return"string"!=typeof r||"rate limit exceeded"!==r.toLowerCase()&&"quota exceeded"!==r.toLowerCase()||(this.hasHitPexelsRateLimit=!0),t({error:r});if(!i||!Array.isArray(i.photos))return t({error:"invalid_response"});if("number"!=typeof i.total_results)return t({error:"invalid_response"});if(!i.photos.length)return t({error:"no_results"});var n={data:i.photos.map(e=>{var t=new BFN.MenuImageVO;t.createId("pexels",e.id),t.imageURL=e.src.original;var i=e.width/e.height;return t.thumbURL=e.src.medium,t.thumbWidth=Math.round(350*i),t.thumbHeight=350,t.author=e.photographer,t.authorURL=e.photographer_url,t}),totalImages:i.total_results,totalPages:Math.ceil(i.total_results/a)};return this.stockImageCache[o]=n,t(n)})}}BFN.SingletonQueue.add(()=>{BFN.ImageLibraryService=new Xe});class je{constructor(){this.init()}init(){this.fetchingTagsPromise=null,this.fetchingEditorsChoicePromise=null}getTags(){return this.fetchingTagsPromise?this.fetchingTagsPromise:(this.fetchingTagsPromise=BeFunky.requestAPI("get/photo/all-graphic-tags").then(e=>{var t=e.data;if(!Array.isArray(t.items))throw"invalid_response";return t.items.includes("all_items")||t.items.push("all_items"),this.tags=t.items,t.items}).catch(e=>(this.fetchingTagsPromise=null,Promise.reject(e))),this.fetchingTagsPromise)}getGraphics(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];0===(e=e.toLowerCase().trim().replace(/\s+/g,"_")).length&&(e="all_items");var n={t:e,isq:this.tags.includes(e)?1:0,v:t,start:100*(i-1),end:r};!0===a&&(n.rev_0=1);var o=BeFunky.requestAPI("photo/search-graphics",n),s=o.then(e=>{var t=e.data.items;if(!Array.isArray(t))throw"invalid_response";if(!t.length)throw"no_results";var i=this.graphicDataToMenuImageVO(t).filter((e,t,i)=>i.findIndex(t=>{return t.id===e.id})===t);return i.length!==t.length&&BeFunky.logError("Ignoring ".concat(t.length-i.length," duplicate graphics")),i.sort((e,t)=>{return(e.isPlus?1:0)-(t.isPlus?1:0)}),i});return s.request=o.request,s}getEditorsChoiceGraphics(){return this.fetchingEditorsChoicePromise?this.fetchingEditorsChoicePromise:(this.fetchingEditorsChoicePromise=BeFunky.requestAPI("get/photo/editors-choice-graphics").then(e=>{var t=e.data;if("object"!=typeof t)throw"invalid_response";return t}).catch(e=>("request_failed"!==e&&BeFunky.throwError("Invalid data received from graphics editors choice JSON",e),this.fetchingEditorsChoicePromise=null,Promise.reject(e))),this.fetchingEditorsChoicePromise)}graphicDataToMenuImageVO(e){var t=BeFunky.isRetina();return e.map(e=>{var i=e.f,r=e.g,a=e.t,n=e.rev,o=e.v,s=1!==parseInt(i),l=r.split(".")[0],h="svg"===BFN.getExtension(r),c=new BFN.MenuImageVO;c.createId("graphic",l);var u="".concat(BFN.goodiesUrl+BFN.goodiesAssetsFolder.original).concat(r);c.isTransparent=!0,c.isSVG=h,c.indexedDBKey=h?"svg__".concat(c.id):"image__".concat(c.id),c.isPlus=s,c.trackingID="".concat(a,"_").concat(l),c.style=o,c.isReviewed=1===n;var d=t?200:130;return h?(c.thumbURL=u,c.imageURL=u):(c.thumbURL="".concat(u,"?w=").concat(d,"&h=").concat(d,"&fit=bounds"),c.imageURL="".concat(u,"?io=off")),c})}}BFN.SingletonQueue.add(()=>{BFN.GraphicLibraryService=new je});class We{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.localAssetIDs=null,this.localAssetSections=["editor","collage","designer","imagemanager","graphicmanager"],this.localAssetTypes=["image","svg"],this.getLocalAssetIDs=new Promise(e=>{BFN.IndexedDB.get("options__localAssetIDs").then(e=>{if(!e||"object"!=typeof e)throw"";this.localAssetIDs=e}).catch(()=>{this.localAssetIDs={}}).then(e)}),this.getLocalAssetIDs.then(()=>{BFN.IndexedDB.keys().then(e=>{e.filter(e=>!!this.localAssetTypes.find(t=>e.startsWith("".concat(t,"__")))).filter(e=>!Array.isArray(this.localAssetIDs[e])).forEach(e=>{BFN.IndexedDB.delete(e)})}).catch(BeFunky.logError)}),this.persistLocalAssetIDs=BeFunky.debounce(this.persistLocalAssetIDs.bind(this),100)}getLocalAsset(e,t){return this.localAssetTypes.includes(e)?"string"==typeof t&&t.includes("_")?new Promise((i,r)=>{var a="".concat(e,"__").concat(t);BFN.IndexedDB.get(a).then(e=>{if(!e)throw"Local asset ".concat(a," could not be found in IndexedDB");i(e)}).catch(r)}):Promise.reject("Invalid key"):Promise.reject("Invalid type")}localAssetExists(e,t){return this.getLocalAssetIDs.then(()=>!!Array.isArray(this.localAssetIDs["".concat(e,"__").concat(t)])&&this.getLocalAsset(e,t).then(()=>!0).catch(()=>!1))}setLocalAsset(e,t,i,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.getLocalAssetIDs.then(()=>{if(!this.localAssetSections.includes(e))throw"Invalid sectionID";if(!this.localAssetTypes.includes(t))throw"Invalid type";if("string"!=typeof i||!i.includes("_"))throw"Invalid key";if(!(a||"string"==typeof r||r instanceof Blob))throw"Invalid value: ".concat(BeFunky.getType(r));var n="".concat(t,"__").concat(i),o=this.localAssetIDs[n];if(Array.isArray(o)?o.includes(e)||(o.push(e),this.persistLocalAssetIDs()):(this.localAssetIDs[n]=[e],this.persistLocalAssetIDs()),!a)return BFN.IndexedDB.set(n,r)})}removeLocalAsset(e,t,i){return this.getLocalAssetIDs.then(()=>{if(!this.localAssetSections.includes(e))throw"Invalid sectionID";if(!this.localAssetTypes.includes(t))throw"Invalid type";if("string"!=typeof i||!i.includes("_"))throw"Invalid key";var r="".concat(t,"__").concat(i),a=this.localAssetIDs[r];Array.isArray(a)&&a.includes(e)&&(a.splice(a.indexOf(e),1),a.length||(delete this.localAssetIDs[r],BFN.IndexedDB.delete(r)),this.persistLocalAssetIDs())})}clearLocalAssets(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.getLocalAssetIDs.then(()=>{if(!this.localAssetSections.includes(e)&&"all"!==e)return Promise.reject("Invalid sectionID");Object.keys(this.localAssetIDs).filter(e=>!t.includes(e)).forEach(t=>{var i=this.localAssetIDs[t],r=i.indexOf(e);-1!==r?i.splice(r,1):"all"===e&&i.splice(0),i.length||(delete this.localAssetIDs[t],BFN.IndexedDB.delete(t))}),this.persistLocalAssetIDs()})}persistLocalAssetIDs(){BFN.IndexedDB.set("options__localAssetIDs",this.localAssetIDs)}getLocalProject(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.logLevel,a=void 0===r?"console":r,n=i.showLoadScreen,o=void 0!==n&&n,s=i.excludeAssets,l=void 0!==s&&s,h=i.excludeThumbnail,c=void 0!==h&&h,u=i.fallbackToCanvas,d=void 0===u||u;return new Promise((i,r)=>{if(!["editor","collage","designer"].includes(e))return r("Invalid sectionID");var n=!1;o&&BeFunky.showLoadScreen({onCancel:()=>{n=!0,BeFunky.logError("User cancelled ".concat(e," project load")),r("Cancelled by user")}});var s=BFN.IndexedDB.get("project__".concat(e)),h="editor"===e?this.getLocalAsset("image","editor_canvas_image").then(e=>{if(e instanceof Blob&&!n){var t=e;return new Promise(e=>{BFN.BlobUtils.blobToArrayBuffer(t,i=>{var r=i.error;e(r?"invalid_editor_image_blob":t)})})}return e}).catch(()=>void 0):Promise.resolve(),u=c?Promise.resolve(null):this.getLocalAsset("image","".concat(e,"_thumb")).catch(()=>null);Promise.all([s,u,h]).then(r=>{var s=t(r,3),h=s[0],u=s[1],m=s[2];if(!n){if(!h)throw"No saved project exists";if("editor"===e&&"invalid_editor_image_blob"===m)throw"invalid_editor_image_blob";if("editor"===e&&(h.editorImageBase64=h.editorImageBase64||m),"editor"===e&&!h.editorImageBase64)throw"missing_editor_image_blob";if(!BFN.ProjectManager.validateProject(h,{logLevel:a}))throw"Saved ".concat(e," project is invalid");if(c?h.thumbBase64=null:(h.thumbBase64=h.thumbBase64||u,h.thumbBase64||h._wasReset||BeFunky.logError("".concat(e," project thumbnail was not found in IndexedDB"))),l)return o&&BeFunky.hideLoadScreen(),i(h);BFN.ProjectService.addImagesToProject(h,{showLoadScreen:o,fallbackToCanvas:d}).then(i)}}).catch(e=>{o&&BeFunky.hideLoadScreen(),r(e)})})}getAutosavedProjectThumbnail(e){return["editor","collage","designer"].includes(e)?this.getLocalAsset("image","".concat(e,"_thumb")).then(e=>{if(!t(e))throw"no_thumbnail";return e}).catch(()=>BFN.IndexedDB.get("project__".concat(e)).then(e=>{if(!e)throw"no_autosave";if(!t(e.thumbBase64))throw"no_thumbnail";return e.thumbBase64})):Promise.reject("Invalid sectionID");function t(e){return e instanceof Blob||"string"==typeof e&&e.startsWith("data:image")}}addImagesToProject(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.showLoadScreen,r=void 0!==i&&i,a=t.fallbackToCanvas,n=void 0===a||a;return new Promise(t=>{var i=!1;r&&BeFunky.showLoadScreen({message:"loading_project_assets",onCancel:()=>{i=!0,BeFunky.logError("User cancelled ".concat(e.section," project asset loading")),t(e)}});var a=0,o=0,s=e.imageDataKeys,l=e.svgDataKeys;e.imageDataKeys=[],e.svgDataKeys=[];var h=s.map(t=>BFN.ProjectService.getLocalAsset("image",t).catch(r=>{if(a++,BeFunky.logError("Unable to fetch project image blob ".concat(t," from IndexedDB:"),r),!i&&n)return this.getAssetBlobFromTextureOnCanvas(e.section,t).then(e=>(o++,console.log("Extracted project image blob ".concat(t," from canvas")),e),e=>{BeFunky.logError("Unable to extract project image blob ".concat(t," from canvas:"),e)})}).then(r=>{i||r&&(e.imageData[t]=r)})),c=l.map(t=>BFN.ProjectService.getLocalAsset("svg",t).then(r=>{i||(e.svgData[t]=r)}).catch(e=>{a++,BeFunky.logError("Unable to fetch project svg string ".concat(t," from IndexedDB:"),e)}));Promise.all([...h,...c]).then(()=>{if(a)if(a===o)BeFunky.throwError("Recovered one or more project images from canvas",{errorCount:a,recoveredCount:o});else{var s=BFN.IndexedDB.disabledReason?"memory":"IndexedDB";BeFunky.throwError("Unable to fetch one or more project images from ".concat(s).concat(n?" w/ canvas fallback":""),{errorCount:a,recoveredCount:o})}!i&&r&&BeFunky.hideLoadScreen(),t(e)})})}saveLocalProject(e,t){return["editor","collage","designer"].includes(e)?BFN.IndexedDB.set("project__".concat(e),t):Promise.reject("Invalid sectionID")}removeLocalProject(e){return["editor","collage","designer"].includes(e)?BFN.IndexedDB.delete("project__".concat(e)):Promise.reject("Invalid sectionID")}getAssetBlobFromTextureOnCanvas(e,t){var i={editor:BFN.PhotoEditorCanvas,collage:BFN.CollageMakerCanvas,designer:BFN.DesignerCanvas}[e].transformLayer.children,r="collage"===e?BFN.CollageMakerCanvasPhotoGrid.photoGrid.gridChildren:[],a=i.filter(e=>e instanceof BFN.TransformItem).find(e=>"frame_texture"===e.type&&e.projectItemVO.maskImageID===t||"texture"===e.type&&e.projectItemVO.imageID===t),n=r.find(e=>e.projectItemVO.gridCellImageID===t);if(!a&&!n)return Promise.reject("No matching Transform Item or Grid Cell");var o=a?a.itemContent.texture:n.childContent.image.texture,s=(o||{}).baseTexture;if(!s)return Promise.reject("No baseTexture in ".concat(a?"Transform Item":"Grid Cell"));var l=new PIXI.Texture(s),h=o.determineTransparency(),c=BeFunky.isFirefox||h?.99:1;return console.log("Got texture for asset",t,"".concat(s.width," x ").concat(s.height),{isTransparent:h}),setTimeout(()=>{l.destroyGC(!1)},0),BFN.TextureUtils.textureToBlobWithErrorHandling(l,{isTransparent:h,quality:c})}}BFN.SingletonQueue.add(()=>{BFN.ProjectService=new We});class Ye{constructor(){this.init()}init(){}resetProjectData(){BeFunky.SavedProjectFetcher.resetProjectData()}getFirst100Projects(){return BeFunky.SavedProjectFetcher.getFirst100Projects()}getAllProjects(){return BeFunky.SavedProjectFetcher.getAllProjects()}searchProjects(e){return BeFunky.SavedProjectFetcher.searchProjects(e)}fetchBFD(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).showLoadScreen,i=void 0===t||t;return new Promise((t,r)=>{console.log("Downloading BFD",e);var a,n=e=>{i&&BeFunky.hideLoadScreen(),r(e)},o=!1,s=!1;setTimeout(()=>{o||(s=!0)},200),i&&BeFunky.showLoadScreen({onCancel:()=>{n("cancelled_by_user"),o=!0,a.abort()},message:"downloading"});var l={responseType:"blob",downloadProgressHandler:(e,t)=>{s&&i&&BeFunky.updateLoadScreenProgress("downloading",100*e/t)}};a=BeFunky.request(e,l,e=>{var r=e.response,a=e.error;if(!o)return a?n(a):void this.decodeProjectFile(r,e=>{var r=e.data,a=e.error;if(a)return n(a);BFN.ObjectCompressor.decompress(r).then(e=>{if("object"!=typeof e||!e)throw"invalid_bfd";(e=>{i&&BeFunky.hideLoadScreen(),t(e)})(e)}).catch(n)})})})}decodeProjectFile(e,t){BFN.BlobUtils.blobToText(e,e=>{var i=e.text,r=e.error;return t(r?{error:r}:{data:i})})}saveBfdFileToBeFunky(e,t){var i=e.bfdBlob,r=e.thumbnailBlob,a=e.uploadProgressHandler,n=e.date,o=e.projectObject;if(!BFN.BfnService.userLoggedIn)return t({error:"not_logged_in"});var s={bucket:"befunkydesigner",content_type:"text/plain",blob:i};window.DirectUPL.upload(e=>{if(!e||!e.url||!e.s3_name)return t({error:"invalid_response"});var a=e.s3_name,s="".concat(a,"_thumb.").concat("image/png"===r.type?"png":"jpg"),l={bucket:"befunkydesigner",content_type:r.type,blob:r,filename:s};window.DirectUPL.upload(e=>{if(!e||!e.url||!e.s3_name)return t({error:"invalid_response"});var r=o.transformLabels.map(e=>e.labelText).map(e=>e.replace(/\s+/g," ").trim()).filter(e=>e&&!BFN.FabricManager.isDefaultText(e)).join(" ").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"").slice(0,1e3),l=e=>btoa(encodeURIComponent(e)),h={bfdname:a,thumbname:s,filename:l(o.filename),content:l(r),p_type:o.section,source_template:o.sourceTemplateID||"",width:o.projectWidth,height:o.projectHeight,size:Math.round(i.size/1024)};n&&(h.creation_date=n),BeFunky.requestAPI("photo/projects/add",h).then(e=>{if("success"!==e.data)throw"invalid_response";t({data:"success"})}).catch(e=>{t({error:e})})},l)},s);var l=void 0!==window.DirectUPL&&null!==window.DirectUPL?window.DirectUPL.uploadReq:void 0;BeFunky.addProgressHandler(l,a,!0)}deleteBfdFile(e,t){return BeFunky.SavedProjectFetcher.deleteBfdFile(e,t)}}BFN.SingletonQueue.add(()=>{BFN.SavedProjectService=new Ye});class qe{constructor(){this.init()}init(){}uploadImage(e,t){if(!BFN.BfnService.userLoggedIn)return t({error:"not_logged_in"});var i=()=>{var i="".concat(BFN.userVo.uplUri,"/restupload/bfns3uploader.bfn"),r={method:"POST",body:BeFunky.createFormData({image_type:e.type,bucket:"bfnwatermark",image:e,CSRFtoken:getCsToken()})};BeFunky.request(i,r,e=>{var i=e.response,r=e.error;if(r)return t({error:r});i&&i.url&&i.s3_name?t({url:i.url,name:i.s3_name}):t({error:"invalid_response"})})};void 0!==window.DirectUPL?window.DirectUPL.upload(e=>{e&&e.url&&e.s3_name?t({url:e.url,name:e.s3_name}):i()},{bucket:"bfnwatermark",content_type:e.type,blob:e}):i()}deleteImage(e,t){t&&t({success:!0,url:e})}}BFN.SingletonQueue.add(()=>{BFN.BfnWatermarkService=new qe});class Ke{constructor(){this.init()}init(){this.tags=[],this.fetchingTagsPromise=null}getTags(){return Array.isArray(this.tags)&&this.tags.length?Promise.resolve(this.tags):this.fetchingTagsPromise?this.fetchingTagsPromise:(this.fetchingTagsPromise=BeFunky.requestAPI("get/photo/all-designer-template-tags").then(e=>{var t=e.data;if(!Array.isArray(t.items))throw"invalid_response";return this.tags=t.items,t.items}).catch(e=>(this.fetchingTagsPromise=null,Promise.reject(e))),this.fetchingTagsPromise)}getTemplates(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof e)return Promise.reject("invalid_tag");var a={t:e=e.toLowerCase().trim().replace(/\s+/g,"_"),isq:this.tags.includes(e)?1:0,start:100*(t-1),end:i,all_templates:r?1:0};return BeFunky.requestAPI("photo/search-designer-templates",a).then(e=>{var t=e.data.items;if(!Array.isArray(t))throw"invalid_response";if(!t.length)throw"no_results";return t.map(this.cleanupTemplateObject).filter(e=>e.hasValidDimensions)})}getTemplate(e){return BeFunky.requestAPI("photo/get-designer-template",{id:e}).then(t=>{var i=t.data;if(!Array.isArray(i.items))throw"invalid_response";if(!i.items.length)throw"no_results";var r=i.items,a=["blank","dim","f","n","rev","tmp"],n=[];r.length>1&&r.slice(1).forEach(e=>{a.forEach(t=>{e[t]!==r[0][t]&&n.push(t)})}),n.length&&BeFunky.throwError("Invalid tag data for template ".concat(e,": Mismatched ").concat(n.unique().join(", ")));var o=this.cleanupTemplateObject(r[0]);return o.tags=r.map(e=>e.t),o})}getEditorsChoiceTemplates(){return BeFunky.requestAPI("get/photo/editors-choice-templates").then(e=>{if(!Array.isArray(e.data.tags))throw"invalid_response";var t=e.data.tags;return t.forEach(e=>{e.items=e.items.map(this.cleanupTemplateObject)}),t}).catch(e=>(BeFunky.throwError("Invalid data received from editors choice JSON",e),[]))}cleanupTemplateObject(e){var t=e.f,i=e.tmp,r=e.n,a=e.dim,n=e.blank,o=e.t,s=e.rev,l=e.version,h=e.creation,c=Boolean(BFN.DesignerTemplateManager.parseDimensions(a));return c||BeFunky.throwError("Designer template has invalid dimensions: ".concat(i," -- ").concat(a)),{id:i,isPlus:1!==parseInt(t),isBlank:parseInt(n)>0,isReviewed:1===parseInt(s),tagID:o,version:l,displayName:r,dimensions:a,hasValidDimensions:c,creationDate:h}}templateObjectsToMenuImageVOs(e){var t=BeFunky.isRetina();return e.map(e=>{var i=e.id,r=e.isPlus,a=e.isBlank,n=e.isReviewed,o=e.tagID,s=e.version,l=e.displayName,h=e.dimensions,c=e.creationDate,u=new BFN.MenuImageVO;return u.createId("designer_template",i),u.isBlank=a,u.isReviewed=n,u.version=s,u.displayName=l,u.dimensions=h,u.projectFileName="".concat(i,".bfd"),u.groupID=c,u.setObject({isPlus:r,trackingID:"".concat(o,"_").concat(i)}),Object.assign(u,BFN.DesignerTemplateManager.getTemplateImages({id:i,isBlank:a,dimensions:h,version:s,isRetina:t})),u})}}BFN.SingletonQueue.add(()=>{BFN.DesignerTemplateService=new Ke});var Qe={CONST:{NOT_SUPPORTED:0,hdConstraints:{video:{width:{exact:1280},height:{exact:720}}},vgaConstraints:{video:{width:{exact:640},height:{exact:360}}},hdMandatory:{video:{width:1280,height:720}}}};BFN.isWebCamSupported=(()=>!!(navigator.getUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia));BFN.WebcamRecorder=class{constructor(e,t,i,r){this.supported=!1,this.errCallback=t,this.videoElement=e,this.constraints=r||Qe.CONST.hdConstraints,this.isAudio=i||!1,this.localMediStream=null,this.init()}init(){this.supported=BFN.isWebCamSupported();var e=this.constraints;if(e.audio=this.isAudio,this.supported){var t=i=>{navigator.mediaDevices.getUserMedia(e).then(e=>this.handleStream(e)).catch(()=>{i?((e=Qe.CONST.hdMandatory).audio=!1,t()):this.errCallback("not_available")})};t(!0)}}handleStream(e){if(this.localMediStream=e,navigator.mozGetUserMedia)try{this.videoElement.mozSrcObject=this.localMediStream,this.videoElement.srcObject=this.localMediStream}catch(e){}else try{this.videoElement.srcObject=this.localMediStream}catch(e){try{var t=URL.createObjectURL(this.localMediStream);this.videoElement.src=t}catch(e){}}this.videoElement.onloadedmetadata=(()=>{this.start()})}getSnapshot(e){var t=document.createElement("canvas");t.width=this.constraints.video.width.exact,t.height=this.constraints.video.height.exact;var i=t.getContext("2d");i.drawImage(this.videoElement,0,0),t.toBlob(r=>{i=null,t=null,e(r)},"image/webp")}stop(e){try{this.videoElement.pause()}catch(e){}if(!e){try{this.localMediStream.getTracks().forEach(e=>{e.stop()})}catch(e){try{this.localMediStream.getVideoTracks()[0].stop()}catch(e){try{this.localMediStream.stop()}catch(e){}}}try{URL.revokeObjectURL(this.videoElement.src),this.videoElement.src="",this.videoElement.srcObject=null}catch(e){}}}start(){try{this.videoElement.play()}catch(e){}}};class Ze{constructor(){this.isZlibEnabled=!!window.pako}isJSONString(e){if("string"!=typeof e)return!1;try{JSON.parse(e)}catch(e){return!1}return!0}compress(e){return new Promise(t=>{t(JSON.stringify(e))})}decompress(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((i,r)=>{if(t&&"string"==typeof e)try{return i(JSON.parse(e))}catch(e){}var a=null,n=null;if(!this.isZlibEnabled)return r("no_zlib");try{a=pako.inflate(e,{gzip:!0,to:"string"})}catch(e){n=e}e="incorrect header check"===n?atob(e):t&&!this.isJSONString(a)?atob(a):a,i(t?JSON.parse(e):e)})}}BFN.SingletonQueue.add(()=>{BFN.ObjectCompressor=new Ze});class Je{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.inFlightMaskImageURLs=[],this.swappedFonts={}}objectToProjectVO(e){return new Promise((t,i)=>{"1.0"===e.version?this.prepareV1(e).then(e=>BFN.FlashProjectParser.parseFlashProject(e,t)):this.prepareV2(e).then(e=>BFN.ProjectManager.getProjectVO(e)).catch(i).then(t)})}prepareV1(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isSourceTemplate,i=void 0!==t&&t;i?(this.swappedFonts={},console.log("Loading Flash source template")):console.log("Loading BFD v1 saved from Flash");var r=!1;i||UIToggler.toggleLoadScreen(!0,{message:"loading_project_assets",onCancel:()=>{r=!0,this.abortPrepare()}});var a=[...e.transformLabelStates.map(this.translateLabelState.bind(this)),this.fetchDesignerElementSvgData(e),this.decodeTemplateElementSvgData(e),this.fetchMaskImages(e)];return i||a.push(this.fetchSourceTemplate(e)),Promise.all(a).then(()=>{if(r)throw"User cancelled BFD asset loading.";return i||UIToggler.toggleLoadScreen(!1),e})}prepareV2(e){this.swappedFonts={};var t=!1;UIToggler.toggleLoadScreen(!0,{onCancel:()=>{t=!0,this.abortPrepare()}});var i=[...e.transformLabels.map(e=>{var t=e.labelTextStyles,i=e.labelText;return t.compressedStyles&&(t.styles=this.decompressCharacterStyles(t.compressedStyles),delete t.compressedStyles),this.loadAndValidateFonts(t,i).then(t=>{e.labelText=t})})];return Promise.all(i).then(()=>{if(t)throw"User cancelled BFD asset loading.";return UIToggler.toggleLoadScreen(!1),e})}abortPrepare(){UIToggler.toggleLoadScreen(!1),this.inFlightMaskImageURLs.map(e=>BeFunky.inFlightRequests[e]).filter(Boolean).forEach(e=>e.abort())}translateLabelState(e){return this.translateLabelHTML(e).then(t=>{var i=t.labelText,r=t.labelTextStyles;e.labelText=i,e.labelTextStyles=r;["labelHTMLText","labelLetterSpacing","labelTextAlign","labelFontFamily","labelTintColor","labelTintColorEnabled","labelTintMultiplier","labelStrokeAlpha","labelStrokeColor","labelStrokeEnabled","labelBackgroundAlpha","labelBackgroundColor","labelBackgroundEnabled"].forEach(t=>{delete e[t]})})}translateLabelHTML(e){var t=[...(new DOMParser).parseFromString(e.labelHTMLText,"text/html").querySelectorAll("p")];return new Promise(a=>{var n="",o={textAlign:i(t[0]),charSpacing:r(t[0]),lineHeight:BFN.TransformItemTextBaseLineHeight,styles:{}},s={fontFamily:{attributeName:"face",transform:e=>e},fontSize:{attributeName:"size",transform:e=>e=parseInt(e)||20},fill:{attributeName:"color",transform:t=>{if(!e.labelTintColorEnabled)return"#00000000";var i=t&&t.startsWith("#")?t.replace("#",""):BFN.ColorUtil.hexNumberToHexString(e.labelTintColor),r=e.labelTintMultiplier;return BFN.ColorUtil.hexStringObjectToRGBAString({hex:i,alpha:r})}},stroke:{transform:()=>{if(!e.labelStrokeEnabled)return"";var t=BFN.ColorUtil.hexNumberToHexString(e.labelStrokeColor),i=e.labelStrokeAlpha;return BFN.ColorUtil.hexStringObjectToRGBAString({hex:t,alpha:i})}},fontWeight:{transform:()=>""},textBackgroundColor:{transform:()=>{if(!e.labelBackgroundEnabled)return"";var t=BFN.ColorUtil.hexNumberToHexString(e.labelBackgroundColor),i=e.labelBackgroundAlpha;return BFN.ColorUtil.hexStringObjectToRGBAString({hex:t,alpha:i})}}};t.forEach((e,t)=>{t>0&&(n+="\n");var i=0,r={};o.styles[t]=r;var a=e.children[0];[...a.childNodes].forEach(e=>{var t=1===e.nodeType,o={};Object.keys(s).forEach(i=>{var r,n=s[i],l=n.attributeName,h=n.transform;l&&(r=t&&e.getAttribute(l)||a.getAttribute(l)),o[i]=h(r)}),function(e){return decodeURIComponent(Array.prototype.map.call(e,e=>"%".concat("00".concat(e.charCodeAt(0).toString(16)).slice(-2))).join(""))}(e.textContent).split("").forEach(e=>{n+=e,r[i]=Object.assign({},o),i++})})}),this.loadAndValidateFonts(o,n).then(e=>{a({labelTextStyles:o,labelText:e})})});function i(e){var t;try{t=e.getAttribute("align").toLowerCase()}catch(e){}return["left","center","right"].includes(t)?t:"left"}function r(e){var t;try{t=e.children[0].getAttribute("letterspacing")}catch(e){}if((t=parseInt(t)||0)<=0)t=0;else{t=Math.round(100+t/2.5*100)}return t=Math.min(1e3,t)}}fetchDesignerElementSvgData(e){return new Promise(t=>{var i=e.designerElementStates,r={},a=0,n=0;function o(){a>n||(e.designerElementSvgData=r,t())}Object.keys(i).forEach(e=>{Object.keys(i[e]).forEach(e=>{a++;var t="".concat(BFN.designerElementsUrl+e,".svg");BFN.RequestUtils.getText(t,t=>{var i=t.text,a=t.error;n++,a?(BeFunky.logError(a),r[e]=null):r[e]=i,o()})})}),o()})}decodeTemplateElementSvgData(e){return new Promise(t=>{if(!e.templateElementSvgData)return t();var i=Object.keys(e.templateElementSvgData).map(t=>BFN.ObjectCompressor.decompress(e.templateElementSvgData[t],!1).then(i=>{e.templateElementSvgData[t]=i}).catch(BeFunky.logError));Promise.all(i).then(t)})}fetchMaskImages(e){return new Promise(t=>{if(!e.transformMaskImageStates)return t();var i={},r=e=>(i[e]||(i[e]=new Promise((t,i)=>{var r="".concat(BFN.userVo.uplUri,"/loadImage.php?c=").concat(encodeURIComponent(e));this.inFlightMaskImageURLs.push(e,r),BFN.RequestUtils.getBase64WithFallback(e,r,a=>{var n=a.error,o=a.base64;n&&i(n),t(o),[e,r].forEach(e=>{var t=this.inFlightMaskImageURLs.indexOf(e);-1!==t&&this.inFlightMaskImageURLs.splice(t,1)})})})),i[e]);e.transformMaskImageStates.forEach(e=>{e.maskImageBase64=e.maskImageBase64||null,!e.maskImageBase64&&e.maskImageURL&&r(e.maskImageURL).then(t=>{e.maskImageBase64=t}).catch(e=>{BeFunky.logError("Unable to load mask image base64:",e)})}),Promise.all(Object.values(i).map(e=>e.catch(()=>{}))).then(t)})}fetchSourceTemplate(e){return new Promise(t=>{if(!e.sourceTemplateID)return t();var i="".concat(BFN.designerTemplateFlashURL).concat(e.sourceTemplateID,".bfd"),r=i=>{BeFunky.logError(i),e.sourceTemplate=null,t()};BFN.SavedProjectService.fetchBFD(i,{showLoadScreen:!1}).then(i=>{this.prepareV1(i,{isSourceTemplate:!0}).then(i=>{e.sourceTemplate=i,t()}).catch(e=>{r("Unable to prepare source template: ".concat(e))})},e=>r("Unable to fetch source template: ".concat(e)))})}loadAndValidateFonts(e,t){var i=e.styles,r=e.charSpacing,a=e.lineHeight,n=[],o={},s=BFN.FontManager.defaultFontFamily,h=t.split("\n").map(e=>"".concat(e,"\n")),c=[];return new Promise(u=>{var d=s;if(this.forEachCharacterStyle(i,(i,u,m)=>{var p=parseInt(u),f=parseInt(m),v=h[p]?h[p][f]:void 0;v&&"\n"!==v||(c.push({character:v,font:i.fontFamily}),i.fontFamily=void 0);var y,x=d;i.fontFamily&&(x=function(e){var t=BFN.FontManager.findSimilarFont(e);if(t)return BFN.FontManager.isLoaded(t)||(o[t]=BFN.FontManager.load(t)),t;if(!n.includes(e)){if(BFN.FontManager.addUserDefinedSystemFont(e))return e;BeFunky.logError('Unable to find custom font needed by BFD: "'.concat(e,'"')),n.push(e)}var i=l[e];if(i){var r=i.name;return BFN.FontManager.isLoaded(r)||(o[r]=BFN.FontManager.load(r)),this.swappedFonts[e]=r,i}return this.swappedFonts[e]?this.swappedFonts[e]:(this.swappedFonts[e]=s,s)}.call(this,i.fontFamily)),d=x,"string"==typeof x?y=g(x):(y=g(x.name),x.isBold&&(i.fontWeight="bold"),x.isAllCaps&&t[f]&&(t=function(e,t,i){return e.substr(0,t)+i+e.substr(t+i.length)}(t,f,t[f].toUpperCase())),x.sizeScale&&(i.fontSize=(i.fontSize*x.sizeScale).toFixed(1)),x.charSpacingIncrement&&(e.charSpacing=r+x.charSpacingIncrement),x.lineHeightScale&&(e.lineHeight=(a*x.lineHeightScale).toFixed(2)),i.fontFamily&&(this.swappedFonts[i.fontFamily]=x.name)),i.fontFamily=y}),!c.every(e=>{return"\n"===e.character})){var m=c.reduce((e,t)=>{return[...e,t.font].unique()},[]),p=t.replace(/\n/g," ");p.length>20&&(p="".concat(p.slice(0,20),"...")),BeFunky.logError("Ignored font of ".concat(c.length,' character styles in label "').concat(p,'" Fonts = ').concat(m.join(", ")))}var f=Object.keys(o),v=0;if(!f.length)return y();function y(){++v<f.length||u(t)}f.forEach(e=>{o[e].catch(t=>{BeFunky.logError(t);var r=g(e);BFN.ParseBFD.forEachCharacterStyle(i,t=>{if(t.fontFamily===r){var i=this.swappedFonts[e]||s;t.fontFamily=g(i),this.swappedFonts[e]=i}})}).then(y)})})}forEachCharacterStyle(e,t){Object.keys(e).forEach(i=>{var r=e[i];Object.keys(r).forEach(e=>{t(r[e],i,e)})})}decompressCharacterStyles(e){return e.reduce((e,i)=>{var r=i.indexes,a=i.styles;return r.forEach(i=>{var r=t(i.split(","),2),n=r[0],o=r[1];e[n]||(e[n]={}),e[n][o]=a}),e},{})}compressCharacterStyles(e){var t=[];return this.forEachCharacterStyle(e,(e,i,r)=>{var a="".concat(i,",").concat(r),n=JSON.stringify(e),o=t.find(e=>e.stylesString===n);o?o.indexes.push(a):t.push({indexes:[a],stylesString:n,styles:e})}),t.map(e=>(delete e.stylesString,e))}}BFN.SingletonQueue.add(()=>{BFN.ParseBFD=new Je});var $e,et=He(function(e,t){!function(){var i={};function r(e){return u(">"+m("B",e.length),e)}function a(e){return u(">"+m("H",e.length),e)}function n(e){return u(">"+m("L",e.length),e)}function o(e,t,i){var o,s,l,h,c="",d="";if("Byte"==t)(o=e.length)<=4?d=r(e)+m("\0",4-o):(d=u(">L",[i]),c=r(e));else if("Short"==t)(o=e.length)<=2?d=a(e)+m("\0\0",2-o):(d=u(">L",[i]),c=a(e));else if("Long"==t)(o=e.length)<=1?d=n(e):(d=u(">L",[i]),c=n(e));else if("Ascii"==t)(o=(s=e+"\0").length)>4?(d=u(">L",[i]),c=s):d=s+m("\0",4-o);else if("Rational"==t){if("number"==typeof e[0])o=1,l=e[0],h=e[1],s=u(">L",[l])+u(">L",[h]);else{o=e.length,s="";for(var p=0;p<o;p++)l=e[p][0],h=e[p][1],s+=u(">L",[l])+u(">L",[h])}d=u(">L",[i]),c=s}else if("SRational"==t){if("number"==typeof e[0])o=1,l=e[0],h=e[1],s=u(">l",[l])+u(">l",[h]);else{o=e.length,s="";for(p=0;p<o;p++)l=e[p][0],h=e[p][1],s+=u(">l",[l])+u(">l",[h])}d=u(">L",[i]),c=s}else"Undefined"==t&&((o=e.length)>4?(d=u(">L",[i]),c=e):d=e+m("\0",4-o));return[u(">L",[o]),d,c]}function s(e,t,i){var r,a=Object.keys(e).length,n=u(">H",[a]);r=["0th","1st"].indexOf(t)>-1?2+12*a+4:2+12*a;var s="",l="";for(var h in e)if("string"==typeof h&&(h=parseInt(h)),!("0th"==t&&[34665,34853].indexOf(h)>-1||"Exif"==t&&40965==h||"1st"==t&&[513,514].indexOf(h)>-1)){var c=e[h],d=u(">H",[h]),m=f[t][h].type,p=u(">H",[g[m]]);"number"==typeof c&&(c=[c]);var v=o(c,m,8+r+i+l.length);s+=d+p+v[0]+v[1],l+=v[2]}return[n+s,l]}function l(e){var t;if("ÿØ"==e.slice(0,2))t=function(e){for(var t,i=0;i<e.length;i++)if("ÿá"==(t=e[i]).slice(0,2)&&"Exif\0\0"==t.slice(4,10))return t;return null}(p(e)),this.tiftag=t?t.slice(10):null;else if(["II","MM"].indexOf(e.slice(0,2))>-1)this.tiftag=e;else{if("Exif"!=e.slice(0,4))throw new Error("Given file is neither JPEG nor TIFF.");this.tiftag=e.slice(6)}}if(i.version="1.0.4",i.remove=function(e){var t=!1;if("ÿØ"==e.slice(0,2));else{if("data:image/jpeg;base64,"!=e.slice(0,23)&&"data:image/jpg;base64,"!=e.slice(0,22))throw new Error("Given data is not jpeg.");e=c(e.split(",")[1]),t=!0}var i=p(e).filter(function(e){return!("ÿá"==e.slice(0,2)&&"Exif\0\0"==e.slice(4,10))}).join("");return t&&(i="data:image/jpeg;base64,"+h(i)),i},i.insert=function(e,t){var i=!1;if("Exif\0\0"!=e.slice(0,6))throw new Error("Given data is not exif.");if("ÿØ"==t.slice(0,2));else{if("data:image/jpeg;base64,"!=t.slice(0,23)&&"data:image/jpg;base64,"!=t.slice(0,22))throw new Error("Given data is not jpeg.");t=c(t.split(",")[1]),i=!0}var r="ÿá"+u(">H",[e.length+2])+e,a=function(e,t){var i=!1,r=[];e.forEach(function(a,n){"ÿá"==a.slice(0,2)&&"Exif\0\0"==a.slice(4,10)&&(i?r.unshift(n):(e[n]=t,i=!0))}),r.forEach(function(t){e.splice(t,1)}),!i&&t&&(e=[e[0],t].concat(e.slice(1)));return e.join("")}(p(t),r);return i&&(a="data:image/jpeg;base64,"+h(a)),a},i.load=function(e){var t;if("string"!=typeof e)throw new Error("'load' gots invalid type argument.");if("ÿØ"==e.slice(0,2))t=e;else if("data:image/jpeg;base64,"==e.slice(0,23)||"data:image/jpg;base64,"==e.slice(0,22))t=c(e.split(",")[1]);else{if("Exif"!=e.slice(0,4))throw new Error("'load' gots invalid file data.");t=e.slice(6)}var i={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},r=new l(t);if(null===r.tiftag)return i;"II"==r.tiftag.slice(0,2)?r.endian_mark="<":r.endian_mark=">";var a=d(r.endian_mark+"L",r.tiftag.slice(4,8))[0];i["0th"]=r.get_ifd(a,"0th");var n=i["0th"].first_ifd_pointer;if(delete i["0th"].first_ifd_pointer,34665 in i["0th"]&&(a=i["0th"][34665],i.Exif=r.get_ifd(a,"Exif")),34853 in i["0th"]&&(a=i["0th"][34853],i.GPS=r.get_ifd(a,"GPS")),40965 in i.Exif&&(a=i.Exif[40965],i.Interop=r.get_ifd(a,"Interop")),"\0\0\0\0"!=n&&(a=d(r.endian_mark+"L",n)[0],i["1st"]=r.get_ifd(a,"1st"),513 in i["1st"]&&514 in i["1st"])){var o=i["1st"][513]+i["1st"][514],s=r.tiftag.slice(i["1st"][513],o);i.thumbnail=s}return i},i.dump=function(e){var t,r,a,n,o,l,h=(t=e,JSON.parse(JSON.stringify(t))),c=!1,d=!1,m=!1,f=!1;r="0th"in h?h["0th"]:{},"Exif"in h&&Object.keys(h.Exif).length||"Interop"in h&&Object.keys(h.Interop).length?(r[34665]=1,c=!0,a=h.Exif,"Interop"in h&&Object.keys(h.Interop).length?(a[40965]=1,m=!0,n=h.Interop):Object.keys(a).indexOf(i.ExifIFD.InteroperabilityTag.toString())>-1&&delete a[40965]):Object.keys(r).indexOf(i.ImageIFD.ExifTag.toString())>-1&&delete r[34665],"GPS"in h&&Object.keys(h.GPS).length?(r[i.ImageIFD.GPSTag]=1,d=!0,o=h.GPS):Object.keys(r).indexOf(i.ImageIFD.GPSTag.toString())>-1&&delete r[i.ImageIFD.GPSTag],"1st"in h&&"thumbnail"in h&&null!=h.thumbnail&&(f=!0,h["1st"][513]=1,h["1st"][514]=1,l=h["1st"]);var v,y,x,_=s(r,"0th",0),I=_[0].length+12*c+12*d+4+_[1].length,T="",b=0,S="",C=0,B="",F=0,E="";(c&&(b=(v=s(a,"Exif",I))[0].length+12*m+v[1].length),d&&(C=(S=s(o,"GPS",I+b).join("")).length),m)&&(F=(B=s(n,"Interop",I+b+C).join("")).length);if(f&&(y=s(l,"1st",I+b+C+F),(x=function(e){var t=p(e);for(;"ÿà"<=t[1].slice(0,2)&&t[1].slice(0,2)<="ÿï";)t=[t[0]].concat(t.slice(2));return t.join("")}(h.thumbnail)).length>64e3))throw new Error("Given thumbnail is too large. max 64kB");var P="",N="",M="",D="\0\0\0\0";if(c){var w=u(">L",[k=8+I]);P=u(">H",[34665])+u(">H",[g.Long])+u(">L",[1])+w}if(d){w=u(">L",[k=8+I+b]);N=u(">H",[34853])+u(">H",[g.Long])+u(">L",[1])+w}if(m){w=u(">L",[k=8+I+b+C]);M=u(">H",[40965])+u(">H",[g.Long])+u(">L",[1])+w}if(f){var k;D=u(">L",[k=8+I+b+C+F]);var L="\0\0\0\0"+u(">L",[k+y[0].length+24+4+y[1].length]),O="\0\0\0\0"+u(">L",[x.length]);E=y[0]+L+O+"\0\0\0\0"+y[1]+x}var R=_[0]+P+N+D+_[1];return c&&(T=v[0]+M+v[1]),"Exif\0\0MM\0*\0\0\0\b"+R+T+S+B+E},l.prototype={get_ifd:function(e,t){var i,r={},a=d(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],n=e+2;i=["0th","1st"].indexOf(t)>-1?"Image":t;for(var o=0;o<a;o++){e=n+12*o;var s=d(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],l=[d(this.endian_mark+"H",this.tiftag.slice(e+2,e+4))[0],d(this.endian_mark+"L",this.tiftag.slice(e+4,e+8))[0],this.tiftag.slice(e+8,e+12)];s in f[i]&&(r[s]=this.convert_value(l))}return"0th"==t&&(e=n+12*a,r.first_ifd_pointer=this.tiftag.slice(e,e+4)),r},convert_value:function(e){var t,i=null,r=e[0],a=e[1],n=e[2];if(1==r)a>4?(t=d(this.endian_mark+"L",n)[0],i=d(this.endian_mark+m("B",a),this.tiftag.slice(t,t+a))):i=d(this.endian_mark+m("B",a),n.slice(0,a));else if(2==r)a>4?(t=d(this.endian_mark+"L",n)[0],i=this.tiftag.slice(t,t+a-1)):i=n.slice(0,a-1);else if(3==r)a>2?(t=d(this.endian_mark+"L",n)[0],i=d(this.endian_mark+m("H",a),this.tiftag.slice(t,t+2*a))):i=d(this.endian_mark+m("H",a),n.slice(0,2*a));else if(4==r)a>1?(t=d(this.endian_mark+"L",n)[0],i=d(this.endian_mark+m("L",a),this.tiftag.slice(t,t+4*a))):i=d(this.endian_mark+m("L",a),n);else if(5==r)if(t=d(this.endian_mark+"L",n)[0],a>1){i=[];for(var o=0;o<a;o++)i.push([d(this.endian_mark+"L",this.tiftag.slice(t+8*o,t+4+8*o))[0],d(this.endian_mark+"L",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else i=[d(this.endian_mark+"L",this.tiftag.slice(t,t+4))[0],d(this.endian_mark+"L",this.tiftag.slice(t+4,t+8))[0]];else if(7==r)a>4?(t=d(this.endian_mark+"L",n)[0],i=this.tiftag.slice(t,t+a)):i=n.slice(0,a);else if(9==r)a>1?(t=d(this.endian_mark+"L",n)[0],i=d(this.endian_mark+m("l",a),this.tiftag.slice(t,t+4*a))):i=d(this.endian_mark+m("l",a),n);else{if(10!=r)throw new Error("Exif might be wrong. Got incorrect value type to decode. type:"+r);if(t=d(this.endian_mark+"L",n)[0],a>1){i=[];for(o=0;o<a;o++)i.push([d(this.endian_mark+"l",this.tiftag.slice(t+8*o,t+4+8*o))[0],d(this.endian_mark+"l",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else i=[d(this.endian_mark+"l",this.tiftag.slice(t,t+4))[0],d(this.endian_mark+"l",this.tiftag.slice(t+4,t+8))[0]]}return i instanceof Array&&1==i.length?i[0]:i}},"undefined"!=typeof window&&"function"==typeof window.btoa)var h=window.btoa;if(void 0===h)h=function(e){for(var t,i,r,a,n,o,s,l="",h=0,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";h<e.length;)a=(t=e.charCodeAt(h++))>>2,n=(3&t)<<4|(i=e.charCodeAt(h++))>>4,o=(15&i)<<2|(r=e.charCodeAt(h++))>>6,s=63&r,isNaN(i)?o=s=64:isNaN(r)&&(s=64),l=l+c.charAt(a)+c.charAt(n)+c.charAt(o)+c.charAt(s);return l};if("undefined"!=typeof window&&"function"==typeof window.atob)var c=window.atob;if(void 0===c)c=function(e){var t,i,r,a,n,o,s="",l=0,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=h.indexOf(e.charAt(l++))<<2|(a=h.indexOf(e.charAt(l++)))>>4,i=(15&a)<<4|(n=h.indexOf(e.charAt(l++)))>>2,r=(3&n)<<6|(o=h.indexOf(e.charAt(l++))),s+=String.fromCharCode(t),64!=n&&(s+=String.fromCharCode(i)),64!=o&&(s+=String.fromCharCode(r));return s};function u(e,t){if(!(t instanceof Array))throw new Error("'pack' error. Got invalid type argument.");if(e.length-1!=t.length)throw new Error("'pack' error. "+(e.length-1)+" marks, "+t.length+" elements.");var i;if("<"==e[0])i=!0;else{if(">"!=e[0])throw new Error("");i=!1}for(var r="",a=1,n=null,o=null,s=null;o=e[a];){if("b"==o.toLowerCase()){if(n=t[a-1],"b"==o&&n<0&&(n+=256),n>255||n<0)throw new Error("'pack' error.");s=String.fromCharCode(n)}else if("H"==o){if((n=t[a-1])>65535||n<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(n%65536/256))+String.fromCharCode(n%256),i&&(s=s.split("").reverse().join(""))}else{if("l"!=o.toLowerCase())throw new Error("'pack' error.");if(n=t[a-1],"l"==o&&n<0&&(n+=4294967296),n>4294967295||n<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(n/16777216))+String.fromCharCode(Math.floor(n%16777216/65536))+String.fromCharCode(Math.floor(n%65536/256))+String.fromCharCode(n%256),i&&(s=s.split("").reverse().join(""))}r+=s,a+=1}return r}function d(e,t){if("string"!=typeof t)throw new Error("'unpack' error. Got invalid type argument.");for(var i,r=0,a=1;a<e.length;a++)if("b"==e[a].toLowerCase())r+=1;else if("h"==e[a].toLowerCase())r+=2;else{if("l"!=e[a].toLowerCase())throw new Error("'unpack' error. Got invalid mark.");r+=4}if(r!=t.length)throw new Error("'unpack' error. Mismatch between symbol and string length. "+r+":"+t.length);if("<"==e[0])i=!0;else{if(">"!=e[0])throw new Error("'unpack' error.");i=!1}for(var n=[],o=0,s=1,l=null,h=null,c=null,u="";h=e[s];){if("b"==h.toLowerCase())c=1,l=(u=t.slice(o,o+c)).charCodeAt(0),"b"==h&&l>=128&&(l-=256);else if("H"==h)c=2,u=t.slice(o,o+c),i&&(u=u.split("").reverse().join("")),l=256*u.charCodeAt(0)+u.charCodeAt(1);else{if("l"!=h.toLowerCase())throw new Error("'unpack' error. "+h);c=4,u=t.slice(o,o+c),i&&(u=u.split("").reverse().join("")),l=16777216*u.charCodeAt(0)+65536*u.charCodeAt(1)+256*u.charCodeAt(2)+u.charCodeAt(3),"l"==h&&l>=2147483648&&(l-=4294967296)}n.push(l),o+=c,s+=1}return n}function m(e,t){for(var i="",r=0;r<t;r++)i+=e;return i}function p(e){if("ÿØ"!=e.slice(0,2))throw new Error("Given data isn't JPEG.");for(var t=2,i=["ÿØ"];;){if("ÿÚ"==e.slice(t,t+2)){i.push(e.slice(t));break}var r=t+d(">H",e.slice(t+2,t+4))[0]+2;if(i.push(e.slice(t,r)),(t=r)>=e.length)throw new Error("Wrong JPEG data.")}return i}var g={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},f={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};f["0th"]=f.Image,f["1st"]=f.Image,i.TAGS=f,i.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},i.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},i.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},i.InteropIFD={InteroperabilityIndex:1},i.GPSHelper={degToDmsRational:function(e){var t=Math.abs(e),i=t%1*60,r=i%1*60;return[[Math.floor(t),1],[Math.floor(i),1],[Math.round(100*r),100]]},dmsRationalToDeg:function(e,t){var i="S"===t||"W"===t?-1:1;return(e[0][0]/e[0][1]+e[1][0]/e[1][1]/60+e[2][0]/e[2][1]/3600)*i}},e.exports&&(t=e.exports=i),t.piexif=i}()});et.piexif;function tt(e){var t=-1;$e||($e=function(){for(var e=new Int32Array(256),t=0;t<256;t++){for(var i=t,r=0;r<8;r++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}());for(var i=0;i<e.length;i++)t=$e[255&(t^e[i])]^t>>>8;return-1^t}var it="image/png",rt="image/jpeg",at="p".charCodeAt(0),nt="H".charCodeAt(0),ot="Y".charCodeAt(0),st="s".charCodeAt(0);function lt(e,t){var i=e.slice(0,33);return new Promise((r,a)=>{BFN.BlobUtils.blobToArrayBuffer(i,i=>{var n=i.arrayBuffer,o=i.error;if(o)return a(o);var s=new Uint8Array(n),l=e.slice(33),h=function(e,t,i,r){if(i===rt)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(i===it){var a=new Uint8Array(13);t*=39.3701,a[0]=at,a[1]=nt,a[2]=ot,a[3]=st,a[4]=t>>>24,a[5]=t>>>16,a[6]=t>>>8,a[7]=255&t,a[8]=a[4],a[9]=a[5],a[10]=a[6],a[11]=a[7],a[12]=1;var n=tt(a),o=new Uint8Array(4);if(o[0]=n>>>24,o[1]=n>>>16,o[2]=n>>>8,o[3]=255&n,r){var s=function(e){for(var t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===at&&e[t-2]===nt&&e[t-1]===ot&&e[t]===st)return t-3}(e);return e.set(a,s),e.set(o,s+13),e}var l=new Uint8Array(4);l[0]=0,l[1]=0,l[2]=0,l[3]=9;var h=new Uint8Array(54);return h.set(e,0),h.set(l,33),h.set(a,37),h.set(o,50),h}}(s,t,e.type);r(new Blob([h,l],{type:e.type}))},{timeoutMs:1e3,reportErrors:!1})})}class ht{constructor(){this.default_dpi=300}load(e,t){var i=BeFunky.callbackTimeout("ExifTool.load (with promise)",2500);BFN.BlobUtils.blobToBinaryString(e,e=>{var r=e.binaryString,a=e.error;if(i(),a)return t({error:a});var n=null;try{(n=et.load(r)).thumbnail=null}catch(e){}t({exif:n,binaryString:r})},{timeoutMs:2e3,reportErrors:!1})}getOrientation(e){return e["0th"][et.ImageIFD.Orientation]}changeOrientation(e,t){e["0th"][et.ImageIFD.Orientation]=t}getDPI(e){return{x:e["0th"][et.ImageIFD.XResolution],y:e["0th"][et.ImageIFD.YResolution]}}changeDPI(e,t,i){e["0th"][et.ImageIFD.XResolution]=[t,1],e["0th"][et.ImageIFD.YResolution]=[i,1],e["0th"][et.ImageIFD.ResolutionUnit]=2}changeDPIForPNG(e,t,i){t=t||this.getDpiFromExif(i)||this.default_dpi;var r=Date.now();return lt(e,t).then(e=>(console.log("Added ".concat(t," DPI to PNG blob in ").concat(Date.now()-r,"ms")),e)).catch(t=>(BeFunky.logError("Failed to add DPI to PNG blob:",t),e))}getDpiFromExif(e){if(e&&e["0th"]&&Array.isArray(e["0th"][et.ImageIFD.XResolution])){var i=t(e["0th"][et.ImageIFD.XResolution].map(e=>parseInt(e)),2),r=i[0],a=i[1],n=r;return a>1&&(n=r/a),3===e["0th"][et.ImageIFD.ResolutionUnit]&&(n*=2.54),(n=Math.round(n))||void 0}}generateExif(e,t){var i={};return i[et.ImageIFD.Make]="BeFunky",i[et.ImageIFD.Software]="BeFunky Photo Editor",t||(t=1),i[et.ImageIFD.Orientation]=t,e||(e=this.default_dpi),i[et.ImageIFD.XResolution]=[e,1],i[et.ImageIFD.YResolution]=[e,1],i[et.ImageIFD.ResolutionUnit]=2,{"0th":i}}insert(e,t,i,r){i=i||this.getDpiFromExif(t)||this.default_dpi,t?(this.changeDPI(t,i,i),this.changeOrientation(t,1)):t=this.generateExif(i),delete t["0th"][et.ImageIFD.WhitePoint],delete t["0th"][et.ImageIFD.PrimaryChromaticities];var a=i=>{i=i||e;var a=Date.now();this.load(i,e=>{var i,n=e.error,o=e.binaryString;if(n)return r({error:n});try{var s=et.dump(t),l=et.insert(s,o);i=BFN.ByteArrayUtil.convertBinaryStringToUint8Array(l),console.log("Added EXIF to JPEG blob in ".concat(Date.now()-a,"ms"))}catch(e){return BeFunky.logError("Unable to add EXIF data to blob using Piexif"),Math.random()>.9&&(console.log("Exif data",t),BeFunky.throwError(e)),r({error:"Unable to generate blob: ".concat(e.message?e.message:e)})}return r({blob:new Blob([i],{type:"image/jpeg"})})})},n=Date.now();lt(e,i).then(e=>{console.log("Added ".concat(i," DPI to JPEG blob in ").concat(Date.now()-n,"ms")),a(e)}).catch(e=>{BeFunky.logError("Failed to add DPI to JPEG blob:",e),a()})}}BFN.SingletonQueue.add(()=>{BFN.ExifTool=new ht});function ct(){}BFN.graphics=new class{constructor(){this.holder=new PIXI.Sprite,this.filter=null}drawShape(e,t,i,r){this.currentTexture=t,this.currentParams=i||{},this.renderer=r||BFN.Stage;var a=Math.min(Math.min(this.currentTexture.width,this.currentTexture.height)/2,Math.max(0,this.currentParams.hasOwnProperty("padding")?this.currentParams.padding:0)),n=Math.min(this.currentTexture.width/2,Math.max(0,this.currentParams.hasOwnProperty("paddingX")?this.currentParams.paddingX:a)),o=Math.min(this.currentTexture.height/2,Math.max(0,this.currentParams.hasOwnProperty("paddingY")?this.currentParams.paddingY:a)),s=this.currentParams.hasOwnProperty("paddingL")?Math.min(this.currentTexture.width/2,Math.max(0,this.currentParams.paddingL||0)):n,l=this.currentParams.hasOwnProperty("paddingR")?Math.min(this.currentTexture.width/2,Math.max(0,this.currentParams.paddingR||0)):n,h=this.currentParams.hasOwnProperty("paddingT")?Math.min(this.currentTexture.height/2,Math.max(0,this.currentParams.paddingT||0)):o,c=this.currentParams.hasOwnProperty("paddingB")?Math.min(this.currentTexture.height/2,Math.max(0,this.currentParams.paddingB||0)):o;switch(this.holder.width=this.currentTexture.width-(s+l),this.holder.height=this.currentTexture.height-(h+c),this.holder.x=s,this.holder.y=h,e){case"ellipse":this.ellipse();break;case"roundedRect":this.roundedRect()}}apply(){this.currentParams.hasOwnProperty("backgroundColor")&&-1!==this.currentParams.backgroundColor&&(this.currentTexture.fillColor(this.currentParams.backgroundColor,this.currentParams.backgroundAlpha||1),this.currentParams.clear=!1),this.filter.autoFit=!1,this.holder.filters=[this.filter],this.renderer.render(this.holder,this.currentTexture,!this.currentParams.hasOwnProperty("clear")||this.currentParams.clear);try{this.holder.destroyGC(!0)}catch(e){}this.currentParams=null,this.filter=null,this.currentTexture=null}ellipse(){this.filter=new BFN.filters.EllipseFilter,this.filter.quality=this.currentParams.hasOwnProperty("quality")?this.currentParams.quality:.75,this.filter.edgePadding=this.currentParams.hasOwnProperty("edgePadding")?this.currentParams.edgePadding:1,this.filter.strokeWidth=this.currentParams.hasOwnProperty("strokeWidth")?this.currentParams.strokeWidth:0,this.filter.strokeColor=this.currentParams.hasOwnProperty("strokeColor")?this.currentParams.strokeColor:4278190080,this.filter.fillColor=this.currentParams.hasOwnProperty("fillColor")?this.currentParams.fillColor:0,this.apply()}roundedRect(){this.filter=new BFN.filters.RoundedRectFilter,this.filter.quality=this.currentParams.hasOwnProperty("quality")?this.currentParams.quality:.75,this.filter.edgePadding=this.currentParams.hasOwnProperty("edgePadding")?this.currentParams.edgePadding:1,this.filter.strokeWidth=this.currentParams.hasOwnProperty("strokeWidth")?this.currentParams.strokeWidth:0,this.filter.cornerRadius=this.currentParams.hasOwnProperty("cornerRadius")?this.currentParams.cornerRadius:1,this.filter.strokeColor=this.currentParams.hasOwnProperty("strokeColor")?this.currentParams.strokeColor:4278190080,this.filter.fillColor=this.currentParams.hasOwnProperty("fillColor")?this.currentParams.fillColor:0,this.filter.outerColor=this.currentParams.hasOwnProperty("outerColor")?this.currentParams.outerColor:0,this.apply()}},ct.prototype.hexStringToHexNumber=function(e){return parseInt("0x"+e)},ct.prototype.hexNumberToHexString=function(e){var t=this.hexNumberToRGBAObject(e),i=this.rgbaObjectToHexStringObject(t);return e<=16777215?i.hex:(256|255*i.alpha).toString(16).slice(1)+i.hex},ct.prototype.hexNumberToRGBAObject=function(e){var t={};return t.r=e>>16&255,t.g=e>>8&255,t.b=255&e,t.a=e<=16777215?1:(e>>24&255)/255,t},ct.prototype.rgbaObjectToHexStringObject=function(e){var t={};return t.hex=(16777216|e.b|e.g<<8|e.r<<16).toString(16).slice(1),t.alpha=e.a,t},ct.prototype.hexNumberToRGBAString=function(e){var t=this.hexNumberToRGBAObject(e);return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},ct.prototype.hexStringObjectToRGBAString=function(e){var t=this.hexStringToHexNumber(e.hex),i=this.hexNumberToRGBAObject(t);return i.a=e.alpha,i.a>=1?"rgb("+i.r+","+i.g+","+i.b+")":"rgba("+i.r+","+i.g+","+i.b+","+i.a+")"},ct.prototype.rgbaStringToHexStringObject=function(e){var t=e.replace("rgb(","").replace("rgba(","").replace(")","").split(",");if(t&&t.length){for(var i=0;i<t.length;i++)if(t[i]=parseFloat(t[i]),"number"!=typeof t[i]||isNaN(t[i]))return null;if(t.length>=3){var r={};return r.r=t[0],r.g=t[1],r.b=t[2],r.a=1,t.length>3&&(r.a=t[3]),this.rgbaObjectToHexStringObject(r)}}return{hex:"000000",alpha:0}},BFN.SingletonQueue.add(function(){BFN.ColorUtil=new ct}),BFN.transformItemPoolTexture=PIXI.RenderTexture.create(256,256,PIXI.SCALE_MODES.NEAREST),BFN.transformItemTempParent=new PIXI.Sprite;function ut(){this.init()}BFN.Util=new class{interpolateNumber(e,t,i){return e*(1-i)+t*i}polygonHitTest(e,t){for(var i,r,a,n,o,s=[e,t],l=0;l<s.length;l++)for(var h=s[l],c=0;c<h.length;c++){var u=(c+1)%h.length,d=h[c],m=h[u],p={x:m.y-d.y,y:d.x-m.x};r=a=void 0;for(var g=0;g<e.length;g++)i=p.x*e[g].x+p.y*e[g].y,(void 0===r||i<r)&&(r=i),(void 0===a||i>a)&&(a=i);n=o=void 0;for(var f=0;f<t.length;f++)i=p.x*t[f].x+p.y*t[f].y,(void 0===n||i<n)&&(n=i),(void 0===o||i>o)&&(o=i);if(a<n||o<r)return!1}return!0}isTransparent(e){var t=BFN.Stage.gl,i=t.createFramebuffer(),r=e.baseTexture._glTextures[0],a=e.width,n=e.height;if(!r||!r.texture)return!1;var o=null;function s(){t.deleteFramebuffer(i),t.bindFramebuffer(t.FRAMEBUFFER,null),i=null,o=null}if(t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.texture,0),t.checkFramebufferStatus(t.FRAMEBUFFER)==t.FRAMEBUFFER_COMPLETE){var l=a*n*4;o=new Uint8Array(l),t.readPixels(0,0,a,n,t.RGBA,t.UNSIGNED_BYTE,o);for(var h=0;h<l;h+=4)if(o[h+3]<255)return s(),!0}return s(),!1}isSolidColor(e){var t=BFN.Stage.gl,i=t.createFramebuffer(),r=e.baseTexture._glTextures[0],a=e.width,n=e.height;if(!r||!r.texture)return!1;var o=null;function s(){t.deleteFramebuffer(i),t.bindFramebuffer(t.FRAMEBUFFER,null),i=null,o=null}t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.texture,0);var l=[0,0,0,0];if(t.checkFramebufferStatus(t.FRAMEBUFFER)==t.FRAMEBUFFER_COMPLETE){var h=a*n*4;o=new Uint8Array(h),t.readPixels(0,0,a,n,t.RGBA,t.UNSIGNED_BYTE,o);for(var c=0;c<h;c+=4)if(c){if(o[c+0]!=l[0]||o[c+1]!=l[1]||o[c+2]!=l[2]||o[c+3]!=l[3])return s(),!1}else l=[o[c+0],o[c+1],o[c+2],o[c+3]]}return s(),!0}getTextureAverageColor(e,t,i,r,a){var n=BFN.Stage.gl,o=n.createFramebuffer(),s=e.baseTexture._glTextures[0],l=e.width,h=e.height,c=null,u=null;n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s.texture,0);var d=0,m=0,p=0;if(n.checkFramebufferStatus(n.FRAMEBUFFER)==n.FRAMEBUFFER_COMPLETE){var g=l*h*4;c=new Uint8Array(g),n.readPixels(0,0,l,h,n.RGBA,n.UNSIGNED_BYTE,c);for(var f=0,v=0;v<g;v+=4)c[v+3]>0&&(f++,d+=c[v],r?(m=d,p=d):(m+=c[v+1],p+=c[v+2]));if(d/=f,m/=f,p/=f,1==a){f=0;for(var y=d,x=0;x<g;x+=4)c[x+3]>0&&c[x]<=y&&(f++,d+=c[x]);m=d/=f,p=d}i&&(d/=255,m/=255,p/=255),u=t?d<<16|m<<8|p:[d,m,p]}return n.deleteFramebuffer(o),n.bindFramebuffer(n.FRAMEBUFFER,null),o=null,c=null,u}getAlphaBounds(e){var t,i,r,a,n,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=BFN.Stage.gl,d={minX:0,minY:0,maxX:e.width,maxY:e.height,left:0,right:0,top:0,bottom:0,width:e.width,height:e.height,centerX:e.width/2,centerY:e.height/2,centerOffsetX:0,centerOffsetY:0,noBounds:!1},m=e.baseTexture._glTextures[0],p=e.width,g=e.height,f=null;s||(s=["left","right","top","bottom"]);var v=u.createFramebuffer();function y(t,i){return h?(a=4*(i*e.width+t),(f[a]+f[a+1]+f[a+2])/3):(a=4*(i*e.width+t)+3,f[a])}function x(){u.deleteFramebuffer(v),u.bindFramebuffer(u.FRAMEBUFFER,null),v=null,f=null}function _(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d.minX=d.minY=d.maxX=d.maxY=d.left=d.right=d.top=d.bottom=d.width=d.height=d.centerX=d.centerY=d.centerOffsetX=d.centerOffsetY=0,d.noBounds=e}u.bindFramebuffer(u.FRAMEBUFFER,v),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,m.texture,0);var I=new PIXI.Point,T=.5;function b(e,t){var i={x:e.x,y:e.y,alpha:e.alpha};if(i.alpha<T)for(var r=!1,a=1;a<=2;a++){for(var n=-2;n<=2;n++){switch(t){case"left":I.x=e.x-a,I.y=e.y+n;break;case"right":I.x=e.x+a,I.y=e.y-n;break;case"up":I.x=e.x-n,I.y=e.y-a;break;case"down":I.x=e.x+n,I.y=e.y+a}if(I.x>=0&&I.y<p&&I.y>=0&&I.y<g){var o=y(I.x,I.y)/255;if(o>i.alpha&&(i.x=I.x,i.y=I.y,i.alpha=o,o>=T)){r=!0;break}}}if(r)break}return{x:i.x-e.x,y:i.y-e.y}}if(u.checkFramebufferStatus(u.FRAMEBUFFER)==u.FRAMEBUFFER_COMPLETE){if(f=new Uint8Array(p*g*4),u.readPixels(0,0,p,g,u.RGBA,u.UNSIGNED_BYTE,f),o=null,-1!=s.indexOf("left")){for(t=!1,i=d.minX;i<d.maxX;i++){for(r=d.minY;r<d.maxY;r++)if((n=y(i,r)/255)>0){if(t=!0,c){d.minX=i;break}o?n>o.alpha&&(o.x=i,o.y=r,o.alpha=n):(d.minX=i,o={x:i,y:r,alpha:n})}if(o&&1!=o.alpha&&(d.minX+=b(o,"right").x),t)break}if(!t)return x(),_(!0),d}if(o=null,-1!=s.indexOf("top")){for(t=!1,r=d.minY;r<d.maxY;r++){for(i=d.minX;i<d.maxX;i++)if((n=y(i,r)/255)>0){if(t=!0,c){d.minY=r;break}o?n>o.alpha&&(o.x=i,o.y=r,o.alpha=n):(d.minY=r,o={x:i,y:r,alpha:n})}if(o&&1!=o.alpha&&(d.minY+=b(o,"down").y),t)break}if(!t)return x(),_(!0),d}if(o=null,-1!=s.indexOf("right")){for(t=!1,i=d.maxX;--i>d.minX-1;){for(r=d.minY;r<d.maxY;r++)if((n=y(i,r)/255)>0){if(t=!0,c){d.maxX=i;break}o?n>o.alpha&&(o.x=i,o.y=r,o.alpha=n):(d.maxX=i,o={x:i,y:r,alpha:n})}if(o&&1!=o.alpha&&(d.maxX+=b(o,"left").x),t)break}if(!t)return x(),_(!0),d}if(o=null,-1!=s.indexOf("bottom")){for(t=!1,r=d.maxY;--r>d.minY-1;){for(i=d.minX;i<d.maxX;i++)if((n=y(i,r)/255)>0){if(t=!0,c){d.maxY=r;break}o?n>o.alpha&&(o.x=i,o.y=r,o.alpha=n):(d.maxY=r,o={x:i,y:r,alpha:n})}if(o&&1!=o.alpha&&(d.maxY+=b(o,"up").y),t)break}if(!t)return x(),_(!0),d}d.left=d.minX,d.top=d.minY,d.right=d.width-d.maxX-1,d.bottom=d.height-d.maxY-1,d.minX*=l,d.minY*=l,d.maxX*=l,d.maxY*=l,d.width*=l,d.height*=l,d.left*=l,d.top*=l,d.right*=l,d.bottom*=l,d.width=d.width-d.left-d.right,d.height=d.height-d.top-d.bottom,d.centerX=d.left+d.width/2,d.centerY=d.top+d.height/2,d.centerOffsetX=d.centerX-e.width*l/2,d.centerOffsetY=d.centerY-e.height*l/2}return x(),0!==d.width&&0!==d.height||(d.noBounds=!0),d}getTransformItemBounds(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0,left:0,right:0,top:0,bottom:0,centerOffsetX:0,centerOffsetY:0};if(e&&e.parent){for(var r="text"!=e.type||t?e.globalPolygon:e.globalTextPolygon,a=0;a<r.length;a++){var n=e.parent.toLocal(r[a],BFN.MainUI);(void 0===i.minX||n.x<i.minX)&&(i.minX=n.x),(void 0===i.maxX||n.x>i.maxX)&&(i.maxX=n.x),(void 0===i.minY||n.y<i.minY)&&(i.minY=n.y),(void 0===i.maxY||n.y>i.maxY)&&(i.maxY=n.y)}return i.width=i.maxX-i.minX,i.height=i.maxY-i.minY,i.centerX=i.minX+i.width/2,i.centerY=i.minY+i.height/2,i}return i.minX=i.minY=i.maxX=i.maxY=0,i}getTransformItemTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&e.parent){t||(t=BFN.Util.getTransformItemBounds(e));var i=Math.min(1,1024/t.width,1024/t.height),r=Math.round(t.width*i),a=Math.round(t.height*i),n=r/t.width,o=a/t.height,s=e.interactive,l=e.buttonMode,h=e.x,c=e.y,u=e.scale.x,d=e.scale.y,m=e.alpha,p=e.visible,g=e.renderable,f=e.parent,v=f.getChildIndex(e),y=e.itemBlendMode,x=e.itemContent.visible,_=!!e.hiResTextSprite&&e.hiResTextSprite.visible,I=!!e.hiResTextHelper&&e.hiResTextHelper.visible;return e.x=Math.round((e.x-t.minX)*i),e.y=Math.round((e.y-t.minY)*i),e.scale.x*=n,e.scale.y*=o,e.alpha=1,e.visible=!0,e.renderable=!0,e.setBlendMode(BFN.CONST.BLEND_MODES.NORMAL),e.updateSmoothingScale(1,!1),e.itemContent.visible=!0,e.hiResTextSprite&&(e.hiResTextSprite.visible=!1),e.hiResTextHelper&&(e.hiResTextHelper.visible=!1),BFN.transformItemTempParent.addChild(e),BFN.transformItemPoolTexture.resize(Math.round(t.width*i),Math.round(t.height*i)),BFN.Stage.render(BFN.transformItemTempParent,BFN.transformItemPoolTexture),e.interactive=s,e.buttonMode=l,e.x=h,e.y=c,e.scale.x=u,e.scale.y=d,e.alpha=m,e.visible=p,e.renderable=g,e.setBlendMode(y),e.updateSmoothingScale(),e.itemContent.visible=x,e.hiResTextSprite&&(e.hiResTextSprite.visible=_),e.hiResTextHelper&&(e.hiResTextHelper.visible=I),f.addChildAt(e,v),BFN.MainUI.renderCanvas(),BFN.transformItemPoolTexture}return null}getThumbTextureGL(e,t,i,r){if(null==e)return null;null==t&&(t=50),null==i&&(i=!1),null==r&&(r=!1);var a=new PIXI.Sprite(e),n=new PIXI.Container;n.addChild(a);var o=Math.max(e.width,e.height),s=Math.min(e.width,e.height),l=i&&r?t/s:t/o,h=Math.floor(e.width*l),c=Math.floor(e.height*l);a.x=i?t/2-h/2:0,a.y=i?t/2-c/2:0;var u=PIXI.RenderTexture.create(i?t:h,i?t:c);return a.scale.x=h/e.width,a.scale.y=c/e.height,BFN.Stage.render(n,u),n.removeChild(a),n=null,a.destroy(!1),a=null,u}getThumbTexture(e,t,i,r){if(null==e)return null;t=t||50,i=i||!1,r=r||!1;var a=new PIXI.Texture(e.baseTexture);a.frame=e.frame,a.orig=e.orig,a.trim=e.trim;var n=Math.min(a.width,a.height),o=Math.max(a.width,a.height),s=null;if(o>3*t){var l=3*t/o,h=Math.max(8,Math.round(a.width*l)),c=Math.max(8,Math.round(a.height*l));s=this.resizeTexture(a,h,c,!1,!0),a.destroy(!1),a=s}else if(n<t){var u=i&&r?t/n:t/o,d=Math.max(8,Math.min(t,Math.round(a.width*u))),m=Math.max(8,Math.min(t,Math.round(a.height*u)));s=this.resizeTexture(a,d,m,i&&r),a.destroy(!1),a=s}var p=Math.max(a.width,a.height),g=Math.min(a.width,a.height),f=i&&r?t/g:t/p,v=Math.max(8,Math.round(a.width*f)),y=Math.max(8,Math.round(a.height*f)),x=new PIXI.Sprite(a);x.pluginName="smooth_picture",x.x=i?t/2-v/2:0,x.y=i?t/2-y/2:0,x.scale.x=x.currentScale=v/a.width,x.scale.y=x.currentScaleY=y/a.height;var _=PIXI.RenderTexture.create(i?t:v,i?t:y);return BFN.Stage.render(x,_),x.destroy(!1),x=null,s&&s.destroyGC(!0),e.baseTexture&&e.baseTexture.hasOwnProperty("isTransparent")&&!i&&!r&&(_.isTransparent=e.baseTexture.isTransparent),_}getHTMLImage(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return t&&t(null),null;var r=null;if(i&&(this.unPremultiplySprite||(this.unPremultiplySprite=new PIXI.Sprite,this.unPremultiplyFilter=new BFN.filters.UnPremultiplyFilter,this.unPremultiplySprite.filters=[this.unPremultiplyFilter]),this.unPremultiplySprite.texture=e,r=e.renderClone(),BFN.Stage.render(this.unPremultiplySprite,r)),null==t){var a=BFN.Stage.extract.image(i?r:e);return i&&(this.unPremultiplySprite.texture=PIXI.Texture.EMPTY,r.destroyGC(!0),r=null),a}if(t){var n=BFN.Stage.extract.canvas(i?r:e);i&&(this.unPremultiplySprite.texture=PIXI.Texture.EMPTY);var o=i?"image/png":"image/jpeg";n.toBlob(e=>{BFN.BlobUtils.blobToBase64(e).catch(e=>(BeFunky.throwError("Unable to convert blob -> base64 in getHTMLImage",e),"")).then(e=>{var a=new Image;a.src=e,i&&r.destroyGC(!0),r=null,t(a)})},o,.99)}}getRandomInt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2147483647;return Math.round(Math.random()*(t-e))+e}orientTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e&&e.valid&&t>=2&&t<=8){var i=[5,6,7,8].indexOf(t)>=0,r=i?e.height:e.width,a=i?e.width:e.height,n=e.renderClone(),o=new PIXI.Sprite(n);n.rotate={2:12,3:4,4:8,5:10,6:6,7:14,8:2}[t],o.width=r,o.height=a,i&&e.resize(r,a,!1),BFN.Stage.render(o,e),n.destroyGC(!0),o.destroy(!1)}}resizeTexture(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{if(e&&e.width&&e.height&&t&&i){var n=new PIXI.Sprite(e);r?(n.scale.x=n.scale.y=Math.max(Math.abs(t)/e.width,Math.abs(i)/e.height),n.x=(t-e.width*n.scale.x)/2,n.y=(i-e.height*n.scale.y)/2):(n.scale.x=Math.abs(t)/e.width,n.scale.y=Math.abs(i)/e.height),a&&(n.pluginName="smooth_picture",n.currentScale=n.scale.x,n.currentScaleY=n.scale.y);var o=PIXI.RenderTexture.create(t,i);return BFN.Stage.render(n,o),n.destroy(!1),n=null,e&&e.baseTexture&&e.baseTexture.hasOwnProperty("isTransparent")&&(o.isTransparent=e.baseTexture.isTransparent),o}}catch(e){BeFunky.logError("resizeTexture failed",e)}return null}fitTextureInRect(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;try{if(e&&e.width&&e.height&&t&&i){var n=PIXI.RenderTexture.create(t,i);if(r)n.copyPixels(e,{x:0,y:0},!0,1,{x:t/e.width,y:i/e.height});else{-1==a?n.clear():n.fillColor(parseInt("0x".concat(a)),1);var o=Math.min(t/e.width,i/e.height),s=Math.round(t/2-e.width*o/2),l=Math.round(i/2-e.height*o/2);n.copyPixels(e,{x:s,y:l},!1,1,o)}return n}}catch(e){}return null}conformImageSizeMegaPixels(e,t,i){try{if(e&&e.width&&e.height){var r=e.width,a=e.height,n=a/r,o=r*a,s=t,l=t,h=r*Math.sqrt(i/o),c=a*Math.sqrt(i/o);if(r<s||r>h||a<l||a>c){var u=Math.round(n>1?Math.max(s/n,Math.min(h/n,r/n)):Math.max(s,Math.min(h,r))),d=Math.round(n>1?Math.max(s,Math.min(h,r)):Math.max(s*n,Math.min(h*n,r*n)));return this.resizeTexture(e,u,d,!1)}}}catch(e){}return e.renderClone()}conformImageSize(e,t,i){try{if(e&&e.width&&e.height){var r=e.width,a=e.height,n=a/r,o=t,s=i,l=t,h=i;if(r<o||r>s||a<l||a>h){var c=-1,u=-1;if(n>1?r<o?(c=o,u=Math.min(h,Math.round(c*n))):a>h&&(u=h,c=Math.max(o,Math.round(u/n))):a<l?(u=l,c=Math.min(s,Math.round(u/n))):r>s&&(c=s,u=Math.max(l,Math.round(c*n))),c>0&&u>0)return this.resizeTexture(e,c,u,!1)}}}catch(e){}return e.renderClone()}hex2rgbVec3(e){var t=[];return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t}rgbToHex(e,t,i){return e<<16|t<<8|i}cloneTexture(e){var t=new PIXI.Sprite(e),i=PIXI.RenderTexture.create(e.width,e.height);return BFN.Stage.render(t,i),t.destroy(!1),t=null,i}createRenderTexturePool(){BFN.renderTexturesPool||(BFN.renderTextureHolder=new PIXI.Sprite,BFN.renderTexturesPool=[{is_protected:!0,description:"photo-edit-model",used:!0,texture:PIXI.RenderTexture.create(512,512)},{is_protected:!0,description:"multiple-file-uploader",used:!0,texture:PIXI.RenderTexture.create(512,512)},{used:!1,texture:PIXI.RenderTexture.create(512,512)}])}getNonUsedRenderTexturePool(e,t){for(var i=null,r=0;r<BFN.renderTexturesPool.length;r++)if(null!=BFN.renderTexturesPool[r]&&1!=BFN.renderTexturesPool[r].used&&0==BFN.renderTexturesPool[r].hasOwnProperty("is_protected")){BFN.renderTexturesPool[r].used=!0,e==BFN.renderTexturesPool[r].texture.width&&t==BFN.renderTexturesPool[r].texture.height||BFN.renderTexturesPool[r].texture.resize(e,t,!1),i=BFN.renderTexturesPool[r].texture;break}if(null==i){var a=BFN.renderTexturesPool.length;BFN.renderTexturesPool[a]={used:!0,texture:PIXI.RenderTexture.create(e,t)},i=BFN.renderTexturesPool[a].texture}return i}destroyRenderTexturePool(){if(null!=BFN.renderTexturesPool){for(var e=0;e<BFN.renderTexturesPool.length;e++)if(null!=BFN.renderTexturesPool[e]&&1==BFN.renderTexturesPool[e].used&&0==BFN.renderTexturesPool[e].hasOwnProperty("is_protected")){BFN.renderTexturesPool[e].used=!1;try{BFN.renderTexturesPool[e].texture.resize(512,512)}catch(e){}}BFN.renderTextureHolder.texture=null,BFN.renderTextureHolder.filters=[]}}calculateRes(e,t){var i={small:1,large:1},r=Math.max(e,t);return r<=8192&&(i.small=.25,i.large=.125),r<=4096&&(i.small=.5,i.large=.25),r<=2048&&(i.small=i.large=.5),r<1024&&(i.small=i.large=1),i}expandVertices(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(e&&8==e.length){for(var i=[],r=0;r<8;r+=2){var a=Math.atan2(e[r+1]-e[(r+7)%8],e[r]-e[(r+6)%8]),n=Math.atan2(e[r+1]-e[(r+3)%8],e[r]-e[(r+2)%8]);i.push(e[r]+Math.cos(a)*t+Math.cos(n)*t),i.push(e[r+1]+Math.sin(a)*t+Math.sin(n)*t)}return i}return e}getDistance(e,t,i,r){return Math.sqrt(Math.pow(i-e,2)+Math.pow(r-t,2))}hsv2rgb(e){var t,i,r,a,n,o=e.h,s=e.s,l=e.v;o=o%360/60,t=i=r=l-(n=l*s),t+=[n,a=n*(1-Math.abs(o%2-1)),0,0,a,n][o=~~o],i+=[a,n,n,a,0,0][o],r+=[0,0,a,n,n,a][o];var h=Math.floor(255*t),c=Math.floor(255*i),u=Math.floor(255*r);return{r:h,g:c,b:u,hex:"#".concat((16777216|u|c<<8|h<<16).toString(16).slice(1))}}rgb2hsv(e){var t,i,r=e.r,a=e.g,n=e.b;return(r>1||a>1||n>1)&&(r/=255,a/=255,n/=255),{h:(0==(i=(t=Math.max(r,a,n))-Math.min(r,a,n))?null:t===r?(a-n)/i+(a<n?6:0):t===a?(n-r)/i+2:(r-a)/i+4)%6*60,s:0===i?0:i/t,v:t}}hex2rgb(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}hex2hsv(e){return this.rgb2hsv(this.hex2rgb(e))}getTotalTextureMemory(){var e=[];try{e.push(...BFN.Stage.textureManager._managedTextures)}catch(e){return BeFunky.logError("Unable to get PIXI _managedTextures array"),0}try{var t=[].concat(...Object.values(BFN.Stage.filterManager.pool)).map(e=>e.texture);e.push(...t)}catch(e){return BeFunky.logError("Unable to get PIXI pooled filter textures"),0}var i=4*e.reduce((e,t)=>{var i=parseInt(t.width)||0,r=parseInt(t.height)||0,a="number"==typeof t.resolution?t.resolution:1;return i<=0||r<=0?(BeFunky.logError("Found texture with invalid width/height",t,t.width,t.height),e):e+i*r*a},0)/Math.pow(1024,2);return Math.round(10*i)/10}},ut.prototype.init=function(){BeFunky.log("SpritePool Init"),this.initDefaultValues()},ut.prototype.initDefaultValues=function(){this.sprites=[],this.spriteAnchor=new PIXI.Point(.5,.5)},ut.prototype.makeSprite=function(){var e=new PIXI.Sprite;return e.anchor.x=this.spriteAnchor.x,e.anchor.y=this.spriteAnchor.y,e},ut.prototype.grow=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=0;t<e;t++)this.sprites.push(this.makeSprite())},ut.prototype.growTo=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)-this.sprites.length;e>0&&this.grow(e)},ut.prototype.getSprite=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e>=this.sprites.length&&this.growTo(e+1);var r=this.sprites[e];return t&&(r.x=t.x,r.y=t.y),i&&(r.texture=i),r},BFN.SpritePool=ut;class dt{convertBinaryStringToUint8Array(e){for(var t=e.length,i=new Uint8Array(t),r=0;r<t;r++)i[r]=e.charCodeAt(r);return i}AS3ByteArrayToPixel(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:110,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:110,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e=>{console.log(e.src)},a=e=>{for(var t=null,i=e.length,r=0;r<i/2;r+=1){t=i-1-r;var a=e[r],n=e[t];a^=n,a^=n^=a,e[r]=a,e[t]=n}return e},n=(e=>{for(var t,i,r=[],n=0;n<e.length;n++){t=e.charCodeAt(n),i=[];do{i.push(255&t),t>>=8}while(t);i=a(i);try{Array.prototype.push.apply(r,i)}catch(e){}}return t=null,i=null,r})(atob(e)),o=document.createElement("canvas");o.width=t,o.height=i;for(var s=o.getContext("2d"),l=s.createImageData(t,i),h=0;h<n.length;h+=4)l.data[h+0]=n[h+1],l.data[h+1]=n[h+2],l.data[h+2]=n[h+3],l.data[h+3]=n[h+0];s.putImageData(l,0,0);var c=o.toDataURL();s=null,l=null,o=null,n=null;var u=document.createElement("img");u.onload=function(){r(u)},u.src=c}}BFN.SingletonQueue.add(()=>{BFN.ByteArrayUtil=new dt}),BFN.GraphicLoaderEvents={GRAPHIC_COMPLETE:new Event("GRAPHIC_COMPLETE"),LOADING_COMPLETE:new Event("LOADING_COMPLETE")};function mt(){BFN.EventDispatcher.call(this),this.init()}BFN.GraphicLoader=class extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("GraphicLoader Init"),this.initDefaultValues()}initDefaultValues(){this._graphicsLoaded=!1,this._graphicsData={},this._graphics={},this._blobs={},this.activeLoaders={},this.loaderCount=0,this.handleImageLoadErrorBind=this.handleImageLoadError.bind(this),this.handleImageLoadCompleteBind=this.handleImageLoadComplete.bind(this)}loadGraphics(){for(var e in this._graphicsData){var t=this._graphicsData[e];this._graphics[e]&&this._graphics[e]!=this.missingTexture&&this._graphics[e].destroyGC(!0),this._graphics[e]=null;var i=new XMLHttpRequest;i.onerror=this.handleImageLoadErrorBind,i.onload=this.handleImageLoadCompleteBind,i.open("GET",t,!0);var r=null;try{null==(r=get_browser()).name&&(r.name=1==/Firefox/i.test(navigator.userAgent)?"Firefox":null),r.version=Number(r.version)}catch(e){}i.responseType=null!=r&&null!=r.name&&"FIREFOX"==r.name.toUpperCase()&&null!=r.version&&0==isNaN(r.version)&&57==r.version?"arraybuffer":"blob",this.activeLoaders[e]=i,i.send(),this.loaderCount++,this._graphicsData[e]=null,delete this._graphicsData[e]}this.loaderCount||(this._graphicsLoaded=!0,this.dispatchEvent(BFN.GraphicLoaderEvents.LOADING_COMPLETE))}reset(){for(var e in this._graphicsData)this._graphicsData[e]=null,delete this._graphicsData[e];for(var t in this._graphics)this._graphics[t]&&this._graphics[t]!=this.missingTexture&&this._graphics[t].destroyGC(!0),this._graphics[t]=null,delete this._graphics[t];for(var i in this._blobs)this._blobs[i]=null,delete this._blobs[i];for(var r in this.activeLoaders)this.activeLoaders[r],delete this.activeLoaders[r];this.loaderCount=0,this._graphicsLoaded=!1}handleImageLoadError(e){var t=e.currentTarget;for(var i in this.activeLoaders)if(this.activeLoaders[i]==t){this._graphics[i]=this.missingTexture,this._blobs[i]=null,t=null,delete this.activeLoaders[i];var r=new Event(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type);return r.data={graphicID:i,graphic:this._graphics[i],blob:this._blobs[i]},this.dispatchEvent(r),void(--this.loaderCount||(this._graphicsLoaded=!0,this.dispatchEvent(BFN.GraphicLoaderEvents.LOADING_COMPLETE)))}}handleImageLoadComplete(e){var t=this,i=e.currentTarget,r=function(r){if(t.activeLoaders[r]==i){if(200==i.status){var a=i.response;"arraybuffer"===i.responseType&&(a=new Blob([new Uint8Array(a)])),BFN.TextureUtils.blobOrBase64ToTexture(a,n=>{var o=n.texture;if(n.error)t.handleImageLoadError(e);else{t._graphics[r]=o,t._blobs[r]=a,i=null,delete t.activeLoaders[r];var s=new Event(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type);s.data={graphicID:r,graphic:t._graphics[r],blob:t._blobs[r]},t.dispatchEvent(s),--t.loaderCount||(t._graphicsLoaded=!0,t.dispatchEvent(BFN.GraphicLoaderEvents.LOADING_COMPLETE))}},{textureSize:BFN.maxImageSize,readEXIF:!1})}else t.handleImageLoadError(e);return{v:void 0}}};for(var a in this.activeLoaders){var n=r(a);if("object"==typeof n)return n.v}}get graphicsLoaded(){return this._graphicsLoaded}get graphicsData(){return this._graphicsData}get graphics(){return this._graphics}get blobs(){return this._blobs}get loading(){return this.loaderCount>0}get missingTexture(){if(!this._missingTexture){var e=new PIXI.Graphics;e.beginFill(16711680),e.drawRect(0,0,5,5),e.endFill(),this._missingTexture=PIXI.RenderTexture.create(5,5),BFN.Stage.render(e,this._missingTexture)}return this._missingTexture}},BFN.EffectTextureLoaderEvents={TEXTURE_LOADED:new Event("TEXTURE_LOADED")},mt.prototype=Object.create(BFN.EventDispatcher.prototype),mt.prototype.init=function(){BeFunky.log("EffectTextureLoader Init"),this.initDefaultValues(),this.initGraphicLoader()},mt.prototype.initDefaultValues=function(){this.loadedTextures={}},mt.prototype.initGraphicLoader=function(){this.graphicLoader=new BFN.GraphicLoader,this.graphicLoader.addEventListener(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type,this.handleGraphicLoaderGraphicComplete.bind(this))},mt.prototype.getTexture=function(e,t,i){return null==t&&(t=0),null==i&&(i=0),this.loadedTextures.hasOwnProperty(e)?(t>0&&i>0||(t=this.loadedTextures[e].width,i=this.loadedTextures[e].height),BFN.Util.resizeTexture(this.loadedTextures[e],t,i)):(this.graphicLoader.reset(),this.graphicLoader.graphicsData[e]=e,this.graphicLoader.loadGraphics(),null)},mt.prototype.handleGraphicLoaderGraphicComplete=function(e){var t=e.data.graphicID,i=e.data.graphic;this.loadedTextures.hasOwnProperty(t)&&this.loadedTextures[t].destroyGC(!0),this.loadedTextures[t]=PIXI.RenderTexture.create(i.width,i.height),this.loadedTextures[t].copyPixels(i),this.graphicLoader.reset();try{try{i.destroyGC(!0)}catch(e){}try{e.data=null}catch(e){}try{e=null}catch(e){}}catch(e){}this.dispatchEvent(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED)},mt.prototype.destroy=function(){var e=this;Object.keys(e.loadedTextures).forEach(function(t){if(e.loadedTextures.hasOwnProperty(t)&&null!=e.loadedTextures[t])try{e.loadedTextures[t].destroyGC(!0),e.loadedTextures[t]=null}catch(e){}})},Object.defineProperty(mt.prototype,"loading",{get:function(){return this.graphicLoader.loading}}),BFN.EffectTextureLoader=mt,BFN.XMLGraphicLoaderEvents={LOADING_COMPLETE:new Event("XML_LOADING_COMPLETE")};class pt extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("XML GraphicLoader Init"),this.initDefaultValues()}initDefaultValues(){this._isLoaded=!1,this._base64graphics={},this._textureGraphics={},this._xmlPath=null,this._jsonPath=null,this.effectsThumbCalled=!1,this.texturesThumbCalled=!1,this.warningReported=!1}loadXml(){BeFunky.request(this.xmlPath,{responseType:"text"},e=>{var t=e.error,i=e.response;if(t)return this.texturesThumbCalled=!1,void("request_failed"===t?BeFunky.logWarning("Failed to load textures thumb XML: ".concat(t)):BeFunky.reportWarning("Failed to load textures thumb XML: ".concat(t)));for(var r=window.parseXml(i).getElementsByTagName("image"),a=r.length,n=[],o=0;o<a;o++){var s=r[o],l=s.getAttribute("name");this._base64graphics[l]=s.childNodes[0].nodeValue,n.push(this.loadBase64ToTexture(l))}this.setLoaded(n)})}loadJson(){BFN.RequestUtils.getJSON(this.jsonPath,e=>{var t=e.error,i=e.response;if(t)return this.effectsThumbCalled=!1,void("request_failed"===t?BeFunky.logWarning("Failed to load effects thumb JSON: ".concat(t)):BeFunky.reportWarning("Failed to load effects thumb JSON: ".concat(t)));if(!i.hasOwnProperty("images"))return BeFunky.reportWarning("Invalid effects thumb JSON",i),void(this.effectsThumbCalled=!1);for(var r=i.images.length,a=[],n=0;n<r;n++){var o=i.images[n];if(o&&o.hasOwnProperty("image")&&o.hasOwnProperty("name")){var s=o.image,l=o.name;this._base64graphics[l]=s,a.push(this.loadBase64ToTexture(l))}}this.setLoaded(a)})}loadBase64ToTexture(e){return new Promise((t,i)=>{var r=document.createElement("img"),a=206,n=140;r.onload=(()=>{var i=new PIXI.Sprite(new PIXI.Texture(new PIXI.BaseTexture(r)));e.includes("lut_")||e.includes("_grad")||e.includes("texture_halftone")||e.includes("frost_pattern.jpg")||e.includes("snow_texture.jpg")||e.includes("256star")||e.includes("analog_fx")||e.includes("bw_fx")||e.includes("warm_fx")?e.includes("texture_halftone")?(a=BFN.FilterHelper.getNextPowerOfTwo(i.texture.width),n=BFN.FilterHelper.getNextPowerOfTwo(i.texture.height),i.scale.x=a/i.texture.width,i.scale.y=n/i.texture.height):(a=i.texture.width,n=i.texture.height):(i.scale.x=a/i.texture.width,i.scale.y=n/i.texture.height);var o=PIXI.RenderTexture.create(a,n);BFN.Stage.render(i,o),i.destroy(!0),i=null,this._textureGraphics[e]=o,BeFunky.log("LOADED THUMB : ".concat(e)),r=null,t()}),r.onerror=(()=>i("Failed to load thumbnail ".concat(e))),r.src=this._base64graphics[e]})}getGraphicByName(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this._textureGraphics.hasOwnProperty(e)){var r=BFN.Util.cloneTexture(this._textureGraphics[e]);if(t>0&&i>0||(t=r.width,i=r.height),t!==r.width||i!==r.height){var a=BFN.Util.resizeTexture(r,t,i);return r.destroyGC(!0),r=null,a}return r}this._base64graphics.hasOwnProperty(e)?(this.reportOnce("Thumbnail requested before texture generated",e),this.loadBase64ToTexture(e)):this.reportOnce("Thumbnail requested before base64 loaded",e);var n=PIXI.RenderTexture.create(10,10);return n.fillColor(16711680),n}reportOnce(e){if(!this.warningReported){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];BeFunky.reportWarning(e,...i),this.warningReported=!0,setTimeout(()=>{this.warningReported=!1},1e3)}}setLoaded(e){Promise.all(e).then(()=>{this._isLoaded=!0,this.dispatchEvent(BFN.XMLGraphicLoaderEvents.LOADING_COMPLETE)},e=>{BeFunky.reportWarning("Failed to convert thumbnail base64(s) to texture",e),requestIdleCallback(()=>{this._isLoaded=!0,this.dispatchEvent(BFN.XMLGraphicLoaderEvents.LOADING_COMPLETE)})})}get xmlPath(){return this._xmlPath}set xmlPath(e){this._xmlPath=e,this.loadXml()}get jsonPath(){return this._jsonPath}set jsonPath(e){this._jsonPath=e,this.loadJson()}}BFN.SingletonQueue.add(()=>{BFN.XMLGraphicLoader=new pt});class gt{constructor(){this.init()}init(){this.baseTextures={}}}function ft(){BFN.EventDispatcher.call(this),this.init()}BFN.SingletonQueue.add(()=>{BFN.GoodiesItemLoader=new gt}),BFN.OverlaysThumbLoaderEvents={LOADED:new Event("OVERLAYS_THUMBS_LOADED")},ft.prototype=Object.create(BFN.EventDispatcher.prototype),ft.prototype.init=function(){this.initDefaultValues()},ft.prototype.initDefaultValues=function(){this.thumbs={}},ft.prototype.load=function(e){if(this.thumbs[e])return this.dispatchEvent(BFN.OverlaysThumbLoaderEvents.LOADED);var t="".concat(BFN.overlaysUrl,"_thumbs/").concat(e).concat(BFN.assetsDataVersions.overlays_thumb,".json");BFN.RequestUtils.getJSON(t,t=>{var i=t.error,r=t.response;if(i)return BeFunky.throwError("Unable to load Overlays category ".concat(e),i);r&&r.thumbs&&(this.thumbs[e]=r.thumbs,this.dispatchEvent(BFN.OverlaysThumbLoaderEvents.LOADED))})},ft.prototype.getBase64=function(e,t){if(null!=this.thumbs&&this.thumbs.hasOwnProperty(e))for(var i=0;i<this.thumbs[e].length;i++){var r=this.thumbs[e][i];if(r.id==t)return r.data}return null},ft.prototype.getImage=function(e,t,i,r){var a=null;if(null!=this.thumbs&&this.thumbs.hasOwnProperty(e))for(var n=0;n<this.thumbs[e].length&&(a=this.thumbs[e][n]).id!=t;n++)a=null;if(null!=a){var o=document.createElement("img");o.id=a.id,o.onload=function(){if(1==i){var e=new PIXI.Texture(new PIXI.BaseTexture(o)),t=PIXI.RenderTexture.create(e.width,e.height),a=new PIXI.Sprite(e);BFN.Stage.render(a,t),a.destroy(!0);try{e.destroyGC(!0)}catch(e){}o.src="",null!=r&&r(t)}else r(o)},o.src=a.data}else r()},BFN.SingletonQueue.add(()=>{BFN.OverlaysThumbLoader=new ft});class vt{constructor(){this.init()}init(){}load(e,t,i,r){e=e.split(" ").join("-");var a="".concat(BFN.overlaysUrl+e,"/").concat(t,".png");BFN.RequestUtils.getBase64(a,e=>{var t=e.error,a=e.base64;if(t)return BeFunky.logError(t),void UIToggler.toggleLoadScreen(!1);if(a.includes("data:image")||(a="data:image/png;base64,".concat(a)),r)return i(a);var n=new Image;n.onload=(()=>{var e=new PIXI.Texture(new PIXI.BaseTexture(n)),t=PIXI.RenderTexture.create(e.width,e.height);t.copyPixels(e),e.destroyGC(!0),e=null,i(t)}),n.src=a})}}BFN.SingletonQueue.add(()=>{BFN.OverlaysItemLoader=new vt});class yt{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.thumbs={}}load(e,t){if(this.thumbs.hasOwnProperty(e))return t({success:!0});var i="".concat(BFN.patternsUrl,"_thumbs/").concat(e).concat(BFN.assetsDataVersions.patterns_thumb,".json");BFN.RequestUtils.getJSON(i,i=>{var r=i.error,a=i.response;return r?t({error:"Unable to fetch Patterns thumbnail data for ".concat(e)}):a&&a.thumbs?(this.thumbs[e]=a.thumbs,t({success:!0})):t({error:"Patterns thumbnail data missing thumbs property"})})}}BFN.SingletonQueue.add(()=>{BFN.PatternsThumbLoader=new yt});function xt(){BFN.EventDispatcher.call(this),this.init()}for(var _t in BFN.FilterManagerOverrider=new class{constructor(){}getPotRenderTarget(){BFN.Stage.filterManager.getPotRenderTarget=function(e,t,i,r){var a=(65535&(t*=r))<<16|65535&(i*=r);BFN.Stage.filterManager.pool[a]||(BFN.Stage.filterManager.pool[a]=[]);var n=BFN.Stage.filterManager.pool[a].pop();if(!n){var o=BFN.Stage.filterManager.renderer.boundTextures[0];e.activeTexture(e.TEXTURE0),n=new PIXI.RenderTarget(e,t,i,null,1),e.bindTexture(e.TEXTURE_2D,o._glTextures[BFN.Stage.CONTEXT_UID].texture)}return n.resolution=r,n.defaultFrame.width=n.size.width=t/r,n.defaultFrame.height=n.size.height=i/r,n}}},xt.prototype=Object.create(BFN.EventDispatcher.prototype),xt.prototype.init=function(){BeFunky.log("FlashProjectParser Init"),this.initDefaultValues()},xt.prototype.initDefaultValues=function(){this.blendModeMap={add:BFN.CONST.BLEND_MODES.ADD,alpha:BFN.CONST.BLEND_MODES.ALPHA,darken:BFN.CONST.BLEND_MODES.DARKEN,difference:BFN.CONST.BLEND_MODES.DIFFERENCE,erase:BFN.CONST.BLEND_MODES.ERASE,hardlight:BFN.CONST.BLEND_MODES.HARD_LIGHT,invert:BFN.CONST.BLEND_MODES.DIFFERENCE,layer:BFN.CONST.BLEND_MODES.NORMAL,lighten:BFN.CONST.BLEND_MODES.LIGHTEN,multiply:BFN.CONST.BLEND_MODES.MULTIPLY,normal:BFN.CONST.BLEND_MODES.NORMAL,overlay:BFN.CONST.BLEND_MODES.OVERLAY,screen:BFN.CONST.BLEND_MODES.SCREEN,shader:BFN.CONST.BLEND_MODES.NORMAL,subtract:BFN.CONST.BLEND_MODES.SUBTRACT},this.projectVO=null,this.callback=null,this.itemOffsetX=0,this.itemOffsetY=0,this.templateElementSvgData=null,this.templateElementStates=null,this.templateElementStatesArray=[],this.queuedTemplateElementStates=[],this.designerElementSvgData=null,this.designerElementStates=null,this.designerElementStatesArray=[],this.transformImageStates=[],this.transformMaskImageStates=null,this.queuedTransformMaskImageStates=[],this.transformLabelStates=null},xt.prototype.parseFlashProject=function(e,t){if(this.projectVO)return BeFunky.logError("Already Parsing Project"),null;if("1.0"!=e.version)return BeFunky.logError("Project Already Parsed"),null;if(UIToggler.toggleLoadScreen(!0,{isCancellable:!1}),this.projectVO=new BFN.ProjectVO,this.projectVO.version=2,this.projectVO.section="designer",this.projectVO.sourceTemplateID=e.hasOwnProperty("sourceTemplateID")?e.sourceTemplateID:null,this.projectVO.projectWidth=e.sourceTemplateWidth,this.projectVO.projectHeight=e.sourceTemplateHeight,this.projectVO.designerBackgroundColor=e.sourceTemplateBackgroundColor.toString(16),this.callback=t,this.itemOffsetX=-this.projectVO.projectWidth/2,this.itemOffsetY=-this.projectVO.projectHeight/2,e.sourceTemplate){if(e.sourceTemplate.hasOwnProperty("templateElementSvgData"))for(var i in e.hasOwnProperty("templateElementSvgData")||(e.templateElementSvgData={}),e.templateElementStates)if(e.sourceTemplate.templateElementStates.hasOwnProperty(i))for(var r=e.sourceTemplate.templateElementStates[i],a=e.templateElementStates[i],n=0;n<a.length;n++)if(n<r.length){var o=r[n],s=a[n];if(o.hasOwnProperty("graphicSvgShapeData")){for(var l=0;l<o.graphicSvgShapeData.length;l++){var h=o.graphicSvgShapeData[l].svgID;e.sourceTemplate.templateElementSvgData.hasOwnProperty(h)&&!e.templateElementSvgData.hasOwnProperty(h)&&(e.templateElementSvgData[h]=e.sourceTemplate.templateElementSvgData[h])}s.graphicSvgShapeData=o.graphicSvgShapeData}}for(var c=0;c<e.transformMaskImageStates.length;c++){var u=e.transformMaskImageStates[c];if(u.maskImageURL&&u.maskImageBase64&&(u.maskImageOriginalTemplateID=null),u.maskImageOriginalTemplateID)for(var d=0;d<e.sourceTemplate.transformMaskImageStates.length;d++){var m=e.sourceTemplate.transformMaskImageStates[d];m.maskImageOriginalTemplateID&&m.maskImageOriginalTemplateID==u.maskImageOriginalTemplateID&&m.maskImageBase64&&(u.maskImageBase64=m.maskImageBase64)}}}for(var p in this.templateElementSvgData=e.templateElementSvgData,this.templateElementStates=e.templateElementStates,this.templateElementStatesArray.splice(0),this.queuedTemplateElementStates.splice(0),this.templateElementStates)for(var g=this.templateElementStates[p],f=0;f<g.length;f++)g[f].svgID=p+"_"+f,this.templateElementStatesArray.push(g[f]),this.queuedTemplateElementStates.push(g[f]);for(var v in this.designerElementSvgData=e.designerElementSvgData,this.designerElementStates=e.designerElementStates,this.designerElementStatesArray.splice(0),this.designerElementStates)for(var y in this.designerElementStates[v])if(this.designerElementSvgData.hasOwnProperty(y))for(var x=this.designerElementStates[v][y],_=0;_<x.length;_++)x[_].svgID=y,this.designerElementStatesArray.push(x[_]);this.transformImageStates.splice(0),this.transformMaskImageStates=e.transformMaskImageStates,this.queuedTransformMaskImageStates.splice(0);for(var I=0;I<this.transformMaskImageStates.length;I++)this.queuedTransformMaskImageStates.push(this.transformMaskImageStates[I]);this.transformLabelStates=e.transformLabelStates,this.processQueuedTemplateElementStates()},xt.prototype.processQueuedTemplateElementStates=function(){if(this.queuedTemplateElementStates.length){var e=this.queuedTemplateElementStates.shift();if(e.graphicSvgShapeData&&e.graphicSvgShapeData.length){for(var t=null,i=e.graphicSvgShapeData.length;--i>-1;){var r=e.graphicSvgShapeData[i];if(r.hasOwnProperty("svgImage")){t=r;break}}if(t){e.graphicSvgShapeData.splice(0),e.graphicSvgShapeData=null,delete e.graphicSvgShapeData,e.imageID=t.svgID,e.imageBase64=t.svgImage;for(var a=0;a<this.templateElementStatesArray.length;a++){if(this.templateElementStatesArray[a]==e){this.templateElementStatesArray.splice(a,1);break}}this.transformImageStates.push(e),this.processQueuedTemplateElementStates()}else BFN.SVGManager.combineSVGs(e.graphicSvgShapeData,this.templateElementSvgData,function(t){if(t)e.svgID=t;else{var i=this.templateElementStates.indexOf(e);-1!=i&&this.templateElementStates.splice(i,1)}this.processQueuedTemplateElementStates()}.bind(this))}else this.processQueuedTemplateElementStates()}else this.processQueuedTransformMaskImageStates()},xt.prototype.processQueuedTransformMaskImageStates=function(){if(this.queuedTransformMaskImageStates.length){var e=this.queuedTransformMaskImageStates.shift();if(e.hasOwnProperty("maskImageMaskSvgShapeData")){var t=e.maskImageMaskSvgShapeData;t&&t.length?BFN.SVGManager.combineSVGs(t,this.templateElementSvgData,function(t){if(t)e.maskSvgID=t;else{var i=this.transformMaskImageStates.indexOf(e);-1!=i&&this.transformMaskImageStates.splice(i,1)}this.processQueuedTemplateElementStates()}.bind(this),!0,!0):this.processQueuedTransformMaskImageStates()}else this.processQueuedTransformMaskImageStates()}else this.buildProjectVO()},xt.prototype.buildProjectVO=function(){if(this.projectVO&&this.callback){for(var e in this.designerElementSvgData)this.projectVO.svgData.hasOwnProperty(e)||(this.projectVO.svgData[e]=this.designerElementSvgData[e]);for(var t in BFN.SVGManager.cachedCombinedSVGs)this.projectVO.svgData.hasOwnProperty(t)||(this.projectVO.svgData[t]=BFN.SVGManager.cachedCombinedSVGs[t]);BFN.SVGManager.clearCache();for(var i=0;i<this.templateElementStatesArray.length;i++){var r=this.templateElementStatesArray[i],a=new BFN.ProjectItemVO;a.type="graphic",a.graphicID=r.svgID,this.transferTransformProperties(a,r),this.projectVO.transformGraphics.push(a)}for(var n=0;n<this.designerElementStatesArray.length;n++){var o=this.designerElementStatesArray[n],s=new BFN.ProjectItemVO;s.type="graphic",s.graphicID=o.svgID,this.transferTransformProperties(s,o),this.projectVO.transformGraphics.push(s)}for(var l=0;l<this.transformImageStates.length;l++){var h=this.transformImageStates[l],c=null;if(h.hasOwnProperty("imageID")&&null!=h.imageID&&(c="image_"+BeFunky.hash(h.imageID).toString(36)),c&&h.imageBase64){this.projectVO.imageData.hasOwnProperty(c)||(this.projectVO.imageData[c]=h.imageBase64);var u=new BFN.ProjectItemVO;u.type="image",u.imageID=c,this.transferTransformProperties(u,h),this.projectVO.transformImages.push(u)}}for(var d=0;d<this.transformMaskImageStates.length;d++){var m=this.transformMaskImageStates[d],p=null;if(m.hasOwnProperty("maskImageOriginalTemplateID")&&null!=m.maskImageOriginalTemplateID?p="mask_image_"+BeFunky.hash(m.maskImageOriginalTemplateID).toString(36):m.hasOwnProperty("maskImageURL")&&null!=m.maskImageURL&&(p="mask_image_"+BeFunky.hash(m.maskImageURL).toString(36)),p&&m.maskImageBase64){this.projectVO.imageData.hasOwnProperty(p)||(this.projectVO.imageData[p]=m.maskImageBase64);var g=new BFN.ProjectItemVO;g.type="mask_image",g.maskImageID=p,g.maskImageFlashVars={},g.maskImageFlashVars.maskImageX=m.maskImageBitmapX,g.maskImageFlashVars.maskImageY=m.maskImageBitmapY,g.maskImageFlashVars.maskImageScaleX=m.maskImageBitmapScaleX,g.maskImageFlashVars.maskImageScaleY=m.maskImageBitmapScaleY,g.maskImageFlashVars.maskImageWidth=m.maskImageItemWidth,g.maskImageFlashVars.maskImageHeight=m.maskImageItemHeight,m.hasOwnProperty("maskSvgID")&&(g.maskImageMaskID=m.maskSvgID),this.transferTransformProperties(g,m),this.projectVO.transformMaskImages.push(g)}}for(var f=0;f<this.transformLabelStates.length;f++){var v=this.transformLabelStates[f],y=new BFN.ProjectItemVO;y.type="label",y.labelText=v.labelText,y.labelTextStyles=v.labelTextStyles,y.labelWidth=Math.ceil(v.labelWidth)+2;var x=(y.labelWidth+BFN.TransformItemTextBaseFontSize)*v.scale;if(y.labelTextScale=x>BFN.maxImageSize?BFN.maxImageSize/y.labelWidth:v.scale,y.labelTextItemScale=x>BFN.maxImageSize?x/BFN.maxImageSize:1,v.hasOwnProperty("accurateBounds")&&v.accurateBounds)y.labelBounds=new BFN.Rectangle(v.accurateBounds.x+this.itemOffsetX,v.accurateBounds.y+this.itemOffsetY,v.accurateBounds.width,v.accurateBounds.x.height);else{var _=v.rotation*(Math.PI/180),I={distance:5*v.scale,direction:Math.PI/4+_};if(y.positionOffsetVectors=[I],y.labelText.length&&y.labelTextStyles.styles[0]&&y.labelTextStyles.styles[0][0]){var T=y.labelTextStyles.styles[0][0],b={distance:2*v.scale,direction:Math.PI/4+_};if(y.positionOffsetVectors.push(b),T.hasOwnProperty("fontFamily")&&T.hasOwnProperty("fontSize")&&BFN.FontOffsetVectors.hasOwnProperty(T.fontFamily)){var S=BFN.FontOffsetVectors[T.fontFamily],C=S.distance/100*(T.fontSize*v.scale),B=S.direction+_;y.positionOffsetVectors.push({distance:C,direction:B})}else console.log(T.fontFamily+" not found in BFN.FontOffsetVectors, Final Offset Not Applied : "+y.labelText)}}this.transferTransformProperties(y,v),this.projectVO.transformLabels.push(y)}UIToggler.toggleLoadScreen(!1),this.callback(this.projectVO),this.projectVO=null}},xt.prototype.transferTransformProperties=function(e,t){e.transformZIndex=t.zIndex,e.transformLocked=t.locked,e.transformX=t.x+this.itemOffsetX,e.transformY=t.y+this.itemOffsetY,e.transformRotation=t.rotation*(Math.PI/180),e.transformScale=t.scale,e.transformScaleX=t.scaleX,e.transformScaleY=t.scaleY,e.transformFlippedHorizontal=t.flippedHorizontal,e.transformFlippedVertical=t.flippedVertical,e.transformOpacity=t.opacity,e.transformBlendMode=this.blendModeMap.hasOwnProperty(t.blendMode)?this.blendModeMap[t.blendMode]:BFN.CONST.BLEND_MODES.NORMAL,e.transformOverlayColor=t.tintColorEnabled?t.tintColor.toString(16):-1,e.transformOverlayColorIntensity=t.tintColorEnabled?t.tintMultiplier:0,e.transformTintColor=-1},BFN.SingletonQueue.add(function(){BFN.FlashProjectParser=new xt}),BFN.UIMenuData={mainMenus:{editor:[{id:"editor_main_image_manager",name:"image_manager",icon:"main-menu-image-manager-icon"},{id:"editor_main_edit",name:"edit",icon:"main-menu-edit-icon"},{id:"editor_main_touch_up",name:"touchup",icon:"main-menu-touchup-icon"},{id:"editor_main_effect",name:"effects",icon:"main-menu-effect-icon"},{id:"editor_main_artsy",name:"artsy",icon:"main-menu-artsy-icon"},{id:"editor_main_frame",name:"frames",icon:"main-menu-frame-icon"},{id:"editor_main_graphic",name:"graphics",icon:"main-menu-graphics-icon"},{id:"editor_main_overlay",name:"overlays",icon:"main-menu-overlay-icon"},{id:"editor_main_text",name:"text",icon:"main-menu-text-icon"},{id:"editor_main_texture",name:"textures",icon:"main-menu-textures-icon"}],collage:[{id:"collage_main_image_manager",name:"image_manager",icon:"main-menu-image-manager-icon"},{id:"collage_main_customize",name:"customize",icon:"main-menu-collage-setting"},{id:"collage_main_layouts",name:"layouts",icon:"main-menu-collage-layouts"},{id:"collage_main_patterns",name:"patterns",icon:"main-menu-background"},{id:"collage_main_graphic",name:"graphics",icon:"main-menu-graphics-icon"},{id:"collage_main_text",name:"text",icon:"main-menu-text-icon"}],designer:[{id:"designer_main_image_manager",name:"image_manager",icon:"main-menu-image-manager-icon"},{id:"designer_main_customize",name:"customize",icon:"main-menu-collage-setting"},{id:"designer_main_templates",name:"templates",icon:"main-menu-designer-template"},{id:"designer_main_graphic",name:"graphics",icon:"main-menu-graphics-icon"},{id:"designer_main_text",name:"text",icon:"main-menu-text-icon"}]},accordionMenus:{editor_edit:[{name:"enhance_dlx",isOpen:!1,items:[{id:"editor_edit_hdr_dlx",name:"HDR DLX",icon:"dlx-hdr",isPlus:!0},{id:"editor_edit_sharpen_dlx",name:"Sharpen DLX",icon:"dlx-sharpen",isPlus:!0},{id:"editor_edit_vibrant_colors_dlx",name:"Vibrant Colors DLX",icon:"dlx-vibrant",isPlus:!0},{id:"editor_edit_denoise_dlx",name:"Denoise DLX",icon:"dlx-denoise",isPlus:!0}]},{name:"essentials",items:[{id:"editor_edit_crop",name:"crop",icon:"edit-menu-crop-icon",iconStroke:!1},{id:"editor_edit_resize",name:"resize",icon:"edit-menu-resize-icon"},{id:"editor_edit_rotate",name:"rotate",icon:"edit-menu-rotate-icon"},{id:"editor_edit_cutout",name:"cutout",icon:"edit-menu-cutout-icon",isPlus:!0},{id:"editor_edit_background",name:"background",icon:"edit-menu-background-icon",isPlus:!0},{id:"editor_edit_replace_color",name:"replace_color",icon:"edit-setting-replace-color-icon",isPlus:!0},{id:"editor_edit_exposure",name:"exposure",icon:"edit-menu-exposure-icon"},{id:"editor_edit_fill_light",name:"fill_light",icon:"edit-menu-fill-light-icon",isPlus:!0},{id:"editor_edit_auto_enhance",name:"auto_enhance",icon:"edit-menu-auto-enhance",isPlus:!0},{id:"editor_edit_beautify",name:"beautify",icon:"edit-menu-beautify-icon"},{id:"editor_edit_color",name:"color",icon:"edit-menu-color-icon"},{id:"editor_edit_vibrance",name:"vibrance",icon:"edit-menu-vibrance-icon",isPlus:!0},{id:"editor_edit_sharpen",name:"sharpen",icon:"edit-menu-sharpen-icon"},{id:"editor_edit_clarity",name:"clarity",icon:"edit-menu-clarity-icon",isPlus:!0},{id:"editor_edit_glow",name:"glow",icon:"edit-menu-glow",isPlus:!0},{id:"editor_edit_funky_vignette",name:"vignette",icon:"edit-menu-vignette-icon",isPlus:!0}]},{name:"blur_and_smooth",items:[{id:"editor_edit_smoothing",name:"smoothing",icon:"edit-menu-smoothing-icon"},{id:"editor_edit_blur",name:"blur",icon:"edit-menu-blur-icon"},{id:"editor_edit_lens_blur",name:"lens_blur",icon:"edit-menu-lens-blur-icon",isPlus:!0},{id:"editor_edit_funky_focus",name:"funky_focus",icon:"edit-menu-funky-focus-icon",isPlus:!0},{id:"editor_edit_soften",name:"soften",icon:"edit-menu-soften-icon"},{id:"editor_edit_blur_edges",name:"blur_edges",icon:"edit-menu-blur-edges-icon"}]},{name:"miscellaneous",items:[{id:"editor_edit_tilt",name:"tilt",icon:"edit-menu-tilt-icon"},{id:"editor_edit_tint",name:"tint",icon:"edit-menu-tint-icon"},{id:"editor_edit_levels",name:"levels",icon:"edit-menu-levels-icon",isPlus:!0},{id:"editor_edit_color_mixer",name:"color_mixer",icon:"edit-menu-color-mixer-icon"}]}],editor_touch_up:[{name:"skin",items:[{id:"editor_touch_up_perfectskin",name:"skin_heal",icon:"touchup-menu-perfect-skin",isPlus:!0},{id:"editor_touch_up_wrinkles",name:"wrinkles",icon:"touchup-menu-wrinkles-icon",isPlus:!0},{id:"editor_touch_up_blemish_fix",name:"blemish_fix",icon:"touchup-menu-blemish-fix-icon"},{id:"editor_touch_up_bronzer",name:"bronzer",icon:"touchup-menu-bronzer-icon",isPlus:!0},{id:"editor_touch_up_blush",name:"blush",icon:"touchup-menu-blush-icon"},{id:"editor_touch_up_flashspot",name:"flashspot",icon:"touchup-menu-flashspot-icon",isPlus:!0},{id:"editor_touch_up_clone",name:"clone",icon:"touchup-menu-clone-icon",isPlus:!0}]},{name:"eyes",items:[{id:"editor_touch_up_mascara",name:"mascara",icon:"touchup-menu-mascara-icon",isPlus:!0},{id:"editor_touch_up_eye_color",name:"eye_color",icon:"touchup-menu-eye-color-icon",isPlus:!0},{id:"editor_touch_up_eye_brighten",name:"eye_brighten",icon:"touchup-menu-eye-brighten-icon",isPlus:!0},{id:"editor_touch_up_eyebrow_pencil",name:"eyebrow_pencil",icon:"touchup-menu-eyebrow-pencil-icon",isPlus:!0},{id:"editor_touch_up_fix_redeye",name:"fix_redeye",icon:"touchup-menu-fix-redeye-icon"}]},{name:"mouth",items:[{id:"editor_touch_up_lipstick",name:"lipstick",icon:"touchup-menu-lipstick-icon",isPlus:!0},{id:"editor_touch_up_teeth_whiten",name:"teeth_whiten",icon:"touchup-menu-teeth-whiten-icon"}]},{name:"miscellaneous",items:[{id:"editor_touch_up_hair_color",name:"hair_color",icon:"touchup-menu-hair-color-icon",isPlus:!0},{id:"editor_touch_up_reshape",name:"reshape",icon:"touchup-menu-reshape-icon",isPlus:!0},{id:"editor_touch_up_paint_brush",name:"paint_brush",icon:"touchup-menu-paint-brush-icon"},{id:"editor_touch_up_slimming",name:"slimming",icon:"touchup-menu-slimming-icon",isPlus:!0}]}]},categoryMenus:{editor_effect:[{id:"editor_effect_effect_featured",name:"Featured",graphicClass:"category-menu__button--effect-v4-1"},{id:"editor_effect_effect_favorites",name:'<span class="star-text-favorite">Favorites</span>',graphicClass:"category-menu__button--effect-v4-2"},{id:"editor_effect_bwfx",name:"B&W Tones",graphicClass:"category-menu__button--effect-v4-3"},{id:"editor_effect_warmfx",name:"Warmer Tones",graphicClass:"category-menu__button--effect-v4-4"},{id:"editor_effect_analog",name:"Analog Tones",graphicClass:"category-menu__button--effect-v4-5"},{id:"editor_effect_lens_flares",name:"Lens Flare",graphicClass:"category-menu__button--effect-v4-6"},{id:"editor_effect_glitch_art",name:"Glitch Art",graphicClass:"category-menu__button--effect-v4-7",isNew:!0},{id:"editor_effect_chromatic",name:"Chromatic",graphicClass:"category-menu__button--effect-v4-8"},{id:"editor_effect_bw",name:"Black & White",graphicClass:"category-menu__button--effect-v4-9"},{id:"editor_effect_charcoal",name:"Charcoal",graphicClass:"category-menu__button--effect-v4-10"},{id:"editor_effect_cinematic",name:"Cinematic",graphicClass:"category-menu__button--effect-v4-11",isNew:!0},{id:"editor_effect_colorpinhole",name:"Color Pinhole",graphicClass:"category-menu__button--effect-v4-12"},{id:"editor_effect_cooler",name:"Cooler",graphicClass:"category-menu__button--effect-v4-13"},{id:"editor_effect_crossprocess",name:"Cross Process",graphicClass:"category-menu__button--effect-v4-14"},{id:"editor_effect_cyanotype",name:"Cyanotype",graphicClass:"category-menu__button--effect-v4-15"},{id:"editor_effect_grungefx",name:"Grunge",graphicClass:"category-menu__button--effect-v4-16"},{id:"editor_effect_hdr",name:"HDR",graphicClass:"category-menu__button--effect-v4-17"},{id:"editor_effect_holgaart",name:"Holga Art",graphicClass:"category-menu__button--effect-v4-18"},{id:"editor_effect_instant",name:"Instant",graphicClass:"category-menu__button--effect-v4-19"},{id:"editor_effect_lineartopia",name:"Line Artopia",graphicClass:"category-menu__button--effect-v4-20"},{id:"editor_effect_lomoart",name:"Lomo Art",graphicClass:"category-menu__button--effect-v4-21"},{id:"editor_effect_motioncolor",name:"Motion Color",graphicClass:"category-menu__button--effect-v4-22"},{id:"editor_effect_multimedia",name:"Multimedia",graphicClass:"category-menu__button--effect-v4-23",isNew:!0},{id:"editor_effect_oldphotofx",name:"Old Photo",graphicClass:"category-menu__button--effect-v4-24"},{id:"editor_effect_orton_style",name:"Orton Style",graphicClass:"category-menu__button--effect-v4-25"},{id:"editor_effect_patrioticfx",name:"Patriotic",graphicClass:"category-menu__button--effect-v4-26"},{id:"editor_effect_pinhole",name:"Pinhole",graphicClass:"category-menu__button--effect-v4-27"},{id:"editor_effect_popartfx",name:"Pop Art",graphicClass:"category-menu__button--effect-v4-28"},{id:"editor_effect_sepia",name:"Sepia",graphicClass:"category-menu__button--effect-v4-29"},{id:"editor_effect_stenciler",name:"Stenciler",graphicClass:"category-menu__button--effect-v4-30"},{id:"editor_effect_summer",name:"Summer",graphicClass:"category-menu__button--effect-v4-31"},{id:"editor_effect_sunburst",name:"Sunburst",graphicClass:"category-menu__button--effect-v4-32"},{id:"editor_effect_tiltshiftfx",name:"Tilt Shift",graphicClass:"category-menu__button--effect-v4-33"},{id:"editor_effect_tinytype",name:"Tin Type",graphicClass:"category-menu__button--effect-v4-34"},{id:"editor_effect_unitedcolors",name:"United Colors",graphicClass:"category-menu__button--effect-v4-35"},{id:"editor_effect_warmer",name:"Warmer",graphicClass:"category-menu__button--effect-v4-36"},{id:"editor_effect_viewfinder",name:"Viewfinder",graphicClass:"category-menu__button--effect-v4-37"},{id:"editor_effect_vintagecolors",name:"Vintage Colors",graphicClass:"category-menu__button--effect-v4-38"},{id:"editor_effect_winterfx",name:"Winter",graphicClass:"category-menu__button--effect-v4-39"}].filter(Boolean),editor_artsy:[{id:"editor_artsy_artsy_favorites",name:'<span class="star-text-favorite">Favorites</span>',graphicClass:"category-menu__button--artsy-3"},!!BeFunky.Params.isBeta&&{id:"editor_artsy_ai_artsy_style",name:"A.I. Artsy Style",graphicClass:"",isNew:!0},{id:"editor_artsy_digitalart",name:"Digital Art",graphicClass:"category-menu__button--artsy-2"},{id:"editor_artsy_cartoonizer",name:"Cartoonizer",graphicClass:"category-menu__button--artsy-4"},{id:"editor_artsy_gouache",name:"Gouache",graphicClass:"category-menu__button--artsy-5"},{id:"editor_artsy_impressionist",name:"Impressionist",graphicClass:"category-menu__button--artsy-6"},{id:"editor_artsy_inkify",name:"Inkify",graphicClass:"category-menu__button--artsy-7"},{id:"editor_artsy_oilpainting",name:"Oil Painting",graphicClass:"category-menu__button--artsy-8"},{id:"editor_artsy_pointillism",name:"Pointillism",graphicClass:"category-menu__button--artsy-9"},{id:"editor_artsy_sketcher",name:"Sketcher",graphicClass:"category-menu__button--artsy-10"},{id:"editor_artsy_underpainting",name:"Underpainting",graphicClass:"category-menu__button--artsy-11"},{id:"editor_artsy_watercolor",name:"Watercolor",graphicClass:"category-menu__button--artsy-12"}].filter(Boolean),editor_frame:[{id:"editor_frame_frame_featured",name:"Featured",graphicClass:"category-menu__button--frame-1"},{id:"editor_frame_frame_border",name:"Border",graphicClass:"category-menu__button--frame-2"},{id:"editor_frame_frame_drop_shadow",name:"Drop Shadow",graphicClass:"category-menu__button--frame-3"},{id:"editor_frame_frame_decorative",name:"Decorative",graphicClass:"category-menu__button--frame-4"},{id:"editor_frame_frame_vintage",name:"Vintage",graphicClass:"category-menu__button--frame-5"},{id:"editor_frame_frame_art_deco",name:"Art Deco",graphicClass:"category-menu__button--frame-6"},{id:"editor_frame_frame_floral",name:"Floral",graphicClass:"category-menu__button--frame-7"},{id:"editor_frame_frame_rustic",name:"Rustic",graphicClass:"category-menu__button--frame-8"},{id:"editor_frame_frame_lace",name:"Lace",graphicClass:"category-menu__button--frame-9"},{id:"editor_frame_frame_ornament",name:"Ornament",graphicClass:"category-menu__button--frame-10"},{id:"editor_frame_frame_hand_drawn",name:"Hand Drawn",graphicClass:"category-menu__button--frame-11"},{id:"editor_frame_frame_instant",name:"Instant",graphicClass:"category-menu__button--frame-12"},{id:"editor_frame_frame_grunge",name:"Grunge",graphicClass:"category-menu__button--frame-13"},{id:"editor_frame_frame_filmstrip",name:"Film Strip",graphicClass:"category-menu__button--frame-14"},{id:"editor_frame_frame_realistic",name:"Realistic",graphicClass:"category-menu__button--frame-15"}],editor_overlay:[{id:"editor_overlay_featured",name:"Featured",graphicClass:"category-menu__button--overlay-1"},{id:"editor_overlay_circular",name:"Circular",graphicClass:"category-menu__button--overlay-2"},{id:"editor_overlay_brushes",name:"Brushes",graphicClass:"category-menu__button--overlay-3"},{id:"editor_overlay_floral",name:"Floral",graphicClass:"category-menu__button--overlay-4"},{id:"editor_overlay_holiday_earth_day",name:"Earth Day",graphicClass:"category-menu__button--overlay-5"},{id:"editor_overlay_geometry",name:"Geometry",graphicClass:"category-menu__button--overlay-6"},{id:"editor_overlay_a_z",name:"Alphabet",graphicClass:"category-menu__button--overlay-7"},{id:"editor_overlay_animals",name:"Animals",graphicClass:"category-menu__button--overlay-8"},{id:"editor_overlay_hearts",name:"Hearts",graphicClass:"category-menu__button--overlay-9"},{id:"editor_overlay_halloween",name:"Halloween",graphicClass:"category-menu__button--overlay-10"},{id:"editor_overlay_st_patricks_day",name:"St. Patrick's Day",graphicClass:"category-menu__button--overlay-11"},{id:"editor_overlay_valentines_day",name:"Valentine's Day",graphicClass:"category-menu__button--overlay-12"},{id:"editor_overlay_numbers",name:"Numbers",graphicClass:"category-menu__button--overlay-13"},{id:"editor_overlay_patterns",name:"Patterns",graphicClass:"category-menu__button--overlay-14"},{id:"editor_overlay_sports",name:"Sports",graphicClass:"category-menu__button--overlay-15"},{id:"editor_overlay_symbols",name:"Symbols",graphicClass:"category-menu__button--overlay-16"},{id:"editor_overlay_winter_holidays",name:"Winter Holidays",graphicClass:"category-menu__button--overlay-17"}],editor_text:[],editor_texture:[{id:"editor_texture_texture_featured",name:"Featured",graphicClass:"category-menu__button--textures-1"},{id:"editor_texture_bokeh",name:"Bokeh",graphicClass:"category-menu__button--textures-2"},{id:"editor_texture_scratches",name:"Scratches",graphicClass:"category-menu__button--textures-3"},{id:"editor_texture_light",name:"Light Trails",graphicClass:"category-menu__button--textures-4"},{id:"editor_texture_lightleak",name:"Light Leaks",graphicClass:"category-menu__button--textures-5"},{id:"editor_texture_fabric",name:"Fabric",graphicClass:"category-menu__button--textures-6"},{id:"editor_texture_grunge",name:"Grunge",graphicClass:"category-menu__button--textures-7"},{id:"editor_texture_paint",name:"Paint",graphicClass:"category-menu__button--textures-8"},{id:"editor_texture_metal",name:"Metal",graphicClass:"category-menu__button--textures-9"},{id:"editor_texture_bricks",name:"Bricks",graphicClass:"category-menu__button--textures-10"},{id:"editor_texture_paper",name:"Paper",graphicClass:"category-menu__button--textures-11"}],collage_layouts:[{id:"collage_layouts_featured",name:"Featured",graphicClass:"category-menu__button--layout-1"},{id:"collage_layouts_grid",name:"Grid",graphicClass:"category-menu__button--layout-2"},{id:"collage_layouts_big_photo_wrap",name:"Big Photo Wrap",graphicClass:"category-menu__button--layout-3"},{id:"collage_layouts_facebook",name:"Facebook Cover",graphicClass:"category-menu__button--layout-4"},{id:"collage_layouts_pinterest",name:"Pinterest",graphicClass:"category-menu__button--layout-5"}],collage_patterns:[{id:"collage_patterns_featured",name:"Featured",graphicClass:"category-menu__button--pattern-1"},{id:"collage_patterns_autumn",name:"Autumn",graphicClass:"category-menu__button--pattern-2"},{id:"collage_patterns_fabric",name:"Fabric",graphicClass:"category-menu__button--pattern-3"},{id:"collage_patterns_fancy",name:"Fancy",graphicClass:"category-menu__button--pattern-4"},{id:"collage_patterns_geometric",name:"Geometric",graphicClass:"category-menu__button--pattern-5"},{id:"collage_patterns_polka_dots",name:"Polka Dots",graphicClass:"category-menu__button--pattern-6"},{id:"collage_patterns_stripes",name:"Stripes",graphicClass:"category-menu__button--pattern-7"},{id:"collage_patterns_summer",name:"Summer",graphicClass:"category-menu__button--pattern-8"},{id:"collage_patterns_love",name:"Love",graphicClass:"category-menu__button--pattern-9"},{id:"collage_patterns_winter",name:"Winter",graphicClass:"category-menu__button--pattern-10"}]}},BFN.accordionMenuPlusIDs=[],BFN.UIMenuData.accordionMenus)for(var It=BFN.UIMenuData.accordionMenus[_t],Tt=0;Tt<It.length;Tt++)for(var bt=It[Tt],St=0;St<bt.items.length;St++){var Ct=bt.items[St];Ct.hasOwnProperty("isPlus")&&Ct.isPlus&&BFN.accordionMenuPlusIDs.push(Ct.id.replace("".concat(_t,"_"),""))}function Bt(){var t=e(['<span class="dropdown__template-name">Large Mobile</span> <span class="dropdown__template-dimensions">320 x 100px</span>']);return Bt=function(){return t},t}function Ft(){var t=e(['<span class="dropdown__template-name">Half Page</span> <span class="dropdown__template-dimensions">300 x 600px</span>']);return Ft=function(){return t},t}function Et(){var t=e(['<span class="dropdown__template-name">Large Rectangle</span> <span class="dropdown__template-dimensions">336 x 280px</span>']);return Et=function(){return t},t}function Pt(){var t=e(['<span class="dropdown__template-name">Medium Rectangle</span> <span class="dropdown__template-dimensions">300 x 250px</span>']);return Pt=function(){return t},t}function Nt(){var t=e(['<span class="dropdown__template-name">Large Leaderboard</span> <span class="dropdown__template-dimensions">728 x 210px</span>']);return Nt=function(){return t},t}function Mt(){var t=e(['<span class="dropdown__template-name">Leaderboard</span> <span class="dropdown__template-dimensions">728 x 90px</span>']);return Mt=function(){return t},t}function Dt(){var t=e(['<span class="dropdown__template-name">Wide Skyscraper</span> <span class="dropdown__template-dimensions">160 x 600px</span>']);return Dt=function(){return t},t}function wt(){var t=e(['<span class="dropdown__template-name">Skyscraper</span> <span class="dropdown__template-dimensions">120 x 600px</span>']);return wt=function(){return t},t}function kt(){var t=e(['<span class="dropdown__template-name">Facebook Ad</span> <span class="dropdown__template-dimensions">1200 x 628px</span>']);return kt=function(){return t},t}function Lt(){var t=e(['<span class="dropdown__category-header">',""]);return Lt=function(){return t},t}function Ot(){var t=e(['<span class="dropdown__template-name">Poster</span> <span class="dropdown__template-dimensions">11 x 17"</span>']);return Ot=function(){return t},t}function Rt(){var t=e(['<span class="dropdown__template-name">A4</span> <span class="dropdown__template-dimensions">21 x 29.7cm</span>']);return Rt=function(){return t},t}function At(){var t=e(['<span class="dropdown__template-name">Letter</span> <span class="dropdown__template-dimensions">8.5 x 11"</span>']);return At=function(){return t},t}function Vt(){var t=e(['<span class="dropdown__template-name">Rack Card</span> <span class="dropdown__template-dimensions">4 x 9</span>']);return Vt=function(){return t},t}function Ut(){var t=e(['<span class="dropdown__template-name">Half Letter</span> <span class="dropdown__template-dimensions">5.5 x 8.5"</span>']);return Ut=function(){return t},t}function Gt(){var t=e(['<span class="dropdown__template-name">Greeting Card</span> <span class="dropdown__template-dimensions">7 x 5"</span>']);return Gt=function(){return t},t}function Ht(){var t=e(['<span class="dropdown__template-name">Postcard</span> <span class="dropdown__template-dimensions">6 x 4"</span>']);return Ht=function(){return t},t}function zt(){var t=e(['<span class="dropdown__template-name">Thank You Card</span> <span class="dropdown__template-dimensions">5 x 3"</span>']);return zt=function(){return t},t}function Xt(){var t=e(['<span class="dropdown__template-name">Business Card</span> <span class="dropdown__template-dimensions">3.5 x 2"</span>']);return Xt=function(){return t},t}function jt(){var t=e(['<span class="dropdown__template-name">Square</span> <span class="dropdown__template-dimensions">11 x 11"</span>']);return jt=function(){return t},t}function Wt(){var t=e(['<span class="dropdown__category-header">',"</span>"]);return Wt=function(){return t},t}function Yt(){var t=e(['<span class="dropdown__template-name">Etsy Order Receipt Banner</span> <span class="dropdown__template-dimensions">760 x 100px</span>']);return Yt=function(){return t},t}function qt(){var t=e(['<span class="dropdown__template-name">Etsy Mini Banner</span> <span class="dropdown__template-dimensions">3360 x 448px</span>']);return qt=function(){return t},t}function Kt(){var t=e(['<span class="dropdown__template-name">Etsy Big Banner</span> <span class="dropdown__template-dimensions">3360 x 840px</span>']);return Kt=function(){return t},t}function Qt(){var t=e(['<span class="dropdown__template-name">Pinterest Pin </span> <span class="dropdown__template-dimensions">1000 x 1500px</span>']);return Qt=function(){return t},t}function Zt(){var t=e(['<span class="dropdown__template-name">Twitter Header</span> <span class="dropdown__template-dimensions">1500 x 500px</span>']);return Zt=function(){return t},t}function Jt(){var t=e(['<span class="dropdown__template-name">Twitter Post</span> <span class="dropdown__template-dimensions">1200 x 675px</span>']);return Jt=function(){return t},t}function $t(){var t=e(['<span class="dropdown__template-name">YouTube Thumbnail</span> <span class="dropdown__template-dimensions">1280 x 720px</span>']);return $t=function(){return t},t}function ei(){var t=e(['<span class="dropdown__template-name">YouTube Channel Art</span> <span class="dropdown__template-dimensions">2560 x 1440px</span>']);return ei=function(){return t},t}function ti(){var t=e(['<span class="dropdown__template-name">Facebook Event Cover</span> <span class="dropdown__template-dimensions">1920 x 1080px</span>']);return ti=function(){return t},t}function ii(){var t=e(['<span class="dropdown__template-name">Facebook Page Cover</span> <span class="dropdown__template-dimensions">1640 x 624px</span>']);return ii=function(){return t},t}function ri(){var t=e(['<span class="dropdown__template-name">Facebook Cover</span> <span class="dropdown__template-dimensions">1702 x 630px</span>']);return ri=function(){return t},t}function ai(){var t=e(['<span class="dropdown__template-name">Facebook Post</span> <span class="dropdown__template-dimensions">1200 x 1200px</span>']);return ai=function(){return t},t}function ni(){var t=e(['<span class="dropdown__template-name">Instagram Post</span> <span class="dropdown__template-dimensions">1080 x 1080px</span>']);return ni=function(){return t},t}function oi(){var t=e(['<span class="dropdown__template-name">Social Media Story</span> <span class="dropdown__template-dimensions">1080 x 1920px</span>']);return oi=function(){return t},t}function si(){var t=e(['<span class="dropdown__template-name">Presentation (16:9)</span> <span class="dropdown__template-dimensions">1920 x 1080px</span>']);return si=function(){return t},t}function li(){var t=e(['<span class="dropdown__template-name">Presentation (4:3)</span> <span class="dropdown__template-dimensions">1024 x 768px</span>']);return li=function(){return t},t}function hi(){var t=e(['<span class="dropdown__category-header">',"</span>"]);return hi=function(){return t},t}function ci(){var t=e(["<span>Freeform</span>"]);return ci=function(){return t},t}var ui=BeFunky.lit,di=ui.html,mi=ui.lang;for(var pi in BFN.DropDownData={blendModes:[{name:"normal",value:BFN.CONST.BLEND_MODES.NORMAL},{name:"overlay",value:BFN.CONST.BLEND_MODES.OVERLAY},{name:"soft_light",value:BFN.CONST.BLEND_MODES.SOFT_LIGHT},{name:"multiply",value:BFN.CONST.BLEND_MODES.MULTIPLY},{name:"screen",value:BFN.CONST.BLEND_MODES.SCREEN},{name:"add",value:BFN.CONST.BLEND_MODES.ADD,hasDivider:!0},{name:"lighten",value:BFN.CONST.BLEND_MODES.LIGHTEN},{name:"darken",value:BFN.CONST.BLEND_MODES.DARKEN},{name:"color_dodge",value:BFN.CONST.BLEND_MODES.COLOR_DODGE},{name:"color_burn",value:BFN.CONST.BLEND_MODES.COLOR_BURN},{name:"linear_burn",value:BFN.CONST.BLEND_MODES.LINEAR_BURN,hasDivider:!0},{name:"hard_light",value:BFN.CONST.BLEND_MODES.HARD_LIGHT},{name:"vivid_light",value:BFN.CONST.BLEND_MODES.VIVID_LIGHT},{name:"linear_light",value:BFN.CONST.BLEND_MODES.LINEAR_LIGHT},{name:"pin_light",value:BFN.CONST.BLEND_MODES.PIN_LIGHT,hasDivider:!0},{name:"difference",value:BFN.CONST.BLEND_MODES.DIFFERENCE},{name:"exclusion",value:BFN.CONST.BLEND_MODES.EXCLUSION},{name:"subtract",value:BFN.CONST.BLEND_MODES.SUBTRACT}],languages:[{name:"English",value:"en"},{name:"Español",value:"es"},{name:"Français",value:"fr"},{name:"Deutsch",value:"de"},{name:"Norsk",value:"no"},{name:"Português",value:"pt"},{name:"Italiano",value:"it"},{name:"Türkçe",value:"tr"},{name:"Pусский",value:"ru"},{name:"中文（简体）",value:"zh"},{name:"日本語",value:"ja"},{name:"한국어",value:"ko"},{name:"العربية/عربي",value:"ar"}],cropAspectRatios:[{name:"freeform",value:"freeform"},{name:"original_ratio",value:"original_ratio"},{name:"golden_ratio",value:"golden_ratio"},{name:"square_1x1",value:"square_1x1"},{name:"photo_4x6",value:"photo_4x6"},{name:"photo_5x7",value:"photo_5x7"},{name:"photo_8x10",value:"photo_8x10"},{name:"photo_11x14",value:"photo_11x14"},{name:"photo_16x9",value:"photo_16x9"},{name:"image_3x2",value:"image_3x2"},{name:"image_4x3",value:"image_4x3"},{name:"cinema_1_375x1",value:"cinema_1_375x1"},{name:"cinema_1_85x1",value:"cinema_1_85x1"},{name:"cinema_2_20x1",value:"cinema_2_20x1"},{name:"facebook_cover",value:"facebook_cover"},{name:"photo_twitter",value:"photo_twitter"},{name:"photo_youtube_cover",value:"photo_youtube_cover"},{name:"photo_pinterest_pin",value:"photo_pinterest_pin"}],batchResizeOptions:[{name:"scale",value:"scale"},{name:"longest_side",value:"longest_side"},{name:"width",value:"width"},{name:"height",value:"height"},{name:"exact_size",value:"exact_size"}],resizeTemplateSizes:[{name:di(ci()),value:"freeform"},{name:di(hi(),mi("social_media")),isHeader:!0},{name:di(li()),value:"1024 x 768"},{name:di(si()),value:"1920 x 1080"},{name:di(oi()),value:"1080 x 1920"},{name:di(ni()),value:"1080 x 1080"},{name:di(ai()),value:"1200 x 1200"},{name:di(ri()),value:"1702 x 630"},{name:di(ii()),value:"1640 x 624"},{name:di(ti()),value:"1920 x 1080(2)"},{name:di(ei()),value:"2560 x 1440"},{name:di($t()),value:"1280 x 720"},{name:di(Jt()),value:"1200 x 675"},{name:di(Zt()),value:"1500 x 500"},{name:di(Qt()),value:"1000 x 1500"},{name:di(Kt()),value:"3360 x 840"},{name:di(qt()),value:"3360 x 448"},{name:di(Yt()),value:"760 x 100"},{name:di(Wt(),mi("print")),isHeader:!0},{name:di(jt()),value:"3300 x 3300"},{name:di(Xt()),value:"1050 x 600"},{name:di(zt()),value:"1500 x 900"},{name:di(Ht()),value:"1800 x 1200"},{name:di(Gt()),value:"2100 x 1500"},{name:di(Ut()),value:"1650 x 2550"},{name:di(Vt()),value:"1200 x 2700"},{name:di(At()),value:"2550 x 3300"},{name:di(Rt()),value:"2481 x 3507"},{name:di(Ot()),value:"2640 x 4080"},{name:di(Lt(),mi("online_advertising")),isHeader:!0},{name:di(kt()),value:"1200 x 628"},{name:di(wt()),value:"120 x 600"},{name:di(Dt()),value:"160 x 600"},{name:di(Mt()),value:"728 x 90"},{name:di(Nt()),value:"728 x 210"},{name:di(Pt()),value:"300 x 250"},{name:di(Et()),value:"336 x 280"},{name:di(Ft()),value:"300 x 600"},{name:di(Bt()),value:"320 x 100"}],autosaveOptions:[{name:"autosave_yes",value:"yes"},{name:"autosave_no",value:"no"},{name:"ask_me",value:"ask"}],addTextModes:[{name:"after_name",value:"after"},{name:"before_name",value:"before"}],watermarkPlacements:[{name:"top_left",value:"tl"},{name:"top_center",value:"tc"},{name:"top_right",value:"tr"},{name:"middle_left",value:"ml"},{name:"middle_center",value:"mc"},{name:"middle_right",value:"mr"},{name:"bottom_left",value:"bl"},{name:"bottom_center",value:"bc"},{name:"bottom_right",value:"br"}],noise_distributions:[{name:"uniform",value:1},{name:"triangular",value:2},{name:"gaussian",value:3},{name:"gaussian_plus",value:4}]},BFN.CropRatioMap={freeform:-1,original_ratio:-1,golden_ratio:1/1.61803398875,square_1x1:1,photo_4x6:4/6,photo_5x7:5/7,photo_8x10:.8,photo_11x14:11/14,photo_16x9:9/16,image_3x2:2/3,image_4x3:.75,cinema_1_375x1:1/1.375,cinema_1_85x1:1/1.85,cinema_2_20x1:1/2.2,facebook_cover:315/851,photo_twitter:500/1500,photo_youtube_cover:.5625,photo_pinterest_pin:735/1102},BFN.UIToolData={app_goto:{controls:{app_goto_photo_editor:{type:"button"},app_goto_collage_maker:{type:"button"},app_goto_designer:{type:"button"},app_goto_edit_source_section:{type:"button"}}},editor_load_image:{controls:{editor_load_image_befunky:{type:"button",allowEvent:!0},editor_load_image_google_drive:{type:"button",allowEvent:!0},editor_load_image_google_photos:{type:"button",allowEvent:!0},editor_load_image_stock_images:{type:"button",allowEvent:!0},editor_load_image_facebook:{type:"button",allowEvent:!0},editor_load_image_dropbox:{type:"button",allowEvent:!0},editor_load_image_webcam:{type:"button",allowEvent:!0}}},editor_save_image:{controls:{editor_save_image_computer:{type:"button",allowEvent:!0},editor_save_image_befunky:{type:"button",allowEvent:!0},editor_save_image_facebook:{type:"button",allowEvent:!0},editor_save_image_google_drive:{type:"button",allowEvent:!0},editor_save_image_google_photos:{type:"button",allowEvent:!0},editor_save_image_dropbox:{type:"button",allowEvent:!0},editor_save_image_project:{type:"button",allowEvent:!0}}},editor_share_image:{controls:{editor_share_image_facebook:{type:"button",allowEvent:!0},editor_share_image_pinterest:{type:"button",allowEvent:!0},editor_share_image_tumblr:{type:"button",allowEvent:!0},editor_share_image_twitter:{type:"button",allowEvent:!0}}},open_project:{controls:{open_project_computer:{type:"button",allowEvent:!0},open_project_befunky:{type:"button"},open_project_befunky_editor:{type:"button"}}},editor_history_action:{controls:{editor_history_action_undo:{type:"button"},editor_history_action_redo:{type:"button"},editor_history_action_reset:{type:"button"}}},user_account:{ignoreInitialControlRegister:!0,controls:{user_account_upgrade:{type:"button"},user_account_sign_in:{type:"button"},user_account_sign_up:{type:"button"},user_account_logout:{type:"button"},user_account_settings:{type:"button"},user_account_feedback:{type:"button"}}},user_settings:{controls:{user_settings_autosave:{type:"dropdown_item",name:"autosave",data:BFN.DropDownData.autosaveOptions,defaultValue:"ask",useLabel:!1}}},editor_flatten:{controls:{editor_flatten_flatten_layers:{type:"button"}}},batch_processing:{controls:{batch_processing_open_modal:{type:"button"},batch_processing_section:{type:"static",defaultValue:null},batch_processing_manage_tools:{type:"button"},batch_processing_cancel:{type:"button"},batch_processing_apply:{type:"button"},batch_processing_load_images:{type:"button"},batch_processing_clear_images:{type:"button"},batch_processing_save_images:{type:"button"},batch_processing_upgrade:{type:"button"},batch_processing_help:{type:"button"},batch_processing_background_color:{type:"color_item",name:"background_color",defaultValue:-1,fineChangeEnabled:!0},batch_processing_image_type:{type:"radio",defaultValue:"jpg"},batch_processing_image_quality:{type:"slider_item",name:"quality",unit:"",multiplier:1,min:0,max:100,step:1,defaultValue:98},batch_processing_add_text:{type:"textinput",defaultValue:""},batch_processing_add_text_mode:{type:"dropdown_item",name:"add_text_mode",data:BFN.DropDownData.addTextModes,defaultValue:"after",useLabel:!1}}},batch_resize:{controls:{batch_resize_mode:{type:"dropdown_item",name:"resize_by",data:BFN.DropDownData.batchResizeOptions},batch_resize_scale:{type:"scrubber",min:0,defaultValue:100,unit:"%"},batch_resize_longest_side:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:800,unit:"px"},batch_resize_width:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:800,unit:"px"},batch_resize_height:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:600,unit:"px"},batch_resize_exact_width:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:800,unit:"px"},batch_resize_exact_height:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:600,unit:"px"},batch_resize_use_padding:{type:"checkbox_item",name:"use_padding",defaultValue:!0}}},batch_crop:{controls:{batch_crop_aspect_ratio:{type:"dropdown_item",name:"aspect_ratio",data:BFN.DropDownData.cropAspectRatios},batch_crop_orientation:{type:"radio",defaultValue:"landscape"},batch_crop_focal_point_auto:{type:"button"},batch_crop_focal_point_align:{type:"button"},batch_crop_focal_point_tl:{type:"button"},batch_crop_focal_point_tc:{type:"button"},batch_crop_focal_point_tr:{type:"button"},batch_crop_focal_point_ml:{type:"button"},batch_crop_focal_point_mc:{type:"button"},batch_crop_focal_point_mr:{type:"button"},batch_crop_focal_point_bl:{type:"button"},batch_crop_focal_point_bc:{type:"button"},batch_crop_focal_point_br:{type:"button"},batch_crop_reset:{type:"button"}}},watermark:{controls:{watermark_upload:{type:"button"},watermark_placement_popover_button:{type:"button"},watermark_placement:{type:"radio",defaultValue:"br"},watermark_size:{type:"slider_item",name:"size",unit:"%",multiplier:1,min:5,max:100,step:1,defaultValue:25},watermark_padding:{type:"slider_item",name:"padding",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:5},watermark_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:1,max:100,step:1,defaultValue:75},watermark_save:{type:"button"}}},editor_main:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_main_image_manager:{type:"button"},editor_main_edit:{type:"button"},editor_main_touch_up:{type:"button"},editor_main_effect:{type:"button"},editor_main_artsy:{type:"button"},editor_main_frame:{type:"button"},editor_main_graphic:{type:"button"},editor_main_overlay:{type:"button"},editor_main_text:{type:"button"},editor_main_texture:{type:"button"}}},collage_main:{controls:{collage_main_image_manager:{type:"button"},collage_main_customize:{type:"button"},collage_main_layouts:{type:"button"},collage_main_patterns:{type:"button"},collage_main_graphic:{type:"button"},collage_main_text:{type:"button"}}},designer_main:{controls:{designer_main_image_manager:{type:"button"},designer_main_customize:{type:"button"},designer_main_project_manager:{type:"button"},designer_main_templates:{type:"button"},designer_main_graphic:{type:"button"},designer_main_text:{type:"button"}}},editor_edit:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_edit_ai_image:{type:"button"},editor_edit_ai_portrait:{type:"button"},editor_edit_hdr_dlx:{type:"button"},editor_edit_sharpen_dlx:{type:"button"},editor_edit_vibrant_colors_dlx:{type:"button"},editor_edit_denoise_dlx:{type:"button"},editor_edit_crop:{type:"button"},editor_edit_rotate:{type:"button"},editor_edit_resize:{type:"button"},editor_edit_background:{type:"button"},editor_edit_cutout:{type:"button"},editor_edit_funky_focus:{type:"button"},editor_edit_funky_vignette:{type:"button"},editor_edit_blur:{type:"button"},editor_edit_lens_blur:{type:"button"},editor_edit_triangle_blur:{type:"button"},editor_edit_exposure:{type:"button"},editor_edit_levels:{type:"button"},editor_edit_invert:{type:"button"},editor_edit_vibrance:{type:"button"},editor_edit_desaturate:{type:"button"},editor_edit_color:{type:"button"},editor_edit_replace_color:{type:"button"},editor_edit_fill_light:{type:"button"},editor_edit_sharpen:{type:"button"},editor_edit_clarity:{type:"button"},editor_edit_vignette:{type:"button"},editor_edit_tint:{type:"button"},editor_edit_tilt:{type:"button"},editor_edit_beautify:{type:"button"},editor_edit_color_mixer:{type:"button"},editor_edit_soften:{type:"button"},editor_edit_smoothing:{type:"button"},editor_edit_blur_edges:{type:"button"},editor_edit_auto_enhance:{type:"button"},editor_edit_glow:{type:"button"}}},editor_touch_up:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_touch_up_perfectskin:{type:"button"},editor_touch_up_wrinkles:{type:"button"},editor_touch_up_blemish_fix:{type:"button"},editor_touch_up_bronzer:{type:"button"},editor_touch_up_blush:{type:"button"},editor_touch_up_flashspot:{type:"button"},editor_touch_up_clone:{type:"button"},editor_touch_up_mascara:{type:"button"},editor_touch_up_eye_color:{type:"button"},editor_touch_up_eye_brighten:{type:"button"},editor_touch_up_eyebrow_pencil:{type:"button"},editor_touch_up_fix_redeye:{type:"button"},editor_touch_up_lipstick:{type:"button"},editor_touch_up_teeth_whiten:{type:"button"},editor_touch_up_hair_color:{type:"button"},editor_touch_up_reshape:{type:"button"},editor_touch_up_paint_brush:{type:"button"},editor_touch_up_slimming:{type:"button"}}},editor_effect:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_effect_effect_featured:{type:"button"},editor_effect_effect_favorites:{type:"button"},editor_effect_lens_flares:{type:"button"},editor_effect_bwfx:{type:"button"},editor_effect_warmfx:{type:"button"},editor_effect_analog:{type:"button"},editor_effect_cinematic:{type:"button"},editor_effect_multimedia:{type:"button"},editor_effect_glitch_art:{type:"button"},editor_effect_bw:{type:"button"},editor_effect_chromatic:{type:"button"},editor_effect_charcoal:{type:"button"},editor_effect_cyanotype:{type:"button"},editor_effect_orton_style:{type:"button"},editor_effect_sepia:{type:"button"},editor_effect_viewfinder:{type:"button"},editor_effect_summer:{type:"button"},editor_effect_unitedcolors:{type:"button"},editor_effect_instant:{type:"button"},editor_effect_cooler:{type:"button"},editor_effect_warmer:{type:"button"},editor_effect_tinytype:{type:"button"},editor_effect_crossprocess:{type:"button"},editor_effect_vintagecolors:{type:"button"},editor_effect_holgaart:{type:"button"},editor_effect_lineartopia:{type:"button"},editor_effect_hdr:{type:"button"},editor_effect_pinhole:{type:"button"},editor_effect_colorpinhole:{type:"button"},editor_effect_stenciler:{type:"button"},editor_effect_grungefx:{type:"button"},editor_effect_sunburst:{type:"button"},editor_effect_oldphotofx:{type:"button"},editor_effect_winterfx:{type:"button"},editor_effect_tiltshiftfx:{type:"button"},editor_effect_patrioticfx:{type:"button"},editor_effect_popartfx:{type:"button"},editor_effect_motioncolor:{type:"button"},editor_effect_lomoart:{type:"button"},editor_effect_touchup:{type:"button"}}},editor_artsy:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_artsy_artsy_favorites:{type:"button"},editor_artsy_digitalart:{type:"button"},editor_artsy_ai_artsy_style:{type:"button"},editor_artsy_cartoonizer:{type:"button"},editor_artsy_gouache:{type:"button"},editor_artsy_impressionist:{type:"button"},editor_artsy_inkify:{type:"button"},editor_artsy_oilpainting:{type:"button"},editor_artsy_pointillism:{type:"button"},editor_artsy_sketcher:{type:"button"},editor_artsy_underpainting:{type:"button"},editor_artsy_watercolor:{type:"button"}}},editor_frame:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_frame_frame_featured:{type:"button"},editor_frame_frame_border:{type:"button"},editor_frame_frame_drop_shadow:{type:"button"},editor_frame_frame_decorative:{type:"button"},editor_frame_frame_vintage:{type:"button"},editor_frame_frame_art_deco:{type:"button"},editor_frame_frame_floral:{type:"button"},editor_frame_frame_rustic:{type:"button"},editor_frame_frame_lace:{type:"button"},editor_frame_frame_ornament:{type:"button"},editor_frame_frame_hand_drawn:{type:"button"},editor_frame_frame_instant:{type:"button"},editor_frame_frame_grunge:{type:"button"},editor_frame_frame_filmstrip:{type:"button"},editor_frame_frame_realistic:{type:"button"}}},editor_texture:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_texture_texture_featured:{type:"button"},editor_texture_bokeh:{type:"button"},editor_texture_scratches:{type:"button"},editor_texture_light:{type:"button"},editor_texture_lightleak:{type:"button"},editor_texture_fabric:{type:"button"},editor_texture_grunge:{type:"button"},editor_texture_paint:{type:"button"},editor_texture_metal:{type:"button"},editor_texture_bricks:{type:"button"},editor_texture_paper:{type:"button"}}},editor_overlay:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_overlay_featured:{type:"button"},editor_overlay_floral:{type:"button"},editor_overlay_holiday_earth_day:{type:"button"},editor_overlay_geometry:{type:"button"},editor_overlay_brushes:{type:"button"},editor_overlay_circular:{type:"button"},editor_overlay_a_z:{type:"button"},editor_overlay_animals:{type:"button"},editor_overlay_hearts:{type:"button"},editor_overlay_halloween:{type:"button"},editor_overlay_st_patricks_day:{type:"button"},editor_overlay_valentines_day:{type:"button"},editor_overlay_numbers:{type:"button"},editor_overlay_patterns:{type:"button"},editor_overlay_sports:{type:"button"},editor_overlay_symbols:{type:"button"},editor_overlay_winter_holidays:{type:"button"}}},editor_text:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_text_add_text:{type:"button",preventDeselectOnDoubleClick:!0}}},editor_graphic:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_graphic_add_layer:{type:"button"}}},collage_customize:{controls:{collage_customize_background_color:{name:"color_palette",type:"color_palette",defaultValue:"FFFFFF",colors:[["FFFFFF","9B9B9B","4A4A4A","000000"],["A70C2C","DA9A15","F8E71D","47821A","4990E2"]],presetsOnly:!1,emptyEnabled:!0,fineChangeEnabled:!0},collage_customize_spacing:{type:"slider_item",name:"spacing",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:5},collage_customize_corner_rounding:{type:"slider_item",name:"corner_rounding",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0},collage_customize_width:{type:"scrubber",min:BFN.minCollageSize,max:1024,defaultValue:BFN.maxImageSize,unit:"px",arrowsAffectInputValue:!1},collage_customize_height:{type:"scrubber",min:BFN.minCollageSize,max:1024,defaultValue:BFN.maxImageSize,unit:"px",arrowsAffectInputValue:!1},collage_customize_lock_aspect_ratio:{type:"checkbox_item",name:"lock_aspect_ratio",defaultValue:!1}}},collage_layouts_custom:{controls:{collage_layouts_custom_collage_wizard:{type:"button"},collage_layouts_custom_create_your_own:{type:"button"}}},collage_layouts:{controls:{collage_layouts_collage_wizard:{type:"button"},collage_layouts_create_your_own:{type:"button"},collage_layouts_featured:{type:"button"},collage_layouts_grid:{type:"button"},collage_layouts_big_photo_wrap:{type:"button"},collage_layouts_facebook:{type:"button"},collage_layouts_pinterest:{type:"button"}}},collage_patterns:{controls:{collage_patterns_featured:{type:"button"},collage_patterns_autumn:{type:"button"},collage_patterns_fabric:{type:"button"},collage_patterns_fancy:{type:"button"},collage_patterns_geometric:{type:"button"},collage_patterns_polka_dots:{type:"button"},collage_patterns_stripes:{type:"button"},collage_patterns_summer:{type:"button"},collage_patterns_love:{type:"button"},collage_patterns_winter:{type:"button"}}},crop:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CROP,applyCancelMenuID:"editor_apply_cancel_menu",controls:{crop_aspect_ratio:{type:"dropdown_item",name:"aspect_ratio",data:BFN.DropDownData.cropAspectRatios},crop_orientation:{type:"radio",defaultValue:"landscape"},crop_crop_width:{type:"scrubber",min:0,max:0,defaultValue:0,unit:"px"},crop_crop_height:{type:"scrubber",min:0,max:0,defaultValue:0,unit:"px"},crop_lock_aspect_ratio:{type:"checkbox"}}},rotate:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE,applyCancelMenuID:"editor_apply_cancel_menu",controls:{rotate_rotate_counter_clockwise:{type:"button"},rotate_rotate_clockwise:{type:"button"},rotate_flip_horizontal:{type:"button"},rotate_flip_vertical:{type:"button"},rotate_straighten:{type:"slider_item",name:"straighten",unit:"°",multiplier:1,min:-90,max:90,step:1,defaultValue:0,enableStartEvent:!0}}},resize:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE,applyCancelMenuID:"editor_apply_cancel_menu",controls:{resize_resize_width:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:0,unit:"px"},resize_resize_height:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:0,unit:"px"},resize_resize_xscale:{type:"scrubber",unit:"%"},resize_resize_yscale:{type:"scrubber",unit:"%"},resize_lock_aspect_ratio:{type:"checkbox"}}},slimming:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING,applyCancelMenuID:"editor_apply_cancel_menu",controls:{slimming_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:30}}},reshape:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESHAPE,applyCancelMenuID:"editor_apply_cancel_menu",controls:{reshape_mode:{type:"radio",defaultValue:"smudge"},reshape_reset:{type:"button"},reshape_pressure:{type:"slider_item",name:"pressure",unit:"%",multiplier:1,min:10,max:100,step:1,defaultValue:50},reshape_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},reshape_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},funky_focus:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS,applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{funky_focus_mode:{type:"radio",defaultValue:"radial"},funky_focus_grayscale:{type:"checkbox"},funky_focus_mosaic:{type:"checkbox"},funky_focus_inverse:{type:"checkbox"},funky_focus_blur_amount:{type:"slider_item",name:"blur_amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:15},funky_focus_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},funky_vignette:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_VIGNETTE,applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{funky_vignette_mode:{type:"radio",defaultValue:"radial"},funky_vignette_clear:{type:"button"},funky_vignette_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes,defaultValue:BFN.CONST.BLEND_MODES.NORMAL},funky_vignette_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.75},funky_vignette_color:{type:"color_item",name:"color",defaultValue:"000000",emptyEnabled:!1,fineChangeEnabled:!0}}},cutout:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT,applyCancelMenuID:"editor_apply_cancel_menu",controls:{cutout_show_mask:{type:"checkbox"},cutout_invert:{type:"button"},cutout_clear:{type:"button"},cutout_remove_background:{type:"button"},cutout_mode:{type:"radio",defaultValue:"brush"},cutout_select_action:{type:"button_bar",name:"select_action",defaultValue:"subtract",data:[{name:"remove",value:"subtract",tooltip:"remove_selection"},{name:"keep",value:"add",tooltip:"keep_selection"}],useLabel:!1},cutout_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},cutout_hardness:{type:"slider_item",name:"hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},cutout_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:10,max:100,step:1,defaultValue:50},cutout_tolerance:{type:"slider_item",name:"tolerance",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},cutout_background_color:{type:"color_item",name:"background_color",defaultValue:-1,emptyEnabled:!0,fineChangeEnabled:!0},cutout_trim_transparency:{type:"checkbox_item",name:"trim_transparency",defaultValue:!1,description:"cutout_guide_trim_transparency"},cutout_export_as_layer:{type:"checkbox_item",name:"export_as_layer",defaultValue:!1,description:"cutout_guide_export_as_layer"},cutout_options_modal_cancel:{type:"button"},cutout_options_modal_apply:{type:"button"}}},blur:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{blur_blur_amount:{type:"slider_item",name:"blur_amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.3}}},lens_blur:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{lens_blur_blur_amount:{type:"slider_item",name:"blur_amount",defaultValue:50,min:1,max:100,step:1,unit:"%",multiplier:1},lens_blur_bokeh_intensity:{type:"slider_item",name:"bokeh_intensity",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1},lens_blur_blade_curvature:{type:"slider_item",name:"blade_curvature",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},lens_blur_blade_count:{type:"button_bar",name:"blade_count",defaultValue:6,data:[{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"6",value:6},{name:"7",value:7},{name:"8",value:8},{name:"9",value:9}],useLabel:!0},lens_blur_real_time:{type:"static",name:"real_time",defaultValue:!1},lens_blur_passes:{type:"static",name:"passes",defaultValue:4,min:1,max:10,step:1,unit:"",multiplier:1},lens_blur_pass1Radius:{type:"static",name:"pass1Radius",defaultValue:1,min:1,max:200,step:.5,unit:"",multiplier:1},lens_blur_pass1Layers:{type:"static",name:"pass1Layers",defaultValue:1,min:1,max:4,step:1,unit:"",multiplier:1},lens_blur_pass2Radius:{type:"static",name:"pass2Radius",defaultValue:50,min:1,max:200,step:.5,unit:"",multiplier:1},lens_blur_pass2Layers:{type:"static",name:"pass2Layers",defaultValue:4,min:1,max:4,step:1,unit:"",multiplier:1},lens_blur_pass3Radius:{type:"static",name:"pass3Radius",defaultValue:20,min:1,max:200,step:.5,unit:"",multiplier:1},lens_blur_pass3Layers:{type:"static",name:"pass3Layers",defaultValue:3,min:1,max:4,step:1,unit:"",multiplier:1},lens_blur_pass4Radius:{type:"static",name:"pass4Radius",defaultValue:8.5,min:1,max:200,step:.5,unit:"",multiplier:1},lens_blur_pass4Layers:{type:"static",name:"pass4Layers",defaultValue:2,min:1,max:4,step:1,unit:"",multiplier:1},lens_blur_finalBlur:{type:"static",name:"finalBlur",defaultValue:!0}}},triangle_blur:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{triangle_blur_blur_amount:{type:"slider",min:0,max:3,step:.01,defaultValue:1},triangle_blur_threshold_amount:{type:"slider",min:.05,max:1,step:.01,defaultValue:.2},triangle_blur_resolution_amount:{type:"slider",min:.25,max:1,step:.25,defaultValue:1}}},exposure:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{exposure_brightness:{type:"slider_item",name:"brightness",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0},exposure_contrast:{type:"slider_item",name:"contrast",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0},exposure_highlights:{type:"slider_item",name:"highlights",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0},exposure_shadows:{type:"slider_item",name:"shadows",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0}}},levels:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{levels_min_input:{type:"slider_item",name:"Min Input",unit:"",multiplier:100,min:0,max:1,step:.01,defaultValue:0},levels_gamma:{type:"slider_item",name:"Gamma",unit:"",multiplier:100,min:0,max:3,step:.01,defaultValue:1},levels_max_input:{type:"slider_item",name:"Max Input",unit:"",multiplier:100,min:0,max:1,step:.01,defaultValue:1},levels_min_output:{type:"slider_item",name:"Min Output",unit:"",multiplier:100,min:0,max:1,step:.01,defaultValue:0},levels_max_output:{type:"slider_item",name:"Max Output",unit:"",multiplier:100,min:0,max:1,step:.01,defaultValue:1}}},invert:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{invert_invert_amount:{type:"slider",min:0,max:1,step:.001,defaultValue:1}}},vibrance:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{vibrance_vibrance_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.3}}},desaturate:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{desaturate_gray_amount:{type:"slider",min:0,max:1,step:.001,defaultValue:1}}},color:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{color_hue:{type:"slider_item",name:"hue",unit:"°",multiplier:1,min:-180,max:180,step:1,defaultValue:0,customClasses:["slider-custom","slider-custom-hue"]},color_saturation:{type:"slider_item",name:"saturation",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0,customClasses:["slider-custom","slider-custom-saturation"]},color_temperature:{type:"slider_item",name:"temperature",unit:"",multiplier:100,min:-.25,max:.25,step:.01,defaultValue:0,customClasses:["slider-custom","slider-custom-temperature"]}}},replace_color:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{replace_color_reset:{type:"button",name:"reset"},replace_color_source_color:{type:"color_item",name:"source_color",defaultValue:-1,fineChangeEnabled:!0},replace_color_target_color:{type:"color_item",name:"target_color",defaultValue:-1,fineChangeEnabled:!0,intensityEnabled:!0},replace_color_tolerance:{type:"slider_item",name:"tolerance",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50}}},fill_light:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{fill_light_light_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.3}}},sharpen:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{sharpen_mode:{name:"mode",type:"radio",defaultValue:"smart",values:["smart","normal"],icons:["edit-menu-sharpen-icon","edit-setting-sharpen-icon"],tooltips:["smart_sharpen","sharpen"],customClasses:["control-item--border-bottom"]},sharpen_unsharp_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.2}}},clarity:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{clarity_clarity_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.3}}},vignette:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{vignette_vignette_amount:{type:"slider_item",name:"vignette_amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.2},vignette_vignette_softness:{type:"slider_item",name:"softness",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.7}}},tint:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{tint_color_1:{type:"color_item",name:"color_value_1",defaultValue:"FFFFFF",emptyEnabled:!1,fineChangeEnabled:!0},tint_color_2:{type:"color_item",name:"color_value_2",defaultValue:-1,fineChangeEnabled:!0},tint_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1}}},tilt:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT,applyCancelMenuID:"editor_apply_cancel_menu",controls:{tilt_background_color:{type:"color_item",name:"background_color",defaultValue:-1},tilt_tilt_amount:{type:"slider_item",name:"tilt_amount",unit:"°",multiplier:1,min:-90,max:90,step:1,defaultValue:0}}},beautify:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{beautify_beautify_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.35}}},color_mixer:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{color_mixer_bw:{name:"black_and_white",type:"checkbox",defaultValue:!1,icon:"edit-setting-funky-focus-black-and-white-icon",tooltip:"black_and_white",customClasses:["control-item--border-bottom"]},color_mixer_red:{type:"slider_item",name:"red",unit:"%",multiplier:1,min:-100,max:100,step:1,defaultValue:0},color_mixer_green:{type:"slider_item",name:"green",unit:"%",multiplier:1,min:-100,max:100,step:1,defaultValue:0},color_mixer_blue:{type:"slider_item",name:"blue",unit:"%",multiplier:1,min:-100,max:100,step:1,defaultValue:0}}},soften:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{soften_softness:{type:"slider_item",name:"softness",unit:"%",multiplier:1,min:5,max:100,step:1,defaultValue:30},soften_lightness:{type:"slider_item",name:"lightness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:40}}},smoothing:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{smoothing_smoothing_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:40}}},blur_edges:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{blur_edges_edge_size:{type:"slider_item",name:"size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},blur_edges_blur_amount:{type:"slider_item",name:"blur_amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:10},blur_edges_shift_vertical:{type:"slider_item",name:"shift_vertical",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0},blur_edges_shift_horizontal:{type:"slider_item",name:"shift_horizontal",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0}}},auto_enhance:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{auto_enhance_intensity:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},glow:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{glow_intensity_mode:{type:"radio",uiType:"radio_text_bar",defaultValue:"normal",values:["normal","intense"]},glow_intensity:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},glow_glow_size:{type:"slider_item",name:"glow_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},glow_glint_size:{type:"slider_item",name:"glint_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},glow_tolerance:{type:"slider_item",name:"tolerance",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},glow_tint_color:{type:"color_item",name:"tint",defaultValue:-1,fineChangeEnabled:!0}}},background:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_BACKGROUND,brushMenuID:"background_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{background_transparent:{type:"checkbox_item",name:"transparent",defaultValue:!0},background_fill_color:{type:"color_item",name:"fill_color",defaultValue:"FFFFFF",emptyEnabled:!1,fineChangeEnabled:!0},background_fill_amount:{type:"slider_item",name:"fill_amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},background_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},ai_image:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,name:"A.I. Image Enhancer",type:"edit",controls:{ai_image_id:{type:"static",defaultValue:"a_i_enhancer"}}},ai_portrait:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,name:"A.I. Portrait Enhancer",type:"touch_up",controls:{ai_portrait_id:{type:"static",defaultValue:"a_i_portrait"}}},hdr_dlx:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",name:"HDR DLX",type:"edit",controls:{hdr_dlx_id:{type:"static",defaultValue:"ART_0023"},hdr_dlx_local_exposure:{type:"slider_item",name:"local_exposure",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},hdr_dlx_local_regions:{type:"slider_item",name:"local_regions",defaultValue:12,min:1,max:25,step:1,unit:"",multiplier:1}}},sharpen_dlx:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",name:"Sharpen DLX",type:"edit",controls:{sharpen_dlx_id:{type:"static",defaultValue:"ART_0021"},sharpen_dlx_strength:{type:"slider_item",name:"strength",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},sharpen_dlx_detail_level:{type:"slider_item",name:"detail_level",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}}},vibrant_colors_dlx:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",name:"Vibrant Colors DLX",type:"edit",controls:{vibrant_colors_dlx_id:{type:"static",defaultValue:"ART_0022"},vibrant_colors_dlx_color_amount:{type:"slider_item",name:"color_amount",defaultValue:60,min:-100,max:100,step:1,unit:"",multiplier:1}}},denoise_dlx:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",name:"Denoise DLX",type:"edit",controls:{denoise_dlx_id:{type:"static",defaultValue:"ART_0020"},denoise_dlx_smoothness:{type:"slider_item",name:"smoothness",defaultValue:50,min:10,max:100,step:1,unit:"",multiplier:1},denoise_dlx_fine_details:{type:"slider_item",name:"fine_details",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1}}},perfectskin:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{perfectskin_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},perfectskin_isBlur:{type:"static",defaultValue:!0},perfectskin_isBlur2:{type:"static",defaultValue:!0},perfectskin_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.perfectskin},perfectskin_brush_size:{type:"static",defaultValue:.3},perfectskin_brush_hardness:{type:"static",defaultValue:.9}}},wrinkles:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{wrinkles_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.4},wrinkles_isBlur:{type:"static",defaultValue:!0},wrinkles_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.wrinkles},wrinkles_brush_size:{type:"static",defaultValue:.25},wrinkles_brush_hardness:{type:"static",defaultValue:.7}}},bronzer:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{bronzer_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"724301",colors:[["724301","9A7035","D2AF7E","FCDDB1"]],presetsOnly:!1,emptyEnabled:!1,hueLocked:!0,fineChangeEnabled:!0},bronzer_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.5},bronzer_isBlur:{type:"static",defaultValue:!1},bronzer_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.bronzer},bronzer_brush_size:{type:"static",defaultValue:.25},bronzer_brush_hardness:{type:"static",defaultValue:.5}}},blush:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{blush_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"FFCDD9",colors:[["FFCDD9","ECB4Bf","DA798A","A16B72","703D42"],["D9BA9A","CEA989","A9856B","B28061","825436"]],presetsOnly:!0,emptyEnabled:!1},blush_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.5},blush_isBlur:{type:"static",defaultValue:!1},blush_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.blush},blush_brush_size:{type:"static",defaultValue:.25},blush_brush_hardness:{type:"static",defaultValue:.5}}},flashspot:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{flashspot_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},flashspot_isBlur:{type:"static",defaultValue:!1},flashspot_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.flashspot},flashspot_brush_size:{type:"static",defaultValue:.25},flashspot_brush_hardness:{type:"static",defaultValue:.5}}},mascara:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{mascara_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},mascara_isBlur:{type:"static",defaultValue:!0},mascara_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.mascara},mascara_brush_size:{type:"static",defaultValue:.25},mascara_brush_hardness:{type:"static",defaultValue:.8}}},eye_color:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{eye_color_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"64C4FF",colors:[["64C4FF","81BC36","7A5C3A","BBBEBA"]],emptyEnabled:!1,fineChangeEnabled:!0},eye_color_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.7},eye_color_isBlur:{type:"static",defaultValue:!1},eye_color_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eye_color},eye_color_brush_size:{type:"static",defaultValue:.25},eye_color_brush_hardness:{type:"static",defaultValue:.8}}},eye_brighten:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{eye_brighten_isBlur:{type:"static",defaultValue:!0},eye_brighten_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eye_brighten},eye_brighten_brush_size:{type:"static",defaultValue:.25},eye_brighten_brush_hardness:{type:"static",defaultValue:.3}}},eyebrow_pencil:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{eyebrow_pencil_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"3D3A33",colors:[["3D3A33","74717A","835836","A58646"]],emptyEnabled:!1,fineChangeEnabled:!0},eyebrow_pencil_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},eyebrow_pencil_isBlur:{type:"static",defaultValue:!0},eyebrow_pencil_curves:{type:"static",defaultValue:"blackenCurve"},eyebrow_pencil_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eyebrow_pencil},eyebrow_pencil_brush_size:{type:"static",defaultValue:.25},eyebrow_pencil_brush_hardness:{type:"static",defaultValue:.3}}},fix_redeye:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{fix_redeye_isBlur:{type:"static",defaultValue:!1},fix_redeye_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.fix_redeye},fix_redeye_brush_size:{type:"static",defaultValue:.25},fix_redeye_brush_hardness:{type:"static",defaultValue:.7}}},lipstick:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{lipstick_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"EF4292",colors:[["EF4292","D7058C","DA085F","E12438"]],emptyEnabled:!1,fineChangeEnabled:!0},lipstick_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.7},lipstick_isBlur:{type:"static",defaultValue:!1},lipstick_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.lipstick},lipstick_brush_size:{type:"static",defaultValue:.25},lipstick_brush_hardness:{type:"static",defaultValue:.6}}},teeth_whiten:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{teeth_whiten_isBlur:{type:"static",defaultValue:!0},teeth_whiten_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.teeth_whiten},teeth_whiten_brush_size:{type:"static",defaultValue:.25},teeth_whiten_brush_hardness:{type:"static",defaultValue:.3}}},hair_color:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{hair_color_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"E8D18A",colors:[["E8D18A","935118","C58B4E","0C0C17"]],emptyEnabled:!1},hair_color_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.7},hair_color_isBlur:{type:"static",defaultValue:!1},hair_color_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.haircolor},hair_color_brush_size:{type:"static",defaultValue:.25},hair_color_brush_hardness:{type:"static",defaultValue:.6}}},paint_brush:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_PAINT_BRUSH,applyCancelMenuID:"editor_apply_cancel_menu",controls:{paint_brush_clear:{type:"button"},paint_brush_erase:{type:"checkbox",defaultValue:!1},paint_brush_color:{type:"color_item",name:"color",defaultValue:"FFFFFF",emptyEnabled:!1},paint_brush_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes,defaultValue:BFN.CONST.BLEND_MODES.NORMAL},paint_brush_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.5},paint_brush_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},paint_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},paint_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},clone:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CLONE,applyCancelMenuID:"editor_apply_cancel_menu",controls:{clone_target_reset:{type:"button"},clone_brush_clear:{type:"button"},clone_brush_erase:{type:"checkbox",defaultValue:!1},clone_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},clone_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},clone_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},blemish_fix:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_BLEMISH_FIX,applyCancelMenuID:"editor_apply_cancel_menu",controls:{blemish_fix_brush_erase:{type:"checkbox",defaultValue:!1},blemish_fix_brush_clear:{type:"button"},blemish_fix_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},blemish_fix_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:40}}},frame_border:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER,applyCancelMenuID:"editor_apply_cancel_menu",controls:{frame_border_outer_color:{type:"color",defaultValue:"000000",fineChangeEnabled:!0},frame_border_inner_color:{type:"color",defaultValue:"FFFFFF",fineChangeEnabled:!0},frame_border_matte_color:{type:"color",defaultValue:-1,fineChangeEnabled:!0},frame_border_outer_thickness:{type:"slider_item",name:"outer_thickness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},frame_border_inner_thickness:{type:"slider_item",name:"inner_thickness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},frame_border_corner_radius:{type:"slider_item",name:"corner_radius",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0},frame_border_caption_space:{type:"slider_item",name:"caption_space",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0}}},frame_drop_shadow:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW,applyCancelMenuID:"editor_apply_cancel_menu",controls:{frame_drop_shadow_type:{type:"button_bar",name:"type",defaultValue:"outer",data:[{name:"outer",value:"outer"},{name:"inner",value:"inner"}],useLabel:!1},frame_drop_shadow_background_color:{type:"color",defaultValue:-1,fineChangeEnabled:!0},frame_drop_shadow_shadow_color:{type:"color",defaultValue:"000000",emptyEnabled:!1,fineChangeEnabled:!0},frame_drop_shadow_distance:{type:"slider_item",name:"distance",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0},frame_drop_shadow_angle:{type:"slider_item",name:"angle",unit:"°",multiplier:1,min:-180,max:180,step:1,defaultValue:45},frame_drop_shadow_size:{type:"slider_item",name:"size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},frame_drop_shadow_density:{type:"slider_item",name:"density",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:5},frame_drop_shadow_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:75}}},background_brush:{controls:{background_brush_show_mask:{type:"checkbox"},background_brush_invert:{type:"button"},background_brush_clear:{type:"button"},background_brush_isolate_subject:{type:"button"},background_brush_select_action:{type:"button_bar",name:"select_action",defaultValue:"subtract",data:[{name:"keep",value:"subtract",tooltip:"keep_selection"},{name:"remove",value:"add",tooltip:"remove_selection"}],useLabel:!1},background_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},background_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:75},background_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},touch_up_brush:{controls:{touch_up_brush_clear:{type:"button"},touch_up_brush_erase:{type:"checkbox",defaultValue:!1},touch_up_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:35},touch_up_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50}}},effect_generic:{controls:{effect_generic_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},effect_brush:{controls:{effect_brush_show_mask:{type:"checkbox"},effect_brush_invert:{type:"button"},effect_brush_clear:{type:"button"},effect_brush_isolate_subject:{type:"button"},effect_brush_select_action:{type:"button_bar",name:"select_action",defaultValue:"subtract",data:[{name:"remove",value:"subtract",tooltip:"remove_selection"},{name:"keep",value:"add",tooltip:"keep_selection"}],useLabel:!1},effect_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},effect_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},effect_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},artsy_generic:{controls:{artsy_generic_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},artsy_brush:{controls:{artsy_brush_show_mask:{type:"checkbox"},artsy_brush_invert:{type:"button"},artsy_brush_clear:{type:"button"},artsy_brush_isolate_subject:{type:"button"},artsy_brush_select_action:{type:"button_bar",name:"select_action",defaultValue:"subtract",data:[{name:"remove",value:"subtract",tooltip:"remove_selection"},{name:"keep",value:"add",tooltip:"keep_selection"}],useLabel:!1},artsy_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},artsy_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},artsy_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},frame_crop_rotate_generic:{controls:{frame_crop_rotate_generic_rotate_counter_clockwise:{type:"button"},frame_crop_rotate_generic_rotate_clockwise:{type:"button"},frame_crop_rotate_generic_flip_horizontal:{type:"button"},frame_crop_rotate_generic_flip_vertical:{type:"button"},frame_crop_rotate_generic_background_color:{type:"color_item",name:"background_color",defaultValue:-1,fineChangeEnabled:!0},frame_crop_rotate_generic_position:{type:"slider_item",name:"position",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0},frame_crop_rotate_generic_tilt:{type:"slider_item",name:"tilt",unit:"°",multiplier:1,min:-90,max:90,step:1,defaultValue:0}}},frame_crop_generic:{controls:{frame_crop_generic_rotate_counter_clockwise:{type:"button"},frame_crop_generic_rotate_clockwise:{type:"button"},frame_crop_generic_flip_horizontal:{type:"button"},frame_crop_generic_flip_vertical:{type:"button"},frame_crop_generic_position:{type:"slider_item",name:"position",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0}}},frame_full_generic:{controls:{frame_full_generic_color_overlay:{type:"color_item",name:"color_overlay",defaultValue:-1,intensityEnabled:!0,fineChangeEnabled:!0},frame_full_generic_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes},frame_full_generic_rotate_counter_clockwise:{type:"button"},frame_full_generic_rotate_clockwise:{type:"button"},frame_full_generic_flip_horizontal:{type:"button"},frame_full_generic_flip_vertical:{type:"button"},frame_full_generic_position:{type:"slider_item",name:"position",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0},frame_full_generic_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},texture_generic:{controls:{texture_generic_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},texture_generic_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes},texture_generic_rotate_counter_clockwise:{type:"button"},texture_generic_rotate_clockwise:{type:"button"},texture_generic_flip_horizontal:{type:"button"},texture_generic_flip_vertical:{type:"button"}}},texture_brush:{controls:{texture_brush_show_mask:{type:"checkbox"},texture_brush_invert:{type:"button"},texture_brush_clear:{type:"button"},texture_brush_isolate_subject:{type:"button"},texture_brush_select_action:{type:"button_bar",name:"select_action",defaultValue:"subtract",data:[{name:"remove",value:"subtract",tooltip:"remove_selection"},{name:"keep",value:"add",tooltip:"keep_selection"}],useLabel:!1},texture_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},texture_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},texture_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},overlay_generic:{controls:{overlay_generic_reset:{type:"button"},overlay_generic_color:{type:"color",defaultValue:"FFFFFF",emptyEnabled:!1,fineChangeEnabled:!0},overlay_generic_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},overlay_generic_size:{type:"slider_item",name:"size",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},overlay_generic_rotation:{type:"slider_item",name:"rotation",unit:"°",multiplier:1,min:-180,max:180,step:1,defaultValue:0},overlay_generic_blur_amount:{type:"slider_item",name:"blur_amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:0},overlay_generic_shadow_amount:{type:"slider_item",name:"shadow_amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:0}}},lens_flare_generic:{controls:{lens_flare_generic_intense_mode:{type:"radio",defaultValue:"normal"},lens_flare_generic_intensity:{type:"slider_item",name:"intensity",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0}}},editor_apply_cancel:{controls:{editor_apply_cancel_cancel:{type:"button"},editor_apply_cancel_apply:{type:"button"}}},transform:{controls:{transform_shape_fill_color:{type:"color_item",name:"fill",pickerName:"fill_color",defaultValue:"FFFFFF",intensityEnabled:!0,fineChangeEnabled:!0},transform_shape_stroke_color:{type:"color_item",name:"stroke",pickerName:"stroke_color",defaultValue:-1,intensityEnabled:!0,fineChangeEnabled:!0,colorExistsButtonID:"transform_shape_stroke_width_popover_button"},transform_shape_stroke_width:{type:"slider_item",name:"stroke_width",min:1,max:100,step:1,defaultValue:5,unit:"px",valueElementIDs:["transform_shape_stroke_width_popover_button"]},transform_shape_stroke_width_popover_button:{type:"button"},transform_shape_line_style:{type:"radio",uiType:"radio_text_bar",defaultValue:"solid",values:["solid","dashed","dotted"]},transform_shape_line_segment_width:{type:"slider_item",name:"segment_width",unit:"",multiplier:1,min:0,max:100,step:1,defaultValue:50},transform_shape_line_gap_size:{type:"slider_item",name:"gap_size",unit:"",multiplier:1,min:0,max:100,step:1,defaultValue:50},transform_shape_rectangle_corner_rounding:{type:"slider_item",name:"corner_rounding",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0},transform_shape_polygon_sides:{type:"slider_item",name:"sides",unit:"",multiplier:1,min:3,max:12,step:1,defaultValue:6},transform_shape_polygon_shift_orientation:{type:"checkbox_item",name:"shift_orientation",defaultValue:!1},transform_shape_star_points:{type:"slider_item",name:"points",unit:"",multiplier:1,min:3,max:32,step:1,defaultValue:5},transform_shape_star_inset_weight:{type:"slider_item",name:"inset_weight",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},transform_shape_star_shift_orientation:{type:"checkbox_item",name:"shift_orientation",defaultValue:!1},transform_shape_arrow_style:{type:"radio",uiType:"radio_text_bar",defaultValue:"thick",values:["thick","thin"]},transform_shape_arrow_weight:{type:"slider_item",name:"weight",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},transform_shape_arrow_double_sided:{type:"checkbox_item",name:"double_sided",defaultValue:!1},transform_graphic_color_group_color:{name:"graphic_colors",type:"color_group",defaultValue:"FFFFFF",emptyEnabled:!0,fineChangeEnabled:!0,intensityEnabled:!0,intensityWhileTransparent:!0,useLabel:!0,maxVisibleRows:3},transform_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes},transform_overlay_color:{type:"color_item",name:"color_overlay",defaultValue:-1,intensityEnabled:!0,fineChangeEnabled:!0},transform_tint_color:{type:"color_item",name:"tint",defaultValue:-1,fineChangeEnabled:!0},transform_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},transform_create_group:{type:"button"},transform_delete:{type:"button"},transform_duplicate:{type:"button"},transform_flip_horizontal:{type:"button"},transform_flip_vertical:{type:"button"},transform_move_backwards:{type:"button"},transform_move_forwards:{type:"button"},transform_align_left:{type:"button"},transform_align_center:{type:"button"},transform_align_right:{type:"button"},transform_align_top:{type:"button"},transform_align_middle:{type:"button"},transform_align_bottom:{type:"button"},transform_fit_to_canvas:{type:"button"},transform_fill_canvas:{type:"button"},transform_menu_popover_button:{type:"button"}}},layer:{controls:{layer_save_as_image:{type:"button"},layer_image_cutout:{type:"button"},layer_image_edit_layer:{type:"button"},layer_image_open_in_editor:{type:"button"},layer_mask_image_crop:{type:"button"},layer_mask_image_replace:{type:"button"},layer_mask_image_open_in_editor:{type:"button"},layer_mask_image_crop_size:{type:"scrubber",min:100,max:100,defaultValue:100,unit:"%",maxLength:5},layer_mask_image_crop_fit_to_frame:{type:"button"},layer_mask_image_crop_fit_to_image:{type:"button"},layer_isolator_edit_complete:{type:"button"},layer_isolator_display_canvas:{type:"checkbox_item",name:"display_canvas",defaultValue:!0,checkboxColor:"light"}}},text_edit:{controls:{text_edit_bold:{type:"checkbox",defaultValue:!1},text_edit_italic:{type:"checkbox",defaultValue:!1},text_edit_underline:{type:"checkbox",defaultValue:!1},text_edit_background_color:{type:"color_item",name:"background",pickerName:"background_color",defaultValue:"000000",intensityEnabled:!0,fineChangeEnabled:!0,colorExistsButtonID:"text_edit_background_padding_popover_button"},text_edit_background_padding:{type:"slider_item",name:"background_padding",min:0,max:100,step:1,defaultValue:20,unit:"%",valueElementIDs:["text_edit_background_padding_popover_button"]},text_edit_highlight_color:{type:"color_item",name:"highlight",pickerName:"highlight_color",defaultValue:"000000",intensityEnabled:!0,fineChangeEnabled:!0},text_edit_text_color:{type:"color",name:"text_color",defaultValue:"FF0000",intensityEnabled:!0,fineChangeEnabled:!0},text_edit_stroke_color:{type:"color_item",name:"outline",pickerName:"outline_color",defaultValue:"000000",intensityEnabled:!0,fineChangeEnabled:!0,colorExistsButtonID:"text_edit_outline_width_popover_button"},text_edit_stroke_width:{type:"slider_item",name:"outline_width",min:1,max:100,step:1,defaultValue:1,unit:"%",valueElementIDs:["text_edit_outline_width_popover_button"]},text_edit_size:{type:"scrubber",min:6,max:9999,defaultValue:20,unit:"px",maxLength:4},text_edit_align:{type:"radio",defaultValue:"left"},text_edit_spacing:{type:"slider_item",name:"letter_spacing",min:0,max:10,step:1,defaultValue:0,unit:""},text_edit_line_height:{type:"slider_item",name:"line_height",min:50,max:200,step:1,defaultValue:100,unit:"%"},text_edit_spacing_menu_popover_button:{type:"button"},text_edit_background_padding_popover_button:{type:"button"},text_edit_outline_width_popover_button:{type:"button"}}},collage_image:{controls:{collage_image_size:{type:"slider_item",name:"size",min:100,max:500,step:1,defaultValue:100,unit:"%"},collage_image_rotate_counter_clockwise:{type:"button"},collage_image_rotate_clockwise:{type:"button"},collage_image_flip_horizontal:{type:"button"},collage_image_flip_vertical:{type:"button"},collage_image_open_in_editor:{type:"button"}}},collage_pattern:{controls:{collage_pattern_size:{type:"slider_item",name:"size",min:100,max:500,step:1,defaultValue:100,unit:"%"},collage_pattern_color:{type:"color_item",name:"color",defaultValue:"000000",emptyEnabled:!0,fineChangeEnabled:!1}}},layers:{controls:{layers_toggle_panel:{type:"checkbox",defaultValue:!1}}},alignment:{controls:{alignment_toggle_panel:{type:"checkbox",defaultValue:!1},alignment_snapping:{type:"radio",defaultValue:"enabled"},alignment_display_distances:{type:"radio",defaultValue:"disabled"},alignment_guides:{type:"radio",defaultValue:"disabled"}}},history:{controls:{history_toggle_panel:{type:"checkbox",defaultValue:!1}}},language:{controls:{language_select:{type:"dropdown_item",name:"language",data:BFN.DropDownData.languages,defaultValue:BeFunky.LanguageManager.language.app,useLabel:!1}}},zoom:{controls:{zoom_minus:{type:"button",interval:80,intervalDelay:240},zoom_plus:{type:"button",interval:80,intervalDelay:240},zoom_amount:{type:"slider",min:10,max:200,step:1,defaultValue:100,enableStartEvent:!0},zoom_exact_fit:{type:"button"},zoom_full_screen:{type:"button"},zoom_stagger_factor:{type:"static",defaultValue:1}}},color_picker_panel:{controls:{color_picker_panel_intensity:{type:"slider_item",name:"intensity",min:0,max:100,step:1,defaultValue:100,unit:"%"}}},save_and_share:{controls:{save_and_share_cancel:{type:"button"},save_and_share_save:{type:"button"},save_and_share_share:{type:"button"},save_and_share_image_type:{type:"radio",defaultValue:"jpg"},save_and_share_image_quality:{type:"slider_item",name:"quality",unit:"",multiplier:1,min:0,max:100,step:1,defaultValue:98},save_and_share_pdf_quality:{type:"radio",defaultValue:"print"},save_and_share_download_again:{type:"button"},save_and_share_disable_save_complete_modal:{type:"checkbox",defaultValue:!1},save_and_share_project_location:{type:"radio",defaultValue:"computer"}}},acknowledge:{controls:{acknowledge_okay:{type:"button"}}},confirmation:{controls:{confirmation_cancel:{type:"button"},confirmation_confirm:{type:"button"}}}},BFN.ArtsyAdjustAndPaintToolObjects={},BFN.ArtsyAdjustAndPaintIDMap={},BFN.UIToolData){var gi=BFN.UIToolData[pi];gi.hasOwnProperty("viewstate")&&(BFN.toolViewstates[pi]=gi.viewstate,gi.viewstate===BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY&&gi.controls&&gi.controls[pi+"_id"]&&gi.controls[pi+"_id"].defaultValue&&(BFN.ArtsyAdjustAndPaintToolObjects[pi]=gi,BFN.ArtsyAdjustAndPaintIDMap[gi.controls[pi+"_id"].defaultValue]=pi)),-1!=BFN.accordionMenuPlusIDs.indexOf(pi)&&(gi.isPlus=!0)}BFN.FeaturedData={effect:["hipster_preset2","orton_style_preset1","vintage_colors_preset6","tinytype_preset3","bw_preset2","oldphoto_preset18"],artsy:["ART_0004","ART_0016","ART_0010","ART_0012","ART_0013","ART_0018"],frame:["filmstrip_2","grunge_1","instant_2","lace_1","rustic_7","art_deco_7"],texture:["bokeh_2","bokeh_4","grunge_6","metal_4","paper_6"]},BFN.EffectData=[{id:"effect_featured",name:"Featured",graphic:"tba",presets:[]},{id:"effect_favorites",name:"Favorites",graphic:"tba",presets:[]},{id:"bwfx",name:"B&W Tones",graphic:"tba",presets:[{id:"bwfx_preset1",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_1}]},{id:"bwfx_preset2",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_2}]},{id:"bwfx_preset3",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_3}]},{id:"bwfx_preset4",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_4}]},{id:"bwfx_preset5",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_5}]},{id:"bwfx_preset6",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_6}]},{id:"bwfx_preset7",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_7}]},{id:"bwfx_preset8",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_8.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_8}]},{id:"bwfx_preset9",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_9}]},{id:"bwfx_preset10",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_10}]},{id:"bwfx_preset11",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_11}]},{id:"bwfx_preset12",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_12.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_12}]},{id:"bwfx_preset13",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_13.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_13}]},{id:"bwfx_preset14",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_14.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_14}]},{id:"bwfx_preset15",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_15.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_15}]}]},{id:"warmfx",name:"Warmer Tones",graphic:"tba",presets:[{id:"warmfx_preset1",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_1}]},{id:"warmfx_preset2",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_2}]},{id:"warmfx_preset3",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_3}]},{id:"warmfx_preset4",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_4}]},{id:"warmfx_preset5",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_5}]},{id:"warmfx_preset6",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_6}]},{id:"warmfx_preset7",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_7}]},{id:"warmfx_preset8",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_8.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_8}]},{id:"warmfx_preset9",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_9}]},{id:"warmfx_preset10",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_10}]},{id:"warmfx_preset11",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_11}]}]},{id:"analog",name:"Analog Tones",graphic:"tba",presets:[{id:"analog_preset1",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_1}]},{id:"analog_preset2",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_2}]},{id:"analog_preset3",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_3}]},{id:"analog_preset4",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_4}]},{id:"analog_preset5",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_5}]},{id:"analog_preset6",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_6}]},{id:"analog_preset7",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_7}]},{id:"analog_preset8",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_8.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_8}]},{id:"analog_preset9",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_9}]},{id:"analog_preset10",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_10}]}]},{id:"cinematic",name:"Cinematic",graphic:"tba",presets:[{id:"film_grain",name:"Film Grain",isPlus:!0,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.FILM_GRAIN},{type:"slider_item",name:"intensity",defaultValue:100,min:1,max:400,step:1,unit:"%",multiplier:1},{type:"button",name:"generate"},{type:"checkbox_item",name:"monochromatic",defaultValue:!1}]},{id:"color_grading",name:"Color Grading",isPlus:!0,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.COLOR_GRADING},{type:"color_item",name:"shadows",defaultValue:"000000",emptyEnabled:!1,intensityEnabled:!0,fineChangeEnabled:!0},{type:"color_item",name:"midtones",defaultValue:"808080",emptyEnabled:!1,intensityEnabled:!0,fineChangeEnabled:!0},{type:"color_item",name:"highlights",defaultValue:"FFFFFF",emptyEnabled:!1,intensityEnabled:!0,fineChangeEnabled:!0}]},{id:"anamorphic",name:"Anamorphic",isPlus:!0,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.ANAMORPHIC},{type:"slider_item",name:"stretch",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"distortion",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"vignette_opacity",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"edge_blur",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1}]},{id:"lens_distortion",name:"Lens Distortion",isPlus:!0,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.LENS_DISTORTION},{type:"slider_item",name:"distortion",defaultValue:50,min:-100,max:100,step:1,unit:"%",multiplier:1}]},{id:"warped_blur",name:"Warped Blur",isPlus:!0,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.WARPED_BLUR},{type:"slider_item",name:"blur_amount",defaultValue:100,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"phase",defaultValue:100,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"scale",defaultValue:100,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"lightness",defaultValue:0,min:-100,max:100,step:1,unit:"%",multiplier:1}]},{id:"chromatic_aberration",name:"Chromatic Aberration",isPlus:!0,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.CHROMATIC_ABERRATION},{type:"slider_item",name:"distortion",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"focal_point_x",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"focal_point_y",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1}]}]},{id:"multimedia",name:"Multimedia",graphic:"tba",presets:[{id:"scan_lines",name:"Scan Lines",isPlus:!1,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"multimedia",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.MULTIMEDIA_PRESETS.SCAN_LINES},{type:"color_item",name:"line_color",defaultValue:"000000",fineChangeEnabled:!0,fineChangeEnabled:!0,emptyEnabled:!1,intensityEnabled:!1},{type:"slider_item",name:"opacity",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"spacing",defaultValue:2,min:1,max:Math.floor(BFN.minImageSize/2),step:1,unit:"px",multiplier:1},{type:"checkbox_item",name:"invert",defaultValue:!1}]},{id:"television",name:"Television",isPlus:!0,thumb:"tba",effectID:"multimedia",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.MULTIMEDIA_PRESETS.TELEVISION}]},{id:"halftone_duo",name:"Halftone Duo",isPlus:!0,thumb:"tba",effectID:"multimedia",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.MULTIMEDIA_PRESETS.HALFTONE_DUO},{type:"slider_item",name:"density",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"tolerance",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"color_item",name:"shadow_color",defaultValue:-1,emptyEnabled:!0,fineChangeEnabled:!0},{type:"color_item",name:"highlight_color",defaultValue:-1,emptyEnabled:!0,fineChangeEnabled:!0},{type:"checkbox_item",name:"invert",defaultValue:!1}]}]},{id:"glitch_art",name:"Glitch Art",graphic:"tba",presets:[{id:"corrupted",name:"Corrupted",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.CORRUPTED},{type:"color_palette",name:"complexity",defaultValue:"4",colors:[["1","2","3","4"],["5","6","7","8"]],presetsOnly:!0,useLabel:!0,displayValues:!0,styleOverrides:{global:{backgroundColor:"rgb(50,51,59)",borderRadius:"50%",color:"rgb(237,237,237)",fontWeight:"bold"}}},{type:"slider_item",name:"phase",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"strength",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"distorted",name:"Distorted",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.DISTORTED},{type:"button_bar",name:"grayscale",defaultValue:1,data:[{name:"color",value:0},{name:"grayscale",value:1}]},{type:"slider_item",name:"phase",defaultValue:10,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"length",defaultValue:10,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"slide_horizontal",defaultValue:10,min:0,max:100,step:1,unit:"%",multiplier:1}]},{id:"segmented",name:"Segmented",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.SEGMENTED},{type:"button_bar",name:"grayscale",defaultValue:0,data:[{name:"color",value:0},{name:"grayscale",value:1}]},{type:"color_palette",name:"colors",defaultValue:"0",colors:[["0","1","2","3","4","5"]],presetsOnly:!0,useLabel:!0,styleOverrides:{global:{width:"1.5rem",height:"1.5rem",borderRadius:"50%"},unique:[[{backgroundColor:"rgb(255,0,0)",background:"linear-gradient(135deg, rgba(255,0,0,1) 20%, rgba(0,255,0,1) 50%, rgba(0,0,255,1) 80%)"},{backgroundColor:"rgb(0,255,0)",background:"linear-gradient(135deg, rgba(255,0,0,1) 20%, rgba(0,0,255,1) 50%, rgba(0,255,0,1) 80%)"},{backgroundColor:"rgb(0,0,255)",background:"linear-gradient(135deg, rgba(0,255,0,1) 20%, rgba(255,0,0,1) 50%, rgba(0,0,255,1) 80%)"},{backgroundColor:"rgb(255,0,255)",background:"linear-gradient(135deg, rgba(0,255,0,1) 20%, rgba(255,0,255,1) 80%)"},{backgroundColor:"rgb(255,255,0)",background:"linear-gradient(135deg, rgba(255,255,0,1) 20%, rgba(0,0,255,1) 80%)"},{backgroundColor:"rgb(0,255,255)",background:"linear-gradient(135deg, rgba(0,255,255,1) 20%, rgba(255,0,0,1) 80%)"}]]}},{type:"slider_item",name:"slide_horizontal",defaultValue:10,min:-100,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"slide_vertical",defaultValue:0,min:-100,max:100,step:1,unit:"%",multiplier:1}]},{id:"fragmented",name:"Fragmented",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.FRAGMENTED},{type:"button_bar",name:"grayscale",defaultValue:0,data:[{name:"color",value:0},{name:"grayscale",value:1}]},{type:"slider_item",name:"highlights",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"offset",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1}]},{id:"digitized",name:"Digitized",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.DIGITIZED},{type:"static",name:"useHiResThumb",defaultValue:!0},{type:"color_palette",name:"color_picker",defaultValue:-1,colors:[["FF5555","55CC55","8888FF",-1]],fineChangeEnabled:!0,emptyEnabled:!0},{type:"slider_item",name:"highlights",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"weight",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"slide_horizontal",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1}]}]},{id:"bw",name:"Black & White",graphic:"tba",presets:[{id:"bw_preset2",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_2}]},{id:"bw_preset3",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_3}]},{id:"bw_preset4",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4}]},{id:"bw_preset5",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_5}]},{id:"bw_warmer",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A7874",colors:[["8A7874","85748A","926C6C","A08D5E"]],presetsOnly:!0},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_6}]},{id:"bw_cooler",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"818A74",colors:[["818A74","6E917E","6E7791","606D9B"]],presetsOnly:!0},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_7}]},{id:"bw_new_preset1",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_8}]},{id:"bw_new_preset2",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"static",name:"imageURL",defaultValue:"bw_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_9}]}]},{id:"chromatic",name:"Chromatic",graphic:"tba",presets:[{id:"hipster_preset1",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro1_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_1}]},{id:"hipster_preset2",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro2_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_2}]},{id:"hipster_preset3",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_3}]},{id:"hipster_preset4",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro3_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_4}]},{id:"hipster_preset5",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro2_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_5}]},{id:"hipster_preset6",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro4_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_6}]},{id:"hipster_preset7",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_7}]},{id:"hipster_preset8",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_8}]},{id:"hipster_preset9",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro2_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_9}]},{id:"hipster_preset10",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro5_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_10}]}]},{id:"charcoal",name:"Charcoal",graphic:"tba",presets:[{id:"charcoal_preset1",isPlus:!0,thumb:"tba",effectID:"charcoal",params:[{type:"static",name:"imageURL",defaultValue:"tex_Charcola_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHARCOAL_PRESETS.PRESET_1},{type:"color_item",name:"color_value_1",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"000000",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.6,min:0,max:1,step:.01,unit:"",multiplier:100}]},{id:"charcoal_preset3",isPlus:!0,thumb:"tba",effectID:"charcoal",params:[{type:"static",name:"imageURL",defaultValue:"tex_Charcola_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHARCOAL_PRESETS.PRESET_2},{type:"color_item",name:"color_value_1",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"93E25F",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.6,min:0,max:1,step:.01,unit:"",multiplier:100}]}]},{id:"colorpinhole",name:"Color Pinhole",graphic:"tba",presets:[{id:"colorpinhole_preset1",isPlus:!1,thumb:"tba",effectID:"colorpinhole",params:[{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_1}]},{id:"colorpinhole_preset2",isPlus:!0,thumb:"tba",effectID:"colorpinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset2_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_2}]},{id:"colorpinhole_preset3",isPlus:!0,thumb:"tba",effectID:"colorpinhole",params:[{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset3_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_3}]},{id:"colorpinhole_preset4",isPlus:!0,thumb:"tba",effectID:"colorpinhole",params:[{type:"static",name:"vignette_amount",defaultValue:.2},{type:"static",name:"fisheye_amount",defaultValue:1.05},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset4_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_4}]},{id:"colorpinhole_preset5",isPlus:!0,thumb:"tba",effectID:"colorpinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"fisheye_amount",defaultValue:1.05,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_5}]}]},{id:"cooler",name:"Cooler",graphic:"tba",presets:[{id:"cooling_filter_preset1",isPlus:!1,thumb:"tba",effectID:"cooler",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"006dff"},{type:"static",name:"amount",defaultValue:40}]},{id:"cooling_filter_preset2",isPlus:!0,thumb:"tba",effectID:"cooler",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"00b5ff"},{type:"static",name:"amount",defaultValue:50}]}]},{id:"crossprocess",name:"Cross Process",graphic:"tba",presets:[{id:"cross_process_preset1",isPlus:!1,thumb:"tba",effectID:"crossprocess",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"contrast",defaultValue:10,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"fcff00"},{type:"static",name:"curves",defaultValue:"crossProcess1"}]},{id:"cross_process_preset2",isPlus:!1,thumb:"tba",effectID:"crossprocess",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"contrast",defaultValue:10,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"47a5f5"},{type:"static",name:"curves",defaultValue:"crossProcess2"}]}]},{id:"cyanotype",name:"Cyanotype",graphic:"tba",presets:[{id:"cyanotype_preset1",isPlus:!1,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_1}]},{id:"cyanotype_preset2",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_2}]},{id:"cyanotype_preset3",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_3}]},{id:"cyanotype_preset4",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_4}]},{id:"cyanotype_preset5",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_5}]},{id:"cyanotype_preset6",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_6}]}]},{id:"grungefx",name:"Grunge",graphic:"tba",presets:[{id:"grunge_preset1",isPlus:!1,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_1},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:25,max:126,step:1,unit:"",multiplier:1}]},{id:"grunge_preset2",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_2},{type:"static",name:"useBlur",defaultValue:!0}]},{id:"grunge_preset3",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_3},{type:"slider_item",name:"shadow_amount",defaultValue:124,min:50,max:154,step:1,unit:"",multiplier:1}]},{id:"grunge_preset4",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset4_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_4}]},{id:"grunge_preset5",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_5},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset6",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_6},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset9",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_9},{type:"static",name:"useBlur",defaultValue:!0},{type:"slider_item",name:"detail_level",defaultValue:127,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset10",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_10},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset11",isPlus:!1,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_11},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset13",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset13.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_13},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset15",isPlus:!1,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset15.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_15},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset16",isPlus:!1,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset16.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_16}]},{id:"grunge_preset17",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset17.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_17},{type:"slider_item",name:"silhouette_amount",defaultValue:127,min:50,max:153,step:1,unit:"",multiplier:1}]}]},{id:"hdr",name:"HDR",graphic:"tba",presets:[{id:"imitate_hdr_preset1",isPlus:!0,thumb:"tba",effectID:"hdr",params:[]},{id:"imitate_hdr_preset2",isPlus:!0,thumb:"tba",effectID:"hdr",params:[{type:"static",name:"useFragment",defaultValue:!0}]}]},{id:"holgaart",name:"Holga Art",graphic:"tba",presets:[{id:"holgaart_preset1",isPlus:!1,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_right",defaultValue:.03,min:.01,max:.1,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_left",defaultValue:-.025,min:-.1,max:-.01,step:.001,unit:"",multiplier:1e3},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_1}]},{id:"holgaart_preset2",isPlus:!0,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_vertical",defaultValue:.5,min:-.9,max:.9,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_horizontal",defaultValue:.5,min:-.9,max:.9,step:.001,unit:"",multiplier:1e3},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_2}]},{id:"holgaart_preset3",isPlus:!0,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_vertical",defaultValue:.1,min:-.9,max:.9,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_horizontal",defaultValue:.5,min:-.9,max:.9,step:.001,unit:"",multiplier:1e3},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_3}]},{id:"holgaart_preset4",isPlus:!0,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_right",defaultValue:.25,min:0,max:.9,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_left",defaultValue:-.25,min:-.9,max:0,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"vignette_amount",defaultValue:.45,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_4},{type:"static",name:"imageURL",defaultValue:"tex_holga_preset4.jpg"}]},{id:"holgaart_preset5",isPlus:!0,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_right",defaultValue:.5,min:0,max:.9,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_left",defaultValue:-.25,min:-.9,max:0,step:.001,unit:"",multiplier:1e3},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_5},{type:"static",name:"imageURL",defaultValue:"tex_holgaart_preset5.jpg"}]}]},{id:"instant",name:"Instant",graphic:"tba",presets:[{id:"instant_preset1",isPlus:!1,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_1}]},{id:"instant_preset2",isPlus:!1,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_2}]},{id:"instant_preset3",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_3}]},{id:"instant_preset4",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_4}]},{id:"instant_preset5",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_5}]},{id:"instant_preset6",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_6}]},{id:"instant_preset10",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_10}]},{id:"instant_preset11",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_11}]},{id:"instant_preset13",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant13.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_13}]}]},{id:"lineartopia",name:"Line Artopia",graphic:"tba",presets:[{id:"line_artopia_preset1",isPlus:!1,thumb:"tba",effectID:"lineartopia",params:[{type:"slider_item",name:"sketch_detail",defaultValue:30,min:10,max:126,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_width",defaultValue:5,min:4,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_angle",defaultValue:45,min:1,max:180,step:1,unit:"",multiplier:1},{type:"color_item",name:"color",defaultValue:"9e5724",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_1}]},{id:"line_artopia_preset2",isPlus:!0,thumb:"tba",effectID:"lineartopia",params:[{type:"slider_item",name:"sketch_detail",defaultValue:30,min:10,max:126,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_width",defaultValue:5,min:4,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_angle",defaultValue:45,min:1,max:180,step:1,unit:"",multiplier:1},{type:"color_item",name:"color",defaultValue:"38a9ff",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_2}]},{id:"line_artopia_preset3",isPlus:!0,thumb:"tba",effectID:"lineartopia",params:[{type:"slider_item",name:"sketch_detail",defaultValue:30,min:10,max:126,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_width",defaultValue:5,min:4,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"color",defaultValue:"c22c2c",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_3},{type:"static",name:"imageURL",defaultValue:"tex_drafting_preset3.jpg"}]},{id:"line_artopia_preset4",isPlus:!0,thumb:"tba",effectID:"lineartopia",params:[{type:"slider_item",name:"sketch_detail",defaultValue:30,min:10,max:126,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_width",defaultValue:5,min:4,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"color",defaultValue:"505050",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_4},{type:"static",name:"imageURL",defaultValue:"tex_line_artopia_preset4.jpg"}]}]},{id:"lomoart",name:"Lomo Art",graphic:"tba",presets:[{id:"lomoart_preset7",isPlus:!1,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.1,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"gradURL",defaultValue:"lomoart_7_grad.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_7}]},{id:"lomoart_preset1",isPlus:!0,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.5,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_lomoart_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_1}]},{id:"lomoart_preset2",isPlus:!1,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.5,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_lomoart_preset2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_2}]},{id:"lomoart_preset3",isPlus:!0,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.5,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_lomoart_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_3}]},{id:"lomoart_preset4",isPlus:!0,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.5,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_lomoart_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_4}]},{id:"lomoart_preset6",isPlus:!0,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_6}]}]},{id:"motioncolor",name:"Motion Color",graphic:"tba",presets:[{id:"motioncolor_preset1",isPlus:!1,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_1}]},{id:"motioncolor_preset2",isPlus:!0,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_2}]},{id:"motioncolor_preset3",isPlus:!0,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_motioncolort_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_3}]},{id:"motioncolor_preset4",isPlus:!0,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_motioncolort_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_4}]},{id:"motioncolor_preset5",isPlus:!1,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_motioncolor_preset5_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_5}]}]},{id:"oldphotofx",name:"Old Photo",graphic:"tba",presets:[{id:"oldphoto_preset1",isPlus:!1,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_1},{type:"slider_item",name:"grain_amount",defaultValue:.6,min:.2,max:5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"silhouette_amount",defaultValue:100,min:0,max:127,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset2",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_2},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset4",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_4},{type:"slider_item",name:"silhouette_amount",defaultValue:100,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset5",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset5_1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_5},{type:"static",name:"useBlur",defaultValue:!0},{type:"slider_item",name:"color_amount",defaultValue:110,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"focal_blur",defaultValue:1,min:.1,max:1.5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset6",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_6},{type:"slider_item",name:"brightness",defaultValue:1,min:1,max:10,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset7",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_7},{type:"slider_item",name:"silhouette_amount",defaultValue:100,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset8",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_8},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset9",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_9},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset10",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_10},{type:"slider_item",name:"silhouette_amount",defaultValue:100,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset11",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_11},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset12",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_12},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset13",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset13_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_13},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset14",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_14},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset15",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset_15.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_15},{type:"slider_item",name:"silhouette_amount",defaultValue:115,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset16",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset16.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_16},{type:"static",name:"useBlur",defaultValue:!0},{type:"slider_item",name:"blur_amount",defaultValue:.2,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset17",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_17},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset18",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_18},{type:"slider_item",name:"contrast",defaultValue:.1,min:0,max:.5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset19",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"oldies_texture19.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19}]},{id:"oldphoto_preset20",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"oldies_texture20.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_20}]}]},{id:"orton_style",name:"Orton Style",graphic:"tba",presets:[{id:"orton_style_preset1",isPlus:!0,thumb:"tba",effectID:"orton_style",params:[{type:"slider_item",name:"blur_amount",defaultValue:.5,min:.05,max:1,step:.01,unit:"",multiplier:100}]}]},{id:"patrioticfx",name:"Patriotic",graphic:"tba",presets:[{id:"patriotic_preset1",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_space",defaultValue:0,min:-180,max:180,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_patriot_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_1}]},{id:"patriotic_preset2",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:86,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_space",defaultValue:0,min:-180,max:180,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_2}]},{id:"patriotic_preset3",isPlus:!1,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"line_color",defaultValue:"aa0000",fineChangeEnabled:!0},{type:"color_item",name:"background_color",defaultValue:"437fff",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_3}]},{id:"patriotic_preset4",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"static",name:"imageURL",defaultValue:"tex_patriot_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_4}]},{id:"patriotic_preset5",isPlus:!1,thumb:"tba",effectID:"patrioticfx",params:[{type:"static",name:"imageURL",defaultValue:"tex_patriot_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_5}]},{id:"patriotic_preset6",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:86,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_space",defaultValue:0,min:-180,max:180,step:1,unit:"",multiplier:1},{type:"slider_item",name:"star_size",defaultValue:.3,min:.1,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_patriot_preset6_4.jpg"},{type:"static",name:"tileURL",defaultValue:"256star.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_6}]},{id:"patriotic_preset7",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"smoothness",defaultValue:.03,min:.03,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"red",defaultValue:.4,min:.1,max:.6,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"navy",defaultValue:.14,min:.1,max:.6,step:.01,unit:"",multiplier:100},{type:"static",name:"useBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_7}]}]},{id:"pinhole",name:"Pinhole",graphic:"tba",presets:[{id:"pinhole_preset1",isPlus:!1,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"motion_angle",defaultValue:120,min:0,max:360,step:1,unit:"",multiplier:1},{type:"slider_item",name:"motion_amount",defaultValue:10,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_1}]},{id:"pinhole_preset2",isPlus:!0,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_pinhole_preset2_b.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_2}]},{id:"pinhole_preset3",isPlus:!0,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_pinhole3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_3}]},{id:"pinhole_preset4",isPlus:!0,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"motion_angle",defaultValue:0,min:0,max:360,step:1,unit:"",multiplier:1},{type:"slider_item",name:"motion_amount",defaultValue:10,min:5,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"fisheye_amount",defaultValue:1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_pinhole_preset4_r.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_4}]},{id:"pinhole_preset5",isPlus:!0,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"fisheye_amount",defaultValue:1.05,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset4_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_5}]}]},{id:"popartfx",name:"Pop Art",graphic:"tba",presets:[{id:"popart_preset1",isPlus:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"gradURL",defaultValue:"popart_preset1_grad.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_1}]},{id:"popart_preset2",isPlus:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"detail_level",defaultValue:204,min:50,max:230,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_popart_preset3.jpg"},{type:"static",name:"gradURL",defaultValue:"popart_preset1_grad.jpg"},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_2}]},{id:"popart_preset3",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"detail_level",defaultValue:204,min:50,max:230,step:1,unit:"",multiplier:1},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"imageURL",defaultValue:"tex_popart_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_3}]},{id:"popart_preset4",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_4}]},{id:"popart_preset5",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:3,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_5}]},{id:"popart_preset6",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"imageURL",defaultValue:"tex_popart_preset6.jpg"},{type:"static",name:"gradURL",defaultValue:"popart_preset6_grad.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_6}]},{id:"popart_preset7",isPlus:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"gradURL",defaultValue:"popart_preset1_grad.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_7}]},{id:"popart_preset9",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"isHalftone",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_9}]},{id:"popart_preset10",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smooth_amount",defaultValue:.02,min:.02,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"color_detail",defaultValue:4,min:4,max:15,step:.01,unit:"",multiplier:100},{type:"static",name:"isHalftone",defaultValue:!0},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_10}]},{id:"popart_preset11",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"gradURL",defaultValue:"popart_preset11_grad.jpg"},{type:"static",name:"isHalftone",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_11}]},{id:"popart_preset13",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"color_item",name:"color_value_1",defaultValue:"ff0000",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"ffea00",fineChangeEnabled:!0},{type:"color_item",name:"color_value_3",defaultValue:"00d1ff",fineChangeEnabled:!0},{type:"color_item",name:"color_value_4",defaultValue:"37ff00",fineChangeEnabled:!0},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_13}]},{id:"popart_preset14",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_14}]},{id:"popart_preset15",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"isHalftone",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_15}]},{id:"popart_preset16",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_16}]},{id:"popart_preset17",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_17}]},{id:"popart_preset18",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_18}]},{id:"popart_preset19",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"halftoneURL",defaultValue:"popart_texture_halftone.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_19}]},{id:"popart_preset20",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_20}]}]},{id:"sepia",name:"Sepia",graphic:"tba",presets:[{id:"sepia_preset1",isPlus:!1,thumb:"tba",effectID:"sepia",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]}]},{id:"stenciler",name:"Stenciler",graphic:"tba",presets:[{id:"stenciler_preset1",isPlus:!1,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_1},{type:"static",name:"useBlur",defaultValue:!0},{type:"color_item",name:"color",defaultValue:"000000",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.6,min:0,max:1,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset2",isPlus:!1,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_2},{type:"static",name:"useBlur",defaultValue:!0},{type:"color_item",name:"color",defaultValue:"4590d1",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.6,min:0,max:1,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset3",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_3},{type:"color_item",name:"color",defaultValue:"000000",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset4",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_4},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset6",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_6},{type:"static",name:"useBlur",defaultValue:!0},{type:"slider_item",name:"color_detail",defaultValue:4,min:2,max:15,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset7",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_7},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset8",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset8.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_8},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset9",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_9},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset10",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_10},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset11",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_11},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]}]},{id:"summer",name:"Summer",graphic:"tba",presets:[{id:"summer_preset1",isPlus:!1,thumb:"tba",effectID:"summer",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"summer_texture.png"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUMMER_PRESETS.PRESET_1}]},{id:"summer_preset2",isPlus:!0,thumb:"tba",effectID:"summer",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"summer_texture3.png"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUMMER_PRESETS.PRESET_2}]}]},{id:"sunburst",name:"Sunburst",graphic:"tba",presets:[{id:"sunburst_preset1",isPlus:!1,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"imageURL",defaultValue:"tex_sunburst_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_1},{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"silhouette_amount",defaultValue:204,min:102,max:255,step:1,unit:"",multiplier:1}]},{id:"sunburst_preset2",isPlus:!1,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_2},{type:"color_item",name:"color",defaultValue:"e9e9e9",fineChangeEnabled:!0},{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sunburst_amount",defaultValue:30,min:5,max:50,step:1,unit:"",multiplier:1}]},{id:"sunburst_preset3",isPlus:!0,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"imageURL",defaultValue:"tex_sunburst_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_3},{type:"slider_item",name:"grain_amount",defaultValue:1,min:.1,max:5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"sunburst_amount",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"sunburst_preset4",isPlus:!0,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_4},{type:"slider_item",name:"grain_amount",defaultValue:1.1,min:.1,max:5,step:.01,unit:"",multiplier:100}]},{id:"sunburst_preset5",isPlus:!0,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"imageURL",defaultValue:"tex_sunburst_preset5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_5},{type:"slider_item",name:"grain_amount",defaultValue:.8,min:.1,max:5,step:.01,unit:"",multiplier:100}]},{id:"sunburst_preset6",isPlus:!0,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_6},{type:"slider_item",name:"grain_amount",defaultValue:1.1,min:.1,max:5,step:.01,unit:"",multiplier:100}]}]},{id:"tiltshiftfx",name:"Tilt Shift",graphic:"tba",presets:[{id:"tiltshift_preset1",isPlus:!1,thumb:"tba",effectID:"tiltshiftfx",params:[{type:"slider_item",name:"size",defaultValue:3.5,min:1,max:10,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"blur_amount",defaultValue:.5,min:.05,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"angle",defaultValue:0,min:-180,max:180,step:1,unit:"",multiplier:1},{type:"slider_item",name:"slide_vertical",defaultValue:0,min:-.5,max:.5,step:.01,unit:"",multiplier:100},{type:"static",name:"useBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TILT_SHIFT_PRESETS.PRESET_1}]},{id:"tiltshift_preset2",isPlus:!0,thumb:"tba",effectID:"tiltshiftfx",params:[{type:"slider_item",name:"size",defaultValue:2.5,min:1,max:5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"blur_amount",defaultValue:.5,min:.05,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"slide_vertical",defaultValue:0,min:-.5,max:.5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"slide_horizontal",defaultValue:0,min:-.5,max:.5,step:.01,unit:"",multiplier:100},{type:"static",name:"useBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TILT_SHIFT_PRESETS.PRESET_2}]}]},{id:"tinytype",name:"Tin Type",graphic:"tba",presets:[{id:"tinytype_preset1",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_1.jpg"}]},{id:"tinytype_preset2",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"818A74",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_2.jpg"}]},{id:"tinytype_preset3",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_3.jpg"}]},{id:"tinytype_preset4",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_4.jpg"}]},{id:"tinytype_preset5",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_5.jpg"}]},{id:"tinytype_preset6",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_6.jpg"}]},{id:"tinytype_preset7",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_7.jpg"}]},{id:"tinytype_preset8",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"button_bar",name:"modeBW",defaultValue:1,data:[{name:"lighter",value:0},{name:"medium",value:1},{name:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_8.jpg"}]}]},{id:"unitedcolors",name:"United Colors",graphic:"tba",presets:[{id:"unitedcolors_preset1",isPlus:!1,thumb:"tba",effectID:"unitedcolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.UNITED_COLORS_PRESETS.PRESET_1},{type:"color_item",name:"color_value_1",defaultValue:"fff700",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"ff0000",fineChangeEnabled:!0}]},{id:"unitedcolors_preset2",isPlus:!0,thumb:"tba",effectID:"unitedcolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.UNITED_COLORS_PRESETS.PRESET_2},{type:"color_item",name:"color_value_1",defaultValue:"f3ff00",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"0084ff",fineChangeEnabled:!0}]},{id:"unitedcolors_preset3",isPlus:!1,thumb:"tba",effectID:"unitedcolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.UNITED_COLORS_PRESETS.PRESET_3},{type:"color_item",name:"color_value_1",defaultValue:"bcff6f",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"ad3232",fineChangeEnabled:!0}]},{id:"unitedcolors_preset4",isPlus:!0,thumb:"tba",effectID:"unitedcolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.UNITED_COLORS_PRESETS.PRESET_4},{type:"color_item",name:"color_value_1",defaultValue:"ffa1db",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"1b6826",fineChangeEnabled:!0}]}]},{id:"warmer",name:"Warmer",graphic:"tba",presets:[{id:"warming_filter_preset1",isPlus:!1,thumb:"tba",effectID:"warmer",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"ec8a00"},{type:"static",name:"amount",defaultValue:40}]},{id:"warming_filter_preset2",isPlus:!0,thumb:"tba",effectID:"warmer",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"ebb113"},{type:"static",name:"amount",defaultValue:50}]}]},{id:"viewfinder",name:"Viewfinder",graphic:"tba",presets:[{id:"viewfinder_preset1",isPlus:!1,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect1_hardlight.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_1}]},{id:"viewfinder_preset2",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect2_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_2}]},{id:"viewfinder_preset3",isPlus:!1,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect3_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_3}]},{id:"viewfinder_preset4",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect4_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_4}]},{id:"viewfinder_preset5",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect5_lighten_opacity50.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_5}]},{id:"viewfinder_preset6",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect6_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_6}]},{id:"viewfinder_preset7",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect7_multiply.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_7}]},{id:"viewfinder_preset8",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect8_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_8}]},{id:"viewfinder_preset9",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect9_darken.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_9}]},{id:"viewfinder_preset10",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect10_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_10}]},{id:"viewfinder_preset11",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect11_hardlight.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_11}]},{id:"viewfinder_preset12",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect12_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_12}]}]},{id:"vintagecolors",name:"Vintage Colors",graphic:"tba",presets:[{id:"vintage_colors_preset6",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_6}]},{id:"vintage_colors_preset1",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_1},{type:"static",name:"color1",defaultValue:"bcff6f"},{type:"static",name:"color2",defaultValue:"ad3232"}]},{id:"vintage_colors_preset2",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_2},{type:"static",name:"color1",defaultValue:"ffff9d"},{type:"static",name:"color2",defaultValue:"c61689"}]},{id:"vintage_colors_preset3",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_3},{type:"static",name:"color1",defaultValue:"fff77d"},{type:"static",name:"color2",defaultValue:"419dff"}]},{id:"vintage_colors_preset4",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_4},{type:"static",name:"color1",defaultValue:"ffc6e7"},{type:"static",name:"color2",defaultValue:"0f9800"}]},{id:"vintage_colors_preset5",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"vintagecolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_5},{type:"static",name:"color1",defaultValue:["bcff6f","ffff9d","fff77d","ffc6e7"]},{type:"static",name:"color2",defaultValue:["ad3232","c61689","419dff","0f9800"]}]},{id:"vintage_colors_preset7",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_7},{type:"static",name:"imageURL",defaultValue:"lut_vintage_preset7.jpg"}]},{id:"vintage_colors_preset8",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_8},{type:"static",name:"imageURL",defaultValue:"lut_vintage_preset8.jpg"}]},{id:"vintage_colors_preset9",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_9},{type:"static",name:"imageURL",defaultValue:"lut_vintage_preset9.jpg"}]}]},{id:"winterfx",name:"Winter",graphic:"tba",presets:[{id:"frosteffect",isPlus:!1,thumb:"tba",effectID:"winterfx",params:[{type:"slider_item",name:"frost_amount",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"frost_pattern.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WINTER_PRESETS.PRESET_1}]},{id:"wintereffect",isPlus:!0,thumb:"tba",effectID:"winterfx",params:[{type:"slider_item",name:"opacity",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"snow_texture.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WINTER_PRESETS.PRESET_2}]}]},{id:"touchup",name:"Touch Up",graphic:"tba",presets:[{id:"perfectskin",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.5,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"isBlur2",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.perfectskin}]},{id:"wrinkles",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.5,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.wrinkles}]},{id:"bronzer",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.5,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color_palette",name:"color_palette",defaultValue:"724301",colors:["724301","9A7035","D2AF7E","FCDDB1"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.bronzer}]},{id:"blush",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.5,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"FFCDD9",colors:["FFCDD9","ECB4Bf","DA798A","A16B72","703D42","D9BA9A","CEA989","A9856B","B28061","825436"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.blush}]},{id:"flashspot",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.flashspot}]},{id:"mascara",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.mascara}]},{id:"eye_color",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.7,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"64C4FF",colors:["64C4FF","81BC36","7A5C3A","BBBEBA"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eye_color}]},{id:"eye_brighten",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eye_brighten}]},{id:"eyebrow_pencil",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"3D3A33",colors:["3D3A33","74717A","835836","A58646"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"curves",defaultValue:"blackenCurve"},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eyebrow_pencil}]},{id:"fix_redeye",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.fix_redeye}]},{id:"lipstick",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.7,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"EF4292",colors:["EF4292","D7058C","DA085F","E12438"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.lipstick}]},{id:"teeth_whiten",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.teeth_whiten}]},{id:"hair_color",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.7,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"e8D18A",colors:["e8D18A","935118","C58B4E","0C0C17"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.haircolor}]}]}].filter(Boolean),BFN.EffectsNoPaint=[];for(var fi=0;fi<BFN.EffectData.length;fi++)for(var vi=BFN.EffectData[fi],yi=0;yi<vi.presets.length;yi++){var xi=vi.presets[yi],_i=xi.hasOwnProperty("name")?xi.name:"".concat(vi.name," ").concat(yi+1);xi.params.push({type:"static",name:"effectName",defaultValue:_i});var Ii="".concat(vi.id,"_").concat(xi.id);BFN.toolViewstates[Ii]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,xi.hasOwnProperty("usePaint")&&!xi.usePaint&&BFN.EffectsNoPaint.push(Ii);for(var Ti=0;Ti<xi.params.length;Ti++){var bi=xi.params[Ti];"color"!==bi.type&&"color_item"!==bi.type||bi.emptyEnabled||(bi.emptyEnabled=!1)}xi.params.push({type:"static",name:"fadeable",defaultValue:!0}),xi.params.push({type:"static",name:"fixTransparency",defaultValue:!!xi.fixTransparency})}BFN.ArtsyData=[{id:"artsy_favorites",name:"Favorites",graphic:"graphic_artsy_favorites",presets:[]},!!BeFunky.Params.isBeta&&{id:"ai_artsy_style",name:"A.I. Artsy Style",graphic:"",presets:[{id:"AI_ARTSY_STYLE_0",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_1",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_2",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_3",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_4",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_5",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_6",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_7",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_8",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_9",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_10",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_11",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_12",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_13",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_14",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_15",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_16",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_17",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_18",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_19",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_20",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_21",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_22",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_23",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_24",isPlus:!0,thumb:"",params:[]},{id:"AI_ARTSY_STYLE_25",isPlus:!0,thumb:"",params:[]}]},{id:"digitalart",name:"Digital Art",graphic:"graphic_artsy_digitalart",presets:[{id:"ART_0001",name:"Cartoonizer DLX",isPlus:!0,thumb:"graphic_artsy_digitalart_1.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0002",name:"Underpainting DLX ",isPlus:!0,thumb:"graphic_artsy_digitalart_2.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0004",name:"Oil Painting DLX",isPlus:!0,thumb:"graphic_artsy_digitalart_4.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0007",name:"Graphic Novel DLX",isPlus:!0,thumb:"graphic_artsy_digitalart_7.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:75,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_amount",defaultValue:30,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0008",name:"Impressionist DLX",isPlus:!0,thumb:"graphic_artsy_digitalart_8.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_amount",defaultValue:20,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0009",name:"Ink Wash DLX",isPlus:!0,thumb:"graphic_artsy_digitalart_9.jpg",params:[{type:"slider_item",name:"detail_level",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0006",name:"Watercolor DLX",isPlus:!0,thumb:"graphic_artsy_digitalart_6.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0003",name:"Cross Hatch DLX",isPlus:!0,thumb:"graphic_artsy_digitalart_3.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0005",name:"Pop Art DLX",isPlus:!0,thumb:"graphic_artsy_digitalart_5.jpg",params:[]}]},{id:"cartoonizer",name:"Cartoonizer",graphic:"graphic_artsy_cartoonizer",presets:[{id:"ART_0016",isPlus:!0,thumb:"graphic_artsy_cartoonizer_1.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:40,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:20,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_detail",defaultValue:60,min:12,max:100,step:1,unit:"",multiplier:1}]},{id:"233",isPlus:!0,thumb:"graphic_artsy_cartoonizer_6.jpg",params:[{type:"slider_item",name:"sketch_brightness",defaultValue:35,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_smoothness",defaultValue:100,min:10,max:200,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:17,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"sketch_smoothness",defaultValue:20,min:1,max:30,step:1,unit:"",multiplier:1},{type:"slider_item",name:"clutter_cleaner",defaultValue:3,min:3,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"color_detail",defaultValue:350,min:4,max:1024,step:1,unit:"",multiplier:1}]},{id:"172",isPlus:!0,thumb:"graphic_artsy_cartoonizer_2.jpg",params:[{type:"slider_item",name:"sketch_detail",defaultValue:15,min:5,max:91,step:2,unit:"",multiplier:1},{type:"slider_item",name:"sketch_smoothness",defaultValue:20,min:1,max:51,step:1,unit:"",multiplier:1},{type:"slider_item",name:"clutter_cleaner",defaultValue:3,min:1,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"color_detail",defaultValue:36,min:10,max:80,step:2,unit:"",multiplier:1}]},{id:"13",isPlus:!0,thumb:"graphic_artsy_cartoonizer_3.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:3,min:3,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"color_detail",defaultValue:30,min:10,max:80,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:13,min:5,max:51,step:1,unit:"",multiplier:1},{type:"slider_item",name:"halftone_size",defaultValue:5,min:3,max:45,step:2,unit:"",multiplier:1}]},{id:"14",isPlus:!0,thumb:"graphic_artsy_cartoonizer_4.jpg",params:[{type:"slider_item",name:"sketch_detail",defaultValue:31,min:3,max:91,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_detail",defaultValue:50,min:10,max:80,step:1,unit:"",multiplier:1}]},{id:"48",isPlus:!0,thumb:"graphic_artsy_cartoonizer_5.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:3,min:3,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"color_detail",defaultValue:45,min:10,max:80,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:13,min:5,max:51,step:1,unit:"",multiplier:1}]}]},{id:"gouache",name:"Gouache",graphic:"graphic_artsy_gouache",presets:[{id:"259",isPlus:!0,thumb:"graphic_artsy_gouache_1.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"smoothness",defaultValue:30,min:1,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:10,min:2,max:100,step:1,unit:"",multiplier:1}]},{id:"251",isPlus:!0,thumb:"graphic_artsy_gouache_2.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"smoothness",defaultValue:25,min:1,max:51,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:15,min:3,max:51,step:1,unit:"",multiplier:1}]},{id:"258",isPlus:!0,thumb:"graphic_artsy_gouache_3.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"smoothness",defaultValue:30,min:1,max:30,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:10,min:2,max:100,step:1,unit:"",multiplier:1}]}]},{id:"impressionist",name:"Impressionist",graphic:"graphic_artsy_impressionist",presets:[{id:"59",isPlus:!0,thumb:"graphic_artsy_impressionist_1.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:120,min:40,max:160,step:1,unit:"",multiplier:1}]},{id:"60",isPlus:!0,thumb:"graphic_artsy_impressionist_2.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:150,min:40,max:200,step:1,unit:"",multiplier:1}]},{id:"61",isPlus:!0,thumb:"graphic_artsy_impressionist_3.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:120,min:40,max:160,step:1,unit:"",multiplier:1}]},{id:"62",isPlus:!0,thumb:"graphic_artsy_impressionist_4.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:120,min:40,max:160,step:1,unit:"",multiplier:1}]},{id:"63",isPlus:!0,thumb:"graphic_artsy_impressionist_5.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:120,min:20,max:160,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1}]}]},{id:"inkify",name:"Inkify",graphic:"graphic_artsy_inkify",presets:[{id:"ART_0011",isPlus:!0,thumb:"graphic_artsy_inkify_1.jpg",params:[{type:"slider_item",name:"detail_level",defaultValue:43,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:0,min:1,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0014",isPlus:!0,thumb:"graphic_artsy_inkify_2.jpg",params:[{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"detail_level",defaultValue:0,min:-50,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"sketch_color",defaultValue:"C800FF"}]},{id:"ART_0015",isPlus:!0,thumb:"graphic_artsy_inkify_3.jpg",params:[{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"detail_level",defaultValue:0,min:-50,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"sketch_color",defaultValue:"75A458"}]},{id:"ART_0012",isPlus:!0,thumb:"graphic_artsy_inkify_4.jpg",params:[{type:"slider_item",name:"detail_level",defaultValue:32,min:1,max:75,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:0,min:1,max:100,step:1,unit:"",multiplier:1}]}]},{id:"oilpainting",name:"Oil Painting",graphic:"graphic_artsy_oilpainting",presets:[{id:"84",isPlus:!0,thumb:"graphic_artsy_oilpainting_1.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:8,min:3,max:20,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_length",defaultValue:8,min:3,max:19,step:1,unit:"",multiplier:1}]},{id:"86",isPlus:!0,thumb:"graphic_artsy_oilpainting_2.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:5,min:3,max:31,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_length",defaultValue:12,min:3,max:41,step:1,unit:"",multiplier:1},{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1}]},{id:"85",isPlus:!0,thumb:"graphic_artsy_oilpainting_3.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"brush_size",defaultValue:8,min:3,max:51,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_length",defaultValue:8,min:3,max:19,step:1,unit:"",multiplier:1},{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1}]},{id:"88",isPlus:!0,thumb:"graphic_artsy_oilpainting_4.jpg",params:[{type:"slider_item",name:"color_detail",defaultValue:30,min:10,max:80,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:21,min:3,max:51,step:2,unit:"",multiplier:1}]},{id:"89",isPlus:!0,thumb:"graphic_artsy_oilpainting_5.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:21,min:3,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"color_detail",defaultValue:25,min:17,max:80,step:1,unit:"",multiplier:1},{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1}]},{id:"90",isPlus:!0,thumb:"graphic_artsy_oilpainting_6.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:18,min:11,max:65,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:10,min:2,max:45,step:1,unit:"",multiplier:1},{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1}]}]},{id:"pointillism",name:"Pointillism",graphic:"graphic_artsy_pointillism",presets:[{id:"273",isPlus:!0,thumb:"graphic_artsy_pointillism_1.jpg",params:[{type:"slider_item",name:"underpainting_brush_detail",defaultValue:21,min:1,max:21,step:1,unit:"",multiplier:1},{type:"slider_item",name:"underpainting_brush_size",defaultValue:3,min:1,max:70,step:1,unit:"",multiplier:1},{type:"slider_item",name:"overpainting_brush_detail",defaultValue:25,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"overpainting_brush_size",defaultValue:2,min:2,max:100,step:1,unit:"",multiplier:1}]},{id:"274",isPlus:!0,thumb:"graphic_artsy_pointillism_2.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:8,min:3,max:100,step:1,unit:"",multiplier:1}]},{id:"275",isPlus:!0,thumb:"graphic_artsy_pointillism_3.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:8,min:2,max:100,step:1,unit:"",multiplier:1}]},{id:"276",isPlus:!0,thumb:"graphic_artsy_pointillism_4.jpg",params:[{type:"slider_item",name:"brush_detail",defaultValue:15,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:8,min:3,max:100,step:1,unit:"",multiplier:1}]}]},{id:"sketcher",name:"Sketcher",graphic:"graphic_artsy_sketcher",presets:[{id:"ART_0013",isPlus:!0,thumb:"graphic_artsy_sketcher_1.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:40,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:20,min:0,max:100,step:1,unit:"",multiplier:1},{type:"color_item",name:"background_color",defaultValue:"FFFFFF"},{type:"color_item",name:"sketch_color",defaultValue:"000000"}]},{id:"269",isPlus:!0,thumb:"graphic_artsy_sketcher_2.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:1,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:11,min:5,max:51,step:2,unit:"",multiplier:1},{type:"color_item",name:"background_color",defaultValue:"FFFFFF"},{type:"color_item",name:"sketch_color",defaultValue:"000000"}]},{id:"239",isPlus:!0,thumb:"graphic_artsy_sketcher_3.jpg",params:[{type:"slider_item",name:"halftone_size",defaultValue:5,min:3,max:31,step:2,unit:"",multiplier:1},{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:2,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:11,min:5,max:51,step:2,unit:"",multiplier:1}]},{id:"243",isPlus:!0,thumb:"graphic_artsy_sketcher_4.jpg",params:[{type:"slider_item",name:"dot_size",defaultValue:5,min:3,max:31,step:2,unit:"",multiplier:1},{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:2,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:11,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"color_detail",defaultValue:30,min:10,max:80,step:1,unit:"",multiplier:1},{type:"color_item",name:"highlight_color",defaultValue:"CAF8FF"},{type:"color_item",name:"shadow_color",defaultValue:"00A6FF"}]},{id:"250",isPlus:!0,thumb:"graphic_artsy_sketcher_5.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:2,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:13,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"halftone_size",defaultValue:5,min:3,max:31,step:2,unit:"",multiplier:1},{type:"color_item",name:"background_color",defaultValue:"FFFF00"},{type:"color_item",name:"sketch_color",defaultValue:"DD2020"}]},{id:"264",isPlus:!0,thumb:"graphic_artsy_sketcher_6.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:1,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:11,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"dot_size",defaultValue:7,min:3,max:31,step:2,unit:"",multiplier:1},{type:"color_item",name:"sketch_color",defaultValue:"FF3DEF"},{type:"color_item",name:"background_color",defaultValue:"FFFFFF"}]}]},{id:"underpainting",name:"Underpainting",graphic:"graphic_artsy_underpainting",presets:[{id:"ART_0010",isPlus:!0,thumb:"graphic_artsy_underpainting_1.jpg",params:[{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0017",isPlus:!0,thumb:"graphic_artsy_underpainting_2.jpg",params:[{type:"slider_item",name:"paint_amount",defaultValue:48,min:8,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:25,min:1,max:100,step:1,unit:"",multiplier:1}]}]},{id:"watercolor",name:"Watercolor",graphic:"graphic_artsy_watercolor",presets:[{id:"ART_0018",isPlus:!0,thumb:"graphic_artsy_watercolor_1.jpg",params:[{type:"slider_item",name:"paint_amount",defaultValue:30,min:8,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:25,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0019",isPlus:!0,thumb:"graphic_artsy_watercolor_2.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:50,min:10,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1}]},{id:"245",isPlus:!0,thumb:"graphic_artsy_watercolor_3.jpg",params:[]},{id:"238",isPlus:!0,thumb:"graphic_artsy_watercolor_4.jpg",params:[{type:"slider_item",name:"overpainting_brush_size",defaultValue:9,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"underpainting_brush_size",defaultValue:17,min:2,max:100,step:1,unit:"",multiplier:1}]}]}].filter(Boolean),BFN.ArtsyToolIDs={},BFN.ArtsyToolParams={},BFN.ArtsyToolColorParams={},BFN.ArtsyPresetObjects={},BFN.artsyPresetMap={},BFN.artsyIDMap={};for(var Si=0;Si<BFN.ArtsyData.length;Si++)for(var Ci=BFN.ArtsyData[Si],Bi=0;Bi<Ci.presets.length;Bi++){var Fi=Ci.presets[Bi];Fi.isArtsy=null!=Ci.graphic,Fi.hasOwnProperty("name")||(Fi.name=Ci.name+" "+(Bi+1));var Ei=Ci.id+"_"+Fi.id;BFN.toolViewstates[Ei]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,BFN.ArtsyToolIDs[Ei]=Fi.id,BFN.ArtsyToolParams[Ei]=[],BFN.ArtsyToolColorParams[Ei]=[],BFN.ArtsyPresetObjects[Ei]=Fi,BFN.artsyPresetMap[Ei]=Ci.id,BFN.artsyIDMap[Fi.id]=Ci.id;for(var Pi=0;Pi<Fi.params.length;Pi++){var Ni=Fi.params[Pi];BFN.ArtsyToolParams[Ei].push(Ni.name),"color"!=Ni.type&&"color_item"!=Ni.type||(Ni.emptyEnabled=!1,BFN.ArtsyToolColorParams[Ei].push(Ni.name))}Fi.params.push({type:"static",name:"id",defaultValue:Fi.id})}for(var Mi in BFN.FrameData={crop_rotate:[{id:"frame_featured",name:"Featured",frame:"tba",presets:[]},{id:"frame_instant",name:"Instant",frame:"tba",presets:[{id:"instant_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_instant_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1652,frameH:2e3,windowX:106,windowY:109,windowW:1443,windowH:1488}}]},{id:"instant_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_2"},{type:"static",name:"texture_data",defaultValue:{frameW:900,frameH:900,windowX:52,windowY:42,windowW:793,windowH:663}}]},{id:"instant_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_3"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:110,windowY:106,windowW:1761,windowH:1754}}]},{id:"instant_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_4"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1419,windowX:85,windowY:85,windowW:1830,windowH:1130}}]},{id:"instant_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_5"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1547,windowX:92,windowY:94,windowW:1815,windowH:1360}}]},{id:"instant_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1647,frameH:2e3,windowX:109,windowY:108,windowW:1431,windowH:1431}}]},{id:"instant_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1652,frameH:2e3,windowX:104,windowY:107,windowW:1447,windowH:1492}}]},{id:"instant_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1547,frameH:2e3,windowX:94,windowY:93,windowW:1358,windowH:1813}}]},{id:"instant_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1652,frameH:2e3,windowX:106,windowY:109,windowW:1443,windowH:1488}}]}]}],crop:[{id:"frame_realistic",name:"Realistic",frame:"tba",presets:[{id:"realistic_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_1"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1e3,windowX:145,windowY:135,windowW:1710,windowH:730}}]},{id:"realistic_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1e3,frameH:1e3,windowX:125,windowY:135,windowW:750,windowH:730}}]},{id:"realistic_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_3"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:60,windowY:65,windowW:1880,windowH:1870}}]},{id:"realistic_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_4"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:430,windowY:415,windowW:1140,windowH:1170}}]},{id:"realistic_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_5"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:430,windowY:415,windowW:1140,windowH:1170}}]},{id:"realistic_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_6"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1615,windowX:405,windowY:380,windowW:1180,windowH:845}}]},{id:"realistic_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_7"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1615,windowX:400,windowY:375,windowW:1200,windowH:845}}]},{id:"realistic_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_8"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:430,windowY:415,windowW:1140,windowH:1170}}]},{id:"realistic_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_9"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1615,windowX:330,windowY:330,windowW:1340,windowH:955}}]}]}],full:[{id:"frame_decorative",name:"Decorative",frame:"tba",presets:[{id:"decorative_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_12",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_12"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_vintage",name:"Vintage",frame:"tba",presets:[{id:"vintage_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_art_deco",name:"Art Deco",frame:"tba",presets:[{id:"art_deco_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_floral",name:"Floral",frame:"tba",presets:[{id:"floral_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_floral_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_12",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_12"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_13",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_13"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_14",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_14"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_15",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_15"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_16",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_16"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_17",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_17"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_18",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_18"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_19",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_19"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_20",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_20"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_21",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_21"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_22",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_22"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_23",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_23"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_24",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_24"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_25",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_25"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_rustic",name:"Rustic",frame:"tba",presets:[{id:"rustic_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_lace",name:"Lace",frame:"tba",presets:[{id:"lace_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_lace_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_12",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_12"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_13",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_13"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_14",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_14"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_15",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_15"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_16",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_16"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_ornament",name:"Ornament",frame:"tba",presets:[{id:"ornament_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_12",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_12"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_13",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_13"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_14",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_14"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_15",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_15"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_hand_drawn",name:"Hand Drawn",frame:"tba",presets:[{id:"hand_drawn_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_grunge",name:"Grunge",frame:"tba",presets:[{id:"grunge_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_3"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3}}]},{id:"grunge_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_8"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3}}]},{id:"grunge_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1500,frameH:2e3}}]}]},{id:"frame_filmstrip",name:"Film Strip",frame:"tba",presets:[{id:"filmstrip_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_1"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1614}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_2"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1536}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_3"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1614}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_4"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1536}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_5"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1380}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_6"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1358}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.DARKEN}]},{id:"filmstrip_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1024,frameH:1024}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1024,frameH:727}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY}]},{id:"filmstrip_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1024,frameH:813}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY}]}]}]},BFN.frameCategoryIDMap={},BFN.framePresetMap={},BFN.frameIDMap={},BFN.FrameData)for(var Di=BFN.FrameData[Mi],wi=0;wi<Di.length;wi++)for(var ki=Di[wi],Li=0;Li<ki.presets.length;Li++){var Oi=ki.presets[Li];Oi.usePaint=!1,Oi.params.push({type:"static",name:"texture_category",defaultValue:ki.id.replace("frame_","")}),Oi.params.push({type:"static",name:"frame_type",defaultValue:Mi}),Oi.params.push({type:"static",name:"frameName",defaultValue:ki.name+" "+(Li+1)}),BFN.toolViewstates[ki.id+"_"+Oi.id]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME,BFN.frameCategoryIDMap[ki.id+"_"+Oi.id]=Oi.id,BFN.frameIDMap[Oi.id]=ki.id,BFN.framePresetMap[Oi.id]=Oi}BFN.TextureData=[{id:"texture_featured",name:"Featured",graphic:"tba",presets:[]},{id:"bokeh",name:"Bokeh",graphic:"graphic_textures_bokeh",presets:[{id:"bokeh_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_bokeh_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.75}]},{id:"bokeh_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_bokeh_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.8}]},{id:"bokeh_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_bokeh_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.88}]},{id:"bokeh_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_bokeh_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"bokeh_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_bokeh_overlay_75.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:.75}]},{id:"bokeh_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_bokeh_overlay_50.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.9}]}]},{id:"scratches",name:"Scratches",graphic:"graphic_textures_scratches",presets:[{id:"scratches_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"9_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"light",name:"Light Trails",graphic:"graphic_textures_light_trails",presets:[{id:"light_trail_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_light_lighten_80.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.7}]},{id:"light_trail_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_light_lighten_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.75}]},{id:"light_trail_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_light_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"9_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"lightleak",name:"Light Leaks",graphic:"graphic_textures_light_leaks",presets:[{id:"light_leak_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_leak_screen_65.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.65}]},{id:"light_leak_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_leak_screen_70.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.7}]},{id:"light_leak_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_leak_screen_80.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.8}]},{id:"light_leak_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_leak_screen_75.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.75}]},{id:"light_leak_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_leak_screen_80.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.8}]},{id:"light_leak_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_leak_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_leak_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_leak_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_leak_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_leak_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_leak_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"9_leak_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"fabric",name:"Fabric",graphic:"graphic_textures_fabric",presets:[{id:"fabric_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_fabric_multiply_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:1}]},{id:"fabric_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_fabric_multiply_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:1}]},{id:"fabric_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_fabric_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"grunge",name:"Grunge",graphic:"graphic_textures_grunge",presets:[{id:"grunge_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_grunge_overlay_60.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.6}]},{id:"grunge_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_grunge_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.HARD_LIGHT},{type:"static",name:"alpha",defaultValue:.8}]},{id:"grunge_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_grunge_overlay_70.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.7}]},{id:"grunge_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_grunge_multiply_30.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:.3}]},{id:"grunge_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_grunge_overlay_60.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.6}]},{id:"grunge_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_grunge_overlay_60.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.6}]},{id:"grunge_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_grunge_hardlight_40.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.HARD_LIGHT},{type:"static",name:"alpha",defaultValue:.4}]},{id:"grunge_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_grunge_overlay_80.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.8}]}]},{id:"paint",name:"Paint",graphic:"graphic_textures_paint",presets:[{id:"paint_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paint_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paint_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paint_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paint_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.5}]},{id:"paint_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"metal",name:"Metal",graphic:"graphic_textures_metal",presets:[{id:"metal_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_metal_overlay_50.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.5}]},{id:"metal_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"bricks",name:"Bricks",graphic:"graphic_textures_bricks",presets:[{id:"bricks_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_Bricks_Multiply_40.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:.4}]},{id:"bricks_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_Bricks_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"bricks_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_Bricks_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"bricks_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_Bricks_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"paper",name:"Paper",graphic:"graphic_textures_paper",presets:[{id:"paper_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.5}]},{id:"paper_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]}],BFN.textureCategoryIDMap={},BFN.texturePresetMap={},BFN.textureIDMap={};for(var Ri=0;Ri<BFN.TextureData.length;Ri++)for(var Ai=BFN.TextureData[Ri],Vi=0;Vi<Ai.presets.length;Vi++){var Ui=Ai.presets[Vi];Ui.params.push({type:"static",name:"textureName",defaultValue:Ai.name+" "+(Vi+1)}),BFN.toolViewstates[Ai.id+"_"+Ui.id]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE,BFN.textureCategoryIDMap[Ai.id+"_"+Ui.id]=Ui.id,BFN.textureIDMap[Ui.id]=Ai.id,BFN.texturePresetMap[Ui.id]=Ui}function Gi(){this.init()}Gi.prototype.init=function(){BeFunky.log("LensFlareData Init"),this.initDefaultValues(),this.initAssetData(),this.initPresetData(),this.initAssets(),this.initPresets(),this.initMenuData()},Gi.prototype.initDefaultValues=function(){this.assetPath=BFN.remoteImagesURL+"app/graphics/lens_flare_assets/"},Gi.prototype.initAssetData=function(){this.assetData=[{categoryID:"glows",name:"Glows",assets:[{assetID:"Glow_01",static:!1},{assetID:"Glow_02",static:!1},{assetID:"Glow_03",static:!1},{assetID:"Glow_04",static:!1},{assetID:"Glow_05",static:!1},{assetID:"Glow_06",static:!1},{assetID:"Glow_07",static:!1},{assetID:"Glow_08",static:!1},{assetID:"Glow_09",static:!1},{assetID:"Glow_10",static:!1}]},{categoryID:"glints",name:"Glints",assets:[{assetID:"Glint_01",static:!1},{assetID:"Glint_02",static:!1},{assetID:"Glint_03",static:!1},{assetID:"Glint_04",static:!1},{assetID:"Glint_05",static:!1},{assetID:"Glint_06",static:!1},{assetID:"Glint_07",static:!1},{assetID:"Glint_08",static:!1}]},{categoryID:"shapes",name:"Shapes",assets:[{assetID:"Circle",static:!1},{assetID:"Circle_Gradient",static:!1},{assetID:"Octagon",static:!1},{assetID:"Octagon_Gradient",static:!1},{assetID:"Hexagon",static:!1},{assetID:"Hexagon_Gradient",static:!1},{assetID:"Square",static:!1},{assetID:"Square_Gradient",static:!1}]},{categoryID:"orbs",name:"Orbs",assets:[{assetID:"Orb_01",static:!1},{assetID:"Orb_02",static:!1},{assetID:"Orb_03",static:!1},{assetID:"Orb_04",static:!1},{assetID:"Orb_05",static:!1},{assetID:"Orb_06",static:!1},{assetID:"Orb_07",static:!1},{assetID:"Orb_08",static:!1},{assetID:"Orb_09",static:!1},{assetID:"Orb_10",static:!1},{assetID:"Orb_11",static:!1},{assetID:"Orb_12",static:!1},{assetID:"Orb_13",static:!1},{assetID:"Orb_14",static:!1},{assetID:"Orb_15",static:!1},{assetID:"Orb_16",static:!1}]},{categoryID:"irises",name:"Irises",assets:[{assetID:"Iris_01",static:!1},{assetID:"Iris_02",static:!1},{assetID:"Iris_03",static:!1},{assetID:"Iris_04",static:!1},{assetID:"Iris_05",static:!1},{assetID:"Iris_06",static:!1},{assetID:"Iris_07",static:!1},{assetID:"Iris_08",static:!1},{assetID:"Iris_09",static:!1},{assetID:"Iris_10",static:!1}]},{categoryID:"streaks",name:"Streaks",assets:[{assetID:"Streak_01",static:!1},{assetID:"Streak_02",static:!1},{assetID:"Streak_03",static:!1},{assetID:"Streak_04",static:!1},{assetID:"Streak_05",static:!1},{assetID:"Streak_06",static:!1},{assetID:"Streak_07",static:!1},{assetID:"Streak_08",static:!1},{assetID:"Streak_09",static:!1},{assetID:"Streak_10",static:!1},{assetID:"Streak_11",static:!1},{assetID:"Streak_12",static:!1},{assetID:"Streak_13",static:!1},{assetID:"Streak_14",static:!1},{assetID:"Streak_15",static:!1},{assetID:"Streak_16",static:!1}]},{categoryID:"caustics",name:"Caustics",assets:[{assetID:"Caustic_01",static:!1},{assetID:"Caustic_02",static:!1},{assetID:"Caustic_03",static:!1},{assetID:"Caustic_04",static:!1},{assetID:"Caustic_05",static:!1},{assetID:"Caustic_06",static:!1},{assetID:"Caustic_07",static:!1},{assetID:"Caustic_08",static:!1},{assetID:"Caustic_09",static:!1},{assetID:"Caustic_10",static:!1},{assetID:"Caustic_11",static:!1},{assetID:"Caustic_12",static:!1},{assetID:"Caustic_13",static:!1},{assetID:"Caustic_14",static:!1},{assetID:"Caustic_15",static:!1},{assetID:"Caustic_16",static:!1},{assetID:"Caustic_17",static:!1},{assetID:"Caustic_18",static:!1},{assetID:"Caustic_19",static:!1},{assetID:"Caustic_20",static:!1},{assetID:"Caustic_21",static:!1},{assetID:"Caustic_22",static:!1},{assetID:"Caustic_23",static:!1},{assetID:"Caustic_24",static:!1}]},{categoryID:"lenses",name:"Lenses",assets:[{assetID:"Lens_01",static:!0},{assetID:"Lens_02",static:!0},{assetID:"Lens_03",static:!0},{assetID:"Lens_04",static:!0},{assetID:"Lens_05",static:!0},{assetID:"Lens_06",static:!0},{assetID:"Lens_07",static:!0},{assetID:"Lens_08",static:!0},{assetID:"Lens_09",static:!0},{assetID:"Lens_10",static:!0},{assetID:"Lens_11",static:!0},{assetID:"Lens_12",static:!0},{assetID:"Lens_13",static:!0},{assetID:"Lens_14",static:!0},{assetID:"Lens_15",static:!0},{assetID:"Lens_16",static:!0},{assetID:"Lens_17",static:!0},{assetID:"Lens_18",static:!0},{assetID:"Lens_19",static:!0},{assetID:"Lens_20",static:!0}]}]},Gi.prototype.initPresetData=function(){this.presetData=[{categoryID:"basic_presets",name:"Basic Presets",presets:[{presetID:"simple",presetName:"Simple",isPlus:!0,elements:[{assetID:"Glow_01",color:8421504,intensityFactor:.3,sizeFactor:2.5,sizeFactorGlobal:.5},{assetID:"Glow_01",color:8421504,intensityFactor:.5,sizeFactor:.5,sizeFactorGlobal:.5},{assetID:"Glint_08",color:8421504,intensityFactor:.4,sizeFactor:.6,sizeFactorGlobal:.5},{assetID:"Glow_01",color:8421504,blendMode:"add",intensityFactor:.35,sizeFactor:.3,sizeFactorGlobal:.75},{assetID:"Orb_07",color:14352384,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.35,sizeFactor:.2},{assetID:"Circle",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.7,sourceDistanceFactor:-.1},{assetID:"Circle",blendMode:"add",intensityFactor:.05,intensityFactorGlobal:.5,sizeFactor:.3,sourceDistanceFactor:-.22},{assetID:"Circle_Gradient",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.08,sourceDistanceFactor:-.14},{assetID:"Circle_Gradient",color:4077973,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.13,sourceDistanceFactor:.24},{assetID:"Circle_Gradient",color:4077973,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.06,sourceDistanceFactor:.27},{assetID:"Circle_Gradient",color:4077973,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.04,sourceDistanceFactor:.21},{assetID:"Circle",blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.04,sourceDistanceFactor:.35},{assetID:"Circle_Gradient",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.15,sourceDistanceFactor:.7},{assetID:"Circle",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.08,sourceDistanceFactor:.68},{assetID:"Circle",blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.03,sourceDistanceFactor:.71},{assetID:"Circle",blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.5,sizeFactor:.07,sourceDistanceFactor:.78},{assetID:"Glow_01",color:4077973,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.25,sizeFactor:.05,sourceDistanceFactor:.78},{assetID:"Circle_Gradient",blendMode:"add",intensityFactor:.65,intensityFactorGlobal:.5,sizeFactor:.2,sourceDistanceFactor:.91},{assetID:"Orb_12",blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.45,sourceDistanceFactor:1},{assetID:"Glow_01",color:4077973,blendMode:"add",intensityFactor:.96,intensityFactorGlobal:.25,sizeFactor:.05,sourceDistanceFactor:.63}]}]},{categoryID:"advanced_presets",name:"Advanced Presets",presets:[{presetID:"sunny_day",presetName:"Sunny Day",isPlus:!0,elements:[{assetID:"Glow_01",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.3,sizeFactor:1.5,sizeFactorGlobal:.75},{assetID:"Glow_10",color:16746496,intensityFactor:.5,sizeFactor:.7,sizeFactorGlobal:.75},{assetID:"Glow_02",intensityFactorGlobal:.5,sizeFactor:.4,sizeFactorGlobal:.5},{assetID:"Glow_09",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.5,sizeFactor:1.1,sizeFactorGlobal:.5},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.25,sizeFactor:1.2,sourceDistanceFactor:1},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:.3,sourceDistanceFactor:.6},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.05,sourceDistanceFactor:.25},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.03,sourceDistanceFactor:.31},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.06,sourceDistanceFactor:.32},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:.06,sourceDistanceFactor:.65},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.05,intensityFactorGlobal:.5,sizeFactor:.2,sourceDistanceFactor:.4},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:.03,sourceDistanceFactor:.7},{assetID:"Glow_01",color:16746496,colorGlobalGroup:1,intensityFactorGlobal:.25,sizeFactor:.02,sourceDistanceFactor:.7},{assetID:"Glow_01",color:16746496,colorGlobalGroup:1,intensityFactorGlobal:.25,sizeFactor:.04,sourceDistanceFactor:.35},{assetID:"Caustic_01",color:16746496,colorGlobalGroup:1,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.55,rotationLock:!0,sourceDistanceFactor:-.5},{assetID:"Caustic_21",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.25,sizeFactor:.3,rotationOffset:180,rotationLock:!0,stretchYFactor:1.5,sourceDistanceFactor:1.3},{assetID:"Caustic_09",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.52,rotationLock:!0,sourceDistanceFactor:.6},{assetID:"Orb_14",blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:1.25,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:1},{assetID:"Lens_15",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:1.5}]},{presetID:"sun_beam",presetName:"Sun Beam",isPlus:!0,elements:[{assetID:"Streak_05",color:13861167,colorGlobalGroup:1,intensityFactor:.8,intensityFactorGlobal:.4,sizeFactor:.98,sizeFactorGlobal:.2,rotationLock:!0,stretchXFactor:2.2,stretchYFactor:.8},{assetID:"Streak_05",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.4,sizeFactor:1.16,sizeFactorGlobal:.2,rotationOffset:180,rotationLock:!0,stretchXFactor:2.2,stretchYFactor:.8},{assetID:"Streak_13",colorGlobalGroup:1,intensityFactor:.8,sizeFactorGlobal:.6,rotationLock:!0},{assetID:"Streak_10",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.8,sizeFactorGlobal:.6,rotationOffset:-90,rotationLock:!0,stretchXFactor:1.5},{assetID:"Orb_10",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.6,sizeFactor:.53,sizeFactorGlobal:.2,rotationLock:!0},{assetID:"Glow_09",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,sizeFactor:1.5,sizeFactorGlobal:.3},{assetID:"Glow_04",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.8,sizeFactor:.35,sizeFactorGlobal:.4,rotationLock:!0,stretchYFactor:3},{assetID:"Caustic_03",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.15,sizeFactorGlobal:.8},{assetID:"Orb_15",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,sizeFactor:.5,sizeFactorGlobal:.8},{assetID:"Orb_01",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,intensityFactorGlobal:.25,sizeFactor:3},{assetID:"Orb_03",color:13861167,blendMode:"add",intensityFactor:.5,sizeFactor:2,rotationLock:!0,sourceDistanceFactor:1}]},{presetID:"warm_sun",presetName:"Warm Sun",isPlus:!0,elements:[{assetID:"Glow_10",color:13850903,colorGlobalGroup:1,blendMode:"add",intensityFactor:.8,intensityFactorGlobal:.59,sizeFactor:.46,sizeFactorGlobal:.19,rotationOffset:17,stretchXFactor:.75,stretchYFactor:.82},{assetID:"Glow_02",color:14376216,blendMode:"add",intensityFactor:.5,sizeFactor:.1,sizeFactorGlobal:.25},{assetID:"Octagon",color:14376216,colorGlobalGroup:1,intensityFactor:.85,intensityFactorGlobal:.57,sizeFactor:.04,sizeFactorGlobal:.16,sourceDistanceFactor:.24},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.32,intensityFactorGlobal:.24,sizeFactor:.08,sizeFactorGlobal:.33,sourceDistanceFactor:.14},{assetID:"Iris_01",color:14376216,colorGlobalGroup:1,intensityFactor:.71,intensityFactorGlobal:.6,sizeFactor:.14,sizeFactorGlobal:.27,rotationOffset:-180,rotationLock:!0,sourceDistanceFactor:.35},{assetID:"Orb_04",intensityFactor:.58,intensityFactorGlobal:.3,sizeFactor:.09,sizeFactorGlobal:.24,rotationOffset:-151,sourceDistanceFactor:.44},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.12,intensityFactorGlobal:.39,sizeFactor:.27,sizeFactorGlobal:.12,sourceDistanceFactor:.16},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.07,intensityFactorGlobal:.39,sizeFactor:.27,sizeFactorGlobal:.12,sourceDistanceFactor:.88},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.07,intensityFactorGlobal:.39,sizeFactor:.17,sizeFactorGlobal:.12,sourceDistanceFactor:1.1},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.08,intensityFactorGlobal:.17,sizeFactor:.17,sizeFactorGlobal:.19,sourceDistanceFactor:.24},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.08,intensityFactorGlobal:.2,sizeFactor:.25,sizeFactorGlobal:.15,sourceDistanceFactor:.27,centerDistanceFactor:.01},{assetID:"Streak_06",color:14376216,colorGlobalGroup:1,intensityFactor:.88,intensityFactorGlobal:.63,sizeFactor:.96,sizeFactorGlobal:.22,rotationOffset:100,rotationLock:!0,stretchXFactor:1.6,stretchYFactor:.68},{assetID:"Streak_06",color:14376216,colorGlobalGroup:1,intensityFactor:.66,intensityFactorGlobal:.54,sizeFactor:.96,sizeFactorGlobal:.34,rotationOffset:22,rotationLock:!0,stretchXFactor:1.6,stretchYFactor:.68},{assetID:"Streak_06",color:14376216,colorGlobalGroup:1,intensityFactor:.88,intensityFactorGlobal:.52,sizeFactor:.96,sizeFactorGlobal:.24,rotationOffset:67,rotationLock:!0,stretchXFactor:.65,stretchYFactor:.74},{assetID:"Streak_06",color:14376216,colorGlobalGroup:1,intensityFactor:.66,sizeFactor:.96,rotationOffset:-23,rotationLock:!0,stretchXFactor:.96,stretchYFactor:.41},{assetID:"Orb_15",color:14376216,colorGlobalGroup:1,blendMode:"add",intensityFactor:.23,intensityFactorGlobal:.4,sizeFactor:2.42,sizeFactorGlobal:.32,rotationOffset:105,rotationLock:!0,stretchXFactor:1.08,sourceDistanceFactor:.13},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.16,intensityFactorGlobal:.56,sizeFactor:.07,sizeFactorGlobal:.14,stretchXFactor:1.02,sourceDistanceFactor:.58},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.14,intensityFactorGlobal:.56,sizeFactor:.09,sizeFactorGlobal:.14,stretchXFactor:1.02,sourceDistanceFactor:1},{assetID:"Octagon",color:14376216,colorGlobalGroup:1,intensityFactor:.14,intensityFactorGlobal:.56,sizeFactor:.15,sizeFactorGlobal:.14,stretchXFactor:1.02,sourceDistanceFactor:.74},{assetID:"Lens_14",color:14376216,colorGlobalGroup:1,intensityFactor:.12,intensityFactorGlobal:1,sizeFactor:.9,sourceDistanceFactor:.08}]},{presetID:"sunset",presetName:"Sunset",isPlus:!0,elements:[{assetID:"Streak_14",blendMode:"add",sizeFactorGlobal:.8,rotationOffset:90,rotationLock:!0,stretchXFactor:.8},{assetID:"Streak_05",color:14783541,blendMode:"add",sizeFactorGlobal:.8,rotationOffset:95,rotationLock:!0,stretchXFactor:1.8},{assetID:"Streak_05",color:14783541,blendMode:"add",sizeFactorGlobal:.8,rotationOffset:-95,rotationLock:!0,stretchXFactor:1.8},{assetID:"Streak_05",color:14783541,sizeFactorGlobal:.6,rotationOffset:-115,rotationLock:!0,stretchYFactor:5},{assetID:"Streak_05",color:14783541,sizeFactorGlobal:.6,rotationOffset:115,rotationLock:!0,stretchYFactor:5},{assetID:"Streak_05",color:14783541,intensityFactor:.6,sizeFactorGlobal:.6,rotationOffset:180,rotationLock:!0,stretchYFactor:5},{assetID:"Glow_10",intensityFactor:.5,sizeFactor:.5,sizeFactorGlobal:.6,stretchXFactor:2.5,stretchYFactor:.75},{assetID:"Orb_03",intensityFactor:.8,sizeFactorGlobal:.4,rotationLock:!0,sourceDistanceFactor:1},{assetID:"Orb_03",intensityFactor:.2,sizeFactor:.2,sizeFactorGlobal:.4,rotationLock:!0,sourceDistanceFactor:.65},{assetID:"Caustic_09",intensityFactor:.2,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:1}]},{presetID:"flash",presetName:"Flash",isPlus:!0,elements:[{assetID:"Glow_10",color:5471734,colorGlobalGroup:1,sizeFactorGlobal:.75},{assetID:"Glow_01",color:5669375,colorGlobalGroup:1,sizeFactor:.51,sizeFactorGlobal:.75},{assetID:"Caustic_09",color:5669375,colorGlobalGroup:1,intensityFactorGlobal:.5,sizeFactor:.45,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:1.33},{assetID:"Lens_09",color:5669375,colorGlobalGroup:1,intensityFactorGlobal:.25,sizeFactor:1.75},{assetID:"Orb_10",intensityFactor:.48,intensityFactorGlobal:.25,sizeFactor:.94,sizeFactorGlobal:.5,rotationLock:!0},{assetID:"Orb_13",color:5669375,colorGlobalGroup:1,intensityFactor:.53,intensityFactorGlobal:.5,sizeFactor:1.14,sourceDistanceFactor:1.46},{assetID:"Orb_04",intensityFactor:.8,intensityFactorGlobal:.25,sizeFactor:.25,rotationLock:!0,sourceDistanceFactor:.85}]},{presetID:"strobe",presetName:"Strobe",isPlus:!0,elements:[{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.85,sizeFactor:1.8,sizeFactorGlobal:.6,stretchXFactor:1.7},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.85,sizeFactor:1.2,sizeFactorGlobal:.6,rotationOffset:10,rotationLock:!0},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.55,sizeFactor:1.2,sizeFactorGlobal:.6,rotationOffset:150,rotationLock:!0,stretchYFactor:2.2},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.5,sizeFactor:1.2,sizeFactorGlobal:.6,rotationOffset:100,rotationLock:!0,stretchXFactor:.8,stretchYFactor:2.2},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.5,sizeFactor:1.2,sizeFactorGlobal:.7,rotationOffset:90,rotationLock:!0,stretchXFactor:1.2,stretchYFactor:4.5},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:1.2,sizeFactorGlobal:.55,rotationOffset:65,rotationLock:!0,stretchXFactor:1.4,stretchYFactor:1.7},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:1.2,sizeFactorGlobal:.45,rotationOffset:60,rotationLock:!0,stretchXFactor:1.4,stretchYFactor:2},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:1.2,sizeFactorGlobal:.5,rotationOffset:50,rotationLock:!0,stretchXFactor:1.4,stretchYFactor:2},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:1.2,sizeFactorGlobal:.6,rotationOffset:20,rotationLock:!0,stretchXFactor:.9,stretchYFactor:2},{assetID:"Orb_15",color:3372953,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,sizeFactor:.2,sizeFactorGlobal:.6},{assetID:"Orb_06",blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.25,sizeFactor:.51,rotationLock:!0,stretchXFactor:1.2,sourceDistanceFactor:.65},{assetID:"Orb_05",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:.51,rotationLock:!0,stretchXFactor:1.2,sourceDistanceFactor:.65},{assetID:"Iris_08",color:3372953,colorGlobalGroup:1,intensityFactor:.3,intensityFactorGlobal:.35,sizeFactor:.2,rotationOffset:60,sourceDistanceFactor:.55},{assetID:"Lens_09",color:3372953,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.25},{assetID:"Iris_01",color:3372953,colorGlobalGroup:1,intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:2.5,rotationLock:!0,sourceDistanceFactor:1.25}]},{presetID:"spotlight",presetName:"Spotlight",isPlus:!0,elements:[{assetID:"Caustic_02",blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.25,sizeFactor:.4,sizeFactorGlobal:.35,rotationOffset:85,rotationLock:!0,sourceDistanceFactor:-.08},{assetID:"Streak_02",color:16777215,colorGlobalGroup:1,intensityFactor:.3,sizeFactor:.6,sizeFactorGlobal:.35,stretchXFactor:5,stretchYFactor:.2},{assetID:"Glint_04",color:16777215,colorGlobalGroup:1,intensityFactor:.3,sizeFactor:.4,sizeFactorGlobal:.75,rotationOffset:20},{assetID:"Orb_16",color:16777215,colorGlobalGroup:1,intensityFactor:.3,sizeFactor:.5,sizeFactorGlobal:.75,rotationOffset:40,rotationLock:!0},{assetID:"Glow_09",color:16777215,colorGlobalGroup:1,blendMode:"add",intensityFactor:.25,sizeFactor:.7,sizeFactorGlobal:.8},{assetID:"Glow_01",color:16777215,colorGlobalGroup:1,blendMode:"add",intensityFactor:.5,sizeFactor:.1,sizeFactorGlobal:.8},{assetID:"Orb_10",blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.25,sizeFactor:.4,sizeFactorGlobal:.5},{assetID:"Caustic_02",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:.5,rotationOffset:85,rotationLock:!0,stretchXFactor:.75,sourceDistanceFactor:-.75},{assetID:"Caustic_02",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:.7,rotationOffset:-105,rotationLock:!0,stretchXFactor:.75,sourceDistanceFactor:1.1},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.07,rotationOffset:135,rotationLock:!0,sourceDistanceFactor:-.15,centerDistanceFactor:-.15},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.07,rotationOffset:135,rotationLock:!0,sourceDistanceFactor:.25,centerDistanceFactor:-.25},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.05,rotationLock:!0,sourceDistanceFactor:.25,centerDistanceFactor:.05},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.2,rotationLock:!0,sourceDistanceFactor:1.3},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.9,rotationLock:!0,sourceDistanceFactor:1},{assetID:"Orb_03",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.1,rotationLock:!0,sourceDistanceFactor:1.2},{assetID:"Orb_03",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.05,rotationLock:!0,sourceDistanceFactor:1.1,centerDistanceFactor:.05},{assetID:"Orb_03",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.25,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:-.85,centerDistanceFactor:.05},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.15,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.7,centerDistanceFactor:.05},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.15,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:-.55,centerDistanceFactor:.05},{assetID:"Orb_13",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.6,intensityFactorGlobal:.5,sizeFactor:.03,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:.3,centerDistanceFactor:-.05},{assetID:"Orb_13",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.1,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:1.35,centerDistanceFactor:-.05},{assetID:"Orb_13",color:5711050,colorGlobalGroup:2,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:-90,rotationLock:!0,sourceDistanceFactor:.8},{assetID:"Orb_13",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.3,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:1.25,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.2,rotationOffset:-92,rotationLock:!0,stretchYFactor:1.1,sourceDistanceFactor:.85,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:.45,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.5,sizeFactor:.15,rotationOffset:-92,rotationLock:!0,stretchYFactor:1.1,sourceDistanceFactor:.5,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.5,sizeFactor:.1,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:.35,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:-92,rotationLock:!0,centerDistanceFactor:.1},{assetID:"Orb_14",blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:1.9,rotationLock:!0,sourceDistanceFactor:.75},{assetID:"Caustic_16",color:5711050,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.4,rotationOffset:-101,rotationLock:!0,sourceDistanceFactor:1.64,centerDistanceFactor:-.05},{assetID:"Caustic_16",color:3363892,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.4,rotationOffset:-101,rotationLock:!0,sourceDistanceFactor:.6,centerDistanceFactor:-.05},{assetID:"Lens_09",colorGlobalGroup:4,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:1.1,sizeFactorGlobal:.5}]},{presetID:"performance",presetName:"Performance",isPlus:!0,elements:[{assetID:"Orb_01",color:12072548,blendMode:"add",intensityFactorGlobal:.5,sizeFactor:1.65},{assetID:"Orb_01",color:923038,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.55,sizeFactorGlobal:.5},{assetID:"Orb_10",blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.3,sizeFactorGlobal:.5},{assetID:"Orb_04",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.55,sizeFactorGlobal:.5,rotationLock:!0},{assetID:"Orb_09",blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.8,sizeFactorGlobal:.5},{assetID:"Streak_14",intensityFactor:.2,sizeFactor:.78,sizeFactorGlobal:.5,stretchXFactor:2.5},{assetID:"Streak_11",color:12072548,intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:1.7,sizeFactorGlobal:.25,rotationOffset:90,stretchYFactor:2.5},{assetID:"Glow_09",blendMode:"add",intensityFactorGlobal:.4,sizeFactor:.2,sizeFactorGlobal:.29,stretchXFactor:.7},{assetID:"Orb_01",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.15,sizeFactorGlobal:.5},{assetID:"Glow_08",color:12072548,blendMode:"add",intensityFactor:.4,sizeFactor:.7,sizeFactorGlobal:.3,rotationLock:!0},{assetID:"Streak_16",color:12072548,blendMode:"add",intensityFactorGlobal:.5,sizeFactorGlobal:.25,stretchXFactor:1.5},{assetID:"Streak_16",color:12072548,blendMode:"add",intensityFactorGlobal:.5,stretchXFactor:1.5,stretchYFactor:.25,sourceDistanceFactor:.98},{assetID:"Streak_16",color:12072548,blendMode:"add",intensityFactorGlobal:.5,stretchYFactor:1.25,sourceDistanceFactor:1},{assetID:"Streak_16",color:12072548,blendMode:"add",intensityFactorGlobal:.5,stretchXFactor:1.5,stretchYFactor:.25,sourceDistanceFactor:1.02},{assetID:"Streak_02",blendMode:"add",intensityFactorGlobal:.5,sizeFactor:1.4,sourceDistanceFactor:1},{assetID:"Streak_04",color:12072548,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:1.4,sourceDistanceFactor:.75},{assetID:"Streak_13",color:12072548,blendMode:"add",intensityFactorGlobal:.5,sizeFactor:.5,stretchXFactor:3.2,sourceDistanceFactor:.71},{assetID:"Circle_Gradient",color:3890493,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.1,sourceDistanceFactor:.7},{assetID:"Circle_Gradient",color:3890493,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.09,sourceDistanceFactor:.55},{assetID:"Circle_Gradient",color:3890493,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.08,sourceDistanceFactor:.4},{assetID:"Circle_Gradient",color:3890493,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.07,sourceDistanceFactor:.3},{assetID:"Circle_Gradient",color:4015509,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.05,sourceDistanceFactor:.47},{assetID:"Circle_Gradient",color:4015509,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.04,sourceDistanceFactor:.62},{assetID:"Lens_06",blendMode:"add",intensityFactor:.5,sizeFactor:.5}]},{presetID:"iris",presetName:"Iris",isPlus:!0,elements:[{assetID:"Orb_01",color:923038,blendMode:"add",intensityFactor:.3,sizeFactor:.55,sizeFactorGlobal:.5},{assetID:"Orb_10",blendMode:"add",intensityFactor:.4,sizeFactor:.3,sizeFactorGlobal:.5},{assetID:"Orb_04",blendMode:"add",intensityFactor:.5,sizeFactor:.55,sizeFactorGlobal:.5,rotationLock:!0},{assetID:"Orb_09",blendMode:"add",intensityFactor:.3,sizeFactor:.8,sizeFactorGlobal:.5},{assetID:"Streak_16",sizeFactorGlobal:.5,stretchXFactor:1.5},{assetID:"Streak_14",sizeFactor:.78,sizeFactorGlobal:.5},{assetID:"Glow_09",blendMode:"add",sizeFactor:.21,sizeFactorGlobal:.5},{assetID:"Streak_16",color:11099294,blendMode:"add",sizeFactor:.28,sizeFactorGlobal:.25,rotationOffset:90,centerDistanceFactor:.05},{assetID:"Streak_16",color:11099294,blendMode:"add",sizeFactor:.28,sizeFactorGlobal:.25,rotationOffset:90,stretchXFactor:1.25,centerDistanceFactor:.01},{assetID:"Streak_16",color:11099294,blendMode:"add",sizeFactor:.28,sizeFactorGlobal:.25,rotationOffset:90,stretchXFactor:1.5,centerDistanceFactor:-.01},{assetID:"Streak_16",color:11099294,blendMode:"add",sizeFactor:.28,sizeFactorGlobal:.25,rotationOffset:90,centerDistanceFactor:-.05},{assetID:"Orb_01",blendMode:"add",intensityFactor:.3,sizeFactor:.15,sizeFactorGlobal:.5},{assetID:"Caustic_07",blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.9,sizeFactorGlobal:.5,rotationLock:!0}]},{presetID:"nova",presetName:"Nova",isPlus:!0,elements:[{assetID:"Glow_01",color:16747374,colorGlobalGroup:1,intensityFactor:.5,sizeFactor:2.5,sizeFactorGlobal:.6,stretchYFactor:.4},{assetID:"Glint_08",color:16747374,blendMode:"add",intensityFactor:.5,sizeFactor:.3,sizeFactorGlobal:.4},{assetID:"Streak_11",color:16747374,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactorGlobal:.25,rotationOffset:-90,rotationLock:!0},{assetID:"Orb_04",color:16747374,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.7,sizeFactor:.27,rotationOffset:-90},{assetID:"Streak_11",color:12751103,colorGlobalGroup:2,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,stretchXFactor:2.5},{assetID:"Streak_09",color:12751103,colorGlobalGroup:2,blendMode:"add",intensityFactor:.71,sizeFactorGlobal:.35,stretchXFactor:2.5,sourceDistanceFactor:-.02},{assetID:"Streak_08",color:12751103,colorGlobalGroup:2,blendMode:"add",intensityFactorGlobal:.5,sizeFactorGlobal:.15,stretchXFactor:2.3,sourceDistanceFactor:-.1},{assetID:"Streak_04",color:12751103,colorGlobalGroup:2,intensityFactorGlobal:.5,sizeFactorGlobal:.25,sourceDistanceFactor:.05},{assetID:"Orb_04",color:12751103,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:2,rotationLock:!0,sourceDistanceFactor:.95}]},{presetID:"elysium",presetName:"Elysium",isPlus:!0,elements:[{assetID:"Glow_09",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.4,sizeFactor:1.6,sizeFactorGlobal:.75},{assetID:"Caustic_09",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,sizeFactor:.2,sizeFactorGlobal:.25,rotationOffset:90,rotationLock:!0,stretchYFactor:2},{assetID:"Caustic_09",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,sizeFactor:.2,sizeFactorGlobal:.25,rotationOffset:-90,rotationLock:!0,stretchYFactor:2},{assetID:"Glow_03",color:16742667,colorGlobalGroup:1,blendMode:"add",sizeFactor:.5,sizeFactorGlobal:.6,stretchXFactor:2.5},{assetID:"Streak_13",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,sizeFactor:1.25,sizeFactorGlobal:.5,stretchXFactor:1.5},{assetID:"Streak_02",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.25,sizeFactor:1.25,sizeFactorGlobal:.25,rotationOffset:180,sourceDistanceFactor:.05},{assetID:"Streak_02",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.25,sizeFactor:1.25,sizeFactorGlobal:.25,sourceDistanceFactor:-.05},{assetID:"Streak_05",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:3,sizeFactorGlobal:.5,rotationOffset:180,rotationLock:!0},{assetID:"Streak_05",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:3,sizeFactorGlobal:.5,rotationOffset:120,rotationLock:!0},{assetID:"Streak_05",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:3,sizeFactorGlobal:.5,rotationOffset:-120,rotationLock:!0},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:.64,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.6},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.1},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.03,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.13},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.2},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.04,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.31},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.06,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.38},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.04,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.49},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.02,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.53},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.58},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.8,intensityFactorGlobal:.5,sizeFactor:.01,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.9},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.02,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.87}]},{presetID:"headlight",presetName:"Headlight",isPlus:!0,elements:[{assetID:"Glow_04",color:16579836,colorGlobalGroup:1,blendMode:"add",intensityFactor:.23,sizeFactor:.64,sizeFactorGlobal:.1,rotationOffset:41,rotationLock:!0,sourceDistanceFactor:-.02},{assetID:"Glow_04",color:16579836,colorGlobalGroup:1,blendMode:"add",intensityFactor:.52,sizeFactor:.54,sizeFactorGlobal:.45,rotationOffset:40,rotationLock:!0},{assetID:"Glow_04",color:16579836,colorGlobalGroup:1,blendMode:"add",intensityFactor:.46,sizeFactor:.37,sizeFactorGlobal:.7,rotationOffset:-35,rotationLock:!0},{assetID:"Glow_06",color:14345441,colorGlobalGroup:1,blendMode:"add",intensityFactor:.71,intensityFactorGlobal:.49,sizeFactor:.25,sizeFactorGlobal:.3,rotationOffset:-84,rotationLock:!0},{assetID:"Glow_08",color:16579836,colorGlobalGroup:1,intensityFactor:.17,sizeFactor:.46,sizeFactorGlobal:.64},{assetID:"Glow_10",color:16579836,colorGlobalGroup:1,intensityFactor:.66,sizeFactor:.29,sizeFactorGlobal:.32},{assetID:"Glow_10",color:16579836,colorGlobalGroup:1,blendMode:"add",intensityFactor:.35,sizeFactor:.1,sizeFactorGlobal:.32},{assetID:"Orb_10",intensityFactor:.13,intensityFactorGlobal:.26,sizeFactor:.47,sizeFactorGlobal:.65},{assetID:"Orb_02",color:15576700,colorGlobalGroup:2,intensityFactor:.28,sizeFactor:.25,sizeFactorGlobal:.69,sourceDistanceFactor:.12,centerDistanceFactor:-.02},{assetID:"Orb_02",color:13869175,colorGlobalGroup:2,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.3,sizeFactor:.35,sizeFactorGlobal:.1,sourceDistanceFactor:1.1,centerDistanceFactor:-.04},{assetID:"Caustic_07",color:16763554,colorGlobalGroup:2,intensityFactor:.18,intensityFactorGlobal:.2,sizeFactor:.09,sizeFactorGlobal:.68,sourceDistanceFactor:.13,centerDistanceFactor:-.1},{assetID:"Caustic_07",color:16169355,colorGlobalGroup:2,intensityFactor:.17,sizeFactor:.08,sizeFactorGlobal:.74,sourceDistanceFactor:.11,centerDistanceFactor:-.11},{assetID:"Orb_16",color:1265627,colorGlobalGroup:3,intensityFactor:.85,intensityFactorGlobal:.25,sizeFactor:.15,rotationOffset:-131,stretchXFactor:.98,sourceDistanceFactor:.55},{assetID:"Orb_16",color:960731,colorGlobalGroup:3,blendMode:"add",intensityFactor:.96,intensityFactorGlobal:.35,sizeFactor:.15,rotationOffset:-131,stretchXFactor:.98,sourceDistanceFactor:.67,centerDistanceFactor:-.04},{assetID:"Lens_15",color:10665727,colorGlobalGroup:4,intensityFactor:.35,intensityFactorGlobal:.2,sizeFactor:.85,sizeFactorGlobal:.4}]},{presetID:"glint",presetName:"Glint",isPlus:!0,elements:[{assetID:"Streak_13",color:11184895,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.2,sizeFactorGlobal:.8,rotationOffset:30,rotationLock:!0,stretchXFactor:2,stretchYFactor:.6},{assetID:"Streak_13",color:11184895,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.2,sizeFactorGlobal:.8,rotationOffset:-30,rotationLock:!0,stretchXFactor:2,stretchYFactor:.6},{assetID:"Streak_13",color:11184895,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.2,sizeFactorGlobal:.8,rotationOffset:90,rotationLock:!0,stretchXFactor:2,stretchYFactor:.6},{assetID:"Orb_15",color:11184895,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:.4,sizeFactorGlobal:.8},{assetID:"Glow_09",color:11184895,colorGlobalGroup:1,blendMode:"add",intensityFactor:.5,sizeFactor:.2,sizeFactorGlobal:.8},{assetID:"Streak_07",color:11184895,colorGlobalGroup:1,intensityFactor:.8,sizeFactor:.3,sizeFactorGlobal:.8,rotationOffset:30,rotationLock:!0},{assetID:"Streak_07",color:11184895,colorGlobalGroup:1,intensityFactor:.8,sizeFactor:.3,sizeFactorGlobal:.8,rotationOffset:-30,rotationLock:!0},{assetID:"Streak_07",color:11184895,colorGlobalGroup:1,intensityFactor:.8,sizeFactor:.3,sizeFactorGlobal:.8,rotationOffset:90,rotationLock:!0}]},{presetID:"xenon",presetName:"Xenon",isPlus:!0,elements:[{assetID:"Orb_15",color:499229,colorGlobalGroup:1,blendMode:"add",sizeFactor:.05,sizeFactorGlobal:.7},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationLock:!0,stretchYFactor:.2},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationOffset:72,rotationLock:!0,stretchYFactor:.2},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationOffset:144,rotationLock:!0,stretchYFactor:.2},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationOffset:-144,rotationLock:!0,stretchYFactor:.2},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationOffset:-72,rotationLock:!0,stretchYFactor:.2},{assetID:"Orb_15",color:499229,colorGlobalGroup:1,intensityFactor:.5,sizeFactor:.4},{assetID:"Glow_09",color:499229,colorGlobalGroup:1,sizeFactor:.29,sizeFactorGlobal:.4,rotationLock:!0},{assetID:"Orb_01",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactor:.5,sizeFactor:2,sizeFactorGlobal:.1},{assetID:"Streak_03",color:499229,colorGlobalGroup:1,intensityFactor:.5,sizeFactorGlobal:.6,stretchYFactor:4},{assetID:"Caustic_03",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1},{assetID:"Orb_16",color:499229,colorGlobalGroup:1,intensityFactor:.8,intensityFactorGlobal:.25,rotationLock:!0,sourceDistanceFactor:1},{assetID:"Iris_07",color:499229,colorGlobalGroup:1,intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,sourceDistanceFactor:.1},{assetID:"Iris_07",color:499229,colorGlobalGroup:1,intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.07,sourceDistanceFactor:.2},{assetID:"Iris_07",color:499229,colorGlobalGroup:1,intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.1,sourceDistanceFactor:.3},{assetID:"Iris_07",color:499229,colorGlobalGroup:1,intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:.25,sourceDistanceFactor:.6},{assetID:"Lens_15",color:499229,intensityFactor:.6,sizeFactor:.7,sizeFactorGlobal:.25}]},{presetID:"laser",presetName:"Laser",isPlus:!0,elements:[{assetID:"Streak_16",color:16729896,colorGlobalGroup:1,blendMode:"add",sizeFactor:2,sizeFactorGlobal:.75,stretchYFactor:.29,sourceDistanceFactor:-.03},{assetID:"Streak_16",color:16729896,colorGlobalGroup:1,blendMode:"add",sizeFactor:2,sizeFactorGlobal:.75,stretchYFactor:.29,sourceDistanceFactor:.03},{assetID:"Glow_10",color:16729896,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.3,sizeFactorGlobal:.75,stretchXFactor:2},{assetID:"Streak_01",color:16729896,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactorGlobal:.5,stretchXFactor:2},{assetID:"Orb_15",color:16729896,colorGlobalGroup:1,sizeFactor:.8,sizeFactorGlobal:.35,stretchXFactor:1.5,stretchYFactor:.2},{assetID:"Glow_04",color:16729896,colorGlobalGroup:1,sizeFactor:.3,sizeFactorGlobal:.5,stretchXFactor:1.5},{assetID:"Streak_09",color:16729896,colorGlobalGroup:1,intensityFactorGlobal:.5,sizeFactor:.4,sizeFactorGlobal:.5,stretchXFactor:2.5,stretchYFactor:.35,sourceDistanceFactor:.03},{assetID:"Streak_09",color:16729896,colorGlobalGroup:1,intensityFactorGlobal:.5,sizeFactor:.4,sizeFactorGlobal:.5,rotationOffset:180,stretchXFactor:2.5,stretchYFactor:.35,sourceDistanceFactor:-.03}]}]}]},Gi.prototype.initMenuData=function(){for(var e=[],t=0;t<this.presetData.length;t++)for(var i=this.presetData[t],r=0;r<i.presets.length;r++){for(var a=i.presets[r],n={id:"lens_flare_"+a.presetID,name:a.presetName,isPlus:a.isPlus,thumb:"tba",effectID:"lens_flare",usePaint:!1,params:[{type:"static",name:"presetID",defaultValue:a.presetID}]},o=[],s=0;s<a.elements.length;s++){var l=a.elements[s];if(l.hasOwnProperty("colorGlobalGroup")){var h=l.colorGlobalGroup;h>0&&-1==o.indexOf(h)&&o.push(h)}}if(o.length){o.sort(function(e,t){return e-t});for(var c=0;c<o.length;c++)n.params.push({type:"color_item",name:"color_value_"+o[c],defaultValue:-1})}e.push(n)}this.menuData=[{id:"lens_flares",name:"LENS FLARE",graphic:"tba",presets:e}];for(var u=0;u<this.menuData.length;u++)for(var d=this.menuData[u],m=0;m<d.presets.length;m++){var p=d.presets[m];BFN.toolViewstates[d.id+"_"+p.id]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE}},Gi.prototype.initAssets=function(){this.assets={},this.assetIDs=[];for(var e=0;e<this.assetData.length;e++)for(var t=this.assetData[e],i=0;i<t.assets.length;i++){var r=t.assets[i],a=new BFN.LensFlareAssetVO;a.categoryID=t.categoryID,a.assetID=r.assetID,a.static=r.static,a.imageURL=this.assetPath+a.categoryID+"/images/"+a.assetID+".jpg",a.thumbURL=this.assetPath+a.categoryID+"/thumbs/"+a.assetID+".jpg",this.assets[a.assetID]=a,this.assetIDs.push(a.assetID)}},BFN.lensFlarePresetMap={},Gi.prototype.initPresets=function(){this.presets={},this.presetIDs=[];for(var e=0;e<this.presetData.length;e++)for(var t=this.presetData[e],i=0;i<t.presets.length;i++){var r=t.presets[i],a=new BFN.LensFlarePresetVO;a.presetID=r.presetID,a.presetName=r.presetName,a.isPlus=r.isPlus;for(var n=0;n<r.elements.length;n++){var o=r.elements[n],s=new BFN.LensFlareElementVO;for(var l in o)s.setProperty(l,o[l]);a.elementVOs.push(s)}this.presets[a.presetID]=a,this.presetIDs.push(a.presetID),BFN.lensFlarePresetMap["lens_flares_lens_flare_"+a.presetID]=a.presetID}},BFN.SingletonQueue.add(function(){BFN.LensFlareData=new Gi});class Hi{constructor(){this.init()}init(){BFN.OverlaysData={}}load(e){var t="overlays-data".concat(BFN.assetsDataVersions.overlays_data,".json"),i="".concat(BFN.overlaysUrl).concat(t);BFN.IndexedDB.getFile("overlays",BFN.folderNames.overlays+t,i).then(t=>{if(!t.hasOwnProperty("overlays-data"))return BeFunky.logError("Overlays data missing 'overlays-data' property",t);t["overlays-data"].forEach(e=>{BFN.OverlaysData[e.id]=e}),e&&e(!0)}).catch(e=>{BeFunky.logError("Unable to get overlays data from IndexedDB or server")})}}BFN.SingletonQueue.add(()=>{BFN.OverlaysDataLoader=new Hi});class zi{constructor(){this.init()}init(){BFN.PatternsData={}}load(e){var t="patterns-data".concat(BFN.assetsDataVersions.patterns_data,".json"),i="".concat(BFN.assetsURL,"datas/").concat(t);BFN.IndexedDB.getFile("patterns",BFN.folderNames.patterns+t,i).then(t=>{if(!t.hasOwnProperty("patterns-data"))return BeFunky.logError("Patterns data missing 'patterns-data' property",t);t["patterns-data"].forEach(e=>{BFN.PatternsData[e.id]=e}),e&&e(!0)}).catch(e=>{BeFunky.logError("Unable to get patterns data from IndexedDB or server",e||"")})}}BFN.SingletonQueue.add(()=>{BFN.PatternsDataLoader=new zi}),BFN.ProTipData={protip_cutout:["guide_cutout_protip_2"],protip_funky_focus:["guide_funkyfocus_protip_1","guide_funkyfocus_protip_2"],protip_vignette:["guide_funkyfocus_protip_1","guide_funkyfocus_protip_2"],protip_blemish_fix:["guide_blemish_fix_protip_1"],protip_clone:["guide_clone_protip"],protip_reshape:["guide_liquify_protip_1"]};class Xi extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("CollageMakerTemplateData Init"),this.initDefaultValues()}initDefaultValues(){this.isDataLoaded=!1,this.isSetupTemplates=!1,this.templateCategories=[]}loadTemplateData(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isDataLoaded)e&&e();else{t&&BeFunky.showLoadScreen();var i="collage_layouts_data_v1.json",r="".concat(BFN.assetsURL,"datas/").concat(i);BFN.IndexedDB.getFile("layouts",i,r).then(i=>{t&&BeFunky.hideLoadScreen(),this.isDataLoaded||(this.isDataLoaded=!0,this.templateCategories=i,this.setupTemplates(),e&&e(),[...document.querySelectorAll("#collage_layouts_category_menu button")].forEach(e=>e.disabled=!1))}).catch(e=>{t&&BeFunky.hideLoadScreen(),BeFunky.throwError("Unable to get collage layout data from IndexedDB or server",e||"")})}}setupTemplates(){if(!this.isSetupTemplates&&this.isDataLoaded){this.isSetupTemplates=!0,this._templateCategoryVOs=[];var e=["big_rectangle_3_square_right","grid17","grid18","grid19","3x3_square","grid22","grid28","grid37","big_rectangle_6_square_all","big_rectangle_6_square_left_bottom","overlay1","big_photo_15","big_photo_17","big_photo_24","fb7","fb16","pin2","pin4","pin8"],t=new BFN.TemplateCategoryVO;t.id="featured",t.name="Featured",t.graphic="collage_template_featured",this._templateCategoryVOs.push(t),this.templateCategories.forEach(i=>{var r=new BFN.TemplateCategoryVO;r.id=i.id,r.name=i.name,r.graphic=i.graphic,this._templateCategoryVOs.push(r),i.presets.forEach(i=>{var a=new BFN.TemplateVO;a.name=i.name,a.categoryID=r.id,a.isPlus=i.hasOwnProperty("isPlus")&&1==i.isPlus,a.preset=i,r.templateVOs.push(a),e.includes(a.name)&&t.templateVOs.push(a)})});var i=[].concat(...this._templateCategoryVOs.slice(1).map(e=>{return e.templateVOs}));i.forEach((e,t)=>{var i=t%3*150,r=150*Math.floor(t/3);e.spritePosition="-".concat(.5*i,"px -").concat(.5*r,"px")})}}get templateCategoryVOs(){return this._templateCategoryVOs}}BFN.SingletonQueue.add(function(){BFN.CollageMakerTemplateData=new Xi}),BFN.FontOffsetVectorsString='\n\n{\n\t"Abril Fatface": {\n\t\t"distance": 17.11724276862369,\n\t\t"direction": 1.687905071361761\n\t},\n\t"Alegreya": {\n\t\t"distance": 12.165525060596439,\n\t\t"direction": 1.7359450042095235\n\t},\n\t"Alegreya Sans": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Amaranth": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Amatic SC": {\n\t\t"distance": 13.038404810405298,\n\t\t"direction": 1.6475682180646747\n\t},\n\t"Amble": {\n\t\t"distance": 13.152946437965905,\n\t\t"direction": -1.7234456551901618\n\t},\n\t"Anonymous Pro": {\n\t\t"distance": 8.246211251235321,\n\t\t"direction": -1.8157749899217608\n\t},\n\t"Architects Daughter": {\n\t\t"distance": 9.055385138137417,\n\t\t"direction": -1.6814535479687924\n\t},\n\t"Arizonia": {\n\t\t"distance": 2,\n\t\t"direction": 3.141592653589793\n\t},\n\t"The Art of Illuminating": {\n\t\t"distance": 17.11724276862369,\n\t\t"direction": -1.687905071361761\n\t},\n\t"Arvo": {\n\t\t"distance": 13.152946437965905,\n\t\t"direction": -1.7234456551901618\n\t},\n\t"Bear and Loupe": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Bebas Neue": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Bellota": {\n\t\t"distance": 2.23606797749979,\n\t\t"direction": -2.677945044588987\n\t},\n\t"Berkshire Swash": {\n\t\t"distance": 8.246211251235321,\n\t\t"direction": 1.8157749899217608\n\t},\n\t"Boogaloo": {\n\t\t"distance": 5.385164807134504,\n\t\t"direction": 1.9513027039072617\n\t},\n\t"Bookman Old Style": {\n\t\t"distance": 17.11724276862369,\n\t\t"direction": -1.687905071361761\n\t},\n\t"Bowlby One": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": 1.7126933813990606\n\t},\n\t"Brush Script MT": {\n\t\t"distance": 29.017236257093817,\n\t\t"direction": -1.6052654277944047\n\t},\n\t"Cabin": {\n\t\t"distance": 8.06225774829855,\n\t\t"direction": 1.6951513213416582\n\t},\n\t"Capture It": {\n\t\t"distance": 17.26267650163207,\n\t\t"direction": -1.7454685258031364\n\t},\n\t"Carbon Type": {\n\t\t"distance": 17.029386365926403,\n\t\t"direction": -1.6295521495106193\n\t},\n\t"Carrington": {\n\t\t"distance": 3.605551275463989,\n\t\t"direction": -2.1587989303424644\n\t},\n\t"Caviar dreams": {\n\t\t"distance": 12.165525060596439,\n\t\t"direction": -1.7359450042095235\n\t},\n\t"ChunkFive": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Claire Hand": {\n\t\t"distance": 19.1049731745428,\n\t\t"direction": -1.6756732655251305\n\t},\n\t"Comic Sans MS": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Cookie": {\n\t\t"distance": 12.041594578792296,\n\t\t"direction": -1.653937558683338\n\t},\n\t"Crass Roots": {\n\t\t"distance": 3.605551275463989,\n\t\t"direction": -2.1587989303424644\n\t},\n\t"Dancing Script": {\n\t\t"distance": 19,\n\t\t"direction": -1.5707963267948966\n\t},\n\t"Deutsch Gothic": {\n\t\t"distance": 11.180339887498949,\n\t\t"direction": -1.750649826587375\n\t},\n\t"Edo": {\n\t\t"distance": 17.11724276862369,\n\t\t"direction": -1.687905071361761\n\t},\n\t"Eutemia I": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"Exo": {\n\t\t"distance": 9.055385138137417,\n\t\t"direction": -1.6814535479687924\n\t},\n\t"Forque": {\n\t\t"distance": 19.1049731745428,\n\t\t"direction": -1.6756732655251305\n\t},\n\t"Free Universal": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Frente H1": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Georgia": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Good Foot": {\n\t\t"distance": 2.23606797749979,\n\t\t"direction": 2.677945044588987\n\t},\n\t"Gothic Ultra": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Gputeks": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Grand Hotel": {\n\t\t"distance": 5.385164807134504,\n\t\t"direction": 1.9513027039072617\n\t},\n\t"Great Vibes": {\n\t\t"distance": 4.47213595499958,\n\t\t"direction": -2.0344439357957027\n\t},\n\t"Handserif": {\n\t\t"distance": 17.11724276862369,\n\t\t"direction": -1.687905071361761\n\t},\n\t"Harting": {\n\t\t"distance": 12.165525060596439,\n\t\t"direction": -1.7359450042095235\n\t},\n\t"Helsinki": {\n\t\t"distance": 17.029386365926403,\n\t\t"direction": -1.6295521495106193\n\t},\n\t"Henry Morgan Hand": {\n\t\t"distance": 2.23606797749979,\n\t\t"direction": -2.677945044588987\n\t},\n\t"Holitter Gothic": {\n\t\t"distance": 16.0312195418814,\n\t\t"direction": -1.633215136790854\n\t},\n\t"Hominis": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"HVD Comic Serif Pro": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Idolwild": {\n\t\t"distance": 2.8284271247461903,\n\t\t"direction": -2.356194490192345\n\t},\n\t"Inkcalig": {\n\t\t"distance": 17.029386365926403,\n\t\t"direction": -1.6295521495106193\n\t},\n\t"Itsadzoke": {\n\t\t"distance": 4.123105625617661,\n\t\t"direction": -1.8157749899217608\n\t},\n\t"Josefin Slab": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Karla": {\n\t\t"distance": 2.8284271247461903,\n\t\t"direction": 2.356194490192345\n\t},\n\t"Kawoszeh": {\n\t\t"distance": 16.0312195418814,\n\t\t"direction": -1.633215136790854\n\t},\n\t"Kingthings Trypewriter": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"Komika Axis": {\n\t\t"distance": 2.8284271247461903,\n\t\t"direction": -2.356194490192345\n\t},\n\t"La Belle Aurore": {\n\t\t"distance": 20.09975124224178,\n\t\t"direction": -1.6704649792860586\n\t},\n\t"Langdon": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Lato": {\n\t\t"distance": 9.219544457292887,\n\t\t"direction": -1.7894652726688387\n\t},\n\t"League Gothic": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Leckerli One": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Lobster Two": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": 1.7681918866447774\n\t},\n\t"Londrina Outline": {\n\t\t"distance": 15,\n\t\t"direction": -1.5707963267948966\n\t},\n\t"Londrina Shadow": {\n\t\t"distance": 16.0312195418814,\n\t\t"direction": -1.633215136790854\n\t},\n\t"Londrina Sketch": {\n\t\t"distance": 16.0312195418814,\n\t\t"direction": -1.633215136790854\n\t},\n\t"Londrina Solid": {\n\t\t"distance": 17.029386365926403,\n\t\t"direction": -1.6295521495106193\n\t},\n\t"Luckiest Guy": {\n\t\t"distance": 19.1049731745428,\n\t\t"direction": -1.6756732655251305\n\t},\n\t"Maiden Orange": {\n\t\t"distance": 20.09975124224178,\n\t\t"direction": -1.6704649792860586\n\t},\n\t"Mathlete Bulky": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Merriweather": {\n\t\t"distance": 9.219544457292887,\n\t\t"direction": 1.7894652726688387\n\t},\n\t"Miama": {\n\t\t"distance": 13.038404810405298,\n\t\t"direction": -1.6475682180646747\n\t},\n\t"Montserrat": {\n\t\t"distance": 8.246211251235321,\n\t\t"direction": 1.8157749899217608\n\t},\n\t"Myriad Pro": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"My Underwood": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Niconne": {\n\t\t"distance": 4.47213595499958,\n\t\t"direction": 2.0344439357957027\n\t},\n\t"Norwester": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Odstemplik": {\n\t\t"distance": 19.1049731745428,\n\t\t"direction": -1.6756732655251305\n\t},\n\t"Okolaks": {\n\t\t"distance": 11.180339887498949,\n\t\t"direction": -1.750649826587375\n\t},\n\t"Old Standard TT": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Open Sans": {\n\t\t"distance": 12.165525060596439,\n\t\t"direction": -1.7359450042095235\n\t},\n\t"Ostrich Sans": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Oswald": {\n\t\t"distance": 19.4164878389476,\n\t\t"direction": 1.7782925532300993\n\t},\n\t"Overlock": {\n\t\t"distance": 8.246211251235321,\n\t\t"direction": 1.8157749899217608\n\t},\n\t"Pacifico": {\n\t\t"distance": 50.00999900019995,\n\t\t"direction": 1.5907936607680473\n\t},\n\t"Palitoon": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Pix Antiqua": {\n\t\t"distance": 8.246211251235321,\n\t\t"direction": -1.8157749899217608\n\t},\n\t"Playfair Display": {\n\t\t"distance": 19.1049731745428,\n\t\t"direction": 1.6756732655251305\n\t},\n\t"Quicksand": {\n\t\t"distance": 5.385164807134504,\n\t\t"direction": 1.1902899496825317\n\t},\n\t"Raleway": {\n\t\t"distance": 5.385164807134504,\n\t\t"direction": 1.9513027039072617\n\t},\n\t"Roboto": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Roboto Slab": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": 1.6951513213416582\n\t},\n\t"Rock Salt": {\n\t\t"distance": 9.219544457292887,\n\t\t"direction": -1.7894652726688387\n\t},\n\t"Sacramento": {\n\t\t"distance": 4.47213595499958,\n\t\t"direction": 2.0344439357957027\n\t},\n\t"Sigmar One": {\n\t\t"distance": 28.071337695236398,\n\t\t"direction": 1.642103791580187\n\t},\n\t"Silkscreen": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Sofia": {\n\t\t"distance": 24.08318915758459,\n\t\t"direction": 1.653937558683338\n\t},\n\t"Spicy Rice": {\n\t\t"distance": 12.165525060596439,\n\t\t"direction": 1.7359450042095235\n\t},\n\t"Teen Light": {\n\t\t"distance": 12.041594578792296,\n\t\t"direction": -1.653937558683338\n\t},\n\t"Teen": {\n\t\t"distance": 12.165525060596439,\n\t\t"direction": -1.7359450042095235\n\t},\n\t"Temporarium": {\n\t\t"distance": 13.152946437965905,\n\t\t"direction": -1.7234456551901618\n\t},\n\t"Times New Roman": {\n\t\t"distance": 21.095023109728988,\n\t\t"direction": -1.665748033137653\n\t},\n\t"Trebuchet MS": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"Ubuntu": {\n\t\t"distance": 12.041594578792296,\n\t\t"direction": -1.653937558683338\n\t},\n\t"Varela Round": {\n\t\t"distance": 5.385164807134504,\n\t\t"direction": 2.761086276477428\n\t},\n\t"Vavont": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Veggieburger": {\n\t\t"distance": 7.280109889280518,\n\t\t"direction": -1.849095985800008\n\t},\n\t"Verdana": {\n\t\t"distance": 12.165525060596439,\n\t\t"direction": -1.7359450042095235\n\t},\n\t"Vollkorn": {\n\t\t"distance": 19.1049731745428,\n\t\t"direction": -1.6756732655251305\n\t},\n\t"Yellowtail": {\n\t\t"distance": 7.0710678118654755,\n\t\t"direction": 1.7126933813990606\n\t},\n\t"Adobe Caslon Pro": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"Adobe Devanagari": {\n\t\t"distance": 18.24828759089466,\n\t\t"direction": -1.7359450042095235\n\t},\n\t"Adobe Garamond Pro": {\n\t\t"distance": 17.11724276862369,\n\t\t"direction": -1.687905071361761\n\t},\n\t"Adobe Gurmukhi": {\n\t\t"distance": 15.297058540778355,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Al Nile": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"American Typewriter": {\n\t\t"distance": 22.090722034374522,\n\t\t"direction": -1.661456213995642\n\t},\n\t"Andale Mono": {\n\t\t"distance": 20.09975124224178,\n\t\t"direction": -1.6704649792860586\n\t},\n\t"Apple Chancery": {\n\t\t"distance": 11.180339887498949,\n\t\t"direction": -1.750649826587375\n\t},\n\t"Apple Color Emoji": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Apple Symbols": {\n\t\t"distance": 23.08679276123039,\n\t\t"direction": -1.6575346654708818\n\t},\n\t"Arial": {\n\t\t"distance": 18.027756377319946,\n\t\t"direction": -1.6262948320406136\n\t},\n\t"Arial Black": {\n\t\t"distance": 19.1049731745428,\n\t\t"direction": -1.6756732655251305\n\t},\n\t"Arial Hebrew": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Arial Hebrew Scholar": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Arial Narrow": {\n\t\t"distance": 18.027756377319946,\n\t\t"direction": -1.6262948320406136\n\t},\n\t"Arial Rounded MT Bold": {\n\t\t"distance": 18.110770276274835,\n\t\t"direction": -1.6814535479687924\n\t},\n\t"Arial Unicode MS": {\n\t\t"distance": 18.027756377319946,\n\t\t"direction": -1.6262948320406136\n\t},\n\t"Ayuthaya": {\n\t\t"distance": 17.11724276862369,\n\t\t"direction": 1.687905071361761\n\t},\n\t"Bangla MN": {\n\t\t"distance": 4.47213595499958,\n\t\t"direction": -2.0344439357957027\n\t},\n\t"Bangla Sangam MN": {\n\t\t"distance": 19.1049731745428,\n\t\t"direction": -1.6756732655251305\n\t},\n\t"Baskerville": {\n\t\t"distance": 3,\n\t\t"direction": 3.141592653589793\n\t},\n\t"Birch Std": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"Blackoak Std": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"Bodoni Ornaments": {\n\t\t"distance": 10.44030650891055,\n\t\t"direction": -1.8622531212727638\n\t},\n\t"Chalkboard": {\n\t\t"distance": 7.280109889280518,\n\t\t"direction": 1.849095985800008\n\t},\n\t"Chalkduster": {\n\t\t"distance": 8.246211251235321,\n\t\t"direction": 1.8157749899217608\n\t},\n\t"Chaparral Pro": {\n\t\t"distance": 17.11724276862369,\n\t\t"direction": -1.687905071361761\n\t},\n\t"Cochin": {\n\t\t"distance": 19.1049731745428,\n\t\t"direction": -1.6756732655251305\n\t},\n\t"Copperplate": {\n\t\t"distance": 13.152946437965905,\n\t\t"direction": -1.7234456551901618\n\t},\n\t"Corsiva Hebrew": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Courier New": {\n\t\t"distance": 28.071337695236398,\n\t\t"direction": -1.642103791580187\n\t},\n\t"Devanagari MT": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Devanagari Sangam MN": {\n\t\t"distance": 8.06225774829855,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"Didot": {\n\t\t"distance": 3.605551275463989,\n\t\t"direction": 2.1587989303424644\n\t},\n\t"Euphemia UCAS": {\n\t\t"distance": 13.152946437965905,\n\t\t"direction": -1.7234456551901618\n\t},\n\t"Geneva": {\n\t\t"distance": 11.180339887498949,\n\t\t"direction": -1.750649826587375\n\t},\n\t"Gill Sans": {\n\t\t"distance": 21.095023109728988,\n\t\t"direction": -1.665748033137653\n\t},\n\t"Gujarati MT": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Gujarati Sangam MN": {\n\t\t"distance": 24.08318915758459,\n\t\t"direction": 1.653937558683338\n\t},\n\t"Gurmukhi MN": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Gurmukhi MT": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Gurmukhi Sangam MN": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Helvetica": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"Helvetica Neue": {\n\t\t"distance": 6.324555320336759,\n\t\t"direction": 1.892546881191539\n\t},\n\t"Herculanum": {\n\t\t"distance": 2.8284271247461903,\n\t\t"direction": 2.356194490192345\n\t},\n\t"Hoefler Text": {\n\t\t"distance": 4.47213595499958,\n\t\t"direction": 2.0344439357957027\n\t},\n\t"Impact": {\n\t\t"distance": 12.165525060596439,\n\t\t"direction": -1.7359450042095235\n\t},\n\t"InaiMathi": {\n\t\t"distance": 23.08679276123039,\n\t\t"direction": -1.6575346654708818\n\t},\n\t"Kannada MN": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Kannada Sangam MN": {\n\t\t"distance": 22.090722034374522,\n\t\t"direction": -1.661456213995642\n\t},\n\t"Khmer MN": {\n\t\t"distance": 20.09975124224178,\n\t\t"direction": -1.6704649792860586\n\t},\n\t"Khmer Sangam MN": {\n\t\t"distance": 22.02271554554524,\n\t\t"direction": 1.6162196062164738\n\t},\n\t"Kohinoor Bangla": {\n\t\t"distance": 15.033296378372908,\n\t\t"direction": 1.6373644905707205\n\t},\n\t"Kohinoor Telugu": {\n\t\t"distance": 15.033296378372908,\n\t\t"direction": 1.6373644905707205\n\t},\n\t"Krungthep": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": 1.7681918866447774\n\t},\n\t"Lao MN": {\n\t\t"distance": 8.246211251235321,\n\t\t"direction": -1.8157749899217608\n\t},\n\t"Lao Sangam MN": {\n\t\t"distance": 15.033296378372908,\n\t\t"direction": -1.6373644905707205\n\t},\n\t"Lithos Pro": {\n\t\t"distance": 17.11724276862369,\n\t\t"direction": -1.687905071361761\n\t},\n\t"Lucida Grande": {\n\t\t"distance": 11.045361017187261,\n\t\t"direction": -1.661456213995642\n\t},\n\t"Luminari": {\n\t\t"distance": 8.246211251235321,\n\t\t"direction": 1.8157749899217608\n\t},\n\t"Malayalam MN": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Malayalam Sangam MN": {\n\t\t"distance": 9.219544457292887,\n\t\t"direction": -1.7894652726688387\n\t},\n\t"Microsoft Sans Serif": {\n\t\t"distance": 18.027756377319946,\n\t\t"direction": -1.6262948320406136\n\t},\n\t"Minion Pro": {\n\t\t"distance": 17.26267650163207,\n\t\t"direction": -1.7454685258031364\n\t},\n\t"Mshtakan": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Myanmar MN": {\n\t\t"distance": 5.385164807134504,\n\t\t"direction": -1.9513027039072617\n\t},\n\t"Myanmar Sangam MN": {\n\t\t"distance": 15.033296378372908,\n\t\t"direction": -1.6373644905707205\n\t},\n\t"Myriad Arabic": {\n\t\t"distance": 23.08679276123039,\n\t\t"direction": -1.6575346654708818\n\t},\n\t"Myriad Hebrew": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"New Peninim MT": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"OCR A Std": {\n\t\t"distance": 13.152946437965905,\n\t\t"direction": -1.7234456551901618\n\t},\n\t"Oriya MN": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Oriya Sangam MN": {\n\t\t"distance": 10.198039027185569,\n\t\t"direction": -1.7681918866447774\n\t},\n\t"Palatino": {\n\t\t"distance": 8.246211251235321,\n\t\t"direction": -1.8157749899217608\n\t},\n\t"Papyrus": {\n\t\t"distance": 3.605551275463989,\n\t\t"direction": 2.1587989303424644\n\t},\n\t"Plantagenet Cherokee": {\n\t\t"distance": 21.095023109728988,\n\t\t"direction": -1.665748033137653\n\t},\n\t"PT Mono": {\n\t\t"distance": 13.152946437965905,\n\t\t"direction": -1.7234456551901618\n\t},\n\t"PT Sans": {\n\t\t"distance": 15.033296378372908,\n\t\t"direction": -1.6373644905707205\n\t},\n\t"PT Sans Caption": {\n\t\t"distance": 15.033296378372908,\n\t\t"direction": -1.6373644905707205\n\t},\n\t"PT Sans Narrow": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"PT Serif": {\n\t\t"distance": 13.341664064126334,\n\t\t"direction": -1.7975951748487826\n\t},\n\t"PT Serif Caption": {\n\t\t"distance": 13.341664064126334,\n\t\t"direction": -1.7975951748487826\n\t},\n\t"Raanana": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Sathu": {\n\t\t"distance": 2.23606797749979,\n\t\t"direction": 2.677945044588987\n\t},\n\t"Seravek": {\n\t\t"distance": 2.23606797749979,\n\t\t"direction": 2.0344439357957027\n\t},\n\t"SignPainter-HouseScript": {\n\t\t"distance": 20.09975124224178,\n\t\t"direction": -1.6704649792860586\n\t},\n\t"Silom": {\n\t\t"distance": 5.385164807134504,\n\t\t"direction": 1.9513027039072617\n\t},\n\t"Sinhala MN": {\n\t\t"distance": 9.219544457292887,\n\t\t"direction": -1.7894652726688387\n\t},\n\t"Sinhala Sangam MN": {\n\t\t"distance": 12.041594578792296,\n\t\t"direction": 1.653937558683338\n\t},\n\t"Snell RoundHand": {\n\t\t"distance": 21.095023109728988,\n\t\t"direction": -1.665748033137653\n\t},\n\t"Source Sans Pro": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"STIXGeneral-Bold": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"STIXGeneral-BoldItalic": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"STIXGeneral-Italic": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"STIXGeneral-Regular": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"STIXVariants-Regular": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"STSong": {\n\t\t"distance": 5.385164807134504,\n\t\t"direction": -1.9513027039072617\n\t},\n\t"Symbol": {\n\t\t"distance": 21.213203435596427,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Tahoma": {\n\t\t"distance": 13.152946437965905,\n\t\t"direction": -1.7234456551901618\n\t},\n\t"Tamil MN": {\n\t\t"distance": 2.23606797749979,\n\t\t"direction": -2.677945044588987\n\t},\n\t"Tamil Sangam MN": {\n\t\t"distance": 54.037024344425184,\n\t\t"direction": -1.6078164426688268\n\t},\n\t"Telugu MN": {\n\t\t"distance": 14.142135623730951,\n\t\t"direction": -1.7126933813990606\n\t},\n\t"Telugu Sangam MN": {\n\t\t"distance": 16.1245154965971,\n\t\t"direction": -1.6951513213416582\n\t},\n\t"Thonburi": {\n\t\t"distance": 5.385164807134504,\n\t\t"direction": 1.9513027039072617\n\t},\n\t"Trattatello": {\n\t\t"distance": 15.132745950421556,\n\t\t"direction": -1.7033478590915707\n\t},\n\t"Webdings": {\n\t\t"distance": 11.40175425099138,\n\t\t"direction": -1.837048375945822\n\t},\n\t"Wingdings": {\n\t\t"distance": 7.280109889280518,\n\t\t"direction": -1.849095985800008\n\t},\n\t"Zapfino": {\n\t\t"distance": 80.05623023850174,\n\t\t"direction": 1.6082787634865583\n\t}\n}\n\n',BFN.FontOffsetVectors=JSON.parse(BFN.FontOffsetVectorsString),BFN.AppModelViewStates={VIEWING_PHOTO_EDITOR:"VIEWING_PHOTO_EDITOR",VIEWING_COLLAGE_MAKER:"VIEWING_COLLAGE_MAKER",VIEWING_DESIGNER:"VIEWING_DESIGNER"},BFN.AppModelEvents={APP_READY:new Event("APP_READY"),APP_COMPLETE:new Event("APP_COMPLETE"),VIEWSTATE_UPDATED:new Event("VIEWSTATE_UPDATED")};class ji extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("AppModel Init"),this.initViewState(),this.appReady=!1,window.addEventListener("INIT",()=>{this.appReady=!0,this.dispatchEvent(BFN.AppModelEvents.APP_READY)}),window.addEventListener("INIT_COMPLETE",()=>{this.dispatchEvent(BFN.AppModelEvents.APP_COMPLETE)})}initViewState(){this.viewStateChangeReason=null;var e=(window.currentDeepLinkParameters||{}).type;"collage"===e?this._viewState=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:"designer"===e?this._viewState=BFN.AppModelViewStates.VIEWING_DESIGNER:(this._viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,e||BeFunky.throwError("Missing currentDeepLinkParameters",window.currentDeepLinkParameters)),window.addEventListener("INIT_COMPLETE",()=>{setTimeout(()=>{this.applicationModeChange(window.currentDeepLinkParameters.type)},0)})}applicationModeChange(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"photoeditor"){case"photoeditor":BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR;break;case"collage":BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER;break;case"designer":BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_DESIGNER;break;default:BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR}}handleAppGoto(){switch(UITools.getToolVO("app_goto").updating_id){case"photo_editor":this.viewStateChangeReason="Top Menu",this.applicationModeChange("photoeditor");break;case"collage_maker":this.viewStateChangeReason="Top Menu",this.applicationModeChange("collage");break;case"designer":this.viewStateChangeReason="Top Menu",this.applicationModeChange("designer");break;case"edit_source_section":BFN.ImageEditManager.targetViewstate&&(this.viewState=BFN.ImageEditManager.targetViewstate)}this.viewStateChangeReason=null}isFullScreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}toggleFullscreen(){if(this.isFullScreen())this.exitFullscreen();else{if(BFN.BfnService.userIsPlus)return BFN.BfnService.track("CREATE","TOOLBAR","FULLSCREEN"),void this.showFullscreen();BFN.BfnService.track("CREATE","TOOLBAR","FULLSCREEN_PREVIEW"),BeFunky.confirm("confirm_fullscreen_mode",{onConfirm:()=>{this.showFullscreen(),setTimeout(()=>{this.isFullScreen()&&this.exitFullscreen()},1e4)},confirmText:"yes",cancelText:"no"})}}showFullscreen(){var e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen;t&&t.call(e)}exitFullscreen(){var e=document,t=e.cancelFullScreen||e.webkitCancelFullScreen||e.mozCancelFullScreen||e.exitFullscreen;t&&t.call(e),BFN.BfnService.userIsPlus||setTimeout(()=>{UIMessages.display("confirm_fullscreen_mode_message",1e3)},500)}sectionValue(e,t,i){return this.viewingEditor?e:this.viewingCollage?t:this.viewingDesigner?i:void BeFunky.throwError("sectionValue called to early")}getSectionValue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;switch(e){case"editor":case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:return t;case"collage":case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:return i;case"designer":case BFN.AppModelViewStates.VIEWING_DESIGNER:return r}return null}set viewState(e){if(BFN.ImageEditManager.editingImage&&this._viewState===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&e!==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR)BFN.ImageEditManager.overrideSetAppViewState(e);else if(BFN.TransformItemIsolator.active)BFN.TransformModel.isolatorEditComplete();else{this._viewState=e,BeFunky.setLocal("lastAppSection",BFN.AppModel.sectionValue("Photo Editor","Collage Maker","Designer"));var t,i=BeFunky.LanguageManager.language.app;t="es"===i?this.sectionValue("es/crear","es/crear/collage","es/crear/disenador"):"pt"===i?this.sectionValue("pt/criar","pt/criar/colagem","pt/criar/design"):"de"===i?this.sectionValue("de/erstellen","de/erstellen/collagen","de/erstellen/grafikdesigner"):this.sectionValue("create","create/collage","create/designer");var r=window.currentDeepLinkParameters.type;BeFunky.isCreateRoute()?this.viewingEditor&&["collage","designer"].includes(r)?(BeFunky.pushRoute(t),window.currentDeepLinkParameters={type:"photoeditor"}):this.viewingCollage&&"collage"!==r?(BeFunky.pushRoute(t),window.currentDeepLinkParameters={type:"collage"}):this.viewingDesigner&&"designer"!==r&&(BeFunky.pushRoute(t),window.currentDeepLinkParameters={type:"designer"}):BeFunky.reportWarning("App section changed when user is not in create route",window.location.href,window.isFlashOpenned);var a=BeFunky.sessionRoutes[BeFunky.sessionRoutes.length-1],n=e=>e.split("?")[0].split("#")[0],o=this.sectionValue("photo_editor","collage_maker","graphic_designer"),s=BeFunky.LanguageManager.getString(o);BeFunky.isInstalled()?document.title="".concat(s," | BeFunky"):n(BeFunky.initialRoute)===n(a)?document.title=BeFunky.originalPageTitle:document.title.includes("|")&&(document.title="".concat(s," |").concat(document.title.split("|").slice(1).join("|"))),window.Sentry&&Sentry.configureScope(e=>{e.setTag("app_section",this.sectionID)}),this.dispatchEvent(BFN.AppModelEvents.VIEWSTATE_UPDATED)}}get viewState(){return this._viewState}get viewingEditor(){return this._viewState===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR}get viewingCollage(){return this._viewState===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER}get viewingDesigner(){return this._viewState===BFN.AppModelViewStates.VIEWING_DESIGNER}get sectionID(){return this.sectionValue("editor","collage","designer")}}BFN.SingletonQueue.add(()=>{BFN.AppModel=new ji}),BFN.StageModelEvents={STAGE_DIMENSIONS_UPDATED:new Event("STAGE_DIMENSIONS_UPDATED")};class Wi extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("StageModel Init");var e=document.getElementById("appStage"),t=e.getBoundingClientRect();this._stageW=t.width,this._stageH=t.height,this.appViewport=document.getElementById("appViewport"),this.appViewportRect={},window.webglUnmaskedRenderer&&(console.log("GRAPHIC: ".concat(window.webglUnmaskedRenderer)),window.Sentry&&Sentry.configureScope(e=>{e.setTag("graphics_card",window.webglUnmaskedRenderer),navigator.deviceMemory&&e.setTag("memory","".concat(navigator.deviceMemory,"GB"))}));try{BFN.Stage=new PIXI.WebGLRenderer(Math.ceil(BFN.appRect.width-BFN.CSS.leftMenuBarWidth),Math.ceil(BFN.appRect.height-BFN.CSS.topMenuBarHeight),{transparent:!0,autoResize:!0,preserveDrawingBuffer:!0,antialias:!1,resolution:window.bfn_resolution?window.bfn_resolution:1})}catch(e){return BeFunky.logError("WebGL is unavailable. Telling user... ".concat(BeFunky.stringValue(e))),this.handleWebGLUnavailable()}e.appendChild(BFN.Stage.view),BFN.Stage.view.oncontextmenu=(()=>!1);try{BFN.Stage.gl.getExtension("OES_standard_derivatives")}catch(e){}BFN.Stage.state&&(BFN.Stage.state.blendModes[21]=[WebGLRenderingContext.ONE_MINUS_DST_COLOR,WebGLRenderingContext.ONE_MINUS_SRC_COLOR,1,1]),BFN.renderTexturesPool||BFN.Util.createRenderTexturePool(),this.debouncedResize=BeFunky.debounce(this.debouncedResize.bind(this),250),this.updatePixiRectangle(),BFN.Stage.view.addEventListener("webglcontextlost",this.handleWebGLContextLost.bind(this)),BFN.PIXITicker=PIXI.ticker.shared,BFN.PIXITicker.autoStart=!1,BFN.PIXITicker.stop(),BFN.PIXITicker.keepRunning=!1,BFN.PIXITicker.stopPending=!1,BFN.PIXITicker.nudge=function(){BFN.PIXITicker.started||BFN.PIXITicker.start(),BFN.PIXITicker.stopPending=!0,BFN.PIXITicker.completeNudge()},BFN.PIXITicker.completeNudge=BeFunky.debounce(()=>{BFN.PIXITicker.keepRunning||BFN.PIXITicker.stop(),BFN.PIXITicker.stopPending=!1},500),this.updateRendererDimensions(),this.setRefreshFactor(1),BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this)),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,()=>setTimeout(BFN.StageModel.updateStageDimensions.bind(this),0)),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.CUSTOM_RESIZE_EVENT.type,()=>setTimeout(BFN.StageModel.updateStageDimensions.bind(this),0)),BFN.TextureUtils.setupReusableImageTexture()}debouncedResize(){requestAnimationFrame(()=>{this.updateRendererDimensions()})}updateStageDimensions(){var e=BFN.appViewportRect;if(!(e.width<1&&e.height<1)){this.debouncedResize();var t=!1;for(var i in e)if(e[i]!==this.appViewportRect[i]){t=!0;break}t&&(this.appViewportRect=e,BFN.MainUI.x=e.left-BFN.CSS.leftMenuBarWidth,BFN.MainUI.y=e.top-BFN.CSS.topMenuBarHeight,this._stageW=e.width,this._stageH=e.height,this.dispatchEvent(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED))}}updatePixiRectangle(e){e||(e={width:BFN.appRect.width-BFN.CSS.leftMenuBarWidth,height:BFN.appRect.height-BFN.CSS.topMenuBarHeight-BFN.CSS.footerHeight});try{BFN.Stage.plugins.interaction.befunkyCanvasRect={width:e.width,height:e.height,x:BFN.CSS.leftMenuBarWidth,y:BFN.CSS.topMenuBarHeight,top:BFN.CSS.topMenuBarHeight,left:BFN.CSS.leftMenuBarWidth,bottom:e.height+BFN.CSS.topMenuBarHeight,right:e.width+BFN.CSS.leftMenuBarWidth}}catch(e){}}updateRendererDimensions(){var e={width:BFN.appRect.width-BFN.CSS.leftMenuBarWidth,height:BFN.appRect.height-BFN.CSS.topMenuBarHeight-BFN.CSS.footerHeight};e.width*BFN.Stage.resolution===BFN.Stage.width&&e.height*BFN.Stage.resolution===BFN.Stage.height||(BFN.Stage.resize(Math.ceil(e.width),Math.ceil(e.height)),this.updatePixiRectangle(e),BFN.MainUI&&(BFN.MainUI.renderCanvas(),BFN.MainUI.renderCanvas()))}setRefreshFactor(e){this._refreshFactor!=e&&(BeFunky.log("SETTING REFRESH FACTOR : ".concat(e)),this._refreshFactor=e,BFN.frameRate=Math.round(BFN.baseFrameRate*this._refreshFactor),BFN.frameInterval=Math.round(1e3/BFN.frameRate))}handleAppReady(){this.updateStageDimensions()}handleWebGLUnavailable(){window.onbeforeunload=null,["editor","collage","designer"].forEach(e=>{BeFunky.setLocal("force_use_autosave__".concat(e),"true")}),function(){var e="";e=BeFunky.isChrome?"Chrome":BeFunky.isFirefox?"Firefox":BeFunky.isSafari?"Safari":BeFunky.isEdge?"Microsoft Edge":BeFunky.LanguageManager.getString("your_browser");var t={your_browser:e,alternate_browser:BeFunky.isChrome?"Firefox":"Chrome",contact_support:BeFunky.toLinkHTML("SUPPORT",!0)};BeFunky.acknowledge(["error_webgl_unavailable",t],{isCritical:!0,disableClose:!0}),BeFunky.logError("User message:",BeFunky.LanguageManager.getStringReplacements("error_webgl_unavailable",t))}(),function(){var e="webgl unavailable during app initialization";if("visible"!==document.visibilityState)throw new Error("".concat(e," - tab not visible"));if(BFN.tabRecentlyReopened)throw new Error("".concat(e," - tab recently re-opened"));throw new Error(e)}()}handleWebGLContextLost(){BeFunky.webglContextWasLost=!0,BeFunky.logError("webglTextureSize:",window.webglTextureSize);try{if(void 0!==window.webglUnmaskedRenderer){BeFunky.logError("webglUnmaskedRenderer: ",window.webglUnmaskedRenderer);try{BFN.BfnService.track("EXTERNAL","WEBGL_GRAPHIC_PROBLEM",window.webglUnmaskedRenderer)}catch(e){}}}catch(e){}BeFunky.logError("Texture Memory: ".concat(BFN.Util.getTotalTextureMemory()," MB")),navigator.deviceMemory&&BeFunky.logError("Device Memory: ".concat(navigator.deviceMemory," GB")),BeFunky.logError("appRect:","".concat(BFN.appRect.width," x ").concat(BFN.appRect.height)),BFN.AppModel.viewingEditor&&(BeFunky.logError("Current tool:",BFN.PhotoEditorCanvasModel.viewState),BeFunky.logError("Photo Editor canvas size:","".concat(BFN.PhotoEditorModel.currentTextureDimensions.width," x ").concat(BFN.PhotoEditorModel.currentTextureDimensions.height))),Object.values(BFN.ProjectManager.autoSave).forEach(e=>e.allowAutoSave=!1);try{window.onbeforeunload=null}catch(e){}["editor","collage","designer"].forEach(e=>{BeFunky.setLocal("force_use_autosave__".concat(e),"true")}),function(){var e=BFN.AppModel.sectionID,t="IndexedDB"===BFN.ProjectManager.autoSave[e].lastSaveLocation?"error_webglcontextlost_autosave":"error_webglcontextlost",i={alternate_browser:BeFunky.isChrome?"Firefox":"Chrome"},r=document.createElement("div"),a=document.createElement("p").setLang(t,i);r.appendChild(a);var n=parseInt(BeFunky.getLocal("last_webgl_crash"))||0,o=Date.now();if(o-n<6912e5){var s=document.createElement("p").setLang("optionally_contact_support",{contact_support:BeFunky.toLinkHTML("SUPPORT",!0)});r.appendChild(s)}BeFunky.setLocal("last_webgl_crash",o),BeFunky.acknowledge(r,{isCritical:!0,disableClose:!0}),BeFunky.logError("User message:",r.textContent)}(),function(){var e="webgl context lost";if(setTimeout(()=>{window.Sentry&&(console.log("Stop Sentry from sending further errors "),Sentry.captureException=(()=>{}),Sentry.getCurrentHub().getClient().getOptions().enabled=!1)},0),"visible"!==document.visibilityState)throw new Error("".concat(e," - tab not visible"));if(BFN.tabRecentlyReopened)throw new Error("".concat(e," - tab recently re-opened"));throw new Error(e)}()}get stageW(){return this._stageW}get stageH(){return this._stageH}get mouseX(){return BFN.Stage.plugins.interaction.mouse.global.x}get mouseY(){return BFN.Stage.plugins.interaction.mouse.global.y}}function Yi(){BFN.EventDispatcher.call(this),this.init()}function qi(){BFN.EventDispatcher.call(this),this.init()}function Ki(){BFN.EventDispatcher.call(this),this.init()}BFN.SingletonQueue.add(()=>{BFN.StageModel=new Wi}),BFN.TransformModelEvents={TRANSFORM_ITEM_UPDATED:new Event("TRANSFORM_ITEM_UPDATED"),TRANSFORM_ITEM_TEXT_UPDATED:new Event("TRANSFORM_ITEM_TEXT_UPDATED")},Yi.prototype=Object.create(BFN.EventDispatcher.prototype),Yi.prototype.init=function(){BeFunky.log("TransformModel Init"),this.initDefaultValues(),window.addEventListener("INIT",()=>{this.initContextMenu()})},Yi.prototype.initDefaultValues=function(){this._selectedTransformItem=null,this._selectedTransformItemText=null,this._selectedGroupType=null,this.tempTransformItem=null,this.addedTransformItem=null,this.selectItemOnAdd=!0,this.startValue=null,this.maskImageSizeUpdating=!1,this.opacityUpdating=!1,this.overlayColorUpdating=!1,this.tintColorUpdating=!1,this.shapeAttributeUpdating=!1,this.layerItem=null,this._awaitingDrop=!1,this._focusedTransformItem=null,this._targetTransformItem=null,this.snappingEnabled=!0,this.showMeasurements=!1,this.handleSelectItemAfterEditBind=this.handleSelectItemAfterEdit.bind(this)},Yi.prototype.initContextMenu=function(){function e(e){UITools.setControlValue(e,!0),UITools.applyToolControl(e),UITools.setControlValue(e,!1)}this.contextMenu=document.getElementById("context_menu_transform"),BeFunky.contextMenu(this.contextMenu,{delete_item:{onClick:()=>{e("transform_delete"),this.contextMenu.hide()},shortcutText:"Del"},duplicate_item:{onClick:()=>e("transform_duplicate"),hasDivider:!0,shortcutText:BFN.KeyboardManager.shortcutText("D")},align:{hasDivider:!0,children:{align_left:{onClick:()=>e("transform_align_left")},align_center:{onClick:()=>e("transform_align_center")},align_right:{onClick:()=>e("transform_align_right")},align_top:{onClick:()=>e("transform_align_top")},align_middle:{onClick:()=>e("transform_align_middle")},align_bottom:{onClick:()=>e("transform_align_bottom")}}},flip:{onClick:()=>{},hasDivider:!0,children:{horizontal:{onClick:()=>e("transform_flip_horizontal")},vertical:{onClick:()=>e("transform_flip_vertical")}}},layer_order:{onClick:()=>{},hasDivider:!0,children:{move_backwards:{onClick:()=>e("transform_move_backwards")},move_forwards:{onClick:()=>e("transform_move_forwards")}}},select_group:{children:{}},add_to_group:{children:{}},remove_from_group:{children:{}},canvas:{children:{fit_to_canvas:{onClick:()=>e("transform_fit_to_canvas")},fill_canvas:{onClick:()=>e("transform_fill_canvas")}}}},{hideOnClick:!1}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},Yi.prototype.handleTransform=function(){var e=this,t=UITools.getToolVO("transform"),i=t.updating_id;if(this._selectedTransformItem){var r=this._selectedTransformItem,a="group"==r.type,n=r.basicShapeVO;if(n){var o=function(i,o){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(a)s&&(e.shapeAttributeUpdating!=t.updating&&(e.shapeAttributeUpdating=t.updating,e.shapeAttributeUpdating?r.createTransition(i):(n.setValues(o),r.selectedItems.forEach(e=>{e.basicShapeVO&&e.basicShapeVO.setValues(o)}),r.updateShapeTexture(),r.registerTransition(),BFN.BasicShapeManager.updateDefaultValues(o))),e.shapeAttributeUpdating&&(n.setValues(o),r.selectedItems.forEach(e=>{e.basicShapeVO&&e.basicShapeVO.setValues(o)}),r.updateShapeTexture(!1)));else{if(e.shapeAttributeUpdating!=t.updating)if(e.shapeAttributeUpdating=t.updating,e.shapeAttributeUpdating)e.startValue=Object.assign({},n.getValues()),r.createTransition(i);else{var l=!1;for(var h in o)o[h]!==e.startValue[h]&&(l=!0);l&&(r.registerTransition(),BFN.BasicShapeManager.updateDefaultValues(o))}n.setValues(o),r.updateShapeTexture(!t.updating)}},s=(e,i)=>{t.updating||a||(r.createTransition(e),n.setValues(i),r.updateShapeTexture(!t.updating),r.registerTransition(),BFN.BasicShapeManager.updateDefaultValues(i))};switch(i){case"shape_stroke_width_popover_button":if(!t.updating){var l=document.getElementById("transform_".concat(t.updating_id.replace("_button","")));l.hasClass("active")?l.hide():l.show()}return;case"shape_fill_color":o("history_shape_fill_color",{fill:t.shape_fill_color,fillAlpha:parseFloat(t.shape_fill_color_intensity)},!0);break;case"shape_stroke_color":o("history_shape_stroke_color",{stroke:t.shape_stroke_color,strokeAlpha:parseFloat(t.shape_stroke_color_intensity)},!0);break;case"shape_stroke_width":o("history_shape_stroke_width",{strokeWidth:parseInt(t.shape_stroke_width)},!0);break;case"shape_line_style":s("history_shape_line_style",{lineStyle:t.shape_line_style}),UITools.toggleControlItem("transform_shape_line_segment_width","dashed"===t.shape_line_style),UITools.toggleControlItem("transform_shape_line_gap_size","solid"!==t.shape_line_style);break;case"shape_line_segment_width":o("history_shape_line_segment_width",{lineSegmentWidth:parseInt(t.shape_line_segment_width)/100*9+1});break;case"shape_line_gap_size":o("history_shape_line_gap_size",{lineGapSize:parseInt(t.shape_line_gap_size)/50});break;case"shape_rectangle_corner_rounding":o("history_shape_rectangle_corner_rounding",{rectangleCornerRounding:parseInt(t.shape_rectangle_corner_rounding)/100});break;case"shape_polygon_sides":o("history_shape_polygon_sides",{polygonSides:parseInt(t.shape_polygon_sides)});break;case"shape_polygon_shift_orientation":s("history_shape_polygon_shift_orientation",{polygonShiftOrientation:t.shape_polygon_shift_orientation});break;case"shape_star_points":o("history_shape_star_points",{starPoints:parseInt(t.shape_star_points)});break;case"shape_star_inset_weight":o("history_shape_star_inset_weight",{starInsetWeight:parseInt(t.shape_star_inset_weight)/100});break;case"shape_star_shift_orientation":s("history_shape_star_shift_orientation",{starShiftOrientation:t.shape_star_shift_orientation});break;case"shape_arrow_style":s("history_shape_arrow_style",{arrowStyle:t.shape_arrow_style});break;case"shape_arrow_weight":o("history_shape_arrow_weight",{arrowWeight:parseInt(t.shape_arrow_weight)/100});break;case"shape_arrow_double_sided":s("history_shape_arrow_double_sided",{arrowDoubleSided:t.shape_arrow_double_sided})}}switch(i){case"graphic_color_group_color":var h=parseInt(t.graphic_color_group_color_group_id);if(this.shapeAttributeUpdating!=t.updating)if(this.shapeAttributeUpdating=t.updating,this.shapeAttributeUpdating)this.startValue=this._selectedTransformItem.getShapeColorGroupColor(h),r.createTransition("history_shape_fill_color");else{var c=this._selectedTransformItem.getShapeColorGroupColor(h);-1===t.graphic_color_group_color&&(UITools.setToolValue("transform","graphic_color_group_color",c.color),UITools.setToolValue("transform","graphic_color_group_color_intensity",c.opacity),UITools.updateToolControl("transform_graphic_color_group_color"),BFN.ColorPickerPanel.colorButton&&(BFN.ColorPickerPanel.colorButton.hashColor=c.color,BFN.ColorPickerPanel.colorButton.intensity=c.opacity,BFN.ColorPickerPanel.handleColorButtonUpdated())),c.color===this.startValue.color&&c.opacity===this.startValue.opacity||r.registerTransition()}this._selectedTransformItem.setShapeColorGroupColor(h,t.graphic_color_group_color,t.graphic_color_group_color_intensity,!t.updating,BFN.ColorPickerPanel.emptyButtonClicked)}switch(i){case"delete":this._selectedTransformItem.removeItem();break;case"duplicate":"group"===this._selectedTransformItem.type?this._selectedTransformItem.duplicateGroup():this._selectedTransformItem.duplicateItem();break;case"opacity":if(a)return void(t.updating||(this._selectedTransformItem.createTransition("history_opacity"),this._selectedTransformItem.setOpacity(t.opacity),this._selectedTransformItem.registerTransition(!0)));this.opacityUpdating!=t.updating&&(this.opacityUpdating=t.updating,this.opacityUpdating?(this.startValue=this._selectedTransformItem.alpha,this._selectedTransformItem.createTransition("history_opacity")):this.startValue!=this._selectedTransformItem.alpha&&this._selectedTransformItem.registerTransition(!0)),this._selectedTransformItem.alpha=t.opacity/100;break;case"overlay_color":if(a){if(this.overlayColorUpdating!=t.updating)if(this.overlayColorUpdating=t.updating,this.overlayColorUpdating){this._selectedTransformItem.createTransition("history_color");var u=BFN.TransformItemGroup.getGroupItemData(),d="mixed"===u.overlayColor||-1===u.overlayColor||"mixed"===u.overlayColorIntensity,m=-1==t.overlay_color;d&&!m?(UITools.setToolValue("transform","overlay_color_intensity",1),UITools.updateToolControl("transform_overlay_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):!d&&m&&(UITools.setToolValue("transform","overlay_color_intensity",0),UITools.updateToolControl("transform_overlay_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}else this._selectedTransformItem.setOverlayColor(t.overlay_color,t.overlay_color_intensity),this._selectedTransformItem.registerTransition()}else this.overlayColorUpdating!=t.updating&&(this.overlayColorUpdating=t.updating,this.overlayColorUpdating?(this.startValue={color:this._selectedTransformItem.overlayColor,intensity:this._selectedTransformItem.overlayColorIntensity},this._selectedTransformItem.createTransition("history_color"),-1==this.startValue.color&&-1!=t.overlay_color?(UITools.setToolValue("transform","overlay_color_intensity",1),UITools.updateToolControl("transform_overlay_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=this.startValue.color&&-1==t.overlay_color&&(UITools.setToolValue("transform","overlay_color_intensity",0),UITools.updateToolControl("transform_overlay_color"),BFN.ColorPickerPanel.refreshIntensitySlider())):this.startValue.color==this._selectedTransformItem.overlayColor&&this.startValue.intensity==this._selectedTransformItem.overlayColorIntensity||this._selectedTransformItem.registerTransition()),this._selectedTransformItem.overlayColor=t.overlay_color,this._selectedTransformItem.overlayColorIntensity=t.overlay_color_intensity;break;case"tint_color":a?this.tintColorUpdating!=t.updating&&(this.tintColorUpdating=t.updating,this.tintColorUpdating?this._selectedTransformItem.createTransition("tint"):(this._selectedTransformItem.setTintColor(t.tint_color),this._selectedTransformItem.registerTransition())):(this.tintColorUpdating!=t.updating&&(this.tintColorUpdating=t.updating,this.tintColorUpdating?(this.startValue=this._selectedTransformItem.tintColor,this._selectedTransformItem.createTransition("tint")):this.startValue!=this._selectedTransformItem.tintColor&&this._selectedTransformItem.registerTransition()),this._selectedTransformItem.tintColor=t.tint_color);break;case"blend_mode":var p=parseInt(t.blend_mode),g=Object.values(BFN.CONST.BLEND_MODES);isNaN(p)||-1==g.indexOf(p)||(this._selectedTransformItem.createTransition("history_blend_mode"),this._selectedTransformItem.setBlendMode(p),this._selectedTransformItem.registerTransition(!0));break;case"flip_horizontal":this._selectedTransformItem.createTransition("history_flip_horizontal"),this._selectedTransformItem.flipHorizontal(),this._selectedTransformItem.registerTransition(void 0,a);break;case"flip_vertical":this._selectedTransformItem.createTransition("history_flip_vertical"),this._selectedTransformItem.flipVertical(),this._selectedTransformItem.registerTransition(void 0,a);break;case"create_group":a&&BFN.GroupManager.modal.open();break;case"move_backwards":a?this._selectedTransformItem.moveBackwards():(this._selectedTransformItem.createTransition("history_layer_order"),this._selectedTransformItem.moveBackwards()&&this._selectedTransformItem.registerTransition());break;case"move_forwards":a?this._selectedTransformItem.moveForwards():(this._selectedTransformItem.createTransition("history_layer_order"),this._selectedTransformItem.moveForwards()&&this._selectedTransformItem.registerTransition());break;case"align_left":if(a&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.x),this._selectedTransformItem.createTransition(a?"history_selection_align_left":"history_align_left"),this._selectedTransformItem.align="left",(this.startValue!=Math.floor(this._selectedTransformItem.x)||a)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_center":if(a&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.x),this._selectedTransformItem.createTransition(a?"history_selection_align_center":"history_align_center"),this._selectedTransformItem.align="center",(this.startValue!=Math.floor(this._selectedTransformItem.x)||a)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_right":if(a&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.x),this._selectedTransformItem.createTransition(a?"history_selection_align_right":"history_align_right"),this._selectedTransformItem.align="right",(this.startValue!=Math.floor(this._selectedTransformItem.x)||a)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_top":if(a&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.y),this._selectedTransformItem.createTransition(a?"history_selection_align_top":"history_align_top"),this._selectedTransformItem.align="top",(this.startValue!=Math.floor(this._selectedTransformItem.y)||a)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_middle":if(a&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.y),this._selectedTransformItem.createTransition(a?"history_selection_align_middle":"history_align_middle"),this._selectedTransformItem.align="middle",(this.startValue!=Math.floor(this._selectedTransformItem.y)||a)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_bottom":if(a&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.y),this._selectedTransformItem.createTransition(a?"history_selection_align_bottom":"history_align_bottom"),this._selectedTransformItem.align="bottom",(this.startValue!=Math.floor(this._selectedTransformItem.y)||a)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"fit_to_canvas":this._selectedTransformItem.transformTool.fitItemToCanvas(!1),this.contextMenu.hide();break;case"fill_canvas":this._selectedTransformItem.transformTool.fitItemToCanvas(!0),this.contextMenu.hide()}BFN.MainUI.requestRender()}else this._selectedTransformItemText&&("delete"!=i&&"duplicate"!=i&&(this.tempTransformItem=this._selectedTransformItemText,this.tempTransformItem.addEventListener(BFN.TransformItemEvents.SELECT_ITEM.type,this.handleSelectItemAfterEditBind)),this._selectedTransformItemText.exitTextEditing());if("menu_popover_button"===i){var f=document.getElementById("transform_menu_popover");f.hasClass("active")?f.hide():f.show()}},Yi.prototype.handleLayer=function(){var e=UITools.getToolVO("layer"),t=e.updating_id;if(this._selectedTransformItem){var i=this._selectedTransformItem;if(["texture","frame_texture"].includes(i.type)&&!i.isGoodie)switch(t){case"save_as_image":switch(i.type){case"texture":BFN.UploadSaveShareManager.altSaveTexture=this.selectedTransformItem.itemContent.texture;var r="";try{var a=i.projectItemVO.imageID;r=BFN.ImageLibraryManager.selectedMenuImageVOs[BFN.ImageLibraryManager.getIndex(a)].name||""}catch(e){}BFN.UploadSaveShareManager.setFileName(void 0,"layer",r),BFN.UploadSaveShareManager.handleSaveOrShareImage("save","computer");break;case"frame_texture":var n=[0,12,8,4][i.flippedHorizontal+2*i.flippedVertical],o=i.itemContent,s=new PIXI.Texture(o.baseTexture),l=s.renderClone();s.destroyGC(!1),l.frame=new PIXI.Rectangle(Math.round(o.texture.frame.x),Math.round(o.texture.frame.y),Math.round(o.texture.frame.width),Math.round(o.texture.frame.height));var h=Math.min(l.frame.width/o.frameWidth,l.frame.height/o.height),c=Math.round(o.frameWidth*h),u=Math.round(o.frameHeight*h);l.orig=l.trim=new PIXI.Rectangle(0,0,c,u),l.rotate=n;var d=new PIXI.Container,m=new PIXI.Sprite(l);m.pluginName="blend_picture",m.fillColor=i.itemContent.fillColor||0,m.intensity=i.itemContent.intensity||0,m.tint=i.itemContent.tint,d.addChild(m);var p=new PIXI.Sprite;if(d.addChild(p),i.isShape&&i.hasOwnProperty("itemContentMask")){var g=i.itemContentMask;i.basicShapeVO?i.basicShapeVO.updateTexture(g.texture,c,u,!0):BFN.SVGManager.updateTexture(g.texture,null,null,c,u);var f=g.texture.renderClone();f.rotate=n,p.texture=f,m.mask=p,i.updateShapeTexture()}var v=PIXI.RenderTexture.create(c,u);BFN.Stage.render(d,v);try{m.mask=null,m.texture.destroyGC(!0),m.destroy(!1)}catch(e){}d.removeChild(m);try{p.texture.destroyGC(!0),p.destroy(!1)}catch(e){}d.removeChild(p),BFN.UploadSaveShareManager.destroyAltSaveTextureOnDispose=!0,BFN.UploadSaveShareManager.altSaveTexture=v,BFN.UploadSaveShareManager.setFileName(void 0,"layer","befunky_layer"),BFN.UploadSaveShareManager.handleSaveOrShareImage("save","computer")}break;case"lock_aspect_ratio":break;case"image_cutout":BFN.EditLayerManager.editTransformItemAlternateMenu("cutout",()=>{BFN.ImageCutout.readyCallback=(()=>{requestAnimationFrame(()=>{UIToggler.toggleAlternateMenu(!0,"layer_isolator_tool_menu_header","layer_isolator_tool_menu")})})},()=>{(BFN.ImageCutout.readyCallback=null,BFN.ImageCutout.exportedItemObject)&&(BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel).addedItem=BFN.ImageCutout.exportedItemObject,delete BFN.ImageCutout.exportedItemObject)});break;case"image_edit_layer":if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade(BFN.AppModel.sectionValue("EDITOR","COLLAGE","DESIGNER"),"EDIT_LAYER_UPGRADE","edit_layer"),void BFN.UserActionManager.addUpgradeAction(["Edit Image Layer"]);BFN.EditLayerManager.editTransformItem(),BeFunky.showAnnouncementOnce("edit_layer");break;case"image_open_in_editor":if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade(BFN.AppModel.sectionValue("EDITOR","COLLAGE","DESIGNER"),"EDIT_LAYER_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Open Layer Image in Editor"]);i.deselectItem(),BFN.PhotoEditorModel.currentTexture&&BFN.IndexedDB.disabledReason?BeFunky.confirm("confirm_edit_image",{onConfirm:()=>{BFN.ImageEditManager.openImageInEditor(i)},onCancel:()=>{i.selectItem()},focusConfirmButton:!1}):BFN.ImageEditManager.openImageInEditor(i);break;case"mask_image_crop":"frame_texture"===i.type&&i.transformTool.transformToolFrame.setup(i);break;case"mask_image_replace":(i.type="frame_texture")&&BFN.ImageLibraryManager.uploadImages(e=>{!e.isComplete&&e.menuImageVO&&(BFN.TransformModel.targetTransformItem=i,BFN.ImageLibraryManager.addImageToCanvas(e.menuImageVO))},{allowMultiple:!1});break;case"mask_image_open_in_editor":if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade(BFN.AppModel.sectionValue("EDITOR","COLLAGE","DESIGNER"),"EDIT_LAYER_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Open Layer Image in Editor"]);i.deselectItem(),BFN.PhotoEditorModel.currentTexture&&BFN.IndexedDB.disabledReason?BeFunky.confirm("confirm_edit_image",{onConfirm:()=>{BFN.ImageEditManager.openMaskImageInEditor(i)},onCancel:()=>{i.selectItem()},focusConfirmButton:!1}):BFN.ImageEditManager.openMaskImageInEditor(i);break;case"mask_image_crop_lock_aspect_ratio":break;case"mask_image_crop_size":"frame_texture"===i.type&&i.transformTool.transformToolFrame.transformItem===i&&BFN.TransformModel.transformToolFrame.setImageScale(e.mask_image_crop_size/100,e.updating);break;case"mask_image_crop_fit_to_frame":"frame_texture"===i.type&&i.transformTool.transformToolFrame.transformItem===i&&i.resetFrameTexture();break;case"mask_image_crop_fit_to_image":"frame_texture"===i.type&&i.transformTool.transformToolFrame.transformItem===i&&i.fitFrameToImage()}}else if("isolator_display_canvas"===t){var y=e[t];UITools.setToolValue("layer","isolator_display_canvas",y),UITools.updateToolControl("layer_isolator_display_canvas"),BFN.TransformItemIsolator.toggleBackground(y)}else"isolator_edit_complete"===t&&this.isolatorEditComplete()},Yi.prototype.isolatorEditComplete=function(){if(BFN.TransformItemIsolator.active&&!BFN.TransformItemIsolator.animating)if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS){BeFunky.confirm("apply_changes_leave_editor",{onConfirm:()=>{BFN.applyCancelMenu.applyButton.click(),setTimeout(()=>{BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&(UIToggler.toggleLoadScreen(!0,{isCancellable:!1}),BeFunky.waitUntil({condition:()=>!BFN.MainUI.viewportUpdating,onSuccess:()=>{UIToggler.toggleLoadScreen(!1),BFN.TransformItemIsolator.releaseTransformItem()},onTimeout:()=>{UIToggler.toggleLoadScreen(!1),BFN.TransformItemIsolator.releaseTransformItem()},interval:10,maxAttempts:500}))},0)},confirmText:"yes",cancelText:"no_keep_editing"})}else BFN.TransformItemIsolator.releaseTransformItem()},Yi.prototype.updateGroupMenu=function(){var e=this._selectedTransformItem&&"group"==this._selectedTransformItem.type?this._selectedTransformItem:null;UITools.disableControlItem("text_edit_spacing_menu_popover_button",!!e,"button"),document.getElementById("transform_menu_controls").addClass("control-item--border-top");var t=document.getElementById("text_edit_size");if(!e&&t.mixed&&(t.mixed=!1),e){var i=e.getGroupItemData(),r=UITools.getToolValue("transform","updating_id");UITools.setToolValue("transform","opacity","mixed"==i.opacity?100:i.opacity),UITools.updateToolControl("transform_opacity"),"mixed"==i.blendMode?document.getElementById("transform_blend_mode").setState({isMixed:!0}):(UITools.setToolValue("transform","blend_mode",i.blendMode),UITools.updateToolControl("transform_blend_mode"));var a=i.overlayColor&&"mixed"!=i.overlayColor?i.overlayColor:-1,n=-1,o="mixed"==i.overlayColor?1:0;-1!=a&&"mixed"!=i.overlayColorIntensity&&(n=a,o=i.overlayColorIntensity),UITools.setToolValue("transform","overlay_color",n),UITools.setToolValue("transform","overlay_color_intensity",o),UITools.updateToolControl("transform_overlay_color");var s=i.tintColor&&"mixed"!=i.tintColor?i.tintColor:-1,l=-1;-1!=s&&(l=s),UITools.setToolValue("transform","tint_color",l),UITools.updateToolControl("transform_tint_color");var h=i.shapeFill&&"mixed"!=i.shapeFill?i.shapeFill:-1,c=-1,u=1;-1!=h&&"mixed"!=i.shapeFillAlpha&&(c=h,u=i.shapeFillAlpha),UITools.setToolValue("transform","shape_fill_color",c),UITools.setToolValue("transform","shape_fill_color_intensity",u),UITools.updateToolControl("transform_shape_fill_color"),UITools.toggleControlItem("transform_shape_fill_color",!i.hasOwnProperty("shapeHideFill")||!i.shapeHideFill);var d=i.shapeStroke&&"mixed"!=i.shapeStroke?i.shapeStroke:-1,m=-1,p=1;-1!=d&&"mixed"!=i.shapeStrokeAlpha&&(m=d,p=i.shapeStrokeAlpha),UITools.setToolValue("transform","shape_stroke_color",m),UITools.setToolValue("transform","shape_stroke_color_intensity",p),UITools.updateToolControl("transform_shape_stroke_color"),UITools.toggleControlItem("transform_shape_stroke_color",!i.hasOwnProperty("shapeHideStroke")||!i.shapeHideStroke),document.getElementById("transform_shape_stroke_color").emptyEnabled=!i.hasOwnProperty("shapeHideFill")||!i.shapeHideFill;var g=i.hasOwnProperty("shapeStrokeWidth")&&"mixed"!=i.shapeStrokeWidth?i.shapeStrokeWidth:10;switch(UITools.setToolValue("transform","shape_stroke_width",g),UITools.updateToolControl("transform_shape_stroke_width"),this.updateBasicShapeAttributeControls(),UITools.getToolVO("transform").updating_id=r,e.groupType){case"image":case"graphic":case"shape":case"graphic_image_mix":case"text":break;case"mixed":default:document.getElementById("transform_menu_controls").removeClass("control-item--border-top")}}},Yi.prototype.updateBasicShapeAttributeControls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(e||(e={type:null}),UITools.toggleControlItem("transform_shape_line_style","line"===e.type),UITools.toggleControlItem("transform_shape_line_segment_width","line"===e.type&&"dashed"===e.attributes.lineStyle),UITools.toggleControlItem("transform_shape_line_gap_size","line"===e.type&&"solid"!==e.attributes.lineStyle),UITools.toggleControlItem("transform_shape_rectangle_corner_rounding","rectangle"===e.type),UITools.toggleControlItem("transform_shape_polygon_sides","polygon"===e.type),UITools.toggleControlItem("transform_shape_polygon_shift_orientation","polygon"===e.type),UITools.toggleControlItem("transform_shape_star_points","star"===e.type),UITools.toggleControlItem("transform_shape_star_inset_weight","star"===e.type),UITools.toggleControlItem("transform_shape_star_shift_orientation","star"===e.type),UITools.toggleControlItem("transform_shape_arrow_style","arrow"===e.type),UITools.toggleControlItem("transform_shape_arrow_weight","arrow"===e.type),UITools.toggleControlItem("transform_shape_arrow_double_sided","arrow"===e.type),e.type){case"line":UITools.setToolValue("transform","shape_line_style",e.attributes.lineStyle),UITools.setToolValue("transform","shape_line_segment_width",Math.round((e.attributes.lineSegmentWidth-1)/9*100)),UITools.setToolValue("transform","shape_line_gap_size",Math.round(50*e.attributes.lineGapSize));break;case"rectangle":UITools.setToolValue("transform","shape_rectangle_corner_rounding",Math.round(100*e.attributes.rectangleCornerRounding));break;case"polygon":UITools.setToolValue("transform","shape_polygon_sides",e.attributes.polygonSides),UITools.setToolValue("transform","shape_polygon_shift_orientation",e.attributes.polygonShiftOrientation);break;case"star":UITools.setToolValue("transform","shape_star_points",e.attributes.starPoints),UITools.setToolValue("transform","shape_star_inset_weight",Math.round(100*e.attributes.starInsetWeight)),UITools.setToolValue("transform","shape_star_shift_orientation",e.attributes.starShiftOrientation);break;case"arrow":UITools.setToolValue("transform","shape_arrow_style",e.attributes.arrowStyle),UITools.setToolValue("transform","shape_arrow_weight",Math.round(100*e.attributes.arrowWeight)),UITools.setToolValue("transform","shape_arrow_double_sided",e.attributes.arrowDoubleSided)}},Yi.prototype.handleSelectItemAfterEdit=function(e){this.tempTransformItem.removeEventListener(BFN.TransformItemEvents.SELECT_ITEM.type,this.handleSelectItemAfterEditBind),this.tempTransformItem=null,this.handleTransform()},Object.defineProperty(Yi.prototype,"selectedTransformItem",{set(e){if(this._selectedTransformItem=e,this.dispatchEvent(BFN.TransformModelEvents.TRANSFORM_ITEM_UPDATED),this._selectedGroupType=null,UITools.toggleControlItem("transform_blend_mode",!0),BFN.TransformItemBoundingBoxes.clear(),this._selectedTransformItem){var t=this._selectedTransformItem;if("group"===this._selectedTransformItem.type)switch(this._selectedGroupType=this._selectedTransformItem.groupType,this._selectedGroupType){case"image":UIToggler.toggleAlternateMenu(!0,"image_menu_header","graphic_menu","transform_menu");break;case"shape":UIToggler.toggleAlternateMenu(!0,"shape_menu_header","shape_menu","transform_menu"),document.getElementById("shape_menu_header").querySelector("string").setLang("shape_properties_multiple");break;case"graphic":UIToggler.toggleAlternateMenu(!0,"graphic_menu_header","graphic_menu","transform_menu");break;case"graphic_image_mix":UIToggler.toggleAlternateMenu(!0,"selection_menu_header","graphic_menu","transform_menu");break;case"text":UIToggler.toggleAlternateMenu(!0,"text_menu_header","text_menu","transform_menu");break;case"mixed":default:return UITools.toggleControlItem("transform_blend_mode",!1),void UIToggler.toggleAlternateMenu(!0,"selection_menu_header","transform_menu")}else{BFN.TransformItemBoundingBoxes.selectItems(t.getAvailableGroupItems()),this.updateGroupMenu();var i=this._selectedTransformItem.basicShapeVO;if(i)-1===i.fill?(UITools.setToolValue("transform","shape_fill_color",-1),UITools.setToolValue("transform","shape_fill_color_intensity",1)):(UITools.setToolValue("transform","shape_fill_color",i.fill),UITools.setToolValue("transform","shape_fill_color_intensity",i.fillAlpha)),UITools.toggleControlItem("transform_shape_fill_color","line"!==i.type),document.getElementById("transform_shape_fill_color").emptyEnabled="arrow"!==i.type,-1===i.stroke?(UITools.setToolValue("transform","shape_stroke_color",-1),UITools.setToolValue("transform","shape_stroke_color_intensity",1)):(UITools.setToolValue("transform","shape_stroke_color",i.stroke),UITools.setToolValue("transform","shape_stroke_color_intensity",i.strokeAlpha)),UITools.toggleControlItem("transform_shape_stroke_color",!["star","arrow"].includes(i.type)),document.getElementById("transform_shape_stroke_color").emptyEnabled="line"!==i.type,UITools.setToolValue("transform","shape_stroke_width",i.strokeWidth),this.updateBasicShapeAttributeControls(i);var r=UITools.getToolValue("transform","updating_id");UITools.setToolValue("transform","opacity",100*this._selectedTransformItem.alpha),UITools.setToolValue("transform","overlay_color",this._selectedTransformItem.overlayColor),UITools.setToolValue("transform","overlay_color_intensity",this._selectedTransformItem.overlayColorIntensity),UITools.setToolValue("transform","tint_color",this._selectedTransformItem.tintColor),UITools.setToolValue("transform","blend_mode",this._selectedTransformItem.itemBlendMode),UITools.updateToolControls("transform"),UITools.getToolVO("transform").updating_id=r;var a=document.getElementById("transform_menu_popover");if("frame_texture"===this._selectedTransformItem.type&&this.transformToolFrame&&this.transformToolFrame.active&&this.transformToolFrame.transformItem===this._selectedTransformItem)UIToggler.toggleAlternateMenu(!0,"mask_image_crop_header","mask_image_crop_menu");else if("text"===this._selectedTransformItem.type)BFN.FabricManager.updateTextMenu(this._selectedTransformItem.getTextStyleData()),a.positionFactor=1,UIToggler.toggleAlternateMenu(!0,"text_menu_header","text_menu","transform_menu");else if(this._selectedTransformItem.isGoodie)if(a.positionFactor=1,i)UIToggler.toggleAlternateMenu(!0,"shape_menu_header","shape_menu","transform_menu"),document.getElementById("shape_menu_header").querySelector("string").setLang("shape_properties",{shape:BeFunky.LanguageManager.getString(i.type)});else{var n=t.shapeColorMap&&t.shapeColorGroupsNum>(t.shapeObjectFills?0:1);if(n){var o=[];for(var s in t.shapeColorMap){var l=t.shapeColorMap[s];l.objects&&o.push({id:s,color:l.colorHash,intensity:l.colorOpacity})}document.getElementById("transform_graphic_color_group_color").colorGroup.setColorGroupData(o)}n?UIToggler.toggleAlternateMenu(!0,"graphic_menu_header","graphic_menu","graphic_svg_color_menu","transform_menu"):UIToggler.toggleAlternateMenu(!0,"graphic_menu_header","graphic_menu","transform_menu")}else"frame_texture"===this._selectedTransformItem.type?(UITools.toggleControlItem("transform_blend_mode",!this._selectedTransformItem.hasOwnProperty("itemContentMask")),a.positionFactor=1,UITools.toggleControlItem("layer_mask_image_replace",!0),UITools.toggleControlItem("layer_image_open_in_editor",!1),UITools.toggleControlItem("layer_mask_image_open_in_editor",BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR),UIToggler.toggleAlternateMenu(!0,"mask_image_menu_header","layer_image_menu","graphic_menu","transform_menu")):(a.positionFactor=1,UITools.toggleControlItem("layer_mask_image_replace",!1),UITools.toggleControlItem("layer_image_open_in_editor",BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR),UITools.toggleControlItem("layer_mask_image_open_in_editor",!1),UIToggler.toggleAlternateMenu(!0,"image_menu_header","layer_image_menu","graphic_menu","transform_menu"))}UIToggler.toggleMainMenu(!1)}else UIToggler.toggleAlternateMenu(!1),UIToggler.toggleMainMenu(!0);BFN.TransformLayerManager.updateSelectedItems()},get(){return this._selectedTransformItem}}),Object.defineProperty(Yi.prototype,"selectedTransformItemText",{set(e){this._selectedTransformItemText=null,e&&"text"==e.type&&(this._selectedTransformItemText=e,BFN.TransformItemBoundingBoxes.selectItems(this._selectedTransformItemText.getAvailableGroupItems())),this.dispatchEvent(BFN.TransformModelEvents.TRANSFORM_ITEM_TEXT_UPDATED),this._selectedTransformItemText&&(UIToggler.toggleAlternateMenu(!0,"text_menu_header","text_menu","transform_menu"),UIToggler.toggleMainMenu(!1))},get(){return this._selectedTransformItemText}}),Object.defineProperty(Yi.prototype,"selectedGroupType",{get(){return this._selectedGroupType}}),Object.defineProperty(Yi.prototype,"awaitingDrop",{set(e){this._awaitingDrop=e,this._focusedTransformItem&&this._focusedTransformItem.hideImageDropState()},get(){return this._awaitingDrop}}),Object.defineProperty(Yi.prototype,"focusedTransformItem",{set(e){this._focusedTransformItem&&this._focusedTransformItem!==e&&this._focusedTransformItem.hideImageDropState(),this._focusedTransformItem=e,this._focusedTransformItem&&this._focusedTransformItem.showImageDropState()},get(){return this._focusedTransformItem}}),Object.defineProperty(Yi.prototype,"targetTransformItem",{set(e){this._targetTransformItem=e},get(){return this._targetTransformItem}}),Object.defineProperty(Yi.prototype,"transformToolFrame",{get(){return this._selectedTransformItem&&"frame_texture"===this._selectedTransformItem.type?this._selectedTransformItem.transformTool.transformToolFrame:null}}),BFN.SingletonQueue.add(()=>{BFN.TransformModel=new Yi}),BFN.TransformStateModelEvents={TRANSITIONS_UPDATED:new Event("TRANSITIONS_UPDATED")},qi.prototype=Object.create(BFN.EventDispatcher.prototype),qi.prototype.init=function(){BeFunky.log("TransformStateModel Init"),this.initDefaultValues()},qi.prototype.initDefaultValues=function(){this.blockAddedTransitions=!1,this.transitionsHash={},this.transitionIndexHash={},this.directionHash={},this.transitions=null,this.transitionIndex=null,this.batchTransitionID=null,this.safeBaseTextures=[],this.safeThumbImages=[],this.currentBatchID=null,this.nextBatchID=null,this.udc=null},qi.prototype.startBulkTransition=function(e){this.batchTransitionID=e},qi.prototype.stopBulkTransition=function(){this.batchTransitionID=null},qi.prototype.addTransition=function(e){if(!this.blockAddedTransitions){if(e.batchID=this.batchTransitionID,e.transformItem&&(e.transformItem.thumbTexture||e.transformItem.thumbImage||("text"==e.transformItem.type?(e.transformItem.thumbTexture=null,e.transformItem.thumbImage=null):(e.transformItem.thumbTexture=this.getThumb(e.transformItem),e.transformItem.thumbImage=null))),BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR)BFN.PhotoEditorHistoryModel.purgeLaterHistory();else if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER){var t=e.transformItem&&e.transformItem.itemContent.texture.baseTexture?e.transformItem.itemContent.texture.baseTexture:null;BFN.CollageMakerHistoryModel.purgeLaterHistory(t)}if(this.purgeLaterTransitions(e),this.transitions=this.getTransitions(),this.transitions.push(e),this.transitionIndex=this.transitions.length-1,this.setTransitionIndex(this.transitionIndex),this.direction="redo",this.tracePosition(),!e.batchID&&e.transformItem&&(e.id.includes("history_new")||"replace_image"===e.id)){var i=e.transformItem,r=new BFN.UserActionVO;switch(e.id){case"history_new_text":r.eventID="text_added",r.eventObject={textType:"Freeform"};break;case"history_new_graphic":r.eventID="image_layer_added";var a=i.isShape?i.basicShapeVO?"Basic Shape":"Vector":"Rasterized";r.eventObject={imageLayerTypes:[a],imageLayerSources:[i.assetOrigin]};var n={line:"Outline",solid:"Solid",color:"Multicolor"}[i.projectItemVO.graphicStyle];n&&(r.eventObject.imageLayerGraphicsStyle=[n]);break;case"history_new_image":case"replace_image":r.eventID="image_layer_added";var o=i.isShape?i.basicShapeVO?"Basic Shape":"Vector":"Rasterized";r.eventObject={imageLayerTypes:[o],imageLayerSources:[i.assetOrigin]}}r.actionSection=BFN.AppModel.sectionID,r.actionTimestamp=e.timestamp,r.transformItem=i,r.register()}BFN.TextureHistoryManager.addTextureHistory(e.timestamp,null,e.transformItem?[e.transformItem.itemContent.texture]:[]),this.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED)}},qi.prototype.purgeLaterTransitions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(BFN.UserActionManager.purgeInactiveUserActionVOs(),this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitionIndex<this.transitions.length){this.transitions[this.transitionIndex];var t=[],i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer;t.push(...i.children),t.includes(BFN.TransformItemGroup)&&t.splice(t.indexOf(BFN.TransformItemGroup),1);for(var r="redo"==this.direction?this.transitionIndex+1:this.transitionIndex,a=[],n=0;n<r;n++){var o=this.transitions[n];a.push(o.timestamp),o.transformItem&&!t.includes(o.transformItem)&&t.push(o.transformItem)}e&&e.transformItem&&!t.includes(e.transformItem)&&t.push(e.transformItem);var s=BFN.TextureHistoryManager.getBaseTextures(BFN.AppModel.viewState,a),l=t.map(e=>e.previewImage),h=t.map(e=>e.thumbImage);i.usedBaseTextures=BFN.GlobalHistoryModel.getUsedBaseTextures(i.appViewState);for(var c=r<this.transitions.length?this.transitions[r]:null,u=null!==c?c.endState.creationTime:null,d=[],m=r;m<this.transitions.length;m++){var p=this.transitions[m];p.transformItem&&!d.includes(p.transformItem)&&(p.transformItem.destroyPresetItemThumbTextures(u),d.push(p.transformItem))}for(var g=r;g<this.transitions.length;g++){var f=this.transitions[g];f.previewTexture&&f.previewTexture.destroyGC(!0),f.previewTexture=null,f.previewImage&&!l.includes(f.previewImage)&&(f.previewImage.src=""),f.previewImage=null,f.thumbTexture&&f.thumbTexture.destroyGC(!0),f.thumbTexture=null,f.thumbImage&&!h.includes(f.thumbImage)&&!this.safeThumbImages.includes(f.thumbImage)&&(f.thumbImage.src=""),f.thumbImage=null,f.transformItem&&!t.includes(f.transformItem)&&!f.transformItem.destroyed&&this.hasCreateTransition(f.transformItem)&&(f.transformItem.preventBaseTextureDestroy=!1,e&&e.transformItem&&(f.transformItem.preventBaseTextureDestroy=e.transformItem.itemContent.texture.baseTexture==f.transformItem.itemContent.texture.baseTexture),f.transformItem.preventBaseTextureDestroy||(f.transformItem.preventBaseTextureDestroy=f.transformItem.preventBaseTextureDestroy||s.includes(f.transformItem.itemContent.texture.baseTexture)||this.safeBaseTextures.includes(f.transformItem.itemContent.texture.baseTexture)),f.transformItem.destroyItem(),f.transformItem=null)}this.transitions.splice(r),t.splice(0),this.transitionIndex=this.transitions.length-1,this.setTransitionIndex(this.transitionIndex),this.direction="redo",this.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED)}},qi.prototype.purgeEarlierTransitions=function(e,t,i){var r=0;this.transitions=this.getTransitions(e);for(var a=this.transitions.length;--a>-1;){var n=this.transitions[a];if(n.timestamp<=t){if(n.previewTexture&&n.previewTexture.destroyGC(!0),n.previewTexture=null,n.previewImage&&(n.previewImage.src=""),n.previewImage=null,n.thumbTexture&&n.thumbTexture.destroyGC(!0),n.thumbTexture=null,n.thumbImage&&(n.thumbImage.src=""),n.thumbImage=null,n.transformItem&&!n.transformItem.destroyed){var o=n.transformItem.itemContent.texture.baseTexture;if(!i.includes(o)){var s=!o||o._destroyed;n.transformItem.destroyItem(),s!=(!o||o._destroyed)&&r++}n.transformItem=null}this.transitions.splice(a,1),this.transitionIndex--}}return this.setTransitionIndex(this.transitionIndex),this.direction="redo",r},qi.prototype.undo=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),e||(this.currentBatchID=null,this.nextBatchID=null,this.udc=0),this.transitions.length&&("undo"!=this.direction||this.transitionIndex>0)){var t=!!(this.transitions.length&&this.transitionIndex>0)&&null!=this.transitions[this.transitionIndex-1].batchID;this.directionChanged=!1,"undo"!=this.direction?(this.direction="undo",this.directionChanged=!0):this.setTransitionIndex(--this.transitionIndex);var i=this.transitions[this.transitionIndex];e||!i.batchID&&!i.batchIDPlaceholder||(this.currentBatchID=i.batchIDPlaceholder?i.batchIDPlaceholder:i.batchID),this.transitionIndex>0&&null!=this.transitions[this.transitionIndex-1].batchID&&(this.nextBatchID=this.transitions[this.transitionIndex-1].batchID),BeFunky.log("UNDO",i.batchID,this.currentBatchID),this.repeatAction=this.directionChanged&&i.startState.parent!=i.endState.parent&&!t,i.transformItem&&i.transformItem.setTransition(i),e&&!i.batchID?(this.direction="redo",i.transformItem?i.transformItem.applyTransformItemState(i.endState):i.alternateHistoryAction&&this.performAlternateHistoryAction(i.alternateHistoryAction,i.endState)):i.transformItem?i.transformItem.applyTransformItemState(i.startState):i.alternateHistoryAction&&this.performAlternateHistoryAction(i.alternateHistoryAction,i.startState),this.tracePosition(),(this.repeatAction||this.currentBatchID&&this.nextBatchID&&(i.batchID||i.batchIDPlaceholder)&&this.currentBatchID==this.nextBatchID&&(this.currentBatchID==i.batchID||this.currentBatchID==i.batchIDPlaceholder))&&this.undo(!0)}else++this.udc>10&&BeFunky.log("DIE")},qi.prototype.redo=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),e||(this.currentBatchID=null,this.nextBatchID=null),this.transitions.length&&("redo"!=this.direction||this.transitionIndex<this.transitions.length-1)){"redo"!=this.direction?this.direction="redo":this.setTransitionIndex(++this.transitionIndex);var t=this.transitions[this.transitionIndex];if(!e&&t.batchID&&(this.currentBatchID=t.batchID),this.transitionIndex<this.transitions.length-1){var i=this.transitions[this.transitionIndex+1];null!==i.batchID?this.nextBatchID=i.batchID:i.batchIDPlaceholder===this.currentBatchID&&(this.nextBatchID=i.batchIDPlaceholder)}t.transformItem?(t.transformItem.setTransition(t),t.transformItem.applyTransformItemState(t.endState)):t.alternateHistoryAction&&this.performAlternateHistoryAction(t.alternateHistoryAction,t.endState),this.tracePosition(),this.currentBatchID&&this.nextBatchID&&t.batchID&&this.currentBatchID==this.nextBatchID&&this.currentBatchID==t.batchID?this.redo(!0):"removeall"!=this.currentBatchID||"removeall"!=this.nextBatchID||t.batchID||this.undo()}},qi.prototype.applyAlternate=function(e,t,i){null==e&&(e=-1),null==t&&(t=!1),(null==i||isNaN(i))&&(i=-1),this.transitions=this.getTransitions();var r=!1;if(e>=0)for(var a=0;a<this.transitions.length;a++){if(this.transitions[a].timestamp==e){r=!0,this.setTransitionIndex(a);break}}if(t&&!r)return!1;this.transitionIndex=this.getTransitionIndex();var n=this.transitions[this.transitionIndex];return n.alternateHistoryAction&&n.timestamp>i&&(this.performAlternateHistoryAction(n.alternateHistoryAction,n.endState),BeFunky.log("APPLIED ALTERNATE",n.id)),!0},qi.prototype.clearTransitions=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||BFN.AppModel.viewState;this.transitions=this.getTransitions(e),this.transitionIndex=this.getTransitionIndex(e);for(var t=0;t<this.transitions.length;t++){var i=this.transitions[t];i.transformItem=null,i.previewTexture&&i.previewTexture.destroyGC(!0),i.previewTexture=null,i.previewImage&&(i.previewImage.src=""),i.previewImage=null,i.thumbTexture&&i.thumbTexture.destroyGC(!0),i.thumbTexture=null,i.thumbImage&&(i.thumbImage.src=""),i.thumbImage=null}this.transitions.splice(0),this.setTransitionIndex(0,e),this.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED)},qi.prototype.getTimestamp=function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length?this.transitions[this.transitionIndex].timestamp:NaN},qi.prototype.getLastTimestamp=function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length&&(this.transitions.length>1&&this.transitionIndex>0||0==this.transitionIndex&&"redo"==this.direction)?("undo"==this.direction?this.transitions[this.transitionIndex-1]:this.transitions[this.transitionIndex]).timestamp:0==this.transitionIndex&&"undo"==this.direction?0:NaN},qi.prototype.getNextTimestamp=function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitionIndex<this.transitions.length-1||this.transitionIndex==this.transitions.length-1&&"undo"==this.direction?("redo"==this.direction?this.transitions[this.transitionIndex+1]:this.transitions[this.transitionIndex]).timestamp:NaN},qi.prototype.performAlternateHistoryAction=function(e,t){if(t&&t.collageSettings)switch(e){case"designer_background_color":break;case"collage_settings_updated":BFN.CollageMakerCanvasPhotoGridModel.collageSettings=t.collageSettings;break;case"designer_settings_updated":BFN.DesignerCanvasModel.designerSettings=t.designerSettings}},qi.prototype.getTransitions=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||BFN.AppModel.viewState;return this.transitionsHash.hasOwnProperty(e)||(this.transitionsHash[e]=[]),this.transitionsHash[e]},qi.prototype.getTransitionIndex=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||BFN.AppModel.viewState;return this.transitionIndexHash.hasOwnProperty(e)||(this.transitionIndexHash[e]=0),this.transitionIndexHash[e]},qi.prototype.setTransitionIndex=function(e,t){var i=t||BFN.AppModel.viewState;this.transitionIndexHash[i]=e},qi.prototype.tracePosition=function(){for(var e="",t=0;t<this.transitions.length;t++){var i=this.transitions[t];e+="[",e+=i.batchID?"~":" ",e+=this.transitionIndex==t?"undo"==this.direction?"<":">":" ",e+=i.batchID?"~":" ",e+="]"}e+=" ".concat(this.transitionIndex),BeFunky.log("HISTORY: ",e)},qi.prototype.getThumb=function(e){if(e){if(e.isShape&&e.basicShapeVO){this.thumbBasicShapeVO||(this.thumbBasicShapeVO=new BFN.BasicShapeVO("group",{fill:"FFFFFF",fillAlpha:1,stroke:-1,strokeAlpha:1,strokeWidth:0}),this.thumbBasicShapeVO.resize(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize));var t="line"===e.basicShapeVO.type;this.thumbBasicShapeVO.setValues({type:e.basicShapeVO.type,stroke:t?"FFFFFF":-1,strokeAlpha:t?1:0,strokeWidth:t?BFN.GlobalHistoryModel.globalHistoryMenuThumbSize/5:0});var i="arrow"===e.basicShapeVO.type;this.thumbBasicShapeVO.resize(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,Math.round(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize*(i?.7:1)));var r=PIXI.RenderTexture.create(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize),a=this.thumbBasicShapeVO.getCanvasTexture();return r.copyPixels(a,{x:(r.width-a.width)/2,y:(r.height-a.height)/2}),a.destroyGC(!0),r}if(e.itemContent&&e.itemContent.texture){var n,o=e.isGoodie&&e.isShape&&BFN.SVGManager.textureHasModifiedShapeColors(e.itemContent.texture);o&&e.updateShapeTexture(!0,!0);try{n=BFN.Util.getThumbTexture(e.itemContent.texture,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1)}catch(e){}return o&&e.updateShapeTexture(),n}}var s=PIXI.RenderTexture.create(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize);return s.fillColor(16711680),s},qi.prototype.hasCreateTransition=function(e){for(var t=0;t<this.transitions.length;t++){var i=this.transitions[t];if(i.transformItem==e&&i.isCreateTransition)return!0}return!1},Object.defineProperty(qi.prototype,"undoIsBatch",{get(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length&&this.transitionIndex>0?"redo"==this.direction?this.transitions[this.transitionIndex].batchID:this.transitions[this.transitionIndex-1].batchID:null}}),Object.defineProperty(qi.prototype,"redoIsBatch",{get(){if(this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length){if(this.transitionIndex<this.transitions.length-1)return"undo"==this.direction?this.transitions[this.transitionIndex].batchID:this.transitions[this.transitionIndex+1].batchID;if("undo"==this.direction&&this.transitionIndex==this.transitions.length-1)return this.transitions[this.transitionIndex].batchID}return null}}),Object.defineProperty(qi.prototype,"undoIsAlternate",{get(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),!!this.transitions.length&&(this.transitionIndex>0?"redo"==this.direction?null!=this.transitions[this.transitionIndex].alternateHistoryAction:null!=this.transitions[this.transitionIndex-1].alternateHistoryAction:null!=this.transitions[0].alternateHistoryAction)}}),Object.defineProperty(qi.prototype,"redoIsAlternate",{get(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),!!this.transitions.length&&(this.transitionIndex<this.transitions.length-1?"undo"==this.direction?null!=this.transitions[this.transitionIndex].alternateHistoryAction:null!=this.transitions[this.transitionIndex+1].alternateHistoryAction:null!=this.transitions[this.transitions.length-1].alternateHistoryAction)}}),Object.defineProperty(qi.prototype,"direction",{set(e){this.directionHash[BFN.AppModel.viewState]=e},get(){return this.directionHash.hasOwnProperty(BFN.AppModel.viewState)||(this.directionHash[BFN.AppModel.viewState]="redo"),this.directionHash[BFN.AppModel.viewState]}}),Object.defineProperty(qi.prototype,"currentTransition",{get(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length?this.transitions[this.transitionIndex]:null}}),BFN.SingletonQueue.add(()=>{BFN.TransformStateModel=new qi}),BFN.PhotoEditorHistoryModelEvents={HISTORY_UPDATED:new Event("HISTORY_UPDATED"),HISTORY_INDEX_UPDATED:new Event("HISTORY_INDEX_UPDATED")},Ki.prototype=Object.create(BFN.EventDispatcher.prototype),Ki.prototype.init=function(){BeFunky.log("PhotoEditorHistoryModel Init"),this.historyVOs=[],this._historyIndex=0},Ki.prototype.addTextureToHistory=function(e,t){if(BFN.TransformStateModel.purgeLaterTransitions(),t){for(var i=this.historyVOs.length;--i>this._historyIndex;){var r=this.historyVOs[i];r.imageTexture&&r.imageTexture!=BFN.PhotoEditorModel.sourceTexture&&(r.imageTexture.destroyGC(!0),r.previewTexture&&(r.previewTexture.destroyGC(!0),r.previewTexture=null),r.thumbTexture&&(r.thumbTexture.destroyGC(!0),r.thumbTexture=null)),r.imageTexture=null,r.thumbImage=null,r.previewImage=null,this.historyVOs.splice(i,1)}var a=new BFN.HistoryVO;return a.id=this.historyVOs.length,a.name=e,a.historyAction=e,a.imageTexture=t,a.imageW=a.imageTexture.width,a.imageH=a.imageTexture.height,a.previewTexture=BFN.Util.getThumbTexture(t,Math.min(Math.max(t.width,t.height),BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize),!1,!1),a.previewW=a.previewTexture.width,a.previewH=a.previewTexture.height,a.thumbTexture=BFN.Util.getThumbTexture(t,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1),a.thumbW=a.thumbTexture.width,a.thumbH=a.thumbTexture.height,this.historyVOs.push(a),this._historyIndex=this.historyVOs.length-1,this.historyIndex=this.historyIndex,BFN.TextureHistoryManager.addTextureHistory(a.timestamp),this.dispatchEvent(BFN.PhotoEditorHistoryModelEvents.HISTORY_UPDATED),a.timestamp}},Ki.prototype.resetHistory=function(){for(var e=this.historyVOs.length;--e>-1;){var t=this.historyVOs[e];t.imageTexture&&t.imageTexture!=BFN.PhotoEditorModel.sourceTexture&&t.imageTexture.destroyGC(!0),t.imageTexture=null;try{t.thumbTexture&&t.thumbTexture.destroyGC(!0)}catch(e){}t.thumbTexture=null,t.thumbImage&&(t.thumbImage.src=""),t.thumbImage=null;try{t.previewTexture&&t.previewTexture.destroyGC(!0)}catch(e){}t.previewTexture=null,t.previewImage&&(t.previewImage.src=""),t.previewImage=null}this.historyVOs.splice(0),this.dispatchEvent(BFN.PhotoEditorHistoryModelEvents.HISTORY_UPDATED)},Ki.prototype.purgeLaterHistory=function(){for(var e=this.historyVOs.length;--e>this.historyIndex;){var t=this.historyVOs[e];t.imageTexture&&t.imageTexture.destroyGC(!0),t.imageTexture=null,t.thumbTexture&&t.thumbTexture.destroyGC(!0),t.thumbTexture=null,t.thumbImage&&(t.thumbImage.src=""),t.thumbImage=null,t.previewTexture&&t.previewTexture.destroyGC(!0),t.previewTexture=null,t.previewImage&&(t.previewImage.src=""),t.previewImage=null,this.historyVOs.splice(e,1)}this.dispatchEvent(BFN.PhotoEditorHistoryModelEvents.HISTORY_UPDATED)},Ki.prototype.purgeEarlierHistory=function(e,t){for(var i=0,r=this.historyVOs.length;--r>-1;){var a=this.historyVOs[r];if(a.timestamp<=e){if(a.imageTexture&&a.imageTexture!=BFN.PhotoEditorModel.sourceTexture&&!t.includes(a.imageTexture.baseTexture)){var n=a.imageTexture.baseTexture,o=!n||n._destroyed;a.imageTexture.destroyGC(!0),o!=(!n||n._destroyed)&&i++}a.imageTexture=null,a.thumbTexture&&a.thumbTexture.destroyGC(!0),a.thumbTexture=null,a.thumbImage&&(a.thumbImage.src=""),a.thumbImage=null,a.previewTexture&&a.previewTexture.destroyGC(!0),a.previewTexture=null,a.previewImage&&(a.previewImage.src=""),a.previewImage=null,this.historyVOs.splice(r,1),this.historyIndex--}}return i},Ki.prototype.undo=function(){if(this.historyVOs.length>1&&this._historyIndex>0){this.historyIndex--;var e=this.historyVOs[this._historyIndex];e.imageTexture?BFN.PhotoEditorModel.updateCurrentTexture(e.imageTexture):this.historyIndex++}},Ki.prototype.redo=function(){if(this._historyIndex<this.historyVOs.length-1){this.historyIndex++;var e=this.historyVOs[this._historyIndex];e.imageTexture?BFN.PhotoEditorModel.updateCurrentTexture(e.imageTexture):this.historyIndex--}},Ki.prototype.getTimestamp=function(){return this.historyVOs.length?this.historyVOs[this._historyIndex].timestamp:NaN},Ki.prototype.getLastTimestamp=function(){return this.historyVOs.length&&this._historyIndex>0?this.historyVOs[this._historyIndex-1].timestamp:NaN},Ki.prototype.getNextTimestamp=function(){return this.historyVOs.length&&this._historyIndex<this.historyVOs.length-1?this.historyVOs[this._historyIndex+1].timestamp:NaN},Object.defineProperty(Ki.prototype,"historyIndex",{set(e){this._historyIndex=Math.max(0,Math.min(this.historyVOs.length-1,e)),this.dispatchEvent(BFN.PhotoEditorHistoryModelEvents.HISTORY_INDEX_UPDATED)},get(){return this._historyIndex}}),Object.defineProperty(Ki.prototype,"currentHistoryAction",{get(){return this.historyVOs.length?this.historyVOs[this._historyIndex].historyAction:null}}),Object.defineProperty(Ki.prototype,"lastHistoryAction",{get(){return this.historyVOs.length&&this._historyIndex>0?this.historyVOs[this._historyIndex-1].historyAction:null}}),Object.defineProperty(Ki.prototype,"nextHistoryAction",{get(){return this.historyVOs.length&&this._historyIndex<this.historyVOs.length-1?this.historyVOs[this._historyIndex+1].historyAction:null}}),BFN.SingletonQueue.add(()=>{BFN.PhotoEditorHistoryModel=new Ki}),BFN.CollageMakerHistoryModelEvents={HISTORY_UPDATED:new Event("CANVAS_SCALE_UPDATED"),HISTORY_INDEX_UPDATED:new Event("CANVAS_SCALING_UPDATED"),APPLY_CURRENT_SNAPSHOT:new Event("ITEM_ADDED")};class Qi extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("CollageMakerHistoryModel Init"),this.initDefaultValues()}initDefaultValues(){this._ignoreSnapshot=!1,this._ignoreSnapshotApply=!1,this._historyAction=null,this._snapshotVOs=[],this._snapshotIndex=0,this._currentSnapshotVO=null,this._usedBaseTextures=[],this._focusedGridChild=null,this.lastFocusedGridChild=null}addPhotoGridSnapshotToHistory(e){this._focusedGridChild&&this._focusedGridChild===this.lastFocusedGridChild&&this.currentHistoryAction===e.historyAction?this.undo(!1):this.lastFocusedGridChild=null,BFN.TransformStateModel.purgeLaterTransitions();var t=[];if(this._snapshotIndex<this._snapshotVOs.length)for(var i=0;i<=this._snapshotIndex;i++){var r=this._snapshotVOs[i];r.backgroundPatternBaseTexture&&!t.includes(r.backgroundPatternBaseTexture)&&t.push(r.backgroundPatternBaseTexture);for(var a=0;a<r.snapshotChildren.length;a++){var n=r.snapshotChildren[a];n.texture&&n.texture.valid&&!t.includes(n.texture.baseTexture)&&t.push(n.texture.baseTexture)}}if(!this._ignoreSnapshot&&e){for(var o=this._snapshotVOs.length;--o>this._snapshotIndex;){var s=this._snapshotVOs[o];try{s.thumbTexture.destroyGC(!0)}catch(e){}s.thumbTexture=null,s.thumbImage=null;try{s.previewTexture.destroyGC(!0)}catch(e){}s.previewTexture=null,s.previewImage=null,this._snapshotVOs.splice(o,1),this.updateUsedBaseTextures();for(var l=0;l<s.snapshotChildren.length;l++){var h=s.snapshotChildren[l];if(h.texture&&h.texture.valid){var c=this._usedBaseTextures.indexOf(h.texture.baseTexture),u=t.indexOf(h.texture.baseTexture);if(-1===c&&-1===u)try{h.texture.destroyGC(!0),console.log("disposing unused image - [ addPhotoGridSnapshotToHistory ]")}catch(e){}else console.log("avoiding dispose, image still used - [ addPhotoGridSnapshotToHistory ]")}h.texture=null}s.snapshotChildren.splice(0),s.snapshotChildren=null}return this._snapshotVOs.push(e),this._snapshotIndex=this._snapshotVOs.length-1,this.snapshotIndex=this.snapshotIndex,BFN.TextureHistoryManager.addTextureHistory(e.timestamp),this.updateUsedBaseTextures(),t.splice(0),this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.HISTORY_UPDATED),e.timestamp}}updateUsedBaseTextures(){this._usedBaseTextures.splice(0);for(var e=0;e<this._snapshotVOs.length;e++)for(var t=this._snapshotVOs[e],i=0;i<t.snapshotChildren.length;i++){var r=t.snapshotChildren[i];r.texture&&r.texture.valid&&-1===this._usedBaseTextures.indexOf(r.texture.baseTexture)&&this._usedBaseTextures.push(r.texture.baseTexture)}if(BFN.PhotoGrid.gridChildren.forEach(e=>{if(!e.content.isEmpty&&e.content.image&&e.content.image.frameSprite&&e.content.image.frameSprite.texture&&e.content.image.frameSprite.texture.baseTexture&&!e.content.image.frameSprite.texture.baseTexture.destroyed){var t=e.content.image.frameSprite.texture.baseTexture;-1===this._usedBaseTextures.indexOf(t)&&this._usedBaseTextures.push(t)}}),BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER)for(var a=BFN.TransformStateModel.getTransitions(),n=0;n<a.length;n++){var o=a[n];o.startState&&o.startState.imageTexture&&o.startState.imageTexture.valid&&-1===this._usedBaseTextures.indexOf(o.startState.imageTexture.baseTexture)&&this._usedBaseTextures.push(o.startState.imageTexture.baseTexture),o.endState&&o.endState.imageTexture&&o.endState.imageTexture.valid&&-1===this._usedBaseTextures.indexOf(o.endState.imageTexture.baseTexture)&&this._usedBaseTextures.push(o.endState.imageTexture.baseTexture)}}resetHistory(){for(var e=BFN.GlobalHistoryModel.getUsedBaseTextures(BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER),t=this._snapshotVOs.length;--t>-1;){var i=this._snapshotVOs[t];try{i.thumbTexture.destroyGC(!0)}catch(e){}i.thumbTexture=null,i.thumbImage=null;try{i.previewTexture.destroyGC(!0)}catch(e){}i.previewTexture=null,i.previewImage=null;for(var r=0;r<i.snapshotChildren.length;r++){var a=i.snapshotChildren[r];if(a.texture&&a.texture.valid){if(-1===e.indexOf(a.texture.baseTexture)&&!a.menuImageVO.isPattern)try{a.texture.baseTexture&&a.texture.destroyGC(!0)}catch(e){}a.texture=null}}i.snapshotChildren.splice(0),i.snapshotChildren=null}this._snapshotVOs.splice(0),this.updateUsedBaseTextures(),this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.HISTORY_UPDATED)}purgeLaterHistory(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._snapshotVOs.length){var t=BFN.GlobalHistoryModel.getUsedBaseTextures(BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER);e&&!t.includes(e)&&t.push(e);for(var i=[],r=0;r<=this._snapshotIndex;r++){var a=this._snapshotVOs[r];a.backgroundPatternBaseTexture&&!i.includes(a.backgroundPatternBaseTexture)&&i.push(a.backgroundPatternBaseTexture);for(var n=0;n<a.snapshotChildren.length;n++){var o=a.snapshotChildren[n];o.texture&&o.texture.valid&&!i.includes(o.texture.baseTexture)&&i.push(o.texture.baseTexture)}}for(var s=this._snapshotVOs.length;--s>this._snapshotIndex;){var l=this._snapshotVOs[s];try{l.thumbTexture.destroyGC(!0)}catch(e){}l.thumbTexture=null,l.thumbImage=null;try{l.previewTexture.destroyGC(!0)}catch(e){}l.previewTexture=null,l.previewImage=null;for(var h=0;h<l.snapshotChildren.length;h++){var c=l.snapshotChildren[h];if(c.texture&&c.texture.valid&&c.texture.baseTexture&&!c.texture.baseTexture.isPattern){var u=t.indexOf(c.texture.baseTexture),d=i.indexOf(c.texture.baseTexture);if(-1===u&&-1===d)try{c.texture.destroyGC(!0)}catch(e){}}}l.snapshotChildren.splice(0),l.snapshotChildren=null,this._snapshotVOs.splice(s,1)}i.splice(0),this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.HISTORY_UPDATED)}}purgeEarlierHistory(e,t){var i=!1;if(this._snapshotVOs.length)for(var r=this._snapshotVOs.length;--r>-1;){var a=this._snapshotVOs[r];if(a.timestamp<=e){try{a.thumbTexture.destroyGC(!0)}catch(e){}a.thumbTexture=null,a.thumbImage=null;try{a.previewTexture.destroyGC(!0)}catch(e){}a.previewTexture=null,a.previewImage=null;for(var n=0;n<a.snapshotChildren.length;n++){var o=a.snapshotChildren[n];if(o.texture&&o.texture.baseTexture){var s=o.texture.baseTexture,l=!s||s._destroyed;o.texture.destroyGC(!t.includes(o.texture.baseTexture)),l!=(!s||s._destroyed)&&i++}}a.snapshotChildren.splice(0),a.snapshotChildren=null,this._snapshotVOs.splice(r,1),this._snapshotIndex--}}return i}undo(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._snapshotVOs.length>1&&this._snapshotIndex>0&&(this.snapshotIndex--,e&&this.applySnapshot())}redo(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._snapshotIndex<this._snapshotVOs.length-1&&(this.snapshotIndex++,e&&this.applySnapshot())}applySnapshot(){if(!this._ignoreSnapshotApply){var e=this._snapshotVOs[this._snapshotIndex];this._currentSnapshotVO=e,this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.APPLY_CURRENT_SNAPSHOT),this._currentSnapshotVO=null,this.updateUsedBaseTextures()}}getTimestamp(){return this._snapshotVOs.length?this._snapshotVOs[this._snapshotIndex].timestamp:NaN}getLastTimestamp(){return this._snapshotVOs.length&&this._snapshotIndex>0?this._snapshotVOs[this._snapshotIndex-1].timestamp:NaN}getNextTimestamp(){return this._snapshotVOs.length&&this._snapshotIndex<this._snapshotVOs.length-1?this._snapshotVOs[this._snapshotIndex+1].timestamp:NaN}textureInUse(e){return-1!==this._usedBaseTextures.indexOf(e)}get currentSnapshotVO(){return this._currentSnapshotVO}set ignoreSnapshot(e){this._ignoreSnapshot=e}get ignoreSnapshot(){return this._ignoreSnapshot}set ignoreSnapshotApply(e){this._ignoreSnapshotApply=e}get ignoreSnapshotApply(){return this._ignoreSnapshotApply}get usedBaseTextures(){return this._usedBaseTextures}set historyAction(e){this._historyAction=e}get historyAction(){return this._historyAction}set focusedGridChild(e){this._focusedGridChild&&(this.lastFocusedGridChild=this._focusedGridChild),this._focusedGridChild=e}get focusedGridChild(){return this._focusedGridChild}get snapshotVOs(){return this._snapshotVOs}set snapshotIndex(e){this._snapshotIndex=Math.max(0,Math.min(this._snapshotVOs.length-1,e)),this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.HISTORY_INDEX_UPDATED)}get snapshotIndex(){return this._snapshotIndex}get currentHistoryAction(){return this._snapshotVOs.length?this._snapshotVOs[this._snapshotIndex].historyAction:null}get lastHistoryAction(){return this._snapshotVOs.length&&this._snapshotIndex>0?this._snapshotVOs[this._snapshotIndex-1].historyAction:null}get nextHistoryAction(){return this._snapshotVOs.length&&this._snapshotIndex<this._snapshotVOs.length-1?this._snapshotVOs[this._snapshotIndex+1].historyAction:null}}BFN.SingletonQueue.add(()=>{BFN.CollageMakerHistoryModel=new Qi}),BFN.GlobalHistoryModelEvents={HISTORY_UPDATED:new Event("HISTORY_UPDATED"),HISTORY_ID_UPDATED:new Event("HISTORY_ID_UPDATED"),HISTORY_BUTTONS_UPDATED:new Event("HISTORY_BUTTONS_UPDATED"),SELECT_HISTORY_ITEM:new Event("SELECT_HISTORY_ITEM")};class Zi extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("GlobalHistoryModel Init"),this.initDefaultValues()}initDefaultValues(){var e=BeFunky.isRetina();this.globalHistoryMenuThumbSize=BFN.CSS.historyMenuThumbSize*(e?2:1),this.globalHistoryMenuPreviewSize=BFN.CSS.historyMenuPreviewSize*(e?1.5:1),this.selectedHistoryID={},this.selectedHistoryID[BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR]=null,this.selectedHistoryID[BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER]=null,this.selectedHistoryID[BFN.AppModelViewStates.VIEWING_DESIGNER]=null,this.historyItemPrefixHash={},this.historyItemPrefixHash[BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR]="history_item_editor_",this.historyItemPrefixHash[BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER]="history_item_collage_",this.historyItemPrefixHash[BFN.AppModelViewStates.VIEWING_DESIGNER]="history_item_designer_",this.historyItemPrefix=this.historyItemPrefixHash[BFN.AppModel.viewState],this.globalHistoryVOs=[],this.globalHistoryVOHash={},this.historyUpdateQueued=!1,BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewstateUpdated.bind(this)),BFN.TransformStateModel.addEventListener(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED.type,this.handleTransitionsUpdated.bind(this)),BFN.PhotoEditorHistoryModel.addEventListener(BFN.PhotoEditorHistoryModelEvents.HISTORY_UPDATED.type,this.handlePhotoEditorHistoryUpdated.bind(this)),BFN.CollageMakerHistoryModel.addEventListener(BFN.CollageMakerHistoryModelEvents.HISTORY_UPDATED.type,this.handleCollageMakerHistoryUpdated.bind(this)),this.addEventListener(BFN.GlobalHistoryModelEvents.SELECT_HISTORY_ITEM.type,this.handleSelectHistoryItem.bind(this)),setTimeout(()=>{BFN.UndoManager.addEventListener(BFN.UndoManagerEvents.TIMESTAMP_UPDATED.type,this.handleUndoManagerTimestampUpdated.bind(this))},50)}queueHistoryUpdate(){this.historyUpdateQueued||(this.historyUpdateQueued=!0,setTimeout(()=>{BFN.MainUI.addIdleRenderFunction(()=>{this.historyUpdateQueued=!1,this.updateHistory()})},200))}getTimestamps(){var e=[];return BFN.TransformStateModel.getTransitions().forEach(t=>{e.push(t.timestamp)}),BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR?BFN.PhotoEditorHistoryModel.historyVOs.forEach(t=>{e.push(t.timestamp)}):e.includes(0)||e.push(0),BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&BFN.CollageMakerHistoryModel.snapshotVOs.forEach(t=>{e.push(t.timestamp)}),e.sort((e,t)=>e-t),e}updateHistory(){BFN.TextureHistoryManager.updateTextureHistory(this.getTimestamps()),BFN.TextureHistoryManager.printTextureHistory(),BFN.TextureHistoryManager.cleanupTextureHistory()&&(BFN.TextureHistoryManager.updateTextureHistory(this.getTimestamps()),BFN.TextureHistoryManager.printTextureHistory()),this.globalHistoryVOs.splice(0);var e=BFN.TextureHistoryManager.historyModifiedHash[BFN.AppModel.viewState];if(BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&!e){var t=new BFN.GlobalHistoryVO;t.timestamp=0,BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER?BFN.CollageMakerCanvasPhotoGridModel.freeform&&(t.historyTag="blank_canvas",t.thumbImage=this.blankThumbImage,this.globalHistoryVOs.push(t)):(t.historyTag="new_template",t.thumbImage=this.blankThumbImage,this.globalHistoryVOs.push(t))}for(var i=BFN.TransformStateModel.getTransitions(),r=0;r<i.length;r++){var a=i[r];if(!a.batchID){var n=new BFN.GlobalHistoryVO;n.timestamp=a.timestamp,n.historyTag=a.id,n.thumbImage=null,n.isText=a.transformItem&&"text"==a.transformItem.type,n.useTextIcon=a.useTextIcon,n.isGroup=!(!a.batchIDPlaceholder||a.isSettingsTransition||a.transformItem||n.useTextIcon),n.useGroupIcon=a.useGroupIcon,n.isText||n.useTextIcon||(a.transformItem?(a.transformItem.itemObject.thumbImage&&(a.transformItem.thumbImage=a.transformItem.itemObject.thumbImage,delete a.transformItem.itemObject.thumbImage),!a.transformItem.thumbImage&&a.transformItem.thumbTexture&&(a.transformItem.thumbImage=BFN.Util.getHTMLImage(a.transformItem.thumbTexture,null,!0),a.transformItem.thumbTexture.destroyGC(!0),a.transformItem.thumbTexture=null),!a.thumbImage&&a.transformItem.thumbImage&&(a.thumbImage=a.transformItem.thumbImage),a.thumbImage&&(n.thumbImage=a.thumbImage)):(!a.previewImage&&a.previewTexture&&(a.previewImage=BFN.Util.getHTMLImage(a.previewTexture,null,!0),a.previewTexture.destroyGC(!0),a.previewTexture=null),a.previewImage&&(n.previewImage=a.previewImage),!a.thumbImage&&a.thumbTexture&&(a.thumbImage=BFN.Util.getHTMLImage(a.thumbTexture,null,!0),a.thumbTexture.destroyGC(!0),a.thumbTexture=null),a.thumbImage&&(n.thumbImage=a.thumbImage))),this.globalHistoryVOs.push(n)}}if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR)for(var o=0;o<BFN.PhotoEditorHistoryModel.historyVOs.length;o++){var s=BFN.PhotoEditorHistoryModel.historyVOs[o],l=new BFN.GlobalHistoryVO;l.timestamp=s.timestamp,l.historyTag=s.historyAction,l.thumbImage=null,l.previewImage=null,!s.previewImage&&s.previewTexture&&(s.previewImage=BFN.Util.getHTMLImage(s.previewTexture,null,!0),s.previewTexture.destroyGC(!0),s.previewTexture=null),s.previewImage&&(l.previewImage=s.previewImage),!s.thumbImage&&s.thumbTexture&&(s.thumbImage=BFN.Util.getHTMLImage(s.thumbTexture,null,!0),s.thumbTexture.destroyGC(!0),s.thumbTexture=null),s.thumbImage&&(l.thumbImage=s.thumbImage),this.globalHistoryVOs.push(l)}if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER)for(var h=0;h<BFN.CollageMakerHistoryModel.snapshotVOs.length;h++){var c=BFN.CollageMakerHistoryModel.snapshotVOs[h],u=new BFN.GlobalHistoryVO;u.timestamp=c.timestamp,u.historyTag=c.historyAction,u.thumbImage=null,u.previewImage=null,!c.previewImage&&c.previewTexture&&(c.previewImage=BFN.Util.getHTMLImage(c.previewTexture,null,!0),c.previewTexture.destroyGC(!0),c.previewTexture=null),c.previewImage&&(u.previewImage=c.previewImage),!c.thumbImage&&c.thumbTexture&&(c.thumbImage=BFN.Util.getHTMLImage(c.thumbTexture,null,!0),c.thumbTexture.destroyGC(!0),c.thumbTexture=null),c.thumbImage&&(u.thumbImage=c.thumbImage),this.globalHistoryVOs.push(u)}this.globalHistoryVOs.sort((e,t)=>e.timestamp-t.timestamp),this.globalHistoryVOHash={},BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.ids=[],BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.data=[],BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.selectedID=this.selectedHistoryID[BFN.AppModel.viewState];for(var d=0;d<this.globalHistoryVOs.length;d++){var m=this.globalHistoryVOs[d],p=this.historyItemPrefix+m.timestamp;this.globalHistoryVOHash[p]=m,BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.ids.push(p),BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.data.push({id:p,name:m.historyTag,thumb:m.thumbImage,preview:m.previewImage,isText:m.isText,isGroup:m.isGroup,useTextIcon:m.useTextIcon,useGroupIcon:m.useGroupIcon})}this.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED),this.updateGlobalHistoryMenuState(this.globalHistoryVOs.length>0),this.updateGlobalHistoryButtons(),BFN.CollageMakerPatternManager.destroyUnusedPatternBaseTextures();var g=this.selectedHistoryID[BFN.AppModel.viewState];g&&this.globalHistoryVOHash.hasOwnProperty(g)&&(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.data=g,BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED))}updateGlobalHistoryMenuState(){}updateGlobalHistoryButtons(){var e=BFN.UndoManager.undoExists,t=BFN.UndoManager.redoExists;BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS||BFN.ImagePainterUndoManager.imagePainterOpen||(e=!0)),BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED.data={undoExists:e,redoExists:t},BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED)}getUsedBaseTextures(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Object.values(BFN.ProjectManager.projectImageBaseTextures);function i(e){e&&e.baseTexture&&!t.includes(e.baseTexture)&&t.push(e.baseTexture)}return Object.values(BFN.AppModelViewStates).forEach(r=>{r!=e&&(BFN.TextureHistoryManager.getBaseTextures(r).forEach(e=>{t.includes(e)||t.push(e)}),BFN.TransformStateModel.getTransitions(r).forEach(e=>{var t=e.startState,r=e.endState;t&&i(t.imageTexture),r&&i(r.imageTexture)}),BFN.CollageMakerCanvasPhotoGrid.pendingAutoCollageBaseTextures.forEach(e=>{t.includes(e)||t.push(e)}))}),e!=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&BFN.CollageMakerHistoryModel.snapshotVOs&&BFN.CollageMakerHistoryModel.snapshotVOs.forEach(e=>{e.snapshotChildren&&e.snapshotChildren.forEach(e=>{i(e.texture)})}),e!=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&BFN.PhotoEditorHistoryModel.historyVOs&&BFN.PhotoEditorHistoryModel.historyVOs.forEach(e=>{i(e.imageTexture)}),t}handleAppModelViewstateUpdated(e){this.historyItemPrefix=this.historyItemPrefixHash[BFN.AppModel.viewState],this.queueHistoryUpdate()}handleTransitionsUpdated(e){this.selectedHistoryID[BFN.AppModel.viewState]=null,this.queueHistoryUpdate()}handlePhotoEditorHistoryUpdated(e){this.selectedHistoryID[BFN.AppModel.viewState]=null,BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&this.queueHistoryUpdate()}handleCollageMakerHistoryUpdated(e){this.selectedHistoryID[BFN.AppModel.viewState]=null,BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&this.queueHistoryUpdate()}handleSelectHistoryItem(e){if(e.data&&this.globalHistoryVOHash.hasOwnProperty(e.data)){var t=this.globalHistoryVOHash[e.data];BFN.UndoManager.gotoTimestamp(t.timestamp)}}updateSelectedHistoryID(){this.selectedHistoryID[BFN.AppModel.viewState]=this.historyItemPrefix+BFN.UndoManager.getTimestamp()}handleUndoManagerTimestampUpdated(e){this.updateSelectedHistoryID(),BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.data=this.selectedHistoryID[BFN.AppModel.viewState],BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED),this.updateGlobalHistoryButtons()}get blankThumbImage(){return this.blankThumbTexture||(this.blankThumbTexture=PIXI.RenderTexture.create(this.globalHistoryMenuThumbSize,this.globalHistoryMenuThumbSize),this.blankThumbTexture.fillColor(15922165),this._blankThumbImage=BFN.Util.getHTMLImage(this.blankThumbTexture)),this._blankThumbImage}}BFN.SingletonQueue.add(()=>{BFN.GlobalHistoryModel=new Zi}),BFN.PhotoEditorModelEvents={SOURCE_IMAGE_UPDATED:new Event("SOURCE_IMAGE_UPDATED"),CURRENT_IMAGE_UPDATED:new Event("CURRENT_IMAGE_UPDATED"),CURRENT_IMAGE_RESET:new Event("CURRENT_IMAGE_RESET"),EDITOR_IMAGE_LOAD_COMPLETE:new Event("EDITOR_IMAGE_LOAD_COMPLETE"),EDITOR_IMAGE_LOAD_ERROR:new Event("EDITOR_IMAGE_LOAD_ERROR"),PROJECT_UPDATED:new Event("PROJECT_UPDATED")};class Ji extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("PhotoEditorModel Init"),this.initDefaultValues(),this.updateProjectVO=BeFunky.debounce(this.updateProjectVO.bind(this),10),this.webcamModal=null}initDefaultValues(){this.sourceTexture=BFN.renderTexturesPool[0].texture,this._currentTexture=null,this.currentTextureDimensions={width:-1,height:-1},this.currentTextureBlobSaveTimeout=null,this.currentTextureBlobSaveInProgress=!1,this.currentEXIF=null,this.hasUnsavedChanges=!1,BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,()=>{BFN.AppModel.viewingEditor&&BFN.GlobalHistoryModel.globalHistoryVOs.length>1&&(this.hasUnsavedChanges=!0)}),this._projectVO=new BFN.ProjectVO,this._projectVO.version=2,this._projectVO.section="editor"}openSampleImage(e){"sample_4"===e&&(BFN.DeepLinkManager.isNeedToOpenTouchUp=!0);var t="".concat(BFN.remoteImagesURL,"app/graphics/photoeditor/samples/images/").concat(e,".jpg?io=off");BFN.BfnService.ToJsUrlUploader(t,"BeFunky-sample",!0,"sample"),UIToggler.toggleSampleImagePopover(!1)}confirmEditorLoadImage(e,t){this.currentTexture&&(this.hasUnsavedChanges||BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&BFN.PhotoEditorCanvasTools.currentTool)?BeFunky.confirm("confirm_photo_change",{onConfirm:e,onCancel:t,confirmText:"yes",cancelText:"no"}):e()}handleEditorLoadImage(){BFN.MultipleFileUploader.upload(this.onEditorImageUpload.bind(this),{allowMultiple:!1,createMenuImageVO:!1})}onEditorImageUpload(e){var t=e.file;if(t){BFN.BfnService.track("CREATE","UPLOAD","DESKTOP"),BFN.BfnService.trackMediaOpened("image","computer");var i=t.name.replace(/\.[^\/.]+$/,"");this.loadBase64OrBlob(t,{filename:i})}}loadBase64OrBlob(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.showLoadScreen,r=void 0===i||i,a=t.filename,n=void 0===a?"":a,o=t.callback,s=void 0===o?()=>{}:o,l=t.clearLocalAssets,h=void 0===l?!BFN.ImageEditManager.editingImage:l,c=t.saveBlobAsIs,u=void 0!==c&&c,d={textureSize:BFN.maxImageSize},m=!1;r&&BeFunky.showLoadScreen({onCancel:()=>{m=!0}}),BFN.TextureUtils.blobOrBase64ToTexture(e,t=>{var i=t.error,a=t.texture,o=t.exif;if(!m){r&&BeFunky.hideLoadScreen();var l=Boolean(a&&a.width),c=e instanceof Blob?e:void 0;if(s({success:l}),!l)return this.handleTextureFileLoaderTextureError(i,c);BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),this.handleTextureLoaded(a,h,u?c:void 0),"string"==typeof n&&(BFN.UploadSaveShareManager.setFileName("editor","image",n),this._projectVO.filename=n),this.currentEXIF=o||null}},d)}openWebcamModal(){this.webcamModal||(this.webcamModal=document.getElementById("webcam_modal"),BFN.UI.webcamModal(this.webcamModal)),this.webcamModal.open()}updateCurrentTexture(e){null!=e&&(this.currentTexture=e,this.dispatchEvent(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED),this.saveCurrentTextureBlob(),this.updateProjectVO(!1))}saveCurrentTextureBlob(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,t=arguments.length>1?arguments[1]:void 0;clearTimeout(this.currentTextureBlobSaveTimeout),this.currentTextureBlobSaveTimeout=setTimeout(()=>{this.currentTextureBlobSaveInProgress||BFN.ImageEditManager.editingImage||(this.currentTextureBlobSaveInProgress=!0,(t?Promise.resolve(t):this.getCurrentTextureBlob()).then(e=>BFN.ProjectService.setLocalAsset("editor","image","editor_canvas_image",e)).then(()=>{this.currentTextureBlobSaveInProgress=!1}).catch(t=>{BeFunky.logError("Unable to autosave editor main image",t),this.currentTextureBlobSaveInProgress=!1,this.currentTexture&&this.currentTexture.valid&&this.saveCurrentTextureBlob(e)}))},e)}getCurrentTextureBlob(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=(this.currentTexture||{}).autoSaveID,i=()=>this.currentTexture?this.currentTexture.valid?this.currentTexture.autoSaveID!==t&&"texture_changed":"invalid_texture":"no_texture";return new Promise((r,a)=>{var n=t=>{if(!e)return t();BFN.MainUI.addIdleRenderFunction(()=>{if(i())return a(i());t()})},o=Date.now(),s=e=>{!function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];BeFunky.logFeature("editor_image",...t)}(t,e,Date.now()-o),o=Date.now()};if(i())return a(i());var l=this.currentTexture.determineTransparency();s("check transparency"),n(()=>{s("idle");var e=BeFunky.isFirefox?.99:1,t=BFN.TextureUtils.textureToCanvas(this.currentTexture,{isTransparent:l});s("texture -> canvas"),n(()=>{s("idle"),t.toBlob(e=>{if(s("canvas -> blob"),"image/jpeg"!==e.type)return r(e);n(()=>{s("idle"),BFN.ExifTool.insert(e,this.currentEXIF,void 0,t=>{var n=t.error,o=t.blob;return i()?a(i()):(s("add EXIF"),n?(BeFunky.logError("Unable to add EXIF data to image blob. Falling back to original blob.",n),r(e)):r(o))})})},l?"image/png":"image/jpeg",e)})})})}updateProjectVO(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=Boolean(this.currentTexture&&this.currentTexture.valid);this._projectVO.projectWidth=i?this.currentTexture.width:0,this._projectVO.projectHeight=i?this.currentTexture.height:0,this._projectVO.editorImageBase64=null,e&&BFN.ProjectManager.updateProjectVOItems(this,BFN.PhotoEditorCanvas.transformLayer),this._projectVO.transformGroups=BFN.GroupManager.getSectionGroupObjects("editor",!0),t&&BFN.ProjectManager.requestLocalSave({sectionID:"editor",allowReset:!i})}handleTextureLoaded(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=!this.currentTexture;if(this.currentTexture&&this.currentTexture!==this.sourceTexture&&(this.currentTexture.destroyGC(!0),this.currentTexture=null),this.sourceTexture.baseTexture.maskTexture){try{this.sourceTexture.baseTexture.maskTexture.destroyGC(!0)}catch(e){}delete this.sourceTexture.baseTexture.maskTexture}BFN.ArtsyService.reset(),BFN.BackgroundRemovalManager.reset(),this.sourceTexture.resize(e.frame.width,e.frame.height),this.sourceTexture.copyPixels(e),this.sourceTexture.determineTransparency(),e.resize(1024,1024),this.currentTexture=this.sourceTexture,this.saveCurrentTextureBlob(0,i),this.updateProjectVO(!0);var a=BFN.Util.calculateRes(this.sourceTexture.width,this.sourceTexture.height);BFN.renderTextureResolution=a.small,BFN.renderTextureResolutionLarge=a.large,this.dispatchEvent(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED),this.dispatchEvent(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED),BFN.PhotoEditorCanvasModel.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME),BFN.PhotoEditorMenuModel.createCurrentImageThumb(this.sourceTexture),BFN.TransformStateModel.clearTransitions(),BFN.PhotoEditorCanvasModel.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS),BFN.PhotoEditorHistoryModel.resetHistory(),BFN.PhotoEditorHistoryModel.addTextureToHistory("new_image",this.currentTexture),t&&BFN.ProjectService.clearLocalAssets("editor"),UIToggler.toggleMainMenu(!0),UIToggler.toggleZoomMenu(!0),UIToggler.toggleSaveButtons(!0),UIToggler.toggleSampleImagePopover(!1),this.hasUnsavedChanges=!1,BFN.TransformGuides.setTransformGuideData(),this.dispatchEvent(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_COMPLETE),e.destroyGC(!0),e=null,r&&BFN.DeepLinkManager.handleEditorImageDeepLink(()=>{BFN.PhotoEditorCanvasModel.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME_ANIMATED)})}handleTextureFileLoaderTextureError(e,t){BeFunky.logError("Unable to generate Photo Editor texture",e),t&&t.name&&BFN.MultipleFileUploader.acknowledgeInvalidImageFiles([{error:e,file:t}]),this.dispatchEvent(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_ERROR)}set projectVO(e){this._projectVO=e,this.dispatchEvent(BFN.PhotoEditorModelEvents.PROJECT_UPDATED)}get projectVO(){return this._projectVO}set currentTexture(e){if(this._currentTexture=e,this._currentTexture&&(this._currentTexture.autoSaveID=Math.random()),this.currentTextureDimensions.width=this.currentTextureDimensions.height=-1,this._currentTexture){try{this.currentTextureDimensions.width=this._currentTexture.width}catch(e){}try{this.currentTextureDimensions.height=this._currentTexture.height}catch(e){}}}get currentTexture(){return this._currentTexture}}function $i(){BFN.EventDispatcher.call(this),this.init()}function er(){var t=e(["\n            <div>\n                <p>",'</p>\n                <p style="margin-bottom: 0"><a href="https://support.befunky.com/hc/en-us/articles/360040712632}" target="_blank" rel="noopener">',"</a></p>\n            </div>"]);return er=function(){return t},t}function tr(){BFN.EventDispatcher.call(this),this.init()}BFN.SingletonQueue.add(()=>{BFN.PhotoEditorModel=new Ji}),BFN.PhotoEditorMenuModelEvents={CURRENT_IMAGE_THUMB_UPDATED:new Event("CURRENT_IMAGE_THUMB_UPDATED")},$i.prototype=Object.create(BFN.EventDispatcher.prototype),$i.prototype.init=function(){BeFunky.log("PhotoEditorMenuModel Init"),this.currentImageThumbTexture=null,this.currentImageThumbImage=null,this.presetItemThumbW=206,this.presetItemThumbH=140},$i.prototype.createCurrentImageThumb=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(this.currentImageThumbTexture&&this.currentImageThumbTexture.destroyGC(!0),this.currentImageThumbImage&&(URL.revokeObjectURL(this.currentImageThumbImage),this.currentImageThumbImage=null),this.currentImageThumbTexture=t?e.renderClone():this.getPresetItemThumbTexture(e),BFN.Stage.extract.canvas(this.currentImageThumbTexture).toBlob(e=>{this.currentImageThumbImage=window.URL.createObjectURL(e),this.dispatchEvent(BFN.PhotoEditorMenuModelEvents.CURRENT_IMAGE_THUMB_UPDATED)},"image/jpeg",.9))},$i.prototype.getPresetItemThumbTexture=function(e){var t=BFN.Util.resizeTexture(e,4*this.presetItemThumbW,4*this.presetItemThumbH,!0);if(!t)return null;var i=BFN.Util.getThumbTexture(t,this.presetItemThumbW,!1);return t.destroyGC(!0),i},BFN.SingletonQueue.add(()=>{BFN.PhotoEditorMenuModel=new $i}),BFN.PhotoEditorCanvasModelEvents={VIEWSTATE_UPDATED:new Event("VIEWSTATE_UPDATED"),CANVAS_SCALE_UPDATED:new Event("CANVAS_SCALE_UPDATED"),CANVAS_SCALING_UPDATED:new Event("CANVAS_SCALING_UPDATED"),ITEM_ADDED:new Event("ITEM_ADDED"),FIT_IMAGE_TO_FRAME:new Event("FIT_IMAGE_TO_FRAME"),FIT_IMAGE_TO_FRAME_ANIMATED:new Event("FIT_IMAGE_TO_FRAME_ANIMATED"),OFFSET_ITEMS:new Event("OFFSET_ITEMS"),FLATTEN_ITEMS:new Event("FLATTEN_ITEMS"),CLEAR_ITEMS:new Event("CLEAR_ITEMS"),ITEMS_UPDATED:new Event("ITEMS_UPDATED")},tr.prototype=Object.create(BFN.EventDispatcher.prototype),tr.prototype.init=function(){BeFunky.log("PhotoEditorCanvasModel Init"),this.initDefaultValues(),this.initContextMenu()},tr.prototype.initDefaultValues=function(){this.usePixelGrid=!1,this._viewState=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,this._canvasScale=1,this._canvasScaling=!1,this._addedItem=null,this._itemOffsetPoint=null,this._itemsExist=!1,this.minCanvasScale=1,this.maxCanvasScale=this.usePixelGrid?16:4,this.imageFitPaddingX=40,this.imageFitPaddingY=60,this.disregardScaleRange=!1,BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewstateUpdated.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED.type,this.handleCurrentImageUpdated.bind(this))},tr.prototype.initContextMenu=function(){this.contextMenu=document.getElementById("context_menu_photo_editor"),BeFunky.contextMenu(this.contextMenu,{open_from_computer:{onClick:()=>{document.getElementById("open_project_computer").click()},hasDivider:!0},undo:{onClick:()=>{UIHistory.undoButton.click()}},redo:{onClick:()=>{UIHistory.redoButton.click()}},reset:{onClick:()=>{UIHistory.resetButton.click()},hasDivider:!0},save_to_image_manager:{onClick:()=>{UIToggler.toggleLoadScreen(!0,{isCancellable:!1});var e=BFN.PhotoEditorCanvas.getFlattenedImage();BFN.ImageLibraryManager.createMenuImageVOFromTexture(e,()=>{UITools.setToolValue("editor_main","image_manager",!0),UITools.applyTool("editor_main"),UITools.setToolValue("editor_main","image_manager",!1),UIToggler.toggleLoadScreen(!1)})}}}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},tr.prototype.handleEditorFlatten=function(){var e;UITools.getToolValue("editor_flatten","flatten_layers")&&(BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer.hasText()?(e=(()=>{this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FLATTEN_ITEMS)}),BFN.SettingsManager.getSetting("dismissed_messages").then(t=>{if(t.includes("flatten_layers_warning"))return e();var i=BeFunky.lit,r=i.elem,a=i.lang;BeFunky.acknowledge(r(er(),a("flatten_layers_warning"),a("learn_more")),{onAcknowledge:e}),BFN.SettingsManager.updateSetting("dismissed_messages",[...t,"flatten_layers_warning"])})):this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FLATTEN_ITEMS))},tr.prototype.handleEditorOverlay=function(){var e=UITools.getToolVO("editor_overlay");BFN.OverlaysManager.setupCategoryItems(e.updating_id)},tr.prototype.handleUpdateTool=function(e){if(BFN.toolViewstates.hasOwnProperty(e)){var t=BFN.toolViewstates[e],i=null,r=null;switch(e){case"editor_edit":case"editor_touch_up":case"editor_frame":i=(r=UITools.getToolVO(e)).updating_id,BFN.toolViewstates.hasOwnProperty(i)&&(t=BFN.toolViewstates[i])}if("editor_edit"==e&&i&&t==BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT&&(r=UITools.getToolVO(i))&&r.hasOwnProperty("defaultValues")){for(var a in r.defaultValues)r.hasOwnProperty(a)&&UITools.setToolValue(i,a,r.defaultValues[a],!1);UITools.updateToolControls(i)}this.viewState!=t&&(console.log("SET VIEWSTATE : ".concat(t)),this.viewState=t),i&&UITools.applyTool(i)}},tr.prototype.exitCurrentEditorTool=function(){BFN.PhotoEditorCanvasModel.viewState!=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&(UITools.setToolValue("editor_apply_cancel","cancel",!0),UITools.applyTool("editor_apply_cancel"),UITools.setToolValue("editor_apply_cancel","cancel",!1))},tr.prototype.handleAppModelViewstateUpdated=function(e){this.itemsExist=this.itemsExist},tr.prototype.handleCurrentImageUpdated=function(e){BFN.ZoomManager.updateZoomRange()},Object.defineProperty(tr.prototype,"viewState",{set(e){if(this._viewState!=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)switch(this._viewState){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP:case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:BFN.EffectManager.reset()}this._viewState=e,this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED),BFN.GlobalHistoryModel.updateGlobalHistoryButtons()},get(){return this._viewState}}),Object.defineProperty(tr.prototype,"canvasScale",{set(e){this._canvasScale=this.disregardScaleRange?e:Math.max(this.minCanvasScale,Math.min(this.maxCanvasScale,e)),this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALE_UPDATED);var t=UITools.getToolVO("zoom");t.updating&&"amount"==t.updating_id||(UITools.setToolValue("zoom","amount",100*this._canvasScale),UITools.updateToolControls("zoom"))},get(){return this._canvasScale}}),Object.defineProperty(tr.prototype,"canvasScaling",{set(e){this._canvasScaling=e,BFN.smoothPictureDisabled=e,this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALING_UPDATED)},get(){return this._canvasScaling}}),Object.defineProperty(tr.prototype,"addedItem",{set(e){this._addedItem=e,this._addedItem&&this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.ITEM_ADDED)},get(){return this._addedItem}}),Object.defineProperty(tr.prototype,"itemOffsetPoint",{set(e){this._itemOffsetPoint=e,this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.OFFSET_ITEMS),this._itemOffsetPoint=null},get(){return this._itemOffsetPoint}}),Object.defineProperty(tr.prototype,"itemsExist",{set(e){this._itemsExist=e,this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.ITEMS_UPDATED)},get(){return this._itemsExist}}),BFN.SingletonQueue.add(()=>{BFN.PhotoEditorCanvasModel=new tr}),BFN.CollageMakerModelEvents={PROJECT_UPDATED:new Event("PROJECT_UPDATED")};class ir extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("CollageMakerModel Init"),this.initDefaultValues()}initDefaultValues(){this._projectVO=new BFN.ProjectVO,this._projectVO.version=2,this._projectVO.section="collage",this._projectVO._wasReset=!0,this.updateProjectVO=BeFunky.debounce(this.updateProjectVO.bind(this),10),this.hasUnsavedChanges=!1,BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,()=>{BFN.AppModel.viewingCollage&&BFN.GlobalHistoryModel.globalHistoryVOs.length>1&&(this.hasUnsavedChanges=!0,delete this.projectVO._wasReset)})}updateProjectVO(){this._projectVO.projectWidth=BFN.CollageMakerCanvasPhotoGrid.gridWidth,this._projectVO.projectHeight=BFN.CollageMakerCanvasPhotoGrid.gridHeight,this._projectVO.collageFreeform=BFN.CollageMakerCanvasPhotoGridModel.freeform,this._projectVO.collageBackgroundColor=BFN.CollageMakerCanvasBackground.color,this._projectVO.collageBackgroundPatternBase64=BFN.CollageMakerCanvasPhotoGridModel.backgroundPatternBase64,this._projectVO.collageGridWidth=BFN.PhotoGrid.itemWidth,this._projectVO.collageGridHeight=BFN.PhotoGrid.itemHeight,this._projectVO.collageRounding=100*BFN.PhotoGrid.rounding,this._projectVO.collageGap=100*BFN.PhotoGrid.gap,BFN.ProjectManager.updateProjectVOItems(this,BFN.CollageMakerCanvas.transformLayer),this._projectVO.transformGroups=BFN.GroupManager.getSectionGroupObjects("collage",!0),this._projectVO.collageGridChildren.splice(0);for(var e=0;e<BFN.PhotoGrid.gridChildren.length;e++){var t=BFN.PhotoGrid.gridChildren[e];t.updateRect(),t.updateProjectItemVO();var i=t.projectItemVO,r=t.childContent.image.frameSprite.texture.baseTexture.fabricShape?"svg":"image",a=this._projectVO["".concat(r,"DataKeys")];i.gridCellImageID&&(a.includes(i.gridCellImageID)||(a.push(i.gridCellImageID),BFN.ProjectService.setLocalAsset("collage",r,i.gridCellImageID,void 0,!0))),this._projectVO.collageGridChildren.push(i)}BFN.ProjectManager.requestLocalSave({sectionID:"collage"})}set projectVO(e){this._projectVO=e,this.dispatchEvent(BFN.CollageMakerModelEvents.PROJECT_UPDATED)}get projectVO(){return this._projectVO}}BFN.SingletonQueue.add(()=>{BFN.CollageMakerModel=new ir}),BFN.CollageMakerCanvasModelEvents={CANVAS_SCALE_UPDATED:new Event("CANVAS_SCALE_UPDATED"),CANVAS_SCALING_UPDATED:new Event("CANVAS_SCALING_UPDATED"),ITEM_ADDED:new Event("ITEM_ADDED"),FIT_COLLAGE_TO_FRAME:new Event("FIT_COLLAGE_TO_FRAME"),FIT_COLLAGE_TO_FRAME_ANIMATED:new Event("FIT_COLLAGE_TO_FRAME_ANIMATED"),CLEAR_ITEMS:new Event("CLEAR_ITEMS"),ITEMS_UPDATED:new Event("ITEMS_UPDATED")};class rr extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("CollageMakerCanvasModel Init"),this.initDefaultValues(),this.initContextMenu()}initDefaultValues(){this._canvasScale=1,this._canvasScaling=!1,this._addedItem=null,this._itemsExist=!1,this.minCanvasScale=1,this.maxCanvasScale=1.5,this.collageFitPaddingX=60,this.collageFitPaddingY=60,this.disregardScaleRange=!1}initContextMenu(){this.contextMenu=document.getElementById("context_menu_collage_maker"),BeFunky.contextMenu(this.contextMenu,{undo:{onClick:()=>{UIHistory.undoButton.click()}},redo:{onClick:()=>{UIHistory.redoButton.click()}},reset:{onClick:()=>{UIHistory.resetButton.click()},hasDivider:!0},save_to_image_manager:{onClick:()=>{UIToggler.toggleLoadScreen(!0,{isCancellable:!1});var e=BFN.CollageMakerCanvas.getFlattenedImage();BFN.ImageLibraryManager.createMenuImageVOFromTexture(e,()=>{UITools.setToolValue("collage_main","image_manager",!0),UITools.applyTool("collage_main"),UITools.setToolValue("collage_main","image_manager",!1),UIToggler.toggleLoadScreen(!1)})}}}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")}handleCollageLayoutsCustom(){switch(UITools.getToolVO("collage_layouts_custom").updating_id){case"collage_wizard":BFN.CollageWizardModal.open();try{BFN.BfnService.track("CREATE","COLLAGE","COLLAGE_WIZARD")}catch(e){}break;case"create_your_own":BFN.CollageMakerTemplateModel.dispatchEvent(BFN.CollageMakerTemplateModelEvents.FREEFORM);try{BFN.BfnService.track("CREATE","COLLAGE","CREATE_YOUR_OWN")}catch(e){}}}set canvasScale(e){this._canvasScale=this.disregardScaleRange?e:Math.max(this.minCanvasScale,Math.min(this.maxCanvasScale,e)),this.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALE_UPDATED);var t=UITools.getToolVO("zoom");t.updating&&"amount"===t.updating_id||(UITools.setToolValue("zoom","amount",100*this._canvasScale),UITools.updateToolControls("zoom"))}get canvasScale(){return this._canvasScale}set canvasScaling(e){this._canvasScaling=e,BFN.smoothPictureDisabled=e,this.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALING_UPDATED)}get canvasScaling(){return this._canvasScaling}set addedItem(e){this._addedItem=e,this._addedItem&&this.dispatchEvent(BFN.CollageMakerCanvasModelEvents.ITEM_ADDED)}get addedItem(){return this._addedItem}set itemsExist(e){this._itemsExist=e,this.dispatchEvent(BFN.CollageMakerCanvasModelEvents.ITEMS_UPDATED)}get itemsExist(){return this._itemsExist}}BFN.SingletonQueue.add(()=>{BFN.CollageMakerCanvasModel=new rr}),BFN.CollageMakerCanvasPhotoGridModelEvents={FREEFORM_UPDATED:new Event("FREEFORM_UPDATED"),CORNER_ROUNDING_UPDATED:new Event("CORNER_ROUNDING_UPDATED"),ASPECT_LOCK_CHANGED:new Event("ASPECT_LOCK_CHANGED"),MANUAL_GRID_RESIZE:new Event("MANUAL_GRID_RESIZE"),COLLAGE_SETTINGS_UPDATED:new Event("COLLAGE_SETTINGS_UPDATED"),GRID_SIZE_CHANGED:new Event("GRID_SIZE_CHANGED"),CLEAR_ALL:new Event("CLEAR_ALL"),AUTO_COLLAGE_LAYOUT_OBJECT:new Event("AUTO_COLLAGE_LAYOUT_OBJECT")};class ar extends BFN.EventDispatcher{constructor(e){super(e),this.init()}init(){BeFunky.log("CollageMakerCanvasPhotoGridModel Init"),this.initDefaultValues()}initDefaultValues(){this._freeform=!1,this._cornerRounding=0,this._collageSettings=null,this._autoCollageLayoutObject=null,this._backgroundPatternTexture=null,this._backgroundPatternBase64=null}set freeform(e){this._freeform!==e&&(this._freeform=e,this._freeform,this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.FREEFORM_UPDATED))}get freeform(){return this._freeform}set cornerRounding(e){this._cornerRounding=e,this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.CORNER_ROUNDING_UPDATED)}get cornerRounding(){return this._cornerRounding}set collageSettings(e){this._collageSettings=e}get collageSettings(){return this._collageSettings}set autoCollageLayoutObject(e){this._autoCollageLayoutObject=e,this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.AUTO_COLLAGE_LAYOUT_OBJECT),this._autoCollageLayoutObject=null}get autoCollageLayoutObject(){return this._autoCollageLayoutObject}set backgroundPatternTexture(e){if(this._backgroundPatternTexture=e,this._backgroundPatternTexture){var t=this._backgroundPatternTexture.renderClone();BFN.Util.getHTMLImage(t,e=>{this._backgroundPatternBase64=e.src,t.destroyGC(!0),BFN.CollageMakerModel.updateProjectVO()})}else this._backgroundPatternBase64=null,BFN.CollageMakerModel.updateProjectVO()}get backgroundPatternTexture(){return this._backgroundPatternTexture}get backgroundPatternBase64(){return this._backgroundPatternBase64}}BFN.SingletonQueue.add(()=>{BFN.CollageMakerCanvasPhotoGridModel=new ar}),BFN.CollageMakerTemplateModelEvents={CURRENT_TEMPLATE_UPDATED:new Event("CURRENT_TEMPLATE_UPDATED"),FREEFORM:new Event("FREEFORM")};class nr extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("CollageMakerTemplateModel Init"),this.initDefaultValues()}initDefaultValues(){this.freeformWidth=2400,this.freeformHeight=1800,this._currentTemplate=null}set currentTemplate(e){this._currentTemplate=e,this.dispatchEvent(BFN.CollageMakerTemplateModelEvents.CURRENT_TEMPLATE_UPDATED)}get currentTemplate(){return this._currentTemplate}}BFN.SingletonQueue.add(()=>{BFN.CollageMakerTemplateModel=new nr}),BFN.DesignerModelEvents={PROJECT_UPDATED:new Event("PROJECT_UPDATED")};class or extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("DesignerModel Init"),this.initDefaultValues()}initDefaultValues(){this._projectVO=new BFN.ProjectVO,this._projectVO.version=2,this._projectVO.section="designer",this.updateProjectVO=BeFunky.debounce(this.updateProjectVO.bind(this),10),this.hasUnsavedChanges=!1,BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,()=>{BFN.AppModel.viewingDesigner&&BFN.GlobalHistoryModel.globalHistoryVOs.length>1&&(this.hasUnsavedChanges=!0,delete this.projectVO._wasReset)})}loadBlankProject(){var e=new BFN.ProjectVO;e.version=2,e.section="designer",e.projectWidth=this.projectVO.projectWidth||2550,e.projectHeight=this.projectVO.projectHeight||3300,e.designerBackgroundColor="FFFFFF";var t=BFN.DesignerTemplateManager.parseDimensions([e.projectWidth,e.projectHeight]);e.printDPI=t?t.dpi:300,e._wasReset=!0,BFN.ProjectManager.loadProject(e)}updateProjectVO(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._projectVO.projectWidth=BFN.DesignerCanvas.canvasWidth,this._projectVO.projectHeight=BFN.DesignerCanvas.canvasHeight,this._projectVO.designerBackgroundColor=BFN.DesignerCanvasBackground.color,e&&BFN.ProjectManager.updateProjectVOItems(this,BFN.DesignerCanvas.transformLayer),this._projectVO.transformGroups=BFN.GroupManager.getSectionGroupObjects("designer",!0),BFN.ProjectManager.requestLocalSave({sectionID:"designer"})}set projectVO(e){this._projectVO=e,this.dispatchEvent(BFN.DesignerModelEvents.PROJECT_UPDATED)}get projectVO(){return this._projectVO}}function sr(){BFN.EventDispatcher.call(this),this.init()}function lr(){var t=e(["<li>","</li>"]);return lr=function(){return t},t}function hr(){var t=e(["\n        <div>\n            <p>","</p>\n            <ul>\n            ","\n            </ul>\n        </div>\n        "]);return hr=function(){return t},t}BFN.SingletonQueue.add(()=>{BFN.DesignerModel=new or}),BFN.DesignerCanvasModelEvents={CANVAS_SCALE_UPDATED:new Event("CANVAS_SCALE_UPDATED"),CANVAS_SCALING_UPDATED:new Event("CANVAS_SCALING_UPDATED"),ITEM_ADDED:new Event("ITEM_ADDED"),FIT_DESIGNER_TO_FRAME:new Event("FIT_DESIGNER_TO_FRAME"),FIT_DESIGNER_TO_FRAME_ANIMATED:new Event("FIT_DESIGNER_TO_FRAME_ANIMATED"),CLEAR_ITEMS:new Event("CLEAR_ITEMS"),ITEMS_UPDATED:new Event("ITEMS_UPDATED"),DESIGNER_SETTINGS_UPDATED:new Event("DESIGNER_SETTINGS_UPDATED")},sr.prototype=Object.create(BFN.EventDispatcher.prototype),sr.prototype.init=function(){BeFunky.log("DesignerCanvasModel Init"),this.initDefaultValues(),this.initContextMenu()},sr.prototype.initDefaultValues=function(){this._canvasScale=1,this._canvasScaling=!1,this._addedItem=null,this._itemsExist=!1,this.minCanvasScale=1,this.maxCanvasScale=4,this.designerFitPaddingX=60,this.designerFitPaddingY=60,this.disregardScaleRange=!1},sr.prototype.initContextMenu=function(){this.contextMenu=document.getElementById("context_menu_designer"),BeFunky.contextMenu(this.contextMenu,{undo:{onClick:()=>{UIHistory.undoButton.click()}},redo:{onClick:()=>{UIHistory.redoButton.click()}},reset:{onClick:()=>{UIHistory.resetButton.click()},hasDivider:!0},save_to_image_manager:{onClick:()=>{UIToggler.toggleLoadScreen(!0,{isCancellable:!1});var e=BFN.DesignerCanvas.getFlattenedImage();BFN.ImageLibraryManager.createMenuImageVOFromTexture(e,()=>{UITools.setToolValue("designer_main","image_manager",!0),UITools.applyTool("designer_main"),UITools.setToolValue("designer_main","image_manager",!1),UIToggler.toggleLoadScreen(!1)})}}}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},Object.defineProperty(sr.prototype,"canvasScale",{set(e){this._canvasScale=this.disregardScaleRange?e:Math.max(this.minCanvasScale,Math.min(this.maxCanvasScale,e)),this.dispatchEvent(BFN.DesignerCanvasModelEvents.CANVAS_SCALE_UPDATED);var t=UITools.getToolVO("zoom");t.updating&&"amount"==t.updating_id||(UITools.setToolValue("zoom","amount",100*this._canvasScale),UITools.updateToolControls("zoom"))},get(){return this._canvasScale}}),Object.defineProperty(sr.prototype,"canvasScaling",{set(e){this._canvasScaling=e,BFN.smoothPictureDisabled=e,this.dispatchEvent(BFN.DesignerCanvasModelEvents.CANVAS_SCALING_UPDATED)},get(){return this._canvasScaling}}),Object.defineProperty(sr.prototype,"addedItem",{set(e){this._addedItem=e,this._addedItem&&this.dispatchEvent(BFN.DesignerCanvasModelEvents.ITEM_ADDED)},get(){return this._addedItem}}),Object.defineProperty(sr.prototype,"itemsExist",{set(e){this._itemsExist=e,this.dispatchEvent(BFN.DesignerCanvasModelEvents.ITEMS_UPDATED)},get(){return this._itemsExist}}),Object.defineProperty(sr.prototype,"designerSettings",{set(e){this._designerSettings=e},get(){return this._designerSettings}}),BFN.SingletonQueue.add(()=>{BFN.DesignerCanvasModel=new sr});class cr{constructor(){this.initDefaultValues(),this.initFileUploadInput()}initDefaultValues(){this.uploadQueue=[],this.uploadInput=null,this.thumbSize=BFN.CSS.imageManagerThumbSize*(BeFunky.isRetina()?1.5:1),this.supportedImages=["jpg","jpeg","png","gif","bmp","svg"],(BeFunky.isChromium||BeFunky.firefoxVersion>=65)&&this.supportedImages.push("webp"),(BeFunky.isSafari||BeFunky.isEdgeHTML)&&this.supportedImages.push("tif","tiff"),this.accept={images:!BeFunky.isSafari||"sendBeacon"in navigator?this.supportedImages.map(e=>".".concat(e)).join(", "):"image/*",bfd:".bfd",svg:".svg",imagesAndBFD:this.supportedImages.concat("bfd").map(e=>".".concat(e)).join(", "),imagesExceptSVG:this.supportedImages.filter(e=>"svg"!==e).map(e=>".".concat(e)).join(", "),all:"",fonts:h.map(e=>e.extension).map(e=>".".concat(e)).join(", ")},this.transparentImages=["png","gif","svg","webp"],this.currentCallback=null,this.currentOptions=null,this.currentFailedImageUploads=[],this.progressIndex=0,this.progressTotal=0}initFileUploadInput(){var e="file_upload_input",t='<input id="'.concat(e,'" type="file" style="display: none;">');BFN.appContainer.insertAdjacentHTML("beforeend",t),this.uploadInput=document.getElementById(e),this.uploadInput.addEventListener("change",e=>this.handleUpload([...e.target.files]))}upload(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.allowMultiple,r=void 0===i||i,a=t.fileType,n=void 0===a?"images":a,o=t.createMenuImageVO,s=void 0===o||o,l=t.saveInIndexedDB,h=t.files,c=void 0===h?[]:h,u=t.keepImageTexture,d=void 0!==u&&u,m=t.keepThumbTexture,p=void 0!==m&&m,g=t.thumbnailLongestSide,f=t.onBeforeUpload;if("bfd"===n&&(s=!1),Object.keys(this.accept).includes(n)||(BeFunky.throwError("Invalid fileType passed to MultipleFileUploader"),n="images"),"boolean"!=typeof l&&(l=s),this.currentCallback=e,this.currentOptions={createMenuImageVO:s,keepImageTexture:d,fileType:n,saveInIndexedDB:l,thumbnailLongestSide:g,keepThumbTexture:p,onBeforeUpload:f},this.currentFailedImageUploads=[],c.length)return this.handleUpload(c);try{this.uploadInput.multiple=r}catch(e){throw BeFunky.logError('Unable to set "multiple" property on file upload input'),BeFunky.logError("this.uploadInput",typeof this.uploadInput,this.uploadInput),e}this.uploadInput.accept=this.accept[n],this.uploadInput.click()}processNextFile(e){var t=this.uploadQueue.shift(),i=/^image\/+/.test(t.type),r=/^image\/svg\+xml/.test(t.type)||"svg"===t.name.split(".").pop().toLowerCase(),a=i=>{var r=i?{file:t,menuImageVO:i,isComplete:!1}:{file:t,isComplete:!1};this.progressTotal&&(this.progressIndex++,this.showLoadScreen("uploading","".concat(this.progressIndex," / ").concat(this.progressTotal))),this.uploadQueue.length?(e(r),this.processNextFile(e)):(UIToggler.toggleLoadScreen(!1),e(r),this.uploadProcessingComplete(e))};return this.currentOptions.createMenuImageVO?i?"imagesExceptSVG"===this.currentOptions.fileType&&r?(BeFunky.logError("Uploaded file is an SVG, but SVGs are not supported by this feature",t),this.currentFailedImageUploads.push({error:"SVGs are not supported by this feature",file:t}),a()):void this.createMenuImageVO(t,i=>{var r=i.error,n=i.menuImageVO;if(e===this.currentCallback)return r?(BeFunky.logError("Unable to create MenuImageVO for uploaded image",t,r),this.currentFailedImageUploads.push({error:r,file:t}),a()):a(n)},this.currentOptions):(BeFunky.logError('Uploaded file does not have an "image/*" mimetype',t),this.currentFailedImageUploads.push({error:"Not an image",file:t}),a()):a()}uploadProcessingComplete(e){this.uploadQueue=[],this.acknowledgeInvalidImageFiles(this.currentFailedImageUploads),e({isComplete:!0})}createMenuImageVO(e,t,i){var r=i.keepImageTexture,a=void 0!==r&&r,n=i.saveInIndexedDB,o=void 0===n||n,s=i.thumbnailLongestSide,l=i.keepThumbTexture,h=new BFN.MenuImageVO;h.createId("computer"),s=parseInt(s,10)||-1,h.name=e.name.replace(/\.[^\/.]+$/,"");var c=BFN.getExtension(e.name),u=this.transparentImages.includes(c);if(h.extension=c,"svg"===c)return h.isSVG=!0,h.isTransparent=!0,BFN.BlobUtils.blobToText(e,e=>{var i=e.error,r=e.text;if(i)return t({error:i});var n=BFN.SVGManager.sanitizeSVG(r);if(!n)return t({error:"Unable to parse SVG"});var o=n.length>1e5;if(!o&&(h.thumbURL=BFN.SVGManager.createDataURI(n),!a))return m(n);BFN.TextureUtils.svgStringToTexture(n,e=>{var i=e.error,r=e.texture;if(i)return t({error:i});if(o){var s=r.width/r.height,l=Math.round(this.thumbSize*(s>1?s:1/s)),c=BFN.Util.getThumbTexture(r,l,!1);h.thumbURL=BFN.TextureUtils.textureToBase64(c),h.thumbWidth=c.width,h.thumbHeight=c.height,c.destroyGC(!0)}a?h.imageTexture=r:r.destroyGC(!0),m(n)})});var d={};function m(e){o?(h.indexedDBKey="svg__".concat(h.id),BFN.IndexedDB.set(h.indexedDBKey,e).then(()=>t({menuImageVO:h}),e=>{BeFunky.logError("Unable to store SVG string in IndexedDB",e),t({error:e})})):BeFunky.isEdgeHTML?setTimeout(()=>{t({menuImageVO:h})},0):t({menuImageVO:h})}a||(d.textureSize=4*this.thumbSize),BFN.TextureUtils.blobOrBase64ToTexture(e,i=>{var r=i.error,n=i.texture,c=i.imageWidth,d=i.imageHeight;if(r)return t({error:r});h.imageWidth=c,h.imageHeight=d;var m=n.width/n.height,p=s>0?s:Math.round(this.thumbSize*(m>1?m:1/m)),g=BFN.Util.getThumbTexture(n,p,!1),f=!!u&&BFN.Util.isTransparent(g);h.thumbURL=BFN.TextureUtils.textureToBase64(g,{isTransparent:f}),h.thumbWidth=g.width,h.thumbHeight=g.height,h.isTransparent=f,l?h.thumbTexture=g:g.destroyGC(!0),a?h.imageTexture=n:n.destroyGC(!0),function(){if(!o)return void(BeFunky.isEdgeHTML?setTimeout(()=>{t({menuImageVO:h})},0):t({menuImageVO:h}));h.indexedDBKey="image__".concat(h.id),BFN.IndexedDB.set(h.indexedDBKey,e).then(()=>t({menuImageVO:h}),e=>{BeFunky.logError('Unable to store blob "'.concat(blob.name,'" in IndexedDB'),e),t({error:e})})}()},d)}acknowledgeInvalidImageFiles(e){if(Array.isArray(e)&&e.length&&e.every(e=>e.error&&e.file)){var t=BeFunky.lit,i=t.elem,r=t.html,a=t.lang;BeFunky.acknowledge(i(hr(),a("error_invalid_image"),e.map(e=>{var t=e.file.name||"(unknown file name)",i="string"==typeof e.error?"- ".concat(e.error):"";return r(lr(),"".concat(t," ").concat(i))})))}}showLoadScreen(e,t){UIToggler.toggleLoadScreen(!0,{message:e,progress:t,showIris:!1,onCancel:()=>{UIToggler.toggleLoadScreen(!1),this.uploadProcessingComplete(this.currentCallback)}})}handleUpload(e){if(!e.length)return this.uploadProcessingComplete(this.currentCallback);if("function"==typeof this.currentOptions.onBeforeUpload){var t=this.currentOptions.onBeforeUpload;return this.currentOptions.onBeforeUpload=void 0,t(e,this.handleUpload.bind(this))}this.progressIndex=1,this.progressTotal=e.length>1&&this.currentOptions.createMenuImageVO?e.length:0;var i=this.progressTotal?"".concat(BeFunky.LanguageManager.getString("uploading")," ").concat(this.progressIndex," / ").concat(this.progressTotal):"uploading";this.showLoadScreen(i),this.uploadQueue=e,setTimeout(()=>this.processNextFile(this.currentCallback),0),this.uploadInput.value=""}}function ur(){var t=e(['\n                    <button\n                        @click="','"\n                        .optionValue="','"\n                        class="','">\n                        ',"\n                    </button>\n                    "]);return ur=function(){return t},t}function dr(){var t=e(['<h5 class="dropdown__list-header">',"</h5>"]);return dr=function(){return t},t}function mr(){var t=e(['\n            <div class="dropdown__list" style="','">\n                ',"\n            </div>\n        "]);return mr=function(){return t},t}function pr(){var t=e(['<label class="control-item-label">',"</label>"]);return pr=function(){return t},t}function gr(){var t=e(["\n            ",'\n             <button class="dropdown__box button button--outline button--arrow button--fullwidth" @focus='," @blur=",' @click="','">\n                <span class="dropdown__selection">',"</span>\n                ","\n             </button>\n             ","\n        "]);return gr=function(){return t},t}BFN.SingletonQueue.add(()=>{BFN.MultipleFileUploader=new cr});var fr=BeFunky.lit,vr=fr.html,yr=fr.setupState,xr=fr.render,_r=fr.lang,Ir=fr.icon;function Tr(e,i){var r=i.onChange,a=i.initialOptions,n=void 0===a?[]:a,o=i.label,s=i.defaultValue,l=i.dropdownMaxHeight,h=i.translateOptionNames,c=void 0===h||h;e.addClass("dropdown");var u,d,m={isOpen:!1,isMixed:!1,selectedValue:function(){if(n&&n.length)return n.some(e=>{var t=e.value;return t===s})?s:n[0].value}(),options:n,listStyles:""},p=BeFunky.once(function(){u=e.querySelector(".dropdown__box"),d=e.querySelector(".dropdown__list"),t=0,i=0,d.addEventListener("wheel",e=>{e.deltaY<0?d.scrollTop<=0&&e.preventDefault():(t=t||d.getBoundingClientRect().height,i=i||d.scrollHeight,d.scrollTop+t>=i&&e.preventDefault())});var t,i}),g=BeFunky.debounce(()=>{xr((e.toggleClass("dropdown--open",v.isOpen),vr(gr(),"string"==typeof o?vr(pr(),_r(o)):"",b,S,T,function(){if(v.isMixed)return"—";var e=v.options.find(e=>e.value===v.selectedValue);return e?I(e):""}(),Ir("global-arrow-down-icon","icon"),vr(mr(),v.listStyles,v.options.map(e=>e.isHeader?vr(dr(),e.name):vr(ur(),function(e){return function(){y({selectedValue:e.value,isMixed:!1,isOpen:!1}),setTimeout(()=>u.focus(),100),r(e.value)}}(e),e.value,e.value!==v.selectedValue||v.isMixed?"button button--list button--ellipsis dropdown__item":"button button--list button--ellipsis dropdown__item dropdown__item--selected",I(e)))))),e),p()},"raf"),f=t(yr(m,e=>{e.isOpen&&(v.isOpen?(BeFunky.addArrowKeyHandler({callback:C,condition:x}),document.addEventListener("click",B,!0)):(BeFunky.removeArrowKeyHandler({callback:C,condition:x}),document.removeEventListener("click",B,!0))),g()}),2),v=f[0],y=f[1],x=e=>e.hasClass("dropdown__item")&&e.parentElement===d,_=e=>e===u;return BeFunky.LanguageManager.addLanguageUpdateListener(g),Object.defineProperty(e,"selectedValue",{set(t){if(t!==v.selectedValue||v.isMixed){var i=v.options.find(e=>{var i=e.value;return i===t});i?y({selectedValue:t,isMixed:!1}):BeFunky.throwError("Invalid selectedValue set for dropdown_item #".concat(e.id),{_value:t})}},get:()=>v.selectedValue}),Object.assign(e,{setState:y}),e;function I(e){return c&&"string"==typeof e.name?_r(e.name):e.name}function T(){!function(){var t=e.closestParent(t=>t!==e&&["hidden","auto","scroll"].includes(getComputedStyle(t).overflowY)).getBoundingClientRect(),i=u.getBoundingClientRect(),r=t.bottom-i.bottom,a=i.top-t.top,n=32*Math.min(4,v.options.length)+2,o=l||32*Math.min(5,v.options.length)+2;if(r>=n){var s=Math.min(o,r);return void y({listStyles:"height: ".concat(s,"px;")})}var h=Math.min(o,a+i.height+r-16),c=8-r;h+c<i.height&&(c+=i.height-(h+c));y({listStyles:"top: auto; bottom: ".concat(c,"px; height: ").concat(h,"px; border-radius: 3px; box-shadow: 2px 2px 1.5rem rgba(0,0,0,.5);")})}(),v.isOpen?y({isOpen:!1}):(y({isOpen:!0}),F())}function b(){BeFunky.addArrowKeyHandler({callback:C,condition:_})}function S(){BeFunky.removeArrowKeyHandler({callback:C,condition:_})}function C(e,t,i){if("keydown"!==i.type&&"left"!==t&&"right"!==t){var a,n=e.hasClass("dropdown__item"),o=[void 0,null];if(n)a=e.optionValue;else if(a=v.selectedValue,o.includes(a))return void y({isOpen:!0,selectedValue:v.options[0].value,isMixed:!1});var s=v.options.findIndex(e=>e.value===a);if(-1!==s){for(var l="up"===t?-1:1,h=s+l;v.options[h]&&o.includes(v.options[h].value);)h+=l;if(o.includes(v.options[h]))return y({isOpen:!0,isMixed:!1}),void F();y({isOpen:!1,selectedValue:v.options[h].value,isMixed:!1}),r(v.options[h].value),n&&setTimeout(()=>u.focus(),100)}}}function B(e){u.contains(e.target)||d.contains(e.target)||y({isOpen:!1})}function F(){setTimeout(()=>{var t=e.querySelector(".dropdown__item--selected");t&&t.focus()},100)}}window.UIToolsEvents={UPDATE_TOOL:new Event("UPDATE_TOOL"),UPDATE_TOOL_CONTROL:new Event("UPDATE_TOOL_CONTROL"),UPDATE_TOOL_CONTROLS:new Event("UPDATE_TOOL_CONTROLS"),TOOL_PARAM_UPDATED:new Event("TOOL_PARAM_UPDATED")};class br extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("UITools Init"),this.initDefaultValues(),this.initUIToolVOs(),this.initToolVOs(BFN.EffectData),this.initToolVOs(BFN.ArtsyData),this.initToolVOs(BFN.TextureData),this.initToolVOs(BFN.LensFlareData.menuData),this.initToolVOs(BFN.FrameData.crop_rotate),this.initToolVOs(BFN.FrameData.crop),this.initToolVOs(BFN.FrameData.full)}initDefaultValues(){this.toolVOs={},this.toolControlIDs={},this.controlToolIDs={},this.controlParamObjects={},this.toolPlusHash={},this.printToolVOs=!1,this.controlElements={},this.lastClickTime=0}initUIToolVOs(){for(var e in BFN.UIToolData){var t=this.createToolVO(e),i=BFN.UIToolData[e];if(i.hasOwnProperty("controls")){var r=i.controls;for(var a in r){var n=r[a],o=a.replace("".concat(e,"_"),""),s=n.type;this.toolControlIDs[e].push(a),this.controlToolIDs[a]=e,this.controlParamObjects[a]=n;var l=!!n.hasOwnProperty("defaultValue")&&n.defaultValue;switch(this.setToolValue(e,o,l),s){case"color":case"color_item":case"color_palette":case"color_group":n.hasOwnProperty("intensityEnabled")&&n.intensityEnabled&&this.setToolValue(e,"".concat(o,"_intensity"),1),"color_group"===s&&(this.setToolValue(e,"".concat(o,"_index"),0),this.setToolValue(e,"".concat(o,"_group_id"),0))}t.defaultValues[o]=l}}this.toolPlusHash[e]=!!i.hasOwnProperty("isPlus")&&i.isPlus}}initToolVOs(e){for(var t=0;t<e.length;t++)for(var i=e[t],r=0;r<i.presets.length;r++){var a=i.presets[r],n="".concat(i.id,"_").concat(a.id);this.toolPlusHash[n]=!!a.hasOwnProperty("isPlus")&&a.isPlus;for(var o=this.createToolVO(n),s=0;s<a.params.length;s++){var l=a.params[s],h=l.name,c="".concat(n,"_").concat(h),u=l.type;this.toolControlIDs[n].push(c),this.controlToolIDs[c]=n,this.controlParamObjects[c]=l;var d=!!l.hasOwnProperty("defaultValue")&&l.defaultValue;switch(this.setToolValue(n,l.name,d),u){case"color":case"color_item":case"color_palette":case"color_group":l.hasOwnProperty("intensityEnabled")&&l.intensityEnabled&&this.setToolValue(n,"".concat(l.name,"_intensity"),1),"color_group"===u&&(this.setToolValue(n,"".concat(l.name,"_index"),0),this.setToolValue(n,"".concat(l.name,"_group_id"),0))}o.defaultValues[h]=d}}}createToolVO(e){return e?(this.toolVOs.hasOwnProperty(e)||(this.toolVOs[e]={toolID:e,updating:!1,updating_id:null,defaultValues:{}}),this.toolControlIDs.hasOwnProperty(e)||(this.toolControlIDs[e]=[]),this.toolVOs[e]):null}removeToolVO(e){if(e&&(this.toolVOs.hasOwnProperty(e)&&delete this.toolVOs[e],this.toolControlIDs.hasOwnProperty(e))){for(var t=this.toolControlIDs[e],i=t.length;--i>-1;){var r=t[i];this.controlToolIDs.hasOwnProperty(r)&&delete this.controlToolIDs[r],this.controlParamObjects.hasOwnProperty(r)&&delete this.controlParamObjects[r]}delete this.toolControlIDs[e]}}getToolVO(e){return e&&this.toolVOs.hasOwnProperty(e)?this.toolVOs[e]:null}setToolValue(e,t,i,r){var a=this.createToolVO(e);a[t]=i,a.updating=r||!1,a.updating_id=t;var n=new Event(UIToolsEvents.TOOL_PARAM_UPDATED.type);n.data={toolID:e,paramID:t,value:i},this.dispatchEvent(n)}getToolValue(e,t){if(this.toolVOs.hasOwnProperty(e)&&this.toolVOs[e].hasOwnProperty(t))return this.toolVOs[e][t]}setControlValue(e,t,i){if(this.controlToolIDs.hasOwnProperty(e)){var r=this.controlToolIDs[e],a=e.replace("".concat(r,"_"),"");this.setToolValue(r,a,t,i)}}getControlValue(e){if(this.controlToolIDs.hasOwnProperty(e)){var t=this.controlToolIDs[e],i=e.replace("".concat(t,"_"),"");return this.getToolValue(t,i)}}getParamObject(e){return this.controlParamObjects.hasOwnProperty(e)?this.controlParamObjects[e]:null}registerControl(e){if(this.controlParamObjects.hasOwnProperty(e)){var t=this.controlParamObjects[e];if(t.hasOwnProperty("type")){switch(t.type){case"button":this.registerButtonControl(e);break;case"slider":this.registerSliderControl(e);break;case"slider_item":this.registerSliderItemControl(e);break;case"button_bar":this.registerButtonBarControl(e);break;case"scrubber":this.registerScrubberControl(e);break;case"color":this.registerColorControl(e);break;case"color_item":this.registerColorItemControl(e);break;case"color_palette":this.registerColorPaletteControl(e);break;case"color_group":this.registerColorGroupControl(e);break;case"radio":this.registerRadioControl(e);break;case"checkbox":this.registerCheckBoxControl(e);break;case"checkbox_item":this.registerCheckBoxItemControl(e);break;case"dropdown_item":this.registerDropdownItemControl(e);break;case"textinput":this.registerTextInputControl(e);break;case"textarea":this.registerTextAreaControl(e)}this.updateToolControl(e)}}else BeFunky.log("-- NO DATA ENTRY FOR ELEMENT WITH ID : ".concat(e))}registerButtonControl(e){var t=this.controlParamObjects[e],i=document.getElementById(e);t&&t.hasOwnProperty("allowEvent")&&(i.allowEvent=t.allowEvent),t&&t.hasOwnProperty("interval")?(i.interval=t.interval,i.intervalDelay=t.hasOwnProperty("intervalDelay")?t.intervalDelay:t.interval,i.pressed=!1,i.pressMethod=function(e){this.pressed&&(null==e&&(e=this.interval),UITools.setControlValue(this.id,!0,!0),UITools.applyToolControl(this.id),UITools.setControlValue(this.id,!1,!1),setTimeout(this.pressMethod,e))}.bind(i),i.releaseMethod=function(){UITools.setToolValue("zoom","updating",!1,!1),UITools.applyToolControl(this.id),document.removeEventListener(BeFunky.pointerup,this.releaseMethod),this.pressed=!1}.bind(i),i.addEventListener(BeFunky.pointerdown,function(e){i.disabled||0===e.button&&(document.addEventListener(BeFunky.pointerup,this.releaseMethod),this.pressed=!0,this.pressMethod(this.intervalDelay),this.allowEvent||e.stopImmediatePropagation())}.bind(i))):i.addEventListener("click",function(e){t.preventDeselectOnDoubleClick&&(UITools.lastClickTime=Date.now()),UITools.setControlValue(this.id,!0),UITools.applyToolControl(this.id),UITools.setControlValue(this.id,!1),this.allowEvent||e.stopImmediatePropagation()}.bind(i))}registerSliderControl(e){var t=this.getParamObject(e),i={start:t.defaultValue,step:t.step,behaviour:"snap",animationDuration:0,connect:[!0,!1],range:{min:t.min,max:t.max}};var r=document.getElementById(e);return BFN.UI.slider(r,i,function(t,i){var r="end"!==t;UITools.setControlValue(e,i,r),UITools.applyToolControl(e)},t.enableStartEvent),r}registerSliderItemControl(e){var t=this.controlToolIDs[e],i=e.replace("".concat(t,"_"),""),r=this.getParamObject(e),a=document.getElementById(e);BFN.UI.sliderItem(a,{toolID:t,paramID:i,controlID:e,paramObject:r})}registerButtonBarControl(e){var t=this.getParamObject(e),i=document.getElementById(e);BFN.UI.buttonBar(i,{controlID:e,paramObject:t})}registerScrubberControl(e){var t=this.getParamObject(e),i=document.getElementById(e);BFN.UI.scrubber(i,t),i.addEventListener("change",function(e){UITools.setControlValue(this.id,this.currentValue,this.updating),UITools.applyToolControl(this.id)}),t.hasOwnProperty("unit")&&(i.unit=t.unit),t.hasOwnProperty("min")&&t.min!==i.minValue&&(i.minValue=t.min),t.hasOwnProperty("max")&&t.max!==i.maxValue&&(i.maxValue=t.max),t.hasOwnProperty("defaultValue")&&t.defaultValue!==i.currentValue&&(i.currentValue=t.defaultValue),t.hasOwnProperty("maxLength")&&(i.maxLength=t.maxLength),t.hasOwnProperty("arrowsAffectInputValue")&&(i.arrowsAffectInputValue=t.arrowsAffectInputValue)}registerColorControl(e){var t=this.getParamObject(e),i=document.getElementById(e);BFN.UI.colorButton(i),i.intensityEnabled=t.intensityEnabled||!1,i.emptyEnabled=!t.hasOwnProperty("emptyEnabled")||t.emptyEnabled,i.hueLocked=t.hueLocked||!1,i.borderEnabled=!0,i.fineChangeEnabled=t.fineChangeEnabled||!1,i.eyeDropperEnabled=!t.hasOwnProperty("eyeDropperEnabled")||t.eyeDropperEnabled,i.pickerName=t.hasOwnProperty("pickerName")?t.pickerName:t.hasOwnProperty("name")?t.name:null,i.addEventListener("click",function(){document.getElementById("color_picker_panel").colorButton=this}.bind(i)),i.addEventListener("change",function(){var e=UITools.controlToolIDs[this.id],t=this.id.replace("".concat(e,"_"),"");this.intensityEnabled&&UITools.setToolValue(e,"".concat(t,"_intensity"),this.intensity),UITools.setToolValue(e,t,this.hashColor),UITools.applyToolControl(this.id)}.bind(i)),i.fineChangeEnabled&&i.addEventListener("finechange",function(){var e=UITools.controlToolIDs[this.id],t=this.id.replace("".concat(e,"_"),"");this.intensityEnabled&&UITools.setToolValue(e,"".concat(t,"_intensity"),this.intensity),UITools.setToolValue(e,t,this.hashColor,!0),UITools.applyToolControl(this.id)}.bind(i))}registerColorItemControl(e){var t=this.getParamObject(e);BFN.UI.colorItem(document.getElementById(e),{controlID:e,paramObject:t})}registerColorPaletteControl(e){var t=this.getParamObject(e);BFN.UI.colorPalette(document.getElementById(e),{controlID:e,paramObject:t})}registerColorGroupControl(e){var t=this.getParamObject(e);BFN.UI.colorGroup(document.getElementById(e),{controlID:e,paramObject:t})}registerRadioControl(e){var t=[...document.querySelectorAll('input[name="'.concat(e,'"]'))];this.controlElements[e]=t,t.forEach(e=>{e.addEventListener("change",function(){UITools.setControlValue(this.name,this.value),UITools.applyToolControl(this.name)}.bind(e))})}registerCheckBoxControl(e){var t=document.getElementById(e);t||console.log("Checkbox not found",e),t.activeElement=t.dataset.activeElement?document.getElementById(t.dataset.activeElement):null,t.inactiveElement=t.dataset.inactiveElement?document.getElementById(t.dataset.inactiveElement):null;var i=function(e){e.activeElement&&e.activeElement.setStyles({display:e.checked?"block":"none"}),e.inactiveElement&&e.inactiveElement.setStyles({display:e.checked?"none":"block"})};this.updateToolControl(e),i(t),t.addEventListener("change",function(){i(this),UITools.setControlValue(this.id,this.checked),UITools.applyToolControl(this.id)}.bind(t))}registerCheckBoxItemControl(e){var t=this.getParamObject(e);BFN.UI.checkboxItem(document.getElementById(e),{controlID:e,paramObject:t})}registerDropdownItemControl(e){var t=this.getParamObject(e),i=document.getElementById(e);Tr(i,{initialOptions:t.data,label:!1===t.useLabel?void 0:t.name,defaultValue:t.defaultValue,onChange:t=>{UITools.setControlValue(e,t),UITools.applyToolControl(e)}});var r=i.selectedValue;this.setControlValue(e,r)}registerTextInputControl(e){var t=document.getElementById(e);t.addEventListener("change",function(){UITools.setControlValue(this.id,this.value,!0),UITools.applyToolControl(this.id)}.bind(t)),t.addEventListener("keyup",function(){UITools.setControlValue(this.id,this.value,!1),UITools.applyToolControl(this.id)}.bind(t))}registerTextAreaControl(e){var t=document.getElementById(e);t.addEventListener("change",function(){UITools.setControlValue(this.id,this.value),UITools.applyToolControl(this.id)}.bind(t))}updateToolControls(e){this.toolControlIDs.hasOwnProperty(e)&&this.toolControlIDs[e].forEach(e=>this.updateToolControl(e));UIToolsEvents.UPDATE_TOOL_CONTROLS.data=e,this.dispatchEvent(UIToolsEvents.UPDATE_TOOL_CONTROLS)}updateToolControl(e){if(this.controlParamObjects.hasOwnProperty(e)){var t=this.controlParamObjects[e].type,i=this.getControlValue(e);if(void 0!==t&&void 0!==i)switch(t){case"button":break;case"slider":case"slider_item":var r=document.getElementById(e);if(r&&(r.noUiSlider.set(i),"slider_item"===t))try{r.updateValueLabel()}catch(e){}break;case"scrubber":var a=document.getElementById(e);if(a){var n=this.getParamObject(e);n.hasOwnProperty("min")&&n.min!==a.minValue&&(a.minValue=n.min),n.hasOwnProperty("max")&&n.max!==a.maxValue&&(a.maxValue=n.max),a.currentValue=i}break;case"color":case"color_item":case"color_palette":case"color_group":var o=document.getElementById(e);if(o){if(o.hashColor=i,o.intensityEnabled){var s=this.controlToolIDs[e],l=e.replace("".concat(s,"_"),"");o.intensity=this.getToolValue(s,"".concat(l,"_intensity"))}"color_palette"===t&&o.hasOwnProperty("presetButtons")&&o.presetButtons.updateColorPresetButtons()}break;case"radio":case"button_bar":if(!this.controlElements[e])break;this.controlElements[e].forEach(e=>{e.checked=e.value==i});break;case"dropdown_item":var h=document.getElementById(e);h&&(h.selectedValue!==i||h.isMixed)&&(h.selectedValue=i);break;case"checkbox":case"checkbox_item":var c=document.getElementById(e);c&&c.checked!==i&&(c.checked=i);break;case"textinput":var u=document.getElementById(e);u&&u.value!==i&&(u.value=i);break;case"textarea":var d=document.getElementById(e);d&&d.value!==i&&(d.value=i)}UIToolsEvents.UPDATE_TOOL_CONTROL.data=e,this.dispatchEvent(UIToolsEvents.UPDATE_TOOL_CONTROL)}}applyToolControl(e){if(this.controlToolIDs.hasOwnProperty(e)){var t=this.controlToolIDs[e];this.applyTool(t)}}applyTool(e){var t=this.getToolVO(e);if(t){this.printToolVOs&&console.log(Object.keys(t).map(e=>"[ ".concat(e,": ").concat(t[e]," ]")).join(""));var i=new Event(UIToolsEvents.UPDATE_TOOL.type);i.data=e,this.dispatchEvent(i)}}setupControlItems(e,t){e&&t&&e.forEach(e=>{var i=e.toolID,r=e.controlID,a=e.controlName,n=e.controlParamObject,o=BFN.effectPresetMap.hasOwnProperty(i),s=n.customClasses,l=void 0===s?[]:s,h=n.name,c=void 0===h?a:h,u=n.icon,d=n.tooltip,m=n.type,p=n.values,g=n.icons,f=n.tooltips,v="";switch(n.uiType?n.uiType:m){case"button":v+='\n                    <div class="control-item">\n                        <button class="button button--outline button--fullwidth" id="'.concat(r,'" data-lang="').concat(c,'">\n                            ').concat(BeFunky.LanguageManager.getString(c),"\n                        </button>\n                    </div>");break;case"slider":v+='\n                    <div class="control-item control-item-slider '.concat(l.join(" "),'">\n                        <label class="control-item-label" data-lang="').concat(c,'">').concat(BeFunky.LanguageManager.getString(c),'</label>\n                        <div id="').concat(r,'"></div>\n                    </div>');break;case"slider_item":v+='\n                    <div class="control-item control-item-slider '.concat(l.join(" "),'">\n                        <div id="').concat(r,'"></div>\n                    </div>');break;case"color":v+='\n                    <div class="control-item '.concat(l.join(" "),'">\n                        <label class="control-item-label" data-lang="').concat(c,'">').concat(BeFunky.LanguageManager.getString(c),'</label>\n                        <div id="').concat(r,'"></div>\n                    </div>');break;case"button_bar":case"color_item":v+='<div class="control-item"><div id="'.concat(r,'"></div></div>');break;case"color_palette":v+='\n                    <div class="control-item">',o||(v+='\n                        <label class="control-item-label color-palette-label" data-lang="color_palette">\n                            '.concat(BeFunky.LanguageManager.getString("color_palette"),"\n                        </label>")),v+='\n                        <div id="'.concat(r,'"></div>\n                    </div>');break;case"color_group":v+='\n                    <div class="control-item">',o||(v+='\n                        <label class="control-item-label color-palette-label" data-lang="color_group">\n                            '.concat(BeFunky.LanguageManager.getString("color_group"),"\n                        </label>")),v+='\n                        <div id="'.concat(r,'"></div>\n                    </div>');break;case"checkbox":var y='\n                    <input type="checkbox" id="'.concat(r,'" />\n                    <label class="button button--toggle button--icon" for="').concat(r,'" ').concat(d?'data-bfntooltip="'.concat(d,'"'):"",' >\n                        <svg class="icon icon-size-large">\n                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(u,'"></use>\n                        </svg>\n                    </label>');t.buttonContainer||(t.buttonContainer=document.createElement("div").setClass("control-item button-group ".concat(l.join(" "))),t.appendChild(t.buttonContainer)),t.buttonContainer.insertAdjacentHTML("beforeend",y);break;case"checkbox_item":v+='<div class="control-item"><div id="'.concat(r,'"></div></div>');break;case"radio":for(var x='<div id="'.concat(r,'" class="toggle-group">'),_=0;_<p.length;_++){x+='\n                         <label class="toggle-group__label" for="'.concat(r,"_").concat(p[_],'" data-bfntooltip="').concat(f[_],'">\n                             <input type="radio" id="').concat(r,"_").concat(p[_],'" name="').concat(r,'" value="').concat(p[_],'" />\n\n                             <span class="toggle-group__button">\n                              <svg class="icon icon-size-large">\n                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(g[_],'"></use>\n                              </svg>\n                            </span>\n                        </label>\n                        ')}x+="</div>",t.buttonContainer||(t.buttonContainer=document.createElement("div").setClass("control-item button-group ".concat(l.join(" "))),t.appendChild(t.buttonContainer)),t.buttonContainer.insertAdjacentHTML("beforeend",x);break;case"radio_text_bar":v+='\n                    <div class="control-item" id="'.concat(r,'">\n                        <div class="toggle-group">\n                    ');for(var I=0;I<p.length;I++)v+='\n                            <label class="toggle-group__label'.concat(I?"":" active",'">\n                                <input type="radio" id="').concat(r,"_").concat(p[I],'" name="').concat(r,'" value="').concat(p[I],'">\n                                <span class="toggle-group__button" data-lang="').concat(p[I],'">').concat(BeFunky.LanguageManager.getString(p[I]),"</span>\n                            </label>\n                        ");v+="\n                        </div>\n                    </div>\n                    ";break;case"dropdown_item":v+='\n                    <div class="control-item">\n                        <div id="'.concat(r,'"></div>\n                    </div>\n                ')}v&&t.insertAdjacentHTML("beforeend",v)})}disableControlItem(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"control-item",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=document.getElementById(e),n=a?a.closestParent(e=>e.hasClass(i)):null;n?(n.toggleClass("control-item-disabled",!!t),n.setStyles({opacity:t&&"number"==typeof r?r:""})):BeFunky.logError("Unable to find control item to disable",{_controlID:e,_class:i})}toggleControlItem(e,t){var i=document.getElementById(e),r=i?i.closestParent(e=>e.hasClass("control-item")):null;if(r){r.hasOwnProperty("activeDisplayMode")||"none"===r.style.display||(r.activeDisplayMode=r.style.display);r.activeDisplayMode;r.setStyles(t?{display:r.activeDisplayMode}:{display:"none"})}}}function Sr(){var t=e(["<button id="," @click=",' class="sample-thumb"><img src='," /></button>"]);return Sr=function(){return t},t}function Cr(){var t=e(['\n        <div class="sample-image-container">\n            <div data-lang="guide_upload_photo" class="main-text">','</div>\n            <div class="sub-text">\n                <hr><span data-lang="guide_upload_photo_samples" >','</span>\n            </div>\n            <div class="sample-thumb-container">\n                ',"\n                ","\n                ","\n            </div>\n        </div>"]);return Cr=function(){return t},t}BFN.SingletonQueue.add(()=>{window.UITools=new br});class Br{constructor(){this.init()}init(){BeFunky.log("UIToggler Init"),this.initDefaultValues()}initDefaultValues(){this.mainMenu=document.getElementById("side_panel_menu_panels"),this.sampleImagePopover=null,this.alternateContainer=document.getElementById("alternateContainer"),this.alternateContainer.zIndexOverFabric=!0,BFN.addFloatingElement(this.alternateContainer),this.alternateContainer.addEventListener(BeFunky.pointerdown,e=>{BFN.focusFloatingElement(this.alternateContainer)},!0),this.alternateMenu=document.getElementById("alternateMenu"),this.alternateMenuIDs=[],this.toggleAlternateMenu=BeFunky.debounce(this.toggleAlternateMenuImmediately.bind(this),20),this.appStage=document.getElementById("appStage"),this.zoomMenu=document.getElementById("zoom_menu"),this.zoomMenuButtons=[...this.zoomMenu.children].filter(e=>"BUTTON"===e.nodeName)}toggleNavBar(e){document.getElementsByClassName("navbar").setStyles({pointerEvents:e?"all":"none",opacity:e?1:.5})}toggleMainMenu(e){this.mainMenu.toggleClass("active",e)}toggleZoomMenu(e){this.zoomMenu.toggleClass("zoom-bar--disabled",!e),this.zoomMenuButtons.forEach(t=>t.disabled=!e)}setupSampleImagePopover(){var e=BeFunky.lit,t=e.appLang,i=e.elem,r=e.html,a=i(Cr(),t("guide_upload_photo",!0),t("guide_upload_photo_samples",!0),n("sample_1"),n("sample_4"),n("sample_3"));function n(e){var t="".concat(BFN.remoteImagesURL,"app/graphics/photoeditor/samples/thumbs/").concat(e,".jpg");return r(Sr(),"editor_sample_image_".concat(e),()=>BFN.PhotoEditorModel.openSampleImage(e),t)}var o=document.getElementById("sample_image_popover");return o.container.appendChild(a),o}toggleSampleImagePopover(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.sampleImagePopover){if(!e)return;this.sampleImagePopover=this.setupSampleImagePopover()}e?(this.sampleImagePopover.show(),t&&this.sampleImagePopover.bounce()):this.sampleImagePopover.hide(),document.getElementById("canvas_drag_drop_area").toggleClass("drag-drop-area--initial",e)}toggleSaveButtons(e){var t=document.getElementById("editor_save_image_menu");e?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")}toggleAlternateMenuInteractivity(e){var t=this.alternateMenu;e?t.classList.remove("disabled"):t.classList.add("disabled")}toggleAlternateMenuImmediately(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];var n=this.alternateMenu,o=n.hasClass("active");(e||o)&&(e&&o&&this.alternateMenuIDs.length===r.length&&this.alternateMenuIDs.every(e=>r.includes(e))||(this.mainMenu.toggleClass("side-panel--alt-menu-displayed",e),BFN.focusFloatingElement(this.alternateContainer),function(){n.onEscape&&document.removeEventListener("keyup",n.onEscape);if(!e)return;n.onEscape=(e=>{if(27===e.which&&!BeFunky.isPointerDown)if(r.includes("layer_isolator_tool_menu")){var t=document.getElementById("layer_isolator_tool_menu");t.contains(BFN.applyCancelMenu.cancelButton)?BFN.applyCancelMenu.cancelButton.click():BeFunky.throwError("Unable to cancel layer isolator tool on Escape")}else{var a,n=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}(r);try{for(n.s();!(a=n.n()).done;){var o=a.value,s=document.getElementById(o);if(s.hasClass("panel-header"))return void s.querySelector(".panel-header__button--close").click()}}catch(e){n.e(e)}finally{n.f()}}}),document.addEventListener("keyup",n.onEscape)}(),clearTimeout(n.hide),cancelAnimationFrame(n.slide),e?(this.alternateMenuIDs=r,[...n.children].forEach(e=>{r.includes(e.id)?e.setStyles({display:e.hasClass("panel-header")?"flex":"block"}):e.setStyles({display:"none"})}),r.includes("text_menu")&&BFN.FontManager.preloadFontBGImageSprites(),!r.includes("text_menu")&&BFN.FontManager.fontMenuComponent&&BFN.FontManager.fontMenuComponent.hide(!0),n.setStyles({display:"block"}),n.slide=requestAnimationFrame(()=>n.addClass("active"))):(this.alternateMenuIDs=[],n.dispatchEvent(new Event(BeFunky.pointerdown)),n.removeClass("active"),n.hide=setTimeout(()=>{n.slide=requestAnimationFrame(()=>n.setStyles({display:"none"}))},150))))}toggleLoadScreen(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.isCancellable,r=void 0===i||i,a=t.message,n=void 0===a?"":a,o=t.progress,s=void 0===o?"":o,l=t.onCancel,h=t.showIris,c=void 0===h||h;e?BeFunky.showLoadScreen({message:n,showIris:c,progress:s,isCancellable:r,onCancel:l}):BeFunky.hideLoadScreen()}showLoadScreenWhileTrue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.testMethods||(this.testMethods=[]),e&&!this.testMethods.includes(e)&&(e.active=!1,setTimeout(()=>{e.active=!0},t),this.testMethods.length?this.testMethods.push(e):(this.testMethods.push(e),this.processLoadScreenTestMethods()))}processLoadScreenTestMethods(){if(this.testMethods.length){var e=!1,t=!1;this.testMethods.forEach(i=>{i.active?t=t||i():e=!0}),t||e?(t&&!BeFunky.isLoadScreenActive()?this.toggleLoadScreen(!0,{isCancellable:!1}):!t&&BeFunky.isLoadScreenActive()&&this.toggleLoadScreen(!1),requestAnimationFrame(this.processLoadScreenTestMethods.bind(this))):(this.testMethods.forEach(e=>{delete e.active}),this.testMethods.splice(0),BeFunky.isLoadScreenActive()&&this.toggleLoadScreen(!1))}}}function Fr(){var t=e(["<div></div>"]);return Fr=function(){return t},t}BFN.SingletonQueue.add(()=>{window.UIToggler=new Br}),window.UIHistoryEvents={HISTORY_ITEMS_UPDATED:new Event("HISTORY_ITEMS_UPDATED")};class Er extends BFN.EventDispatcher{constructor(){super(),BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,()=>{this.init()})}init(){BeFunky.log("UIToggler Init"),this.initDefaultValues(),this.initHistoryPreview(),BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED.data={undoExists:!1,redoExists:!1},BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED)}initDefaultValues(){var e;this.globalHistoryMenu=document.getElementById("globalHistoryMenu"),BFN.UI.draggablePanel(this.globalHistoryMenu),BFN.HelpClueManager.setup("global_history",{side:"right",positionFactor:.37,left:"-12px",container:()=>e||(e=BeFunky.lit.elem(Fr()),this.panelHeader.insertAdjacentElement("afterend",e),e)}),this.panelHeader=this.globalHistoryMenu.querySelector(".panel-header"),BFN.UI.panelHeader(this.panelHeader,{name:"history",modifier:"alternate",closeEnabled:!0,helpEnabled:!0}),this.panelHeader.addEventListener("CLOSE",()=>{UITools.setToolValue("history","toggle_panel",!1,!1),UITools.applyTool("history"),UITools.updateToolControls("history")}),this.panelHeader.addEventListener("HELP",()=>{BFN.HelpClueManager.toggle("global_history")}),this.globalHistoryMenuButtonIDs=[],this.globalHistoryMenuButtons=[],this.buttonContainer=document.getElementById("globalHistoryMenuButtonContainer"),this.buttonContainerInner=document.createElement("div").setStyles({position:"relative"}),this.buttonContainer.appendChild(this.buttonContainerInner),this.resetButton=document.getElementById("editor_history_action_reset"),this.undoButton=document.getElementById("editor_history_action_undo"),this.redoButton=document.getElementById("editor_history_action_redo"),this.mouseEvent=null,this.updateHistoryAvailable(),this.handleGlobalHistoryIDUpdated=BeFunky.debounce(this.handleGlobalHistoryIDUpdated.bind(this),10),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,this.handleGlobalHistoryUpdated.bind(this)),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.type,this.handleGlobalHistoryIDUpdated.bind(this)),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED.type,this.handleGlobalHistoryButtonsUpdated.bind(this)),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.updateHistoryAvailable.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.updateHistoryAvailable.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.updateHistoryAvailable.bind(this)),document.getElementById("history_toggle_panel").parentElement.querySelector('label[for="history_toggle_panel"]').preventItemDeselect=!0}initHistoryPreview(){this.handleButtonContainerOverBind=this.handleButtonContainerOver.bind(this),this.handleButtonContainerOutBind=this.handleButtonContainerOut.bind(this),this.handleButtonContainerMoveBind=this.handleButtonContainerMove.bind(this),this.historyPreviewPopover=document.getElementById("history_preview_popover"),this.historyPreviewImage=new Image,this.historyPreviewImage.onload=function(){var e=document.getElementById("history_preview_image_container");e.innerHTML="",e.appendChild(this.historyPreviewImage),this.updateHistoryPreviewPopoverDisplay()}.bind(this),this.buttonContainer.addEventListener(BeFunky.pointerover,this.handleButtonContainerOverBind),this.buttonContainer.addEventListener(BeFunky.pointerout,this.handleButtonContainerOutBind)}handleHistory(){var e=UITools.getToolVO("history");switch(e.updating_id){case"toggle_panel":this.toggleHistoryPanel(e.toggle_panel)}}toggleHistoryPanel(e){var t=()=>{if(!BFN.MainUI.viewportUpdating||!e||e&&this.temporarilyHidePanel)if(e){var i=this.globalHistoryMenu.panelSize,r=BFN.appViewportRect;this.temporarilyHidePanel?(this.temporarilyHidePanel=!1,this.globalHistoryMenu.show()):this.globalHistoryMenu.show(r.x+r.width-i.width-10,r.y+r.height-i.height-10),BFN.HelpClueManager.show("global_history")}else this.hasOwnProperty(this.togglePanelTimeoutID)&&(clearTimeout(this.togglePanelTimeoutID),delete this.togglePanelTimeoutID),this.globalHistoryMenu.hide(),BFN.HelpClueManager.hide("global_history");else this.togglePanelTimeoutID=setTimeout(()=>{t()},10)};t()}updateHistoryAvailable(){var e=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&!BFN.TransformItemIsolator.active;BFN.AppModel.viewingEditor?e=e&&BFN.PhotoEditorModel.currentTexture:e&&this.temporarilyHidePanel&&(UITools.setToolValue("history","toggle_panel",!0),UITools.applyTool("history"),UITools.updateToolControls("history")),!e&&UITools.getToolValue("history","toggle_panel")?this.temporarilyHidePanel=!0:e&&this.temporarilyHidePanel&&(UITools.setToolValue("history","toggle_panel",!0),UITools.applyTool("history"),UITools.updateToolControls("history")),document.getElementById("history_toggle_panel").disabled=!e,!e&&UITools.getToolValue("history","toggle_panel")&&(UITools.setToolValue("history","toggle_panel",!1),UITools.applyTool("history"),UITools.updateToolControls("history"))}updateGlobalHistoryMenuDisplay(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e&&this.globalHistoryMenuButtonIDs.length){var t=!0;[...this.buttonContainerInner.children].forEach(i=>{i.toggleClass("active",t);var r=i.id===e;i.toggleClass("selected",r),r&&(t=!1)})}}updateHistoryPreviewPopoverDisplay(){if(this.mouseEvent){var e=this.globalHistoryMenu.getBoundingClientRect();this.historyPreviewPopover.setStyles({top:"".concat(this.mouseEvent.pageY-e.top,"px")});var t=this.buttonContainer.getBoundingClientRect(),i=this.mouseEvent.pageY-t.top,r=t.width,a=t.height,n=this.historyPreviewPopover.container.getBoundingClientRect().height,o=i/a,s=Math.min(1,a/n);this.historyPreviewPopover.positionFactor=(1-s)/2+o*s,e.left+r/2>BFN.appRect.width/2?(this.historyPreviewPopover.setStyles({left:"-10px"}),this.historyPreviewPopover.side="right"):(this.historyPreviewPopover.setStyles({left:"".concat(r+10,"px")}),this.historyPreviewPopover.side="left")}}handleGlobalHistoryUpdated(e){var t=this;if(e.ids&&e.data){for(var i=this.globalHistoryMenuButtonIDs.length;--i>-1;){var r=this.globalHistoryMenuButtonIDs[i];-1===e.ids.indexOf(r)&&(this.globalHistoryMenuButtons[i].parentNode.removeChild(this.globalHistoryMenuButtons[i]),this.globalHistoryMenuButtons.splice(i,1),this.globalHistoryMenuButtonIDs.splice(i,1))}var a=document.createDocumentFragment(),n=function(){var r=e.data[i];if(t.globalHistoryMenuButtonIDs.indexOf(r.id)>=0){if(r.hasOwnProperty("thumb")&&r.thumb&&(!r.hasOwnProperty("useGroupIcon")||!r.useGroupIcon)){var n=t.globalHistoryMenuButtons.find(e=>e.id===r.id&&e.thumb.src!==r.thumb.src);n&&(n.thumb.src=r.thumb.src,n.previewSRC=r.preview?r.preview.src:"")}var o=document.getElementById(r.id);o&&o.removeClass("selected")}else{t.globalHistoryMenuButtonIDs.push(r.id);var s=document.createElement("button").setClass("globalHistoryMenuButton button button--list active");if(s.id=r.id,r.hasOwnProperty("isGroup")&&r.isGroup||r.hasOwnProperty("useGroupIcon")&&r.useGroupIcon)s.innerHTML='<svg class="icon icon-size-large"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#history-group"></use></svg>';else if(r.hasOwnProperty("isText")&&r.isText||r.hasOwnProperty("useTextIcon")&&r.useTextIcon)s.innerHTML='<svg class="icon icon-size-large"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#history-text-icon"></use></svg>';else if(r.hasOwnProperty("thumb")&&r.thumb){var l=document.createElement("img");l.id="".concat(r.id,"_thumb"),l.addClass("globalHistoryMenuButtonImage"),l.src=r.thumb.src,s.thumb=l,s.appendChild(l)}r.name||console.log("Invalid dataObject:",JSON.stringify(r)),s.insertAdjacentHTML("beforeend",'<string data-lang="'.concat(r.name,'">').concat(BeFunky.LanguageManager.getString(r.name),"</string>")),s.previewSRC=r.hasOwnProperty("thumb")&&r.preview?r.preview.src:"",s.addEventListener("click",function(){BFN.GlobalHistoryModel.historyUpdateQueued||-1===UIHistory.globalHistoryMenuButtonIDs.indexOf(this.id)||(this.hasClass("selected")?BFN.AppModel.viewingEditor&&BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&BFN.ImagePainterUndoManager.currentImagePainter&&document.getElementById("editor_apply_cancel_cancel").click():(BFN.GlobalHistoryModelEvents.SELECT_HISTORY_ITEM.data=this.id,BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.SELECT_HISTORY_ITEM),BFN.BfnService.track("CREATE","HISTORYPANEL","LIST")),this.blur())}.bind(s)),s.addEventListener(BeFunky.pointerover,function(){this.previewSRC?(UIHistory.historyPreviewImage.src=this.previewSRC,UIHistory.historyPreviewPopover.show()):UIHistory.historyPreviewPopover.hide()}.bind(s)),s.addEventListener(BeFunky.pointerout,()=>{UIHistory.historyPreviewPopover.hide()}),t.globalHistoryMenuButtons.push(s),a.appendChild(s)}};for(i=0;i<e.data.length;i++)n();if(this.buttonContainerInner.appendChild(a),this.globalHistoryMenuButtons.length)this.globalHistoryMenuButtons[this.globalHistoryMenuButtons.length-1].addClass("selected");this.buttonContainer.scrollTop=this.buttonContainer.scrollHeight,this.dispatchEvent(UIHistoryEvents.HISTORY_ITEMS_UPDATED)}}handleGlobalHistoryIDUpdated(e){var t=e.data;if(this.updateGlobalHistoryMenuDisplay(t),this.globalHistoryMenuButtonIDs.length){if(!document.getElementById(t))return;var i=this.buttonContainer.scrollTop,r=32*this.globalHistoryMenuButtonIDs.indexOf(t);if(r<i)this.buttonContainer.scrollTop=r;else{var a=this.buttonContainer.getBoundingClientRect().height;r+32>a+i&&(this.buttonContainer.scrollTop=r+32-a)}}}handleGlobalHistoryButtonsUpdated(e){this.undoButton.disabled=!e.data.undoExists,this.redoButton.disabled=!e.data.redoExists;var t=(!BFN.AppModel.viewingEditor||BFN.AppModel.viewingEditor&&BFN.PhotoEditorModel.currentTexture)&&!BFN.TransformItemIsolator.active;this.resetButton.disabled=!t}handleButtonContainerOver(e){this.mouseEvent=e,this.updateHistoryPreviewPopoverDisplay(),this.buttonContainer.addEventListener(BeFunky.pointermove,this.handleButtonContainerMoveBind)}handleButtonContainerOut(e){this.mouseEvent=e,this.buttonContainer.removeEventListener(BeFunky.pointermove,this.handleButtonContainerMoveBind)}handleButtonContainerMove(e){this.mouseEvent=e,this.updateHistoryPreviewPopoverDisplay()}}BFN.SingletonQueue.add(()=>{window.UIHistory=new Er});class Pr extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("UIMessages Init"),this.initDefaultValues(),this.initMessageScreen()}initDefaultValues(){}initMessageScreen(){this.messageScreen=document.getElementById("messageScreen"),BFN.UI.messageScreen(this.messageScreen)}display(e,t){this.messageScreen.show(e||"< MESSAGE MISSING >",t)}}BFN.SingletonQueue.add(()=>{window.UIMessages=new Pr});class Nr extends BFN.EventDispatcher{constructor(){super(),setTimeout(this.init.bind(this),0)}init(){BeFunky.log("UIScreens Init"),this.initTooltipScreen(),this.initDragScreen(),this.initCursorScreen()}initTooltipScreen(){this.tooltipScreen=document.getElementById("tooltipScreen"),BFN.UI.tooltipScreen(this.tooltipScreen),BFN.TooltipScreen=this.tooltipScreen,this.tooltipDelay=50,this.tooltipMouseEvent=null,this.attemptToShowTooltip=BeFunky.debounce(()=>{if(!this.tooltipScreen.reserved){var e=this.getTooltip(this.tooltipMouseEvent.target),t=e.tooltip,i=e.isAbove;if(t){var r=t.startsWith("shortcut__")?BFN.KeyboardManager.getShortcutTooltip(t.replace("shortcut__","")):BeFunky.LanguageManager.getString(t),a=/^[a-z0-9_!]+$/.test(t)&&r.includes("<");this.tooltipScreen.show(r,!1,!1,a);var n=this.tooltipMouseEvent.pageX,o=this.tooltipMouseEvent.pageY+(i?-24:0);this.tooltipScreen.setPosition(n,o,i)}}},this.tooltipDelay),this.handleDocumentMouseDown=this.handleDocumentMouseDown.bind(this),this.handleDocumentMouseMove=this.handleDocumentMouseMove.bind(this),this.handleDocumentMouseUp=this.handleDocumentMouseUp.bind(this),this.isMouseListened=!1,this.toggleMouseEvent(!0)}toggleMouseEvent(e){this.isMouseListened!==e&&(this.isMouseListened=e,e?(document.addEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown),document.addEventListener(BeFunky.pointerup,this.handleDocumentMouseUp),document.addEventListener(BeFunky.pointermove,this.handleDocumentMouseMove)):(document.removeEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUp),document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMove)))}initDragScreen(){this.dragScreen=document.getElementById("dragScreen"),BFN.UI.dragScreen(this.dragScreen),BFN.DragScreen=this.dragScreen}initCursorScreen(){var e=document.getElementById("appStage");BFN.UI.cursorScreen(e),BFN.CursorScreen=e}getTooltip(e){if(!e||!e.getAttribute)return{};if(e===BFN.Stage.view)return BFN.MainUI.tooltip?{tooltip:BFN.MainUI.tooltip,isAbove:!1}:{};var t=e.getAttribute("data-bfntooltip");if(t)return{tooltip:t,isAbove:e.hasAttribute("data-bfntooltip-above")};var i=e.parentElement;return i&&"bfn-app"!==i.id?this.getTooltip(i):{}}handleDocumentMouseDown(){this.tooltipScreen.reserved||this.tooltipScreen.hide()}handleDocumentMouseMove(e){this.tooltipScreen.reserved||BeFunky.isPointerDown||(this.tooltipMouseEvent=e,this.tooltipScreen.hide(),this.attemptToShowTooltip())}handleDocumentMouseUp(e){this.tooltipScreen.reserved||BeFunky.isPointerDown||this.tooltipScreen.active&&this.tooltipMouseEvent&&["BUTTON","INPUT"].includes(this.tooltipMouseEvent.target.nodeName)&&(this.tooltipMouseEvent=e,this.attemptToShowTooltip())}}function Mr(){var t=e(['<div class="layers-groups__tabs"></div>']);return Mr=function(){return t},t}function Dr(){var t=e(["<div></div>"]);return Dr=function(){return t},t}function wr(){var t=e(['<div class="panel-header"></div>']);return wr=function(){return t},t}function kr(){var t=e(["<input\n            id=",'\n            type="text"\n            class="input"\n            value=',"\n            @click=","\n            @keydown=","\n            @blur=","\n        />"]);return kr=function(){return t},t}function Lr(){var t=e(["<button @click=",' class="button button--icon button--transparent layer-item__button--delete" data-bfntooltip="remove_from_group">\n            ',"\n        </button>"]);return Lr=function(){return t},t}function Or(){var t=e(['<img class="layer-item__thumbnail" src='," />"]);return Or=function(){return t},t}function Rr(){var t=e(['<div class="layer-item__thumbnail">',"</div>"]);return Rr=function(){return t},t}function Ar(){var t=e(["<div @click=",' class="layer-item__name">',"</div>"]);return Ar=function(){return t},t}function Vr(){var t=e(["\n        <div\n            @click=","\n            @mousedown=","\n            @pointerdown=","\n            .layerObject=","\n            class=","\n        >\n            ","\n            ","\n            ","\n        </div>\n        "]);return Vr=function(){return t},t}function Ur(){var t=e(["<div @click=",' class="group-item__header-name" data-bfntooltip="rename_group">',"</div>"]);return Ur=function(){return t},t}function Gr(){var t=e(["\n        <div @contextmenu="," class=",">\n            <div @click=",' class="button button--list group-item__header">\n                <button @click='," class="," data-bfntooltip=",">\n                    ","\n                </button>\n                ","\n                ","\n                <button @click=",' class="button button--icon button--transparent group-item__header-button--delete" data-bfntooltip="delete_group">\n                    ','\n                </button>\n            </div>\n            <div class="group-item__members" style=',">\n                ","\n            </div>\n        </div>\n        "]);return Gr=function(){return t},t}function Hr(){var t=e(['<div class="layers-groups__no-groups">\n                ',"\n            </div>"]);return Hr=function(){return t},t}function zr(){var t=e(['<div class="layers-groups__no-layers">',"</div>"]);return zr=function(){return t},t}function Xr(){var t=e(["\n            ","\n            ","\n            ","\n        "]);return Xr=function(){return t},t}function jr(){var t=e(['<div id="layers_groups_panel" class="layers-groups"></div>']);return jr=function(){return t},t}BFN.SingletonQueue.add(()=>{window.UIScreens=new Nr});var Wr=BeFunky.lit,Yr=Wr.html,qr=Wr.setupState,Kr=Wr.render,Qr=Wr.appLang,Zr=Wr.icon,Jr=Wr.elem;function $r(e){var i,r,a,n,o,s=e.onGroupSelection,l=e.onRemoveGroupMember,h=e.onDeleteGroup,c=e.isLayerSelected,u=e.onLayerClick,d=e.onLayerPointerDown,m=Jr(jr()),p=BeFunky.debounce(()=>{n&&("layers"===i.activeTab?Kr(function(){if(!f.layers.length)return Yr(zr(),Qr("no_layers"));var e=f.layers.map(e=>C(e,{isSortable:!0}));return setTimeout(()=>{r.isSortableList?r.refreshList():BFN.UI.sortableList(r,{handleTargetIndexUpdated:D,handleOrderUpdated:w})},0),e}(),r):Kr(function(){if(!f.groups.length)return Yr(Hr(),Qr(["no_groups",{learn_more:'<a href="'.concat(BeFunky.Params.blogUrl,'layers-and-groups/" target="_blank" class="tutorial-link">').concat(Qr("learn_more",!0),"</a>")}]));return f.groups.map(S)}(),a),o&&o())},"raf"),g=t(qr({layers:[],groups:[],expandedGroupIDs:[],selectedLayerIDs:[],renamingLayer:null,renamingGroup:null,lastClickedGroupID:null},p),2),f=g[0],v=g[1];BeFunky.LanguageManager.addLanguageUpdateListener(p);var y,x,_=(y=Jr(wr()),BFN.UI.panelHeader(y,{name:"layers_and_groups",modifier:"alternate",closeEnabled:!0,helpEnabled:!0,helpClueID:"layers_groups"}),y.addEventListener("CLOSE",()=>{UITools.setToolValue("layers","toggle_panel",!1,!1),UITools.applyTool("layers"),UITools.updateToolControls("layers")}),y),I=(x=Jr(Dr()),BFN.HelpClueManager.setup("layers_groups",{left:"242px",positionFactor:.3,container:x}),x);i=Jr(Mr()),BFN.UI.tabbedLayout(i,{tabs:{layers:'<div class="layers-groups__layers"></div>',groups:'<div class="layers-groups__groups"></div>'}}),BFN.MainUI.addIdleRenderFunction(()=>{i.updatePanelContainerHeight()}),r=i.querySelector(".layers-groups__layers"),a=i.querySelector(".layers-groups__groups"),i.querySelector(".tab__nav").addEventListener(BeFunky.pointerdown,e=>{e.stopImmediatePropagation()},!0),i.addEventListener("TAB_CHANGE",N),Kr(Yr(Xr(),_,I,i),m),BFN.UI.draggablePanel(m);var T=m.show,b=m.hide;return Object.assign(m,{state:f,setState:v,switchTabs:function(e){i.activeTab=e},show:function(){n=!0,p();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];T.call(m,...t),BFN.HelpClueManager.show("layers_groups")},hide:function(){n=!1,b.call(m)}}),m;function S(e){var t=e.id,i=e.itemIDs,r=i.length>0,a=f.expandedGroupIDs.includes(t),n=r&&i.every(e=>f.selectedLayerIDs.includes(e)),o=i.map(e=>f.layers.find(t=>t.id===e));return o.every(Boolean)||(BeFunky.logError("Unable to find layer for group",JSON.stringify({group:e,layers:f.layers.map(e=>e&&{id:e.id,name:e.name,item:e.item instanceof BFN.TransformItem?"TransformItem":BeFunky.stringValue(e.item)})})),o=o.filter(Boolean)),Yr(Gr(),e=>e.preventDefault(),"group-item ".concat(r?"":"group-item--empty"," ").concat(n?"group-item--selected":""),e=>(function(e,t){if(v({lastClickedGroupID:t}),!e.ctrlKey&&!e.metaKey)return s([t]);var i=f.groups.filter(e=>{var t=e.itemIDs;return t.every(e=>f.selectedLayerIDs.includes(e))}).map(e=>e.id).unique();i.includes(t)||s([...i,t])})(e,t),e=>(function(e,t){e.stopPropagation(),f.expandedGroupIDs.includes(t)?v({expandedGroupIDs:f.expandedGroupIDs.filter(e=>e!==t)}):v({expandedGroupIDs:[...f.expandedGroupIDs,t]})})(e,t),"button button--icon button--transparent group-item__header-button group-item__header-button--".concat(a?"collapse":"expand"),a?"collapse":"expand",Zr("global-arrow-down-icon","icon icon-size-tiny"),Zr("layer-icon","icon icon-size-large group-item__header-icon"),function(e){if(f.renamingGroup===e)return B(e);return Yr(Ur(),t=>(function(e,t){if(e.shiftKey||e.ctrlKey||e.metaKey)return;if(f.lastClickedGroupID!==t.id)return;if(!t.itemIDs.length||!t.itemIDs.every(e=>f.selectedLayerIDs.includes(e)))return;v({renamingGroup:t})})(t,e),e.name)}(e),e=>(function(e,t){e.stopPropagation(),h(t)})(e,t),Zr("transform-delete","icon icon-size-regular"),"height: ".concat(a?32*i.length:0,"px"),o.map(e=>C(e,{groupID:t})))}function C(e,t){var i=t.groupID,r=t.isSortable,a=void 0!==r&&r,n=e.id,o=e.item;return Yr(Vr(),()=>u(e),t=>M(t,e),t=>M(t,e),e,"button button--list layer-item ".concat(a?"sortable-list__item":""," ").concat(f.renamingLayer===e?"input-active":""," ").concat(f.selectedLayerIDs.includes(n)?"selected":""),function(e,t){if("text"===e)return Yr(Rr(),Zr("history-text-icon","icon icon-size-large"));return Yr(Or(),t)}(o.type,o.thumbImage?o.thumbImage.src:""),function(e){if(f.renamingLayer===e)return B(e);return Yr(Ar(),t=>(function(e,t){if(e.shiftKey||e.ctrlKey||e.metaKey)return;if(!c(t))return;v({renamingLayer:t})})(t,e),e.name)}(e),i?function(e,t){return Yr(Lr(),()=>l(e,t),Zr("global-cancel-icon","icon icon-size-small"))}(i,n):"")}function B(e){var t=Boolean(e.itemIDs),i="edit_name_".concat(e.id);return!document.getElementById(i)&&requestAnimationFrame(()=>{var e=document.getElementById(i);e&&(e.focus(),e.select())}),Yr(kr(),i,e.name,e=>e.stopPropagation(),i=>t?function(e,t){27===e.keyCode?v({renamingGroup:null}):13===e.keyCode&&P(e,t)}(i,e):function(e,t){27===e.keyCode?v({renamingLayer:null}):13===e.keyCode&&E(e,t)}(i,e),i=>t?function(e,t){P(e,t)}(i,e):function(e,t){E(e,t)}(i,e))}function F(e,t,i){e.setItemZIndex(t,i),e.transformLayer.lastClickedItem=e,e.transformLayer.transformItems.includes(e)||BeFunky.throwError("TransformItem is in layers & groups panel but not in TransformLayer")}function E(e,t){if(f.renamingLayer===t){var i=e.target.value.trim();i&&t.name!==i?(t.item.itemName=i,v({renamingLayer:null,layers:f.layers.map(e=>(e.id===t.id&&(e.name=i),e))})):v({renamingLayer:null})}}function P(e,t){if(f.renamingGroup===t){var i=e.target.value.trim();i&&t.name!==i?(BFN.GroupManager.renameGroup(t.id,i),v({renamingGroup:null,groups:f.groups.map(e=>(e.id===t.id&&(e.name=i),e))})):v({renamingGroup:null})}}function N(){f.lastClickedGroupID?v({lastClickedGroupID:null}):p()}function M(e,t){if(e.type===BeFunky.pointerdown){var r="layers"===i.activeTab&&f.selectedLayerIDs.length>1;return d(e,t,r)}}function D(e,t,i){var r=f.layers.length-i-1;F(e.layerObject.item,r,!0)}function w(e,t,i){var r=f.layers.length-i-1;return F(e.layerObject.item,r,!1),new Promise(e=>{var t=setTimeout(()=>{BeFunky.throwError("handleOrderUpdated timed out"),e()},1e3);o=(()=>{clearTimeout(t),e()})})}}class ea{constructor(){this.init()}init(){window.addEventListener("INIT_COMPLETE",()=>{this.initDefaultValues(),this.updateLayersAvailable()})}initDefaultValues(){this.flattenLayersButton=null,this.updateLayersAvailable=BeFunky.debounce(this.updateLayersAvailable.bind(this),10),this.handleItemsUpdated=BeFunky.debounce(this.handleItemsUpdatedImmediately.bind(this),10),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.updateLayersAvailable),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.updateLayersAvailable),BFN.TransformLayerManager.addEventListener(BFN.TransformLayerManagerEvents.ITEMS_UPDATED.type,this.updateLayersAvailable),BFN.TransformLayerManager.addEventListener(BFN.TransformLayerManagerEvents.ITEMS_UPDATED.type,this.handleItemsUpdated),BFN.TransformLayerManager.addEventListener(BFN.TransformLayerManagerEvents.SELECTION_UPDATED.type,this.handleSelectionUpdated.bind(this)),BFN.GroupManager.addEventListener(BFN.GroupManagerEvents.GROUPS_UPDATED.type,this.handleGroupsUpdated.bind(this)),BeFunky.LanguageManager.addLanguageUpdateListener(this.handleLanguageChanged.bind(this)),document.getElementById("layers_toggle_panel").parentElement.querySelector('label[for="layers_toggle_panel"]').preventItemDeselect=!0}setupLayersPanel(){this.layersPanel||(this.layersPanel=$r({onGroupSelection:e=>BFN.GroupManager.selectGroups(e),onRemoveGroupMember:(e,t)=>BFN.GroupManager.removeItemsFromGroup(e,[t]),onDeleteGroup:e=>BFN.GroupManager.deleteGroup(e),isLayerSelected:e=>{var t=e.item;return BFN.TransformModel.selectedTransformItem===t&&t.transformLayer.lastClickedItem===t},onLayerClick:e=>{var t=e.item;t.transformLayer.lastClickedItem=t},onLayerPointerDown:(e,t,i)=>{e.stopPropagation();var r=t.item,a=r.transformLayer.lastPressedItem,n=r.transformLayer.lastSelectedItem;if(r.transformLayer.lastPressedItem=r,BFN.TransformModel.selectedTransformItem!==r||2===e.button)if(2===e.button&&(r.transformLayer.lastClickedItem=r),2===e.button&&i)BFN.TransformItemGroup.pressItem(e);else if(!e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)r.pressItem(e),r.initiateLongPress();else{if(1===BFN.TransformLayerManager.selectedItems.length&&BFN.TransformLayerManager.selectedItems[0]===r||!a||!n)return void r.pressItem(e);for(var o=[...BFN.TransformLayerManager.selectedItems],s=BFN.TransformLayerManager.transformItems.indexOf(a),l=BFN.TransformLayerManager.transformItems.indexOf(n),h=BFN.TransformLayerManager.transformItems.indexOf(r),c=BFN.TransformLayerManager.transformItems.slice(Math.min(h,s),Math.max(h,s)+1),u=o.length;--u>-1;){var d=o[u];c.includes(d)&&o.splice(u,1)}BFN.TransformLayerManager.transformItems.slice(Math.min(h,l),Math.max(h,l)+1).forEach(e=>{o.includes(e)||o.push(e)}),BFN.GroupManager.selectItems(o)}else r.initiateLongPress()}}),BFN.appContainer.appendChild(this.layersPanel))}handleLayers(){var e=UITools.getToolVO("layers");switch(e.updating_id){case"toggle_panel":this.toggleLayersPanel(e.toggle_panel)}}toggleLayersPanel(e){if(!this.layersPanel){if(!e)return;this.setupLayersPanel(),this.handleItemsUpdatedImmediately()}var t=()=>{if(!BFN.MainUI.viewportUpdating||!e||e&&this.temporarilyHidePanel)if(e){var i=this.layersPanel.panelSize,r=BFN.appViewportRect;this.temporarilyHidePanel?(this.temporarilyHidePanel=!1,this.layersPanel.show()):this.layersPanel.show(r.x+10,r.y+r.height-i.height-10)}else this.hasOwnProperty(this.togglePanelTimeoutID)&&(clearTimeout(this.togglePanelTimeoutID),delete this.togglePanelTimeoutID),this.layersPanel.hide();else this.togglePanelTimeoutID=setTimeout(()=>{t()},10)};t()}updateLayersAvailable(){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer),t=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&e&&e.itemsExist&&!BFN.TransformItemIsolator.active;BFN.AppModel.viewingEditor&&!t&&UITools.getToolValue("layers","toggle_panel")?this.temporarilyHidePanel=!0:t&&this.temporarilyHidePanel&&(UITools.setToolValue("layers","toggle_panel",!0),UITools.applyTool("layers"),UITools.updateToolControls("layers")),this.layersToggleInput||(this.layersToggleInput=document.getElementById("layers_toggle_panel")),this.flattenLayersButton||(this.flattenLayersButton=document.getElementById("editor_flatten_flatten_layers")),this.layersToggleInput.disabled=!t,this.flattenLayersButton.disabled=!t,this.flattenLayersButton.setStyles({display:BFN.AppModel.viewingEditor?"":"none"}),!t&&UITools.getToolValue("layers","toggle_panel")&&(UITools.setToolValue("layers","toggle_panel",!1),UITools.applyTool("layers"),UITools.updateToolControls("layers"))}updateGroups(){this.layersPanel&&this.layersPanel.setState({groups:BFN.GroupManager.getSectionGroupObjects(null,!0)})}switchToGroupsTab(){this.layersPanel&&this.layersPanel.switchTabs("groups")}handleItemsUpdatedImmediately(){if(this.layersPanel){var e=BFN.TransformLayerManager.transformItems;this.layersPanel.setState({layers:e.slice().reverse().map(e=>({id:e.itemID,name:e.itemName,item:e}))}),this.updateGroups(),this.handleSelectionUpdated()}}handleSelectionUpdated(){this.layersPanel&&(this.layersPanel.state.selectedLayerIDs.isIdenticalTo(BFN.TransformLayerManager.selectedItemIDs)||this.layersPanel.setState({selectedLayerIDs:BFN.TransformLayerManager.selectedItemIDs.slice()}))}handleGroupsUpdated(){this.updateGroups()}handleLanguageChanged(){BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children.forEach(e=>{e instanceof BFN.TransformItem&&e.refreshItemName()})}}BFN.SingletonQueue.add(()=>{window.UILayers=new ea});var ta="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",ia="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n   vec4 color = texture2D(uSampler, vTextureCoord);\n   gl_FragColor = color;\n}\n";var ra="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float hue;\nuniform float saturation;\nuniform float temperature;\nconst float pi = 3.14159265;\n\nvoid main(void)\n{\n\n   vec4 color = texture2D(uSampler, vTextureCoord);\n\n   //RETURN IF ALPHA 0\n    if (color.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    //UN-PREMULTIPLY\n    color.rgb /= color.a;\n\n    //HUE ADJUST\n    float ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    color.rgb = vec3(dot(color.rgb, weight.xyz), dot(color.rgb, weight.zxy), dot(color.rgb, weight.yzx));\n\n    //SATURATION ADJUST\n    float avg = (color.r + color.g + color.b) / 3.0;\n    if (saturation > 0.0) {\n        color.rgb += (avg - color.rgb) * (1.0 - 1.0 / (1.001 - saturation/2.0));\n    } else {\n        color.rgb += (avg - color.rgb) * (-saturation);\n    }\n\n    //TEMP ADJUST\n    color.r += temperature;\n    color.b -= temperature;\n\n    //PREMULTIPLY\n    color.rgb *= color.a;\n    gl_FragColor = color;\n\n}\n";var aa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler[2];\nuniform float shadows;\nuniform float highlights;\nuniform float contrast;\nuniform float brightness;\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_0(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat saturation(vec3 col){\n\tfloat colMin = min(min(col.r, col.g), col.b);\n\tfloat colMax = max(max(col.r, col.g), col.b);\n\n\treturn colMax - colMin;\n}\n\nfloat mid(float colMin, float colMid, float colMax, float sat) {\n     return ((colMid - colMin) * sat) / (colMax - colMin);\n}\n\nvec3 saturationBlend(vec3 col, float sat){\n\tfloat colMin = min(min(col.b, col.g), col.r);\n\tfloat colMax = max(max(col.b, col.g), col.r);\n\n\tvec3 outImage = vec3(0.0);\n\n\tif (colMin < colMax) {\n\n\t\tif (col.b == colMax && col.r == colMin) {\n\t\t\toutImage.r = 0.0;\n\t\t\toutImage.g = mid(colMin, col.g, colMax, sat);\n\t\t\toutImage.b = sat;\n\t\t}\n\t\telse if (col.g == colMax && col.r == colMin) {\n\t\t\toutImage.r = 0.0;\n\t\t\toutImage.b = mid(colMin, col.b, colMax, sat);\n\t\t\toutImage.g = sat;\n\t\t}\n\t\telse if (col.b == colMax && col.g == colMin) {\n\t\t\toutImage.g = 0.0;\n\t\t\toutImage.r = mid(colMin, col.r, colMax, sat);\n\t\t\toutImage.b = sat;\n\t\t}\n\t\telse if (col.r == colMax && col.g == colMin) {\n\t\t\toutImage.g = 0.0;\n\t\t\toutImage.b = mid(colMin, col.b, colMax, sat);\n\t\t\toutImage.r = sat;\n\t\t}\n\t\telse if (col.r == colMax && col.b == colMin) {\n\t\t\toutImage.b = 0.0;\n\t\t\toutImage.g = mid(colMin, col.g, colMax, sat);\n\t\t\toutImage.r = sat;\n\t\t}\n\t\telse {\n\t\t\toutImage.b = 0.0;\n\t\t\toutImage.r = mid(colMin, col.r, colMax, sat);\n\t\t\toutImage.g = sat;\n\t\t}\n\n\t}\n\n\treturn outImage;\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler[0], vTextureCoord);\n    vec4 bImage = texture2D(uSampler[1], vTextureCoord);\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    float adjustedHigh = (highlights > 0.0) ? highlights : highlights*5.0;\n    float adjustedShadow = (shadows<0.0) ? shadows * 5.0 : shadows*0.90;\n\n\tfloat mask = mix(adjustedHigh, adjustedShadow, 1.0 - getLumo_1(bImage.rgb));\n\n\tvec3 outImage = mix(inputImage.rgb, vec3(1.0), mask);\n    vec3 orgMask = mix(vec3(1.0), pow(inputImage.rgb,vec3(1.25)), mask);\n    outImage = max(1.0 - ((1.0 - outImage) / orgMask), 0.0);\n\n    float adjustedBrightness = clamp(brightness+1.0,0.1,2.0);\n\n    outImage = (adjustedBrightness<1.0) ? pow(outImage,vec3(1.0/sqrt(adjustedBrightness))) : pow(outImage,vec3(1.0/pow(adjustedBrightness,2.0)));\n\n    vec3 contrastAm = mix(vec3(0.5), outImage, contrast);\n    outImage = overlayBlend(contrastAm,outImage);\n\n\toutImage = setlum(saturationBlend(inputImage.rgb, saturation(outImage)), getLumo_1(outImage));\n\n\toutImage = outImage * inputImage.a;\n\n    gl_FragColor = vec4(outImage,inputImage.a);\n}\n";var na="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color;\n\nvoid main(void){\n\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n    float desat = dot(inputImage.rgb, vec3(0.3086, 0.6094, 0.082));\n    inputImage.rgb = overlayBlend(color,vec3(desat));\n    gl_FragColor = inputImage;\n\n}\n";var oa="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float shadows;\nuniform float highlights;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec3 invert = 1.0-inputImage.rgb;\n\tfloat adjustedShadows = shadows/200.0;\n\tfloat adjustedHighlights = 1.0+highlights/200.0;\n\tinputImage.rgb = (inputImage.rgb-invert*adjustedShadows)*adjustedHighlights*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n";var sa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler[2];\n\nuniform float intensity;\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler[0], vTextureCoord);\n    vec4 bImage = texture2D(uSampler[1], vTextureCoord);\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 origLumo = rgb2lab(inputImage.rgb);\n    vec3 blurLumo = rgb2lab(bImage.rgb);\n\n    float resultLumo = overlayBlendF(1.0-blurLumo.r,origLumo.r);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n\n    result = result * inputImage.a;\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = vec4(mix(inputImage,vec4(result,inputImage.a),intensity));\n\n}\n\n",la="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n";var ha="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform vec4 filterClamp;\nuniform vec4 filterArea;\nuniform float clipPadding;\n\nvoid main(void)\n{\n    vec4 clampVal = vec4(filterClamp.x,filterClamp.y,filterClamp.z,filterClamp.w);\n    clampVal.xy += clipPadding/filterArea.xy;\n    clampVal.zw -= clipPadding/filterArea.xy;\n\n    vec4 color = vec4(0.0);\n\n    vec2 off1 = vec2(1.0) * vec2(strength,0.0);\n    vec2 off2 = vec2(2.0) * vec2(strength,0.0);\n    vec2 off3 = vec2(3.0) * vec2(strength,0.0);\n\n    vec2 coord = vTextureCoord;\n\n    color += texture2D(uSampler, coord) * 0.22;\n    color += texture2D(uSampler, clamp(coord + off1,clampVal.xy,clampVal.zw))* 0.18;\n    color += texture2D(uSampler, clamp(coord - off1,clampVal.xy,clampVal.zw))* 0.18;\n    color += texture2D(uSampler, clamp(coord + off2,clampVal.xy,clampVal.zw))* 0.13;\n    color += texture2D(uSampler, clamp(coord - off2,clampVal.xy,clampVal.zw))* 0.13;\n    color += texture2D(uSampler, clamp(coord + off3,clampVal.xy,clampVal.zw))* 0.08;\n    color += texture2D(uSampler, clamp(coord - off3,clampVal.xy,clampVal.zw))* 0.08;\n    gl_FragColor = color;\n\n}\n\n",ca="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n";class ua extends PIXI.Filter{constructor(e,t){var i;super(ca,ha),BFN.Stage.filterManager.shaderCache[this.glShaderKey]||(i=new PIXI.Shader(BFN.Stage.gl,this.vertexSrc,this.fragmentSrc),this.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[this.glShaderKey]=i),this.resolution=t||1,this.strength=e||.5,this.padding=0,this.adjustedStrength=null,this.clipPadding=1}apply(e,t,i,r){var a=e.getRenderTarget(!0),n=t,o=a;this.uniforms.clipPadding=this.clipPadding;for(var s=0;s<2;s++){0==s?(this.adjustedStrength=10*this.strength/this.resolution*.75,this.uniforms.strength=this.adjustedStrength/t.size.width):(this.adjustedStrength=5*this.strength/this.resolution*.75,this.uniforms.strength=this.adjustedStrength/t.size.width),e.applyFilter(this,n,o,!0);var l=o;o=n,n=l}this.adjustedStrength=2.5*this.strength/this.resolution*.65,this.uniforms.strength=this.adjustedStrength/t.size.width,e.applyFilter(this,t,i,r),e.returnRenderTarget(a)}get blur(){return this.strength}set blur(e){this.strength=e}}var da="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform vec4 filterClamp;\nuniform vec4 filterArea;\nuniform float clipPadding;\n\nvoid main(void)\n{\n    vec4 clampVal = vec4(filterClamp.x,filterClamp.y,filterClamp.z,filterClamp.w);\n    clampVal.xy += clipPadding/filterArea.xy;\n    clampVal.zw -= clipPadding/filterArea.xy;\n\n    vec4 color = vec4(0.0);\n\n    vec2 off1 = vec2(1.0) * vec2(0.0,strength);\n    vec2 off2 = vec2(2.0) * vec2(0.0,strength);\n    vec2 off3 = vec2(3.0) * vec2(0.0,strength);\n\n    vec2 coord = vTextureCoord;\n\n    color += texture2D(uSampler, coord) * 0.22;\n    color += texture2D(uSampler, clamp(coord + off1,clampVal.xy,clampVal.zw))* 0.18;\n    color += texture2D(uSampler, clamp(coord - off1,clampVal.xy,clampVal.zw))* 0.18;\n    color += texture2D(uSampler, clamp(coord + off2,clampVal.xy,clampVal.zw))* 0.13;\n    color += texture2D(uSampler, clamp(coord - off2,clampVal.xy,clampVal.zw))* 0.13;\n    color += texture2D(uSampler, clamp(coord + off3,clampVal.xy,clampVal.zw))* 0.08;\n    color += texture2D(uSampler, clamp(coord - off3,clampVal.xy,clampVal.zw))* 0.08;\n    gl_FragColor = color;\n\n}\n\n";class ma extends PIXI.Filter{constructor(e,t){var i;super(ca,da),BFN.Stage.filterManager.shaderCache[this.glShaderKey]||(i=new PIXI.Shader(BFN.Stage.gl,this.vertexSrc,this.fragmentSrc),this.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[this.glShaderKey]=i),this.resolution=t||1,this.strength=e||.5,this.padding=0,this.adjustedStrength=null,this.clipPadding=1}apply(e,t,i,r){var a=e.getRenderTarget(!0),n=t,o=a;this.uniforms.clipPadding=this.clipPadding;for(var s=0;s<2;s++){0==s?(this.adjustedStrength=10*this.strength/this.resolution*.75,this.uniforms.strength=this.adjustedStrength/t.size.height):(this.adjustedStrength=5*this.strength/this.resolution*.75,this.uniforms.strength=this.adjustedStrength/t.size.height),e.applyFilter(this,n,o,!0);var l=o;o=n,n=l}this.adjustedStrength=2.5*this.strength/this.resolution*.65,this.uniforms.strength=this.adjustedStrength/t.size.height,e.applyFilter(this,n,i,r),e.returnRenderTarget(a)}get blur(){return this.strength}set blur(e){this.strength=e}}var pa="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",ga="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float amount;\n\nvoid main(void)\n{\n         lowp vec4 color = texture2D(uSampler, vTextureCoord);\n         lowp float average = (color.r + color.g + color.b) / 3.0;\n         //lowp float mx = max(color.r, max(color.g, color.b));\n         //lowp float amt = (mx - average) * (-amount * 3.0);\n         color.rgb = mix(color.rgb, vec3(average), amount);\n         gl_FragColor = color;\n\n     // gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n}\n";var fa="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",va="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float amount;\n\nvoid main(void){\n\n    lowp vec4 color = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    if (color.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    //UN-PREMULTIPLY\n    color.rgb /= color.a;\n\n    lowp vec3 invertColor = 1.0 - color.rgb;\n\n    color.rgb = mix(color.rgb, invertColor.rgb, amount);\n\n    //RE-PREMULTIPLY\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n\n}\n";var ya="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float minInputValue;\nuniform float gamma;\nuniform float maxInputValue;\nuniform float minOutputValue;\nuniform float maxOutputValue;\n\nvec3 gammaCorrection(vec3 color, float gamma) {\n\treturn pow(color, 1.0 / vec3(gamma));\n}\n\nvec3 levelsControlInputRange(vec3 color, float minInput, float maxInput) {\n\n  return min(max(color - minInput, 0.0) / (maxInput - minInput+0.0001), 1.0);\n\n}\n\nvec3 levelsControlInput(vec3 color, float minInput, float gamma, float maxInput) {\n\treturn gammaCorrection(levelsControlInputRange(color, minInput, maxInput), gamma);\n\n}\n\nvec3 levelsControlOutputRange(vec3 color, float minOutput, float maxOutput) {\n\treturn mix(vec3(minOutput), vec3(maxOutput), color);\n\n}\n\nvec3 levelsControl(vec3 color, float minInput, float gamma, float maxInput, float minOutput, float maxOutput) {\n\treturn levelsControlOutputRange(levelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput);\n}\n\nvoid main(void)\n{\n\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    if (color.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    color.rgb /= color.a;\n\n    color.rgb = levelsControl(color.rgb,minInputValue,gamma,maxInputValue,minOutputValue,maxOutputValue)*color.a;\n\n    gl_FragColor = color;\n\n}\n";var xa="/*https://github.com/mattdesl/glsl-lut/blob/master/index.glsl*/\nprecision highp float;\n#define GLSLIFY 1\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D iChannel1;\nuniform float intensity;\n\nvoid main(void)\n{\n    vec4 textureColor = texture2D(uSampler, vTextureCoord);\n\n    if (textureColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    textureColor.rgb /= textureColor.a;\n\n    textureColor = clamp(textureColor, 0.0, 1.0);\n\n    mediump float blueColor = textureColor.b * 63.0;\n\n    mediump vec2 quad1;\n    quad1.y = floor(floor(blueColor) / 8.0);\n    quad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n    mediump vec2 quad2;\n    quad2.y = floor(ceil(blueColor) / 8.0);\n    quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n    highp vec2 texPos1;\n    texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n    texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n   // texPos1.y = 1.0-texPos1.y;\n\n    highp vec2 texPos2;\n    texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n    texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n   // texPos2.y = 1.0-texPos2.y;\n\n    lowp vec4 newColor1 = texture2D(iChannel1, texPos1);\n    lowp vec4 newColor2 = texture2D(iChannel1, texPos2);\n\n    lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n\n   // gl_FragColor = newColor;\n\n   // gl_FragColor = texture2D(iChannel1, vTextureCoord);\n   // gl_FragColor.a = intensity;\n\n    if(textureColor.a > 0.0){\n        gl_FragColor = mix(textureColor, vec4(newColor.rgb, textureColor.w), intensity);\n        gl_FragColor.rgb *= gl_FragColor.a;\n\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n\n}\n\n",_a="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n";var Ia="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform float clampCoord;\nuniform float threshold;\nconst float radius = 20.0;\n\nfloat gaussKernel(float size, float variance)\n{\n\tvariance *= -2.0;\n\treturn exp(size * size / variance);\n}\n\n//horizontal pass\n\nvoid main(void)\n{\n\n       vec2 uv = vTextureCoord;\n       vec4 inputImage =  texture2D(uSampler,vTextureCoord);\n\n       if (inputImage.a == 0.0) {\n           gl_FragColor = vec4(0, 0, 0, 0);\n           return;\n       }\n\n       inputImage.rgb /= inputImage.a;\n\n       //convert to lab, we will convert back to rgb in vertical pass shader.\n    //   inputPixel.rgb = rgb2lab(inputPixel);\n       vec3 offset;\n       vec3 accum = vec3(0.0);\n       float denom = 0.0;\n\n       for (float x = -radius; x <= radius; x++)\n       {\n           offset = texture2D(uSampler, clamp(vTextureCoord + vec2(x*strength ,0.0),vec2(0.0,0.0),vec2(clampCoord,1.0))).rgb;\n        //   offset.rgb = rgb2lab(offset);\n\n           float dist = step(distance(offset, inputImage.rgb), threshold);\n           float similarity = dist * gaussKernel(x,radius);\n\n           denom += similarity;\n           accum += similarity * offset;\n       }\n\n        gl_FragColor = vec4(accum / denom*inputImage.a,inputImage.a);\n\n}\n",Ta="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n";class ba extends PIXI.Filter{constructor(e,t,i){super(Ta,Ia),this.threshold=t||.2,this.resolution=i||1,this.strength=e||1}apply(e,t,i,r){var a=null,n=t.size.width-i.destinationFrame.width;a=0==n?1:1-(n+2+1/this.resolution)/t.size.width,this.uniforms.strength=1/i.size.width*(i.size.width/t.size.width),this.uniforms.strength*=this.strength,this.uniforms.clampCoord=a,e.applyFilter(this,t,i,r)}get blur(){return this.strength}set blur(e){this.strength=e}get threshold(){return this.uniforms.threshold}set threshold(e){this.uniforms.threshold=e}}var Sa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform float clampCoord;\nuniform float threshold;\nconst float radius = 20.0;\n\nfloat gaussKernel(float size, float variance)\n{\n\tvariance *= -2.0;\n\treturn exp(size * size / variance);\n}\n\n//vertical pass\n\nvoid main(void)\n{\n\n       float n = 0.0;\n       vec2 uv = vTextureCoord;\n\n       vec4 inputImage =  texture2D(uSampler,vTextureCoord);\n\n       if (inputImage.a == 0.0) {\n           gl_FragColor = vec4(0, 0, 0, 0);\n           return;\n       }\n\n       inputImage.rgb /= inputImage.a;\n\n       vec3 offset;\n       vec3 accum = vec3(0.0);\n       float denom = 0.0;\n\n       for (float x = -radius; x <= radius; x++)\n       {\n           offset = texture2D(uSampler, clamp(vTextureCoord + vec2(0.0,x*strength),vec2(0.0,0.0),vec2(1.0,clampCoord))).rgb;\n\n           float dist = step(distance(offset, inputImage.rgb), threshold);\n           float similarity = dist * gaussKernel(x,radius);\n\n           denom += similarity;\n           accum += similarity * offset;\n       }\n\n       gl_FragColor = vec4(accum / denom*inputImage.a,inputImage.a);\n\n}\n";class Ca extends PIXI.Filter{constructor(e,t,i){super(Ta,Sa),this.threshold=t||.2,this.resolution=i||1,this.strength=e||1}apply(e,t,i,r){var a=null,n=t.size.height-i.destinationFrame.height;a=0==n?1:1-(n+2+1/this.resolution)/t.size.height,this.uniforms.strength=1/i.size.height*(i.size.height/t.size.height),this.uniforms.strength*=this.strength,this.uniforms.clampCoord=a,e.applyFilter(this,t,i,r)}get blur(){return this.strength}set blur(e){this.strength=e}get threshold(){return this.uniforms.threshold}set threshold(e){this.uniforms.threshold=e}}var Ba="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvoid main(void)\n{\n         vec4 cLab = texture2D(uSampler, vTextureCoord);\n         cLab.rgb = rgb2lab(cLab.rgb);\n\n         gl_FragColor = vec4(cLab.rgb,cLab.a);\n\n}\n",Fa="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n";var Ea="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float intensity;\nuniform float intensityMultiplier;\nuniform float clampX;\nuniform float clampY;\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 origLumo = rgb2lab(inputImage.rgb);\n    vec3 blurLumo = rgb2lab(bImage.rgb);\n\n    float resultLumo = mix(blurLumo.r, origLumo.r, 1.0 + intensity*intensityMultiplier);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n\n    result = result * inputImage.a;\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = vec4(result,inputImage.a);\n\n}\n\n",Pa="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n";var Na="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    if (bImage.a > 0.0) {\n        bImage.rgb /= bImage.a;\n    }\n\n    vec3 blurMinusOrig = clamp(inputImage.rgb-bImage.rgb,0.0,1.0);\n    vec3 OrigMinusBlur = clamp(bImage.rgb-inputImage.rgb,0.0,1.0);\n\n    vec3 details = clamp(inputImage.rgb-OrigMinusBlur+blurMinusOrig,0.0,1.0);\n\n    gl_FragColor = vec4( mix(inputImage.rgb,details,intensity*2.0)*inputImage.a,inputImage.a);\n\n}\n\n",Ma="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n";var Da="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float amount;\n\nvec3 gammaCorrection(vec3 color, float gamma) {\n\treturn pow(color, 1.0 / vec3(gamma));\n}\n\nvec3 levelsControlInputRange(vec3 color, float minInput, float maxInput) {\n\n  return min(max(color - minInput, 0.0) / (maxInput - minInput+0.0001), 1.0);\n\n}\n\nvec3 levelsControlInput(vec3 color, float minInput, float gamma, float maxInput) {\n\treturn gammaCorrection(levelsControlInputRange(color, minInput, maxInput), gamma);\n\n}\n\nvec3 levelsControlOutputRange(vec3 color, float minOutput, float maxOutput) {\n\treturn mix(vec3(minOutput), vec3(maxOutput), color);\n\n}\n\nvec3 levelsControl(vec3 color, float minInput, float gamma, float maxInput, float minOutput, float maxOutput) {\n\treturn levelsControlOutputRange(levelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput);\n}\n\nvec3 rgb2hsv(vec3 c)\n{\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n\n    vec3 hsl = rgb2hsv(inputImage.rgb);\n\n    float adjustVibrance = levelsControl(vec3(hsl.g),0.0,pow(amount+1.0,1.5),1.0,0.0,1.0).r;\n    float adjustSat = overlayBlendF(hsl.g, mix(0.5, adjustVibrance, 1.0 - hsl.g));\n\n    vec3 result = hsv2rgb(vec3(hsl.r,adjustSat,hsl.b));\n\n    result = result * inputImage.a;\n\n    gl_FragColor = vec4(vec3(result),inputImage.a);\n}\n",wa="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n";var ka="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nfloat vividBlendF(float front, float back)\n{\n\n   return mix(max(0.0, 1.0 - min(1.0, (1.0 - back) / (2.0 * front))),\n          min(1.0, back / (2.0 * (1.0 - front))),\n          step(0.5, front));\n}\n\nfloat gammaAdjustF(float inpImage,float amount)\n{\n    return pow(inpImage,amount);\n\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 origLumo = rgb2lab(inputImage.rgb);\n    vec3 blurLumo = rgb2lab(bImage.rgb);\n\n    float mask = 1.0 - gammaAdjustF(origLumo.r,1.85);\n\n    //highpass filtering\n    float details  = vividBlendF(1.0-blurLumo.r,origLumo.r);\n\n    float maskDetails = mix(0.5, details, mask);\n    float resultLumo = overlayBlendF(maskDetails,origLumo.r);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n\n    result = result * inputImage.a;\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = mix(inputImage, vec4(vec3(result),inputImage.a),intensity*1.2);\n\n}\n\n",La="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n";var Oa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float amount;\nuniform float softness;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n        vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n        //center position\n        vec2 position = vTextureCoord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //avoid divide zero\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n        //smoothstep for smooth results\n        float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        //apply with multiply, could be other blend modes though.\n        inputImage.rgb *= vignette;\n\n        gl_FragColor = vec4(inputImage.rgb,inputImage.a);\n\n}\n";var Ra="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float mode;\n\nuniform bool inverse;\n\nuniform float mapSize;\n\nuniform float centerX;\nuniform float centerY;\n\nuniform float outerRadius;\nuniform float innerRadius;\n\nuniform float strength;\n\nuniform vec2 dimensions;\n\nuniform float opacity;\n\nfloat Circle(vec2 distFromCenter, vec2 halfSize, float radius)\n{\n    float len = length(distFromCenter);\n    float result = smoothstep(radius-(outerRadius-innerRadius),radius,len);\n    return mix(1.0,result,opacity);\n\n}\n\nvoid main(void){\n\n    lowp vec4 color = texture2D(uSampler, vTextureCoord.xy);\n\n    color.rgb /= color.a; // UN-PREMULTIPLY\n\n    //--\n\n    float pixelX = (vTextureCoord.x * mapSize);\n    float pixelY = (vTextureCoord.y * mapSize);\n\n    float dx = (centerX - pixelX);\n    float dy = (centerY - pixelY);\n    float dd = sqrt((dx * dx) + (dy * dy));\n\n    vec4 result = vec4(0.0);\n\n    if(mode == 3.0){\n        //tekin: paint brush new feather\n        vec2 pixelCoord = vTextureCoord  * dimensions;\n        vec2 size = vec2(dimensions.x,dimensions.y);\n        vec2 halfSize = size / 2.0;\n        vec2 rectCenter = size/2.0;\n        vec2 pos = pixelCoord-rectCenter;\n        pos.x *= size.y/size.x;\n        float radiusStroke = (size.y/2.0);\n        float lengthCenter = Circle(pos,halfSize,radiusStroke);\n              //  result = vec4(vec3(lengthCenter),1.0);\n                 result = mix(vec4(color.rgb,1.0), vec4(0.0), lengthCenter);\n\n    } else if ((mode == 0.0 && dd < outerRadius) || mode > 0.0){\n\n        float pixelAlpha = 0.0;\n\n        if (mode == 0.0){ // RADIAL\n\n            pixelAlpha = min(1.0, max(0.0, (dd - innerRadius)) / (outerRadius - innerRadius));\n\n        } else if (mode == 1.0){ // SQUARE\n\n            float cornerRadius = (outerRadius - innerRadius);\n            vec2 cornerCenter = vec2(((pixelX < centerX) ? cornerRadius : (mapSize - cornerRadius)), ((pixelY < centerY) ? cornerRadius : (mapSize - cornerRadius)));\n\n            if ((pixelX < cornerRadius && pixelY < cornerRadius) // TOP LEFT CORNER\n            ||  (pixelX > (mapSize - cornerRadius) && pixelY < cornerRadius) // TOP RIGHT CORNER\n            ||  (pixelX < cornerRadius && (pixelY > mapSize - cornerRadius)) // BOTTOM LEFT CORNER\n            ||  (pixelX > (mapSize - cornerRadius) && (pixelY > mapSize - cornerRadius)) // BOTTOM RIGHT CORNER\n            ){\n\n                dx = (cornerCenter.x - pixelX);\n                dy = (cornerCenter.y - pixelY);\n                dd = sqrt((dx * dx) + (dy * dy));\n\n                pixelAlpha = min(1.0, max(0.0, dd) / cornerRadius);\n\n            }else{\n\n                float xAlpha =  min(1.0, max(0.0, (abs(dx) - innerRadius)) / (outerRadius - innerRadius));\n                float yAlpha =  min(1.0, max(0.0, (abs(dy) - innerRadius)) / (outerRadius - innerRadius));\n                pixelAlpha = max(xAlpha, yAlpha);\n\n            }\n\n        } else if (mode == 2.0){ // LINEAR\n\n            pixelAlpha = min(1.0, max(0.0, (abs(dy) - innerRadius)) / (outerRadius - innerRadius));\n\n        }\n\n        pixelAlpha *= pixelAlpha;\n\n        if (inverse){\n            pixelAlpha += ((1.0 - pixelAlpha) * (1.0 - strength));\n        }\n\n        color.a *= pixelAlpha;\n\n    }\n\n    if (!inverse){\n        color.a = (1.0 - color.a);\n        color.a *= strength;\n    }\n\n    //--\n\n    color.rgb *= color.a;// RE-PREMULTIPLY\n\n    //--\n\n    if(mode == 3.0){\n        gl_FragColor = result;\n    } else {\n        gl_FragColor = color;\n    }\n\n}\n",Aa="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n";var Va="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float segmentsX;\nuniform float segmentsY;\n\nuniform float textureW;\nuniform float textureH;\n\nuniform float mapW;\nuniform float mapH;\n\nvoid main(void){\n\n    float segmentW = (textureW / segmentsX);\n    float segmentH = (textureH / segmentsY);\n\n    float pixelX = (vTextureCoord.x * mapW);\n    float pixelY = (vTextureCoord.y * mapH);\n\n    lowp vec2 colorSource = vec2((((floor(pixelX / segmentW) * segmentW) + (segmentW / 2.0)) / mapW), (((floor(pixelY / segmentH) * segmentH) + (segmentH / 2.0)) / mapH));\n\n    gl_FragColor = texture2D(uSampler, colorSource.xy);\n\n}\n",Ua="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n";var Ga="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D topImage;\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 tImage = texture2D(topImage, vTextureCoord * vec2(clampX,clampY));\n\n    gl_FragColor = mix(inputImage,tImage,intensity);\n\n}\n";var Ha="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\nuniform float clampX;\nuniform float clampY;\nuniform float dotSize;\nuniform vec3 background_color;\nuniform vec3 dot_color;\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\t//return px - mod(px,vec2(dSize,dSize));\n\treturn floor( px / dSize ) * dSize;\n}\n\nvoid main(void)\n{\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec2 onePixel = vec2(1.0/filterArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/clampX-onePixel.x,1.0/clampY-onePixel.y);\n\n    //create dot grid\n\tvec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n\tfloat s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,filterArea);\n\tvec3 texc = texture2D(uSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n    vec3 result = duotone(vec3(s),background_color,dot_color);\n\tgl_FragColor = vec4(result,1.0);\n\n}\n\n";var za="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 mapMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMapCoord = (mapMatrix * vec3(aVertexPosition, 1.0)).xy;\n}\n",Xa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    float alpha = clamp((front.a * intensity), 0.0, 1.0);\n\n    back.rgb *= alpha;\n    back.a = alpha;\n\n    gl_FragColor = back;\n\n}\n",ja="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = back;\n        return;\n    }\n\n    back.a = clamp((back.a - (front.a * intensity)), 0.0, 1.0);\n\n    gl_FragColor = back;\n\n}\n",Wa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 exclusionBlend (vec3 front, vec3 back, float opacity){\n    return (front + back - 2.0 * front * back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(exclusionBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ya="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 differenceBlend (vec3 front, vec3 back, float opacity){\n    return abs(front - back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(differenceBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",qa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 pinlightBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x > 0.5) ? max(back.x, 2.0 * (front.x - 0.5)) : min(back.x, 2.0 * front.x),\n                (front.x > 0.5) ? max(back.y, 2.0 * (front.y - 0.5)) : min(back.y, 2.0 * front.y),\n                (front.z > 0.5) ? max(back.z, 2.0 * (front.z - 0.5)) : min(back.z, 2.0 * front.z)) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(pinlightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ka="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 linearLightBlend (vec3 front, vec3 back, float opacity){\n    return (2.0 * front + back - 1.0) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(linearLightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Qa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 vividlightBlend (vec3 front, vec3 back, float opacity){\n\n    return mix(max(vec3(0.0), 1.0 - min(vec3(1.0), (1.0 - back) / (2.0 * front))),\n                     min(vec3(1.0), back / (2.0 * (1.0 - front))),\n                     step(0.5, front))* opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(vividlightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Za="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 hardlightBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x <= 0.5) ? (2.0 * front.x * back.x) : (1.0 - 2.0 * (1.0 - front.x) * (1.0 - back.x)),\n                (front.y <= 0.5) ? (2.0 * front.y * back.y) : (1.0 - 2.0 * (1.0 - front.y) * (1.0 - back.y)),\n                (front.z <= 0.5) ? (2.0 * front.z * back.z) : (1.0 - 2.0 * (1.0 - front.z) * (1.0 - back.z))) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(hardlightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ja="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 softlightBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x <= 0.5) ? (back.x - (1.0 - 2.0 * front.x) * back.x * (1.0 - back.x)) : (((front.x > 0.5) && (back.x <= 0.25)) ? (back.x + (2.0 * front.x - 1.0) * (4.0 * back.x * (4.0 * back.x + 1.0) * (back.x - 1.0) + 7.0 * back.x)) : (back.x + (2.0 * front.x - 1.0) * (sqrt(back.x) - back.x))),\n                (front.y <= 0.5) ? (back.y - (1.0 - 2.0 * front.y) * back.y * (1.0 - back.y)) : (((front.y > 0.5) && (back.y <= 0.25)) ? (back.y + (2.0 * front.y - 1.0) * (4.0 * back.y * (4.0 * back.y + 1.0) * (back.y - 1.0) + 7.0 * back.y)) : (back.y + (2.0 * front.y - 1.0) * (sqrt(back.y) - back.y))),\n                (front.z <= 0.5) ? (back.z - (1.0 - 2.0 * front.z) * back.z * (1.0 - back.z)) : (((front.z > 0.5) && (back.z <= 0.25)) ? (back.z + (2.0 * front.z - 1.0) * (4.0 * back.z * (4.0 * back.z + 1.0) * (back.z - 1.0) + 7.0 * back.z)) : (back.z + (2.0 * front.z - 1.0) * (sqrt(back.z) - back.z)))) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(softlightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n\n",$a="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform int alphadir;\n\nuniform float clampX;\nuniform float clampY;\n\nvec3 overlayBlend (vec3 front, vec3 back, float opacity, int alphadirection){\n    return vec3((back.x <= 0.5) ? (2.0 * front.x * back.x) : (1.0 - 2.0 * (1.0 - back.x) * (1.0 - front.x)),\n                (back.y <= 0.5) ? (2.0 * front.y * back.y) : (1.0 - 2.0 * (1.0 - back.y) * (1.0 - front.y)),\n                (back.z <= 0.5) ? (2.0 * front.z * back.z) : (1.0 - 2.0 * (1.0 - back.z) * (1.0 - front.z))) * opacity + ((alphadirection == 0) ? back : front) * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    if(back.a == 0.0  && alphadir == 0){\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    vec3 Cb = front.rgb/front.a;\n    vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(overlayBlend(Cb.xyz, Cs.xyz, intensity, alphadir), 0.0, 1.0);\n\n    vec4 res;\n    res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n    res.a = front.a + back.a * (1.0-front.a);\n    gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",en="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 linearDodgeBlend (vec3 front, vec3 back, float opacity){\n    return (front + back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(linearDodgeBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",tn="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 colorDodgeBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x == 1.0) ? 1.0 : min(1.0, back.x / (1.0 - front.x)),\n                (front.y == 1.0) ? 1.0 : min(1.0, back.y / (1.0 - front.y)),\n                (front.z == 1.0) ? 1.0 : min(1.0, back.z / (1.0 - front.z))) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(colorDodgeBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",rn="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 screenBlend (vec3 front, vec3 back, float opacity){\n    return ((front + back) - (front * back)) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(screenBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n\n",an="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 lightenBlend (vec3 front, vec3 back, float opacity){\n    return max(front, back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(lightenBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",nn="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 linearBurnBlend (vec3 front, vec3 back, float opacity){\n    return ((front + back) - 1.0) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(linearBurnBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",on="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 colorBurnBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x == 0.0) ? 0.0 : (1.0 - ((1.0 - back.x) / front.x)),\n                (front.y == 0.0) ? 0.0 : (1.0 - ((1.0 - back.y) / front.y)),\n                (front.z == 0.0) ? 0.0 : (1.0 - ((1.0 - back.z) / front.z))) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(colorBurnBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",sn="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 darkenBlend (vec3 front, vec3 back, float opacity){\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(darkenBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",ln="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 multiplyBlend (vec3 front, vec3 back, float opacity){\n    return (front * back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(multiplyBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",hn="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 subtractBlend (vec3 front, vec3 back, float opacity){\n    return (back - front) * opacity + back * (1.0 - opacity);\n    //return (max(src+dst-vec3(1.0),vec3(0.0))) * opacity + src * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(subtractBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",cn="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 addBlend (vec3 front, vec3 back, float opacity){\n    return (front + back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    vec3 Cb = front.rgb/front.a;\n    vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(addBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",un="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 normalBlend (vec3 front, vec3 back, float opacity){\n    return front * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(normalBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n";var dn="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat gammaAdjustF(float inpImage,float amount)\n{\n    return pow(inpImage,amount);\n\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat bwChannelMixer(vec3 c, vec3 values) {\n\n     return dot(c, vec3(values.r, values.g, values.b));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n   float mask = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.8,0.22).r;\n   float bwImage = bwChannelMixer(inputImage.rgb,vec3(0.25, 0.75, 0.0));\n\n   float brightImage = gammaAdjustF(bwImage,0.60);\n   float contrastAm = mix(0.5, brightImage, 0.5);//\n   brightImage = overlayBlendF(contrastAm,brightImage);\n\n   float darkImage = gammaAdjustF(bwImage,1.5);\n   float result = mix(darkImage,brightImage,mask);//\n   gl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);//\n}\n",mn="#define GLSLIFY 1\nfloat bw_red_1540259130(vec3 c) {\n\n     return float(c.r);\n}\n\nfloat bw_green_1604150559(vec3 c) {\n\n     return float(c.g);\n}\n\nfloat bw_blue_1117569599(vec3 c) {\n\n     return float(c.b);\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec3 color;\nuniform float mode;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tgl_FragColor = vec4(overlayBlend(color, vec3((mode == 0.0)? bw_red_1540259130(inputImage.rgb)*inputImage.a : ((mode == 1.0) ? getLumo(inputImage.rgb)*inputImage.a : bw_blue_1117569599(inputImage.rgb)*inputImage.a))),inputImage.a);\n}\n",pn="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat sigmoidF(float inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat screenBlendF(float front, float back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tfloat result = getLumo(inputImage.rgb);\n\tfloat sigmoidImage = sigmoidF(result,0.77,0.59);\n\tresult = screenBlendF(sigmoidImage,result);\n\tgl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n",gn="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tfloat result = getLumo(inputImage.rgb);\n\tgl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n",fn="#define GLSLIFY 1\nfloat bw_blue_1540259130(vec3 c) {\n\n     return float(c.b);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tgl_FragColor = vec4(vec3(bw_blue_1540259130(inputImage.rgb))*inputImage.a,inputImage.a);\n}\n",vn="#define GLSLIFY 1\nfloat bw_green_1540259130(vec3 c) {\n\n     return float(c.g);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tgl_FragColor = vec4(vec3(bw_green_1540259130(inputImage.rgb))*inputImage.a,inputImage.a);\n}\n",yn="#define GLSLIFY 1\nfloat bw_red_1540259130(vec3 c) {\n\n     return float(c.r);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tgl_FragColor = vec4(vec3(bw_red_1540259130(inputImage.rgb))*inputImage.a,inputImage.a);\n}\n";var xn="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\n void main() {\n\n    lowp vec4 color = texture2D(uSampler, vTextureCoord);\n\n    if (color.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n    }\n\n    color.rgb /= color.a;\n\n    color.r = texture2D(iChannel1, vec2(color.r, 0.0)).r;\n    color.g = texture2D(iChannel1, vec2(color.g, 0.0)).g;\n    color.b = texture2D(iChannel1, vec2(color.b, 0.0)).b;\n\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n\n }\n";var _n="#define GLSLIFY 1\nfloat bwChannelMixer(vec3 c, vec3 values) {\n\n     return dot(c, vec3(values.r, values.g, values.b));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float redAmount;\nuniform float greenAmount;\nuniform float blueAmount;\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   gl_FragColor = vec4(vec3(bwChannelMixer(inputImage.rgb,vec3(redAmount, greenAmount, blueAmount))),inputImage.a);\n}\n";var In="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat sigmoidF(float inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform sampler2D blurImage;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec4 blurredImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    float lumoImage = sigmoidF(getLumo(blurredImage.rgb),0.55,0.74);\n    vec3 screenImage = clamp(screenBlend(vec3(lumoImage),inputImage.rgb),0.0,1.0);\n\n    vec3 result = clamp(textureImage.rgb*screenImage,0.0,1.0);\n\n    result = result.bgr*inputImage.a;\n\n\tgl_FragColor = vec4(result,inputImage.a);\n}\n",Tn="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 greenChannel = duotone(vec3(inputImage.g),vec3(0.33,0.66,1.0),vec3(0.04,0.0,0.24));\n\tinputImage.rgb = hardLightBlend(greenChannel,textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",bn="#define GLSLIFY 1\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tfloat greenChannel = inputImage.g;\n\tinputImage.rgb = colorBurnBlend(vec3(greenChannel),textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Sn="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tfloat blueChannel = inputImage.b;\n\tinputImage.rgb = hardLightBlend(vec3(blueChannel),textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Cn="#define GLSLIFY 1\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tfloat blueChannel = inputImage.b;\n\tinputImage.rgb = colorBurnBlend(vec3(blueChannel),textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Bn="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n\tinputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tfloat blueChannel = inputImage.b;\n\tinputImage.rgb = hardLightBlend(vec3(blueChannel),textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n";var Fn="#define GLSLIFY 1\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float realWidth;\nuniform float realHeight;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n   vec4 maskImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY)); //retro6mask\n\n   float mask = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.8,0.22).r;\n\n   vec3 result = mix(maskImage.rgb,inputImage.rgb,vec3(mask));\n   gl_FragColor = vec4(result,inputImage.a);//\n}\n";var En="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform vec3 color1;\nuniform vec3 color2;\nuniform float detail_level;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    if (inputImage.a == 0.0) {\n      gl_FragColor = vec4(0, 0, 0, 0);\n      return;\n    }\n\n    //UN-PREMULTIPLY\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo(blurImage.rgb),0.0,1.0);\n\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level,1.0);\n\n    vec3 result = clamp(duotone(bringDetails,color1,color2)*textureImage.rgb,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n";var Pn="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 color1) {\n\n    return setlum(color1, getLumo_0(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec3 color;\nuniform float amount;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   //RETURN IF ALPHA 0\n   if (inputImage.a == 0.0) {\n       gl_FragColor = vec4(0, 0, 0, 0);\n       return;\n   }\n\n   //UN-PREMULTIPLY\n   inputImage.rgb /= inputImage.a;\n\n   vec3 tintimage = tint(inputImage.rgb, color);\n\n   inputImage.rgb = mix(inputImage.rgb, tintimage, amount);\n\n   //RE-PREMULTIPLY\n   inputImage.rgb *= inputImage.a;\n\n   gl_FragColor = inputImage;\n\n}\n";var Nn="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nvec3 unsharpMask(vec3 orgInput, vec3 blurInput, float intensity) {\n    vec3 origLumo = rgb2lab(orgInput);\n    vec3 blurLumo = rgb2lab(blurInput);\n\n    float resultLumo = mix(blurLumo.r, origLumo.r, 1.0 + intensity*1.5);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n    return result;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurImage;\nuniform vec3 color1;\nuniform vec3 color2;\nuniform float clampX;\nuniform float clampY;\nuniform float bwmode;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    float bwResult = getLumo(inputImage.rgb);\n\n    if(bwmode==0.0) {\n        bwResult = inputImage.r;\n    }\n    if(bwmode==2.0) {\n        bwResult = inputImage.b;\n    }\n\n    inputImage.rgb = duotone(vec3(bwResult),color1,color2);\n\n    inputImage.rgb = unsharpMask(inputImage.rgb,bImage.rgb,0.1)*inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n";var Mn="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 original = BContrast(inputImage.rgb,1.0,0.6);\n\tvec3 lightenImage = lightenBlend(textureImage.rgb,original);\n\tlightenImage = mix(original,lightenImage,0.55);\n\tvec3 overlayImage = overlayBlend_0(vec3(getLumo(inputImage.rgb)),lightenImage);\n\toverlayImage = mix(lightenImage,overlayImage,0.45);\n    inputImage.rgb = vignette_0(overlayImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Dn="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 original = BContrast(inputImage.rgb,1.0,0.6);\n\tvec3 lightenImage = lightenBlend(textureImage.rgb,original);\n\tlightenImage = mix(original,lightenImage,0.55);\n\tvec3 overlayImage = overlayBlend_0(vec3(getLumo(inputImage.rgb)),lightenImage);\n\toverlayImage = mix(lightenImage,overlayImage,0.45);\n    inputImage.rgb = vignette_0(overlayImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",wn="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n\tvec3 fadedImage = mix(inputImage.rgb,vec3(getLumo(inputImage.rgb)),0.6);\n    fadedImage = BContrast(fadedImage,1.0,0.6);\n\n    fadedImage = mix(fadedImage,textureImage.rgb,0.56);\n    vec3 screenImage = screenBlend(fadedImage,inputImage.rgb);\n    screenImage = mix(inputImage.rgb,screenImage,0.7);\n    inputImage.rgb = vignette_0(screenImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",kn="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 original = BContrast(inputImage.rgb,1.0,0.6);\n\tvec3 lightenImage = lightenBlend(textureImage.rgb,original);\n\tlightenImage = mix(original,lightenImage,0.55);\n\tvec3 overlayImage = overlayBlend_0(vec3(getLumo(inputImage.rgb)),lightenImage);\n\toverlayImage = mix(lightenImage,overlayImage,0.45);\n    inputImage.rgb = vignette_0(overlayImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Ln="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 original = BContrast(inputImage.rgb,1.0,0.6);\n\tvec3 lightenImage = lightenBlend(textureImage.rgb,original);\n\tlightenImage = mix(original,lightenImage,0.55);\n\tvec3 overlayImage = overlayBlend_0(vec3(getLumo(inputImage.rgb)),lightenImage);\n\toverlayImage = mix(lightenImage,overlayImage,0.45);\n    inputImage.rgb = vignette_0(overlayImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",On="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvec3 exclusionBlend(vec3 front, vec3 back)\n{\n    return (0.5 - 2.0*(back-0.5)*(front-0.5));\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec3 zero2 = vec3(0.87,0.60,0.51);\n\tvec3 softLightImage = softLightBlend(inputImage.rgb,inputImage.rgb);\n\tvec3 exBlend = exclusionBlend(softLightImage,vec3(0.027,0.0,0.258));\n\tvec3 softLightImage2 = softLightBlend(zero2,exBlend);\n\tvec3 exBlend2 = exclusionBlend(softLightImage2,vec3(0.027,0.0,0.26));\n    inputImage.rgb = softLightBlend(inputImage.rgb,exBlend2)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Rn="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvec3 exclusionBlend(vec3 front, vec3 back)\n{\n    return (0.5 - 2.0*(back-0.5)*(front-0.5));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tinputImage.rgb = BContrast(inputImage.rgb,1.0,1.0);\n\tinputImage.rgb = exclusionBlend(inputImage.rgb,vec3(0.243,0.0,0.062))*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",An="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvec3 exclusionBlend(vec3 front, vec3 back)\n{\n    return (0.5 - 2.0*(back-0.5)*(front-0.5));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tinputImage.rgb = BContrast(inputImage.rgb,1.0,1.0);\n\tinputImage.rgb = exclusionBlend(inputImage.rgb,vec3(0.0,0.2,0.4))*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Vn="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvec3 exclusionBlend(vec3 front, vec3 back)\n{\n    return (0.5 - 2.0*(back-0.5)*(front-0.5));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tinputImage.rgb = BContrast(inputImage.rgb,1.0,1.0);\n\tinputImage.rgb = exclusionBlend(inputImage.rgb,vec3(0.027,0.0,0.258))*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n";var Un="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 color1) {\n\n    return setlum(color1, getLumo_0(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    inputImage.rgb = tint(inputImage.rgb,color)*inputImage.a;\n    gl_FragColor = inputImage;\n}\n";var Gn="#define GLSLIFY 1\nfloat bw_red_1540259130(vec3 c) {\n\n     return float(c.r);\n}\n\nfloat bw_green_1604150559(vec3 c) {\n\n     return float(c.g);\n}\n\nfloat bw_blue_1117569599(vec3 c) {\n\n     return float(c.b);\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform vec3 color;\nuniform float mode;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwimg = vec3((mode == 0.0)? bw_red_1540259130(inputImage.rgb) : ((mode == 1.0) ? getLumo(inputImage.rgb) : bw_blue_1117569599(inputImage.rgb)));\n    vec3 overlay1 = overlayBlend(textureImage.rgb, bwimg);\n\n\tgl_FragColor = vec4(overlayBlend(color, overlay1)*inputImage.a, inputImage.a);\n}\n";var Hn="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float contrast;\nuniform float brightness;\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\tinputImage.rgb = BContrast(inputImage.rgb, brightness, contrast);\n\tgl_FragColor = inputImage;\n}\n";var zn="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = inputImage;\n\n}\n",Xn="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurImage;\nuniform vec3 color1_1;\nuniform vec3 color1_2;\nuniform vec3 color2_1;\nuniform vec3 color2_2;\nuniform vec3 color3_1;\nuniform vec3 color3_2;\nuniform vec3 color4_1;\nuniform vec3 color4_2;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    // 2nd texture (blur image) four tile\n    vec4 blurImage1 = offsetPixel(blurImage, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage2 = offsetPixel(blurImage, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage3 = offsetPixel(blurImage, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage4 = offsetPixel(blurImage, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    // original four tile\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    //padding does not work for seconnd image, therefore we use original image alpha to clip\n  /*  blurImage1.rgb *= inputImage1.a;\n    blurImage1.a = inputImage1.a;\n    blurImage2.rgb *= inputImage2.a;\n    blurImage2.a = inputImage2.a;\n    blurImage3.rgb *= inputImage3.a;\n    blurImage3.a = inputImage3.a;\n    blurImage4.rgb *= inputImage4.a;\n    blurImage4.a = inputImage4.a;\n*/\n    //final mix test\n    inputImage1.rgb = mix(inputImage1.rgb,duotone(blurImage1.rgb,color1_1,color1_2),0.6)*inputImage1.a;\n    inputImage2.rgb = mix(inputImage2.rgb,duotone(blurImage2.rgb,color2_1,color2_2),0.6)*inputImage2.a;\n    inputImage3.rgb = mix(inputImage3.rgb,duotone(blurImage3.rgb,color3_1,color3_2),0.6)*inputImage3.a;\n    inputImage4.rgb = mix(inputImage4.rgb,duotone(blurImage4.rgb,color4_1,color4_2),0.6)*inputImage4.a;\n\n    //final compose\n   // gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n\n    gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n   //gl_FragColor = vec4(inputImage1.rgb+inputImage2.rgb+inputImage3.rgb+inputImage4.rgb,1.0);\n   //gl_FragColor = vec4(blurImage1.rgb+blurImage2.rgb+blurImage3.rgb+blurImage4.rgb,1.0);\n}\n",jn="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurImage;\nuniform vec3 color1;\nuniform vec3 color2;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    if (bImage.a > 0.0) {\n        bImage.rgb /= bImage.a;\n    }\n\n    float bwResult = bImage.b;\n    vec3 duotoneImage = duotone(vec3(bwResult),color1,color2);\n    inputImage.rgb = mix(inputImage.rgb,duotoneImage,0.6)*inputImage.a;\n    gl_FragColor = inputImage;\n\n}\n",Wn="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = inputImage;\n\n}\n",Yn="#define GLSLIFY 1\nvec3 gammaAdjust_0(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust_0(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 gammaAdjust_1(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust_1(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend_0(contrastAm,brightImage);\n }\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 contrastImage = BContrastLeg(inputImage.rgb,1.5,0.66);\n    contrastImage = BContrast(contrastImage,1.0,0.5);\n    float lumoImage = getLumo(contrastImage);\n    vec3 sepiaImage = overlayBlend_1(vec3(0.81,0.78,0.69),vec3(lumoImage));\n    sepiaImage = mix(vec3(lumoImage), sepiaImage, 0.85);\n    gl_FragColor = vec4(sepiaImage*inputImage.a,inputImage.a);\n\n}\n",qn="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 contrastImage = BContrast(inputImage.rgb,1.0,1.0);\n    vec3 purpleLight = vec3(0.42, 0.27, 0.53);\n    vec3 purpleDark = vec3(0.32, 0.05, 0.51);\n\n    vec3 screenImage = screenBlend(inputImage.rgb,contrastImage);\n    screenImage = mix(screenImage,lightenBlend(purpleLight,screenImage),0.73);\n    screenImage = mix(screenImage,overlayBlend_0(purpleDark,screenImage),0.60);\n    inputImage.rgb = screenImage*inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n";var Kn="#define GLSLIFY 1\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 colorDodgeBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = colorDodgeBlendF(front.r,back.r);\n    result.g = colorDodgeBlendF(front.g,back.g);\n    result.b = colorDodgeBlendF(front.b,back.b);\n    return result;\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float slide_right;\nuniform float slide_left;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 offsetVer = offsetPixel(uSampler, vTextureCoord, vec2(slide_left, 0.05), scaleFactor, clampValues, 1,0, fillColor);\n    vec4 offsetVer1 = offsetPixel(uSampler, vTextureCoord, vec2(slide_right, 0.07), scaleFactor, clampValues, 1,0, fillColor);\n\n    offsetVer1.rgb = colorDodgeBlend(offsetVer.rgb,offsetVer1.rgb);\n    offsetVer1.rgb = colorBurnBlend(offsetVer1.rgb,textureImage.rgb);\n\n    gl_FragColor = offsetVer1;\n}\n",Qn="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float slide_right;\nuniform float slide_left;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 offsetBoth = offsetPixel(uSampler, vTextureCoord, vec2(slide_right, 0.07), scaleFactor, clampValues, 0,0, fillColor);\n\n     vec4 offsetVer = offsetPixel(uSampler, vTextureCoord, vec2(slide_left, 0.05), scaleFactor, clampValues, 1,0, fillColor);\n\n    offsetVer.rgb = hardLightBlend(offsetVer.rgb,offsetBoth.rgb);\n    offsetVer.rgb = clamp(textureImage.rgb*offsetVer.rgb,0.0,1.0);\n    offsetVer.rgb = vignette_0(offsetVer.rgb,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    gl_FragColor = offsetVer;\n }\n",Zn="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float slide_vertical;\nuniform float slide_horizontal;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 offsetBoth = offsetPixel(uSampler, vTextureCoord, vec2(0.10, slide_vertical), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 offsetHor = offsetPixel(uSampler, vTextureCoord, vec2(slide_horizontal, 0.0), scaleFactor, clampValues, 1,0, fillColor);\n\n    vec4 blendBd;\n    blendBd.rgb = hardLightBlend(offsetHor.rgb,offsetBoth.rgb);\n    blendBd.a = 1.0;\n    blendBd = vec4(vec3(offsetHor.r,offsetBoth.g,blendBd.b),1.0);\n\n    gl_FragColor = blendBd;\n}\n",Jn="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float slide_vertical;\nuniform float slide_horizontal;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 slide1 = offsetPixel(uSampler, vTextureCoord, vec2(slide_horizontal, slide_vertical), scaleFactor, clampValues, 1,0, fillColor);\n    vec4 slide2 = offsetPixel(uSampler, vTextureCoord, vec2(0.10, 0.10), scaleFactor, clampValues, 1,0, fillColor);\n\n    slide2.rgb = hardLightBlend(slide1.rgb,slide2.rgb);\n    gl_FragColor = slide2;\n}\n\n",$n="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float slide_right;\nuniform float slide_left;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 fillColor = vec4(0.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 mode6 = offsetPixel(uSampler, vTextureCoord, vec2(slide_left, 0.0), scaleFactor, clampValues, 1,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 mode5 = offsetPixel(uSampler, vTextureCoord, vec2(slide_right, 0.0), scaleFactor, clampValues, 1,0, fillColor);\n\n    mode6.rgb = mode6.rbb;\n    mode5.rgb = mode5.brr;\n\n    mode5.rgb = hardLightBlend(mode6.rgb,mode5.rgb);\n\n  gl_FragColor = mode5;\n}\n";var eo="#define GLSLIFY 1\nvec3 duotone_2(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_2(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float sketch_detail;\nuniform float line_width;\nuniform vec3 color;\nuniform vec4 filterArea;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,45.0,vec3(0.5),vec3(1.0));\n    vec3 blendbd = clamp(inputImage.rgb*lines,0.0,1.0);\n    blendbd = BContrastLeg(blendbd,1.0,1.8);\n    vec3 sThreshold = vec3(smoothThresholdLeg(blendbd,sketch_detail/255.0,0.1));\n    sThreshold = duotone_0(sThreshold,vec3(1.0),color);\n    sThreshold = clamp(textureImage.rgb*sThreshold,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(sThreshold)*inputImage.a,inputImage.a);\n}\n",to="#define GLSLIFY 1\nvec3 duotone_2(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_2(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float sketch_detail;\nuniform float line_width;\nuniform vec3 color;\nuniform vec4 filterArea;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,45.0,vec3(0.5),vec3(1.0));\n    vec3 blendbd = clamp(inputImage.rgb*lines,0.0,1.0);\n    blendbd = BContrastLeg(blendbd,1.0,1.8);\n    vec3 sThreshold = vec3(smoothThresholdLeg(blendbd,sketch_detail/255.0,0.1));\n    sThreshold = duotone_0(sThreshold,vec3(1.0),color);\n    sThreshold = clamp(textureImage.rgb*sThreshold,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(sThreshold)*inputImage.a,inputImage.a);\n}\n",io="#define GLSLIFY 1\nvec3 duotone_2(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_2(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float sketch_detail;\nuniform float line_width;\nuniform float line_angle;\nuniform vec3 color;\nuniform vec4 filterArea;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,line_angle,vec3(0.5),vec3(1.0));\n    vec3 blendbd = clamp(inputImage.rgb*lines,0.0,1.0);\n    blendbd = BContrastLeg(blendbd,1.0,1.8);\n    vec3 sThreshold = vec3(smoothThresholdLeg(blendbd,sketch_detail/255.0,0.1));\n    sThreshold = duotone_0(sThreshold,vec3(1.0),color);\n\n    gl_FragColor = vec4(vec3(sThreshold)*inputImage.a,inputImage.a);\n}\n",ro="#define GLSLIFY 1\nvec3 duotone_2(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_2(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float sketch_detail;\nuniform float line_width;\nuniform float line_angle;\nuniform vec3 color;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,line_angle,vec3(0.5),vec3(1.0));\n    vec3 blendbd = clamp(inputImage.rgb*lines,0.0,1.0);\n    blendbd = BContrastLeg(blendbd,1.0,1.8);\n    vec3 sThreshold = vec3(smoothThresholdLeg(blendbd,sketch_detail/255.0,0.1));\n    sThreshold = duotone_0(sThreshold,vec3(1.0),color);\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.0),vec3(1.0));\n    noiseImg =  mix(vec3(getLumo(inputImage.rgb)),noiseImg,0.6);\n    vec3 duoNoise = duotone_0(noiseImg,vec3(1.0,0.8,0.29),vec3(1.0,1.0,0.74));\n    duoNoise = clamp(duoNoise*sThreshold,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(duoNoise)*inputImage.a,inputImage.a);\n}\n";var ao="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 adaptiveSharpnessImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    gl_FragColor = inputImage;\n}\n";var no="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float strength;\nuniform float angleDegree;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nconst float radius = 9.0; //must be odd\n\nvoid main(void)\n{\n\n    float radianValue = radians(angleDegree); //clockwise\n    vec2 adjRadius = vec2(radius / filterArea.xy);\n    vec2 velocity = vec2(adjRadius.x*cos(radianValue),adjRadius.y*sin(radianValue));\n    int numSamples = int(floor((radius-1.0)/2.0));\n    vec4 sum = vec4(0.0), avg = vec4(0.0);\n    vec2 dc = vTextureCoord, offset = -velocity;\n\n    for (int i=0; i < int(radius); i++) {\n        sum += texture2D(uSampler, clamp(dc + offset*strength,vec2(0.0,0.0),vec2(clampX,clampY)));\n        offset += velocity / float(numSamples);\n    }\n\n    avg = sum / radius;\n    gl_FragColor = avg;\n}\n";var oo="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float brightness;\nuniform float sharpness;\nuniform float mode; //mode=1.0 returns colored version else lumo\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n   vec3 lumo = (mode==1.0)?inputImage.rgb:vec3(dot(inputImage.rgb, vec3(0.299, 0.587, 0.114)));\n\n   vec3(dot(inputImage.rgb, vec3(0.299, 0.587, 0.114)));\n   float calcSharpness = (2.0+(sharpness*20.0));\n   inputImage.rgb = vec3(brightness / (1.0+exp(calcSharpness*(0.5-lumo))));\n   gl_FragColor = inputImage;\n\n}\n\n";var so="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform int mode;\n\nvoid main(void)\n{\n\n   vec4 c = texture2D(uSampler, vTextureCoord);\n   c.rgb = (mode == 1) ? c.bgr : (mode == 2)? c.gbr : (mode == 3) ? c.gbb : (mode == 4) ? c.gbb : (mode == 5) ? c.brr : (mode == 6) ? c.rbb : (mode == 7) ? c.bgb : (mode == 8) ? c.bgg :  c.bgr;\n   gl_FragColor = c;\n\n}\n";var lo="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec4 fisheye(sampler2D sourceImage, vec2 vTextureCoord, vec4 filterArea, vec2 centerPoint, vec2 resolutionPoint, float radius){\n\n    float PI = 3.14159265258979;\n\n    vec2 coord = mapCoord(vTextureCoord,filterArea);\n\n    vec2 center = vec2(resolutionPoint.x*centerPoint.x,resolutionPoint.y*centerPoint.y);\n    float aspectRatio = resolutionPoint.x;\n    vec2 target ;\n\n    vec2 vector  = coord - center;\n    float distance = length(vector) ;\n\n    if ( distance < aspectRatio ){\n        vec2 maximum = center + ( vector / radius ) ;\n        float ratio     = distance / aspectRatio;\n        float trigRatio = ( cos( ratio * PI) + 1.0 ) / 2.0 ;\n        target = maximum * ( trigRatio ) + coord * ( 1.0 - trigRatio ) ;\n    }\n    else {\n        target = coord;\n    }\n\n    coord = unmapCoord(target,filterArea);\n    return texture2D(sourceImage, coord);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float radius;\nuniform float resolutionX;\nuniform float resolutionY;\nuniform vec4 filterArea;\nuniform vec2 centerPoint;\n\nvoid main(void)\n{\n    gl_FragColor = fisheye(uSampler, vTextureCoord, filterArea, centerPoint, vec2(resolutionX, resolutionY), radius);\n\n}\n";var ho="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone(vec3(result),color1,color2);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec3 duocolor1;\nuniform vec3 duocolor2;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(genNoise(vTextureCoord, duocolor1, duocolor2), 1.0);\n}\n";var co="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   if (inputImage.a == 0.0) {\n    gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n   }\n\n   inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n     bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",uo="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n     gl_FragColor = vec4(0, 0, 0, 0);\n     return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = 1.0-fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.28));\n    bringDetails = hardLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",mo="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n     if (inputImage.a == 0.0) {\n      gl_FragColor = vec4(0, 0, 0, 0);\n      return;\n     }\n\n     inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = 1.0-fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",po="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n      if (inputImage.a == 0.0) {\n       gl_FragColor = vec4(0, 0, 0, 0);\n       return;\n      }\n\n      inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",go="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   if (inputImage.a == 0.0) {\n    gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n   }\n\n   inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",fo="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvec3 quantize(vec3 inpImg, float palette, float lightness) {\n\tinpImg = inpImg*lightness;\n\treturn floor(inpImg*floor(float(palette)))/floor(float(palette));\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D blurSampler;\nuniform float color_detail;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n     gl_FragColor = vec4(0, 0, 0, 0);\n     return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n   vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n   vec3 quantImage = quantize(blurImage.rgb,color_detail,1.0);\n   quantImage = hardLightBlend(inputImage.rgb,vec3(getLumo(quantImage)));\n   quantImage = fuzzyBorderMask(quantImage,vTextureCoord,vec2(clampX,clampY),0.35);\n   quantImage = hardLightBlend(quantImage,textureImage.rgb);\n\n   gl_FragColor = vec4(quantImage*inputImage.a,inputImage.a);\n}\n",vo="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n      if (inputImage.a == 0.0) {\n          gl_FragColor = vec4(0, 0, 0, 0);\n          return;\n      }\n\n      inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",yo="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform vec3 color;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   if (inputImage.a == 0.0) {\n       gl_FragColor = vec4(0, 0, 0, 0);\n       return;\n   }\n\n   inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),color);\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = clamp(bringDetails*textureImage.rgb,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",xo="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform vec3 color;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo(blurImage.rgb),0.0,1.0);\n\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level,1.0);\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    vec3 result = clamp(duotone(bringDetails,vec3(1.0),color)*textureImage.rgb,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n",_o="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform vec3 color;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo(blurImage.rgb),0.0,1.0);\n\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level,1.0);\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    vec3 result = clamp(duotone(bringDetails,vec3(1.0),color)*textureImage.rgb,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n";var Io="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    vec3 duoToneImg = duotone(sThreshold, vec3(1.0), vec3(0.14));\n    vec3 channelBd = vec3(inputImage.g, duoToneImg.g, duoToneImg.b);\n\n    gl_FragColor = vec4(darkenBlend(channelBd, textureImage.rgb)*inputImage.a,inputImage.a);\n}\n",To="#define GLSLIFY 1\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 shiftbd = inputImage.bgb;\n    vec3 multiplyBlend = vec3(shiftbd * textureImage.rgb);\n\n    gl_FragColor = vec4(hueAdjust(multiplyBlend, 180.0)*inputImage.a,inputImage.a);\n}\n",bo="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    vec3 duoToneImg = duotone(sThreshold, vec3(1.0), vec3(0.46));\n\n    gl_FragColor = vec4(hardLightBlend(duoToneImg, textureImage.rgb)*inputImage.a,inputImage.a);\n}\n",So="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    gl_FragColor = vec4(overlayBlend(sThreshold,textureImage.rgb)*inputImage.a,inputImage.a);\n}\n",Co="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    gl_FragColor = vec4(vec3(textureImage.rgb * sThreshold)*inputImage.a,inputImage.a);\n}\n",Bo="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    gl_FragColor = vec4(hardLightBlend(textureImage.rgb, sThreshold)*inputImage.a,inputImage.a);\n}\n",Fo="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone_2(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_2(vec3(result),color1,color2);\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise_0(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise_0(n/32.)*0.5875+noise_0(n/16.)*0.2+noise_0(n/8.)*0.1\n            +noise_0(n/4.)*0.05+noise_0(n/2.)*0.025+noise_0(n)*0.0125;\n \treturn duotone_0(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform sampler2D blurImage;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,4.0,vec3(0.8),vec3(0.2));\n\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.75),vec3(0.46));\n\n    vec3 hardlightBD = hardLightBlend(bImage.rgb, perlinN);\n    vec3 hardlightBD2 = hardLightBlend(noiseImg, hardlightBD);\n    vec3 hardlightBD3 = hardLightBlend(hardlightBD2, textureImage.rgb);\n\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,detail_level/255.0,0.55));\n    sThreshold = duotone_1(sThreshold,vec3(1.0),vec3(0.35));\n\n    hardlightBD3 = colorBurnBlend(sThreshold,hardlightBD3);\n\n    gl_FragColor = vec4(hardlightBD3*inputImage.a,inputImage.a);\n}\n",Eo="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.1));\n\n    gl_FragColor = vec4(overlayBlend(textureImage.rgb, sThreshold)*inputImage.a,inputImage.a);\n}\n",Po="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.74));\n\n    vec3 softBlend = softLightBlend(inputImage.rgb, textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(softBlend * sThreshold)*inputImage.a,inputImage.a);\n}\n",No="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwm2 = inputImage.bbb;\n\n    gl_FragColor = vec4(overlayBlend(textureImage.rgb, bwm2)*inputImage.a,inputImage.a);\n}\n",Mo="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float shadow_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwm2 = inputImage.bbb;\n\n    vec3 hardlightBD = hardLightBlend(textureImage.rgb, bwm2);\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,shadow_amount/255.0,0.6));\n\n    gl_FragColor = vec4(screenBlend(sThreshold, hardlightBD)*inputImage.a,inputImage.a);\n}\n",Do="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_0(vec3(result),color1,color2);\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise_0(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise_0(n/32.)*0.5875+noise_0(n/16.)*0.2+noise_0(n/8.)*0.1\n            +noise_0(n/4.)*0.05+noise_0(n/2.)*0.025+noise_0(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform sampler2D blurImage;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,4.0,vec3(0.8),vec3(0.2));\n\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.75),vec3(0.46));\n\n    vec3 hardlightBD = hardLightBlend(bImage.rgb, perlinN);\n    vec3 hardlightBD2 = hardLightBlend(noiseImg, hardlightBD);\n    vec3 hardlightBD3 = hardLightBlend(hardlightBD2, textureImage.rgb);\n    hardlightBD3 = hardLightBlend(inputImage.rgb,hardlightBD3);\n\n    gl_FragColor = vec4(hardlightBD3*inputImage.a,inputImage.a);\n}\n",wo="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 hardlightBD = hardLightBlend(inputImage.rgb, textureImage.rgb);\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.5));\n\n    gl_FragColor = vec4(vec3(hardlightBD * sThreshold)*inputImage.a,inputImage.a);\n}\n";var ko="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float grain_amount;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    grain_amount;\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 shiftImg = inputImage.gbb;\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.3),vec3(0.5));\n    vec3 vignetteImage = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.70,0.45);\n    vec3 vignettePerlin = (1.0-vignetteImage)+perlinN;\n\n    vec3 hardOrg = hardLightBlend(vignettePerlin,shiftImg);\n\n    vec3 duoNoise = duotone_0(vignettePerlin,vec3(0.99, 1.00, 0.44),vec3(1.00, 0.42, 0.00));\n\n    hardOrg = overlayBlend(duoNoise,hardOrg);\n    vignetteImage = duotone_0(vignetteImage,vec3(1.0),vec3(0.76, 0.43, 0.06));\n    hardOrg = clamp(hardOrg*vignetteImage,0.0,1.0);\n\n    inputImage.rgb = hardOrg*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Lo="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float grain_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.3),vec3(0.5));\n\n    vec3 hardOrg = hardLightBlend(perlinN,vec3(inputImage.g));\n\n    vec3 vignetteImage = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.70,0.45);\n    vec3 duoVig = duotone_0(vignetteImage,vec3(1.00, 0.99, 0.77),vec3(0.94, 0.44, 0.00));\n\n    vec3 colorB = colorBurnBlend(duoVig,hardOrg);\n    colorB = overlayBlend(colorB,textureImage.rgb);\n\n    inputImage.rgb = colorB*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Oo="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float grain_amount;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    grain_amount;\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,0.5,0.5));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.3),vec3(0.5));\n    vec3 vignetteImage = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.70,0.45);\n    vignetteImage = (1.0-vignetteImage)+perlinN;\n\n    vec3 hardOrg = hardLightBlend(vignetteImage,sThreshold);\n\n    vec3 duoNoise = duotone_0(vignetteImage,vec3(0.99, 1.00, 0.44),vec3(1.00, 0.42, 0.00));\n\n    hardOrg = overlayBlend(duoNoise,hardOrg);\n\n    inputImage.rgb = hardOrg*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Ro="#define GLSLIFY 1\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float grain_amount;\nuniform float sunburst_amount;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.8),vec3(0.2));\n\n    vec3 firstBlend = hardLightBlend(inputImage.rgb,perlinN);\n    inputImage.rgb = hardLightBlend(inputImage.rgb,firstBlend);\n\n    inputImage.rgb = hardLightBlend(inputImage.rgb,BContrastLeg(textureImage.rgb,1.0-sunburst_amount/100.0,1.0))*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Ao="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord_0( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord_0(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_1(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord_1( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\n//size should be max 30\nvec3 sunburstGen(vec2 coord,vec4 fArea, float size, vec3 lineColor, vec3 backColor,vec2 cXcY)\n{\n    //coord = mapCoord(coord,fArea);\n    coord *= cXcY;\n    vec2 center = vec2(0.5);\n    vec2 uv = (coord-center);\n    float len = length(uv);\n    float burst = cos(size*atan(uv.y, uv.x));\n    float r = burst > 0.0 ? smoothstep(0.0,0.4,burst) : smoothstep(0.0,1.0,burst);\n    float temp = r*len*4.0;//(smoothstep(0.03,0.08,len));\n\treturn duotone_0(vec3(temp),backColor,lineColor);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float halftone_size;\nuniform float sunburst_amount;\nuniform vec3 color;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 contrastImage = BContrastLeg(inputImage.rgb,1.0,1.0);\n    vec3 halfImage = halftone(uSampler,vTextureCoord,filterArea,vec2(clampX,clampY),halftone_size,vec3(0.6),vec3(1.0));\n\n    contrastImage = clamp(contrastImage*halfImage,0.0,1.0);\n\n    vec3 sunburstImg = sunburstGen(vTextureCoord,filterArea,sunburst_amount,vec3(1.0,1.0,1.0),color,vec2(clampX,clampY));\n\n    contrastImage = clamp(contrastImage*sunburstImg,0.0,1.0);\n\n    inputImage.rgb = contrastImage*inputImage.a;\n    gl_FragColor = inputImage;\n\n}\n",Vo="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float halftone_size;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,(silhouette_amount/2.0)/255.0,0.3));\n    vec3 halfImage = halftone(uSampler,vTextureCoord,filterArea,vec2(clampX,clampY),halftone_size,vec3(0.39),vec3(1.0));\n\n    halfImage = overlayBlend(halfImage,sThreshold);\n    halfImage = darkenBlend(textureImage.rgb,halfImage);\n\n    inputImage.rgb = halfImage*inputImage.a;\n    gl_FragColor = inputImage;\n}\n";var Uo="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = vec4(vec3(BContrastLeg(inputImage.rgb,1.0,1.8)),inputImage.a);\n}\n";var Go="#define GLSLIFY 1\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float contrast;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 sigmoidimg = sigmoid(inputImage.rgb, 0.75, contrast);\n    vec3 bwM3 = vec3(getLumo(sigmoidimg));\n    vec3 rbd = vec3(0.81, 0.78, 0.69);\n    vec3 oBlend = overlayBlend(rbd, bwM3) * 0.85 + bwM3 * (1.0 - 0.85);\n\n    gl_FragColor = vec4(oBlend*inputImage.a, inputImage.a);\n}\n",Ho="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    gl_FragColor = vec4(duotone(sThreshold, vec3(1.0), vec3(0.21, 0.18, 0.16))*inputImage.a, inputImage.a);\n}\n",zo="#define GLSLIFY 1\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone(vec3(result),color1,color2);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.8),vec3(1.0));\n    vec3 colorImg = vec3(0.24, 0.18, 0.13);\n    vec3 hlBlend = hardLightBlend(blurImage.rgb, colorImg);\n    vec3 oBlend = overlayBlend(noiseImg, hlBlend);\n\n    gl_FragColor = vec4(lightenBlend(oBlend, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",Xo="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n    sThreshold.r = inputImage.r;\n\n    gl_FragColor = vec4(darkenBlend(sThreshold, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",jo="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n    vec3 duoToneImg = duotone(sThreshold, vec3(1.0), vec3(0.55, 0.44, 0.24));\n\n    gl_FragColor = vec4(hardLightBlend(duoToneImg, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",Wo="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    gl_FragColor = vec4(vec3(textureImage.rgb * sThreshold)*inputImage.a, inputImage.a);\n}\n",Yo="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 bwmode2 = inputImage.bbb;\n    vec3 sThreshold = vec3(smoothThresholdLeg(bwmode2,silhouette_amount/255.0,0.1));\n    vec3 duoToneImg = duotone_0(sThreshold, vec3(0.85, 0.65, 0.41), vec3(0.0));\n\n    //use for perlinnoise\n    //perlinNoise(50, 50, 4, 150, true, true, 7, true);\n\n     vec2 uv = mapCoord(vTextureCoord,filterArea);\n     vec3 perlinNoiseImg = perlinNoise(uv,0.6,vec3(0.8),vec3(0.2));\n\n    //vec3 perlinNoiseImg = genNoise(vTextureCoord,vec3(0.0),vec3(1.0));\n    vec3 duoTonePerlinImg = duotone_0(perlinNoiseImg, vec3(0.0), vec3(0.62, 0.33, 0.19));\n\n    gl_FragColor = vec4(overlayBlend(duoTonePerlinImg, duoToneImg)*inputImage.a, inputImage.a);\n}\n",qo="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwmode2 = inputImage.bbb;\n    vec3 sThreshold = vec3(smoothThresholdLeg(bwmode2,silhouette_amount/255.0,0.3));\n\n    gl_FragColor = vec4(vec3(textureImage.rgb * sThreshold)*inputImage.a, inputImage.a);\n}\n",Ko="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 colorDodgeBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = colorDodgeBlendF(front.r,back.r);\n    result.g = colorDodgeBlendF(front.g,back.g);\n    result.b = colorDodgeBlendF(front.b,back.b);\n    return result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwmode2 = inputImage.bbb;\n    vec3 sThreshold = vec3(smoothThresholdLeg(bwmode2,silhouette_amount/255.0,0.3));\n    vec3 duoToneImg = duotone(sThreshold, vec3(1.0), vec3(0.55, 0.44, 0.24));\n\n    gl_FragColor = vec4(colorDodgeBlend(textureImage.rgb, duoToneImg)*inputImage.a, inputImage.a);\n}\n",Qo="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwmode2 = inputImage.bbb;\n\n    gl_FragColor = vec4(softLightBlend(textureImage.rgb, bwmode2)*inputImage.a, inputImage.a);\n}\n",Zo="#define GLSLIFY 1\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_0(vec3(result),color1,color2);\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.3),vec3(0.6));\n    vec3 bwmode2 = inputImage.bbb;\n    vec3 duoToneImg = duotone_1(bwmode2, vec3(0.93,0.68,0.41), vec3(0.0));\n    //give blur duoToneImg\n    //BlurChange(duotone,3,7,7)\n    vec3 oBlend = overlayBlend(inputImage.rgb, duoToneImg);\n\n    gl_FragColor = vec4(softLightBlend(noiseImg, oBlend)*inputImage.a, inputImage.a);\n}\n",Jo="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    vec3 duoToneImg = duotone(sThreshold, vec3(0.93, 0.68, 0.41), vec3(0.0));\n\n    gl_FragColor = vec4(hardLightBlend(duoToneImg, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",$o="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n//\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwM1 = inputImage.ggg;\n    vec3 adaptiveContrast = BContrastLeg(bwM1,1.0,1.4);\n\n    gl_FragColor = vec4(hardLightBlend(adaptiveContrast,textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",es="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D blurSampler;\nuniform float color_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwM3 = vec3(getLumo(inputImage.rgb));\n    vec3 hlBlend = hardLightBlend(textureImage.rgb, bwM3);\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,color_amount/255.0,0.4));\n\n    gl_FragColor = vec4(lightenBlend(blurImage.rgb, lightenBlend(sThreshold, hlBlend))*inputImage.a, inputImage.a);\n}\n",ts="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    vec3 duoToneImg = duotone(sThreshold, vec3(0.85, 0.65, 0.41), vec3(0.0));\n\n    gl_FragColor = vec4(screenBlend(duoToneImg, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",is="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nvec3 duotone_2(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise_0(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise_0(n/32.)*0.5875+noise_0(n/16.)*0.2+noise_0(n/8.)*0.1\n            +noise_0(n/4.)*0.05+noise_0(n/2.)*0.025+noise_0(n)*0.0125;\n \treturn duotone_0(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n//uniform sampler2D textureSampler;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 bwmode1 = inputImage.ggg;\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinNoiseImg = perlinNoise(uv,4.0,vec3(1.0),vec3(0.7));\n    vec3 cbBlend = colorBurnBlend(inputImage.rgb, perlinNoiseImg);\n\n    //use normal noise\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.73),vec3(0.15));\n    vec3 hardBlend = hardLightBlend(bwmode1, noiseImg);\n\n    hardBlend = hardLightBlend(cbBlend,hardBlend);\n\n    gl_FragColor = vec4(vec3(hardBlend.b)*inputImage.a, inputImage.a);\n}\n",rs="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 duotone_2(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise_0(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise_0(n/32.)*0.5875+noise_0(n/16.)*0.2+noise_0(n/8.)*0.1\n            +noise_0(n/4.)*0.05+noise_0(n/2.)*0.025+noise_0(n)*0.0125;\n \treturn duotone_2(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n//uniform sampler2D textureSampler;\nuniform float grain_amount;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.8),vec3(0.2));\n    vec3 duoToneImg = duotone_0(perlinN, vec3(0.42, 0.34, 0.24), vec3(0.84, 0.71, 0.50));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    gl_FragColor = vec4(vec3(duoToneImg * sThreshold)*inputImage.a, inputImage.a);\n}\n";var as="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color1;\nuniform vec3 color2;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n\n    vec3 duoImage = duotone(inputImage.rgb, color1, color2);\n\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = vec4(duoImage, inputImage.a);\n}\n";var ns="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwimg = inputImage.rrr;\n    vec3 blueColor = vec3(0.43, 0.54, 0.57);\n\n    vec3 screen1 = screenBlend(bwimg, inputImage.rgb) * 0.4 + inputImage.rgb * (1.0 - 0.4);\n    vec3 bwM3 = vec3(getLumo(screen1));\n    vec3 overlayImg = overlayBlend(blueColor, bwM3);\n\n    gl_FragColor = vec4( (screenBlend(textureImage.rgb, overlayImg) * amount + overlayImg * (1.0 - amount))*inputImage.a , inputImage.a);\n}\n",os="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float frost_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float adjustedHighlights = 1.0 + 10.0 / 200.0;\n    vec3 bwimg = inputImage.rrr * adjustedHighlights;\n    vec4 normalTextBlend = mix(inputImage,textureImage,frost_amount);\n    vec3 hardBlend = hardLightBlend(bwimg, normalTextBlend.rgb);\n    vec3 blueColor = vec3(0.43, 0.54, 0.57);\n\n    gl_FragColor = vec4(overlayBlend(blueColor, hardBlend)*inputImage.a, inputImage.a);\n}\n";var ss="#define GLSLIFY 1\nvec3 radialMask(vec2 coord, float amt, vec2 slideXY, vec2 res)\n{\n    vec2 onePixel = 1.0/res;\n    coord = coord + vec2(res.x*slideXY.x,res.y*slideXY.y);\n    float maskAmount = onePixel.x*amt;\n    float d = distance(res*0.5, coord)*maskAmount;\n    d= smoothstep(0.7,1.0,d);\n    return mix(vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0), vec3(d));\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float size;\nuniform float slide_vertical;\nuniform float slide_horizontal;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\nuniform vec2 resolutionXY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    if (blurImg.a > 0.0) {\n        blurImg.rgb /= blurImg.a;\n    }\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n\n    vec2 slide = vec2(-slide_horizontal,-slide_vertical);\n    vec3 rMask = radialMask(uv, size, slide,resolutionXY);\n\n    inputImage.rgb = mix(inputImage.rgb,blurImg.rgb,rMask)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",ls="#define GLSLIFY 1\nvec3 linearMask(vec2 coord, float amt, vec2 slideXY, float angleDegree)\n{\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord-vec2(0.5);\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord += vec2(0.5);\n    coord = coord + vec2(slideXY);\n    float vignetteAmount = amt;//onePixel.x*amt;\n    vec2 distPoint = vec2(coord.x,0.5);\n    float d = distance(distPoint, coord)*amt;\n    float smoothCalc = 15.425*exp(-0.277*amt);\n    d= smoothstep(0.7+smoothCalc/50.0,1.0,d);\n    return vec3(d);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float size;\nuniform float angle;\nuniform float slide_vertical;\nuniform float clampX;\nuniform float clampY;\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    if (blurImg.a > 0.0) {\n        blurImg.rgb /= blurImg.a;\n    }\n\n    vec2 slide = vec2(0.0,-slide_vertical);\n    vec3 lMask = linearMask(vTextureCoord*vec2(clampX,clampY), size, slide,angle);\n\n    inputImage.rgb = mix(inputImage.rgb,blurImg.rgb,lMask)*inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n";var hs="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform float red;\nuniform float navy;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    if (blurImage.a > 0.0) {\n        blurImage.rgb /= blurImage.a;\n    }\n\n    red;navy;\n\n    vec3 color1 = vec3(0.984,0.886,0.647);\n    vec3 color2 = vec3(0.85,0.101,0.129);\n    vec3 color3 = vec3(0.0,0.2,0.298);\n    float whiteThreshold = 0.0;\n    float whiteThreshold2 = 0.0;\n\n    float brightness = (blurImage.r + blurImage.g + blurImage.b) / 3.0;\n\n    vec3 dst = vec3(0.0);\n\n    vec3 layer1 = vec3(0.0);\n    float blackThreshold = red;\n    float blackThreshold2 = navy;\n\n    if (brightness < blackThreshold) {\n        layer1.r = color2.r;\n        layer1.g = color2.g;\n        layer1.b = color2.b;\n        dst = layer1;\n    } else if (brightness > whiteThreshold) {\n        // Above threshold\n        layer1.r = color1.r;\n        layer1.g = color1.g;\n        layer1.b = color1.b;\n        dst = layer1;\n    } else {\n        // Between the threshold\n        layer1.rgb = vec3((brightness - blackThreshold) / (whiteThreshold - blackThreshold));\n        dst = layer1;\n    }\n\n    vec3 layer2 = vec3(0.0);\n    if (brightness < blackThreshold2) {\n        // Below threshold\n        layer2.r = color3.r;\n        layer2.g = color3.g;\n        layer2.b = color3.b;\n        dst=layer2;\n    } else if (brightness > whiteThreshold2) {\n        // Above threshold\n        layer2.r = layer1.r;\n        layer2.g = layer1.g;\n        layer2.b = layer1.b;\n        dst=layer2;\n    } else {\n        // Between the threshold\n        layer2.rgb = vec3((brightness - blackThreshold2) / (whiteThreshold2 - blackThreshold2));\n        dst=layer2;\n    }\n\n    gl_FragColor = vec4(dst.rgb*blurImage.a, blurImage.a);\n}\n",cs="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec2 gridDot(vec2 px, vec2 dSize)\n{\n\treturn floor(mod(px,dSize));\n\t//return floor( px / dSize ) * dSize;\n}\n\nvec4 repeatTexture(sampler2D sourceImage, vec2 sourceCoord, vec4 filterA, float texSize, vec2 clampXY, float tileSize){\n\n    vec2 uv = mapCoord(sourceCoord,filterA);\n    uv = floor(gridDot(uv,vec2(texSize*tileSize))/tileSize);\n    uv = unmapCoord(uv,filterA);\n    return texture2D(sourceImage, uv* vec2(clampXY.x,clampXY.y));\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D starSampler;\n\nuniform float silhouette_amount;\nuniform float color_space;\nuniform float star_size;\n\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 smooth1 = smoothThreshold(inputImage.rgb,silhouette_amount/255.0,150.0/255.0);\n\n    vec4 starImage = repeatTexture(starSampler,vTextureCoord,filterArea,256.0,vec2(clampX,clampY),star_size);\n\n    starImage.rgb = duotone(starImage.rgb,vec3(1.0),vec3(0.98, 0.94, 0.51));\n\n    smooth1 = clamp(smooth1*textureImage.rgb,0.0,1.0);\n\n    smooth1 = clamp(smooth1*starImage.rgb,0.0,1.0);\n\n    inputImage.rgb = smooth1;\n\n    inputImage.rgb = hueAdjust(inputImage.rgb,color_space)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",us="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwM3 = vec3(getLumo(asImage.rgb));\n   gl_FragColor = vec4(vec3(textureImage.rgb * bwM3)*inputImage.a, inputImage.a);\n}\n",ds="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n    gl_FragColor = vec4(vec3(textureImage.rgb * asImage.rgb)*inputImage.a, inputImage.a);\n}\n",ms="#define GLSLIFY 1\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord_0( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord_0(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_1(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord_1( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord_1(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_0(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float halftone_size;\nuniform float line_width;\nuniform float line_angle;\nuniform vec3 line_color;\nuniform vec3 background_color;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 bwM3 = vec3(getLumo_1(inputImage.rgb));\n    vec3 adaptiveContrast = BContrastLeg(bwM3,1.0,3.0);\n\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,line_angle,background_color,line_color);\n    vec3 lineBlend = overlayBlend(lines, adaptiveContrast);\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.6),vec3(1.0));\n\n    gl_FragColor = vec4(overlayBlend(halftoneImg, lineBlend)*inputImage.a, inputImage.a);\n}\n",ps="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float color_space;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 smooth1 = smoothThreshold(inputImage.rgb,silhouette_amount/255.0,150.0/255.0);\n    vec3 smooth2 = smoothThreshold(inputImage.rgb,165.0/255.0,186.0/255.0);\n\n    smooth1 = duotone(smooth1,vec3(1.0),vec3(0.19, 0.67, 1.00));\n    smooth2 = duotone(smooth2,vec3(1.0),vec3(0.90, 0.47, 0.49));\n\n    inputImage.rgb = clamp(smooth1*smooth2,0.0,1.0);\n    inputImage.rgb = hueAdjust(inputImage.rgb,color_space)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",gs="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float color_space;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    silhouette_amount;color_space;\n\n    vec4 fillColor = vec4(1);\n    vec2 clampValues = vec2(clampX, clampY);\n    vec2 onePixel = 1.0/filterArea.xy;\n\n   vec3 smooth3 = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.2));\n\n   vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.035, 0.0400), vec2(1.0, 1.0), clampValues, 1,0, fillColor);\n   vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(-0.030, -0.022), vec2(1.0, 1.0), clampValues, 1,0, fillColor);\n\n   vec3 smooth1 = vec3(smoothThreshold(inputImage1.rgb,102.0/255.0,0.5));\n   vec3 smooth2 = vec3(smoothThreshold(inputImage2.rgb,102.0/255.0,0.5));\n\n   smooth1 = duotone(smooth1,vec3(1.0),vec3(0.84, 0.92, 1.00));\n   smooth2 = duotone(smooth2,vec3(1.0),vec3(1.00, 0.62, 0.70));\n\n   vec3 result = smooth1*smooth2*smooth3;\n\n   inputImage.rgb = clamp(smooth1*smooth2,0.0,1.0);\n   inputImage.rgb = clamp(inputImage.rgb*smooth3,0.0,1.0);\n   inputImage.rgb = clamp(inputImage.rgb*textureImage.rgb,0.0,1.0);\n   inputImage.rgb = hueAdjust(inputImage.rgb,color_space)*inputImage.a;\n    gl_FragColor = inputImage;\n}\n";var fs="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 = linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient3(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, float step1, float step2, float step3) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n    vec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n    outputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 linGradImage = linearGradient3(vTextureCoord,vec2(clampX,clampY),180.0,1.0,vec3(0.039,0.0,0.69),vec3(1.0,0.0,0.0),vec3(1.0,0.98,0.0),0.0,0.5,1.0);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n\n    gl_FragColor = vec4(overlayBlend(linGradImage, smoothBd), inputImage.a);\n}\n",vs="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient4(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, vec3 c4, float step1, float step2, float step3, float step4) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n    vec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n    outputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n    outputColor = mix(outputColor, c4, genSmoothStep(step3, step4, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D halftoneSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 halftoneImage = texture2D(halftoneSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 c1 = vec3(0.0,1.0,1.0);\n    vec3 c2 = vec3(0.0,1.0,0.0);\n    vec3 c3 = vec3(1.0,1.0,0.0);\n    vec3 c4 = vec3(1.0,0.0,0.0);\n\n    vec3 linGradImage = linearGradient4(vTextureCoord,vec2(clampX,clampY),90.0,1.0,c1,c2,c3,c4,0.0,0.5,0.75,1.0);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n\n    halftoneImage = clamp(halftoneImage,0.0,1.0);\n    vec3 darkenImg = darkenBlend(linGradImage, smoothBd);\n\n    gl_FragColor = vec4(overlayBlend(halftoneImage.rgb, darkenImg) * 0.40 + darkenImg * (1.0 - 0.40), inputImage.a);\n}\n",ys="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient7(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, vec3 c4, vec3 c5, vec3 c6, vec3 c7,\nfloat step1, float step2, float step3, float step4, float step5, float step6, float step7) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n   \tvec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c4, genSmoothStep(step3, step4, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c5, genSmoothStep(step4, step5, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c6, genSmoothStep(step5, step6, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c7, genSmoothStep(step6, step7, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 c1 = vec3(1.0, 0.0, 0.0);\n    vec3 c2 = vec3(1.0, 0.0, 0.41);\n    vec3 c3 = vec3(1.0, 0.0, 1.0);\n    vec3 c4 = vec3(0.51, 0.0, 1.0);\n    vec3 c5 = vec3(0.0, 0.0, 1.0);\n    vec3 c6 = vec3(0.0, 1.0, 0.0);\n    vec3 c7 = vec3(1.0, 0.54, 0.0);\n\n    vec3 linGradImage = linearGradient7(vTextureCoord,vec2(clampX,clampY),135.0,0.0,c1,c2,c3,c4,c5,c6,c7,0.0,0.15,0.33,0.5,0.66,0.84,1.0);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n\n    gl_FragColor = vec4(overlayBlend(linGradImage.rgb, smoothBd), inputImage.a);\n}\n",xs="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient7(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, vec3 c4, vec3 c5, vec3 c6, vec3 c7,\nfloat step1, float step2, float step3, float step4, float step5, float step6, float step7) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n   \tvec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c4, genSmoothStep(step3, step4, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c5, genSmoothStep(step4, step5, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c6, genSmoothStep(step5, step6, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c7, genSmoothStep(step6, step7, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 c1 = vec3(1.0, 0.0, 0.0);\n    vec3 c2 = vec3(1.0, 0.0, 1.0);\n    vec3 c3 = vec3(0.0, 0.0, 1.0);\n    vec3 c4 = vec3(0.0, 1.0, 1.0);\n    vec3 c5 = vec3(0.0, 1.0, 0.0);\n    vec3 c6 = vec3(1.0, 1.0, 0.0);\n    vec3 c7 = vec3(1.0, 0.0, 0.0);\n\n    vec3 linGradImage = linearGradient7(vTextureCoord,vec2(clampX,clampY),135.0,0.0,c1,c2,c3,c4,c5,c6,c7,0.0,0.15,0.33,0.5,0.66,0.84,1.0);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n\n    gl_FragColor = vec4(darkenBlend(linGradImage, smoothBd), inputImage.a);\n}\n",_s="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 = linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient3(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, float step1, float step2, float step3) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n    vec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n    outputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 linGradImage = linearGradient3(vTextureCoord,vec2(clampX,clampY),180.0,1.0,vec3(0.039,0.0,0.69),vec3(1.0,0.0,0.0),vec3(1.0,0.98,0.0),0.0,0.5,1.0);\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n    gl_FragColor = vec4(screenBlend(linGradImage, smoothBd)*inputImage.a, inputImage.a);\n}\n",Is="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D halftoneSampler;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 halftoneImage1 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage2 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage3 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage4 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n   //vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    if (inputImage1.a > 0.0) {\n        inputImage1.rgb /= inputImage1.a;\n        inputImage2.rgb /= inputImage2.a;\n        inputImage3.rgb /= inputImage3.a;\n        inputImage4.rgb /= inputImage4.a;\n    }\n\n    float sAmount = silhouette_amount/255.0;\n\n    inputImage1.rgb = smoothThreshold(inputImage1.rgb,sAmount,0.5);\n    inputImage2.rgb = smoothThreshold(inputImage2.rgb,sAmount,0.5);\n    inputImage3.rgb = smoothThreshold(inputImage3.rgb,sAmount,0.5);\n    inputImage4.rgb = smoothThreshold(inputImage4.rgb,sAmount,0.5);\n\n    inputImage1.rgb = duotone(inputImage1.rgb,vec3(0.71, 1.0, 0.64),vec3(0.68, 0.20, 0.20));\n    inputImage2.rgb = duotone(inputImage2.rgb,vec3(0.0, 0.90, 1.0),vec3(0.49, 0.11, 0.36));\n    inputImage3.rgb = duotone(inputImage3.rgb,vec3(1.0, 0.97, 0.0),vec3(0.0, 0.47, 0.83));\n    inputImage4.rgb = duotone(inputImage4.rgb,vec3(1.0, 0.48, 0.93),vec3(0.0, 0.47, 0.07));\n\n    inputImage1.rgb = colorBurnBlend(halftoneImage1.rgb, inputImage1.rgb)*inputImage1.a;\n    inputImage2.rgb = colorBurnBlend(halftoneImage2.rgb, inputImage2.rgb)*inputImage2.a;\n    inputImage3.rgb = colorBurnBlend(halftoneImage3.rgb, inputImage3.rgb)*inputImage3.a;\n    inputImage4.rgb = colorBurnBlend(halftoneImage4.rgb, inputImage4.rgb)*inputImage4.a;\n\n    gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n}\n",Ts="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D adaptiveSharpenSampler;\n\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputImage1 = offsetPixel(adaptiveSharpenSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 inputImage2 = offsetPixel(adaptiveSharpenSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 inputImage3 = offsetPixel(adaptiveSharpenSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 inputImage4 = offsetPixel(adaptiveSharpenSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    inputImage1.rgb = mix(inputImage1.rgb,duotone(inputImage1.bbb,vec3(0.71, 1.0, 0.64),vec3(0.68, 0.20, 0.20)),1.0)*inputImage1.a;\n    inputImage2.rgb = mix(inputImage2.rgb,duotone(inputImage2.bbb,vec3(0.61, 1.0, 0.96),vec3(0.80, 0.21, 1.0)),1.0)*inputImage2.a;\n    inputImage3.rgb = mix(inputImage3.rgb,duotone(inputImage3.bbb,vec3(1.0, 0.97, 0.49),vec3(0.0, 0.53, 1.0)),1.0)*inputImage3.a;\n    inputImage4.rgb = mix(inputImage4.rgb,duotone(inputImage4.bbb,vec3(1.0, 0.73, 0.96),vec3(0.18, 0.48, 0.0)),1.0)*inputImage4.a;\n\n    inputImage.rgb = inputImage1.rgb + inputImage2.rgb +inputImage3.rgb + inputImage4.rgb;\n\n    gl_FragColor = vec4(inputImage.rgb,(inputImage1.a+inputImage2.a+inputImage3.a+inputImage4.a));\n}\n",bs="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float silhouette_amount;\nuniform vec3 color_value_1;\nuniform vec3 color_value_2;\nuniform vec3 color_value_3;\nuniform vec3 color_value_4;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    vec4 blurImage1 = offsetPixel(blurSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage2 = offsetPixel(blurSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage3 = offsetPixel(blurSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage4 = offsetPixel(blurSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smooth1 = smoothThreshold(blurImage1.rgb,sAmount,0.5);\n    vec3 smooth2 = smoothThreshold(blurImage2.rgb,sAmount,0.5);\n    vec3 smooth3 = smoothThreshold(blurImage3.rgb,sAmount,0.5);\n    vec3 smooth4 = smoothThreshold(blurImage4.rgb,sAmount,0.5);\n\n    inputImage1.rgb = mix(inputImage1.rgb,duotone(smooth1,color_value_1,vec3(0.0)),1.0)*inputImage1.a;\n    inputImage2.rgb = mix(inputImage2.rgb,duotone(smooth2,color_value_2,vec3(0.0)),1.0)*inputImage2.a;\n    inputImage3.rgb = mix(inputImage3.rgb,duotone(smooth3,color_value_3,vec3(0.0)),1.0)*inputImage3.a;\n    inputImage4.rgb = mix(inputImage4.rgb,duotone(smooth4,color_value_4,vec3(0.0)),1.0)*inputImage4.a;\n\n    //inputImage.rgb = duo1 + duo2 + duo3 + duo4;\n    //inputImage.rgb = smooth1 + smooth2 + smooth3 + smooth4;\n\n    gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n}\n",Ss="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_1(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_1(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D gradientSampler;\nuniform sampler2D halftoneSampler;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 gradientImage = texture2D(gradientSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 halftoneImage1 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage2 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage3 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage4 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    float sAmount = silhouette_amount/255.0;\n\n    inputImage1.rgb = smoothThreshold(inputImage1.rgb,sAmount,0.5);\n    inputImage2.rgb = smoothThreshold(inputImage2.rgb,sAmount,0.5);\n    inputImage3.rgb = smoothThreshold(inputImage3.rgb,sAmount,0.5);\n    inputImage4.rgb = smoothThreshold(inputImage4.rgb,sAmount,0.5);\n\n//    inputImage1.rgb = duotone(inputImage1.rgb,vec3(0.71, 1.0, 0.64),vec3(0.68, 0.20, 0.20));\n//    inputImage2.rgb = duotone(inputImage2.rgb,vec3(0.0, 0.90, 1.0),vec3(0.49, 0.11, 0.36));\n//    inputImage3.rgb = duotone(inputImage3.rgb,vec3(1.0, 0.97, 0.0),vec3(0.0, 0.47, 0.83));\n//    inputImage4.rgb = duotone(inputImage4.rgb,vec3(1.0, 0.48, 0.93),vec3(0.0, 0.47, 0.07));\n\n    inputImage1.rgb = clamp(inputImage1.rgb*halftoneImage1.rgb,0.0,1.0);\n    inputImage2.rgb = clamp(inputImage2.rgb*halftoneImage2.rgb,0.0,1.0);\n    inputImage3.rgb = clamp(inputImage3.rgb*halftoneImage3.rgb,0.0,1.0);\n    inputImage4.rgb = clamp(inputImage4.rgb*halftoneImage4.rgb,0.0,1.0);\n\n    float onePixelY = 1.0/filterArea.y;\n//    vec3 gradResult = gradientMap(inputImage.rgb,gradientSampler,filterArea,clampX,onePixelY*17.0);\n\n    inputImage1.rgb = gradientMap(inputImage1.rgb,gradientSampler,filterArea,clampX,onePixelY*2.0*clampY)*inputImage1.a;\n    inputImage2.rgb = gradientMap(inputImage2.rgb,gradientSampler,filterArea,clampX,onePixelY*7.0*clampY)*inputImage2.a;\n    inputImage3.rgb = gradientMap(inputImage3.rgb,gradientSampler,filterArea,clampX,onePixelY*12.0*clampY)*inputImage3.a;\n    inputImage4.rgb = gradientMap(inputImage4.rgb,gradientSampler,filterArea,clampX,onePixelY*17.0*clampY)*inputImage4.a;\n\n//    inputImage1.rgb = darkenBlend(inputImage1.rgb, halftoneImage1.rgb);\n//    inputImage2.rgb = darkenBlend(inputImage2.rgb, halftoneImage2.rgb);\n//    inputImage3.rgb = darkenBlend(inputImage3.rgb, halftoneImage3.rgb);\n//    inputImage4.rgb = darkenBlend(inputImage4.rgb, halftoneImage4.rgb);\n\n    //gradient maps\n\n    gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n}\n",Cs="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nvec3 quantize(vec3 inpImg, float palette, float lightness) {\n\tinpImg = inpImg*lightness;\n\treturn floor(inpImg*floor(float(palette)))/floor(float(palette));\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nfloat getLumo_3(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_3(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lumoBlend(vec3 back, vec3 front) {\n\n    return vec3(setlum(back.rgb, getLumo_1(front.rgb)));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D halftoneSampler;\nuniform float color_detail;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 halftoneImage = texture2D(halftoneSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 halftoneImage1 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage2 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage3 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage4 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    vec4 blurImage1 = offsetPixel(blurSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage2 = offsetPixel(blurSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage3 = offsetPixel(blurSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage4 = offsetPixel(blurSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    blurImage1.rgb = quantize(blurImage1.rgb,color_detail,1.0);\n    blurImage2.rgb = quantize(blurImage2.rgb,color_detail,1.0);\n    blurImage3.rgb = quantize(blurImage3.rgb,color_detail,1.0);\n    blurImage4.rgb = quantize(blurImage4.rgb,color_detail,1.0);\n\n    blurImage1.rgb = lumoBlend(inputImage1.rgb,blurImage1.rgb);\n    blurImage2.rgb = lumoBlend(inputImage2.rgb,blurImage2.rgb);\n    blurImage3.rgb = lumoBlend(inputImage3.rgb,blurImage3.rgb);\n    blurImage4.rgb = lumoBlend(inputImage4.rgb,blurImage4.rgb);\n\n    blurImage1.rgb = hardLightBlend(blurImage1.rgb,halftoneImage1.rgb);\n    blurImage2.rgb = hardLightBlend(blurImage2.rgb,halftoneImage2.rgb);\n    blurImage3.rgb = hardLightBlend(blurImage3.rgb,halftoneImage3.rgb);\n    blurImage4.rgb = hardLightBlend(blurImage4.rgb,halftoneImage4.rgb);\n\n    blurImage1.rgb = hueAdjust(blurImage1.rgb,15.0);\n    blurImage2.rgb = hueAdjust(blurImage2.rgb,65.0);\n    blurImage3.rgb = hueAdjust(blurImage3.rgb,-15.0);\n    blurImage4.rgb = hueAdjust(blurImage4.rgb,160.0);\n\n    inputImage.rgb = blurImage1.rgb+blurImage2.rgb+blurImage3.rgb+blurImage4.rgb;\n\n    gl_FragColor = vec4(inputImage.rgb,(inputImage1.a+inputImage2.a+inputImage3.a+inputImage4.a));\n}\n",Bs="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D halftoneSampler;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 halftoneImage = texture2D(halftoneSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 halftoneImage1 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage2 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage3 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage4 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    float sAmount = silhouette_amount/255.0;\n\n    inputImage1.rgb = smoothThreshold(inputImage1.rgb,sAmount,0.5);\n    inputImage2.rgb = smoothThreshold(inputImage2.rgb,sAmount,0.5);\n    inputImage3.rgb = smoothThreshold(inputImage3.rgb,sAmount,0.5);\n    inputImage4.rgb = smoothThreshold(inputImage4.rgb,sAmount,0.5);\n\n    vec4 grid1 = halftoneImage1*inputImage1;\n    vec4 grid2 = halftoneImage2*inputImage2;\n    vec4 grid3 = halftoneImage3*inputImage3;\n    vec4 grid4 = halftoneImage4*inputImage4;\n\n    grid1.rgb = duotone(grid1.rgb,vec3(0.00, 0.81, 0.00),vec3(0.0));\n    grid2.rgb = duotone(grid2.rgb,vec3(0.00, 0.90, 1.00),vec3(0.0));\n    grid3.rgb = duotone(grid3.rgb,vec3(1.00, 0.97, 0.00),vec3(0.0));\n    grid4.rgb = duotone(grid4.rgb,vec3(1.00, 0.35, 0.56),vec3(0.0));\n\n    inputImage = grid1+grid2+grid3+grid4;\n\n     gl_FragColor = inputImage;\n}\n",Fs="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_1(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_0(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_0(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform sampler2D gradientSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.5),vec3(1.0));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_2(asImage.rgb)));\n    overlayImg = gradientMap(overlayImg,gradientSampler,filterArea,clampX,0.0);\n\n    vec2 clampValues = vec2(clampX,clampY);\n    vec3 greenOffset = offsetPixel(uSampler, vTextureCoord, vec2(-0.15*clampX, -0.08*clampY), vec2(1.0), clampValues,0,0,vec4(1.0)).rgb;\n    greenOffset = smoothThreshold(greenOffset,0.4,0.5);\n    greenOffset = duotone_1(greenOffset,vec3(1.0),vec3(0.73, 1.00, 1.00));\n\n    vec3 yellowOffset = offsetPixel(uSampler, vTextureCoord, vec2(0.15*clampX, 0.08*clampY), vec2(1.0), clampValues,0,0,vec4(1.0)).rgb;\n    yellowOffset = smoothThreshold(yellowOffset,0.4,0.5);\n    yellowOffset = duotone_1(yellowOffset,vec3(1.0),vec3(1.00, 0.61, 0.61));\n\n    overlayImg = hardLightBlend(overlayImg,yellowOffset);\n    overlayImg = clamp(greenOffset*overlayImg,0.0,1.0);\n\n    inputImage.rgb = overlayImg*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Es="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_1(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_0(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D gradientSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.16),vec3(0.87));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_2(asImage.rgb)));\n    vec3 gradResult = gradientMap(overlayImg,gradientSampler,filterArea,clampX,0.0);\n    gradResult = hardLightBlend(gradResult,textureImage.rgb);\n\n    inputImage.rgb = gradResult*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Ps="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_0(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.5),vec3(1.0));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_1(asImage.rgb)));\n    overlayImg = duotone_1(overlayImg,vec3(1.0),vec3(0.18, 0.38, 0.93));\n\n    vec2 clampValues = vec2(clampX,clampY);\n    vec3 greenOffset = offsetPixel(uSampler, vTextureCoord, vec2(-0.08*clampX, 0.0), vec2(1.0), clampValues,0,0,vec4(1.0)).rgb;\n    greenOffset = smoothThreshold(greenOffset,0.4,0.5);\n    greenOffset = duotone_1(greenOffset,vec3(1.0),vec3(0.67, 1.00, 0.87));\n\n    vec3 yellowOffset = offsetPixel(uSampler, vTextureCoord, vec2(0.08*clampX, 0.08*clampY), vec2(1.0), clampValues,0,0,vec4(1.0)).rgb;\n    yellowOffset = smoothThreshold(yellowOffset,0.4,0.5);\n    yellowOffset = duotone_1(yellowOffset,vec3(1.0),vec3(0.87, 1.00, 0.64));\n\n    overlayImg = clamp(yellowOffset*overlayImg,0.0,1.0);\n    overlayImg = clamp(greenOffset*overlayImg,0.0,1.0);\n\n    inputImage.rgb = overlayImg*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Ns="#define GLSLIFY 1\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 saturation(vec3 inpImg, float satAmount) {\n\n    //SATURATION ADJUST\n    float avg = (inpImg.r + inpImg.g + inpImg.b) / 3.0;\n    if (satAmount > 0.0) {\n     inpImg.rgb += (avg - inpImg.rgb) * (1.0 - 1.0 / (1.001 - satAmount/2.0));\n    } else {\n     inpImg.rgb += (avg - inpImg.rgb) * (-satAmount);\n    }\n    return inpImg;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.5),vec3(1.0));\n    asImage.rgb = saturation(asImage.rgb,0.8);\n\n    asImage.rgb = hardLightBlend(asImage.rgb,halftoneImg);\n    inputImage.rgb = asImage.rgb*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Ms="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_1(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\nuniform float halftone_size;\nuniform float detail_level;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.16),vec3(0.87));\n    halftoneImg = smoothThreshold(halftoneImg,117.0/255.0,1.0);\n    halftoneImg = overlayBlend(halftoneImg,inputImage.rgb);\n\n    // Sketch\n    float inputDesat = getLumo_1(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo_1(blurImage.rgb),0.0,1.0);\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level/255.0,1.0);\n    bringDetails = duotone_0(bringDetails,vec3(1.0),vec3(0.42, 0.00, 0.00));\n    bringDetails = clamp(bringDetails*textureImage.rgb,0.0,1.0);\n    bringDetails = darkenBlend(halftoneImg,bringDetails);\n\n    halftone_size;detail_level;\n\n    inputImage.rgb = bringDetails*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Ds="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_1(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_1(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_2(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D gradientSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\nuniform float halftone_size;\nuniform float detail_level;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.16),vec3(0.87));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_0(asImage.rgb)));\n    vec3 gradResult = gradientMap(overlayImg,gradientSampler,filterArea,clampX,0.0);\n\n    // Sketch\n    float inputDesat = getLumo_0(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo_0(blurImage.rgb),0.0,1.0);\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level/255.0,1.0);\n    bringDetails = duotone_0(bringDetails,vec3(1.0),vec3(0.42, 0.00, 0.00));\n    bringDetails = clamp(bringDetails*textureImage.rgb,0.0,1.0);\n    bringDetails = overlayBlend(gradResult,bringDetails);\n\n    halftone_size;detail_level;\n\n    gl_FragColor = vec4(bringDetails*inputImage.a, inputImage.a);\n}\n",ws="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 background_color)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_1(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),background_color,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_2(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D gradientSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 gradientImage = texture2D(gradientSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.16),vec3(0.87));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_0(asImage.rgb)));\n    vec3 gradResult = gradientMap(overlayImg,gradientSampler,filterArea,clampX,0.0);\n\n    gl_FragColor = vec4(gradResult*inputImage.a, inputImage.a);\n}\n";var ks="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float offsetX;\nuniform float offsetY;\n\nuniform float scaleX;\nuniform float scaleY;\n\nuniform float clampX;\nuniform float clampY;\n\nuniform int wrap;\n\nvoid main(void){\n\n    gl_FragColor = offsetPixel(uSampler, vTextureCoord, vec2(offsetX, offsetY), vec2(scaleX, scaleY), vec2(clampX, clampY), wrap, 0, vec4(0.0));\n\n}\n";var Ls="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 color1) {\n\n    return setlum(color1, getLumo_0(inpImage));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 color1, vec3 color2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return color1*v+color2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color1;\nuniform vec4 color2;\nuniform float amount;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 effectedImg = vec4(vec3(0.0), inputImage.a);\n\n    if(color2.a == 0.0){\n        effectedImg.rgb = tint(inputImage.rgb, color1);\n    } else {\n        effectedImg.rgb = duotone(inputImage.rgb, color1, color2.rgb);\n    }\n\n    inputImage.rgb *= inputImage.a;\n    effectedImg.rgb *= inputImage.a;\n\n    gl_FragColor = mix(inputImage,effectedImg,amount);\n}\n";var Os="#define GLSLIFY 1\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 saturation(vec3 inpImg, float satAmount) {\n\n    //SATURATION ADJUST\n    float avg = (inpImg.r + inpImg.g + inpImg.b) / 3.0;\n    if (satAmount > 0.0) {\n     inpImg.rgb += (avg - inpImg.rgb) * (1.0 - 1.0 / (1.001 - satAmount/2.0));\n    } else {\n     inpImg.rgb += (avg - inpImg.rgb) * (-satAmount);\n    }\n    return inpImg;\n\n}\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nvarying vec2 vTextureCoord;\n//uniform sampler2D uSampler;\n//uniform sampler2D blurSampler;\nuniform sampler2D uSampler[2];\nuniform float amount;\n\n//uniform float clampX;\n//uniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler[0], vTextureCoord);\n    vec4 blurImage = texture2D(uSampler[1], vTextureCoord);\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    blurImage.rgb = blurImage.rgb / blurImage.a;\n\n//    * vec2(clampX,clampY)\n\n    vec3 origLumo = rgb2lab(inputImage.rgb);\n    vec3 blurLumo = rgb2lab(blurImage.rgb);\n\n    float resultLumo = overlayBlendF(1.0-blurLumo.r,origLumo.r);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n\n    result = result * inputImage.a;\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    vec4 saturationImg = vec4(vec3(saturation(result, 0.2)), inputImage.a);\n\n    gl_FragColor = mix(inputImage,saturationImg,amount);\n//    gl_FragColor = blurImage;\n}\n";var Rs="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform float clampCoord;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    lowp vec4 color = vec4(0.0);\n    vec2 off1 = vec2(1.0) * vec2(strength,0.0);\n    vec2 off2 = vec2(2.0) * vec2(strength,0.0);\n    vec2 off3 = vec2(3.0) * vec2(strength,0.0);\n\n    color += texture2D(uSampler, vTextureCoord);\n    color += texture2D(uSampler, clamp(vTextureCoord + off1,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off1,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord + off2,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off2,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord + off3,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off3,vec2(0.0),vec2(clampCoord,1.0)));\n\n    color /= 7.0;\n    gl_FragColor = color;\n\n}\n",As="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n";class Vs extends PIXI.Filter{constructor(e,t){super(As,Rs),this.resolution=t||1,this.strength=e||8,this.padding=0,this.offsetNextPowerW=null,this.clampX=null,this.adjustedStrength=null}apply(e,t,i,r){this.offsetNextPowerW=t.size.width-i.destinationFrame.width,0==this.offsetNextPowerW?this.clampX=1:this.clampX=1-(this.offsetNextPowerW+2+1/this.resolution)/t.size.width,this.adjustedStrength=10*this.strength/this.resolution*.65,this.uniforms.strength=this.adjustedStrength/t.size.width,this.uniforms.clampCoord=this.clampX,e.applyFilter(this,t,i,r)}get blur(){return this.strength}set blur(e){this.strength=e}}var Us="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform float clampCoord;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    lowp vec4 color = vec4(0.0);\n    vec2 off1 = vec2(1.0) * vec2(0.0,strength);\n    vec2 off2 = vec2(2.0) * vec2(0.0,strength);\n    vec2 off3 = vec2(3.0) * vec2(0.0,strength);\n\n    color += texture2D(uSampler, vTextureCoord);\n    color += texture2D(uSampler, clamp(vTextureCoord + off1,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off1,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord + off2,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off2,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord + off3,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off3,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n\n    color /= 7.0;\n    gl_FragColor = color;\n\n}\n\n";class Gs extends PIXI.Filter{constructor(e,t){super(As,Us),this.resolution=t||1,this.strength=e||8,this.padding=0,this.offsetNextPowerH=null,this.clampY=null,this.adjustedStrength=null}apply(e,t,i,r){this.offsetNextPowerH=t.size.height-i.destinationFrame.height,0==this.offsetNextPowerH?this.clampY=1:this.clampY=1-(this.offsetNextPowerH+2+1/this.resolution)/t.size.height,this.adjustedStrength=10*this.strength/this.resolution*.65,this.uniforms.strength=this.adjustedStrength/t.size.height,this.uniforms.clampCoord=this.clampY,e.applyFilter(this,t,i,r)}get blur(){return this.strength}set blur(e){this.strength=e}}var Hs="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\nvoid main(void){\n\n    lowp vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    lowp vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    if (blurImg.a > 0.0) {\n        blurImg.rgb /= blurImg.a;\n    }\n\n    lowp vec3 inpScreen = screenBlend(inputImage.rgb, inputImage.rgb);\n    lowp vec3 blurScreen = screenBlend(blurImg.rgb, blurImg.rgb);\n\n    inputImage.rgb = inpScreen * blurScreen * inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n";var zs="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(inputImage.rgb));\n    inputLumo = sigmoid(inputLumo,0.75,0.85);\n    vec3 screenImage = screenBlend(inputLumo.rgb, inputImage.rgb);\n\n    screenImage = hardLightBlend(screenImage,textureImage.rgb);\n    vec3 vignetteImageBlur = vignette_0(blurImage.rgb,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    vignetteImageBlur = hardLightBlend(vignetteImageBlur,screenImage);\n\n    inputImage.rgb = vignetteImageBlur*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Xs="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(blurImage.rgb));\n    inputLumo = sigmoid(inputLumo,0.75,0.85);\n    vec3 screenImage = screenBlend(inputLumo.rgb, inputImage.rgb);\n    vec3 screenImage2 = screenBlend(inputLumo.rgb, blurImage.rgb);\n\n    screenImage = textureImage.rgb * screenImage;\n    screenImage2 = textureImage.rgb * screenImage;\n\n    vec3 vignetteImage = vignette_0(screenImage,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n    vec3 vignetteImageBlur = vignette_0(screenImage2,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    inputImage.rgb = vec3(vignetteImage.b,vignetteImage.r,vignetteImageBlur.g)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",js="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(blurImage.rgb));\n    inputLumo = sigmoid(inputLumo,0.75,0.85);\n    vec3 screenImage = screenBlend(inputLumo.rgb, inputImage.rgb);\n    vec3 screenImage2 = screenBlend(inputLumo.rgb, blurImage.rgb);\n\n    screenImage = textureImage.rgb * screenImage;\n    screenImage2 = textureImage.rgb * screenImage;\n\n    vec3 vignetteImage = vignette_0(screenImage,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n    vec3 vignetteImageBlur = vignette_0(screenImage2,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    inputImage.rgb = vec3(vignetteImage.r,vignetteImage.b,vignetteImageBlur.g)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Ws="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(blurImage.rgb));\n    inputLumo = sigmoid(inputLumo,0.75,0.85);\n    vec3 screenImage = screenBlend(inputLumo.rgb, inputImage.rgb);\n\n    vec3 screenImage2 = screenBlend(inputLumo.rgb, blurImage.rgb);\n\n    vec3 vignetteImage = vignette_0(screenImage,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n    vec3 vignetteImageBlur = vignette_0(screenImage2,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    inputImage.rgb = vec3(vignetteImage.r,vignetteImage.r,vignetteImageBlur.g)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Ys="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 vignette_0(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float brightness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        inpImage *= mix(vignette,1.0,brightness);\n\n       return inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(inputImage.rgb));\n    vec3 blurLumo = vec3(getLumo(blurImage.rgb));\n\n    inputLumo = BContrastLeg(inputLumo,1.0,1.5);\n    blurLumo = BContrastLeg(blurLumo,1.0,1.5);\n\n  //  vec3 screenImage = screenBlend(blurImage.rgb, inputImage.rgb);\n    vec3 vignetteImage = vignette_0(inputLumo,vTextureCoord,realWidth,realHeight,vignette_amount,0.3);\n    vec3 vignetteImage2 = vignette_0(blurLumo,vTextureCoord,realWidth,realHeight,vignette_amount,0.3);\n\n    vec3 blendBd = vec3(vignetteImage2.r,vignetteImage.r,vignetteImage2.r);\n\n    inputImage.rgb = blendBd*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n";var qs="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec4 fisheye(sampler2D sourceImage, vec2 vTextureCoord, vec4 filterArea, vec2 centerPoint, vec2 resolutionPoint, float radius){\n\n    float PI = 3.14159265258979;\n\n    vec2 coord = mapCoord(vTextureCoord,filterArea);\n\n    vec2 center = vec2(resolutionPoint.x*centerPoint.x,resolutionPoint.y*centerPoint.y);\n    float aspectRatio = resolutionPoint.x;\n    vec2 target ;\n\n    vec2 vector  = coord - center;\n    float distance = length(vector) ;\n\n    if ( distance < aspectRatio ){\n        vec2 maximum = center + ( vector / radius ) ;\n        float ratio     = distance / aspectRatio;\n        float trigRatio = ( cos( ratio * PI) + 1.0 ) / 2.0 ;\n        target = maximum * ( trigRatio ) + coord * ( 1.0 - trigRatio ) ;\n    }\n    else {\n        target = coord;\n    }\n\n    coord = unmapCoord(target,filterArea);\n    return texture2D(sourceImage, coord);\n}\n\nvec3 vignetteSoft(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float softness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        inpImage *= vignette;\n\n        return inpImage;\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nuniform sampler2D uSampler;\nuniform sampler2D iChanel1;\nuniform float vignette_amount;\nuniform float fisheye_amount;\n\nvarying vec2 vTextureCoord;\nuniform float resolutionX;\nuniform float resolutionY;\nuniform vec4 filterArea;\nuniform vec2 centerPoint;\nuniform float realWidth;\nuniform float realHeight;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 textureImage = texture2D(iChanel1, vTextureCoord * vec2(clampX,clampY));\n    vec4 inputImage = fisheye(uSampler, vTextureCoord, filterArea, centerPoint, vec2(resolutionX, resolutionY), fisheye_amount);\n    vec3 vignetteImage = vignetteSoft(inputImage.rgb,vTextureCoord,realWidth,realHeight,vignette_amount,0.60);\n    inputImage.rgb = hardLightBlend(vignetteImage, textureImage.rgb);\n    gl_FragColor = inputImage;\n}\n\n",Ks="#define GLSLIFY 1\n",Qs="#define GLSLIFY 1\n",Zs="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec4 fisheye(sampler2D sourceImage, vec2 vTextureCoord, vec4 filterArea, vec2 centerPoint, vec2 resolutionPoint, float radius){\n\n    float PI = 3.14159265258979;\n\n    vec2 coord = mapCoord(vTextureCoord,filterArea);\n\n    vec2 center = vec2(resolutionPoint.x*centerPoint.x,resolutionPoint.y*centerPoint.y);\n    float aspectRatio = resolutionPoint.x;\n    vec2 target ;\n\n    vec2 vector  = coord - center;\n    float distance = length(vector) ;\n\n    if ( distance < aspectRatio ){\n        vec2 maximum = center + ( vector / radius ) ;\n        float ratio     = distance / aspectRatio;\n        float trigRatio = ( cos( ratio * PI) + 1.0 ) / 2.0 ;\n        target = maximum * ( trigRatio ) + coord * ( 1.0 - trigRatio ) ;\n    }\n    else {\n        target = coord;\n    }\n\n    coord = unmapCoord(target,filterArea);\n    return texture2D(sourceImage, coord);\n}\n\nvec3 vignetteSoft(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float softness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        inpImage *= vignette;\n\n        return inpImage;\n\n}\n\nuniform sampler2D uSampler;\nuniform float vignette_amount;\nuniform float fisheye_amount;\n\nvarying vec2 vTextureCoord;\nuniform float resolutionX;\nuniform float resolutionY;\nuniform vec4 filterArea;\nuniform vec2 centerPoint;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n\n    vec4 inputImage = fisheye(uSampler, vTextureCoord, filterArea, centerPoint, vec2(resolutionX, resolutionY), fisheye_amount);\n    inputImage.rgb = vignetteSoft(inputImage.rgb,vTextureCoord,realWidth,realHeight,vignette_amount,0.60);\n\n    gl_FragColor = inputImage;\n}\n",Js="#define GLSLIFY 1\n";var $s="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float softness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        inpImage *= vignette;\n\n        return inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_2(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_0(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 color1) {\n\n    return setlum(color1, getLumo_1(inpImage));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 curves(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX) {\n\n    float pixelCoord = 255.0/fArea.x;\n    inpImage.r = texture2D(gradSampler, vec2(inpImage.r*pixelCoord*clampXX, 0.0)).r;\n    inpImage.g = texture2D(gradSampler, vec2(inpImage.g*pixelCoord*clampXX, 0.0)).g;\n    inpImage.b = texture2D(gradSampler, vec2(inpImage.b*pixelCoord*clampXX, 0.0)).b;\n    return inpImage;\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend_0(contrastAm,brightImage);\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D gradientSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n  //  vec4 gradientImage = texture2D(gradientSampler, vTextureCoord / vec2(clampX,clampY));\n  //  vec4 imageInp = texture2D(uSampler, vTextureCoord);\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    vec3 curvesImage = curves(BContrast(inputOffset.rgb,0.9,0.0),gradientSampler,filterArea,clampX);\n    vec3 tintImage = tint(inputOffset.rgb,vec3(0.99, 1.0, 0.0));\n    vec3 softBlend = curvesImage*tintImage;\n    inputOffset.rgb = mix(curvesImage,softBlend,0.2);\n\n    vec3 overlayImage = overlayBlend_1(vec3(0.0, 0.55, 0.38),inputOffset.rgb);\n    inputOffset.rgb = mix(inputOffset.rgb,overlayImage,0.7);\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",el="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float softness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        inpImage *= vignette;\n\n        return inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_3(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_3(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 color1) {\n\n    return setlum(color1, getLumo_1(inpImage));\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo_0(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = BContrast(inputOffset.rgb,1.0,1.3);\n    vec3 tintImage = inputOffset.rgb*vec3(1.0, 0.96, 0.38);\n    inputOffset.rgb = mix(inputOffset.rgb,tintImage,0.8);\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",tl="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float softness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        inpImage *= vignette;\n\n        return inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 textureOffset = offsetPixel(textureSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = textureOffset.rgb*inputOffset.rgb;\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",il="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float softness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        inpImage *= vignette;\n\n        return inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 textureOffset = offsetPixel(textureSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = textureOffset.rgb*inputOffset.rgb;\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",rl="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float softness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        inpImage *= vignette;\n\n        return inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 textureOffset = offsetPixel(textureSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = textureOffset.rgb*inputOffset.rgb;\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",al="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 inpImage, vec2 coord,float realWidth, float realHeight, float amount,float softness)\n{\n        vec2 position = coord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        inpImage *= vignette;\n\n        return inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 textureOffset = offsetPixel(textureSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = textureOffset.rgb*inputOffset.rgb;\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n";var nl="#define GLSLIFY 1\nvec3 curves(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX) {\n\n    float pixelCoord = 255.0/fArea.x;\n    inpImage.r = texture2D(gradSampler, vec2(inpImage.r*pixelCoord*clampXX, 0.0)).r;\n    inpImage.g = texture2D(gradSampler, vec2(inpImage.g*pixelCoord*clampXX, 0.0)).g;\n    inpImage.b = texture2D(gradSampler, vec2(inpImage.b*pixelCoord*clampXX, 0.0)).b;\n    return inpImage;\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, contrast);//\n     return overlayBlend(contrastAm,brightImage);\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_2(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_0(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 color1) {\n\n    return setlum(color1, getLumo_1(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D curvesSampler;\nuniform vec3 color;\nuniform float contrast;\nuniform float intensity;\n\nuniform float clampX;\n\nuniform vec4 filterArea;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 curvesImage = texture2D(curvesSampler, vTextureCoord);\n\n    vec3 curvesOutput = curves(BContrast(inputImage.rgb,1.0,contrast/100.0),curvesSampler,filterArea,clampX);\n    vec3 tintImage = tint(inputImage.rgb,color);\n    vec3 softBlend = curvesOutput*tintImage;\n    inputImage.rgb = mix(curvesOutput,softBlend,intensity)*inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n";var ol="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   vec3 ycbcr = inputImage.rgb * mat3(0.299, 0.587, 0.114, -0.168736, -0.331264, 0.5, 0.5, -0.418688, -0.081312) + vec3(0.0, 0.5, 0.5);\n\n   if ((ycbcr.r >= 80.0/255.0) && (ycbcr.g >= 0.33) && (ycbcr.g <= 0.529) && (ycbcr.b >= 0.529) && (ycbcr.b <= 0.705)){\n       inputImage.rgb = inputImage.rgb;\n   }else{\n       inputImage.a = 0.0;\n   }\n\n   gl_FragColor = inputImage;\n\n}\n";var sl="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 highpass(vec3 orgInput, vec3 blurInput) {\n    return (orgInput.rgb/2.0-blurInput.rgb/2.0)+0.5;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D blurSampler2;\nuniform float clampX;\nuniform float clampY;\nuniform float strength;\n\nvec3 linearLightBlend (vec3 front, vec3 back, float opacity){\n    return clamp((2.0 * front + back - 1.0) * opacity + back * (1.0 - opacity),0.0,1.0);\n}\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage2 = texture2D(blurSampler2, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 highPassImage = highpass(inputImage.rgb,blurImage2.rgb);\n\n    vec3 skinDetails = vec3(getLumo(highPassImage));\n\n    highPassImage = linearLightBlend(skinDetails,blurImage.rgb,0.75);\n\n    highPassImage = mix(inputImage.rgb,highPassImage,strength);\n    gl_FragColor = vec4(highPassImage,inputImage.a);\n\n}\n",ll="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 teethEyeWhiten(vec3 orgInput, vec3 blurInput) {\n\n    vec3 subtractImage = clamp(orgInput-blurInput,0.0,1.0);\n    return clamp(orgInput+subtractImage,0.0,1.0);\n}\n\n/*\n\t\t\tvar orginalBD:BitmapData = bmdIn.clone();\n\t\t\tvar blurData:BitmapData = bmdIn.clone();\n\t\t\tvar subtractData:BitmapData = bmdIn.clone();\n\n\t\t\t// First Layer blurred-original\n\t\t\tvar filter:BlurFilter = new BlurFilter(bmdIn.width/25,bmdIn.width/25,2);\n\t\t\tblurData.applyFilter(blurData,blurData.rect,new Point(0,0),filter as BitmapFilter);\n\n\t\t\tsubtractData.draw(blurData,null,null,BlendMode.SUBTRACT,null,true);\n\t\t\torginalBD.draw(subtractData,null,null,BlendMode.ADD,null,true);\n\n*/\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform float clampX;\nuniform float clampY;\n\nvec3 eyeTeethMask(vec3 inpImg) {\n\n      vec3 intermediateColour = 1.0 - inpImg;\n      float k     = min(min(intermediateColour.r, intermediateColour.g), intermediateColour.b);\n      float k2    = 1.0 / (1.0 - k);\n      float cmy;\n      cmy = (intermediateColour.g - k) * k2;\n      cmy = float(1.0-cmy);\n      cmy = smoothstep(0.5,1.0,cmy);\n      return vec3(cmy);\n\n}\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 maskImage = eyeTeethMask(inputImage.rgb);\n\n    vec3 lumoImage = vec3(getLumo(inputImage.rgb));\n    lumoImage = lightenBlend(inputImage.rgb,lumoImage);\n\n    vec3 unsharpedImage = teethEyeWhiten(lumoImage,blurImg.rgb);\n    inputImage.rgb = mix(inputImage.rgb,unsharpedImage,maskImage);\n\n    gl_FragColor = inputImage;\n\n}\n",hl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    float strength = 2.0; //is not used in UI, betweeen 1-5 this is parameter\n\n    float reddish = inputImage.r-((inputImage.g+inputImage.b)/strength);\n    float Lum = 0.25*inputImage.r+0.6*inputImage.g+0.15*inputImage.b;\n    float RedLum = max(0.0,((2.0*reddish)-Lum));\n\n    if(RedLum<=0.05) {RedLum = 0.0;}\n\n    inputImage.r = inputImage.r - RedLum * (inputImage.r - min(inputImage.g,inputImage.b));\n\n    gl_FragColor = inputImage;\n\n}\n",cl="#define GLSLIFY 1\nvec3 curves(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX) {\n\n    float pixelCoord = 255.0/fArea.x;\n    inpImage.r = texture2D(gradSampler, vec2(inpImage.r*pixelCoord*clampXX, 0.0)).r;\n    inpImage.g = texture2D(gradSampler, vec2(inpImage.g*pixelCoord*clampXX, 0.0)).g;\n    inpImage.b = texture2D(gradSampler, vec2(inpImage.b*pixelCoord*clampXX, 0.0)).b;\n    return inpImage;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D curvesSampler;\n\nuniform float clampX;\nuniform vec4 filterArea;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 desatBD = vec3(getLumo(inputImage.rgb));\n\n    vec3 coloredBD = mix(desatBD,color_palette,0.5);\n\n    vec3 curvesOutput = curves(desatBD,curvesSampler,filterArea,clampX);\n\n    coloredBD = screenBlend(curvesOutput,coloredBD);\n\n    inputImage.rgb = mix(inputImage.rgb,coloredBD,strength);\n\n    gl_FragColor = inputImage;\n\n}\n",ul="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 teethEyeWhiten(vec3 orgInput, vec3 blurInput) {\n\n    vec3 subtractImage = clamp(orgInput-blurInput,0.0,1.0);\n    return clamp(orgInput+subtractImage,0.0,1.0);\n}\n\n/*\n\t\t\tvar orginalBD:BitmapData = bmdIn.clone();\n\t\t\tvar blurData:BitmapData = bmdIn.clone();\n\t\t\tvar subtractData:BitmapData = bmdIn.clone();\n\n\t\t\t// First Layer blurred-original\n\t\t\tvar filter:BlurFilter = new BlurFilter(bmdIn.width/25,bmdIn.width/25,2);\n\t\t\tblurData.applyFilter(blurData,blurData.rect,new Point(0,0),filter as BitmapFilter);\n\n\t\t\tsubtractData.draw(blurData,null,null,BlendMode.SUBTRACT,null,true);\n\t\t\torginalBD.draw(subtractData,null,null,BlendMode.ADD,null,true);\n\n*/\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform float clampX;\nuniform float clampY;\n\nvec3 eyeTeethMask(vec3 inpImg) {\n\n      vec3 intermediateColour = 1.0 - inpImg;\n      float k     = min(min(intermediateColour.r, intermediateColour.g), intermediateColour.b);\n      float k2    = 1.0 / (1.0 - k);\n      float cmy;\n      cmy = (intermediateColour.g - k) * k2;\n      cmy = float(1.0-cmy);\n      cmy = smoothstep(0.5,1.0,cmy);\n      return vec3(cmy);\n\n}\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 maskImage = eyeTeethMask(inputImage.rgb);\n\n    vec3 lumoImage = vec3(getLumo(inputImage.rgb));\n    lumoImage = lightenBlend(inputImage.rgb,lumoImage);\n\n    vec3 unsharpedImage = teethEyeWhiten(lumoImage,blurImg.rgb);\n    inputImage.rgb = mix(inputImage.rgb,unsharpedImage,maskImage);\n\n    gl_FragColor = inputImage;\n\n}\n",dl="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 color1) {\n\n    return setlum(color1, getLumo_0(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 tintImage = tint(inputImage.rgb,color_palette);\n    inputImage.rgb = mix(inputImage.rgb,tintImage,strength);\n\n    gl_FragColor = inputImage;\n\n}\n",ml="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 overlayB = overlayBlend(color_palette,inputImage.rgb);\n    overlayB = mix(inputImage.rgb,overlayB,0.5);\n    inputImage.rgb = mix(inputImage.rgb,overlayB,strength);\n\n    gl_FragColor = inputImage;\n\n}\n",pl="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 lumoImage = vec3(getLumo(inputImage.rgb));\n    lumoImage = overlayBlend(color_palette,lumoImage);\n\n    inputImage.rgb = mix(inputImage.rgb,lumoImage,strength);\n\n    gl_FragColor = inputImage;\n\n}\n",gl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform float clampX;\nuniform float clampY;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 blurSub = clamp(blurImg.rgb - inputImage.rgb,0.0,1.0);\n    blurSub = clamp(inputImage.rgb - blurSub,0.0,1.0);\n    inputImage.rgb = mix(inputImage.rgb,blurSub,strength);\n    gl_FragColor = inputImage;\n\n}\n",fl="#define GLSLIFY 1\nvec3 skinMask(vec3 inputColor, vec3 targetColor, float accuracy) {\n\n    mat3 ycColor = mat3(0.299, 0.587, 0.114, -0.168736, -0.331264, 0.5, 0.5, -0.418688, -0.081312);\n    vec3 ycbcrInput = inputColor * ycColor + vec3(0.0, 0.5, 0.5);\n    vec3 ycbcrAvg = targetColor * ycColor + vec3(0.0, 0.5, 0.5);\n\n    vec3 rgbDelta = ycbcrInput - ycbcrAvg;\n\n    float colDistance = 1.0-sqrt(rgbDelta.r*rgbDelta.r/20.0 + rgbDelta.g * rgbDelta.g + rgbDelta.b * rgbDelta.b);\n    vec3 result;\n    result = vec3(smoothstep(accuracy,1.0,colDistance));\n    return vec3(result);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec3 averageColor;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 original = inputImage;\n    float nonSkin  = skinMask(inputImage.rgb,averageColor,0.40).r;\n    vec3 aa =  inputImage.rgb*(1.0-nonSkin)+nonSkin * averageColor.rgb;\n    inputImage.rgb = min(aa.rgb, inputImage.rgb);\n    inputImage = mix(original, inputImage, strength);\n\n    gl_FragColor = inputImage;//vec4(vec3(nonSkin),1.0);\n}\n",vl="#define GLSLIFY 1\nvec3 skinMask(vec3 inputColor, vec3 targetColor, float accuracy) {\n\n    mat3 ycColor = mat3(0.299, 0.587, 0.114, -0.168736, -0.331264, 0.5, 0.5, -0.418688, -0.081312);\n    vec3 ycbcrInput = inputColor * ycColor + vec3(0.0, 0.5, 0.5);\n    vec3 ycbcrAvg = targetColor * ycColor + vec3(0.0, 0.5, 0.5);\n\n    vec3 rgbDelta = ycbcrInput - ycbcrAvg;\n\n    float colDistance = 1.0-sqrt(rgbDelta.r*rgbDelta.r/20.0 + rgbDelta.g * rgbDelta.g + rgbDelta.b * rgbDelta.b);\n    vec3 result;\n    result = vec3(smoothstep(accuracy,1.0,colDistance));\n    return vec3(result);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec3 averageColor;\nuniform vec3 color_palette;\nuniform float strength; //betweeen 0-1 this is parameter\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec3 blushImage = mix(inputImage.rgb,color_palette,strength*0.72);\n    vec3 maskImage  = skinMask(inputImage.rgb,averageColor,0.85);\n\n    inputImage.rgb = mix(inputImage.rgb,blushImage,maskImage);\n\n    gl_FragColor = inputImage;\n\n}\n",yl="#define GLSLIFY 1\nvec3 skinMask(vec3 inputColor, vec3 targetColor, float accuracy) {\n\n    mat3 ycColor = mat3(0.299, 0.587, 0.114, -0.168736, -0.331264, 0.5, 0.5, -0.418688, -0.081312);\n    vec3 ycbcrInput = inputColor * ycColor + vec3(0.0, 0.5, 0.5);\n    vec3 ycbcrAvg = targetColor * ycColor + vec3(0.0, 0.5, 0.5);\n\n    vec3 rgbDelta = ycbcrInput - ycbcrAvg;\n\n    float colDistance = 1.0-sqrt(rgbDelta.r*rgbDelta.r/20.0 + rgbDelta.g * rgbDelta.g + rgbDelta.b * rgbDelta.b);\n    vec3 result;\n    result = vec3(smoothstep(accuracy,1.0,colDistance));\n    return vec3(result);\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 averageColor;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec3 bronzeImage = overlayBlend(inputImage.rgb,color_palette);\n    bronzeImage = mix(inputImage.rgb,bronzeImage,strength*0.72);\n\n    vec3 maskImage  = skinMask(inputImage.rgb,averageColor,0.85);\n\n    inputImage.rgb = mix(inputImage.rgb,bronzeImage,maskImage);\n\n    gl_FragColor = inputImage;\n\n}\n",xl="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 diffImg = abs(inputImage.rgb-blurImage.rgb);\n\n    float maskB = clamp(dot(diffImg, vec3(0.3086, 0.6094, 0.0820)),0.0,1.0);\n    maskB = smoothstep(0.0,strength,maskB);\n    diffImg = mix(blurImage.rgb,inputImage.rgb,maskB);\n    inputImage.rgb = diffImg;\n\n    gl_FragColor = inputImage;\n\n}\n";var _l="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main()\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    inputImage.rgb /= inputImage.a;\n    gl_FragColor = inputImage;\n\n}\n";var Il="#define GLSLIFY 1 \n//colorOffset in between -0.4 - 0.4 (100.0/255.0)\nvec3 colorMixer(vec3 inpImage, vec3 colorOffset, float bw)\n{\n    inpImage.r = clamp(inpImage.r+colorOffset.r,0.0,1.0);\n    inpImage.g = clamp(inpImage.g+colorOffset.g,0.0,1.0);\n    inpImage.b = clamp(inpImage.b+colorOffset.b,0.0,1.0);\n\n    if(bw==1.0) {\n    \tinpImage = vec3(dot(inpImage, vec3(0.299, 0.587, 0.114)));\n    }\n\n    return inpImage;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float red;\nuniform float green;\nuniform float blue;\nuniform float bw;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    inputImage.rgb = colorMixer(inputImage.rgb,vec3(red,green,blue),bw);\n\n    inputImage.rgb *= inputImage.a;\n\n\tgl_FragColor = inputImage;\n}\n";var Tl="#define GLSLIFY 1\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float lightness;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 screenImage = screenBlend(bImage.rgb,bImage.rgb);\n    vec3 screenImage2 = screenBlend(inputImage.rgb,inputImage.rgb);\n    screenImage = clamp(screenImage*screenImage2,0.0,1.0);\n    vec3 darkenImage = darkenBlend(inputImage.rgb,screenImage);\n    inputImage.rgb = mix(screenImage,darkenImage,1.0-lightness);\n\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n\n";var bl="#define GLSLIFY 1\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 subtractScalar = (inputImage.rgb+0.5) - bImage.rgb;\n\n    subtractScalar = overlayBlend(1.0 - subtractScalar,inputImage.rgb);\n    inputImage.rgb = mix(inputImage.rgb,subtractScalar,amount);\n\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n\n";var Sl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float size;\nuniform float shift_horizontal;\nuniform float shift_vertical;\nuniform float clampX;\nuniform float clampY;\n\nvec3 blurBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount, vec2 slideXY)\n{\n    vec2 uv = (coord*cXcY)-vec2(slideXY);;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvoid main(void)\n{\n    size;shift_horizontal;shift_vertical;\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 mask = blurBorderMask(vec3(0.0),vTextureCoord,vec2(clampX,clampY),size,vec2(shift_horizontal,shift_vertical));\n    inputImage.rgb = mix(inputImage.rgb,bImage.rgb,mask);\n\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n\n";var Cl="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 rgb2hsv(vec3 c)\n{\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform vec3 averageColor;\nuniform float clampX;\nuniform float clampY;\n\nvec3 hsvGammaDark(vec3 inputRGB, vec3 blurImage, float gammaInput) {\n\n    vec3 hsv = rgb2hsv(inputRGB);\n    float rxy = (hsv.z*2.0)/(hsv.z+0.4);\n    hsv.z = hsv.z + gammaInput*pow(abs(1.0-(blurImage.z*1.4)),1.5)*(rxy-hsv.z);\n    return hsv2rgb(hsv);\n\n}\nvec3 hsvGammaLight(vec3 inputRGB, vec3 blurImage, float gammaInput) {\n\n    vec3 hsv = rgb2hsv(inputRGB);\n    hsv.z = pow(hsv.z,gammaInput);\n    return hsv2rgb(hsv);\n\n}\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurSampler, vTextureCoord * vec2(clampX, clampY));\n\n    vec3 maskThreshold = smoothThreshold(vec3(inputImage.rgb),averageColor.r,1.0);\n    vec3 result;\n    if(averageColor.r<0.5) {\n        float inputGamma = min(1.0, ((0.5 - averageColor.r) * 2.5));\n        result = hsvGammaDark(inputImage.rgb,bImage.rgb,inputGamma);\n    }\n    else {\n         float inputGamma = (log(0.5) / log(averageColor.r));\n         result = hsvGammaLight(inputImage.rgb,bImage.rgb,inputGamma);\n    }\n\n    inputImage.rgb = mix(result,inputImage.rgb,maskThreshold.r);\n\n    gl_FragColor = inputImage;\n\n}\n";var Bl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec3 color;\nuniform float intensity;\nuniform float alpha;\nuniform vec4 filterClamp;\n\nuniform float ignoreTransparency;\nuniform float binaryTransparency;\n\n void main() {\n\n    vec4 pixelColor = texture2D(uSampler, clamp(vTextureCoord,filterClamp.xy, filterClamp.zw));\n\n    if (ignoreTransparency == 1.0){\n\n        if (pixelColor.a == 0.0) {\n            gl_FragColor = vec4((color * intensity * alpha), (intensity * alpha));\n            return;\n        }\n\n        pixelColor.rgb /= pixelColor.a;\n\n        float pixelAlpha = pixelColor.a;\n\n        pixelColor.rgb = mix(pixelColor.rgb, color.rgb, (1.0 - pixelColor.a));\n        pixelColor.a = 1.0;\n\n        pixelColor.rgb = mix(pixelColor.rgb, color.rgb, intensity);\n        pixelColor.a = mix(pixelAlpha, 1.0, intensity);\n\n        pixelColor.rgb *= pixelColor.a;\n\n    }else{\n\n        //RETURN IF ALPHA 0\n        if (pixelColor.a == 0.0) {\n            gl_FragColor = vec4(0, 0, 0, 0);\n            return;\n        }\n\n        //UN-PREMULTIPLY ALPHA\n        pixelColor.rgb /= pixelColor.a;\n\n        if (binaryTransparency == 1.0){\n            pixelColor.a = 1.0;\n        }\n\n        //CROSSFADE COLORS\n        float intensityInverse = (1.0 - intensity);\n\n        pixelColor.r = clamp(((pixelColor.r * intensityInverse) + (color.r * intensity)), 0.0, 1.0);\n        pixelColor.g = clamp(((pixelColor.g * intensityInverse) + (color.g * intensity)), 0.0, 1.0);\n        pixelColor.b = clamp(((pixelColor.b * intensityInverse) + (color.b * intensity)), 0.0, 1.0);\n\n        //RE-PREMULTIPLY ALPHA\n        pixelColor.rgb *= pixelColor.a;\n\n    }\n\n    // SET ALPHA\n    pixelColor.rgba *= alpha;\n\n    gl_FragColor = pixelColor;\n\n }\n";var Fl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float redOffset;\nuniform float greenOffset;\nuniform float blueOffset;\n\n void main() {\n\n    lowp vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    //UN-PREMULTIPLY ALPHA\n    pixelColor.rgb /= pixelColor.a;\n\n    //OFFSET COLOR CHANNELS\n    pixelColor.r = clamp((pixelColor.r + redOffset), 0.0, 1.0);\n    pixelColor.g = clamp((pixelColor.g + greenOffset), 0.0, 1.0);\n    pixelColor.b = clamp((pixelColor.b + blueOffset), 0.0, 1.0);\n\n    //RE-PREMULTIPLY ALPHA\n    pixelColor.rgb *= pixelColor.a;\n\n    gl_FragColor = pixelColor;\n\n }\n";var El="#define GLSLIFY 1\n/* Color Difference (Delta E) algorithm between 2 LAB colors. RGB colors should be converted to LAB*/\n/* It uses CIE94 standards https://en.wikipedia.org/wiki/Color_difference  */\nfloat DeltaE1994(vec3 lab1, vec3 lab2) {\n\n\tconst float K1 = 0.045;\n\tconst float K2 = 0.015;\n\tconst float WL = 1.0;\n\tconst float WC = 0.5; // adjusted weight to 0.5 from 1.0\n\tconst float WH = 0.5; // adjusted weight to 0.5 from 1.0\n\n\tfloat CH1 = sqrt(lab1.y * lab1.y + lab1.z * lab1.z);\n\tfloat CH2 = sqrt(lab2.y * lab2.y + lab2.z * lab2.z);\n\n\tfloat deltaA = lab1.y - lab2.y;\n\tfloat deltaB = lab1.z - lab2.z;\n\tfloat deltaC = CH1 - CH2;\n\tfloat deltaH2 = deltaA * deltaA + deltaB * deltaB - deltaC * deltaC;\n\tfloat deltaH = (deltaH2 > 0.0) ? sqrt(deltaH2) : 0.0;\n\tfloat deltaL = lab1.x - lab2.x;\n\n\tfloat sL = 1.0;\n\tfloat sC = 1.0 + K1 * CH1;\n\tfloat sH = 1.0 + K2 * CH1;\n\n\tfloat vL = deltaL / (WL * sL);\n\tfloat vC = deltaC / (WC * sC);\n\tfloat vH = deltaH / (WH * sH);\n\n\treturn sqrt(vL * vL + vC * vC + vH * vH);\n}\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 sourceColor;\nuniform vec3 targetColor;\nuniform float targetAlpha;\n\nuniform float tolerance; // between 0-1\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec4 targetResult = vec4(vec3(targetColor*targetAlpha), targetAlpha);\n\n    vec4 result = (inputImage.a == 0.0) ? targetResult : inputImage;\n\n    if (sourceColor.r != -1.0){\n\n       \t//Color to change - LAB\n       \tvec3 sourceColorHSV = rgb2lab(sourceColor);\n\n       \t//Target color - LAB\n       \tvec3 targetColorHSV = rgb2lab(targetColor);\n\n       \t//Input color - LAB\n        //vec4 inputImage = texture2D(uSampler, vTextureCoord);\n       \tvec3 inputImageHSV = rgb2lab(inputImage.rgb);\n\n       \tfloat deltaDist = DeltaE1994(inputImageHSV,sourceColorHSV);\n\n       \tdeltaDist = smoothstep(0.0,tolerance,deltaDist);\n\n       \tresult = (inputImage.a == 0.0) ? vec4(0.0) : mix(targetResult,inputImage,deltaDist);\n\n    }\n\n   \tgl_FragColor = result;\n   //\tgl_FragColor = vec4(vec3(deltaDist),1.0);\n\n}\n";var Pl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float mode;\nuniform float beta;\nuniform float pressure;\n\nuniform float vTextureCoordMax;\n\n void main() {\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    /*\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    */\n\n    //--\n\n    float centerCoord = (vTextureCoordMax / 2.0);\n\n    float dx = (centerCoord - vTextureCoord.x);\n    float dy = (centerCoord - vTextureCoord.y);\n    float dd = sqrt((dx * dx) + (dy * dy));\n\n    float factor = max(0.0, (1.0 - (dd / centerCoord)));\n\n    pressure;\n\n    float offsetStrength = (pressure * factor);\n\n    //--\n\n    float offsetG = 0.0;\n    float offsetB = 0.0;\n\n    if (mode == 0.0){ // SMUDGE\n\n        offsetStrength *= .1;\n\n        offsetG = -(cos(beta));\n        offsetB = -(sin(beta));\n\n    }else\n    if (mode == 1.0){ // GROW\n\n        offsetStrength *= 0.25;\n\n        offsetG = (((1.0 - (vTextureCoord.x / vTextureCoordMax)) * 2.0) - 1.0);\n        offsetB = (((1.0 - (vTextureCoord.y / vTextureCoordMax)) * 2.0) - 1.0);\n\n    }else\n    if (mode == 2.0){ // SHRINK\n\n        offsetStrength *= 0.25;\n\n        offsetG = (((vTextureCoord.x / vTextureCoordMax) * 2.0) - 1.0);\n        offsetB = (((vTextureCoord.y / vTextureCoordMax) * 2.0) - 1.0);\n\n    }else\n    if (mode == 3.0){ // ERASE\n\n        offsetStrength *= 0.25;\n\n        offsetG = (0.5 - pixelColor.g);\n        offsetB = (0.5 - pixelColor.b);\n\n    }\n\n    //--\n\n    if (mode != 3.0){ // NOT ERASING\n\n        float goalG = clamp((pixelColor.g + offsetG), 0.0, 1.0);\n        float goalB = clamp((pixelColor.b + offsetB), 0.0, 1.0);\n\n        float deltaG = abs(goalG - pixelColor.g);\n        float deltaB = abs(goalB - pixelColor.b);\n\n        offsetG *= deltaG;\n        offsetB *= deltaB;\n\n    }\n\n    offsetG *= offsetStrength;\n    offsetB *= offsetStrength;\n\n    //OFFSET COLOR CHANNELS\n    pixelColor.g = clamp((pixelColor.g + offsetG), 0.0, 1.0);\n    pixelColor.b = clamp((pixelColor.b + offsetB), 0.0, 1.0);\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n }\n";var Nl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float strength;\n\nuniform float maxDisplacementX;\nuniform float maxDisplacementY;\n\nuniform float vTextureCoordMinX;\nuniform float vTextureCoordMinY;\n\nuniform float vTextureCoordMaxX;\nuniform float vTextureCoordMaxY;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n\n    vec2 displaceCoord = vec2(((vTextureCoord.x / vTextureCoordMaxX) + vTextureCoordMinX), ((vTextureCoord.y / vTextureCoordMaxY) + vTextureCoordMinY));\n    vec4 displaceColor = texture2D(iChannel1, displaceCoord);\n\n    //--\n\n    float offsetFactorX = (((displaceColor.g - 0.5) * 2.0) * strength);\n    float offsetFactorY = (((displaceColor.b - 0.5) * 2.0) * strength);\n\n    float offsetX = (maxDisplacementX * offsetFactorX);\n    float offsetY = (maxDisplacementY * offsetFactorY);\n\n    vec2 onePixel = 2.0/filterArea.xy;\n\n    vec2 srcCoord = clamp(vec2(vTextureCoord.x + offsetX,vTextureCoord.y + offsetY),onePixel,vec2(vTextureCoordMaxX,vTextureCoordMaxY)*(1.0-onePixel));//vec2(clamp((vTextureCoord.x + offsetX), 0.0025, (vTextureCoordMaxX * 0.9975)), clamp((vTextureCoord.y + offsetY), 0.0025, (vTextureCoordMaxY * 0.9975)));\n\n    vec4 srcColor = texture2D(uSampler, srcCoord);\n\n    gl_FragColor = srcColor;\n\n    // gl_FragColor = displaceColor;\n\n}\n\n";var Ml="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float mode;\nuniform vec3 color;\n\nfloat getBrightness (vec3 rgb){\n    return sqrt((rgb.r * rgb.r * 0.241) + (rgb.g * rgb.g * 0.691) + (rgb.b * rgb.b * 0.068));\n}\n\n void main() {\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    float colorBrightness = getBrightness(vec3(color.r, color.g, color.b));\n\n    float pixelBrightness = getBrightness(vec3(pixelColor.r, pixelColor.g, pixelColor.b));\n\n    //--\n\n    if ((mode == 0.0 && pixelBrightness < colorBrightness) || (mode == 1.0 && pixelBrightness > colorBrightness)){ // REPLACE COLORS DARKER OR LIGHTER THAN COLOR WITH COLOR\n\n        pixelColor.r = color.r;\n        pixelColor.g = color.g;\n        pixelColor.b = color.b;\n\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n }\n";var Dl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float vTextureCoordMinX;\nuniform float vTextureCoordMinY;\n\nuniform float vTextureCoordMaxX;\nuniform float vTextureCoordMaxY;\n\nuniform float inverse;\n\nvoid main(void)\n{\n\n    vec2 alphaCoord = vec2(((vTextureCoord.x / vTextureCoordMaxX) + vTextureCoordMinX), ((vTextureCoord.y / vTextureCoordMaxY) + vTextureCoordMinY));\n    vec4 alphaColor = texture2D(iChannel1, alphaCoord);\n\n    //--\n\n    vec4 srcColor = texture2D(uSampler, vTextureCoord);\n\n    srcColor.rgb /= srcColor.a;\n\n    srcColor.a = (inverse == 1.0) ? ((1.0 - alphaColor.a) * srcColor.a) : (alphaColor.a * srcColor.a);\n\n    srcColor.rgb *= srcColor.a;\n\n    //--\n\n    gl_FragColor = srcColor;\n\n}\n\n";var wl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D blendTexture;\nuniform sampler2D maskTexture;\n\nuniform float vTextureCoordMaxX;\nuniform float vTextureCoordMaxY;\n\nuniform float inverse;\n\nuniform float unmaskedAlpha;\nuniform vec4 blendColor;\nuniform float blendIntensity;\n\nuniform float useBlendColor;\nuniform float useBlendTexture;\nuniform float useMaskTexture;\nuniform float useInputAlpha;\n\nvec4 overlapColors(vec4 backColor, vec4 frontColor) {\n    return vec4((backColor.rgb + (frontColor.rgb * (1.0 - backColor.a))), (backColor.a + (frontColor.a * (1.0 - backColor.a))));\n}\n\nvoid main(void) {\n\n    vec4 srcColor = texture2D(uSampler, vTextureCoord);\n    vec4 dstColor = srcColor;\n\n    if (useBlendColor == 1.0 || useBlendTexture == 1.0){\n\n        vec2 iTextureCoord = vec2((vTextureCoord.x / vTextureCoordMaxX), (vTextureCoord.y / vTextureCoordMaxY));\n\n        vec4 topColor = (mix(srcColor, ((useBlendColor == 1.0) ? blendColor : texture2D(blendTexture, iTextureCoord)), blendIntensity) * unmaskedAlpha);\n\n        if (useMaskTexture == 1.0){\n\n            vec4 maskColor = texture2D(maskTexture, iTextureCoord);\n            dstColor = mix(((useInputAlpha == 1.0) ? overlapColors(srcColor, topColor) : srcColor), topColor, ((inverse == 1.0) ? maskColor.a : (1.0 - maskColor.a)));\n\n        }else{\n\n            dstColor = ((inverse == 1.0) ? ((useInputAlpha == 1.0) ? overlapColors(srcColor, topColor) : srcColor) : topColor);\n\n        }\n\n    }\n\n    gl_FragColor = dstColor;\n\n}\n\n";var kl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\n\nuniform int quality;\nuniform float intensity;\nuniform float size;\nuniform vec3 color;\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nconst float PI = 3.141592653589793;\nconst float PHI = 1.618033988749895; // ((1 + Math.sqrt(5)) / 2)\nconst float TAU = (PI * 2.0);\nconst float OMEGA = (TAU / PHI);\n\nconst int samplesX1 = 16;\nconst int samplesX2 = 32;\nconst int samplesX3 = 48;\nconst int samplesX4 = 64;\nconst int samplesX5 = 80;\nconst int samplesX6 = 96;\nconst int samplesX7 = 112;\nconst int samplesX8 = 128;\n\n//--\n\nfloat getInfluence(vec2 pixelCoord, int i, int samples, int denominator){\n\n    float factor = (float(i) / float(samples - 1));\n\n    float theta = (OMEGA * float(i));\n    float distance = (size * factor);\n\n    vec2 samplePixelCoord = vec2((pixelCoord.x + (cos(theta) * distance)), (pixelCoord.y + (sin(theta) * distance)));\n\n    vec4 samplePixelColor = texture2D(uSampler, clamp(unmapCoord(samplePixelCoord, filterArea), 0.0, 1.0));\n\n    float distanceInfluence = (float(samples - i) / float(denominator));\n    float influence = (distanceInfluence * samplePixelColor.a);\n\n    return influence;\n\n}\n\n//--\n\nfloat getInfluenceQ1(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX1; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX1; i++){\n        influence += getInfluence(pixelCoord, i, samplesX1, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ2(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX2; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX2; i++){\n        influence += getInfluence(pixelCoord, i, samplesX2, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ3(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX3; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX3; i++){\n        influence += getInfluence(pixelCoord, i, samplesX3, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ4(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX4; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX4; i++){\n        influence += getInfluence(pixelCoord, i, samplesX4, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ5(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX5; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX5; i++){\n        influence += getInfluence(pixelCoord, i, samplesX5, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ6(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX6; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX6; i++){\n        influence += getInfluence(pixelCoord, i, samplesX6, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ7(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX7; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX7; i++){\n        influence += getInfluence(pixelCoord, i, samplesX7, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ8(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX8; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX8; i++){\n        influence += getInfluence(pixelCoord, i, samplesX8, denominator);\n    }\n    return influence;\n}\n\n//--\n\nvoid main(void) {\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, clamp(unmapCoord(pixelCoord, filterArea), 0.0, 1.0));\n\n    //--\n\n    float influence = 0.0;\n\n    if (quality == 1){\n        influence = getInfluenceQ1(pixelCoord);\n    }else\n    if (quality == 2){\n        influence = getInfluenceQ2(pixelCoord);\n    }else\n    if (quality == 3){\n        influence = getInfluenceQ3(pixelCoord);\n    }else\n    if (quality == 4){\n        influence = getInfluenceQ4(pixelCoord);\n    }else\n    if (quality == 5){\n        influence = getInfluenceQ5(pixelCoord);\n    }else\n    if (quality == 6){\n        influence = getInfluenceQ6(pixelCoord);\n    }else\n    if (quality == 7){\n        influence = getInfluenceQ7(pixelCoord);\n    }else\n    if (quality == 8){\n        influence = getInfluenceQ8(pixelCoord);\n    }\n\n    influence = (clamp((influence * (0.5 + (intensity * 2.0))), 0.0, 1.0) * (1.0 - pixelColor.a));\n\n    //--\n\n    gl_FragColor = vec4(mix(pixelColor.rgb, color, influence), max(influence, pixelColor.a));\n\n}\n";var Ll="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float minInput;\nuniform float maxInput;\nuniform float saturation;\nuniform vec3 tint;\n\nvec3 gammaCorrection(vec3 color, float gamma) {\n\treturn pow(color, 1.0 / vec3(gamma));\n}\n\nvec3 levelsControlInputRange(vec3 color, float minInput, float maxInput) {\n\n  return min(max(color - minInput, 0.0) / (maxInput - minInput+0.0001), 1.0);\n\n}\n\nvec3 levelsControlInput(vec3 color, float minInput, float gamma, float maxInput) {\n\treturn gammaCorrection(levelsControlInputRange(color, minInput, maxInput), gamma);\n\n}\n\nvec3 levelsControlOutputRange(vec3 color, float minOutput, float maxOutput) {\n\treturn mix(vec3(minOutput), vec3(maxOutput), color);\n\n}\n\nvec3 levelsControl(vec3 color, float minInput, float gamma, float maxInput, float minOutput, float maxOutput) {\n\treturn levelsControlOutputRange(levelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput);\n}\n\nvec3 saturation_0(vec3 inpImg, float satAmount) {\n\n    //SATURATION ADJUST\n    float avg = (inpImg.r + inpImg.g + inpImg.b) / 3.0;\n    if (satAmount > 0.0) {\n     inpImg.rgb += (avg - inpImg.rgb) * (1.0 - 1.0 / (1.001 - satAmount/2.0));\n    } else {\n     inpImg.rgb += (avg - inpImg.rgb) * (-satAmount);\n    }\n    return inpImg;\n\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 result = levelsControl(inputImage.rgb,minInput,1.0,maxInput,0.0,1.0);\n\n    float sat = ((tint.r == -1.0) ? saturation : -1.0);\n\n    result = saturation_0(result, sat);\n\n    vec3 mult = ((tint.r == -1.0) ? vec3(1.0) : saturation_0(tint, saturation));\n\n    result *= mult;\n\n    gl_FragColor = vec4(result, inputImage.a);\n\n}\n";var Ol="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    float lumo = max(inputImage.r,max(inputImage.g,inputImage.b));\n\n    vec4 result = mix(vec4(0.0),inputImage,lumo);\n\n    gl_FragColor = result;\n\n}\n";var Rl="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform bool monochromatic;\nuniform int distribution;\nuniform float intensity;\nuniform float seed;\n\nconst float staticSeed = 0.546372819564738291;//0.123456789;\n\n//note: uniformly distributed, normalized rand, [0;1[\nfloat nrand( vec2 n ){\n\treturn fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\nfloat n1rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\treturn nrnd0;\n}\nfloat n2rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\tfloat nrnd1 = nrand( n + 0.11*t );\n\treturn (nrnd0+nrnd1) / 2.0;\n}\nfloat n3rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\tfloat nrnd1 = nrand( n + 0.11*t );\n\tfloat nrnd2 = nrand( n + 0.13*t );\n\treturn (nrnd0+nrnd1+nrnd2) / 3.0;\n}\nfloat n4rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\tfloat nrnd1 = nrand( n + 0.11*t );\n\tfloat nrnd2 = nrand( n + 0.13*t );\n\tfloat nrnd3 = nrand( n + 0.17*t );\n\treturn (nrnd0+nrnd1+nrnd2+nrnd3) / 4.0;\n}\n\nfloat n8rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\tfloat nrnd1 = nrand( n + 0.11*t );\n\tfloat nrnd2 = nrand( n + 0.13*t );\n\tfloat nrnd3 = nrand( n + 0.17*t );\n\n    float nrnd4 = nrand( n + 0.19*t );\n    float nrnd5 = nrand( n + 0.23*t );\n    float nrnd6 = nrand( n + 0.29*t );\n    float nrnd7 = nrand( n + 0.31*t );\n\n\treturn (nrnd0+nrnd1+nrnd2+nrnd3 +nrnd4+nrnd5+nrnd6+nrnd7) / 8.0;\n}\n\n//alternative Gaussian,\n//thanks to @self_shadow\n//see http://www.dspguide.com/ch2/6.htm\n//note: see also https://www.shadertoy.com/view/MlVSzw for version by @stubbe\nfloat n4rand_ss( vec2 n ){\n\n\tfloat nrnd0 = nrand( n + 0.07*fract( (seed / 100.0) + staticSeed ) );\n\tfloat nrnd1 = nrand( n + 0.11*fract( (seed / 100.0) + staticSeed + 0.573953 ) );\n\treturn 0.23*sqrt(-log(nrnd0+0.00001))*cos(2.0*3.141592*nrnd1)+0.5;\n}\n\nvec4 generateNoiseColor(vec2 fragCoord){\n\n\tfloat noiseLuminance;\n\tif (distribution == 1){\n\t\tnoiseLuminance = n1rand( fragCoord );\n\t}else\n\tif (distribution == 2){\n\t\tnoiseLuminance = n2rand( fragCoord );\n\t}else\n\tif (distribution == 3){\n\t\tnoiseLuminance = n4rand( fragCoord );\n\t}else\n\tif (distribution == 4){\n\t\tnoiseLuminance = n8rand( fragCoord );\n\t}else\n\tif (distribution == 5){\n\t\tnoiseLuminance = n4rand_ss( fragCoord );\n\t}\n\n\tfloat rand = nrand( fragCoord );\n\tfloat offsetRand = fract((seed * 0.166) + rand);\n\n\tfloat luminance = 0.8;\n\n\tvec3 noiseColor;\n\tif (monochromatic){\n\t\tnoiseColor = vec3(offsetRand);\n\t}else\n\tif (offsetRand < 0.166){\n\t\tnoiseColor = vec3(luminance,0.0,0.0); // RED\n\t}else\n\tif (offsetRand < 0.332){\n\t\tnoiseColor = vec3(luminance,luminance,0.0); // YELLOW\n\t}else\n\tif (offsetRand < 0.498){\n\t\t\tnoiseColor = vec3(0.0,luminance,0.0); // GREEN\n\t}else\n\tif (offsetRand < 0.664){\n\t\tnoiseColor = vec3(0.0,luminance,luminance); // CYAN\n\t}else\n\tif (offsetRand < 0.830){\n\t\tnoiseColor = vec3(0.0,0.0,luminance); // BLUE\n\t}else{\n\t\tnoiseColor = vec3(luminance,0.0,luminance); // FUSCHIA\n\t}\n\tnoiseColor = clamp((noiseColor * noiseLuminance * (1.0 + (((intensity * 0.25) + 0.75) * 2.0))), 0.0, 1.0);\n\n\treturn vec4(noiseColor, 1.0);\n\n}\n\nvoid main(void){\n\n\tvec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    pixelColor.rgb /= pixelColor.a;\n\n\tvec2 randCoord = vec2(mod((vTextureCoord.x + pixelColor.r + pixelColor.g), 1.0), mod((vTextureCoord.y + pixelColor.g + pixelColor.b), 1.0));\n\n\tvec4 noiseColor = generateNoiseColor(randCoord);//vTextureCoord);\n\n\tpixelColor.rgb = clamp(mix(pixelColor.rgb, noiseColor.rgb, intensity), 0.0, 1.0)*pixelColor.a;\n\n\tgl_FragColor = pixelColor;\n\n}\n";var Al="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform vec3 lineColor;\nuniform float opacity;\nuniform float spacing;\nuniform bool invert;\n\nvoid main(void){\n\n\tvec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    pixelColor.rgb /= pixelColor.a;\n\n\tfloat pixelY = floor(vTextureCoord.y * filterArea.y);\n\n    bool drawLine = (mod((floor(pixelY / spacing) + (invert ? 1.0 : 0.0)), 2.0) == 0.0);\n\n\tif (drawLine){\n\t    vec4 lColor = vec4(lineColor, 1.0);\n\t    pixelColor = mix(pixelColor, lColor, opacity);\n\t}\n\n\tgl_FragColor = vec4(pixelColor.rgb*pixelColor.a,pixelColor.a);\n\n}\n";var Vl="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform vec3 averageColor;\nuniform float pass;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\n\nvec2 mapCoord(vec2 scaleCoord){\n    return clamp(((scaleCoord / scaleDimensions) * pixelDimensions), vec2(0.0), (pixelDimensions - 1.0));\n}\n\nvec2 unmapCoord(vec2 pixelCoord){\n    return ((clamp(pixelCoord, vec2(0.0), (pixelDimensions - 1.0)) / pixelDimensions) * scaleDimensions);\n}\n\nvoid main(void){\n\n    float averageLumo = getLumo(averageColor);\n\n    vec2 pixelOffset = vec2(0.0, 1.0);\n\n    //--\n\n    vec2 pixelCoord = mapCoord(vTextureCoord);\n    vec4 pixelColor = texture2D(uSampler, unmapCoord(pixelCoord));\n    float pixelLumo = getLumo(pixelColor.rgb);\n\n    if (pass == 0.0){\n\n        if (pixelLumo > averageLumo){\n            pixelColor = vec4(1.0);\n        }else{\n            pixelColor = vec4(vec3(averageLumo), 1.0);\n        }\n\n    }else\n    if (pass == 2.0){\n\n        vec2 pixelCoordAbove = (pixelCoord - pixelOffset);\n        vec4 pixelColorAbove = texture2D(uSampler, unmapCoord(pixelCoordAbove));\n        float pixelLumoAbove = getLumo(pixelColorAbove.rgb);\n\n        vec2 pixelCoordBelow = (pixelCoord + pixelOffset);\n        vec4 pixelColorBelow = texture2D(uSampler, unmapCoord(pixelCoordBelow));\n        float pixelLumoBelow = getLumo(pixelColorBelow.rgb);\n\n        if (pixelLumoAbove == 1.0 && pixelLumoBelow == 1.0){\n            pixelColor.rgb = vec3(averageLumo);\n        }\n\n    }else{\n\n        vec2 pixelCoordBelow = (pixelCoord + pixelOffset);\n        vec4 pixelColorBelow = texture2D(uSampler, unmapCoord(pixelCoordBelow));\n        float pixelLumoBelow = getLumo(pixelColorBelow.rgb);\n\n        if (pixelLumoBelow > pixelLumo){\n            float degradeRate = (0.01 + (sin((pixelCoord.x / (pixelDimensions.x - 1.0)) * PIx2 * (pixelDimensions.x * PI)) * 0.005));\n            pixelLumo = clamp((pixelLumoBelow - degradeRate), averageLumo, 1.0);\n            pixelColor.rgb = vec3(pixelLumo);\n        }\n\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n";var Ul="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n\n    gl_FragColor = (vec4(1.0) - clamp(texture2D(uSampler, vTextureCoord), vec4(0.0), vec4(1.0)));\n\n}\n";var Gl="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform float spread;\nuniform float direction;\nuniform float blendAlpha;\nuniform float alphaChoke;\n\nconst float w0 = 0.22;\nconst float w1 = 0.18;\nconst float w2 = 0.13;\nconst float w3 = 0.08;\n\nvec2 mapCoord(vec2 scaleCoord){\n    return ((scaleCoord / scaleDimensions) * pixelDimensions);\n}\n\nvec2 unmapCoord(vec2 pixelCoord){\n    return ((pixelCoord / pixelDimensions) * scaleDimensions);\n}\n\nvec2 getOffsetPixelCoord(vec2 pixelCoord, float distanceFactor){\n\n    float distance = (spread * distanceFactor);\n\n    vec2 pixelOffset = vec2((cos(direction) * distance), (sin(direction) * distance));\n    vec2 offsetPixelCoord = (pixelCoord + pixelOffset);\n\n    //--\n\n    vec2 minCoord = vec2(0.0);\n    vec2 maxCoord = (pixelDimensions - vec2(1.0));\n\n    //--\n\n    float adjustFactor = 1.0;\n    adjustFactor = min(adjustFactor, (abs(pixelCoord.x - minCoord.x) / abs(pixelOffset.x)));\n    adjustFactor = min(adjustFactor, (abs(pixelCoord.x - maxCoord.x) / abs(pixelOffset.x)));\n    adjustFactor = min(adjustFactor, (abs(pixelCoord.y - minCoord.y) / abs(pixelOffset.y)));\n    adjustFactor = min(adjustFactor, (abs(pixelCoord.y - maxCoord.y) / abs(pixelOffset.y)));\n\n    //--\n\n    // distance *= adjustFactor; // EDGE PIXELS GET AMPLIFIED\n    distance = ((abs(distance * adjustFactor) - (abs(distance) - abs(distance * adjustFactor))) * (abs(distance) / distance)); // EDGE PIXELS GET REFLECTED\n\n    //--\n\n    pixelOffset = vec2((cos(direction) * distance), (sin(direction) * distance));\n    offsetPixelCoord = clamp((pixelCoord + pixelOffset), minCoord, maxCoord);\n\n    //--\n\n    return offsetPixelCoord;\n\n}\n\nvoid main(void){\n\n    vec2 pixelCoordCC = mapCoord(vTextureCoord);\n\n    vec4 pixelColorCC = (texture2D(uSampler, unmapCoord(pixelCoordCC)) * w0);\n    if (blendAlpha == 0.0 && pixelColorCC.a == 0.0){\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    //--\n\n    vec2 pixelCoordA1 = getOffsetPixelCoord(pixelCoordCC, -(1.0 / 3.0));\n    vec2 pixelCoordA2 = getOffsetPixelCoord(pixelCoordCC, -(2.0 / 3.0));\n    vec2 pixelCoordA3 = getOffsetPixelCoord(pixelCoordCC, -(3.0 / 3.0));\n\n    vec2 pixelCoordB1 = getOffsetPixelCoord(pixelCoordCC, (1.0 / 3.0));\n    vec2 pixelCoordB2 = getOffsetPixelCoord(pixelCoordCC, (2.0 / 3.0));\n    vec2 pixelCoordB3 = getOffsetPixelCoord(pixelCoordCC, (3.0 / 3.0));\n\n    //--\n\n    vec4 pixelColorA1 = (texture2D(uSampler, unmapCoord(pixelCoordA1)) * w1);\n    vec4 pixelColorA2 = (texture2D(uSampler, unmapCoord(pixelCoordA2)) * w2);\n    vec4 pixelColorA3 = (texture2D(uSampler, unmapCoord(pixelCoordA3)) * w3);\n\n    vec4 pixelColorB1 = (texture2D(uSampler, unmapCoord(pixelCoordB1)) * w1);\n    vec4 pixelColorB2 = (texture2D(uSampler, unmapCoord(pixelCoordB2)) * w2);\n    vec4 pixelColorB3 = (texture2D(uSampler, unmapCoord(pixelCoordB3)) * w3);\n\n    //--\n\n    vec4 result = (pixelColorCC + pixelColorA1 + pixelColorA2 + pixelColorA3 + pixelColorB1 + pixelColorB2 + pixelColorB3);\n\n    if (result.a > 0.0 && blendAlpha == 1.0 && alphaChoke > 0.0){\n        result.a = clamp((result.a + (alphaChoke * result.a)), 0.0, 1.0);\n    }\n\n    //--\n\n    gl_FragColor = result;\n\n}\n";var Hl="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D glitchSrc;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform float seed;\nuniform float noise;\nuniform float strength;\nuniform float chromatic;\nuniform float vShift;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\n\nconst float neutralValue = (128.0 / 255.0);\n\nfloat updateSeed(float seed){\n\treturn mod((seed * 9301.0 + 49297.0), 233280.0);\n}\n\nfloat seededRandom(float seed, float min, float max){\n\treturn (min + ((seed / 233280.0) * (max - min)));\n}\n\nvoid main(void){\n\n    vec4 glitchSrcColor = texture2D(glitchSrc, (vTextureCoord / scaleDimensions));\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n\n    float shortestSide = min(pixelDimensions.x, pixelDimensions.y);\n\n    float offsetFactorX = ((glitchSrcColor.r - neutralValue) * 2.0);\n    float offsetFactorY = ((glitchSrcColor.g - neutralValue) * vShift);\n\n    //--\n\n    // NOISE\n    if (noise > 0.0){\n        float seedVar = ((updateSeed(updateSeed(seed + updateSeed(pixelCoord.y))) + updateSeed(seed + pixelCoord.y)) / 2.0);\n        if (seededRandom(seedVar, 0.0, 1.0) < (noise / 2.0)){\n            seedVar = updateSeed(seedVar);\n            float betaOffset = (seededRandom(seedVar, 0.0, 1.0) * PIx2);\n            float betaBase = ((pixelCoord.y / pixelDimensions.y) * PIx2);\n            float trigFactor = ((sin(betaOffset) + sin(betaBase * 4.0) + sin(betaBase * 10.0) + sin(betaBase * 22.0)) / 4.0);\n            offsetFactorX += (trigFactor * noise * offsetFactorX * 2.0);\n        }\n    }\n\n    //--\n\n    vec2 pixelOffset = floor(vec2(offsetFactorX, offsetFactorY) * strength * (shortestSide / 2.0));\n    pixelCoord = mod((pixelCoord + pixelOffset + pixelDimensions), pixelDimensions);\n\n    vec2 scaleCoord = vTextureCoord;\n    scaleCoord = ((pixelCoord / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColor = texture2D(uSampler, scaleCoord);\n\n    //--\n\n    // CHROMATIC ABERRATION\n    if (chromatic > 0.0 || vShift > 0.0){\n\n        float chromaticOffsetMax = floor(shortestSide / 5.0);\n        float chromaticOffsetX = floor(chromatic * chromaticOffsetMax * offsetFactorX * strength);\n        float chromaticOffsetY = floor(chromatic * chromaticOffsetMax * offsetFactorY * strength);\n\n        // RED CHANNEL\n        vec2 pixelCoordR = pixelCoord;\n        pixelCoordR.x = mod((pixelCoordR.x - chromaticOffsetX + pixelDimensions.x), pixelDimensions.x);\n        pixelCoordR.y = mod((pixelCoordR.y - chromaticOffsetY + pixelDimensions.y), pixelDimensions.y);\n        vec2 scaleCoordR = ((pixelCoordR / pixelDimensions) * scaleDimensions);\n        scaleCoordR.y = (((vTextureCoord.y - scaleCoordR.y) * chromatic) + scaleCoordR.y);\n        vec4 pixelColorR = texture2D(uSampler, scaleCoordR);\n        pixelColor.r = pixelColorR.r;\n\n        // BLUE CHANNEL\n        vec2 pixelCoordB = pixelCoord;\n        pixelCoordB.x = mod((pixelCoordB.x + chromaticOffsetX + pixelDimensions.x), pixelDimensions.x);\n        pixelCoordB.y = mod((pixelCoordB.y + chromaticOffsetY + pixelDimensions.y), pixelDimensions.y);\n        vec2 scaleCoordB = ((pixelCoordB / pixelDimensions) * scaleDimensions);\n        scaleCoordB.y = (((vTextureCoord.y - scaleCoordB.y) * chromatic) + scaleCoordB.y);\n        vec4 pixelColorB = texture2D(uSampler, scaleCoordB);\n        pixelColor.b = pixelColorB.b;\n\n    }\n\n//\tgl_FragColor = glitchSrcColor;\n\tgl_FragColor = pixelColor;\n\n}\n";var zl="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform sampler2D blurTexture;\nuniform sampler2D artifactTexture;\n\nuniform vec2 artifactDimensions;\n\nuniform float grayscale;\nuniform float phase;\nuniform float length;\nuniform float horizontal;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\n\nconst vec3 maxPixelOffsetFactors = vec3(0.2, 0.2, 0.1);\nconst vec3 verticalSegments = vec3(16.0, 8.0, 32.0);\n\nvoid main(void){\n\n    float shortestSide = min(pixelDimensions.x, pixelDimensions.y);\n\n    vec3 maxPixelOffsetsX = floor(shortestSide * maxPixelOffsetFactors);\n\n    //--\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n    vec2 scaleCoord = ((pixelCoord / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColor = texture2D(uSampler, scaleCoord);\n    if (pixelColor.a == 0.0){\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    pixelColor.rgb /= pixelColor.a;\n\n    if (grayscale == 1.0){\n        float pixelLumo = getLumo(pixelColor.rgb);\n        pixelColor.rgb = vec3(pixelLumo);\n    }\n\n    //--\n\n    float yFactor = (pixelCoord.y / pixelDimensions.y);\n\n    //-- RED\n\n    float segmentR = max(1.0, (pixelDimensions.y / 12.0));\n    float shiftR = mod(floor((pixelCoord.y + (segmentR * 3.0 * phase)) / segmentR), 2.0);\n\n    float signR = (((sin((((yFactor * (verticalSegments.r / 2.0)) * PIx2) + (phase * PI * 1.5))) > 0.0) ? -1.0 : 0.0) + shiftR);\n\n    vec2 pixelOffsetR = vec2((floor((maxPixelOffsetsX.r * horizontal) + (shortestSide * 0.015)) * signR), 0.0);\n\n    vec2 pixelCoordR = clamp((pixelCoord + pixelOffsetR), vec2(0.0), (pixelDimensions - vec2(1.0)));\n    vec2 scaleCoordR = ((pixelCoordR / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColorR = texture2D(uSampler, scaleCoordR);\n    pixelColorR.rgb /= pixelColorR.a;\n\n    if (grayscale == 1.0){\n        float pixelLumoR = getLumo(pixelColorR.rgb);\n        pixelColorR.rgb = vec3(pixelLumoR);\n    }\n\n    pixelColor.r = pixelColorR.r;\n\n    //-- GREEN\n\n    vec2 artifactPixelCoord = mod((pixelCoord + vec2(0.0, (artifactDimensions.y * phase * 20.0))), artifactDimensions);\n    vec2 artifactScaleCoord = (artifactPixelCoord / artifactDimensions);\n    vec4 artifactColor = texture2D(artifactTexture, artifactScaleCoord);\n    artifactColor.rgb /= artifactColor.a;\n    float artifactLumo = getLumo(artifactColor.rgb);\n\n    //--\n\n    float segmentG = max(1.0, (((length * 0.99) + 0.01) * pixelDimensions.y));\n    float shiftG = mod(floor((pixelCoord.y + (segmentG * 3.0 * phase)) / segmentG), 2.0);\n\n    float signG = (((sin((((yFactor * (verticalSegments.g / 2.0)) * PIx2) + (phase * PI * 6.0))) > 0.0) ? -1.0 : 0.0) + shiftG);\n\n    vec2 pixelOffsetG = vec2((floor((maxPixelOffsetsX.g * horizontal) + (shortestSide * 0.005)) * signG), 0.0);\n\n    vec2 pixelCoordG = clamp((pixelCoord + pixelOffsetG), vec2(0.0), (pixelDimensions - vec2(1.0)));\n    vec2 scaleCoordG = ((pixelCoordG / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColorG = texture2D(uSampler, scaleCoordG);\n    pixelColorG.rgb /= pixelColorG.a;\n\n    if (grayscale == 1.0){\n        float pixelLumoG = getLumo(pixelColorG.rgb);\n        pixelColorG.rgb = vec3(pixelLumoG);\n    }\n\n    pixelColor.g = mix(pixelColorG.g, pixelColor.g, artifactLumo);\n\n    //-- BLUE\n\n    float signB = ((sin((((yFactor * (verticalSegments.b / 2.0)) * PIx2) + (phase * PI * 3.0))) > 0.0) ? 1.0 : -1.0);\n\n    vec2 pixelOffsetB = vec2((floor(maxPixelOffsetsX.b * horizontal) * signB), 0.0);\n\n    vec2 pixelCoordB = clamp((pixelCoord + pixelOffsetB), vec2(0.0), (pixelDimensions - vec2(1.0)));\n    vec2 scaleCoordB = ((pixelCoordB / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColorB = texture2D(blurTexture, (scaleCoordB / scaleDimensions));\n    pixelColorB.rgb /= pixelColorB.a;\n\n    if (grayscale == 1.0){\n        float pixelLumoB = getLumo(pixelColorB.rgb);\n        pixelColorB.rgb = vec3(pixelLumoB);\n    }\n\n    pixelColor.b = pixelColorB.b;\n\n    //--\n\n    pixelColor.rgb *= pixelColor.a;\n\n    //--\n\n    /* // TESTING\n    if (shiftG == 1.0){\n        pixelColor.rgb = mix(pixelColor.rgb, vec3(1.0, 0.0, 1.0), .2);\n    }\n    if (shiftR == 1.0){\n        pixelColor.rgb = mix(pixelColor.rgb, vec3(0.0, 1.0, 1.0), .2);\n    }\n    */\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n";var Xl="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform float grayscale;\nuniform float horizontal;\nuniform float vertical;\nuniform float colorCycle;\n\nvoid main(void){\n\n    float shortestSide = min(pixelDimensions.x, pixelDimensions.y);\n\n    float pixelOffsetMax = (shortestSide / 4.0);\n\n    vec2 pixelOffset = vec2(floor(horizontal * pixelOffsetMax), floor(vertical * pixelOffsetMax));\n\n    //--\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n    vec2 pixelCoordA = clamp((pixelCoord + pixelOffset), vec2(0.0), (pixelDimensions - vec2(1.0)));\n    vec2 pixelCoordB = clamp((pixelCoord - pixelOffset), vec2(0.0), (pixelDimensions - vec2(1.0)));\n\n    vec2 scaleCoord = ((pixelCoord / pixelDimensions) * scaleDimensions);\n    vec2 scaleCoordA = ((pixelCoordA / pixelDimensions) * scaleDimensions);\n    vec2 scaleCoordB = ((pixelCoordB / pixelDimensions) * scaleDimensions);\n\n    //--\n\n    vec4 pixelColor = texture2D(uSampler, scaleCoord);\n    if (pixelColor.a == 0.0){\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    pixelColor.rgb /= pixelColor.a;\n\n    vec4 pixelColorA = texture2D(uSampler, scaleCoordA);\n    pixelColorA.rgb /= pixelColorA.a;\n\n    vec4 pixelColorB = texture2D(uSampler, scaleCoordB);\n    pixelColorB.rgb /= pixelColorB.a;\n\n    //--\n\n    if (grayscale == 1.0){\n\n        float pixelLumo = getLumo(pixelColor.rgb);\n        float pixelLumoA = getLumo(pixelColorA.rgb);\n        float pixelLumoB = getLumo(pixelColorB.rgb);\n\n        pixelColor.rgb = vec3(pixelLumo);\n        pixelColorA.rgb = vec3(pixelLumoA);\n        pixelColorB.rgb = vec3(pixelLumoB);\n\n    }\n\n    //--\n\n    if (colorCycle == 0.0){\n        pixelColor.r = pixelColorA.r;\n        pixelColor.b = pixelColorB.b;\n    }else\n    if (colorCycle == 1.0){\n        pixelColor.r = pixelColorA.r;\n        pixelColor.g = pixelColorB.g;\n    }else\n    if (colorCycle == 2.0){\n        pixelColor.g = pixelColorA.g;\n        pixelColor.b = pixelColorB.b;\n    }else\n    if (colorCycle == 3.0){\n        pixelColor.r = pixelColorB.r;\n        pixelColor.g = pixelColorA.g;\n        pixelColor.b = pixelColorB.b;\n    }else\n    if (colorCycle == 4.0){\n        pixelColor.r = pixelColorA.r;\n        pixelColor.g = pixelColorA.g;\n        pixelColor.b = pixelColorB.b;\n    }else\n    if (colorCycle == 5.0){\n        pixelColor.r = pixelColorB.r;\n        pixelColor.g = pixelColorA.g;\n        pixelColor.b = pixelColorA.b;\n    }\n\n    //--\n\n    pixelColor.rgb *= pixelColor.a;\n\n    gl_FragColor = pixelColor;\n\n}\n";var jl="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform sampler2D loresTexture1;\nuniform vec2 loresDimensions1;\n\nuniform sampler2D loresTexture2;\nuniform vec2 loresDimensions2;\n\nuniform sampler2D loresTexture3;\nuniform vec2 loresDimensions3;\n\nuniform sampler2D loresTexture4;\nuniform vec2 loresDimensions4;\n\nuniform float grayscale;\nuniform float highlights;\nuniform float offset;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\nconst float maxCycles = 100.0;\n\nfloat getLoresLumo(vec2 pixelCoord, sampler2D texture, vec2 dimensions){\n    vec2 pixelSize = (1.0 / dimensions);\n    vec2 coord = ((floor((pixelCoord / pixelDimensions) * dimensions) / dimensions) + (pixelSize / 2.0));\n    vec4 color = texture2D(texture, coord);\n    float lumo = getLumo(color.rgb);\n    return lumo;\n}\n\nvoid main(void){\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n\n    //--\n\n    float shortestSide = min(pixelDimensions.x, pixelDimensions.y);\n    float maxOffset = (shortestSide / 128.0);\n    float offsetDistance = (offset * maxOffset);\n\n    float lowestResLumo1 = getLoresLumo(pixelCoord, loresTexture4, loresDimensions4);\n    float lowestResLumo2 = getLoresLumo(pixelCoord, loresTexture3, loresDimensions3);\n    float beta = (lowestResLumo1 * lowestResLumo2 * PIx2 * maxCycles);\n\n    vec2 pixelOffset = floor(vec2((cos(beta) * offsetDistance), (sin(beta) * offsetDistance)));\n\n    pixelCoord = mod((pixelCoord + pixelOffset + pixelDimensions), pixelDimensions);\n\n    //--\n\n    vec4 pixelColor = texture2D(uSampler, ((pixelCoord / pixelDimensions) * scaleDimensions));\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    float pixelLumo = getLumo(pixelColor.rgb);\n\n    //--\n\n    float loresLumo1 = getLoresLumo(pixelCoord, loresTexture1, loresDimensions1);\n    float loresLumo2 = getLoresLumo(pixelCoord, loresTexture2, loresDimensions2);\n    float loresLumo3 = getLoresLumo(pixelCoord, loresTexture3, loresDimensions3);\n    float loresLumo4 = getLoresLumo(pixelCoord, loresTexture4, loresDimensions4);\n\n    //--\n\n    float newPixelLumo = min(loresLumo4, min(loresLumo3, min(loresLumo2, min(loresLumo1, pixelLumo))));\n\n    vec4 newPixelColor = vec4(vec3(newPixelLumo), pixelColor.a);\n\n    if (grayscale == 0.0){\n\n        float k = (1.0 - max(pixelColor.r, max(pixelColor.g, pixelColor.b)));\n        float c = ((1.0 - pixelColor.r - k) / (1.0 - k));\n        float m = ((1.0 - pixelColor.g - k) / (1.0 - k));\n        float y = ((1.0 - pixelColor.b - k) / (1.0 - k));\n\n        k = (1.0 - newPixelLumo);\n\n        newPixelColor.r = ((1.0 - c) * (1.0 - k));\n        newPixelColor.g = ((1.0 - m) * (1.0 - k));\n        newPixelColor.b = ((1.0 - y) * (1.0 - k));\n\n        newPixelLumo = getLumo(newPixelColor.rgb);\n\n    }else{\n\n        pixelColor.rgb = vec3(pixelLumo);\n\n    }\n\n    //--\n\n    float highlightsThreshold = (1.0 - highlights);\n\n    if (pixelLumo > newPixelLumo && pixelLumo > highlightsThreshold){\n        float mixValue = ((pixelLumo - highlightsThreshold) / (1.0 - highlightsThreshold)) * highlights;\n        newPixelColor = mix(newPixelColor, pixelColor, mixValue);\n    }\n\n    //--\n\n\tgl_FragColor = newPixelColor;\n\n}\n";var Wl="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform sampler2D sweepTexture;\n\nuniform sampler2D loresTexture;\nuniform vec2 loresDimensions;\n\n//uniform sampler2D artifactTexture;\n//uniform vec2 artifactDimensions;\n\nuniform vec3 colorValue;\nuniform float highlights;\nuniform float weight;\nuniform float horizontal;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\n\nvec4 getSweepColor(vec2 pixelCoord){\n    vec2 pixelSize = (1.0 / loresDimensions);\n    vec2 coord = ((floor((pixelCoord / pixelDimensions) * loresDimensions) / loresDimensions) + (pixelSize / 2.0));\n    vec4 color = texture2D(sweepTexture, coord);\n    return color;\n}\n\nvec4 getLoresColor(vec2 pixelCoord){\n    vec2 pixelSize = (1.0 / loresDimensions);\n    vec2 coord = ((floor((pixelCoord / pixelDimensions) * loresDimensions) / loresDimensions) + (pixelSize / 2.0));\n    vec4 color = texture2D(loresTexture, coord);\n    return color;\n}\n\nvoid main(void){\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n\n    vec4 pixelColor = texture2D(uSampler, ((pixelCoord / pixelDimensions) * scaleDimensions));\n\n    //--\n\n    vec2 loresPixelSize = (pixelDimensions / loresDimensions);\n    vec2 loresCellSize = (loresPixelSize * 2.0);\n\n    float colIndex = floor(pixelCoord.x / loresCellSize.x);\n    float rowOffset = (mod(colIndex, 2.0) == 0.0) ? 0.0 : loresPixelSize.y;\n\n    float rowIndex = floor((pixelCoord.y + rowOffset) / loresCellSize.y);\n\n    //--\n\n    vec2 cellPixelCoord = vec2(((loresCellSize.x * colIndex)), ((loresCellSize.y * rowIndex)));\n    vec2 cellPixelCoordOffset = vec2(0.0, rowOffset);\n    vec2 offsetCellPixelCoord = (cellPixelCoord + cellPixelCoordOffset);\n\n    vec2 mixValue = mod(((pixelCoord + cellPixelCoordOffset) / loresCellSize), 1.0);\n\n    vec4 loresColorTL = getLoresColor(cellPixelCoord);\n    vec4 loresColorTR = getLoresColor(cellPixelCoord + vec2(loresPixelSize.x, 0.0));\n    vec4 loresColorBL = getLoresColor(cellPixelCoord + vec2(0.0, loresPixelSize.y));\n    vec4 loresColorBR = getLoresColor(cellPixelCoord + loresPixelSize);\n\n    vec4 loresColorT = mix(loresColorTL, loresColorTR, mixValue.x);\n    vec4 loresColorB = mix(loresColorBL, loresColorBR, mixValue.x);\n\n    vec4 loresColor = mix(loresColorT, loresColorB, mixValue.y);\n\n    if (mod(colIndex, 2.0) == 1.0){\n        float loresRow = floor(pixelCoord.y / loresPixelSize.y);\n        if (loresRow == 0.0 || loresRow == (loresDimensions.y - 1.0)){\n            loresColor = loresColorT;\n        }\n    }\n\n    //--\n\n    vec4 loresColorAvg = ((loresColorTL + loresColorTR + loresColorBL + loresColorBR) / 4.0);\n    float loresLumoAvg = getLumo(loresColorAvg.rgb);\n\n    //--\n\n    vec4 sweepColorTL = getSweepColor(cellPixelCoord);\n    vec4 sweepColorTR = getSweepColor(cellPixelCoord + vec2(loresPixelSize.x, 0.0));\n    vec4 sweepColorBL = getSweepColor(cellPixelCoord + vec2(0.0, loresPixelSize.y));\n    vec4 sweepColorBR = getSweepColor(cellPixelCoord + loresPixelSize);\n\n    vec4 sweepColorT = ((sweepColorTL + sweepColorTR) / 2.0);\n    vec4 sweepColorB = ((sweepColorBL + sweepColorBR) / 2.0);\n\n    vec4 sweepColor = ((sweepColorT + sweepColorB) / 2.0);\n\n    if (mod(colIndex, 2.0) == 1.0){\n        float loresRow = floor(pixelCoord.y / loresPixelSize.y);\n        if (loresRow == 0.0 || loresRow == (loresDimensions.y - 1.0)){\n            sweepColor = sweepColorT;\n        }\n    }\n\n    float sweepLumo = getLumo(sweepColor.rgb);\n\n    //--\n\n    float visibleW = (mix((loresCellSize.x * loresLumoAvg), loresCellSize.x, (weight / 2.0)) * sweepLumo);\n    float leftoverW = (loresCellSize.x - visibleW);\n\n    float offsetFactorX = horizontal;\n    float offsetX = (offsetFactorX * leftoverW);\n\n    vec2 relativePosition = mod((pixelCoord + vec2(0.0, rowOffset)), loresCellSize);\n\n    float darkMixX = 1.0;\n    if (relativePosition.x < offsetX || relativePosition.x > (visibleW + offsetX)){\n        darkMixX = 0.0;\n    }\n\n    //--\n\n    float visibleH = (loresCellSize.y * ((sweepLumo * 0.4) + 0.6));\n    float offsetY = ((loresCellSize.y / 2.0) - (visibleH / 2.0));\n\n    float darkMixY = 1.0;\n    if (relativePosition.y < offsetY || relativePosition.y > (visibleH + offsetY)){\n        darkMixY = 0.0;\n    }\n\n    //--\n\n    /*\n    vec2 artifactPixelCoord = mod(pixelCoord, artifactDimensions);\n    vec2 artifactScaleCoord = (artifactPixelCoord / artifactDimensions);\n    vec4 artifactColor = texture2D(artifactTexture, artifactScaleCoord);\n    float artifactLumo = getLumo(artifactColor.rgb);\n    */\n\n    float artifactMix = 1.0;//(1.0 - (artifactLumo * 0.5));\n\n    //--\n\n    // COLUMN BORDERS ( SOFT )\n    /*\n    darkMixX *= sin(mixValue.x * PI);\n    darkMixX = 1.0 - darkMixX;\n    darkMixX *= darkMixX * darkMixX;\n    darkMixX = 1.0 - darkMixX;\n\n    // ROW BORDERS ( SOFT )\n    /*\n    darkMixY *= sin(mixValue.y * PI);\n    darkMixY = 1.0 - darkMixY;\n    darkMixY *= darkMixY * darkMixY;\n    darkMixY = 1.0 - darkMixY;\n    */\n\n    //--\n\n    float colorValueLumo = getLumo(colorValue);\n\n    loresColor.rgb *= (darkMixX * darkMixY * artifactMix);\n\n    float loresLumo = getLumo(loresColor.rgb);\n\n    if (colorValue.r >= 0.0 && colorValue.g >= 0.0 && colorValue.b >= 0.0){\n        loresColor.rgb = vec3(loresLumo) * colorValue;\n    }\n\n    float highlightsThreshold = (1.0 - highlights);\n    if (loresLumo > highlightsThreshold){\n        float mixValue = (((loresLumo - highlightsThreshold) / (1.0 - highlightsThreshold)) * 1.0);\n        loresColor = mix(loresColor, vec4(1.0), mixValue);\n    }\n\n    pixelColor = vec4(loresColor.rgb, 1.0);\n\n    //--\n\n    if (mod(pixelCoord.x, cellPixelCoord.x) < 1.0 || mod((pixelCoord.y + rowOffset), cellPixelCoord.y) < 1.0){\n        pixelColor.rgb = vec3(0.0);\n    }\n\n    //--\n\n\tgl_FragColor = pixelColor;\n\n}\n";var Yl="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float pixelSize;\n\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n    pixelCoord.x = floor(pixelCoord.x);\n    pixelCoord.y = floor(pixelCoord.y);\n\n    float cellSize = ((pixelSize * 3.0) + 1.0);\n\n    float colIndex = floor(pixelCoord.x / cellSize);\n    float rowOffset = (mod(colIndex, 2.0) == 0.0) ? 0.0 : floor((cellSize - 1.0) / 2.0);\n\n    float rowIndex = floor((pixelCoord.y + rowOffset) / cellSize);\n\n    //--\n\n    float cellCenterOffset = ((cellSize - 1.0) / 2.0);\n\n    vec2 cellCenter = vec2(((cellSize * colIndex) + cellCenterOffset), ((cellSize * rowIndex) + cellCenterOffset));\n\n    //-- GET PIXEL COORDINATES FOR CELL\n\n    vec2 pixelCoordTL = unmapCoord(vec2(clamp((cellCenter.x - cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y - cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordTC = unmapCoord(vec2(clamp(cellCenter.x, 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y - cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordTR = unmapCoord(vec2(clamp((cellCenter.x + cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y - cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n\n    vec2 pixelCoordML = unmapCoord(vec2(clamp((cellCenter.x - cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp(cellCenter.y, 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordMC = unmapCoord(vec2(clamp(cellCenter.x, 0.0, (dimensions.x - 1.0)), clamp(cellCenter.y, 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordMR = unmapCoord(vec2(clamp((cellCenter.x + cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp(cellCenter.y, 0.0, (dimensions.y - 1.0))), filterArea);\n\n    vec2 pixelCoordBL = unmapCoord(vec2(clamp((cellCenter.x - cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y + cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordBC = unmapCoord(vec2(clamp(cellCenter.x, 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y + cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordBR = unmapCoord(vec2(clamp((cellCenter.x + cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y + cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n\n    //-- GET PIXEL COLORS FOR CELL\n\n    vec4 pixelColorTL = texture2D(uSampler, pixelCoordTL);\n    vec4 pixelColorTC = texture2D(uSampler, pixelCoordTC);\n    vec4 pixelColorTR = texture2D(uSampler, pixelCoordTR);\n\n    vec4 pixelColorML = texture2D(uSampler, pixelCoordML);\n    vec4 pixelColorMC = texture2D(uSampler, pixelCoordMC);\n    vec4 pixelColorMR = texture2D(uSampler, pixelCoordMR);\n\n    vec4 pixelColorBL = texture2D(uSampler, pixelCoordBL);\n    vec4 pixelColorBC = texture2D(uSampler, pixelCoordBC);\n    vec4 pixelColorBR = texture2D(uSampler, pixelCoordBR);\n\n    //-- GET AVERAGE COLOR FOR CELL\n\n    vec4 cellAverageColor = ((pixelColorTL + pixelColorTC + pixelColorTR + pixelColorML + pixelColorMC + pixelColorMR + pixelColorBL + pixelColorBC + pixelColorBR) / 9.0);\n    cellAverageColor.a = 1.0;\n\n    //--\n\n    vec4 color = cellAverageColor;\n\n    float cellColIndex = mod(pixelCoord.x, cellSize);\n    float cellRowIndex = mod((pixelCoord.y + rowOffset), cellSize);\n\n    float lightenFactor = 1.25;\n    float darkenFactor = 2.5;\n\n    if ((cellColIndex == (cellSize - 1.0)) || (cellRowIndex == (cellSize - 1.0))){ // SEPARATOR LINES\n        color.rgb = vec3(0.0);\n    }else{\n        if (cellColIndex < (pixelSize * 1.0)){ // RED\n            color.r = clamp((color.r * lightenFactor), 0.0, 1.0);\n            color.gb /= darkenFactor;\n        }else\n        if (cellColIndex < (pixelSize * 2.0)){ // GREEN\n            color.g = clamp((color.g * lightenFactor), 0.0, 1.0);\n            color.rb /= darkenFactor;\n        }else\n        if (cellColIndex < (pixelSize * 3.0)){ // BLUE\n            color.b = clamp((color.b * lightenFactor), 0.0, 1.0);\n            color.rg /= darkenFactor;\n        }\n    }\n\n    gl_FragColor = color;\n\n}\n";var ql="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float distortion;\n\nuniform float focalPointX;\nuniform float focalPointY;\n\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n    pixelCoord.x = floor(pixelCoord.x);\n    pixelCoord.y = floor(pixelCoord.y);\n\n    float offsetFactorX = ((pixelCoord.x - (dimensions.x * focalPointX)) / (dimensions.x * 1.0));\n    float offsetFactorY = ((pixelCoord.y - (dimensions.y * focalPointY)) / (dimensions.y * 1.0));\n\n    float maxOffsetX = (dimensions.x / 128.0);\n    float maxOffsetY = (dimensions.y / 128.0);\n\n    float offsetX = (distortion * offsetFactorX * maxOffsetX);\n    float offsetY = (distortion * offsetFactorY * maxOffsetY);\n\n    vec2 offsetCoord1 = unmapCoord(vec2(clamp((pixelCoord.x - (offsetX * 1.0)), 0.0, (dimensions.x - 1.0)), clamp((pixelCoord.y - (offsetY * 1.0)), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 offsetCoord2 = unmapCoord(vec2(clamp((pixelCoord.x - (offsetX * 2.0)), 0.0, (dimensions.x - 1.0)), clamp((pixelCoord.y - (offsetY * 2.0)), 0.0, (dimensions.y - 1.0))), filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    pixelColor.rgb /= pixelColor.a;\n\n    vec4 offsetPixelColor1 = texture2D(uSampler, offsetCoord1);\n    vec4 offsetPixelColor2 = texture2D(uSampler, offsetCoord2);\n\n    if (offsetPixelColor1.a > 0.0) {\n        offsetPixelColor1.rgb /= offsetPixelColor1.a;\n    }\n\n    if (offsetPixelColor2.a > 0.0) {\n        offsetPixelColor2.rgb /= offsetPixelColor2.a;\n    }\n\n    pixelColor.g = offsetPixelColor1.g;\n    pixelColor.r = offsetPixelColor2.r;\n\n    pixelColor.rgb *= pixelColor.a;\n\n    gl_FragColor = pixelColor;\n\n}\n";var Kl="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float stretch;\nuniform float distortion;\nuniform float vignetteOpacity;\nuniform float edgeBlur;\n\nuniform vec2 dimensions;\n\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId4 = (PI / 4.0);\nconst float PId8 = (PI / 8.0);\nconst float PHI = 1.618033988749895;\nconst float fibonacciBetaStep = (PIx2 / PHI);\n\nvoid main(void){\n\n    //-- GET CURRENT PIXEL COORDINATE\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n    pixelCoord.x = floor(pixelCoord.x);\n    pixelCoord.y = floor(pixelCoord.y);\n\n    //-- DISTORT COORDINATE\n\n    // X-DISTORTION\n\n\tfloat offsetFactor = cos((1.0 - (pixelCoord.x / (dimensions.x - 1.0))) * PI);\n\n\tfloat sourceX = (dimensions.x / 2.0) + ((dimensions.x / 2.0) * offsetFactor);\n\n\tfloat pixelOffsetX = (((pixelCoord.x - sourceX) / 4.0) * stretch);\n\n    // Y-DISTORTION\n\n    float xFactor = (pixelCoord.x / dimensions.x);\n\n    float beta = (PI * xFactor);\n\n    float sinFactor = sin(beta);\n\n    float yFactor = clamp(((dimensions.y / 2.0) - pixelCoord.y) / (dimensions.y / 2.0), -1.0, 1.0);\n\n    float maxDisplacementY = (min(dimensions.x, dimensions.y) / 24.0);\n\n    float pixelOffsetY = (distortion * sinFactor * yFactor * maxDisplacementY);\n\n    //--\n\n    vec2 distortedPixelCoord = vec2((pixelCoord.x + pixelOffsetX), (pixelCoord.y + pixelOffsetY));\n\n    vec2 unmappedDistortedPixelCoord = unmapCoord(vec2(clamp(distortedPixelCoord.x, 0.0, (dimensions.x - 1.0)), clamp(distortedPixelCoord.y, 0.0, (dimensions.y - 1.0))), filterArea);\n\n    //-- GET CURRENT PIXEL COLOR\n    vec4 pixelColor = texture2D(uSampler, unmappedDistortedPixelCoord);\n\n    //-- DETERMINE ELLIPSE\n\n    bool isLandscape = (dimensions.x > dimensions.y);\n\n    vec2 ellipseFocusCoord1 = (dimensions / 2.0);\n    vec2 ellipseFocusCoord2 = (dimensions / 2.0);\n\n    if (isLandscape){ // LANDSCAPE ORIENTATION\n        ellipseFocusCoord1.x = (dimensions.x * 0.1);\n        ellipseFocusCoord2.x = (dimensions.x * 0.9);\n    }else{ // PORTRAIT ORIENTATION\n        ellipseFocusCoord1.y = (dimensions.y * 0.1);\n        ellipseFocusCoord2.y = (dimensions.y * 0.9);\n    }\n\n    float outerRadius = ((isLandscape ? dimensions.x : dimensions.y) * 1.1); // 1.2\n    float innerRadius = ((isLandscape ? dimensions.x : dimensions.y) * 0.8); // 0.9\n\n    //--\n\n    float dx1 = (pixelCoord.x - ellipseFocusCoord1.x);\n    float dy1 = (pixelCoord.y - ellipseFocusCoord1.y);\n    float dd1 = sqrt(pow(dx1, 2.0) + pow(dy1, 2.0));\n\n    float dx2 = (pixelCoord.x - ellipseFocusCoord2.x);\n    float dy2 = (pixelCoord.y - ellipseFocusCoord2.y);\n    float dd2 = sqrt(pow(dx2, 2.0) + pow(dy2, 2.0));\n\n    float radius = (dd1 + dd2);\n\n    //-- EDGE BLUR\n\n    float blurFactor = 1.0;\n    if (edgeBlur > 0.0 && radius > innerRadius){\n\n        if (radius <= outerRadius){\n            blurFactor = ((radius - innerRadius) / (outerRadius - innerRadius));\n        }\n\n        ///* // FIBONACCI SPIRAL (SUNFLOWER SEED POINT DISTRIBUTION, 18 SAMPLES, PLUS EXISTING CENTER SAMPLE, 19 SAMPLES TOTAL)\n\n        float maxSpread = (outerRadius / 100.0); // 128.0\n        float spread = (maxSpread * blurFactor * edgeBlur);\n        float spreadDistanceStep = (spread / 20.0);\n\n        vec2 pt01 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 2.0) * (spreadDistanceStep * 2.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 2.0) * (spreadDistanceStep * 2.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt02 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 3.0) * (spreadDistanceStep * 3.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 3.0) * (spreadDistanceStep * 3.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt03 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 4.0) * (spreadDistanceStep * 4.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 4.0) * (spreadDistanceStep * 4.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt04 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 5.0) * (spreadDistanceStep * 5.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 5.0) * (spreadDistanceStep * 5.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt05 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 6.0) * (spreadDistanceStep * 6.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 6.0) * (spreadDistanceStep * 6.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt06 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 7.0) * (spreadDistanceStep * 7.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 7.0) * (spreadDistanceStep * 7.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt07 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 8.0) * (spreadDistanceStep * 8.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 8.0) * (spreadDistanceStep * 8.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt08 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 9.0) * (spreadDistanceStep * 9.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 9.0) * (spreadDistanceStep * 9.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt09 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 10.0) * (spreadDistanceStep * 10.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 10.0) * (spreadDistanceStep * 10.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt10 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 11.0) * (spreadDistanceStep * 11.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 11.0) * (spreadDistanceStep * 11.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt11 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 12.0) * (spreadDistanceStep * 12.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 12.0) * (spreadDistanceStep * 12.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt12 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 13.0) * (spreadDistanceStep * 13.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 13.0) * (spreadDistanceStep * 13.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt13 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 14.0) * (spreadDistanceStep * 14.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 14.0) * (spreadDistanceStep * 14.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt14 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 15.0) * (spreadDistanceStep * 15.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 15.0) * (spreadDistanceStep * 15.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt15 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 16.0) * (spreadDistanceStep * 16.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 16.0) * (spreadDistanceStep * 16.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt16 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 17.0) * (spreadDistanceStep * 17.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 17.0) * (spreadDistanceStep * 17.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt17 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 18.0) * (spreadDistanceStep * 18.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 18.0) * (spreadDistanceStep * 18.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt18 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 19.0) * (spreadDistanceStep * 19.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 19.0) * (spreadDistanceStep * 19.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n\n        pixelColor += texture2D(uSampler, pt01);\n        pixelColor += texture2D(uSampler, pt02);\n        pixelColor += texture2D(uSampler, pt03);\n        pixelColor += texture2D(uSampler, pt04);\n        pixelColor += texture2D(uSampler, pt05);\n        pixelColor += texture2D(uSampler, pt06);\n        pixelColor += texture2D(uSampler, pt07);\n        pixelColor += texture2D(uSampler, pt08);\n        pixelColor += texture2D(uSampler, pt09);\n        pixelColor += texture2D(uSampler, pt10);\n        pixelColor += texture2D(uSampler, pt11);\n        pixelColor += texture2D(uSampler, pt12);\n        pixelColor += texture2D(uSampler, pt13);\n        pixelColor += texture2D(uSampler, pt14);\n        pixelColor += texture2D(uSampler, pt15);\n        pixelColor += texture2D(uSampler, pt16);\n        pixelColor += texture2D(uSampler, pt17);\n        pixelColor += texture2D(uSampler, pt18);\n\n        pixelColor /= 19.0;\n\n        //*/\n\n        /* // LAYERED DOUBLE-BOX SPREAD (INNER + OUTER RADIUS, 16 SAMPLES, PLUS EXISTING CENTER SAMPLE, 17 SAMPLES TOTAL)\n\n        float outerSpread = ((outerRadius / 128.0) * blurFactor * edgeBlur);\n        float innerSpread = (outerSpread / 2.0);\n\n        vec2 outerPt1 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 0.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 0.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt2 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 1.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 1.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt3 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 2.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 2.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt4 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 3.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 3.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt5 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 4.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 4.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt6 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 5.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 5.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt7 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 6.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 6.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt8 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 7.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 7.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n\n        vec2 innerPt1 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 0.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 0.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt2 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 1.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 1.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt3 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 2.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 2.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt4 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 3.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 3.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt5 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 4.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 4.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt6 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 5.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 5.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt7 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 6.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 6.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt8 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 7.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 7.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n\n        //--\n\n        pixelColor += texture2D(uSampler, outerPt1);\n        pixelColor += texture2D(uSampler, outerPt2);\n        pixelColor += texture2D(uSampler, outerPt3);\n        pixelColor += texture2D(uSampler, outerPt4);\n        pixelColor += texture2D(uSampler, outerPt5);\n        pixelColor += texture2D(uSampler, outerPt6);\n        pixelColor += texture2D(uSampler, outerPt7);\n        pixelColor += texture2D(uSampler, outerPt8);\n\n        pixelColor += texture2D(uSampler, innerPt1);\n        pixelColor += texture2D(uSampler, innerPt2);\n        pixelColor += texture2D(uSampler, innerPt3);\n        pixelColor += texture2D(uSampler, innerPt4);\n        pixelColor += texture2D(uSampler, innerPt5);\n        pixelColor += texture2D(uSampler, innerPt6);\n        pixelColor += texture2D(uSampler, innerPt7);\n        pixelColor += texture2D(uSampler, innerPt8);\n\n        pixelColor /= 17.0; // GET AVERAGE COLOR FOR BLURRED PIXEL\n\n        */\n\n        /* // BASIC SQUARE SPREAD (INNER + OUTER RADIUS, 13 SAMPLES)\n\n        //-- GET PIXEL COORDINATES FOR BLUR SOURCE\n\n        float spread = ((outerRadius / 128.0) * blurFactor * edgeBlur);\n\n        vec2 pixelCoordTL = unmapCoord(vec2(clamp((distortedPixelCoord.x - spread), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordTLi = unmapCoord(vec2(clamp((distortedPixelCoord.x - (spread / 2.0)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - (spread / 2.0)), 0.0, (dimensions.y - 1.0))), filterArea); // INNER\n        vec2 pixelCoordTC = unmapCoord(vec2(clamp(distortedPixelCoord.x, 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordTR = unmapCoord(vec2(clamp((distortedPixelCoord.x + spread), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordTRi = unmapCoord(vec2(clamp((distortedPixelCoord.x + (spread / 2.0)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - (spread / 2.0)), 0.0, (dimensions.y - 1.0))), filterArea); // INNER\n\n        vec2 pixelCoordML = unmapCoord(vec2(clamp((distortedPixelCoord.x - spread), 0.0, (dimensions.x - 1.0)), clamp(distortedPixelCoord.y, 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordMC = unmapCoord(vec2(clamp(distortedPixelCoord.x, 0.0, (dimensions.x - 1.0)), clamp(distortedPixelCoord.y, 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordMR = unmapCoord(vec2(clamp((distortedPixelCoord.x + spread), 0.0, (dimensions.x - 1.0)), clamp(distortedPixelCoord.y, 0.0, (dimensions.y - 1.0))), filterArea);\n\n        vec2 pixelCoordBL = unmapCoord(vec2(clamp((distortedPixelCoord.x - spread), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordBLi = unmapCoord(vec2(clamp((distortedPixelCoord.x - (spread / 2.0)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (spread / 2.0)), 0.0, (dimensions.y - 1.0))), filterArea); // INNER\n        vec2 pixelCoordBC = unmapCoord(vec2(clamp(distortedPixelCoord.x, 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordBR = unmapCoord(vec2(clamp((distortedPixelCoord.x + spread), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordBRi = unmapCoord(vec2(clamp((distortedPixelCoord.x + (spread / 2.0)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (spread / 2.0)), 0.0, (dimensions.y - 1.0))), filterArea); // INNER\n\n        //-- GET PIXEL COLORS FOR BLUR\n\n        vec4 pixelColorTL = texture2D(uSampler, pixelCoordTL);\n        vec4 pixelColorTLi = texture2D(uSampler, pixelCoordTLi); // INNER\n        vec4 pixelColorTC = texture2D(uSampler, pixelCoordTC);\n        vec4 pixelColorTR = texture2D(uSampler, pixelCoordTR);\n        vec4 pixelColorTRi = texture2D(uSampler, pixelCoordTRi); // INNER\n\n        vec4 pixelColorML = texture2D(uSampler, pixelCoordML);\n        vec4 pixelColorMC = texture2D(uSampler, pixelCoordMC);\n        vec4 pixelColorMR = texture2D(uSampler, pixelCoordMR);\n\n        vec4 pixelColorBL = texture2D(uSampler, pixelCoordBL);\n        vec4 pixelColorBLi = texture2D(uSampler, pixelCoordBLi); // INNER\n        vec4 pixelColorBC = texture2D(uSampler, pixelCoordBC);\n        vec4 pixelColorBR = texture2D(uSampler, pixelCoordBR);\n        vec4 pixelColorBRi = texture2D(uSampler, pixelCoordBRi); // INNER\n\n        //-- GET AVERAGE COLOR FOR BLURRED PIXEL\n\n        pixelColor = ((pixelColorTL + pixelColorTLi + pixelColorTC + pixelColorTR + pixelColorTRi + pixelColorML + pixelColorMC + pixelColorMR + pixelColorBL + pixelColorBLi + pixelColorBC + pixelColorBR + pixelColorBRi) / 13.0);\n\n        */\n\n    }\n\n    //-- VIGNETTE\n\n    float vignetteFactor = 1.0;\n    if (vignetteOpacity > 0.0 && radius > innerRadius){\n        if (radius <= outerRadius){\n            vignetteFactor = ((radius - innerRadius) / (outerRadius - innerRadius));\n        }\n        pixelColor = mix(pixelColor, vec4(vec3(0.0), 1.0), (vignetteOpacity * vignetteFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n";var Ql="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float distortion;\nuniform vec2 dimensions;\n\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\n\nvoid main(void){\n\n\tvec2 pixelCoord = mapCoord(vTextureCoord, filterArea); // vec2((vTextureCoord.x * dimensions.x), (vTextureCoord.y * dimensions.y));\n\n\tvec2 adjustedPixelCoord = pixelCoord;\n\n\tvec2 centerCoord = vec2((dimensions.x / 2.0), (dimensions.y / 2.0));\n\n    vec2 deltaCoord = (pixelCoord - centerCoord);\n\n    float distance;\n\n\tvec2 unmappedPixelCoord;\n\n\tif (distortion > 0.0){ // FISHEYE\n\n        distance = sqrt(pow(deltaCoord.x, 2.0) + pow(deltaCoord.y, 2.0));\n\n        float strength = (PIx2 / (2.0 * sqrt(dot(centerCoord, centerCoord)))) * (distortion / 3.0);\n\n\t\tfloat bind = sqrt(dot(centerCoord, centerCoord)); // STICK TO CORNERS\n\n        adjustedPixelCoord = (centerCoord + (normalize(deltaCoord) * tan(distance * strength) * (bind / tan(bind * strength))));\n\n\t}else\n\tif (distortion < 0.0){ // ANTI-FISHEYE\n\n        float strength = pow(distortion, 2.0);\n\n\t\tfloat diameter = sqrt(pow(dimensions.x, 2.0) + pow(dimensions.y, 2.0));\n\t\tfloat radius = (diameter / 2.0);\n\n\t\tfloat xFactor = (pixelCoord.x / dimensions.x);\n\t\tfloat yFactor = (pixelCoord.y / dimensions.y);\n\n\t\tfloat longestSide = max(dimensions.x, dimensions.y);\n\t\tfloat maxDisplacementX = ((dimensions.y / 8.0) * strength);\n\t\tfloat maxDisplacementY = ((dimensions.x / 8.0) * strength);\n\n\t\tfloat sinFactorX = sin(xFactor * PI);\n\t\tfloat sinFactorY = sin(yFactor * PI);\n\n\t\tfloat distanceFactorX = (deltaCoord.x / (dimensions.x / 2.0));\n\t\tfloat distanceFactorY = (deltaCoord.y / (dimensions.y / 2.0));\n\n\t\t//—\n\n\t\tfloat offsetX = (maxDisplacementX * sinFactorY * distanceFactorX);\n\t\tfloat offsetY = (maxDisplacementY * sinFactorX * distanceFactorY);\n\n\t\tadjustedPixelCoord.x += offsetX;\n\t\tadjustedPixelCoord.y += offsetY;\n\n\t\t//—\n\n\t\tfloat centerW = (dimensions.x - (maxDisplacementX * 2.0));\n\t\tfloat centerH = (dimensions.y - (maxDisplacementY * 2.0));\n\n\t\tfloat scaleFactor = max(max(1.0, (dimensions.x / centerW)), max(1.0, (dimensions.y / centerH)));\n\n        vec2 adjustedDeltaCoord = (adjustedPixelCoord - centerCoord);\n\n\t\tdistance = sqrt(pow(adjustedDeltaCoord.x, 2.0) + pow(adjustedDeltaCoord.y, 2.0));\n\n\t\tfloat beta = atan(adjustedDeltaCoord.y, adjustedDeltaCoord.x);\n\n\t\tfloat distanceFactor = (distance / radius);\n\n\t\tadjustedPixelCoord = vec2((centerCoord.x + (cos(beta) * ((distanceFactor * radius) / scaleFactor))), (centerCoord.y + (sin(beta) * ((distanceFactor * radius) / scaleFactor))));\n\n\t}\n\n\tunmappedPixelCoord = unmapCoord(adjustedPixelCoord, filterArea); // (adjustedPixelCoord / dimensions.xy);\n\n\tvec4 pixelColor = texture2D(uSampler, unmappedPixelCoord);\n\n\t//—\n\n\tgl_FragColor = pixelColor;\n\n}\n";var Zl="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform sampler2D src;\nuniform vec2 srcDimensions;\nuniform vec2 dimensions;\n\nuniform float tolerance;\n\nuniform vec3 shadowColor;\nuniform vec3 highlightColor;\n\nuniform bool invertColors;\n\nvec2 mapSrcCoord(vec2 srcCoord){\n\treturn vec2(floor(srcCoord.x * srcDimensions.x), floor(srcCoord.y * srcDimensions.y));\n}\n\nvec2 unmapSrcCoord(vec2 srcCoord){\n\treturn vec2((srcCoord.x / srcDimensions.x), (srcCoord.y / srcDimensions.y));\n}\n\nvec4 getSrcPixelColor(vec2 srcCoord){\n\n\tvec2 srcCoord0 = unmapSrcCoord(vec2((srcCoord.x + 0.0), (srcCoord.y + 0.0))); // CENTER\n\tvec2 srcCoord1 = unmapSrcCoord(vec2((srcCoord.x - 1.0), (srcCoord.y + 0.0))); // LEFT\n\tvec2 srcCoord2 = unmapSrcCoord(vec2((srcCoord.x + 1.0), (srcCoord.y + 0.0))); // RIGHT\n\tvec2 srcCoord3 = unmapSrcCoord(vec2((srcCoord.x + 0.0), (srcCoord.y - 1.0))); // TOP\n\tvec2 srcCoord4 = unmapSrcCoord(vec2((srcCoord.x + 0.0), (srcCoord.y + 1.0))); // BOTTOM\n\n\tvec4 srcColor0 = texture2D(src, srcCoord0);\n\tvec4 srcColor1 = texture2D(src, srcCoord1);\n\tvec4 srcColor2 = texture2D(src, srcCoord2);\n\tvec4 srcColor3 = texture2D(src, srcCoord3);\n\tvec4 srcColor4 = texture2D(src, srcCoord4);\n\n\tvec4 avgColor = ((srcColor0 + srcColor1 + srcColor2 + srcColor3 + srcColor4) / 5.0);\n\n\treturn avgColor;\n\n}\n\nfloat getSrcPixelLumo(vec2 srcCoord){\n\n\tvec4 avgColor = getSrcPixelColor(srcCoord);\n\t\n\treturn getLumo(avgColor.rgb);\n\n}\n\nfloat getPixelColorAmount(vec2 pixelCoord, vec2 originCoord, vec2 srcPixelCoord, float maxRadius){\n\n\tfloat colorAmount = (invertColors ? 0.0 : 1.0);\n\n\tvec2 cellCenterDeltaCoord = (pixelCoord - originCoord);\n\tfloat cellCenterDistance = sqrt(pow(cellCenterDeltaCoord.x, 2.0) + pow(cellCenterDeltaCoord.y, 2.0));\n\tif (cellCenterDistance <= maxRadius){\n\t\tfloat cellLumo = getSrcPixelLumo(srcPixelCoord);\n\t\tcellLumo = invertColors ? (cellLumo / 2.0) : ((1.0 - cellLumo) / 1.5);\n\t\tfloat activeRadius = pow((maxRadius * cellLumo), 1.0);\n\t\tif (cellCenterDistance <= activeRadius){\n\t\t\tcolorAmount = (invertColors ? 1.0 : 0.0);\n\t\t}else\n\t\tif (cellCenterDistance <= activeRadius + 2.0){\n\t\t\tfloat fade = sqrt((cellCenterDistance - activeRadius) / 2.0);\n\t\t\tcolorAmount = (invertColors ? (1.0 - fade) : fade);\n\t\t}\n\t}\n\t\n\treturn colorAmount;\n\n}\n\nvoid main(void){\n\n    // GET CURRENT PIXEL COORDINATE ON MAIN IMAGE\n\tvec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\tpixelCoord.x = floor(pixelCoord.x);\n\tpixelCoord.y = floor(pixelCoord.y);\n\n    // GET NORMALIZED PIXEL COORDINATE (0.0 - 1.0) ON MAIN IMAGE\n\tvec2 normalizedCoord = (pixelCoord / dimensions);\n\n    // GET CURRENT PIXEL COORDINATE ON SOURCE IMAGE (RESIZED TO HALFTONE DOT RESOLUTION)\n\tvec2 srcPixelCoord = mapSrcCoord(normalizedCoord);\n\n    // DETERMINE IF CURRENT SOURCE PIXEL IS IN A SOURCE-DOT POSITION\n\tbool isSRC = ((mod(srcPixelCoord.x, 2.0) == 0.0 && mod(srcPixelCoord.y, 2.0) == 0.0) || (mod(srcPixelCoord.x, 2.0) != 0.0 && mod(srcPixelCoord.y, 2.0) != 0.0));\n\n    // DETERMINE HOW MANY PIXELS ON THE MAIN IMAGE A SINGLE PIXEL TAKES UP ON THE SOURCE IMAGE\n\tvec2 cellSize = vec2((dimensions.x / srcDimensions.x),  (dimensions.y / srcDimensions.y));\n\n\t// DETERMINE THE MAXIMUM RADIUS OF A HALFTONE DOT\n\tfloat maxRadius = (max(cellSize.x, cellSize.y) * (1.0 + tolerance));//1.5;\n    \n\t// GET PIXEL COORINATES ON SOURCE IMAGE TO USE FOR AVERAGE PIXEL COLOR\n\tvec2 srcPt0 = vec2((srcPixelCoord.x + 0.0), (srcPixelCoord.y + 0.0)); // CENTER\n\tvec2 srcPt1 = vec2((srcPixelCoord.x - 1.0), (srcPixelCoord.y + 0.0)); // LEFT\n\tvec2 srcPt2 = vec2((srcPixelCoord.x + 1.0), (srcPixelCoord.y + 0.0)); // RIGHT\n\tvec2 srcPt3 = vec2((srcPixelCoord.x + 0.0), (srcPixelCoord.y - 1.0)); // TOP\n\tvec2 srcPt4 = vec2((srcPixelCoord.x + 0.0), (srcPixelCoord.y + 1.0)); // BOTTOM\n\n    // MODIFY PIXEL COORINATES ON SOURCE IMAGE TO USE FOR AVERAGE PIXEL COLOR (IF CURRENT SOURCE PIXEL SHARES COORDINATES WITH A HALFTONE DOT CENTER)\n\tif (isSRC){\n\t\tsrcPt1.y -= 1.0; // TOP LEFT\n\t\tsrcPt2.y += 1.0; // BOTTOM RIGHT\n\t\tsrcPt3.x += 1.0; // TOP RIGHT\n\t\tsrcPt4.x -= 1.0; // BOTTOM LEFT\n    }\n    \n    // GET HALFTONE DOT CENTERS ON MAIN IMAGE\n    vec2 mainImageCellCenterCoord0 = ((unmapSrcCoord(srcPt0) * dimensions) + (cellSize / 2.0));\n    vec2 mainImageCellCenterCoord1 = ((unmapSrcCoord(srcPt1) * dimensions) + (cellSize / 2.0));\n    vec2 mainImageCellCenterCoord2 = ((unmapSrcCoord(srcPt2) * dimensions) + (cellSize / 2.0));\n    vec2 mainImageCellCenterCoord3 = ((unmapSrcCoord(srcPt3) * dimensions) + (cellSize / 2.0));\n    vec2 mainImageCellCenterCoord4 = ((unmapSrcCoord(srcPt4) * dimensions) + (cellSize / 2.0));\n\t\n\t// DETERMINE WHETHER OR NOT TO INCLUDE THE CURRENT PIXEL IN A HALFTONE DOT\n\n\tfloat colorAmount = (invertColors ? 0.0 : 1.0);\n\n\tif (invertColors){\n\n\t\tif (isSRC){\n\t\t\tcolorAmount = max(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord0, srcPt0, maxRadius));\n\t\t}\n\t\n\t\tcolorAmount = max(colorAmount, min(1.0, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord1, srcPt1, maxRadius) + colorAmount));\n\t\tcolorAmount = max(colorAmount, min(1.0, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord2, srcPt2, maxRadius) + colorAmount));\n\t\tcolorAmount = max(colorAmount, min(1.0, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord3, srcPt3, maxRadius) + colorAmount));\n\t\tcolorAmount = max(colorAmount, min(1.0, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord4, srcPt4, maxRadius) + colorAmount));\n\t\n\t}else{\n\t\n\t\tif (isSRC){\n\t\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord0, srcPt0, maxRadius));\n\t\t}\n\t\n\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord1, srcPt1, maxRadius) * colorAmount);\n\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord2, srcPt2, maxRadius) * colorAmount);\n\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord3, srcPt3, maxRadius) * colorAmount);\n\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord4, srcPt4, maxRadius) * colorAmount);\n\t\n\t}\n\n\t// DETERMINE FINAL COLOR\n\n    vec4 originalColor = texture2D(uSampler, vTextureCoord);\n\n    originalColor.rgb /= originalColor.a; // UN-PREMULTIPLY\n\n\tvec4 sColor = vec4(((shadowColor.r == -1.0) ? (originalColor.rgb * 0.5) : shadowColor), 1.0);\n\tvec4 hColor = vec4(((highlightColor.r == -1.0) ? (originalColor.rgb * 1.0) : highlightColor), 1.0);\n\n\tvec4 color = mix(sColor, hColor, colorAmount);\n\tcolor.rgb *= originalColor.a; // RE-PREMULTIPLY\n\tcolor.a = originalColor.a; // RE-PREMULTIPLY\n\n\t//--\n\n    gl_FragColor = color;\n\n}\n";var Jl="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec3 shadowColor;\nuniform vec3 midtoneColor;\nuniform vec3 highlightColor;\n\nuniform float shadowIntensity;\nuniform float midtoneIntensity;\nuniform float highlightIntensity;\n\nvec3 softlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x <= 0.5) ? (dst.x - (1.0 - 2.0 * src.x) * dst.x * (1.0 - dst.x)) : (((src.x > 0.5) && (dst.x <= 0.25)) ? (dst.x + (2.0 * src.x - 1.0) * (4.0 * dst.x * (4.0 * dst.x + 1.0) * (dst.x - 1.0) + 7.0 * dst.x)) : (dst.x + (2.0 * src.x - 1.0) * (sqrt(dst.x) - dst.x))),\n           \t\t\t\t(src.y <= 0.5) ? (dst.y - (1.0 - 2.0 * src.y) * dst.y * (1.0 - dst.y)) : (((src.y > 0.5) && (dst.y <= 0.25)) ? (dst.y + (2.0 * src.y - 1.0) * (4.0 * dst.y * (4.0 * dst.y + 1.0) * (dst.y - 1.0) + 7.0 * dst.y)) : (dst.y + (2.0 * src.y - 1.0) * (sqrt(dst.y) - dst.y))),\n           \t\t\t\t(src.z <= 0.5) ? (dst.z - (1.0 - 2.0 * src.z) * dst.z * (1.0 - dst.z)) : (((src.z > 0.5) && (dst.z <= 0.25)) ? (dst.z + (2.0 * src.z - 1.0) * (4.0 * dst.z * (4.0 * dst.z + 1.0) * (dst.z - 1.0) + 7.0 * dst.z)) : (dst.z + (2.0 * src.z - 1.0) * (sqrt(dst.z) - dst.z))));\n}\n\nvoid main(void){\n\n    vec4 srcColor = texture2D(uSampler, vTextureCoord);\n\n    if (srcColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    srcColor.rgb /= srcColor.a;\n\n    float srcLumo = getLumo(srcColor.rgb);\n\n    //--\n\n    vec3 neutralColor = vec3(0.5);\n\n    vec3 sColor = mix(neutralColor, shadowColor, shadowIntensity);\n    vec3 mColor = mix(neutralColor, midtoneColor, midtoneIntensity);\n    vec3 hColor = mix(neutralColor, highlightColor, highlightIntensity);\n\n    //--\n\n    float mixFactor;\n    vec3 dstColor;\n    if (srcLumo <= 0.5){ // SHADOWS -> MIDTONES\n        mixFactor = (srcLumo * 2.0);\n        dstColor = mix(sColor, mColor, mixFactor);\n    }else{ // MIDTONES -> HIGHLIGHTS\n        mixFactor = ((srcLumo - 0.5) * 2.0);\n        dstColor = mix(mColor, hColor, mixFactor);\n    }\n\n    //--\n\n    vec3 softlightColor = softlightBlend(dstColor, srcColor.rgb);\n\n    vec4 color = vec4(softlightColor*srcColor.a, srcColor.a);\n\n\t//--\n\n    gl_FragColor = color;\n\n}\n";var $l="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float strength;\nuniform float phase;\nuniform float scale;\nuniform float lightness;\n\nuniform vec2 dimensions;\nuniform vec2 mapDimensions;\n\nconst int blurSamplesNum = 63;\nconst float blurRadiusFactor = 0.01;//0.0125;\n\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId4 = (PI / 4.0);\nconst float PId8 = (PI / 8.0);\nconst float PHI = 1.618033988749895;\nconst float fibonacciBetaStep = (PIx2 / PHI);\n\nvec3 screenBlend (vec3 src, vec3 dst){\n    return (src + dst) - (src * dst);\n}\n\nvec3 multiplyBlend (vec3 src, vec3 dst){\n    return src * dst;\n}\n\n/* discontinuous pseudorandom uniformly distributed in [-0.5, +0.5]^3 */\nvec3 random3(vec3 c) {\n\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\tvec3 r;\n\tr.z = fract(512.0*j);\n\tj *= .125;\n\tr.x = fract(512.0*j);\n\tj *= .125;\n\tr.y = fract(512.0*j);\n\treturn r-0.5;\n}\n\n/* skew constants for 3d simplex functions */\nconst float F3 =  0.3333333;\nconst float G3 =  0.1666667;\n\n/* 3d simplex noise */\nfloat simplex3d(vec3 p) {\n\t /* 1. find current tetrahedron T and it's four vertices */\n\t /* s, s+i1, s+i2, s+1.0 - absolute skewed (integer) coordinates of T vertices */\n\t /* x, x1, x2, x3 - unskewed coordinates of p relative to each of T vertices*/\n\n\t /* calculate s and x */\n\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t vec3 x = p - s + dot(s, vec3(G3));\n\n\t /* calculate i1 and i2 */\n\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t vec3 i1 = e*(1.0 - e.zxy);\n\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\n\t /* x1, x2, x3 */\n\t vec3 x1 = x - i1 + G3;\n\t vec3 x2 = x - i2 + 2.0*G3;\n\t vec3 x3 = x - 1.0 + 3.0*G3;\n\n\t /* 2. find four surflets and store them in d */\n\t vec4 w, d;\n\n\t /* calculate surflet weights */\n\t w.x = dot(x, x);\n\t w.y = dot(x1, x1);\n\t w.z = dot(x2, x2);\n\t w.w = dot(x3, x3);\n\n\t /* w fades from 0.6 at the center of the surflet to 0.0 at the margin */\n\t w = max(0.6 - w, 0.0);\n\n\t /* calculate surflet components */\n\t d.x = dot(random3(s), x);\n\t d.y = dot(random3(s + i1), x1);\n\t d.z = dot(random3(s + i2), x2);\n\t d.w = dot(random3(s + 1.0), x3);\n\n\t /* multiply d by w^4 */\n\t w *= w;\n\t w *= w;\n\t d *= w;\n\n\t /* 3. return the sum of the four surflets */\n\t return dot(d, vec4(52.0));\n}\n\nvoid main(void){\n\n\t//-- GET SIMPLEX NOISE VALUE\n\tfloat scaleFactor = (((scale * 2.0) + 1.0) * 5.0);\n\n    vec2 point = vTextureCoord;//((vTextureCoord * mapDimensions) / dimensions);//mapCoord(vTextureCoord, filterArea) / dimensions;\n\n    // ADJUST PROPORTIONS SO NOISE RATIO REMAINS 1:1\n    point.x *= (mapDimensions.x / mapDimensions.y);\n    point.xy /= scaleFactor;\n\n    // RE-POSITION BASED ON SCALE (SO  NOISE IS SCALED FROM CENTER)\n    point.x += ((1.0 - (1.0 / scaleFactor)) / 2.0) * (dimensions.x / mapDimensions.x);\n    point.y += ((1.0 - (1.0 / scaleFactor)) / 2.0) * (dimensions.y / mapDimensions.y);\n\n\tvec3 point3D = vec3(point, (phase * 0.025));\n\n\tfloat noiseValue = simplex3d(point3D * 32.0);\n\tfloat noiseLumo = clamp(((0.3 + (noiseValue * 0.7)) * strength), 0.0, 1.0);\n\n\t//-- BLUR BASED ON NOISE - FIBONACCI SPIRAL (SUNFLOWER SEED POINT DISTRIBUTION)\n\n\tvec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n\tvec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n\tif (noiseLumo > 0.0){\n\n\t\tfloat maxSpread = (sqrt(pow(dimensions.x, 2.0) + pow(dimensions.y, 2.0)) * blurRadiusFactor);\n\t\tfloat spread = (maxSpread * noiseLumo);\n\t\tfloat spreadDistanceStep = (spread / (float(blurSamplesNum) + 1.0));\n\n\t\tfloat betaOffset = fibonacciBetaStep * noiseLumo * ((pixelCoord.y * dimensions.x) + pixelCoord.x);\n\n\t\tfor (int i = 10; i < (blurSamplesNum + 10); i++){\n\t\t\tvec2 samplePoint = unmapCoord(vec2(clamp((pixelCoord.x + (cos(fibonacciBetaStep * float(i) + betaOffset) * (spreadDistanceStep * float(i)))), 0.0, (dimensions.x - 1.0)), clamp((pixelCoord.y + (sin(fibonacciBetaStep * float(i) + betaOffset) * (spreadDistanceStep * float(i)))), 0.0, (dimensions.y - 1.0))), filterArea);\n\t\t\tpixelColor += texture2D(uSampler, samplePoint);\n\t\t}\n\t\tpixelColor /= (float(blurSamplesNum) + 1.0);\n\n\t\tif (lightness > 0.0){\n\t\t\tvec3 screenColor = screenBlend(pixelColor.rgb, pixelColor.rgb);\n\t\t\tpixelColor.rgb = mix(pixelColor.rgb, screenColor, (noiseLumo * lightness));\n\t\t}else\n\t\tif (lightness < 0.0){\n\t\t\tvec3 multiplyColor = multiplyBlend(pixelColor.rgb, pixelColor.rgb);\n\t\t\tpixelColor.rgb = mix(pixelColor.rgb, multiplyColor, (noiseLumo * abs(lightness)));\n\t\t}\n\n\t}\n\n\t//--\n\n\t//gl_FragColor = vec4(vec3(noiseLumo), 1.0); // SHOWS NOISE MAP\n\tgl_FragColor = pixelColor;\n\n}\n";var eh="#define GLSLIFY 1\n// NONAGON SPECIFIC CONSTANTS\nconst float bladeCount = 9.0;\n\nconst int dotsLayer1 = 9;\nconst int dotsLayer2 = 18;\nconst int dotsLayer3 = 27;\nconst int dotsLayer4 = 27;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else\n    if (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else\n    if (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else\n    if (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",th="#define GLSLIFY 1\n// OCTAGON SPECIFIC CONSTANTS\nconst float bladeCount = 8.0;\n\nconst int dotsLayer1 = 8;\nconst int dotsLayer2 = 16;\nconst int dotsLayer3 = 24;\nconst int dotsLayer4 = 24;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else\n    if (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else\n    if (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else\n    if (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",ih="#define GLSLIFY 1\n// HEPTAGON SPECIFIC CONSTANTS\nconst float bladeCount = 7.0;\n\nconst int dotsLayer1 = 7;\nconst int dotsLayer2 = 14;\nconst int dotsLayer3 = 21;\nconst int dotsLayer4 = 21;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else\n    if (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else\n    if (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else\n    if (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",rh="#define GLSLIFY 1\n// HEXAGON SPECIFIC CONSTANTS\nconst float bladeCount = 6.0;\n\nconst int dotsLayer1 = 6;\nconst int dotsLayer2 = 12;\nconst int dotsLayer3 = 18;\nconst int dotsLayer4 = 24;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else\n    if (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else\n    if (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else\n    if (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",ah="#define GLSLIFY 1\n// PENTAGON SPECIFIC CONSTANTS\nconst float bladeCount = 5.0;\n\nconst int dotsLayer1 = 5;\nconst int dotsLayer2 = 10;\nconst int dotsLayer3 = 15;\nconst int dotsLayer4 = 25;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else\n    if (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else\n    if (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else\n    if (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",nh="#define GLSLIFY 1\n// SQUARE SPECIFIC CONSTANTS\nconst float bladeCount = 4.0;\n\nconst int dotsLayer1 = 8;\nconst int dotsLayer2 = 16;\nconst int dotsLayer3 = 16;\nconst int dotsLayer4 = 24;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else\n    if (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else\n    if (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else\n    if (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",oh="#define GLSLIFY 1\n// TRIANGLE SPECIFIC CONSTANTS\nconst float bladeCount = 3.0;\n\nconst int dotsLayer1 = 6;\nconst int dotsLayer2 = 9;\nconst int dotsLayer3 = 15;\nconst int dotsLayer4 = 24;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else\n    if (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else\n    if (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else\n    if (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    gl_FragColor = pixelColor;\n\n}\n",sh="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float radius;\nuniform float aperture;\nuniform float bladeCount;\n\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\nuniform float currentPass;\n\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\nuniform float pass1Radius;\nuniform float pass1Layers;\nuniform float pass2Radius;\nuniform float pass2Layers;\nuniform float pass3Radius;\nuniform float pass3Layers;\nuniform float pass4Radius;\nuniform float pass4Layers;\n\n// TRIANGLE\nconst int dotsX3Layer1 = 6;\nconst int dotsX3Layer2 = 9;//12;\nconst int dotsX3Layer3 = 15;//18;\nconst int dotsX3Layer4 = 24;\nconst int dotsX3Total = (dotsX3Layer1 + dotsX3Layer2 + dotsX3Layer3 + dotsX3Layer4);\n\n// SQUARE\nconst int dotsX4Layer1 = 8;//4;\nconst int dotsX4Layer2 = 16;//8;\nconst int dotsX4Layer3 = 16;//12;\nconst int dotsX4Layer4 = 24;//16;\nconst int dotsX4Total = (dotsX4Layer1 + dotsX4Layer2 + dotsX4Layer3 + dotsX4Layer4);\n\n// PENTAGON\nconst int dotsX5Layer1 = 5;\nconst int dotsX5Layer2 = 10;\nconst int dotsX5Layer3 = 15;\nconst int dotsX5Layer4 = 25;//20;\nconst int dotsX5Total = (dotsX5Layer1 + dotsX5Layer2 + dotsX5Layer3 + dotsX5Layer4);\n\n// HEXAGON\nconst int dotsX6Layer1 = 6;\nconst int dotsX6Layer2 = 12;\nconst int dotsX6Layer3 = 18;\nconst int dotsX6Layer4 = 24;\nconst int dotsX6Total = (dotsX6Layer1 + dotsX6Layer2 + dotsX6Layer3 + dotsX6Layer4);\n\n// HEPTAGON\nconst int dotsX7Layer1 = 7;\nconst int dotsX7Layer2 = 14;\nconst int dotsX7Layer3 = 21;\nconst int dotsX7Layer4 = 21;//28;\nconst int dotsX7Total = (dotsX7Layer1 + dotsX7Layer2 + dotsX7Layer3 + dotsX7Layer4);\n\n// OCTAGON\nconst int dotsX8Layer1 = 8;\nconst int dotsX8Layer2 = 16;\nconst int dotsX8Layer3 = 24;\nconst int dotsX8Layer4 = 24;//32;\nconst int dotsX8Total = (dotsX8Layer1 + dotsX8Layer2 + dotsX8Layer3 + dotsX8Layer4);\n\n// NONAGON\nconst int dotsX9Layer1 = 9;\nconst int dotsX9Layer2 = 18;\nconst int dotsX9Layer3 = 27;\nconst int dotsX9Layer4 = 27;\nconst int dotsX9Total = (dotsX9Layer1 + dotsX9Layer2 + dotsX9Layer3 + dotsX9Layer4);\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    vec3 dotData = vec3(0.0); // x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        dotData.x = float(dotIndex);\n        dotData.y = float(dotsLayer1);\n        dotData.z = (radius * 1.0);\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        dotData.x = float(dotIndex - dotsLayer1);\n        dotData.y = float(dotsLayer2);\n        dotData.z = (radius * 2.0);\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        dotData.x = float(dotIndex - dotsLayer1 - dotsLayer2);\n        dotData.y = float(dotsLayer3);\n        dotData.z = (radius * 3.0);\n    }else\n    if (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        dotData.x = float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3);\n        dotData.y = float(dotsLayer4);\n        dotData.z = (radius * 4.0);\n    }\n\n    return dotData;\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = 0;\n\n    // TRIANGLE\n    if (bladeCount == 3.0){\n        dotsTotal = dotsX3Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX3Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX3Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX3Layer2;\n    }\n\n    // SQUARE\n    if (bladeCount == 4.0){\n        dotsTotal = dotsX4Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX4Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX4Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX4Layer2;\n    }\n\n    // PENTAGON\n    if (bladeCount == 5.0){\n        dotsTotal = dotsX5Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX5Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX5Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX5Layer2;\n    }\n\n    // HEXAGON\n    if (bladeCount == 6.0){\n        dotsTotal = dotsX6Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX6Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX6Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX6Layer2;\n    }\n\n    // HEPTAGON\n    if (bladeCount == 7.0){\n        dotsTotal = dotsX7Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX7Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX7Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX7Layer2;\n    }\n\n    // OCTAGON\n    if (bladeCount == 8.0){\n        dotsTotal = dotsX8Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX8Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX8Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX8Layer2;\n    }\n\n    // NONAGON\n    if (bladeCount == 9.0){\n        dotsTotal = dotsX9Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX9Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX9Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX9Layer2;\n    }\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    const int maxSamples = dotsX9Total;\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < maxSamples; i++){\n\n        int takeSample = 0;\n\n        // TRIANGLE\n        if (bladeCount == 3.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX3Layer1, dotsX3Layer2, dotsX3Layer3, dotsX3Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // SQUARE\n        if (bladeCount == 4.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX4Layer1, dotsX4Layer2, dotsX4Layer3, dotsX4Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // PENTAGON\n        if (bladeCount == 5.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX5Layer1, dotsX5Layer2, dotsX5Layer3, dotsX5Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // HEXAGON\n        if (bladeCount == 6.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX6Layer1, dotsX6Layer2, dotsX6Layer3, dotsX6Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // HEPTAGON\n        if (bladeCount == 7.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX7Layer1, dotsX7Layer2, dotsX7Layer3, dotsX7Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // OCTAGON\n        if (bladeCount == 8.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX8Layer1, dotsX8Layer2, dotsX8Layer3, dotsX8Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // NONAGON\n        if (bladeCount == 9.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX9Layer1, dotsX9Layer2, dotsX9Layer3, dotsX9Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        //--\n\n        if (takeSample == 1){\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n        }\n\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else\n    if (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else\n    if (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else\n    if (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n";var lh="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\nuniform float padding;\n\nuniform float spreadAmount;\nuniform int horizontal;\n\nconst float w0 = 0.22;\nconst float w1 = 0.18;\nconst float w2 = 0.13;\nconst float w3 = 0.08;\n\nvec2 clampPixelCoord(vec2 pixelCoord){\n    return clamp(pixelCoord, vec2(padding), (dimensions - vec2(padding)));\n}\n\nvoid main(void){\n\n    vec2 pixelCoord = clampPixelCoord(mapCoord(vTextureCoord, filterArea));\n\n    //--\n\n    vec4 colorCC = texture2D(uSampler, unmapCoord(pixelCoord, filterArea));\n    if (colorCC.a == 0.0){\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    vec4 maskColorCC = texture2D(maskTexture, (pixelCoord / dimensions));\n    if ((maskColorCC.a == 1.0 && (maskTextureInverted == 0)) || (maskColorCC.a == 0.0 && (maskTextureInverted == 1))){\n        gl_FragColor = colorCC;\n        return;\n    }\n\n    //--\n\n    float spread = (spreadAmount * ((maskTextureInverted == 1) ? maskColorCC.a : (1.0 - maskColorCC.a)));\n\n    //--\n\n    vec2 sampleCoordA1 = (pixelCoord - vec2(((horizontal == 1) ? (spread * (1.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (1.0 / 3.0)))));\n    vec2 sampleCoordA2 = (pixelCoord - vec2(((horizontal == 1) ? (spread * (2.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (2.0 / 3.0)))));\n    vec2 sampleCoordA3 = (pixelCoord - vec2(((horizontal == 1) ? (spread * (3.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (3.0 / 3.0)))));\n\n    vec2 sampleCoordB1 = (pixelCoord + vec2(((horizontal == 1) ? (spread * (1.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (1.0 / 3.0)))));\n    vec2 sampleCoordB2 = (pixelCoord + vec2(((horizontal == 1) ? (spread * (2.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (2.0 / 3.0)))));\n    vec2 sampleCoordB3 = (pixelCoord + vec2(((horizontal == 1) ? (spread * (3.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (3.0 / 3.0)))));\n\n    //--\n\n    vec4 maskColorA1 = texture2D(maskTexture, (sampleCoordA1 / dimensions));\n    vec4 maskColorA2 = texture2D(maskTexture, (sampleCoordA2 / dimensions));\n    vec4 maskColorA3 = texture2D(maskTexture, (sampleCoordA3 / dimensions));\n\n    vec4 maskColorB1 = texture2D(maskTexture, (sampleCoordB1 / dimensions));\n    vec4 maskColorB2 = texture2D(maskTexture, (sampleCoordB2 / dimensions));\n    vec4 maskColorB3 = texture2D(maskTexture, (sampleCoordB3 / dimensions));\n\n    //--\n\n    vec4 colorA1 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordA1), filterArea));\n    vec4 colorA2 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordA2), filterArea));\n    vec4 colorA3 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordA3), filterArea));\n\n    vec4 colorB1 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordB1), filterArea));\n    vec4 colorB2 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordB2), filterArea));\n    vec4 colorB3 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordB3), filterArea));\n\n    //--\n\n    colorA1 = mix(colorA1, colorCC, ((maskTextureInverted == 1) ? (1.0 - maskColorA1.a) : maskColorA1.a));\n    colorA2 = mix(colorA2, colorA1, ((maskTextureInverted == 1) ? (1.0 - maskColorA2.a) : maskColorA2.a));\n    colorA3 = mix(colorA3, colorA2, ((maskTextureInverted == 1) ? (1.0 - maskColorA3.a) : maskColorA3.a));\n\n    colorB1 = mix(colorB1, colorCC, ((maskTextureInverted == 1) ? (1.0 - maskColorB1.a) : maskColorB1.a));\n    colorB2 = mix(colorB2, colorB1, ((maskTextureInverted == 1) ? (1.0 - maskColorB2.a) : maskColorB2.a));\n    colorB3 = mix(colorB3, colorB2, ((maskTextureInverted == 1) ? (1.0 - maskColorB3.a) : maskColorB3.a));\n\n    //--\n\n    colorCC *= w0;\n\n    colorA1 *= w1;\n    colorA2 *= w2;\n    colorA3 *= w3;\n\n    colorB1 *= w1;\n    colorB2 *= w2;\n    colorB3 *= w3;\n\n    //--\n\n    vec4 blurColor = (colorCC + colorA1 + colorA2 + colorA3 + colorB1 + colorB2 + colorB3);\n\n    //--\n\n    gl_FragColor = blurColor;\n\n}\n";var hh="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec3 gammaCorrection(vec3 color, float gamma) {\n\treturn pow(color, 1.0 / vec3(gamma));\n}\n\nvec3 levelsControlInputRange(vec3 color, float minInput, float maxInput) {\n\n  return min(max(color - minInput, 0.0) / (maxInput - minInput+0.0001), 1.0);\n\n}\n\nvec3 levelsControlInput(vec3 color, float minInput, float gamma, float maxInput) {\n\treturn gammaCorrection(levelsControlInputRange(color, minInput, maxInput), gamma);\n\n}\n\nvec3 levelsControlOutputRange(vec3 color, float minOutput, float maxOutput) {\n\treturn mix(vec3(minOutput), vec3(maxOutput), color);\n\n}\n\nvec3 levelsControl(vec3 color, float minInput, float gamma, float maxInput, float minOutput, float maxOutput) {\n\treturn levelsControlOutputRange(levelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float amount;\nuniform int large;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\nuniform sampler2D bgTexture;\n\nuniform int mode;\n\nuniform float threshold;\nuniform float intensity;\n\n//--\n\nvec3 lightenBlend (vec3 front, vec3 back, float opacity){\n    return max(front, back) * opacity + back * (1.0 - opacity);\n}\n\nvec3 screenBlend (vec3 src, vec3 dst){\n    return (src + dst) - (src * dst);\n}\n\n//--\n\nvec3 gentleBlur(vec3 pixelColor, vec2 pixelCoord){\n\n    vec2 minCoord = vec2(0.0);\n    vec2 maxCoord = dimensions;\n\n    pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x - 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 0.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // L\n    pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 0.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // R\n    pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 0.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y - 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // T\n    pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 0.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // B\n\n    if (large == 1){\n\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x - 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y - 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // TL\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 0.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y - 2.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // T2\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y - 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // TR\n\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x - 2.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 0.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // L2\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 2.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 0.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // R2\n\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x - 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // BL\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 0.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 2.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // B2\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // BR\n\n        pixelColor.rgb /= 13.0;\n\n    }else{\n\n        pixelColor.rgb /= 5.0;\n\n    }\n\n    return pixelColor.rgb;\n\n}\n\n//--\n\nvoid main(void){\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    //--\n\n    pixelColor.rgb = gentleBlur(pixelColor.rgb, pixelCoord); // GENTLE BLUR\n\n    //--\n\n    if (mode == 1){ // FIRST BOKEH PASS\n\n        pixelColor.rgb = pow(pixelColor.rgb, vec3(threshold));\n\n        float gamma = (1.1 - (0.5 * intensity));\n        float maxInputValue = (1.0 - (0.18 * intensity));\n        pixelColor.rgb = levelsControl(pixelColor.rgb, 0.0, gamma, maxInputValue, 0.0, 1.0);\n\n        //--\n\n        vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n        vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n        maskPixelColor.a = (maskTextureInverted == 1) ? (1.0 - maskPixelColor.a) : maskPixelColor.a;\n\n        pixelColor.rgb = clamp((pixelColor.rgb - vec3(maskPixelColor.a)), vec3(0.0), vec3(1.0));\n\n    }else\n    if (mode == 2){ // LAST BOKEH PASS\n\n        vec3 contrastedPixelColor = (pixelColor.rgb * pixelColor.rgb * (1.0 + (amount * 0.8)));\n        // vec3 contrastedPixelColor = pow(pixelColor.rgb, vec3(threshold));// * 1.5;//1.8;\n\n        pixelColor.rgb = lightenBlend(contrastedPixelColor, pixelColor.rgb, amount);\n\n        //--\n\n        vec2 bgPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0); // vTextureCoord;\n        vec4 bgPixelColor = texture2D(bgTexture, bgPixelCoord);\n\n        pixelColor.rgb = screenBlend(pixelColor.rgb, bgPixelColor.rgb);\n\n    }\n\n    //--\n\n\tgl_FragColor = pixelColor;\n\t\n}\n";var ch="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform float tolerance;\n\nuniform vec2 onePixel;\nuniform vec2 dimensions;\n\nuniform sampler2D unionTexture;\n\nuniform vec3 selectionColor;\n\nvoid main(void){\n\n    vec4 unionColor = texture2D(unionTexture, clamp((vTextureCoord / dimensions), 0.0, 1.0));\n\n    if (unionColor.a < 1.0){\n\n        vec2 cTextureCoord = (dimensions * 0.5); // ADJUSTED CENTER COORDINATE\n        vec2 dTextureCoord = (vTextureCoord - cTextureCoord); // X & Y DISTANCE TO CENTER\n        float centerDistance = sqrt(pow(dTextureCoord.x, 2.0) + pow(dTextureCoord.y, 2.0)); // DIRECT DISTANCE TO CENTER\n\n        float outerRadius = min(cTextureCoord.x, cTextureCoord.y);\n\n        if (centerDistance < outerRadius){\n\n            vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n            vec4 centerColor = texture2D(uSampler, cTextureCoord);\n\n            float colorDistance = distance(pixelColor, centerColor);\n            colorDistance = step(tolerance, colorDistance);\n\n            // EDGE FEATHER FACTOR\n            float innerRadius = (outerRadius - (onePixel.x * 2.0));\n            float edgeFeatherFactor = smoothstep(outerRadius, innerRadius, centerDistance);\n\n            //--\n\n            float unionAlpha = max(unionColor.a, edgeFeatherFactor);\n            unionColor = mix(vec4((selectionColor * unionAlpha), unionAlpha), vec4(0.0), colorDistance);\n\n        }\n\n    }\n\n\tgl_FragColor = unionColor;\n\n}\n";var uh="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n\n   gl_FragColor = texture2D(uSampler, clamp(vTextureCoord,filterClamp.xy,filterClamp.zw));\n\n}\n";var dh="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",mh="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec2 onePixel;\nuniform float threshold;\nconst float radius = 11.0;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n       float n = 0.0;\n       vec2 uv = vTextureCoord;\n       vec4 inputPixel =  texture2D(uSampler,vTextureCoord);\n\n       vec4 offset;\n       vec4 accum = vec4(0.0);\n\n      for (float x = -radius; x <= radius; x++)\n        {\n           for (float y = -radius; y <= radius; y++)\n               {\n                    offset = texture2D(uSampler, clamp(vTextureCoord + vec2(x ,y)*onePixel,vec2(0.0,0.0),vec2(clampX,clampY)));\n                    float multiplyDist = step(length(vec2(x,y)), radius);\n                    float multiplyCol = step(distance(offset, inputPixel), threshold);\n\n                    accum += offset * multiplyDist * multiplyCol;\n\n                   n += multiplyDist * multiplyCol;\n               }\n        }\n        gl_FragColor = vec4(accum / n);\n\n}\n";var ph="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 filterClamp;\n\nvoid main(void){\n\n    vec4 color = texture2D(uSampler, clamp(vTextureCoord,filterClamp.xy,filterClamp.zw));\n\n    vec3 result = mix(vec3(1.0,1.0,1.0),vec3(1.0,0.0,1.0),1.0-color.a);\n\n    gl_FragColor = vec4(result,1.0);\n\n}\n";var gh="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 color1) {\n\n    return setlum(color1, getLumo_0(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color;\n\nvoid main(void){\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    if (pixelColor.r > 0.66 && pixelColor.g > 0.66 && pixelColor.b > 0.66){\n        // WHITE -> GREEN\n        pixelColor = vec4(0.0, 1.0, 0.0, .25);\n    }else\n    if (pixelColor.r < 0.33 && pixelColor.g < 0.33 && pixelColor.b < 0.33){\n        // BLACK -> RED\n        pixelColor = vec4(1.0, 0.0, 0.0, .5);\n    }else{\n        // GREY -> FUCHSIA\n        pixelColor = vec4(1.0, 0.0, 1.0, .25);\n    }\n\n    pixelColor.rgb *= pixelColor.a;\n\n    gl_FragColor = pixelColor;\n\n}\n";var fh="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 filtered = texture2D(uSampler, vTextureCoord);\n    vec4 original = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    gl_FragColor = (filtered * original.a);\n\n}\n";var vh="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float thickness;\nuniform vec4 outlineColor;\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nvec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);\n\nvoid main(void) {\n    const float PI = 3.14159265358979323846264;\n    vec4 ownColor = texture2D(uSampler, vTextureCoord);\n    vec4 curColor;\n    float maxAlpha = 0.;\n     vec2 displaced;\n    for (float angle = 0.; angle < PI * 2.; angle += %THICKNESS% ) {\n        displaced.x = vTextureCoord.x + thickness * px.x * cos(angle);\n        displaced.y = vTextureCoord.y + thickness * px.y * sin(angle);\n        curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));\n        maxAlpha = max(maxAlpha, curColor.a);\n    }\n    float resultAlpha = max(maxAlpha, ownColor.a);\n    gl_FragColor = vec4((ownColor.rgb + outlineColor.rgb * (1. - ownColor.a)) * resultAlpha, resultAlpha);\n}\n";var yh="#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives:enable\n#endif\n\nprecision mediump float;\n#define GLSLIFY 1\n\nuniform vec4 filterArea;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec2 dimensions;\nuniform vec2 spriteSize;\nuniform float useTexture;\nuniform float getCornerRadiusFromShortestSide;\n\nuniform float strokeWidth;\nuniform float cornerRadius;\nuniform vec4 strokeColor;\nuniform vec4 fillColor;\nuniform float quality;\nuniform float edgePaddingX;\nuniform float edgePaddingY;\n\nfloat RoundRectangle(vec2 distFromCenter, vec2 halfSize, float radius)\n{\n\t\tfloat len = length(max(abs(distFromCenter) - (halfSize - radius), vec2(0.0))) - radius;\n        float delta = 0.0;\n\t\t#ifdef GL_OES_standard_derivatives\n          delta = fwidth(len)*quality;\n        #else\n          delta = 0.5 * quality;\n        #endif\n\n    \tfloat result = 1.0;\n    \tif(radius==0.0) {\n    \t    result = step(min(halfSize.x,halfSize.y)/min(dimensions.x,dimensions.y),len);\n    \t} else {\n    \t    result = smoothstep(-delta,+delta,len);\n    \t}\n    \treturn result;\n\n}\n\nvoid main()\n{\n      //  vec2 exPixels  = 1.0+(expandPixels*2.0/dimensions);\n        vec2 pixelCoord = vTextureCoord  * filterArea.xy;\n\n        //minus edgePadding from coords for edge bleeding, give space for interpolation\n\n        pixelCoord -= vec2(edgePaddingX,edgePaddingY);\n\n        // rectangle 1 stroke\n        //minus edgePadding from size for edge bleeding, give space for interpolation\n        vec2 size = vec2(dimensions.x,dimensions.y)-vec2((edgePaddingX*2.0), (edgePaddingY*2.0));\n        vec2 halfSize = size / 2.0;\n        vec2 rectCenter = size/2.0;\n\n        float scaledCornerRadius = cornerRadius;\n        if (spriteSize.x > 0.0 && spriteSize.y > 0.0){\n            scaledCornerRadius = scaledCornerRadius * min((dimensions.x / spriteSize.x), (dimensions.y / spriteSize.y));\n        }\n\n        if (getCornerRadiusFromShortestSide == 1.0){\n            scaledCornerRadius = min(dimensions.x, dimensions.y) / 2.0;\n        }\n\n        float radius = max(min(min(size.x,size.y)/2.0,scaledCornerRadius),0.0);\n        float genStroke = RoundRectangle(pixelCoord - rectCenter, halfSize, radius);\n\n        // rectangle 2 fill\n        vec2 fillSize = vec2(size.x-strokeWidth*2.0,size.y-strokeWidth*2.0);\n        vec2 fillHalfSize = fillSize / 2.0;\n        vec2 fillRectCenter = vec2(size/2.0);\n        float fillRadius = max(radius-strokeWidth,0.0);\n        float genFill = RoundRectangle(pixelCoord - fillRectCenter, fillHalfSize, fillRadius);\n        vec4 _strokeColor = strokeColor;\n        if(strokeWidth == 0.0) {\n            _strokeColor = vec4(0.0);\n        }\n\n        //--\n\n        // PRE-MULTIPLY ALPHAS\n        vec4 _fillColor = fillColor;\n        _fillColor.rgb *= _fillColor.a;\n        _strokeColor.rgb *= _strokeColor.a;\n\n        //--\n\n        vec4 result =  mix(_strokeColor, vec4(0.0), genStroke);\n\n        if(useTexture == 0.0){\n            result =  mix(_fillColor, result, genFill);\n//            result.rgb *= result.a;\n        } else {\n            vec4 inputImage = texture2D(uSampler, vTextureCoord);\n            result =  mix(inputImage, result, genFill);\n        }\n\n    //    result = mix(vec4(1.0,0.0,0.0,1.0),result,1.0 - genStroke);\n\n        gl_FragColor = result;//texture2D(uSampler, vTextureCoord/exPixels);\n\n}\n";var xh="#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives:enable\n#endif\n\nprecision mediump float;\n#define GLSLIFY 1\n\nuniform vec4 filterArea;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec2 dimensions;\nuniform float strokeWidth;\nuniform float quality;\nuniform vec4 fillColor;\nuniform vec4 strokeColor;\nuniform float edgePadding;\n\nfloat Circle(vec2 distFromCenter, vec2 halfSize, float radius)\n{\n    float len = length(abs(distFromCenter));\n    float delta = 0.0;\n    #ifdef GL_OES_standard_derivatives\n      delta = fwidth(len)*quality;\n    #else\n      delta = 0.5 * quality;\n    #endif\n    return smoothstep(radius-delta,radius+delta,len);\n\n}\n\nvoid main()\n{\n\n        vec2 pixelCoord = vTextureCoord  * filterArea.xy;\n\n        //minus edgePadding from coords for edge bleeding, give space for interpolation\n\n        pixelCoord -= vec2(edgePadding,edgePadding);\n\n        // rectangle 1 stroke\n        //minus edgePadding from size for edge bleeding, give space for interpolation\n        vec2 size = vec2(dimensions.x,dimensions.y)-vec2(edgePadding*2.0);\n\n        vec2 halfSize = size / 2.0;\n        vec2 rectCenter = size/2.0;\n\n        vec2 pos = pixelCoord-rectCenter;\n        vec2 posFill = pixelCoord-rectCenter;\n\n        //limit stroke width\n        float _strokeWidth = min(size.y/2.0-1.0,strokeWidth);\n\n        //adjust aspect ratio for stroke\n        pos.x *= size.y/size.x;\n\n        //adjust aspect ratio for fill\n        posFill.x *= (size.y-_strokeWidth*2.0)/(size.x-_strokeWidth*2.0);\n\n         //minus edgePadding from radius for edge bleeding, give space for interpolation\n        float radiusStroke = (size.y/2.0);\n\n        float radiusFill = max(radiusStroke-_strokeWidth,0.0);\n\n        //calculate distance for stroke\n        float lengthCenter = Circle(pos,halfSize,radiusStroke);\n\n        //calculate distance for fill\n        float lengthCenter2 = Circle(posFill,halfSize,radiusFill);\n\n        vec4 _strokeColor = strokeColor;\n\n        if(_strokeWidth == 0.0) {\n            _strokeColor = vec4(0.0);\n        }\n\n        //--\n\n        // PRE-MULTIPLY ALPHAS\n        vec4 _fillColor = fillColor;\n        _fillColor.rgb *= _fillColor.a;\n        _strokeColor.rgb *= _strokeColor.a;\n\n        //--\n\n        //fill the colors\n        vec4 result =  mix(_strokeColor, vec4(0.0), lengthCenter);\n        result =  mix(_fillColor, result, lengthCenter2);\n\n//        result = mix(vec4(1.0,0.0,0.0,1.0),result,1.0 - lengthCenter);\n\n        gl_FragColor = result;\n}\n";var _h="#define GLSLIFY 1\nuniform vec4 filterArea;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec2 dimensions;\n\nuniform float dashSize;\nuniform float direction;\nuniform vec4 fillColor;\nuniform vec4 alternateColor;\n\nfloat lines(float coord, float size) {\n\tfloat result = fract((coord)*size);\n\treturn step(0.5,result);\n}\n\nvoid main()\n{\n         vec2 coord = vTextureCoord*(filterArea.xy/dimensions);\n\n         float lineDirection;\n\n         if(direction==-1.0) {\n             lineDirection = dimensions.x>dimensions.y ? 0.0 : 1.0;\n         }\n         else {\n            lineDirection = direction;\n         }\n\n         float dir;\n         float lineSize;\n\n         if(lineDirection==0.0) {\n            dir = coord.x;\n            lineSize = dimensions.x/dashSize;\n\n         } else {\n            dir = coord.y;\n            lineSize = dimensions.y/dashSize;\n         }\n\n \t     float genLines = lines(dir,lineSize);\n\n \t     vec4 color1 = fillColor;\n \t     vec4 color2 = alternateColor;\n\n         gl_FragColor = mix(color1,color2,genLines);\n\n}\n";Object.assign(BFN.filters,{RoundedRectFilter:class extends PIXI.Filter{constructor(){super(ta,yh),this.padding=0,this.cornerRadius=1,this.strokeWidth=4,this.quality=.75,this.edgePadding=1,this.strokeColor=4278190080,this.fillColor=4294967295,this.spriteSize=[0,0],this.useTexture=0,this.getCornerRadiusFromShortestSide=0}apply(e,t,i,r){0!=this.cornerRadius?this.padding=0:this.padding=1,this.uniforms.dimensions[0]=t.sourceFrame.width,this.uniforms.dimensions[1]=t.sourceFrame.height,e.applyFilter(this,t,i,r)}get useTexture(){return this.uniforms.useTexture}set useTexture(e){this.uniforms.useTexture=e}get spriteSize(){return this.uniforms.spriteSize}set spriteSize(e){this.uniforms.spriteSize=e}get cornerRadius(){return this.uniforms.cornerRadius}set cornerRadius(e){this.uniforms.cornerRadius=e}get getCornerRadiusFromShortestSide(){return this.uniforms.getCornerRadiusFromShortestSide}set getCornerRadiusFromShortestSide(e){this.uniforms.getCornerRadiusFromShortestSide=e}get strokeWidth(){return this.uniforms.strokeWidth}set strokeWidth(e){this.uniforms.strokeWidth=e}get quality(){return this.uniforms.quality}set quality(e){this.uniforms.quality=e}get edgePadding(){return this.uniforms.edgePaddingX}set edgePadding(e){this.edgePaddingX=e,this.edgePaddingY=e}get edgePaddingX(){return this.uniforms.edgePaddingX}set edgePaddingX(e){this.uniforms.edgePaddingX=e}get edgePaddingY(){return this.uniforms.edgePaddingY}set edgePaddingY(e){this.uniforms.edgePaddingY=e}get strokeColor(){return this.uniforms.strokeColor}set strokeColor(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.strokeColor=e}get fillColor(){return this.uniforms.fillColor}set fillColor(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.fillColor=e}},EllipseFilter:class extends PIXI.Filter{constructor(){super(ta,xh),this.padding=0,this.strokeWidth=4,this.quality=.75,this.edgePadding=1,this.strokeColor=4278190080,this.fillColor=4294967295}apply(e,t,i,r){this.uniforms.dimensions[0]=t.sourceFrame.width,this.uniforms.dimensions[1]=t.sourceFrame.height,e.applyFilter(this,t,i,r)}get strokeWidth(){return this.uniforms.strokeWidth}set strokeWidth(e){this.uniforms.strokeWidth=e}get quality(){return this.uniforms.quality}set quality(e){this.uniforms.quality=e}get edgePadding(){return this.uniforms.edgePadding}set edgePadding(e){this.uniforms.edgePadding=e}get strokeColor(){return this.uniforms.strokeColor}set strokeColor(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.strokeColor=e}get fillColor(){return this.uniforms.fillColor}set fillColor(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.fillColor=e}},DashedLineFilter:class extends PIXI.Filter{constructor(){super(ta,_h),this.padding=0,this.dashSize=12,this.fillColor=2516582400,this.alternateColor=2164260863,this.direction=-1}apply(e,t,i,r){this.uniforms.dimensions[0]=t.sourceFrame.width,this.uniforms.dimensions[1]=t.sourceFrame.height,e.applyFilter(this,t,i,r)}get direction(){return this.uniforms.direction}set direction(e){this.uniforms.direction=e}get dashSize(){return this.uniforms.dashSize}set dashSize(e){this.uniforms.dashSize=e}get fillColor(){return this.uniforms.fillColor}set fillColor(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.fillColor=e}get alternateColor(){return this.uniforms.alternateColor}set alternateColor(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.alternateColor=e}}}),Object.assign(BFN.filters,{NoneFilters:class extends PIXI.Filter{constructor(){super(ta,ia),this.padding=0}},ColorFilter:class extends PIXI.Shader{constructor(e){super(e,ta,ra)}get hue(){return this._hue}set hue(e){this._hue=e}get saturation(){return this._saturation}set saturation(e){this._saturation=e}get temperature(){return this._temperature}set temperature(e){this._temperature=e}applyParams(e){this.uniforms.hue=this.hue,this.uniforms.saturation=this.saturation,this.uniforms.temperature=this.temperature}},ExposureFilter:class extends PIXI.Shader{constructor(e){super(e,ta,aa),this.channelTextures={0:"def",1:"blurImage"}}get brightness(){return this._brightness}set brightness(e){this._brightness=e}get contrast(){return this._contrast}set contrast(e){this._contrast=e}get highlights(){return this._highlights}set highlights(e){this._highlights=e}get shadows(){return this._shadows}set shadows(e){this._shadows=e}get blurImage(){return this._blurImage}set blurImage(e){this._blurImage=e}applyParams(e){this.uniforms.shadows=this.shadows,this.uniforms.highlights=this.highlights,this.uniforms.contrast=this.contrast,this.uniforms.brightness=this.brightness}},LensTintFilter:class extends PIXI.Filter{constructor(){super(ta,na),this.padding=0}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},HSFilter:class extends PIXI.Filter{constructor(){super(ta,oa),this.padding=0}get highlights(){return this.uniforms.highlights}set highlights(e){this.uniforms.highlights=e}get shadows(){return this.uniforms.shadows}set shadows(e){this.uniforms.shadows=e}},FillLightFilter:class extends PIXI.Shader{constructor(e){super(e,la,sa),this.channelTextures={0:"def",1:"blurImage"}}get intensity(){return this._intensity}set intensity(e){this._intensity=e}get blurImage(){return this._blurImage}set blurImage(e){this._blurImage=e}applyParams(e){this.uniforms.intensity=this.intensity}},GaussianBlurFilter:class extends PIXI.Filter{constructor(e,t,i,r,a){super(),this.blurXFilter=new ua(e,i),this.blurYFilter=new ma(e,i),this.kSize=r,this.res1=i||null,this.resolution=i||("large"==r?BFN.renderTextureResolutionLarge:BFN.renderTextureResolution),this.quality=t||1,this.oneDirection=a,a||(this.blur=e||5),this.setParameters()}setInputDimensions(e,t){if(e>0&&t>0&&(this.inputW!==e||this.inputH!==t)){this.inputW=e,this.inputH=t;var i=BFN.Util.calculateRes(this.inputW,this.inputH);this.resSmall=i.small,this.resLarge=i.large}}setParameters(){this.resolution=this.res1||("large"==this.kSize?this.resLarge||BFN.renderTextureResolutionLarge:this.resSmall||BFN.renderTextureResolution),this.padding=Math.max(.5/this.resolution,1),this.blurXFilter.clipPadding=2*this.padding,this.blurYFilter.clipPadding=2*this.padding,this.oneDirection?"x"==this.oneDirection?this.blurXFilter.resolution=this.resolution:this.blurYFilter.resolution=this.resolution:(this.blurXFilter.resolution=this.resolution,this.blurYFilter.resolution=this.resolution)}apply(e,t,i){if(this.setParameters(),this.oneDirection)"x"==this.oneDirection?this.blurXFilter.apply(e,t,i):this.blurYFilter.apply(e,t,i);else{var r=e.getRenderTarget(!0);this.blurXFilter.apply(e,t,r,!0),this.blurYFilter.apply(e,r,i,!1),e.returnRenderTarget(r)}}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e}},GrayFilter:class extends PIXI.Filter{constructor(){super(pa,ga),this.amount=1,this.padding=0}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get amount(){return this.uniforms.amount}set amount(e){this.uniforms.amount=e}},InvertFilter:class extends PIXI.Filter{constructor(){super(fa,va),this.uniforms.amount=1}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get amount(){return this.uniforms.amount}set amount(e){this.uniforms.amount=e}},LevelsFilter:class extends PIXI.Filter{constructor(){var e;super(ta,ya),BFN.Stage.filterManager.shaderCache[this.glShaderKey]||(e=new PIXI.Shader(BFN.Stage.gl,this.vertexSrc,this.fragmentSrc),this.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[this.glShaderKey]=e),this.minInputValue=0,this.gamma=1,this.maxInputValue=1,this.minOutputValue=0,this.maxOutputValue=1}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get minInputValue(){return this.uniforms.minInputValue}set minInputValue(e){this.uniforms.minInputValue=e}get gamma(){return this.uniforms.gamma}set gamma(e){this.uniforms.gamma=e}get maxInputValue(){return this.uniforms.maxInputValue}set maxInputValue(e){this.uniforms.maxInputValue=e}get minOutputValue(){return this.uniforms.minOutputValue}set minOutputValue(e){this.uniforms.minOutputValue=e}get maxOutputValue(){return this.uniforms.maxOutputValue}set maxOutputValue(e){this.uniforms.maxOutputValue=e}},LutFilter:class extends PIXI.Filter{constructor(){super(_a,xa),this.intensity=1}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=e}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){e.baseTexture.isPowerOfTwo=!1,this.uniforms.iChannel1=e}},SurfaceBlurFilter:class extends PIXI.Filter{constructor(e,t,i){super(),this.blurXFilter=new ba,this.blurYFilter=new Ca,this.padding=0,this.resolution=i||1,this.blur=e||1,this.threshold=t||.1}apply(e,t,i){var r=e.getRenderTarget(!0);this.blurXFilter.resolution=this.resolution,this.blurYFilter.resolution=this.resolution,this.blurXFilter.apply(e,t,r,!1),this.blurYFilter.apply(e,r,i,!1),e.returnRenderTarget(r)}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e}get threshold(){return this.blurYFilter.blur}set threshold(e){this.blurXFilter.threshold=this.blurYFilter.threshold=e}},UnsharpMaskFilter:class extends PIXI.Filter{constructor(){super(Pa,Ea),this.padding=0,this.intensity=1,this.intensityMultiplier=1.5}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=e}get intensityMultiplier(){return this.uniforms.intensityMultiplier}set intensityMultiplier(e){this.uniforms.intensityMultiplier=e}get blurImage(){return this.uniforms.blurImage}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},AdaptiveSharpnessFilter:class extends PIXI.Filter{constructor(){super(Ma,Na),this.padding=0,this.intensity=1}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=e}get blurImage(){return this.uniforms.blurImage}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},VibranceFilter:class extends PIXI.Shader{constructor(e){super(e,wa,Da)}get amount(){return this._amount}set amount(e){this._amount=e}applyParams(e){this.uniforms.amount=this.amount}},RgbToLabFilter:class extends PIXI.Filter{constructor(){super(Fa,Ba)}apply(e,t,i,r){e.applyFilter(this,t,i,r)}},ClarityFilter:class extends PIXI.Filter{constructor(){super(La,ka),this.padding=0,this.intensity=1}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=e}get blurImage(){return this.uniforms.blurImage}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},VignetteFilter:class extends PIXI.Filter{constructor(){super(ta,Oa),this.uniforms.amount=.35,this.uniforms.softness=.6,this.padding=0}apply(e,t,i,r){this.uniforms.realWidth=i.destinationFrame.width/t.size.width,this.uniforms.realHeight=i.destinationFrame.height/t.size.height,e.applyFilter(this,t,i,r)}get amount(){return this.uniforms.amount}set amount(e){this.uniforms.amount=e}get softness(){return this.uniforms.softness}set softness(e){this.uniforms.softness=e}},BrushFilter:class extends PIXI.Shader{constructor(e){super(e,Aa,Ra),this.modes=["radial","square","linear","paint"],this._radius=50,this._hardness=1,this._strength=1,this._opacity=1,this._mode=this.modes.indexOf("radial"),this._inverse=!1}initParams(){this.uniforms.mode=!1,this.uniforms.inverse=!1,this.uniforms.mapSize=0,this.uniforms.centerX=0,this.uniforms.centerY=0,this.uniforms.outerRadius=1,this.uniforms.innerRadius=1}updateBrush(){this.uniforms.mode=this._mode,this.uniforms.inverse=this._inverse,this.uniforms.mapSize=2*this._radius,this.uniforms.centerX=this._radius,this.uniforms.centerY=this._radius,this.uniforms.outerRadius=this._radius,this.uniforms.innerRadius=Math.max(0,Math.min(this._radius-2,this._radius*this._hardness)),this.uniforms.strength=this._strength,this.uniforms.opacity=this._opacity}applyParams(e){try{this.uniforms.dimensions=[e.width,e.height]}catch(e){this.uniforms.dimensions=[512,512]}this.updateBrush()}get mode(){return this._mode}set mode(e){-1!=this.modes.indexOf(e)&&(this._mode=this.modes.indexOf(e))}get radius(){return this._radius}set radius(e){this._radius=Math.round(e)}get hardness(){this._hardness=Math.max(0,Math.min(1,value))}set hardness(e){this._hardness=e}get strength(){return this._strength}set strength(e){this._strength=Math.max(0,Math.min(1,e))}get inverse(){return this._inverse}set inverse(e){this._inverse=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e}},PixelateFilter:class extends PIXI.Filter{constructor(){super(Ua,Va),this.padding=0,this.resolution=1,this.segmentsX=0,this.segmentsY=0,this.textureW=0,this.textureH=0}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get segmentsX(){return this.uniforms.segmentsX}set segmentsX(e){this.uniforms.segmentsX=Math.round(e)}get segmentsY(){return this.uniforms.segmentsY}set segmentsY(e){this.uniforms.segmentsY=Math.round(e)}get textureW(){return this.uniforms.textureW}set textureW(e){this.uniforms.textureW=Math.round(e),this.uniforms.mapW=BFN.FilterHelper.getNextPowerOfTwo(Math.round(e))}get textureH(){return this.uniforms.textureH}set textureH(e){this.uniforms.textureH=Math.round(e),this.uniforms.mapH=BFN.FilterHelper.getNextPowerOfTwo(Math.round(e))}},AlphaBlendFilter:class extends PIXI.Filter{constructor(){super(ta,Ga),this.padding=0,this.intensity=1}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=e}get topImage(){return this.uniforms.topImage}set topImage(e){this.uniforms.topImage=e}},HalftoneFilter:class extends PIXI.Filter{constructor(){super(ta,Ha),this.dotSize=1,this.background_color="0xFFFFFF",this.dot_color="0xFF0000",this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get dotSize(){return this.uniforms.dotSize}set dotSize(e){this.uniforms.dotSize=e}get background_color(){return this.uniforms.background_color}set background_color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.background_color=e}get dot_color(){return this.uniforms.dot_color}set dot_color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.dot_color=e}},BlendModeFilter:class extends PIXI.Filter{constructor(e){var t=un;switch(e){case BFN.CONST.BLEND_MODES.ADD:t=cn;break;case BFN.CONST.BLEND_MODES.SUBTRACT:t=hn;break;case BFN.CONST.BLEND_MODES.MULTIPLY:t=ln;break;case BFN.CONST.BLEND_MODES.DARKEN:t=sn;break;case BFN.CONST.BLEND_MODES.COLOR_BURN:t=on;break;case BFN.CONST.BLEND_MODES.LINEAR_BURN:t=nn;break;case BFN.CONST.BLEND_MODES.LIGHTEN:t=an;break;case BFN.CONST.BLEND_MODES.SCREEN:t=rn;break;case BFN.CONST.BLEND_MODES.COLOR_DODGE:t=tn;break;case BFN.CONST.BLEND_MODES.LINEAR_DODGE:t=en;break;case BFN.CONST.BLEND_MODES.OVERLAY:t=$a;break;case BFN.CONST.BLEND_MODES.SOFT_LIGHT:t=Ja;break;case BFN.CONST.BLEND_MODES.HARD_LIGHT:t=Za;break;case BFN.CONST.BLEND_MODES.VIVID_LIGHT:t=Qa;break;case BFN.CONST.BLEND_MODES.LINEAR_LIGHT:t=Ka;break;case BFN.CONST.BLEND_MODES.PIN_LIGHT:t=qa;break;case BFN.CONST.BLEND_MODES.DIFFERENCE:t=Ya;break;case BFN.CONST.BLEND_MODES.EXCLUSION:t=Wa;break;case BFN.CONST.BLEND_MODES.ERASE:t=ja;break;case BFN.CONST.BLEND_MODES.ALPHA:t=Xa}super(za,t),this.uniforms.intensity=1,e==BFN.CONST.BLEND_MODES.OVERLAY&&(this.alphadir=0),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=e}get alphadir(){return this.uniforms.alphadir}set alphadir(e){this.uniforms.alphadir=e}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}},BlackWhiteFilter:class extends PIXI.Filter{constructor(e){var t=yn;switch(e){case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_2:t=vn;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_3:t=fn;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4:t=gn;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_5:t=pn;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_6:case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_7:t=mn;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_8:t=dn}super(ta,t),this.currentPreset=e,this.padding=0}apply(e,t,i,r){this.currentPreset==BFN.CONST.BLACK_WHITE_PRESETS.PRESET_8&&(this.uniforms.realWidth=i.destinationFrame.width/t.size.width,this.uniforms.realHeight=i.destinationFrame.height/t.size.height),e.applyFilter(this,t,i,r)}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}get mode(){return this.uniforms.mode}set mode(e){this.uniforms.mode=e}},CurvesFilter:class extends PIXI.Filter{constructor(e,t,i){super(ta,xn),this.padding=0,e&&t&&i&&this.doFilter(e,t,i)}doFilter(e,t,i){this.iChannel1=BFN.FilterHelper.GetCurvesTexture(e,t,i)}dispose(){try{this.iChannel1.destroyGC(!0)}catch(e){}this.iChannel1=null}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){null!=e&&(e.baseTexture.isPowerOfTwo=!0,this.uniforms.iChannel1=e)}},ChannelMixerFilter:class extends PIXI.Filter{constructor(){super(ta,_n),this.padding=0}get redAmount(){return this.uniforms.redAmount}set redAmount(e){this.uniforms.redAmount=e}get greenAmount(){return this.uniforms.greenAmount}set greenAmount(e){this.uniforms.greenAmount=e}get blueAmount(){return this.uniforms.blueAmount}set blueAmount(e){this.uniforms.blueAmount=e}},CyanotypeFilter:class extends PIXI.Filter{constructor(e){var t=Bn;switch(e){case BFN.CONST.CYANOTYPE_PRESETS.PRESET_2:t=Cn;break;case BFN.CONST.CYANOTYPE_PRESETS.PRESET_3:t=Sn;break;case BFN.CONST.CYANOTYPE_PRESETS.PRESET_4:t=bn;break;case BFN.CONST.CYANOTYPE_PRESETS.PRESET_5:t=Tn;break;case BFN.CONST.CYANOTYPE_PRESETS.PRESET_6:t=In}super(ta,t),this.currentPreset=e,this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}get blurImage(){return this.uniforms.blurImage}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},MaskVignetteFilter:class extends PIXI.Filter{constructor(){super(ta,Fn),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,this.uniforms.realWidth=i.destinationFrame.width/t.size.width,this.uniforms.realHeight=i.destinationFrame.height/t.size.height,e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}},CharcoalFilter:class extends PIXI.Filter{constructor(){super(ta,En),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get blurImage(){return this.uniforms.blurSampler}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get textureSampler(){return this.uniforms.textureSampler}set textureSampler(e){this.uniforms.textureSampler=e}get color1(){return this.uniforms.color1}set color1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}get color2(){return this.uniforms.color2}set color2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2=e}get detail_level(){return this.uniforms.detail_level}set detail_level(e){this.uniforms.detail_level=e}},SepiaFilter:class extends PIXI.Filter{constructor(){super(ta,Pn),this.padding=0}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}get amount(){return this.uniforms.amount}set amount(e){this.uniforms.amount=e}},UnitedColorsFilter:class extends PIXI.Filter{constructor(){super(ta,Nn),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get color1(){return this.uniforms.color1}set color1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}get color2(){return this.uniforms.color2}set color2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2=e}get blurImage(){return this.uniforms.blurImage}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}get bwmode(){return this.uniforms.bwmode}set bwmode(e){this.uniforms.bwmode=e}},InstantFilter:class extends PIXI.Filter{constructor(e){var t=Vn;switch(e){case BFN.CONST.INSTANT_PRESETS.PRESET_2:t=An;break;case BFN.CONST.INSTANT_PRESETS.PRESET_3:t=Rn;break;case BFN.CONST.INSTANT_PRESETS.PRESET_4:t=On;break;case BFN.CONST.INSTANT_PRESETS.PRESET_5:t=Ln;break;case BFN.CONST.INSTANT_PRESETS.PRESET_6:t=kn;break;case BFN.CONST.INSTANT_PRESETS.PRESET_10:t=wn;break;case BFN.CONST.INSTANT_PRESETS.PRESET_11:t=Dn;break;case BFN.CONST.INSTANT_PRESETS.PRESET_13:t=Mn}super(ta,t),this.currentPreset=e,this.padding=0}apply(e,t,i,r){switch(this.currentPreset){case BFN.CONST.INSTANT_PRESETS.PRESET_5:case BFN.CONST.INSTANT_PRESETS.PRESET_6:case BFN.CONST.INSTANT_PRESETS.PRESET_10:case BFN.CONST.INSTANT_PRESETS.PRESET_11:case BFN.CONST.INSTANT_PRESETS.PRESET_13:var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,this.uniforms.realWidth=i.destinationFrame.width/t.size.width,this.uniforms.realHeight=i.destinationFrame.height/t.size.height}e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}},TintFilter:class extends PIXI.Filter{constructor(){super(ta,Un),this.padding=0}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},TinyTypeFilter:class extends PIXI.Filter{constructor(){super(ta,Gn),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}get mode(){return this.uniforms.mode}set mode(e){this.uniforms.mode=e}},BrightnessContrastFilter:class extends PIXI.Filter{constructor(){super(ta,Hn),this.padding=0}get brightness(){return this.uniforms.brightness}set brightness(e){this.uniforms.brightness=e}get contrast(){return this.uniforms.contrast}set contrast(e){this.uniforms.contrast=e}},VintageColorsFilter:class extends PIXI.Filter{constructor(e){var t=ta,i=jn,r=!1;switch(e){case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_5:i=Xn;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_6:r=!0,i=qn;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_7:r=!0,i=Yn;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_8:r=!0,i=Wn;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_9:r=!0,i=zn}super(t,i),this.padding=0,this.currentPreset=e,this.isNoClamp=r}apply(e,t,i,r){if(0==this.isNoClamp){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y}e.applyFilter(this,t,i,r)}get blurImage(){return this.uniforms.textureSampler}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}get color1(){return this.uniforms.color1}set color1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}get color2(){return this.uniforms.color2}set color2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2=e}get color1_1(){return this.uniforms.color1_1}set color1_1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1_1=e}get color1_2(){return this.uniforms.color1_2}set color1_2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1_2=e}get color2_1(){return this.uniforms.color2_1}set color2_1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2_1=e}get color2_2(){return this.uniforms.color2_2}set color2_2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2_2=e}get color3_1(){return this.uniforms.color3_1}set color3_1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color3_1=e}get color3_2(){return this.uniforms.color3_2}set color3_2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color3_2=e}get color4_1(){return this.uniforms.color4_1}set color4_1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color4_1=e}get color4_2(){return this.uniforms.color4_2}set color4_2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color4_2=e}},HolgaArtFilter:class extends PIXI.Filter{constructor(e){var t=$n;switch(e){case BFN.CONST.HOLGA_ART_PRESETS.PRESET_1:t=$n;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_2:t=Jn;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_3:t=Zn;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_4:t=Qn;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_5:t=Kn}super(ta,t),this.padding=0,this.currentPreset=e}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);switch(this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,this.currentPreset){case BFN.CONST.HOLGA_ART_PRESETS.PRESET_4:this.uniforms.realWidth=i.destinationFrame.width/t.size.width,this.uniforms.realHeight=i.destinationFrame.height/t.size.height}e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}get slide_right(){return this.uniforms.slide_right}set slide_right(e){this.uniforms.slide_right=e}get slide_left(){return this.uniforms.slide_left}set slide_left(e){this.uniforms.slide_left=e}get slide_vertical(){return this.uniforms.slide_vertical}set slide_vertical(e){this.uniforms.slide_vertical=e}get slide_horizontal(){return this.uniforms.slide_horizontal}set slide_horizontal(e){this.uniforms.slide_horizontal=e}get vignette_amount(){return this.uniforms.vignette_amount}set vignette_amount(e){this.uniforms.vignette_amount=e}},LineArtopiaFilter:class extends PIXI.Filter{constructor(e){var t=ro,i=!0;switch(e){case BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_1:t=ro;break;case BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_2:t=io;break;case BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_3:i=!1,t=to;break;case BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_4:i=!1,t=eo}super(ta,t),this.currentPreset=e,this.isNoClamp=i,this.padding=0}apply(e,t,i,r){if(0==this.isNoClamp){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y}e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}get sketch_detail(){return this.uniforms.sketch_detail}set sketch_detail(e){this.uniforms.sketch_detail=e}get line_width(){return this.uniforms.line_width}set line_width(e){this.uniforms.line_width=e}get line_angle(){return this.uniforms.line_angle}set line_angle(e){this.uniforms.line_angle=e}},HDRFilter:class extends PIXI.Filter{constructor(){super(ta,ao),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}},MotionBlurFilter:class extends PIXI.Filter{constructor(){super(ta,no),this.padding=0,this.angleDegree=90,this.strength=1}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=1/a.x,this.uniforms.clampY=1/a.y,e.applyFilter(this,t,i,r)}get angleDegree(){return this.uniforms.angleDegree}set angleDegree(e){this.uniforms.angleDegree=e}get strength(){return this.uniforms.strength}set strength(e){this.uniforms.strength=e}},SigmoidFilter:class extends PIXI.Filter{constructor(){super(ta,oo),this.padding=0,this.mode=0}get brightness(){return this.uniforms.brightness}set brightness(e){this.uniforms.brightness=e}get sharpness(){return this.uniforms.sharpness}set sharpness(e){this.uniforms.sharpness=e}get mode(){return this.uniforms.mode}set mode(e){this.uniforms.mode=e}},ShiftChannelFilter:class extends PIXI.Filter{constructor(){super(ta,so),this.padding=0}get mode(){return this.uniforms.mode}set mode(e){this.uniforms.mode=e}},FisheyeFilter:class extends PIXI.Filter{constructor(){super(ta,lo),this.padding=0,this.radius=1.5,this.centerPoint=[.5,.5]}apply(e,t,i,r){this.uniforms.resolutionX=i.destinationFrame.width,this.uniforms.resolutionY=i.destinationFrame.height,e.applyFilter(this,t,i,r)}get centerPoint(){return this.uniforms.centerPoint}set centerPoint(e){this.uniforms.centerPoint=e}get radius(){return this.uniforms.radius}set radius(e){this.uniforms.radius=e}},NoiseFilter:class extends PIXI.Filter{constructor(){super(ta,ho),this.padding=0}get duocolor1(){return this.uniforms.duocolor1}set duocolor1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.duocolor1=e}get duocolor2(){return this.uniforms.duocolor2}set duocolor2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.duocolor2=e}},StencilerFilter:class extends PIXI.Filter{constructor(e){var t=ta,i=_o;switch(e){case BFN.CONST.STENCILER_PRESETS.PRESET_2:i=xo;break;case BFN.CONST.STENCILER_PRESETS.PRESET_3:i=yo;break;case BFN.CONST.STENCILER_PRESETS.PRESET_4:i=vo;break;case BFN.CONST.STENCILER_PRESETS.PRESET_6:i=fo;break;case BFN.CONST.STENCILER_PRESETS.PRESET_7:i=go;break;case BFN.CONST.STENCILER_PRESETS.PRESET_8:i=po;break;case BFN.CONST.STENCILER_PRESETS.PRESET_9:i=mo;break;case BFN.CONST.STENCILER_PRESETS.PRESET_10:i=uo;break;case BFN.CONST.STENCILER_PRESETS.PRESET_11:i=co}super(t,i),this.padding=0,this.currentPreset=e}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurSampler||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get blurSampler(){return this.uniforms.blurSampler}set blurSampler(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get textureSampler(){return this.uniforms.textureSampler}set textureSampler(e){this.uniforms.textureSampler=e}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}get detail_level(){return this.uniforms.detail_level}set detail_level(e){this.uniforms.detail_level=e}get color_detail(){return this.uniforms.color_detail}set color_detail(e){this.uniforms.color_detail=e}get smooth_amount(){return this.uniforms.hasOwnProperty("smooth_amount")?this.uniforms.smooth_amount:null}set smooth_amount(e){this.uniforms.hasOwnProperty("smooth_amount")&&(this.uniforms.smooth_amount=e)}},GrungeFilter:class extends PIXI.Filter{constructor(e){var t=wo;switch(e){case BFN.CONST.GRUNGE_PRESETS.PRESET_1:t=wo;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_2:t=Do;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_3:t=Mo;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_4:t=No;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_5:t=Po;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_6:t=Eo;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_9:t=Fo;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_10:t=Bo;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_11:t=Co;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_13:t=So;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_15:t=bo;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_16:t=To;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_17:t=Io}super(ta,t),this.currentPreset=e,this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}get blurImage(){return this.uniforms.blurImage}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}get silhouette_amount(){return this.uniforms.silhouette_amount}set silhouette_amount(e){this.uniforms.silhouette_amount=e}get shadow_amount(){return this.uniforms.shadow_amount}set shadow_amount(e){this.uniforms.shadow_amount=e}get detail_level(){return this.uniforms.detail_level}set detail_level(e){this.uniforms.detail_level=e}},SunburstFilter:class extends PIXI.Filter{constructor(e){var t=ta,i=Vo,r=!0,a=!1;switch(e){case BFN.CONST.SUNBURST_PRESETS.PRESET_2:i=Ao;break;case BFN.CONST.SUNBURST_PRESETS.PRESET_3:i=Ro;break;case BFN.CONST.SUNBURST_PRESETS.PRESET_4:r=!1,a=!0,i=Oo;break;case BFN.CONST.SUNBURST_PRESETS.PRESET_5:a=!0,i=Lo;break;case BFN.CONST.SUNBURST_PRESETS.PRESET_6:r=!1,a=!0,i=ko}super(t,i),this.padding=0,this.currentPreset=e,this.isClamp=r,this.isWidth=a}apply(e,t,i,r){if(1==this.isClamp){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y}1==this.isWidth&&(this.uniforms.realWidth=i.destinationFrame.width/t.size.width,this.uniforms.realHeight=i.destinationFrame.height/t.size.height),e.applyFilter(this,t,i,r)}get textureSampler(){return this.uniforms.textureSampler}set textureSampler(e){this.uniforms.textureSampler=e}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}get halftone_size(){return this.uniforms.halftone_size}set halftone_size(e){this.uniforms.halftone_size=e}get silhouette_amount(){return this.uniforms.silhouette_amount}set silhouette_amount(e){this.uniforms.silhouette_amount=e}get sunburst_amount(){return this.uniforms.sunburst_amount}set sunburst_amount(e){this.uniforms.sunburst_amount=e}get grain_amount(){return this.uniforms.grain_amount}set grain_amount(e){this.uniforms.grain_amount=e}},AdaptiveContrastLegFilter:class extends PIXI.Filter{constructor(){super(ta,Uo),this.padding=0}},OldPhotoFilter:class extends PIXI.Filter{constructor(e){var t=rs,i=!1;switch(e){case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_2:i=!1,t=is;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_4:i=!0,t=ts;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_5:i=!0,t=es;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_6:i=!0,t=$o;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_7:i=!0,t=Jo;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_8:i=!1,t=Zo;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_9:i=!0,t=Qo;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_10:i=!0,t=Ko;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_11:i=!0,t=qo;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_12:i=!1,t=Yo;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_13:i=!0,t=Wo;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_14:i=!0,t=jo;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_15:i=!0,t=Xo;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_16:i=!0,t=zo;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_17:i=!1,t=Ho;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_18:i=!1,t=Go}super(ta,t),this.isUseClamp=i,this.currentPreset=e,this.padding=0}apply(e,t,i,r){if(!1!==this.isUseClamp){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurSampler||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y}e.applyFilter(this,t,i,r)}get textureSampler(){return this.uniforms.textureSampler}set textureSampler(e){this.uniforms.textureSampler=e}get blurSampler(){return this.uniforms.blurSampler}set blurSampler(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}get grain_amount(){return this.uniforms.grain_amount}set grain_amount(e){this.uniforms.grain_amount=e}get silhouette_amount(){return this.uniforms.silhouette_amount}set silhouette_amount(e){this.uniforms.silhouette_amount=e}get blur_amount(){return this.uniforms.blur_amount}set blur_amount(e){this.uniforms.blur_amount=e}get color_amount(){return this.uniforms.color_amount}set color_amount(e){this.uniforms.color_amount=e}get contrast(){return this.uniforms.contrast}set contrast(e){this.uniforms.contrast=e}},DuoToneFilter:class extends PIXI.Filter{constructor(){super(ta,as),this.padding=0}get color1(){return this.uniforms.color1}set color1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}get color2(){return this.uniforms.color2}set color2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2=e}},WinterFilter:class extends PIXI.Filter{constructor(e){var t=ta,i=os;switch(e){case BFN.CONST.WINTER_PRESETS.PRESET_2:i=ns}super(t,i),this.padding=0,this.currentPreset=e}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get textureSampler(){return this.uniforms.textureSampler}set textureSampler(e){this.uniforms.textureSampler=e}get frost_amount(){return this.uniforms.frost_amount}set frost_amount(e){this.uniforms.frost_amount=e}get amount(){return this.uniforms.amount}set amount(e){this.uniforms.amount=e}},TiltShiftFilter:class extends PIXI.Filter{constructor(e){var t=ta,i=ls;switch(e){case BFN.CONST.TILT_SHIFT_PRESETS.PRESET_2:i=ss}super(t,i),this.padding=0,this.currentPreset=e}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurSampler||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,this.uniforms.resolutionXY=[i.destinationFrame.width,i.destinationFrame.height],e.applyFilter(this,t,i,r)}get blurSampler(){return this.uniforms.blurSampler}set blurSampler(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get size(){return this.uniforms.size}set size(e){this.uniforms.size=e}get blur_amount(){return this.uniforms.blur_amount}set blur_amount(e){this.uniforms.blur_amount=e}get angle(){return this.uniforms.angle}set angle(e){this.uniforms.angle=e}get slide_vertical(){return this.uniforms.slide_vertical}set slide_vertical(e){this.uniforms.hasOwnProperty("slide_vertical")&&(this.uniforms.slide_vertical=e)}get slide_horizontal(){return this.uniforms.slide_horizontal}set slide_horizontal(e){this.uniforms.hasOwnProperty("slide_horizontal")&&(this.uniforms.slide_horizontal=e)}},PatrioticFilter:class extends PIXI.Filter{constructor(e){var t=!0,i=ta,r=gs;switch(e){case BFN.CONST.PATRIOTIC_PRESETS.PRESET_2:t=!1,r=ps;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_3:r=ms;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_4:r=ds;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_5:r=us;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_6:r=cs;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_7:r=hs}super(i,r),this.isClamp=t,this.padding=0,this.currentPreset=e}apply(e,t,i,r){if(1==this.isClamp){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y}e.applyFilter(this,t,i,r)}get textureSampler(){return this.uniforms.textureSampler}set textureSampler(e){this.uniforms.textureSampler=e}get blurImage(){return this.uniforms.blurSampler}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get adaptiveSharpenSampler(){return this.uniforms.adaptiveSharpenSampler}set adaptiveSharpenSampler(e){this.uniforms.adaptiveSharpenSampler=e}get starSampler(){return this.uniforms.starSampler}set starSampler(e){this.uniforms.starSampler=e}get silhouette_amount(){return this.uniforms.silhouette_amount}set silhouette_amount(e){this.uniforms.silhouette_amount=e}get color_space(){return this.uniforms.color_space}set color_space(e){this.uniforms.color_space=e}get halftone_size(){return this.uniforms.halftone_size}set halftone_size(e){this.uniforms.halftone_size=e}get line_width(){return this.uniforms.line_width}set line_width(e){this.uniforms.line_width=e}get line_angle(){return this.uniforms.line_angle}set line_angle(e){this.uniforms.line_angle=e}get line_color(){return this.uniforms.line_color}set line_color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.line_color=e}get background_color(){return this.uniforms.background_color}set background_color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.background_color=e}get star_size(){return this.uniforms.star_size}set star_size(e){this.uniforms.star_size=e}get red(){return this.uniforms.red}set red(e){this.uniforms.red=e}get navy(){return this.uniforms.navy}set navy(e){this.uniforms.navy=e}},PopArtFilter:class extends PIXI.Filter{constructor(e){var t=ta,i=ws,r=!1;switch(e){case BFN.CONST.POPART_PRESETS.PRESET_1:r=!0,i=ws;break;case BFN.CONST.POPART_PRESETS.PRESET_2:r=!0,i=Ds;break;case BFN.CONST.POPART_PRESETS.PRESET_3:r=!0,i=Ms;break;case BFN.CONST.POPART_PRESETS.PRESET_4:r=!0,i=Ns;break;case BFN.CONST.POPART_PRESETS.PRESET_5:r=!0,i=Ps;break;case BFN.CONST.POPART_PRESETS.PRESET_6:r=!0,i=Es;break;case BFN.CONST.POPART_PRESETS.PRESET_7:r=!0,i=Fs;break;case BFN.CONST.POPART_PRESETS.PRESET_9:r=!0,i=Bs;break;case BFN.CONST.POPART_PRESETS.PRESET_10:r=!0,i=Cs;break;case BFN.CONST.POPART_PRESETS.PRESET_11:r=!0,i=Ss;break;case BFN.CONST.POPART_PRESETS.PRESET_13:r=!0,i=bs;break;case BFN.CONST.POPART_PRESETS.PRESET_14:r=!0,i=Ts;break;case BFN.CONST.POPART_PRESETS.PRESET_15:r=!0,i=Is;break;case BFN.CONST.POPART_PRESETS.PRESET_16:r=!0,i=_s;break;case BFN.CONST.POPART_PRESETS.PRESET_17:r=!0,i=xs;break;case BFN.CONST.POPART_PRESETS.PRESET_18:r=!0,i=ys;break;case BFN.CONST.POPART_PRESETS.PRESET_19:r=!0,i=vs;break;case BFN.CONST.POPART_PRESETS.PRESET_20:r=!0,i=fs}super(t,i),this.padding=0,this.currentPreset=e,this.isClamp=r}apply(e,t,i,r){if(1==this.isClamp){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurSampler||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y}e.applyFilter(this,t,i,r)}get blurSampler(){return this.uniforms.blurSampler}set blurSampler(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get textureSampler(){return this.uniforms.textureSampler}set textureSampler(e){this.uniforms.textureSampler=e}get adaptiveSharpenSampler(){return this.uniforms.adaptiveSharpenSampler}set adaptiveSharpenSampler(e){this.uniforms.adaptiveSharpenSampler=e}get gradientSampler(){return this.uniforms.gradientSampler}set gradientSampler(e){this.uniforms.gradientSampler=e}get halftoneSampler(){return this.uniforms.halftoneSampler}set halftoneSampler(e){this.uniforms.halftoneSampler=e}get silhouette_amount(){return this.uniforms.hasOwnProperty("silhouette_amount")?this.uniforms.silhouette_amount:null}set silhouette_amount(e){this.uniforms.hasOwnProperty("silhouette_amount")&&(this.uniforms.silhouette_amount=e)}get detail_level(){return this.uniforms.detail_level}set detail_level(e){this.uniforms.detail_level=e}get halftone_size(){return this.uniforms.hasOwnProperty("halftone_size")?this.uniforms.halftone_size:null}set halftone_size(e){this.uniforms.hasOwnProperty("halftone_size")&&(this.uniforms.halftone_size=e)}get color_detail(){return this.uniforms.color_detail}set color_detail(e){this.uniforms.color_detail=e}get color_value_1(){return this.uniforms.color_value_1}set color_value_1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_value_1=e}get color_value_2(){return this.uniforms.color_value_2}set color_value_2(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_value_2=e}get color_value_3(){return this.uniforms.color_value_3}set color_value_3(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_value_3=e}get color_value_4(){return this.uniforms.color_value_4}set color_value_4(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_value_4=e}},OffsetFilter:class extends PIXI.Filter{constructor(){super(ta,ks),this.padding=0,this.resolution=1,this._offsetX=0,this._offsetY=0,this._scaleX=1,this._scaleY=1,this._wrap=!1}apply(e,t,i,r){this.uniforms.offsetX=this._offsetX/i.destinationFrame.width,this.uniforms.offsetY=this._offsetY/i.destinationFrame.height,this.uniforms.scaleX=this._scaleX,this.uniforms.scaleY=this._scaleY;var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,this.uniforms.wrap=this._wrap?1:0,e.applyFilter(this,t,i,r)}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get scaleX(){return this._scaleX}set scaleX(e){this._scaleX=e}get scaleY(){return this._scaleY}set scaleY(e){this._scaleY=e}get wrap(){return this._wrap}set wrap(e){this._wrap=e}},TintDuoFilter:class extends PIXI.Filter{constructor(){super(ta,Ls),this.padding=0}get amount(){return this.uniforms.amount}set amount(e){this.uniforms.amount=e}get color1(){return this.uniforms.color1}set color1(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}get color2(){return this.uniforms.color2}set color2(e){e=-1!=e&&"0x-1"!=e?BFN.FilterHelper.hex2rgb(e,!0):[0,0,0,0],this.uniforms.color2=e}},BeautifyFilter:class extends PIXI.Shader{constructor(e){super(e,ta,Os),this.channelTextures={0:"def",1:"blurImage"}}get amount(){return this._amount}set amount(e){this._amount=e}get blurImage(){return this._blurSampler}set blurImage(e){this._blurSampler=e}applyParams(e){this.uniforms.amount=this.amount}},FastBlurFilter:class extends PIXI.Filter{constructor(e,t,i,r,a,n){super(),this.blurXFilter=new Vs(e,i),this.blurYFilter=new Gs(e,i),this.padding=0,this.resolution=i||(a?BFN.renderTextureResolutionLarge:BFN.renderTextureResolution),this.quality=t||1,this.oneDirection=n,n||(this.blur=e||5),this.manageResolution=0!=r,this.largeKernel=1==a}apply(e,t,i){if(this.oneDirection)"x"==this.oneDirection?(this.blurXFilter.resolution=this.resolution,this.blurXFilter.apply(e,t,i)):(this.blurYFilter.resolution=this.resolution,this.blurYFilter.apply(e,t,i));else{var r=e.getRenderTarget(!0);this.blurXFilter.resolution=this.resolution,this.blurYFilter.resolution=this.resolution,this.blurXFilter.apply(e,t,r,!0),this.blurYFilter.apply(e,r,i,!1),e.returnRenderTarget(r)}}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e}get blurx(){return this.blurXFilter.blur}set blurx(e){this.blurXFilter.blur=e}get blury(){return this.blurYFilter.blur}set blury(e){this.blurYFilter.blur=e}get quality(){}set quality(e){}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e}},FastBlurWrapper:class{constructor(e,t,i,r){this.blur1=new BFN.filters.GaussianBlurFilter(null,null,e,1==i?"large":"small",r),this.outputTexture=null,this.isCreateNewOutput=!1}apply(e){return 0==e?[]:(this.blur1.blur=e,[this.blur1])}render(e,t,i,r){this.isCreateNewOutput=r,this.blur1.setInputDimensions(t.width,t.height);var a=null;if(null!=i)a=i.concat(this.apply(e));else{if(0==e)return t;a=this.apply(e)}return this.outputTexture||(this.isCreateNewOutput?this.outputTexture=PIXI.RenderTexture.create(t.width,t.height):this.outputTexture=BFN.Util.getNonUsedRenderTexturePool(t.width,t.height)),BFN.renderTextureHolder.texture=t,BFN.renderTextureHolder.filters=a,BFN.Stage.render(BFN.renderTextureHolder,this.outputTexture),BFN.renderTextureHolder.filters=[],BFN.renderTextureHolder.texture=null,this.outputTexture}dispose(){this.outputTexture&&(this.isCreateNewOutput?(this.outputTexture.destroyGC(!0),this.isCreateNewOutput=!1):BFN.Util.destroyRenderTexturePool(),this.outputTexture=null)}},OrtonStyleFilter:class extends PIXI.Filter{constructor(){super(ta,Hs),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurSampler||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,this.uniforms.resolutionXY=[i.destinationFrame.width,i.destinationFrame.height],e.applyFilter(this,t,i,r)}get blurSampler(){return this.uniforms.blurSampler}set blurSampler(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},MotionColorFilter:class extends PIXI.Filter{constructor(e){var t=Ys;switch(e){case BFN.CONST.MOTION_COLOR_PRESETS.PRESET_2:t=Ws;break;case BFN.CONST.MOTION_COLOR_PRESETS.PRESET_3:t=js;break;case BFN.CONST.MOTION_COLOR_PRESETS.PRESET_4:t=Xs;break;case BFN.CONST.MOTION_COLOR_PRESETS.PRESET_5:t=zs}super(ta,t),this.currentPreset=e,this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurSampler||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,this.uniforms.realWidth=i.destinationFrame.width/t.size.width,this.uniforms.realHeight=i.destinationFrame.height/t.size.height,e.applyFilter(this,t,i,r)}get textureSampler(){return this.uniforms.textureSampler}set textureSampler(e){this.uniforms.textureSampler=e}get blurSampler(){return this.uniforms.blurSampler}set blurSampler(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get vignette_amount(){return this.uniforms.vignette_amount}set vignette_amount(e){this.uniforms.vignette_amount=e}},PinholeFilter:class extends PIXI.Filter{constructor(e){var t=ta,i=Js,r=!0;switch(e){case BFN.CONST.PATRIOTIC_PRESETS.PRESET_2:r=!1,i=Zs;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_3:i=Qs;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_4:i=Ks;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_5:i=qs}super(t,i),this.padding=0,this.currentPreset=e,this.isUseClamp=r,this.centerPoint=[.5,.5]}apply(e,t,i,r){if(this.uniforms.resolutionX=i.destinationFrame.width,this.uniforms.resolutionY=i.destinationFrame.height,this.uniforms.realWidth=i.destinationFrame.width/t.size.width,this.uniforms.realHeight=i.destinationFrame.height/t.size.height,!1!==this.isUseClamp){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y}e.applyFilter(this,t,i,r)}get centerPoint(){return this.uniforms.centerPoint}set centerPoint(e){this.uniforms.centerPoint=e}get iChanel1(){return this.uniforms.iChanel1}set iChanel1(e){this.uniforms.iChanel1=e}get iChanel2(){return this.uniforms.iChanel2}set iChanel2(e){this.uniforms.iChanel2=e}get vignette_amount(){return this.uniforms.vignette_amount}set vignette_amount(e){this.uniforms.vignette_amount=e}get fisheye_amount(){return this.uniforms.fisheye_amount}set fisheye_amount(e){this.uniforms.fisheye_amount=e}},LomoArtFilter:class extends PIXI.Filter{constructor(e){var t=al;switch(e){case BFN.CONST.LOMO_ART_PRESETS.PRESET_2:t=rl;break;case BFN.CONST.LOMO_ART_PRESETS.PRESET_3:t=il;break;case BFN.CONST.LOMO_ART_PRESETS.PRESET_4:t=tl;break;case BFN.CONST.LOMO_ART_PRESETS.PRESET_6:t=el;break;case BFN.CONST.LOMO_ART_PRESETS.PRESET_7:t=$s}super(ta,t),this.currentPreset=e,this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurSampler||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,this.uniforms.realWidth=i.destinationFrame.width/t.size.width,this.uniforms.realHeight=i.destinationFrame.height/t.size.height,this.uniforms.dimensions[0]=t.sourceFrame.width,this.uniforms.dimensions[1]=t.sourceFrame.height,e.applyFilter(this,t,i,r)}get textureSampler(){return this.uniforms.textureSampler}set textureSampler(e){this.uniforms.textureSampler=e}get blurSampler(){return this.uniforms.blurSampler}set blurSampler(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get gradientSampler(){return this.uniforms.gradientSampler}set gradientSampler(e){this.uniforms.gradientSampler=e}get vignette_amount(){return this.uniforms.vignette_amount}set vignette_amount(e){this.uniforms.vignette_amount=e}get border_color(){return this.uniforms.border_color}set border_color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.border_color=e}get border_thickness(){return this.uniforms.border_thickness}set border_thickness(e){this.uniforms.border_thickness=e}},CrossProcessFilter:class extends PIXI.Filter{constructor(){super(ta,nl),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,e.applyFilter(this,t,i,r)}get curvesSampler(){return this.uniforms.curvesSampler}set curvesSampler(e){this.uniforms.curvesSampler=e}get color(){return this.uniforms.color}set color(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}get contrast(){return this.uniforms.contrast}set contrast(e){this.uniforms.contrast=e}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=e}},SkinCandidateFilter:class extends PIXI.Filter{constructor(){super(ta,ol),this.padding=0}},TouchUpFilter:class extends PIXI.Filter{constructor(e){var t=ta,i=xl;switch(e){case BFN.CONST.TOUCH_UP_PRESETS.bronzer:i=yl;break;case BFN.CONST.TOUCH_UP_PRESETS.blush:i=vl;break;case BFN.CONST.TOUCH_UP_PRESETS.flashspot:i=fl;break;case BFN.CONST.TOUCH_UP_PRESETS.mascara:i=gl;break;case BFN.CONST.TOUCH_UP_PRESETS.eye_color:i=dl;break;case BFN.CONST.TOUCH_UP_PRESETS.eye_brighten:i=ul;break;case BFN.CONST.TOUCH_UP_PRESETS.eyebrow_pencil:i=cl;break;case BFN.CONST.TOUCH_UP_PRESETS.fix_redeye:i=hl;break;case BFN.CONST.TOUCH_UP_PRESETS.lipstick:i=pl;break;case BFN.CONST.TOUCH_UP_PRESETS.teeth_whiten:i=ll;break;case BFN.CONST.TOUCH_UP_PRESETS.haircolor:i=ml;break;case BFN.CONST.TOUCH_UP_PRESETS.perfectskin:i=sl}super(t,i),this.padding=0,this.currentPreset=e}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurSampler||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get averageColor(){return this.uniforms.averageColor}set averageColor(e){this.uniforms.averageColor=e}get color_palette(){return this.uniforms.color_palette}set color_palette(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_palette=e}get strength(){return this.uniforms.strength}set strength(e){this.uniforms.strength=e}get blurSampler(){return this.uniforms.blurSampler}set blurSampler(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get blurSampler2(){return this.uniforms.blurSampler2}set blurSampler2(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler2=e}get curvesSampler(){return this.uniforms.curvesSampler}set curvesSampler(e){this.uniforms.curvesSampler=e}},UnPremultiplyFilter:class extends PIXI.Filter{constructor(){super(ta,_l),this.padding=0}apply(e,t,i,r){e.applyFilter(this,t,i,r)}},ColorMixerFilter:class extends PIXI.Shader{constructor(e){super(e,ta,Il)}get red(){return this._red}set red(e){e/=255,this._red=e}get green(){return this._green}set green(e){e/=255,this._green=e}get blue(){return this._blue}set blue(e){e/=255,this._blue=e}get bw(){return this._bw}set bw(e){this._bw=e}applyParams(e){this.uniforms.red=this.red,this.uniforms.green=this.green,this.uniforms.blue=this.blue,this.uniforms.bw=this.bw}},SoftenFilter:class extends PIXI.Filter{constructor(){super(ta,Tl),this.padding=0,this.softness=1,this.lightness=1}apply(e,t,i){var r=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,i)}get softness(){return this.uniforms.softness}set softness(e){this.uniforms.hasOwnProperty("softness")&&(this.uniforms.softness=e)}get lightness(){return this.uniforms.lightness}set lightness(e){e/=100,this.uniforms.hasOwnProperty("lightness")&&(this.uniforms.lightness=e)}get blurImage(){return this.uniforms.blurImage}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},SmoothingFilter:class extends PIXI.Filter{constructor(){super(ta,bl),this.padding=0,this.amount=1}apply(e,t,i){var r=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,i)}get amount(){return this.uniforms.amount}set amount(e){this.uniforms.amount=e}get blurImage(){return this.uniforms.blurImage}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},BlurEdgesFilter:class extends PIXI.Filter{constructor(){super(ta,Sl),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurImage||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get blurImage(){return this.uniforms.blurImage}set blurImage(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}get size(){return this.uniforms.size}set size(e){e/=101,this.uniforms.size=e}get shift_vertical(){return this.uniforms.shift_vertical}set shift_vertical(e){e/=100,this.uniforms.shift_vertical=e}get shift_horizontal(){return this.uniforms.shift_horizontal}set shift_horizontal(e){e/=100,this.uniforms.shift_horizontal=e}},AutoEnhanceFilter:class extends PIXI.Filter{constructor(){super(ta,Cl),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i,this.blurSampler||null);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get blurSampler(){return this.uniforms.blurSampler}set blurSampler(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}get averageColor(){return this.uniforms.averageColor}set averageColor(e){this.uniforms.averageColor=e}get amount(){return this.uniforms.amount}set amount(e){e=BFN.FilterHelper.normalize(e,0,100),this.uniforms.amount=e}},ColorOverlayFilter:class extends PIXI.Filter{constructor(){super(ta,Bl),this.padding=0,this.color=16777215,this.intensity=1,this.alpha=1,this.ignoreTransparency=!1,this.binaryTransparency=!1}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get color(){return this._color}set color(e){this._color=Math.max(0,Math.min(16777215,e)),this.uniforms.color=BFN.FilterHelper.hex2rgbFactor(this.color)}get intensity(){return this._intensity}set intensity(e){this._intensity=e,this.uniforms.intensity=Math.max(0,Math.min(1,this.intensity))}get alpha(){return this._alpha}set alpha(e){this._alpha=e,this.uniforms.alpha=Math.max(0,Math.min(1,this.alpha))}get ignoreTransparency(){return this._ignoreTransparency}set ignoreTransparency(e){this._ignoreTransparency=e,this.uniforms.ignoreTransparency=this.ignoreTransparency?1:0}get binaryTransparency(){return this._binaryTransparency}set binaryTransparency(e){this._binaryTransparency=e,this.uniforms.binaryTransparency=this.binaryTransparency?1:0}},ColorOffsetFilter:class extends PIXI.Filter{constructor(){super(ta,Fl),this.padding=0,this.resolution=1,this.redOffset=0,this.greenOffset=0,this.blueOffset=0}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get redOffset(){return this._redOffset}set redOffset(e){this._redOffset=Math.max(-1,Math.min(1,e)),this.uniforms.redOffset=this.redOffset}get greenOffset(){return this._greenOffset}set greenOffset(e){this._greenOffset=Math.max(-1,Math.min(1,e)),this.uniforms.greenOffset=this.greenOffset}get blueOffset(){return this._blueOffset}set blueOffset(e){this._blueOffset=Math.max(-1,Math.min(1,e)),this.uniforms.blueOffset=this.blueOffset}},ColorReplaceFilter:class extends PIXI.Shader{constructor(e){super(e,ta,El)}get sourceColor(){return this._sourceColor}set sourceColor(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this._sourceColor=e}get targetColor(){return this._targetColor}set targetColor(e){e=BFN.FilterHelper.hex2rgb(e),this._targetColor=e}get targetAlpha(){return this._targetAlpha}set targetAlpha(e){e=Math.max(0,Math.min(1,e)),this._targetAlpha=e}get tolerance(){return this._tolerance}set tolerance(e){this._tolerance=e}applyParams(e){this.uniforms.sourceColor=this.sourceColor,this.uniforms.targetColor=this.targetColor,this.uniforms.targetAlpha=this.targetAlpha,this.uniforms.tolerance=this.tolerance}},LiquifyBrushFilter:class extends PIXI.Filter{constructor(){super(ta,Pl),this.padding=0,this.resolution=1,this.modes=["smudge","grow","shrink","erase"],this.mode="smudge",this.beta=0,this.pressure=1,this.vTextureCoordMax=1}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get mode(){return this._mode}set mode(e){-1!=this.modes.indexOf(e)&&(this._mode=e,this.uniforms.mode=this.modes.indexOf(e))}get beta(){return this._beta}set beta(e){this._beta=e,this.uniforms.beta=this.beta}get pressure(){return this._pressure}set pressure(e){this._pressure=Math.max(0,Math.min(1,e)),this.uniforms.pressure=this.pressure}get vTextureCoordMax(){return this._vTextureCoordMax}set vTextureCoordMax(e){this._vTextureCoordMax=Math.max(0,Math.min(1,e)),this.uniforms.vTextureCoordMax=this.vTextureCoordMax}},DisplacementFilter:class extends PIXI.Filter{constructor(){super(ta,Nl),this.padding=0,this.resolution=1,this.isDisplay=!1,this.inputScale=1,this.inputSprite=null,this.strength=1}apply(e,t,i,r){if(e.applyFilter(this,t,i,r),this.inputSprite&&this.iChannel1)try{var a=this._inputSprite.texture.width*(this._isDisplay?this._inputScale:1),n=this._inputSprite.texture.height*(this._isDisplay?this._inputScale:1);this._mapW=this._isDisplay?t.size.width:BFN.FilterHelper.getNextPowerOfTwo(a),this._mapH=this._isDisplay?t.size.height:BFN.FilterHelper.getNextPowerOfTwo(n);var o=this._inputSprite.getGlobalPosition();this.uniforms.vTextureCoordMinX=this._isDisplay?Math.abs(Math.min(0,o.x))/a:0,this.uniforms.vTextureCoordMinY=this._isDisplay?Math.abs(Math.min(0,o.y))/n:0,this.uniforms.vTextureCoordMaxX=a/this._mapW,this.uniforms.vTextureCoordMaxY=n/this._mapH;var s=Math.round(Math.min(a,n)/16);this.uniforms.maxDisplacementX=s/this._mapW,this.uniforms.maxDisplacementY=s/this._mapH,e.applyFilter(this,t,i,r)}catch(e){}}get isDisplay(){return this._isDisplay}set isDisplay(e){this._isDisplay=e}get inputScale(){return this._inputScale}set inputScale(e){this._inputScale=e}get inputSprite(){return this._inputSprite}set inputSprite(e){this._inputSprite=e}get strength(){return this.uniforms.strength}set strength(e){this.uniforms.strength=Math.max(0,Math.min(1,e))}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}},ReplaceFilter:class extends PIXI.Filter{constructor(){super(ta,Ml),this.padding=0,this.resolution=1,this.modes=["darks","lights"],this.mode="darks",this.color=0}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get color(){return this._color}set color(e){this._color=e,this.uniforms.color=BFN.Util.hex2rgbVec3(this._color)}get mode(){return this._mode}set mode(e){-1!=this.modes.indexOf(e)&&(this._mode=e,this.uniforms.mode=this.modes.indexOf(e))}},AlphaMaskFilter:class extends PIXI.Filter{constructor(){super(ta,Dl),this.padding=0,this.resolution=1,this.inverse=!1,this.isDisplay=!1,this.inputScale=1,this.inputSprite=null,this.inputTexture=null}apply(e,t,i,r){if(this._inputSprite&&this._iChannel1)try{var a=this._inputSprite.texture.width*(this._isDisplay?this._inputScale:1),n=this._inputSprite.texture.height*(this._isDisplay?this._inputScale:1);this._mapW=this._isDisplay?t.size.width:BFN.FilterHelper.getNextPowerOfTwo(a),this._mapH=this._isDisplay?t.size.height:BFN.FilterHelper.getNextPowerOfTwo(n);var o=this._inputSprite.getGlobalPosition();this.uniforms.vTextureCoordMinX=this._isDisplay?Math.abs(Math.min(0,o.x))/a:0,this.uniforms.vTextureCoordMinY=this._isDisplay?Math.abs(Math.min(0,o.y))/n:0,this.uniforms.vTextureCoordMaxX=a/this._mapW,this.uniforms.vTextureCoordMaxY=n/this._mapH,e.applyFilter(this,t,i,r)}catch(e){}}get inverse(){return this._inverse}set inverse(e){this._inverse=e,this.uniforms.inverse=e?1:0}get isDisplay(){return this._isDisplay}set isDisplay(e){this._isDisplay=e}get inputScale(){return this._inputScale}set inputScale(e){this._inputScale=e}get inputSprite(){return this._inputSprite}set inputSprite(e){this._inputSprite=e}get iChannel1(){return this._iChannel1}set iChannel1(e){this._iChannel1=e,this.uniforms.iChannel1=e}},MaskBlendFilter:class extends PIXI.Filter{constructor(){super(ta,wl),this.padding=0,this.resolution=1,this.inverse=!1,this.unmaskedAlpha=1,this.blendColor=null,this.blendIntensity=1,this.blendTexture=null,this.maskTexture=null,this.useInputAlpha=!1}apply(e,t,i,r){var a=t.sourceFrame.width,n=t.sourceFrame.height,o=BFN.FilterHelper.getNextPowerOfTwo(a),s=BFN.FilterHelper.getNextPowerOfTwo(n);this.uniforms.vTextureCoordMaxX=a/o,this.uniforms.vTextureCoordMaxY=n/s,e.applyFilter(this,t,i,r)}get inverse(){return this._inverse}set inverse(e){this._inverse=e,this.uniforms.inverse=e?1:0}get unmaskedAlpha(){return this._unmaskedAlpha}set unmaskedAlpha(e){this._unmaskedAlpha=Math.max(0,Math.min(1,e)),this.uniforms.unmaskedAlpha=e}get blendColor(){return this._blendColor}set blendColor(e){this._blendColor=e,this.uniforms.blendColor=null===e?[0,0,0,0]:[..."string"==typeof e&&6===e.length?BFN.FilterHelper.hex2rgb(e):[0,0,0],1],this.uniforms.useBlendColor=null===e?0:1}get blendIntensity(){return this._blendIntensity}set blendIntensity(e){this._blendIntensity=Math.max(0,Math.min(1,e)),this.uniforms.blendIntensity=e}get blendTexture(){return this._blendTexture}set blendTexture(e){this._blendTexture=e||PIXI.Texture.EMPTY,this.uniforms.blendTexture=this._blendTexture,this.uniforms.useBlendTexture=e?1:0}get maskTexture(){return this._maskTexture}set maskTexture(e){this._maskTexture=e||PIXI.Texture.EMPTY,this.uniforms.maskTexture=this._maskTexture,this.uniforms.useMaskTexture=e?1:0}get useInputAlpha(){return!!this.uniforms.useInputAlpha}set useInputAlpha(e){this.uniforms.useInputAlpha=e?1:0}},OuterGlowFilter:class extends PIXI.Filter{constructor(){super(ta,kl),this.padding=0,this.quality=4,this.intensity=.5,this.size=20,this.color="FFFFFF"}apply(e,t,i,r){var a=e.getRenderTarget(!0);this.plainFilter||(this.plainFilter=new BFN.filters.PlainFilter),e.applyFilter(this.plainFilter,t,a,!0),e.applyFilter(this,a,i,r),e.returnRenderTarget(a)}get quality(){return this.uniforms.quality}set quality(e){this.uniforms.quality=Math.floor(Math.max(1,Math.min(8,e)))}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=Math.max(0,Math.min(1,e))}get size(){return this.uniforms.size}set size(e){this.uniforms.size=Math.max(0,e)}get color(){return this.uniforms.color}set color(e){this.uniforms.color=BFN.FilterHelper.hex2rgbFactor(e)}},GlowPrepFilter:class extends PIXI.Filter{constructor(){super(ta,Ll),this.padding=0,this.minInput=.8,this.maxInput=.85,this.saturation=-.5,this.tint=-1}get minInput(){return this.uniforms.minInput}set minInput(e){this.uniforms.minInput=Math.max(0,Math.min(1,e))}get maxInput(){return this.uniforms.maxInput}set maxInput(e){this.uniforms.maxInput=Math.max(0,Math.min(1,e))}get saturation(){return this.uniforms.saturation}set saturation(e){this.uniforms.saturation=Math.max(-1,Math.min(1,e))}get tint(){return this.uniforms.tint}set tint(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this.uniforms.tint=e}},GlowPostFilter:class extends PIXI.Filter{constructor(){super(ta,Ol),this.padding=0}},GrainFilter:class extends PIXI.Filter{constructor(){super(ta,Rl),this.padding=0,this.intensity=.1,this.distribution=4,this.monochromatic=!1,this.seed=1}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=Math.max(0,Math.min(1,e))}get distribution(){return this.uniforms.distribution}set distribution(e){this.uniforms.distribution=Math.round(Math.max(0,Math.min(5,e)))}get seed(){return this.uniforms.seed}set seed(e){this.uniforms.seed=Math.round(Math.max(0,e))}get monochromatic(){return this.uniforms.monochromatic}set monochromatic(e){this.uniforms.monochromatic=!!e}},ScanLinesFilter:class extends PIXI.Filter{constructor(){super(ta,Al),this.padding=0,this.lineColor="000000",this.opacity=.5,this.spacing=2}get lineColor(){return this.uniforms.lineColor}set lineColor(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.lineColor=e}get opacity(){return this.uniforms.opacity}set opacity(e){this.uniforms.opacity=Math.max(0,Math.min(1,e))}get spacing(){return this.uniforms.spacing}set spacing(e){this.uniforms.spacing=Math.max(0,e)}get invert(){return this.uniforms.invert}set invert(e){this.uniforms.invert=!!e}},SweepFilter:class extends PIXI.Filter{constructor(){super(ta,Vl),this.padding=0,this.sourceW=0,this.sourceH=0,this.averageColor=[0,0,0],this.plainFilter=new BFN.filters.PlainFilter}setDimensions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e>0&&t>0&&(this.sourceW!==e||this.sourceH!==t)&&(this.sourceW=e,this.sourceH=t,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)])}apply(e,t,i,r){var a=e.getRenderTarget(!0),n=e.getRenderTarget(!0);this.plainFilter.apply(e,t,a,!0);for(var o=Math.min(200,this.sourceH)+2,s=0;s<o;s++){this.uniforms.pass=s,e.applyFilter(this,a,n,!0);var l=n;n=a,a=l}this.plainFilter.apply(e,a,i,!0),e.returnRenderTarget(a),e.returnRenderTarget(n)}get averageColor(){return this.uniforms.averageColor}set averageColor(e){this.uniforms.averageColor=e}},InvertChannelFilter:class extends PIXI.Filter{constructor(){super(ta,Ul),this.padding=0}apply(e,t,i,r){e.applyFilter(this,t,i,r)}},DirectionalBlurFilter:class extends PIXI.Filter{constructor(){super(ta,Gl),this.padding=0,this.sourceW=0,this.sourceH=0,this._maxSpread=0,this._maxSpreadCalc=0,this.amount=1,this.direction=0,this.blendAlpha=!1,this.alphaChoke=0,this.iterations=5,this.biDirectional=!1,this.plainFilter=new BFN.filters.PlainFilter}setDimensions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;e>0&&t>0&&(this.sourceW!==e||this.sourceH!==t||this._maxSpread!==i)&&(this.sourceW=e,this.sourceH=t,this.setMaxSpread(i),this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)])}setMaxSpread(e){isNaN(parseInt(e))?this._maxSpread=Math.max(this.sourceW,this.sourceH)/32:this._maxSpread=e,this._maxSpreadCalc=this._maxSpread/this._bleedFactor}apply(e,t,i,r){var a=e.getRenderTarget(!0),n=e.getRenderTarget(!0);this.plainFilter.apply(e,t,a,!0);for(var o=(t,i)=>{this.uniforms.spread=t,this.uniforms.direction=i,e.applyFilter(this,a,n,!0);var r=n;n=a,a=r},s=0;s<this._iterations;s++){var l=this._amount*this._maxSpreadCalc/Math.pow(2,s);o(l,this._direction),this.biDirectional&&o(l,this._direction+Math.PI/2)}this.plainFilter.apply(e,a,i,!0),e.returnRenderTarget(a),e.returnRenderTarget(n)}get amount(){return this._amount}set amount(e){this._amount=Math.max(0,Math.min(1,e))}get direction(){return this._direction}set direction(e){this._direction=e}get blendAlpha(){return this._blendAlpha}set blendAlpha(e){this._blendAlpha=e,this.uniforms.blendAlpha=e?1:0}get alphaChoke(){return this._alphaChoke}set alphaChoke(e){this._alphaChoke=Math.max(0,Math.min(1,e)),this.uniforms.alphaChoke=this._alphaChoke}get iterations(){return this._iterations}set iterations(e){this._iterations=e,this._bleedFactor=0;for(var t=0;t<this._iterations;t++)this._bleedFactor+=1/Math.pow(2,t);this.setMaxSpread(this._maxSpread)}get biDirectional(){return this._biDirectional}set biDirectional(e){this._biDirectional=e}},GlitchCorruptedFilter:class extends PIXI.Filter{constructor(){super(ta,Hl),this.padding=0,this.sourceW=0,this.sourceH=0,this.seed=1,this.strength=.5,this.chromatic=.5,this.noise=.5}setDimensions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e>0&&t>0&&(this.sourceW!==e||this.sourceH!==t)&&(this.sourceW=e,this.sourceH=t,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)],this.drawGlitchSource())}drawGlitchSource(){var e=this;if(this.glitchSourceTexture||(this.glitchSourceTexture=PIXI.RenderTexture.create(32,32),this.uniforms.glitchSrc=this.glitchSourceTexture),this.sourceW>0&&this.sourceH>0){this.glitchSourceTexture.width!==this.sourceW&&this.glitchSourceTexture.height!==this.sourceH&&this.glitchSourceTexture.resize(this.sourceW,this.sourceH),this.glitchSourceGraphic||(this.glitchSourceGraphic=new PIXI.Graphics);var t=Math.min(this.sourceW,this.sourceH),i=this.seed,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return i=(9301*i+49297)%233280,Math.round(e+i/233280*(t-e))},a=()=>r()/10*2-1,n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={r:Math.max(0,Math.min(255,128+Math.round(16*e))),g:Math.max(0,Math.min(255,128+Math.round(16*t))),b:Math.max(0,Math.min(255,128+Math.round(16*i)))};return parseInt("0x"+BFN.ColorUtil.rgbaObjectToHexStringObject(r).hex)},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8421504,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;arguments.length>6&&void 0!==arguments[6]&&arguments[6]&&e.glitchSourceGraphic.clear(),r<=0||a<=0||(e.glitchSourceGraphic.beginFill(n,o),e.glitchSourceGraphic.drawRect(t,i,r,a),e.glitchSourceGraphic.endFill())},s=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t){t=Math.max(1,Math.round(t));for(var s=Math.floor(t/2),l=0;l<e.sourceH;){var h=t+Math.round(a()*s),c=r();if(c<2||c>8){var u=Math.abs(c-5)/(c-5),d=Math.round((r(0,6)-3)/3);o(0,l,e.sourceW,h,n(u,d),i)}l=Math.round(l+h)}}},l=Math.max(2,Math.round(t/40)),h=Math.round(l/2),c=!1,u=!1,d=null,m=0,p=0,g=0;o(0,0,this.sourceW,this.sourceH,n(0),1,!0),s(t/10,1),s(t/5,.25),(()=>{for(var e=0;e<this.sourceH;){if(c){if(u){var t=Math.round(-1===p?m:this.sourceW-m),i=Math.floor(t/h/8*(h/l)),a=r(0,i),s=-1===p?0:m,f=t;if(a){var v=Math.round(a*h*2);f-=v,1===p&&(s+=v)}if(o(s,e,f,h,d),a){s=1===p?s:f-h;for(var y=0;y<a&&!(r(0,9)<5);y++)s=Math.round(s-p*h*2),o(s,e,h,h,d)}}u=!u,g+=h,(r()<=3||g>=1*l)&&(c=!1,u=!1)}else if(h=Math.max(1,Math.round((h+r())%l)),r()<=1){var x=r(),_=Math.abs(x-5)/(x-5)*1;_&&(m=Math.round(r(0,50)/50*this.sourceW),p=r(0,9)<5?-1:1,m+p>0&&m+p<this.sourceW&&(c=!0,u=!0,d=n(_,Math.round((r(0,6)-3)/3)),g=0))}e=Math.round(e+h)}})(),BFN.Stage.render(this.glitchSourceGraphic,this.glitchSourceTexture)}else this.glitchSourceTexture.fillColor(8947848)}clearGlitchSource(){this.glitchSourceGraphic&&(this.glitchSourceGraphic.clear(),this.glitchSourceGraphic=null),this.glitchSourceTexture&&(this.glitchSourceTexture.destroyGC(!0),this.glitchSourceTexture=null),this.sourceW=0,this.sourceH=0}get seed(){return this.uniforms.seed}set seed(e){this.uniforms.seed=Math.round(Math.max(0,e))}get strength(){return this.uniforms.strength}set strength(e){this.uniforms.strength=Math.max(0,Math.min(1,e))}get noise(){return this.uniforms.noise}set noise(e){this.uniforms.noise=Math.max(0,Math.min(1,e))}get chromatic(){return this.uniforms.chromatic}set chromatic(e){this.uniforms.chromatic=Math.max(0,Math.min(1,e))}get vShift(){return this.uniforms.vShift}set vShift(e){this.uniforms.vShift=Math.max(0,Math.min(1,e))}},GlitchDistortedFilter:class extends PIXI.Filter{constructor(){super(ta,zl),this.padding=0,this.sourceTexture=null,this.sourceW=0,this.sourceH=0,this.phase=0,this.length=.2,this.horizontal=.2,this.directionalBlurFilter=null,this.directionalBlurTexture=null,this.directionalBlurSprite=new PIXI.Sprite}setSourceTexture(e){if(e&&e.baseTexture&&e!==this.sourceTexture){this.resetSourceTexture(),this.sourceTexture=e,this.sourceW=e.width,this.sourceH=e.height,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)],this.directionalBlurFilter||(this.directionalBlurFilter=new BFN.filters.DirectionalBlurFilter,this.directionalBlurFilter.amount=.25,this.directionalBlurFilter.direction=0),this.directionalBlurFilter.setDimensions(this.sourceW,this.sourceH),this.directionalBlurSprite.texture=this.sourceTexture,this.directionalBlurSprite.filters=[this.directionalBlurFilter],this.directionalBlurTexture=PIXI.RenderTexture.create(this.sourceW,this.sourceH),BFN.Stage.render(this.directionalBlurSprite,this.directionalBlurTexture),this.uniforms.blurTexture=this.directionalBlurTexture,this.drawArtifactGraphic();var t=this.sourceW*this.sourceH,i=Math.sqrt(t)/20/Math.sqrt(33e3),r=Math.round(100*i),a=Math.round(330*i);this.artifactGraphic.scale.x=r/100,this.artifactGraphic.scale.y=a/330,this.artifactTexture=PIXI.RenderTexture.create(r,a),BFN.Stage.render(this.artifactGraphic,this.artifactTexture),this.uniforms.artifactTexture=this.artifactTexture,this.uniforms.artifactDimensions=[r,a]}}resetSourceTexture(){this.sourceW=0,this.sourceH=0,this.sourceTexture=null;try{this.directionalBlurTexture.destroyGC(!0)}catch(e){}this.directionalBlurTexture=null,this.directionalBlurSprite.texture=PIXI.Texture.EMPTY,this.directionalBlurSprite.filters=[];try{this.artifactTexture.destroyGC(!0)}catch(e){}this.artifactTexture=null}drawArtifactGraphic(){if(!this.artifactGraphic){var e=new PIXI.Graphics;e.beginFill(0),e.drawRect(0,0,100,330),e.endFill(),e.beginFill(16777215),e.drawRect(0,0,37,6),e.drawRect(0,7,37,1),e.drawRect(0,9,37,1),e.drawRect(0,10,5,5),e.drawRect(13,10,24,5),e.drawRect(39,10,8,5),e.drawRect(54,0,11,8),e.drawRect(54,8,6,1),e.drawRect(54,9,11,1),e.drawRect(52,10,13,5),e.drawRect(72,4,7,4),e.drawRect(72,9,7,3),e.drawRect(81,4,11,4),e.drawRect(81,9,11,3),e.drawRect(94,5,1,5),e.drawRect(0,19,14,2),e.drawRect(18,19,19,2),e.drawRect(38,19,27,2),e.drawRect(72,19,7,2),e.drawRect(79,19,2,1),e.drawRect(81,19,19,2),e.drawRect(56,32,5,1),e.drawRect(56,34,5,2),e.drawRect(69,32,1,1),e.drawRect(70,33,4,1),e.drawRect(74,32,23,1),e.drawRect(69,34,28,2),e.drawRect(14,86,10,1),e.drawRect(27,86,10,1),e.drawRect(38,86,17,1),e.drawRect(6,91,5,3),e.drawRect(0,94,14,3),e.drawRect(14,95,23,2),e.drawRect(24,97,3,1),e.drawRect(38,95,17,2),e.drawRect(36,130,1,2),e.drawRect(39,130,26,2),e.drawRect(72,130,12,2),e.drawRect(50,133,44,1),e.drawRect(42,134,58,1),e.drawRect(40,135,54,1),e.drawRect(0,136,21,2),e.drawRect(28,136,6,2),e.drawRect(34,136,3,1),e.drawRect(37,136,28,2),e.drawRect(66,136,24,2),e.drawRect(26,164,12,2),e.drawRect(38,164,12,3),e.drawRect(38,167,14,3),e.drawRect(38,170,12,2),e.drawRect(56,164,23,8),e.drawRect(80,164,7,8),e.drawRect(0,173,22,6),e.drawRect(24,173,26,6),e.drawRect(56,173,20,6),e.drawRect(70,179,6,5),e.drawRect(0,184,22,1),e.drawRect(0,186,22,1),e.drawRect(0,187,8,1),e.drawRect(11,187,11,1),e.drawRect(24,184,26,1),e.drawRect(24,185,14,1),e.drawRect(24,186,26,2),e.drawRect(56,184,7,1),e.drawRect(62,185,1,1),e.drawRect(56,186,7,2),e.drawRect(66,184,10,4),e.drawRect(18,243,30,1),e.drawRect(50,238,9,1),e.drawRect(50,240,9,4),e.drawRect(59,238,3,2),e.drawRect(59,241,3,3),e.drawRect(62,238,9,1),e.drawRect(62,240,9,4),e.drawRect(72,238,16,1),e.drawRect(72,240,16,4),e.drawRect(72,245,13,1),e.drawRect(92,245,8,1),e.drawRect(23,273,66,2),e.drawRect(36,277,36,1),e.drawRect(16,292,22,3),e.drawRect(39,292,26,3),e.drawRect(72,292,7,3),e.drawRect(81,292,11,3),e.endFill(),this.artifactGraphic=e}}get grayscale(){return this.uniforms.grayscale}set grayscale(e){this.uniforms.grayscale=Math.round(Math.max(0,Math.min(1,e)))}get phase(){return this.uniforms.phase}set phase(e){this.uniforms.phase=Math.max(0,Math.min(1,e))}get length(){return this.uniforms.length}set length(e){this.uniforms.length=Math.max(0,Math.min(1,e))}get horizontal(){return this.uniforms.horizontal}set horizontal(e){this.uniforms.horizontal=Math.max(0,Math.min(1,e))}},GlitchSegmentedFilter:class extends PIXI.Filter{constructor(){super(ta,Xl),this.padding=0,this.sourceW=0,this.sourceH=0,this.horizontal=.1,this.vertical=0,this.colorCycle=0}setDimensions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e>0&&t>0&&(this.sourceW!==e||this.sourceH!==t)&&(this.sourceW=e,this.sourceH=t,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)])}get grayscale(){return this.uniforms.grayscale}set grayscale(e){this.uniforms.grayscale=Math.round(Math.max(0,Math.min(1,e)))}get horizontal(){return this.uniforms.horizontal}set horizontal(e){this.uniforms.horizontal=Math.max(-1,Math.min(1,e))}get vertical(){return this.uniforms.vertical}set vertical(e){this.uniforms.vertical=Math.max(-1,Math.min(1,e))}get colorCycle(){return this.uniforms.colorCycle}set colorCycle(e){this.uniforms.colorCycle=Math.max(0,Math.min(5,e))}},GlitchFragmentedFilter:class extends PIXI.Filter{constructor(){super(ta,jl),this.padding=0,this.sourceTexture=null,this.sourceW=0,this.sourceH=0}setSourceTexture(e){e&&e.baseTexture&&e!==this.sourceTexture&&(this.resetSourceTexture(),this.sourceTexture=e,this.sourceW=e.width,this.sourceH=e.height,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)],this.generateLoresTextures())}resetSourceTexture(){this.sourceW=0,this.sourceH=0,this.sourceTexture=null,this.destroyLoresTextures()}generateLoresTextures(){if(this.sourceTexture&&this.sourceW&&this.sourceH){var e=(e,t,i)=>{t=t||512;var r={x:(i=i||t)/e.width,y:t/e.width},a=PIXI.RenderTexture.create(Math.max(1,Math.min(BFN.maxImageSize,Math.round(e.width*r.x))),Math.max(1,Math.min(BFN.maxImageSize,Math.round(e.height*r.y))));return r.x=a.width/e.width,r.y=a.height/e.height,a.copyPixels(e,void 0,void 0,void 0,r),a};this.loresTexture1||(this.loresTexture1=e(this.sourceTexture,512),this.uniforms.loresTexture1=this.loresTexture1,this.uniforms.loresDimensions1=[this.loresTexture1.width,this.loresTexture1.height]),this.loresTexture2||(this.loresTexture2=e(this.loresTexture1,144),this.uniforms.loresTexture2=this.loresTexture2,this.uniforms.loresDimensions2=[this.loresTexture2.width,this.loresTexture2.height]),this.loresTexture3||(this.loresTexture3=e(this.loresTexture1,64),this.uniforms.loresTexture3=this.loresTexture3,this.uniforms.loresDimensions3=[this.loresTexture3.width,this.loresTexture3.height]),this.loresTexture4||(this.loresTexture4=e(this.loresTexture1,24),this.uniforms.loresTexture4=this.loresTexture4,this.uniforms.loresDimensions4=[this.loresTexture4.width,this.loresTexture4.height])}}destroyLoresTextures(){try{this.loresTexture1.destroyGC(!0)}catch(e){}this.loresTexture1=null;try{this.loresTexture2.destroyGC(!0)}catch(e){}this.loresTexture2=null;try{this.loresTexture3.destroyGC(!0)}catch(e){}this.loresTexture3=null;try{this.loresTexture4.destroyGC(!0)}catch(e){}this.loresTexture4=null}get grayscale(){return this.uniforms.grayscale}set grayscale(e){this.uniforms.grayscale=Math.round(Math.max(0,Math.min(1,e)))}get highlights(){return this.uniforms.highlights}set highlights(e){this.uniforms.highlights=Math.max(0,Math.min(1,e))}get offset(){return this.uniforms.offset}set offset(e){this.uniforms.offset=Math.max(0,Math.min(1,e))}},GlitchDigitizedFilter:class extends PIXI.Filter{constructor(){super(ta,Wl),this.padding=0,this.colorValue="55CC55",this.highlights=.5,this.weight=.5,this.horizontal=.5,this.sourceTexture=null,this.sourceW=0,this.sourceH=0,this.sweepFilter=null}setSourceTexture(e){e&&e.baseTexture&&e!==this.sourceTexture&&(this.resetSourceTexture(),this.sourceTexture=e,this.sourceW=e.width,this.sourceH=e.height,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)],this.generateHelperTextures())}resetSourceTexture(){this.sourceW=0,this.sourceH=0,this.sourceTexture=null,this.destroyHelperTextures()}generateHelperTextures(){if(this.sourceTexture&&this.sourceW&&this.sourceH&&!this.loresTexture){var e=this.sourceW*this.sourceH,t=Math.min(.5,256/Math.sqrt(e)),i={x:t,y:t};this.loresTexture=PIXI.RenderTexture.create(Math.max(1,Math.min(BFN.maxImageSize,Math.round(this.sourceTexture.width*i.x))),Math.max(1,Math.min(BFN.maxImageSize,Math.round(this.sourceTexture.height*i.y)))),i.x=this.loresTexture.width/this.sourceTexture.width,i.y=this.loresTexture.height/this.sourceTexture.height,this.loresTexture.copyPixels(this.sourceTexture,void 0,void 0,void 0,i),this.uniforms.loresTexture=this.loresTexture,this.uniforms.loresDimensions=[this.loresTexture.width,this.loresTexture.height],this.sweepFilter||(this.sweepFilter=new BFN.filters.SweepFilter),this.sweepFilter.setDimensions(this.loresTexture.width,this.loresTexture.height),this.sweepFilter.averageColor=BFN.Util.getTextureAverageColor(this.loresTexture,!1,!0);var r=new PIXI.Sprite(this.loresTexture);r.filters=[this.sweepFilter],this.sweepTexture=PIXI.RenderTexture.create(this.loresTexture.width,this.loresTexture.height),BFN.Stage.render(r,this.sweepTexture),r.filters=[],r.destroy(!1),this.uniforms.sweepTexture=this.sweepTexture}}destroyHelperTextures(){try{this.loresTexture.destroyGC(!0)}catch(e){}this.loresTexture=null;try{this.sweepTexture.destroyGC(!0)}catch(e){}this.sweepTexture=null;try{this.artifactTexture.destroyGC(!0)}catch(e){}this.artifactTexture=null}get colorValue(){return this.uniforms.colorValue}set colorValue(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this.uniforms.colorValue=e}get highlights(){return this.uniforms.highlights}set highlights(e){this.uniforms.highlights=Math.max(0,Math.min(1,e))}get weight(){return this.uniforms.weight}set weight(e){this.uniforms.weight=Math.max(0,Math.min(1,e))}get horizontal(){return this.uniforms.horizontal}set horizontal(e){this.uniforms.horizontal=Math.max(0,Math.min(1,e))}},TelevisionFilter:class extends PIXI.Filter{constructor(){super(ta,Yl),this.padding=0}get pixelSize(){return this.uniforms.pixelSize}set pixelSize(e){this.uniforms.pixelSize=Math.max(1,e)}get dimensions(){return this.uniforms.dimensions}set dimensions(e){this.uniforms.dimensions=e}},ChromaticAberrationFilter:class extends PIXI.Filter{constructor(){super(ta,ql),this.padding=0,this.distortion=1}get distortion(){return this.uniforms.distortion}set distortion(e){this.uniforms.distortion=Math.max(0,e)}get focalPointX(){return this.uniforms.focalPointX}set focalPointX(e){this.uniforms.focalPointX=Math.max(0,Math.min(1,e))}get focalPointY(){return this.uniforms.focalPointY}set focalPointY(e){this.uniforms.focalPointY=Math.max(0,Math.min(1,e))}get dimensions(){return this.uniforms.dimensions}set dimensions(e){this.uniforms.dimensions=e}},AnamorphicFilter:class extends PIXI.Filter{constructor(){super(ta,Kl),this.padding=0,this.distortion=1}get stretch(){return this.uniforms.stretch}set stretch(e){this.uniforms.stretch=Math.max(0,Math.min(1,e))}get distortion(){return this.uniforms.distortion}set distortion(e){this.uniforms.distortion=Math.max(0,e)}get vignetteOpacity(){return this.uniforms.vignetteOpacity}set vignetteOpacity(e){this.uniforms.vignetteOpacity=Math.max(0,Math.min(1,e))}get edgeBlur(){return this.uniforms.edgeBlur}set edgeBlur(e){this.uniforms.edgeBlur=Math.max(0,Math.min(1,e))}get dimensions(){return this.uniforms.dimensions}set dimensions(e){this.uniforms.dimensions=e}get bloomSrc(){return this.uniforms.bloomSrc}set bloomSrc(e){this.uniforms.bloomSrc=e}get bloomSrcDimensions(){return this.uniforms.bloomSrcDimensions}set bloomSrcDimensions(e){this.uniforms.bloomSrcDimensions=e}},LensDistortionFilter:class extends PIXI.Filter{constructor(){super(ta,Ql),this.padding=0,this.distortion=1}get distortion(){return this.uniforms.distortion}set distortion(e){this.uniforms.distortion=Math.max(-1,Math.min(1,e))}get dimensions(){return this.uniforms.dimensions}set dimensions(e){this.uniforms.dimensions=e}},HalftoneDuoFilter:class extends PIXI.Filter{constructor(){super(ta,Zl),this.padding=0}get src(){return this.uniforms.src}set src(e){this.uniforms.src=e}get srcDimensions(){return this.uniforms.srcDimensions}set srcDimensions(e){this.uniforms.srcDimensions=e}get dimensions(){return this.uniforms.dimensions}set dimensions(e){this.uniforms.dimensions=e}get tolerance(){return this.uniforms.tolerance}set tolerance(e){this.uniforms.tolerance=Math.max(0,Math.min(1,e))}get invertColors(){return this.uniforms.invertColors}set invertColors(e){this.uniforms.invertColors=!!e}get shadowColor(){return this.uniforms.shadowColor}set shadowColor(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this.uniforms.shadowColor=e}get highlightColor(){return this.uniforms.highlightColor}set highlightColor(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this.uniforms.highlightColor=e}},ColorGradingFilter:class extends PIXI.Filter{constructor(){super(ta,Jl),this.padding=0}get shadowColor(){return this.uniforms.shadowColor}set shadowColor(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.shadowColor=e}get midtoneColor(){return this.uniforms.midtoneColor}set midtoneColor(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.midtoneColor=e}get highlightColor(){return this.uniforms.highlightColor}set highlightColor(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.highlightColor=e}get shadowIntensity(){return this.uniforms.shadowIntensity}set shadowIntensity(e){this.uniforms.shadowIntensity=Math.max(0,Math.min(1,e))}get midtoneIntensity(){return this.uniforms.midtoneIntensity}set midtoneIntensity(e){this.uniforms.midtoneIntensity=Math.max(0,Math.min(1,e))}get highlightIntensity(){return this.uniforms.highlightIntensity}set highlightIntensity(e){this.uniforms.highlightIntensity=Math.max(0,Math.min(1,e))}},WarpedBlurFilter:class extends PIXI.Filter{constructor(){super(ta,$l),this.padding=0}get strength(){return this.uniforms.strength}set strength(e){this.uniforms.strength=e}get phase(){return this.uniforms.phase}set phase(e){this.uniforms.phase=e}get scale(){return this.uniforms.scale}set scale(e){this.uniforms.scale=Math.max(0,Math.min(1,e))}get lightness(){return this.uniforms.lightness}set lightness(e){this.uniforms.lightness=Math.max(-1,Math.min(1,e))}get dimensions(){return this.uniforms.dimensions}set dimensions(e){this.uniforms.dimensions=e}get mapDimensions(){return this.uniforms.mapDimensions}set mapDimensions(e){this.uniforms.mapDimensions=e}},BokehBlurFilter:class extends PIXI.Filter{constructor(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!["","X3","X4","X5","X6","X7","X8","X9"].includes(t))throw new Error("Bokeh Blur Filter Variation Does Not Exist: "+t);switch(t){case"":super(ta,sh);break;case"X3":super(ta,oh);break;case"X4":super(ta,nh);break;case"X5":super(ta,ah);break;case"X6":super(ta,rh);break;case"X7":super(ta,ih);break;case"X8":super(ta,th);break;case"X9":super(ta,eh)}BFN.Stage.filterManager.shaderCache[this.glShaderKey]||(e=new PIXI.Shader(BFN.Stage.gl,this.vertexSrc,this.fragmentSrc),this.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[this.glShaderKey]=e),this.variation=t,this.padding=0,this.resolution=1,this.radius=1,this.aperture=0,this.bladeCount=6,this.dimensions=[0,0]}get amount(){return this.uniforms.radius}set amount(e){this.uniforms.radius=Math.max(0,Math.min(1,e))}get aperture(){return this.uniforms.aperture}set aperture(e){this.uniforms.aperture=Math.max(0,Math.min(1,e))}get bladeCount(){return""===this.variation?this.uniforms.bladeCount:parseInt(this.variation.replace("X",""))}set bladeCount(e){""===this.variation&&(this.uniforms.bladeCount=Math.max(3,Math.min(9,Math.round(e))))}get dimensions(){return this.uniforms.dimensions}set dimensions(e){this.uniforms.dimensions=e}get maskTexture(){return this.uniforms.maskTexture}set maskTexture(e){this.uniforms.maskTexture=e}get maskTextureInverted(){return!!this.uniforms.maskTextureInverted}set maskTextureInverted(e){this.uniforms.maskTextureInverted=e?1:0}get currentPass(){return this.uniforms.currentPass}set currentPass(e){this.uniforms.currentPass=Math.round(Math.max(0,Math.min(3,e)))}},BokehBGBlurFilter:class extends PIXI.Filter{constructor(){var e;super(ta,lh),BFN.Stage.filterManager.shaderCache[this.glShaderKey]||(e=new PIXI.Shader(BFN.Stage.gl,this.vertexSrc,this.fragmentSrc),this.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[this.glShaderKey]=e),this.amount=1,this._maxSpread=1,this.plainFilter=new BFN.filters.PlainFilter}apply(e,t,i,r){this.resolution=this._amount>.5?.25:.5,this.padding=1/this.resolution,this.uniforms.padding=this.padding;var a=e.getRenderTarget(!0),n=e.getRenderTarget(!0);this.plainFilter.apply(e,t,a,!0);for(var o=0;o<6;o++){var s=1/Math.pow(2,Math.floor(o/2));this.uniforms.spreadAmount=this._amount*this._maxSpread*s,this.uniforms.horizontal=o%2?1:0,e.applyFilter(this,a,n,!0);var l=n;n=a,a=l}this.plainFilter.apply(e,a,i,!0),e.returnRenderTarget(a),e.returnRenderTarget(n)}get amount(){return this._amount}set amount(e){this._amount=Math.max(0,Math.min(1,e))}get dimensions(){return this.uniforms.dimensions}set dimensions(e){this.uniforms.dimensions=e,this._maxSpread=Math.max(e[0],e[1])/32}get maskTexture(){return this.uniforms.maskTexture}set maskTexture(e){this.uniforms.maskTexture=e}get maskTextureInverted(){return!!this.uniforms.maskTextureInverted}set maskTextureInverted(e){this.uniforms.maskTextureInverted=e?1:0}},BokehGentleBlurFilter:class extends PIXI.Filter{constructor(){var e;super(ta,hh),BFN.Stage.filterManager.shaderCache[this.glShaderKey]||(e=new PIXI.Shader(BFN.Stage.gl,this.vertexSrc,this.fragmentSrc),this.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[this.glShaderKey]=e),this.padding=0,this.large=!1,this.dimensions=[0,0],this.mode=0}get large(){return!!this.uniforms.large}set large(e){this.uniforms.large=e?1:0}get amount(){return this.uniforms.amount}set amount(e){this.uniforms.amount=Math.max(0,Math.min(1,e))}get dimensions(){return this.uniforms.dimensions}set dimensions(e){this.uniforms.dimensions=e}get mode(){return this.uniforms.mode}set mode(e){this.uniforms.mode=Math.max(0,Math.min(2,e))}get threshold(){return this.uniforms.threshold}set threshold(e){this.uniforms.threshold=Math.max(1,e)}get intensity(){return this.uniforms.intensity}set intensity(e){this.uniforms.intensity=Math.max(0,Math.min(1,e))}get maskTexture(){return this.uniforms.maskTexture}set maskTexture(e){this.uniforms.maskTexture=e}get maskTextureInverted(){return!!this.uniforms.maskTextureInverted}set maskTextureInverted(e){this.uniforms.maskTextureInverted=e?1:0}get bgTexture(){return this.uniforms.bgTexture}set bgTexture(e){this.uniforms.bgTexture=e}},MagicBrushFilter:class extends PIXI.Filter{constructor(){super(ta,ch),this.padding=0,this.tolerance=.5,this.selectionColor=16711680}apply(e,t,i,r){this.uniforms.onePixel=[1/t.size.width,1/t.size.height],this.uniforms.dimensions=[t.sourceFrame.width/t.size.width,t.sourceFrame.height/t.size.height],e.applyFilter(this,t,i,!0)}get tolerance(){return this.uniforms.tolerance}set tolerance(e){this.uniforms.tolerance=Math.max(0,Math.min(1,e))}get selectionColor(){return this.uniforms.selectionColor}set selectionColor(e){this.uniforms.selectionColor=BFN.FilterHelper.hex2rgbFactor(e)}get unionTexture(){return this.uniforms.unionTexture}set unionTexture(e){this.uniforms.unionTexture=e}},PlainFilter:class extends PIXI.Filter{constructor(){var e;super(ta,uh),BFN.Stage.filterManager.shaderCache[this.glShaderKey]||(e=new PIXI.Shader(BFN.Stage.gl,this.vertexSrc,this.fragmentSrc),this.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[this.glShaderKey]=e)}},OutlineFilter:class extends PIXI.Filter{constructor(e,t){e=e||1,super(ta,vh.replace(/%THICKNESS%/gi,(1/e).toFixed(7))),this.padding=4,this.uniforms.thickness=e,this.uniforms.outlineColor=new Float32Array([0,0,0,1]),t&&(this.color=t)}get color(){return PIXI.utils.rgb2hex(this.uniforms.outlineColor)}set color(e){PIXI.utils.hex2rgb(e,this.uniforms.outlineColor)}},BilateralBlurFilter:class extends PIXI.Filter{constructor(e){super(dh,mh),this.padding=0,this.threshold=e||.1}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=1/a.x,this.uniforms.clampY=1/a.y,this.uniforms.onePixel[0]=1/t.size.width,this.uniforms.onePixel[1]=1/t.size.height,e.applyFilter(this,t,i,r)}get threshold(){return this.uniforms.threshold}set threshold(e){this.uniforms.threshold=e}},BackgroundFillFilter:class extends PIXI.Filter{constructor(){var e;super(ta,ph),BFN.Stage.filterManager.shaderCache[this.glShaderKey]||(e=new PIXI.Shader(BFN.Stage.gl,this.vertexSrc,this.fragmentSrc),this.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[this.glShaderKey]=e),this.padding=0}},TriMapColorFilter:class extends PIXI.Filter{constructor(){super(ta,gh),this.padding=0}},TransparentBackgroundFixFilter:class extends PIXI.Filter{constructor(){super(ta,fh),this.padding=0}apply(e,t,i,r){var a=BFN.FilterHelper.calculateFilterClamp(t,i);this.uniforms.clampX=a.x,this.uniforms.clampY=a.y,e.applyFilter(this,t,i,r)}get iChannel1(){return this.uniforms.iChannel1}set iChannel1(e){this.uniforms.iChannel1=e}}});BFN.effects.ClarityEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.clarityFilter=new BFN.filters.ClarityFilter,this.blurTexture=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.4,this.sourceTexture),this.clarityFilter.blurImage=this.blurTexture}applyEffect(e,t){this.clarityFilter.intensity=t.clarity_amount,this.clarityFilter.resolution=1,this.filters=[this.clarityFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}};BFN.effects.ColorEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.colorFilter=BFN.ShaderPool.ColorFilter,this.pluginName="filter_renderer"}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.colorFilter.hue=t.hue,this.colorFilter.saturation=t.saturation,this.colorFilter.temperature=t.temperature,this.bfn_shaders=[this.colorFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.ReplaceColorEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.pluginName="filter_renderer",this.replaceColorFilter=BFN.ShaderPool.ColorReplaceFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.replaceColorFilter.sourceColor=t.source_color,this.replaceColorFilter.tolerance=t.tolerance/100,-1==t.target_color?(this.replaceColorFilter.targetColor="FFFFFF",this.replaceColorFilter.targetAlpha=0,this.outputTransparent=!0):(this.replaceColorFilter.targetColor=t.target_color,this.replaceColorFilter.targetAlpha=t.target_color_intensity,this.outputTransparent=!1),this.bfn_shaders=[this.replaceColorFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.AnalogEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.ANALOG_PRESETS)this.__filters[BFN.CONST.ANALOG_PRESETS[e]]=new BFN.filters.LutFilter;for(var t in BFN.CONST.BWFX_PRESETS)this.__filters[BFN.CONST.BWFX_PRESETS[t]]=new BFN.filters.LutFilter;for(var i in BFN.CONST.WARMFX_PRESETS)this.__filters[BFN.CONST.WARMFX_PRESETS[i]]=new BFN.filters.LutFilter;this.exposureFilter=new BFN.filters.HSFilter,this.isBlurSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];t.hasOwnProperty("imageURL")&&(this.effectTexture||(this.effectTexture=BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,512,512))),r.iChannel1=this.effectTexture,r.intensity=1,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows)?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,r]):this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupBlur(){this.blurTexture=this.blurFilter.render(.8,this.sourceTexture),this.isBlurSetup=!0}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.isBlurSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}};BFN.effects.ExposureEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.exposureFilter=BFN.ShaderPool.ExposureFilter,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.pluginName="filter_renderer"}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.05,this.sourceTexture),this.exposureFilter.blurImage=this.blurTexture}applyEffect(e,t){this.exposureFilter.brightness=t.brightness,this.exposureFilter.contrast=t.contrast,this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.bfn_shaders=[this.exposureFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurFilter.dispose(),this.blurTexture=null,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.FillLightEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.fillLightFilter=BFN.ShaderPool.FillLightFilter,this.pluginName="filter_renderer",this.blurTexture=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.4,this.sourceTexture),this.fillLightFilter.blurImage=this.blurTexture}applyEffect(e,t){this.fillLightFilter.intensity=t.light_amount,this.bfn_shaders=[this.fillLightFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}};BFN.effects.GaussianBlurEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.gaussianBlurFilter=new BFN.filters.FastBlurWrapper}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){t.blur_amount,BeFunky.log(t.blur_amount);var i=[];i=i.concat(this.gaussianBlurFilter.apply(t.blur_amount)),this.filters=i}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.GrayEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.grayFilter=new BFN.filters.GrayFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.grayFilter.resolution=1,this.grayFilter.amount=t.gray_amount,this.filters=[this.grayFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.InvertEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.invertFilter=new BFN.filters.InvertFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.invertFilter.resolution=e,this.invertFilter.amount=t.invert_amount,this.filters=[this.invertFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.LevelsEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.levelsFilter=new BFN.filters.LevelsFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.levelsFilter.minInputValue=t.min_input,this.levelsFilter.gamma=t.gamma,this.levelsFilter.maxInputValue=t.max_input,this.levelsFilter.minOutputValue=t.min_output,this.levelsFilter.maxOutputValue=t.max_output,this.filters=[this.levelsFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.UnsharpMaskEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilterNormal=new BFN.filters.FastBlurWrapper(null,null,!1),this.blurFilterSmart=new BFN.filters.FastBlurWrapper(null,null,!0),this.unsharpMaskFilter=new BFN.filters.UnsharpMaskFilter,this.sharpenMode=null,this.blurTextureSmart=null,this.blurTextureNormal=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.sharpenMode=null,this.blurTextureSmart=null,this.blurTextureNormal=null}applyEffect(e,t){if(this.sharpenMode!=t.mode)switch(this.sharpenMode=t.mode,this.sharpenMode){case"smart":this.blurTextureSmart||(this.blurTextureSmart=this.blurFilterSmart.render(.3,this.sourceTexture,null,!0)),this.unsharpMaskFilter.intensityMultiplier=1.5,this.unsharpMaskFilter.blurImage=this.blurTextureSmart;break;case"normal":this.blurTextureNormal||(this.blurTextureNormal=this.blurFilterNormal.render(.025,this.sourceTexture,null,!0)),this.unsharpMaskFilter.intensityMultiplier=5,this.unsharpMaskFilter.blurImage=this.blurTextureNormal}this.unsharpMaskFilter.intensity=t.unsharp_amount,this.unsharpMaskFilter.resolution=1,this.filters=[this.unsharpMaskFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.sharpenMode=null,this.blurTextureSmart&&(this.blurTextureSmart=null),this.blurFilterSmart.dispose(),this.blurTextureNormal&&(this.blurTextureNormal=null),this.blurFilterNormal.dispose()}};BFN.effects.VibranceEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.vibranceFilter=BFN.ShaderPool.VibranceFilter,this.pluginName="filter_renderer"}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.vibranceFilter.resolution=1,this.vibranceFilter.amount=t.vibrance_amount,this.bfn_shaders=[this.vibranceFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.VignetteEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.vignetteFilter=new BFN.filters.VignetteFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.vignetteFilter.resolution=1,this.vignetteFilter.amount=t.vignette_amount,this.vignetteFilter.softness=t.vignette_softness,this.filters=[this.vignetteFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.HalftoneEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.uiControls.push({id:"dotsize",name:"Dot Size",type:"slider",min:3,max:50,step:1,default:10}),this.halftoneFilter=new BFN.filters.HalftoneFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.halftoneFilter.circleSize=t.dotsize,this.filters=[this.halftoneFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.BlackWhiteEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.currentPresetID=null,this.bw9Setup=!1,this.bwFilters={},BFN.CONST.BLACK_WHITE_PRESETS)BFN.CONST.BLACK_WHITE_PRESETS[e]==BFN.CONST.BLACK_WHITE_PRESETS.PRESET_9?this.bwFilters[BFN.CONST.BLACK_WHITE_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY):this.bwFilters[BFN.CONST.BLACK_WHITE_PRESETS[e]]=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS[e]);this.exposureFilter=new BFN.filters.HSFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.bwFilters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.bwFilters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);if(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("modeBW")&&t.hasOwnProperty("modeColor")&&(r.mode=t.modeBW,r.color=t.modeColor),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")){if(0!=t.highlights||0!=t.shadows)return this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,void(this.filters=[this.exposureFilter,r])}else this.currentPresetID==BFN.CONST.BLACK_WHITE_PRESETS.PRESET_9&&(this.bw9Setup||(this.setupBw9(),r.iChannel1=this.effectTexture));this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupBw9(){var e=new BFN.filters.ChannelMixerFilter,t=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),i=new PIXI.Sprite;i.texture=this.sourceTexture,e.redAmount=.5,e.greenAmount=.25,e.blueAmount=.25,i.filters=[e],BFN.Stage.render(i,t);var r=new BFN.filters.CurvesFilter([[0,28],[23,48],[68,105],[96,146],[118,180],[145,205],[177,214],[212,225],[255,242]],[[0,29],[21,46],[54,85],[89,137],[107,162],[120,180],[133,189],[197,212],[252,230]],[[0,31],[41,70],[113,168],[148,197],[186,207],[255,229]]),a=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),n=new PIXI.Sprite;n.texture=t,n.filters=[r],BFN.Stage.render(n,a),this.texture=a,this.bw9Setup=!0}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),this.bw9Setup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.ChromaticEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.curvesSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.CHROMATIC_PRESETS)switch(BFN.CONST.CHROMATIC_PRESETS[e]){case BFN.CONST.CHROMATIC_PRESETS.PRESET_1:case BFN.CONST.CHROMATIC_PRESETS.PRESET_2:case BFN.CONST.CHROMATIC_PRESETS.PRESET_4:case BFN.CONST.CHROMATIC_PRESETS.PRESET_5:case BFN.CONST.CHROMATIC_PRESETS.PRESET_6:case BFN.CONST.CHROMATIC_PRESETS.PRESET_9:case BFN.CONST.CHROMATIC_PRESETS.PRESET_10:this.__filters[BFN.CONST.CHROMATIC_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_3:case BFN.CONST.CHROMATIC_PRESETS.PRESET_8:this.__filters[BFN.CONST.CHROMATIC_PRESETS[e]]=new BFN.filters.CurvesFilter;break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_7:this.__filters[BFN.CONST.CHROMATIC_PRESETS[e]]=new BFN.filters.MaskVignetteFilter}}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID){case BFN.CONST.CHROMATIC_PRESETS.PRESET_1:case BFN.CONST.CHROMATIC_PRESETS.PRESET_6:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol1),r.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_2:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol2),r.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_3:r.doFilter(BFN.CONST.PALETTE_MAPS.retroCol3[0],BFN.CONST.PALETTE_MAPS.retroCol3[1],BFN.CONST.PALETTE_MAPS.retroCol3[2]);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_4:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol4),r.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_5:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol5),r.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_7:this.curvesSetup||(r.iChannel1=this.PRESET_7());break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_8:r.doFilter(BFN.CONST.PALETTE_MAPS.retroCol7[0],BFN.CONST.PALETTE_MAPS.retroCol7[1],BFN.CONST.PALETTE_MAPS.retroCol7[2]);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_9:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.MegaContrast1,BFN.CONST.PALETTE_MAPS.MegaContrast2),r.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_10:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol8),r.iChannel1=this.effectTexture)}this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupCurves(e,t){this.curvesSetup=!0;var i=3==e.length?new BFN.filters.CurvesFilter(e[0],e[1],e[2]):2==e.length?new BFN.filters.CurvesFilter(e[0],e[1]):new BFN.filters.CurvesFilter(e);this.curvesTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);var r=new PIXI.Sprite;r.texture=this.sourceTexture,r.filters=[i],BFN.Stage.render(r,this.curvesTexture);try{i.dispose()}catch(e){}if(r=null,i=null,null!=t){var a=3==t.length?new BFN.filters.CurvesFilter(t[0],t[1],t[2]):2==t.length?new BFN.filters.CurvesFilter(t[0],t[1]):new BFN.filters.CurvesFilter(t);this.curvesTexture2=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);var n=new PIXI.Sprite;n.texture=this.curvesTexture,n.filters=[a],BFN.Stage.render(n,this.curvesTexture2);try{a.dispose()}catch(e){}try{n.texture.destroyGC(!0)}catch(e){}return n=null,a=null,void(this.texture=this.curvesTexture2)}this.texture=this.curvesTexture}PRESET_7(){var e=new BFN.filters.CurvesFilter(BFN.CONST.PALETTE_MAPS.retroCol6[0],BFN.CONST.PALETTE_MAPS.retroCol6[1],BFN.CONST.PALETTE_MAPS.retroCol6[2]),t=new PIXI.Sprite;t.texture=this.sourceTexture,t.filters=[e],this.curvesTextureBottomP7=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),BFN.Stage.render(t,this.curvesTextureBottomP7);try{e.dispose()}catch(e){}t=null,e=null,this.texture=this.curvesTextureBottomP7;var i=new BFN.filters.CurvesFilter(BFN.CONST.PALETTE_MAPS.retro6mask[0],BFN.CONST.PALETTE_MAPS.retro6mask[1],BFN.CONST.PALETTE_MAPS.retro6mask[2]),r=new PIXI.Sprite;r.texture=this.sourceTexture,r.filters=[i],this.curvesTextureTopP7=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),BFN.Stage.render(r,this.curvesTextureTopP7);try{i.dispose()}catch(e){}return r=null,i=null,this.curvesSetup=!0,this.curvesTextureTopP7}disposeEffect(){try{this.__filters[this.currentPresetID].dispose()}catch(e){}if(this.sourceTexture=null,this.isSetup=!1,this.curvesSetup=!1,this.currentPresetID=null,null!=this.curvesTextureTopP7&&(this.curvesTextureTopP7.destroyGC(!0),this.curvesTextureTopP7=null),null!=this.curvesTextureBottomP7&&(this.curvesTextureBottomP7.destroyGC(!0),this.curvesTextureBottomP7=null),null!=this.curvesTexture){try{this.curvesTexture.destroyGC(!0)}catch(e){}this.curvesTexture=null}if(null!=this.curvesTexture2){try{this.curvesTexture2.destroyGC(!0)}catch(e){}this.curvesTexture2=null}null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.CharcoalEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.CHARCOAL_PRESETS)this.__filters[BFN.CONST.CHARCOAL_PRESETS[e]]=new BFN.filters.CharcoalFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.blurSetup||this.setupBlur(),r.blurImage=this.blurTexture,r.textureSampler=this.effectTexture,r.color1=t.color_value_1,r.color2=t.color_value_2,r.detail_level=t.detail_level,this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupBlur(){this.blurSetup=!0,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.CyanotypeEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.CYANOTYPE_PRESETS)this.__filters[BFN.CONST.CYANOTYPE_PRESETS[e]]=new BFN.filters.CyanotypeFilter(BFN.CONST.CYANOTYPE_PRESETS[e]);this.exposureFilter=new BFN.filters.HSFilter,this.isBlurSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(this.currentPresetID==BFN.CONST.CYANOTYPE_PRESETS.PRESET_6&&(this.isBlurSetup||this.setupBlur(),r.blurImage=this.blurTexture),r.iChannel1=this.effectTexture,0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,r]):this.filters=[r])}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupBlur(){this.blurTexture=this.blurFilter.render(.8,this.sourceTexture),this.isBlurSetup=!0}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.isBlurSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.OrtonStyleEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurAmount=null,this._filter=new BFN.filters.OrtonStyleFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("blur_amount")&&(this.blurAmount!=t.blur_amount&&(this.blurTexture=this.blurFilter.render(t.blur_amount,this.sourceTexture)),this._filter.blurSampler=this.blurTexture,this.filters=[this._filter])}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),this.blurAmount=null}};BFN.effects.SepiaEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.exposureFilter=new BFN.filters.HSFilter,this._filter=new BFN.filters.SepiaFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){if(this.resolution=e,this.parameters=t,this.texture,this.sourceTexture,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")){if(this._filter.amount=.85,this._filter.color="0xac7933",0!=t.highlights||0!=t.shadows)return this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,void(this.filters=[this.exposureFilter,this._filter]);this.filters=[this._filter]}}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,null!=this.blurTexture&&(this.blurTexture.destroyGC(!0),this.blurTexture=null)}};BFN.effects.ViewFinderEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.VIEWFINDER_PRESETS)switch(BFN.CONST.VIEWFINDER_PRESETS[e]){case BFN.CONST.VIEWFINDER_PRESETS.PRESET_1:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_11:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.HARD_LIGHT);break;case BFN.CONST.VIEWFINDER_PRESETS.PRESET_2:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_3:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_4:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_6:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_8:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_10:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_12:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY);break;case BFN.CONST.VIEWFINDER_PRESETS.PRESET_5:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.LIGHTEN);break;case BFN.CONST.VIEWFINDER_PRESETS.PRESET_7:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY);break;case BFN.CONST.VIEWFINDER_PRESETS.PRESET_9:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.DARKEN)}this.exposureFilter=new BFN.filters.HSFilter,this.isBlurSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(r.iChannel1=this.effectTexture,this.currentPresetID==BFN.CONST.VIEWFINDER_PRESETS.PRESET_1||this.currentPresetID==BFN.CONST.VIEWFINDER_PRESETS.PRESET_2||this.currentPresetID==BFN.CONST.VIEWFINDER_PRESETS.PRESET_8?(this.isBlurSetup||this.setupBlur(),this.texture=this.blurTexture):this.currentPresetID==BFN.CONST.VIEWFINDER_PRESETS.PRESET_5&&(r.intensity=.5),0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,r]):this.filters=[r])}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupBlur(){var e=1;Math.max(this.sourceTexture.width,this.sourceTexture.height)<512&&(e=Math.max(this.sourceTexture.width,this.sourceTexture.height)/1024),this.blurTexture=this.blurFilter.render(.06*e,this.sourceTexture),this.isBlurSetup=!0}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),this.isBlurSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.destroy(),this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader=null)}};BFN.effects.SummerEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.SUMMER_PRESETS)switch(BFN.CONST.SUMMER_PRESETS[e]){case BFN.CONST.SUMMER_PRESETS.PRESET_1:this.__filters[BFN.CONST.SUMMER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY);break;case BFN.CONST.SUMMER_PRESETS.PRESET_2:this.__filters[BFN.CONST.SUMMER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.SCREEN)}this.exposureFilter=new BFN.filters.HSFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(r.iChannel1=this.effectTexture,0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,r]):this.filters=[r])}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.UnitedColorsEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.UNITED_COLORS_PRESETS)this.__filters[BFN.CONST.UNITED_COLORS_PRESETS[e]]=new BFN.filters.UnitedColorsFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];switch(this.blurSetup||this.setupBlur(),this.currentPresetID){case BFN.CONST.UNITED_COLORS_PRESETS.PRESET_1:i.bwmode=0;break;case BFN.CONST.UNITED_COLORS_PRESETS.PRESET_2:case BFN.CONST.UNITED_COLORS_PRESETS.PRESET_4:i.bwmode=3;break;case BFN.CONST.UNITED_COLORS_PRESETS.PRESET_3:i.bwmode=2}i.blurImage=this.blurTexture,i.color1=t.color_value_1,i.color2=t.color_value_2,this.filters=[i]}}setupBlur(){this.blurSetup=!0,this.idealBlur=Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}};BFN.effects.InstantEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.currentPaletteID=null,this.effectTexture=null,this.__filters={},BFN.CONST.INSTANT_PRESETS)switch(BFN.CONST.INSTANT_PRESETS[e]){case BFN.CONST.INSTANT_PRESETS.PRESET_1:case BFN.CONST.INSTANT_PRESETS.PRESET_2:case BFN.CONST.INSTANT_PRESETS.PRESET_3:case BFN.CONST.INSTANT_PRESETS.PRESET_4:case BFN.CONST.INSTANT_PRESETS.PRESET_5:case BFN.CONST.INSTANT_PRESETS.PRESET_6:case BFN.CONST.INSTANT_PRESETS.PRESET_10:case BFN.CONST.INSTANT_PRESETS.PRESET_11:case BFN.CONST.INSTANT_PRESETS.PRESET_13:this.__filters[BFN.CONST.INSTANT_PRESETS[e]]=new BFN.filters.InstantFilter(BFN.CONST.INSTANT_PRESETS[e])}this.exposureFilter=new BFN.filters.HSFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){if(this.currentPresetID=t.presetID,t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null);var r=this.__filters[this.currentPresetID],a=!1;switch(t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows)&&(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,a=!0),this.currentPresetID){case BFN.CONST.INSTANT_PRESETS.PRESET_1:case BFN.CONST.INSTANT_PRESETS.PRESET_2:case BFN.CONST.INSTANT_PRESETS.PRESET_3:case BFN.CONST.INSTANT_PRESETS.PRESET_4:break;case BFN.CONST.INSTANT_PRESETS.PRESET_5:case BFN.CONST.INSTANT_PRESETS.PRESET_6:case BFN.CONST.INSTANT_PRESETS.PRESET_10:case BFN.CONST.INSTANT_PRESETS.PRESET_11:case BFN.CONST.INSTANT_PRESETS.PRESET_13:r.iChannel1=this.effectTexture}this.filters=1==a?[this.exposureFilter,r]:[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.currentPaletteID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.CoolingEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filter=new BFN.filters.TintFilter,this.exposureFilter=new BFN.filters.HSFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.__filter.color=t.color,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows)?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,this.__filter]):this.filters=[this.__filter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.WarmingEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filter=new BFN.filters.TintFilter,this.exposureFilter=new BFN.filters.HSFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.__filter.color=t.color,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows)?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,this.__filter]):this.filters=[this.__filter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.TinyTypeEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filter=new BFN.filters.TinyTypeFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){this.resolution=e,this.parameters=t,t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading?this.filters=[]:(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.__filter.iChannel1=this.effectTexture,t.hasOwnProperty("modeBW")&&t.hasOwnProperty("modeColor")&&(this.__filter.mode=t.modeBW,this.__filter.color=t.modeColor),this.filters=[this.__filter])}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.CrossProcessEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.curvesTexture=null,this.isSetupCurves=!1,this.exposureFilter=new BFN.filters.HSFilter,this._filter=new BFN.filters.CrossProcessFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.resolution=e,this.parameters=t,this.texture,this.sourceTexture,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(this.isSetupCurves||this.setupCurves(BFN.CONST.PALETTE_MAPS[t.curves],t),this._filter.intensity=.2,this._filter.contrast=t.contrast,this._filter.color=t.color,this._filter.curvesSampler=this.curvesTexture,0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,this._filter]):this.filters=[this._filter])}setupCurves(e,t){var i=3==e.length?BFN.FilterHelper.GetCurvesTexture(e[0],e[1],e[2]):2==e.length?BFN.FilterHelper.GetCurvesTexture(e[0],e[1]):BFN.FilterHelper.GetCurvesTexture(e);this.curvesTexture||(this.curvesTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height));var r=new PIXI.Sprite;r.texture=i,BFN.Stage.render(r,this.curvesTexture),i.destroyGC(!0),i=null;try{r.texture.destroyGC(!0)}catch(e){}r=null,this.isSetupCurves=!0}cleanValue(e,t){return Math.min(t,Math.max(-t,e))}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.isSetupCurves=!1,null!=this.curvesTexture&&(this.curvesTexture.destroyGC(!0),this.curvesTexture=null)}};BFN.effects.VintageColorsEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.exposureFilter=new BFN.filters.HSFilter,this.blurFilter=new BFN.filters.SurfaceBlurFilter,this.adaptiveSharpness=new BFN.filters.AdaptiveSharpnessFilter,this.blurTexture=null,this.blurTextureHolder=new PIXI.Sprite,this.blurSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filters={},BFN.CONST.VINTAGE_COLORS_PRESETS)switch(BFN.CONST.VINTAGE_COLORS_PRESETS[e]){case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_7:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_8:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_9:this.__filters[BFN.CONST.VINTAGE_COLORS_PRESETS[e]]=new BFN.filters.LutFilter;break;default:this.__filters[BFN.CONST.VINTAGE_COLORS_PRESETS[e]]=new BFN.filters.VintageColorsFilter(BFN.CONST.VINTAGE_COLORS_PRESETS[e])}}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(1==i||t.imageURL.includes("lut_")?t.imageURL.includes("lut_")?this.effectTexture=BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,512,512):this.effectTexture=BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTexture=this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null);var a=!0;switch(this.currentPresetID){case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_1:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_2:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_3:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_4:r.color1=t.color1,r.color2=t.color2;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_5:for(var n=0;n<4;n++)r["color".concat(n+1,"_1")]=t.color1[n],r["color".concat(n+1,"_2")]=t.color2[n];break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_7:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_8:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_9:a=!1,r.intensity=1,r.iChannel1=this.effectTexture}if(a&&(this.blurSetup||this.setupBlur(),r.blurImage=this.blurTexture),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows))return this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,void(this.filters=[this.exposureFilter,r]);this.filters=[r]}}setupBlur(){this.blurSetup=!0;var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);this.blurTextureHolder.texture=this.sourceTexture,this.idealBlur=Math.round(Math.max(this.sourceTexture.width,this.sourceTexture.height))/1024*1,this.blurFilter.resolution=.5,this.blurFilter.blur=this.idealBlur,this.blurFilter.threshold=.3,this.blurTextureHolder.filters=[this.blurFilter],BFN.Stage.render(this.blurTextureHolder,e),this.blurTextureHolder.filters=[],this.blurTextureHolder=null,this.blurTextureHolder=new PIXI.Sprite,this.blurTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.blurTextureHolder.texture=this.sourceTexture,this.adaptiveSharpness.blurImage=e,this.blurTextureHolder.filters=[this.adaptiveSharpness],BFN.Stage.render(this.blurTextureHolder,this.blurTexture),e.destroyGC(!0),e=null,this.blurTextureHolder.filters=[]}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture.destroyGC(!0),this.blurTexture=null),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.HolgaArtEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filters={},BFN.CONST.HOLGA_ART_PRESETS)this.__filters[BFN.CONST.HOLGA_ART_PRESETS[e]]=new BFN.filters.HolgaArtFilter(BFN.CONST.HOLGA_ART_PRESETS[e])}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID){case BFN.CONST.HOLGA_ART_PRESETS.PRESET_1:case BFN.CONST.HOLGA_ART_PRESETS.PRESET_5:r.slide_right=t.slide_right,r.slide_left=t.slide_left;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_2:case BFN.CONST.HOLGA_ART_PRESETS.PRESET_3:r.slide_vertical=t.slide_vertical,r.slide_horizontal=t.slide_horizontal;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_4:r.slide_right=t.slide_right,r.slide_left=t.slide_left,r.vignette_amount=t.vignette_amount}null!=this.effectTexture&&(r.iChannel1=this.effectTexture),this.filters=[r]}else this.filters=[]}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.LineArtopiaEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filters={},BFN.CONST.LINE_ARTOPIA_PRESETS)this.__filters[BFN.CONST.LINE_ARTOPIA_PRESETS[e]]=new BFN.filters.LineArtopiaFilter(BFN.CONST.LINE_ARTOPIA_PRESETS[e])}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),r.line_width=Math.max(Math.floor(t.line_width*Math.max(this.sourceTexture.width,this.sourceTexture.height)/1024),3),r.sketch_detail=t.sketch_detail,r.color=t.color,this.currentPresetID){case BFN.CONST.HOLGA_ART_PRESETS.PRESET_1:case BFN.CONST.HOLGA_ART_PRESETS.PRESET_2:r.line_angle=t.line_angle}null!=this.effectTexture&&(r.iChannel1=this.effectTexture),this.filters=[r]}else this.filters=[]}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.HDREffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.adaptiveSharpness=new BFN.filters.AdaptiveSharpnessFilter,this.blurTexture=null,this.blurSetup=!1,this.adaptiveTexture=null,this.adaptiveTextureHolder=new PIXI.Sprite,this.adaptiveSetup=!1,this.bwFilter=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.bwTexture=null,this.bwTextureHolder=new PIXI.Sprite,this.bwSetup=!1,this.belndFilter=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY)}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("useFragment"))return this.bwSetup||this.setupBw(),this.blurSetup||this.setupBlur(this.bwTexture),this.adaptiveSetup||this.setupAdaptive(this.bwTexture),this.belndFilter.iChannel1=this.adaptiveTexture,this.belndFilter.intensity=.7,this.belndFilter.alphadir=1,void(this.filters=[this.belndFilter]);this.blurSetup||this.setupBlur(),this.adaptiveSharpness.blurImage=this.blurTexture,this.filters=[this.adaptiveSharpness]}setupBlur(e){this.blurSetup=!0,this.blurTexture=this.blurFilter.render(.8,e||this.sourceTexture)}setupAdaptive(e){this.adaptiveSetup=!0,this.adaptiveTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.adaptiveTextureHolder.texture=e||this.sourceTexture,this.adaptiveSharpness.blurImage=this.blurTexture,this.adaptiveTextureHolder.filters=[this.adaptiveSharpness],BFN.Stage.render(this.adaptiveTextureHolder,this.adaptiveTexture),this.adaptiveTextureHolder.filters=[],this.adaptiveTextureHolder=null,this.adaptiveTextureHolder=new PIXI.Sprite}setupBw(){this.bwSetup=!0,this.bwTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.bwTextureHolder.texture=this.sourceTexture,this.bwTextureHolder.filters=[this.bwFilter],BFN.Stage.render(this.bwTextureHolder,this.bwTexture),this.bwTextureHolder.filters=[],this.bwTextureHolder=null,this.bwTextureHolder=new PIXI.Sprite}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.adaptiveSetup=!1,this.bwSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.adaptiveTexture&&(this.adaptiveTexture.destroyGC(!0),this.adaptiveTexture=null),null!=this.bwTexture&&(this.bwTexture.destroyGC(!0),this.bwTexture=null)}};BFN.effects.PinholeEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.vignetteFilter=new BFN.filters.VignetteFilter,this.bwFilterM1=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_1),this.bwFilterM4=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.overlayBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY),this.hardlightBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.HARD_LIGHT),this.screenBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.SCREEN),this.multiplyBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY),this.multiplyBlend2=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY),this.motionBlurFilter=new BFN.filters.MotionBlurFilter,this.shiftChannel=new BFN.filters.ShiftChannelFilter,this.sigmoidFilter=new BFN.filters.SigmoidFilter,this.blurFilter=new BFN.filters.FastBlurWrapper,this.fisheyeFilter=new BFN.filters.FisheyeFilter,this.noiseFilter=new BFN.filters.NoiseFilter,this.isBWSetup=!1,this.isSigmoidSetup=!1,this.overlayBlendSetup=!1,this.hardlightBlendSetup=!1,this.screenBlendSetup=!1,this.multiplyBlendSetup=!1,this.multiplyBlendSetup2=!1,this.isNoiseSetup=!1,this.textureHolder=new PIXI.Sprite,this.textureMap={bwTexture:null,overlayBlendTexture:null,hardlightBlendTexture:null,screenBlendTexture:null,multiplyBlendTexture:null,multiplyBlendTexture2:null,vignetteTexture:null,motionBlurTexture:null,sigmoidTexture:null,fisheyeTexture:null,noiseTexture:null},this.__filters={},BFN.CONST.PINHOLE_PRESETS)BFN.CONST.PINHOLE_PRESETS[e]!=BFN.CONST.PINHOLE_PRESETS.PRESET_2&&BFN.CONST.PINHOLE_PRESETS[e]!=BFN.CONST.PINHOLE_PRESETS.PRESET_5||(this.__filters[BFN.CONST.PINHOLE_PRESETS[e]]=new BFN.filters.PinholeFilter(BFN.CONST.PINHOLE_PRESETS[e]))}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){var r=1;if(i&&(r=.1),this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")){if(this.currentPresetID=t.presetID,t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);var a,n;switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID){case BFN.CONST.PINHOLE_PRESETS.PRESET_1:this.isBWSetup||(this.isBWSetup=!0,this.renderCustomFilter(null,"bwTexture",this.bwFilterM1)),this.overlayBlendSetup||(this.overlayBlendSetup=!0,this.overlayBlend.iChannel1=this.textureMap.bwTexture,this.renderCustomFilter(this.textureMap.bwTexture,"overlayBlendTexture",this.overlayBlend)),a=!1,this.vignette_amount!=t.vignette_amount&&(this.vignetteFilter.amount=t.vignette_amount,this.renderCustomFilter(this.textureMap.overlayBlendTexture,"vignetteTexture",this.vignetteFilter),this.vignette_amount=t.vignette_amount,a=!0),1!=a&&this.motion_angle==t.motion_angle&&this.motion_amount==t.motion_amount||(this.motion_angle=this.motionBlurFilter.angleDegree=t.motion_angle,this.motion_amount=t.motion_amount,this.motionBlurFilter.strength=this.motion_amount*Math.min(Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,100),this.renderCustomFilter(this.textureMap.vignetteTexture,"motionBlurTexture",this.motionBlurFilter)),this.texture=this.textureMap.vignetteTexture,this.hardlightBlend.iChannel1=this.textureMap.motionBlurTexture,this.filters=[this.hardlightBlend];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_2:this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",this.sigmoidFilter)),this.hardlightBlendSetup||(this.hardlightBlendSetup=!0,this.hardlightBlend.iChannel1=this.textureMap.sigmoidTexture,this.shiftChannel.mode=5,this.renderCustomFilter(this.effectTexture,"hardlightBlendTexture",[this.hardlightBlend,this.shiftChannel].concat(this.blurFilter.apply(.05*r)))),this.texture=this.textureMap.hardlightBlendTexture,(n=this.__filters[this.currentPresetID]).vignette_amount=t.vignette_amount,n.fisheye_amount=t.fisheye_amount,this.filters=[n];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_3:this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",this.sigmoidFilter)),this.screenBlendSetup||(this.screenBlendSetup=!0,this.screenBlend.iChannel1=this.textureMap.sigmoidTexture,this.renderCustomFilter(null,"screenBlendTexture",this.screenBlend)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.screenBlendTexture,this.shiftChannel.mode=4,this.renderCustomFilter(this.effectTexture,"multiplyBlendTexture",[this.multiplyBlend,this.shiftChannel].concat(this.blurFilter.apply(.1*r)))),this.texture=this.textureMap.multiplyBlendTexture,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_4:this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",[this.sigmoidFilter].concat(this.blurFilter.apply(.1*r)))),this.screenBlendSetup||(this.screenBlendSetup=!0,this.screenBlend.iChannel1=this.textureMap.sigmoidTexture,this.renderCustomFilter(null,"screenBlendTexture",this.screenBlend)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.screenBlendTexture,this.renderCustomFilter(this.effectTexture,"multiplyBlendTexture",this.multiplyBlend)),a=!1,this.vignette_amount!=t.vignette_amount&&(this.vignetteFilter.amount=t.vignette_amount,this.renderCustomFilter(this.textureMap.multiplyBlendTexture,"vignetteTexture",this.vignetteFilter),this.vignette_amount=t.vignette_amount,this.multiplyBlendSetup2=!1,a=!0),1!=a&&this.motion_angle==t.motion_angle&&this.motion_amount==t.motion_amount||(this.motion_angle=this.motionBlurFilter.angleDegree=t.motion_angle,this.motion_amount=t.motion_amount,this.motionBlurFilter.strength=this.motion_amount*Math.min(Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,100),this.renderCustomFilter(this.textureMap.vignetteTexture,"motionBlurTexture",this.motionBlurFilter),this.multiplyBlendSetup2=!1),this.multiplyBlendSetup2||(this.multiplyBlendSetup2=!0,this.multiplyBlend2.iChannel1=this.textureMap.vignetteTexture,this.renderCustomFilter(this.textureMap.motionBlurTexture,"multiplyBlendTexture2",this.multiplyBlend2),this.overlayBlendSetup=!1),this.isNoiseSetup||(this.isNoiseSetup=!0,this.noiseFilter.duocolor1="0xffffff",this.noiseFilter.duocolor2="0xb8b8b8",this.renderCustomFilter(null,"noiseTexture",this.noiseFilter)),this.overlayBlendSetup||(this.overlayBlendSetup=!0,this.overlayBlend.iChannel1=this.textureMap.noiseTexture,this.renderCustomFilter(this.textureMap.multiplyBlendTexture2,"overlayBlendTexture",this.overlayBlend)),this.texture=this.textureMap.overlayBlendTexture,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_5:this.isBWSetup||(this.isBWSetup=!0,this.renderCustomFilter(null,"bwTexture",this.bwFilterM4)),this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",this.sigmoidFilter)),this.screenBlendSetup||(this.screenBlendSetup=!0,this.screenBlend.iChannel1=this.textureMap.sigmoidTexture,this.renderCustomFilter(this.textureMap.bwTexture,"screenBlendTexture",this.screenBlend)),this.texture=this.textureMap.screenBlendTexture,(n=this.__filters[this.currentPresetID]).iChanel1=this.effectTexture,n.vignette_amount=t.vignette_amount,n.fisheye_amount=t.fisheye_amount,this.filters=[n]}}else this.filters=[]}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}renderCustomFilter(e,t,i){null==this.textureMap[t]&&(this.textureMap[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=i.constructor===Array?i:[i],BFN.Stage.render(this.textureHolder,this.textureMap[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.isBWSetup=!1,this.overlayBlendSetup=!1,this.isSigmoidSetup=!1,this.hardlightBlendSetup=!1,this.screenBlendSetup=!1,this.multiplyBlendSetup=!1,this.multiplyBlendSetup2=!1,this.isNoiseSetup=!1;var e=this.textureMap;Object.keys(e).forEach(t=>{e.hasOwnProperty(t)&&null!=e[t]&&(e[t].destroyGC(!0),e[t]=null)}),this.blurFilter.dispose(),this.disposeTexture("effectTexture"),this.vignette_amount=null,this.motion_angle=null,this.motion_amount=null,this.fisheye_amount=null}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}};BFN.effects.ColorPinholeEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.colorMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.brightnessContrastFilter=new PIXI.filters.ColorMatrixFilter,this.brightnessContrastFilter.matrix=this.colorMatrix,this.vignetteFilter=new BFN.filters.VignetteFilter,this.bwFilterM1=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_1),this.bwFilterM4=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.overlayBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY),this.hardlightBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.HARD_LIGHT),this.screenBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.SCREEN),this.multiplyBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY),this.multiplyBlend2=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY),this.motionBlurFilter=new BFN.filters.MotionBlurFilter,this.shiftChannel=new BFN.filters.ShiftChannelFilter,this.sigmoidFilter=new BFN.filters.SigmoidFilter,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.fisheyeFilter=new BFN.filters.FisheyeFilter,this.noiseFilter=new BFN.filters.NoiseFilter,this.isBWSetup=!1,this.isBlurSetup=!1,this.isSigmoidSetup=!1,this.overlayBlendSetup=!1,this.hardlightBlendSetup=!1,this.screenBlendSetup=!1,this.multiplyBlendSetup=!1,this.multiplyBlendSetup2=!1,this.isNoiseSetup=!1,this.isFisheyeSetup=!1,this.isColoredTextureSetup=!1,this.isSCTextureSetup=!1,this.textureHolder=new PIXI.Sprite,this.textureMap={bwTexture:null,blurTexture:null,overlayBlendTexture:null,hardlightBlendTexture:null,screenBlendTexture:null,multiplyBlendTexture:null,multiplyBlendTexture2:null,vignetteTexture:null,motionBlurTexture:null,sigmoidTexture:null,fisheyeTexture:null,noiseTexture:null,coloredTexture:null,scTexture:null}}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){var r=1;if(i&&(r=.1),this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")){if(this.currentPresetID=t.presetID,t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID){case BFN.CONST.PINHOLE_PRESETS.PRESET_1:this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",this.sigmoidFilter)),this.screenBlendSetup||(this.screenBlendSetup=!0,this.screenBlend.iChannel1=this.textureMap.sigmoidTexture,this.renderCustomFilter(null,"screenBlendTexture",this.screenBlend)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.screenBlendTexture,this.shiftChannel.mode=2,this.renderCustomFilter(this.effectTexture,"multiplyBlendTexture",[this.multiplyBlend,this.shiftChannel].concat(this.blurFilter.apply(.1*r)))),this.texture=this.textureMap.multiplyBlendTexture,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_2:this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.shiftChannel.mode=3,this.renderCustomFilter(null,"coloredTexture",[this.shiftChannel]),this.multiplyBlend.iChannel1=this.textureMap.coloredTexture,this.renderCustomFilter(this.effectTexture,"multiplyBlendTexture",[this.multiplyBlend].concat(this.blurFilter.apply(.1*r)))),this.texture=this.textureMap.multiplyBlendTexture,this.vignetteFilter.amount=t.vignette_amount,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter,this.vignetteFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_3:this.isSCTextureSetup||(this.isSCTextureSetup=!0,this.shiftChannel.mode=3,this.renderCustomFilter(null,"scTexture",this.shiftChannel)),this.hardlightBlendSetup||(this.hardlightBlendSetup=!0,this.hardlightBlend.iChannel1=this.textureMap.scTexture,this.brightnessContrastFilter.brightness(1,!1),this.brightnessContrastFilter.contrast(.4,!0),this.renderCustomFilter(null,"hardlightBlendTexture",[this.hardlightBlend,this.brightnessContrastFilter])),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.effectTexture,this.renderCustomFilter(this.textureMap.hardlightBlendTexture,"multiplyBlendTexture",this.multiplyBlend)),this.texture=this.textureMap.multiplyBlendTexture,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_4:this.isFisheyeSetup&&this.fisheye_amount==t.fisheye_amount||(this.isFisheyeSetup=!0,this.fisheye_amount=t.fisheye_amount,this.fisheyeFilter.radius=t.fisheye_amount,this.renderCustomFilter(null,"fisheyeTexture",[this.fisheyeFilter].concat(this.blurFilter.apply(.1*r))),this.multiplyBlendSetup=!1,this.hardlightBlendSetup=!1),this.isColoredTextureSetup||this.createColoredTexture(16777215),this.vignette_amount!=t.vignette_amount&&(this.vignette_amount=t.vignette_amount,this.vignetteFilter.amount=t.vignette_amount,this.renderCustomFilter(this.textureMap.coloredTexture,"vignetteTexture",this.vignetteFilter),this.multiplyBlendSetup=!1,this.hardlightBlendSetup=!1),this.hardlightBlendSetup||(this.hardlightBlendSetup=!0,this.hardlightBlend.iChannel1=this.textureMap.fisheyeTexture,this.renderCustomFilter(this.textureMap.vignetteTexture,"hardlightBlendTexture",[this.hardlightBlend]),this.isBWSetup=!1,this.multiplyBlendSetup=!1,this.isBlurSetup=!1),this.isBWSetup||(this.isBWSetup=!0,this.renderCustomFilter(this.textureMap.hardlightBlendTexture,"bwTexture",this.bwFilterM4)),this.isBlurSetup||(this.isBlurSetup=!0,this.textureMap.blurTexture=this.blurFilter.render(.04,this.textureMap.hardlightBlendTexture)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.blurTexture,this.renderCustomFilter(this.textureMap.bwTexture,"multiplyBlendTexture",this.multiplyBlend)),this.texture=this.effectTexture,this.overlayBlend.iChannel1=this.textureMap.multiplyBlendTexture,this.filters=[this.overlayBlend];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_5:this.hardlightBlendSetup||(this.hardlightBlendSetup=!0,this.hardlightBlend.iChannel1=this.sourceTexture,this.renderCustomFilter(null,"hardlightBlendTexture",[this.hardlightBlend])),this.isBWSetup||(this.isBWSetup=!0,this.renderCustomFilter(this.textureMap.hardlightBlendTexture,"bwTexture",this.bwFilterM4)),this.isBlurSetup||(this.isBlurSetup=!0,this.textureMap.blurTexture=this.blurFilter.render(.04,this.textureMap.hardlightBlendTexture)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.blurTexture,this.renderCustomFilter(this.textureMap.bwTexture,"multiplyBlendTexture",this.multiplyBlend)),this.texture=this.textureMap.multiplyBlendTexture,this.vignetteFilter.amount=t.vignette_amount,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter,this.vignetteFilter]}}else this.filters=[]}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}renderCustomFilter(e,t,i){null==this.textureMap[t]&&(this.textureMap[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=i.constructor===Array?i:[i],BFN.Stage.render(this.textureHolder,this.textureMap[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}createColoredTexture(e,t){this.isColoredTextureSetup=!0;var i=new PIXI.Graphics;i.beginFill(e),i.drawRect(0,0,this.sourceTexture.width,this.sourceTexture.height),i.endFill(),null!=t&&(i.filters=t.constructor===Array?t:[t]),this.textureMap.coloredTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),BFN.Stage.render(i,this.textureMap.coloredTexture),i.filters=[],i.clear(),i=null}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.isBWSetup=!1,this.isBlurSetup=!1,this.overlayBlendSetup=!1,this.isSigmoidSetup=!1,this.hardlightBlendSetup=!1,this.screenBlendSetup=!1,this.multiplyBlendSetup=!1,this.multiplyBlendSetup2=!1,this.isNoiseSetup=!1,this.isFisheyeSetup=!1,this.isColoredTextureSetup=!1,this.isSCTextureSetup=!1,this.disposeTexture("effectTexture");var e=this.textureMap;Object.keys(e).forEach(t=>{e.hasOwnProperty(t)&&null!=e[t]&&("blurTexture"!=t&&e[t].destroyGC(!0),e[t]=null)}),this.blurFilter.dispose(),this.vignette_amount=null,this.motion_angle=null,this.motion_amount=null,this.fisheye_amount=null}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}};BFN.effects.StencilerEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.STENCILER_PRESETS)this.__filters[BFN.CONST.STENCILER_PRESETS[e]]=new BFN.filters.StencilerFilter(BFN.CONST.STENCILER_PRESETS[e])}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),!this.blurSetup&&t.hasOwnProperty("useBlur")&&(this.setupBlur(),r.blurSampler=this.blurTexture),r.textureSampler=this.effectTexture,t.hasOwnProperty("color")&&(r.color=t.color),t.hasOwnProperty("detail_level")&&(r.detail_level=t.detail_level),t.hasOwnProperty("color_detail")&&(r.color_detail=t.color_detail),t.hasOwnProperty("smooth_amount")&&(r.smooth_amount=t.smooth_amount),this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupBlur(){this.blurSetup=!0,this.idealBlur=Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.GrungeEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.GRUNGE_PRESETS)this.__filters[BFN.CONST.GRUNGE_PRESETS[e]]=new BFN.filters.GrungeFilter(BFN.CONST.GRUNGE_PRESETS[e])}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("useBlur")&&(this.blurSetup||this.setupBlur(),r.blurImage=this.blurTexture),r.iChannel1=this.effectTexture,t.hasOwnProperty("silhouette_amount")&&(r.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("detail_level")&&(r.detail_level=t.detail_level),t.hasOwnProperty("shadow_amount")&&(r.shadow_amount=t.shadow_amount),this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupBlur(){this.blurSetup=!0,this.blurTexture=this.blurFilter.render(.85,this.sourceTexture)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.SunburstEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.SUNBURST_PRESETS)this.__filters[BFN.CONST.SUNBURST_PRESETS[e]]=new BFN.filters.SunburstFilter(BFN.CONST.SUNBURST_PRESETS[e])}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("useBlur")&&(this.blurSetup||this.setupBlur(),r.blurSampler=this.blurTexture),r.textureSampler=this.effectTexture,t.hasOwnProperty("color")&&(r.color=t.color),t.hasOwnProperty("halftone_size")&&(r.halftone_size=Math.max(Math.floor(t.halftone_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/512),3)),t.hasOwnProperty("silhouette_amount")&&(r.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("sunburst_amount")&&(r.sunburst_amount=t.sunburst_amount),t.hasOwnProperty("grain_amount")&&(r.grain_amount=t.grain_amount),this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupBlur(){this.blurSetup=!0,this.idealBlur=Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.OldPhotoEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper,this.exposureFilter=new BFN.filters.HSFilter,this.duotoneFilter=new BFN.filters.DuoToneFilter,this.brightnessContrastFilter=new PIXI.filters.ColorMatrixFilter,this.brightnessContrastFilter.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.__filters={},BFN.CONST.OLD_PHOTO_PRESETS)BFN.CONST.OLD_PHOTO_PRESETS[e]==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19||BFN.CONST.OLD_PHOTO_PRESETS[e]==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_20?this.__filters[BFN.CONST.OLD_PHOTO_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY):this.__filters[BFN.CONST.OLD_PHOTO_PRESETS[e]]=new BFN.filters.OldPhotoFilter(BFN.CONST.OLD_PHOTO_PRESETS[e]);this.blurTexture=null,this.curvesTexture=null,this.isBlurSetup=!1,this.isCurvesSetup=!1,this.blurAmount=null,this.highlights=0,this.shadows=0}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){var r=1;if(i&&(r=.1),this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")){this.currentPresetID=t.presetID;var a=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);if(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19||this.currentPresetID==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_20){a.iChannel1=this.effectTexture;var n=!1;if(t.hasOwnProperty("highlights")&&(0==t.highlights&&0==t.shadows||t.highlights==this.highlights&&t.shadows==this.shadows||(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,n=!0,this.isCurvesSetup=!1),this.highlights=t.highlights,this.shadows=t.shadows),!this.isCurvesSetup){this.disposeTexture("curvesTexture"),this.isCurvesSetup=!0,this.duotoneFilter.color1="0xFFFFFF",this.duotoneFilter.color2=this.currentPresetID==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19?"0x281c02":"0x0b0802";var o=n?this.renderCustomFilter(null,[this.exposureFilter,this.duotoneFilter]):this.renderCustomFilter(null,[this.duotoneFilter]);this.curvesTexture=this.renderCurves(o,BFN.CONST.PALETTE_MAPS.darkerMap,this.currentPresetID==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19?BFN.CONST.PALETTE_MAPS.contrast:BFN.CONST.PALETTE_MAPS.contrastHigh)}return a.intensity=.65,this.texture=this.curvesTexture,void(this.filters=[a])}var s=null;t.hasOwnProperty("focal_blur")?s=t.focal_blur:t.hasOwnProperty("blur_amount")&&(s=t.blur_amount),s!=this.blurAmount&&(this.blurAmount=s,1==this.isBlurSetup&&(this.isBlurSetup=!1)),t.hasOwnProperty("useBlur")?(this.isBlurSetup||(this.isBlurSetup=!0,this.blurTexture=this.blurFilter.render(null!=this.blurAmount?this.blurAmount*r:.1*r,this.sourceTexture)),a.blurSampler=this.blurTexture):t.hasOwnProperty("focal_blur")?a.focal_blur=t.focal_blur:t.hasOwnProperty("blur_amount")&&(a.blur_amount=t.blur_amount),null!=this.effectTexture&&(a.textureSampler=this.effectTexture);var l=[];t.hasOwnProperty("grain_amount")&&(a.grain_amount=t.grain_amount),t.hasOwnProperty("silhouette_amount")&&(a.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("color_amount")&&(a.color_amount=t.color_amount),0==t.highlights&&0==t.shadows||(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,l[l.length]=this.exposureFilter),t.hasOwnProperty("brightness")&&(this.brightnessContrastFilter.brightness(t.brightness,!1),l[l.length]=this.brightnessContrastFilter),t.hasOwnProperty("contrast")&&(a.contrast=t.contrast),l[l.length]=a,this.filters=l}else this.filters=[]}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}renderCustomFilter(e,t){var i=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),r=new PIXI.Sprite(e||this.sourceTexture);return r.filters=t.constructor===Array?t:[t],BFN.Stage.render(r,i),r.filters=[],r=null,i}renderCurves(e,t,i){var r=3==t.length?new BFN.filters.CurvesFilter(t[0],t[1],t[2]):2==t.length?new BFN.filters.CurvesFilter(t[0],t[1]):new BFN.filters.CurvesFilter(t),a=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),n=new PIXI.Sprite;if(n.texture=e,n.filters=[r],BFN.Stage.render(n,a),null!=i){var o=3==i.length?new BFN.filters.CurvesFilter(i[0],i[1],i[2]):2==i.length?new BFN.filters.CurvesFilter(i[0],i[1]):new BFN.filters.CurvesFilter(i),s=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),l=new PIXI.Sprite;return l.texture=a,l.filters=[o],BFN.Stage.render(l,s),a.destroyGC(!0),a=null,s}return a}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.isBlurSetup=!1,this.isCurvesSetup=!1,this.disposeTexture("effectTexture"),this.disposeTexture("curvesTexture"),this.blurFilter.dispose(),this.blurTexture=null,this.blurAmount=null,this.highlights=0,this.shadows=0}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}};BFN.effects.WinterEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.isTileSetup=!1,this.__filters={},BFN.CONST.WINTER_PRESETS)this.__filters[BFN.CONST.WINTER_PRESETS[e]]=new BFN.filters.WinterFilter(BFN.CONST.WINTER_PRESETS[e])}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];t.hasOwnProperty("imageURL")&&(this.effectTexture||(this.effectTexture=BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,512,512))),this.isTileSetup||this.setupTile(),i.textureSampler=this.effectTexture,t.hasOwnProperty("frost_amount")&&(i.frost_amount=t.frost_amount),t.hasOwnProperty("opacity")&&(i.amount=t.opacity),this.filters=[i]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}setupTile(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),t=new PIXI.extras.TilingSprite(this.effectTexture,this.sourceTexture.width,this.sourceTexture.height);BFN.Stage.render(t,e),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),this.effectTexture=e,this.isTileSetup=!0}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),this.isTileSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}};BFN.effects.TiltShiftEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.__filters={},BFN.CONST.TILT_SHIFT_PRESETS)this.__filters[BFN.CONST.TILT_SHIFT_PRESETS[e]]=new BFN.filters.TiltShiftFilter(BFN.CONST.TILT_SHIFT_PRESETS[e]);this.blurFilter=new BFN.filters.FastBlurWrapper,this.blurTexture=null,this.blurAmount=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];t.blur_amount!=this.blurAmount&&(this.blurAmount=t.blur_amount,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),i.blurSampler=this.blurTexture,t.hasOwnProperty("size")&&(i.size=t.size),t.hasOwnProperty("angle")&&(i.angle=t.angle),t.hasOwnProperty("slide_vertical")&&(i.slide_vertical=t.slide_vertical),t.hasOwnProperty("slide_horizontal")&&(i.slide_horizontal=t.slide_horizontal),this.filters=[i]}}renderCustomFilter(e,t){var i=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),r=new PIXI.Sprite(e||this.sourceTexture);return r.filters=t.constructor===Array?t:[t],BFN.Stage.render(r,i),r.filters=[],r=null,i}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.blurFilter.dispose(),this.blurTexture=null,this.blurAmount=null}};BFN.effects.PatrioticEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.tiledDownloadedTexture=null,this.tiledTexture=null,this.__filters={},BFN.CONST.PATRIOTIC_PRESETS)this.__filters[BFN.CONST.PATRIOTIC_PRESETS[e]]=new BFN.filters.PatrioticFilter(BFN.CONST.PATRIOTIC_PRESETS[e]);this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.sBlurFilter=new BFN.filters.SurfaceBlurFilter,this.adaptiveSharpness=new BFN.filters.AdaptiveSharpnessFilter,this.blurTexture=null,this.blurAmount=null,this.isAdaptiveSetup=!1,this.isTileSetup=!1}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("tileURL")&&(this.tiledDownloadedTexture||(this.tiledDownloadedTexture=BFN.XMLGraphicLoader.getGraphicByName(t.tileURL,256,256))),t.hasOwnProperty("smoothness")&&(t.smoothness!=this.blurAmount&&(this.blurAmount=t.smoothness,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),r.blurImage=this.blurTexture),this.currentPresetID==BFN.CONST.PATRIOTIC_PRESETS.PRESET_4||this.currentPresetID==BFN.CONST.PATRIOTIC_PRESETS.PRESET_5?(this.isAdaptiveSetup||this.setupAdaptiveSharpnes(),r.adaptiveSharpenSampler=this.blurTexture):this.currentPresetID==BFN.CONST.PATRIOTIC_PRESETS.PRESET_6&&(this.isTileSetup||this.setupTile(),r.starSampler=this.tiledTexture),null!=this.effectTexture&&(r.textureSampler=this.effectTexture),t.hasOwnProperty("silhouette_amount")&&(r.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("color_space")&&(r.color_space=t.color_space),t.hasOwnProperty("halftone_size")&&(r.halftone_size=Math.max(Math.floor(t.halftone_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/512),3)),t.hasOwnProperty("star_size")&&(r.star_size=t.star_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/2e3),t.hasOwnProperty("red")&&(r.red=t.red),t.hasOwnProperty("navy")&&(r.navy=t.navy),t.hasOwnProperty("line_color")&&(r.line_width=this.sourceTexture.width/3,r.line_angle=this.sourceTexture.width>this.sourceTexture.height?90:0,r.background_color=t.background_color,r.line_color=t.line_color),this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}renderCustomFilter(e,t){var i=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),r=new PIXI.Sprite(e||this.sourceTexture);return r.filters=t.constructor===Array?t:[t],BFN.Stage.render(r,i),r.filters=[],r=null,i}setupAdaptiveSharpnes(){this.isAdaptiveSetup=!0,this.idealBlur=Math.round(Math.max(this.sourceTexture.width,this.sourceTexture.height))/1024*1,this.sBlurFilter.resolution=.5,this.sBlurFilter.blur=this.idealBlur,this.sBlurFilter.threshold=.3;var e=this.renderCustomFilter(null,this.sBlurFilter);this.adaptiveSharpness.blurImage=e,this.blurTexture=this.renderCustomFilter(null,this.adaptiveSharpness),e.destroyGC(!0),e=null}setupTile(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),t=new PIXI.extras.TilingSprite(this.tiledDownloadedTexture,256,256);BFN.Stage.render(t,e),this.disposeTexture("tiledDownloadedTexture"),this.disposeTexture("tiledTexture"),this.tiledTexture=e,this.isTileSetup=!0}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}disposeEffect(){this.currentPresetID!=BFN.CONST.PATRIOTIC_PRESETS.PRESET_4&&this.currentPresetID!=BFN.CONST.PATRIOTIC_PRESETS.PRESET_5||null!=this.blurTexture&&this.blurTexture.destroyGC(!0),this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("effectTexture"),this.disposeTexture("tiledDownloadedTexture"),this.disposeTexture("tiledTexture"),this.blurFilter.dispose(),this.blurTexture=null,this.blurAmount=null,this.isAdaptiveSetup=!1,this.isTileSetup=!1}};BFN.effects.PopArtEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.isTileSetup=!1,this.isHalftoneTileSetup=!1,this.downloadedGradientTexture=null,this.gradientTexture=null,this.__filters={},BFN.CONST.POPART_PRESETS)this.__filters[BFN.CONST.POPART_PRESETS[e]]=new BFN.filters.PopArtFilter(BFN.CONST.POPART_PRESETS[e]);this.sBlurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.adaptiveSharpness=new BFN.filters.AdaptiveSharpnessFilter,this.adaptiveTexture=null,this.isAdaptiveSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurAmount=null,this.halftoneFilter=new BFN.filters.HalftoneFilter,this.downloadedHalftoneTexture=null,this.halftoneTexture=null,this.halftone_size=null,this.textureHolder=new PIXI.Sprite}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){var r=1;if(i&&(r=.1),this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var a=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);if(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("gradURL")&&(this.isTileSetup||(this.currentPresetID==BFN.CONST.POPART_PRESETS.PRESET_11?this.downloadedGradientTexture=BFN.XMLGraphicLoader.getGraphicByName(t.gradURL,256,20):this.downloadedGradientTexture=BFN.XMLGraphicLoader.getGraphicByName(t.gradURL,256,3),this.setupTile()),null!=this.gradientTexture&&(a.gradientSampler=this.gradientTexture)),t.hasOwnProperty("halftoneURL")){if(!this.isHalftoneTileSetup){var n=BFN.FilterHelper.getNextPowerOfTwo(1/(100/(Math.min(this.sourceTexture.width,this.sourceTexture.height)/8))*100);this.downloadedHalftoneTexture=BFN.XMLGraphicLoader.getGraphicByName(t.halftoneURL,n,n),this.setupHalftoneTile()}null!=this.halftoneTexture&&(a.halftoneSampler=this.halftoneTexture)}var o=t.hasOwnProperty("smooth_amount")?t.smooth_amount*r:.3*r;t.hasOwnProperty("isBlur")&&(o!=this.blurAmount&&(this.blurAmount=o,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),a.blurSampler=this.blurTexture),t.hasOwnProperty("isAdaptive")&&(this.isAdaptiveSetup||this.setupAdaptiveSharpnes(),a.adaptiveSharpenSampler=this.adaptiveTexture),null!=this.effectTexture&&(a.textureSampler=this.effectTexture),t.hasOwnProperty("isGradient")&&(this.gradientTexture||(this.gradientTexture=BFN.FilterHelper.createLinearGradient(t.colors,t.ratios,0,0,this.sourceTexture.width,this.sourceTexture.height,this.sourceTexture.width,this.sourceTexture.height,t.rotation,!0,!0)),a.gradientSampler=this.gradientTexture),t.hasOwnProperty("isHalftone")?(this.halftone_size!=t.halftone_size&&(this.halftone_size=t.halftone_size,this.idealDotSize=Math.max(Math.floor(this.halftone_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/512),3),this.halftoneFilter.dotSize=this.idealDotSize,this.halftoneFilter.dot_color="0x808080",this.renderCustomFilter(null,"halftoneTexture",this.halftoneFilter)),a.halftoneSampler=this.halftoneTexture):t.hasOwnProperty("halftone_size")&&(a.halftone_size=Math.max(Math.floor(t.halftone_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/512),3)),t.hasOwnProperty("silhouette_amount")&&(a.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("color_detail")&&(a.color_detail=t.color_detail),t.hasOwnProperty("detail_level")&&(a.detail_level=t.detail_level),t.hasOwnProperty("color_value_1")&&(a.color_value_1=t.color_value_1),t.hasOwnProperty("color_value_2")&&(a.color_value_2=t.color_value_2),t.hasOwnProperty("color_value_3")&&(a.color_value_3=t.color_value_3),t.hasOwnProperty("color_value_4")&&(a.color_value_4=t.color_value_4),this.filters=[a]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}renderCustomFilter(e,t,i){null==this[t]&&(this[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=i.constructor===Array?i:[i],BFN.Stage.render(this.textureHolder,this[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}setupTile(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),t=new PIXI.Sprite(this.downloadedGradientTexture);BFN.Stage.render(t,e),this.disposeTexture("downloadedGradientTexture"),this.disposeTexture("gradientTexture"),this.gradientTexture=e,this.isTileSetup=!0}setupHalftoneTile(){null==this.halftoneTexture&&(this.halftoneTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height));var e=new PIXI.extras.TilingSprite(this.downloadedHalftoneTexture,this.sourceTexture.width,this.sourceTexture.height);BFN.Stage.render(e,this.halftoneTexture),this.disposeTexture("downloadedHalftoneTexture"),this.isHalftoneTileSetup=!0}setupAdaptiveSharpnes(){this.isAdaptiveSetup=!0,this.idealBlur=Math.round(Math.max(this.sourceTexture.width,this.sourceTexture.height))/1024*1;var e=this.sBlurFilter.render(.5,this.sourceTexture);this.adaptiveSharpness.intensity=1.5,this.adaptiveSharpness.blurImage=e,this.renderCustomFilter(null,"adaptiveTexture",this.adaptiveSharpness),e=null}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("effectTexture"),this.disposeTexture("downloadedGradientTexture"),this.disposeTexture("gradientTexture"),this.disposeTexture("adaptiveTexture"),this.disposeTexture("halftoneTexture"),this.disposeTexture("downloadedHalftoneTexture"),this.blurTexture=null,this.blurFilter.dispose(),this.sBlurFilter.dispose(),this.halftone_size=null,this.isTileSetup=!1,this.isHalftoneTileSetup=!1,this.isAdaptiveSetup=!1,this.blurAmount=null}};BFN.effects.TintEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.tintFilter=new BFN.filters.TintDuoFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("color_1")&&t.hasOwnProperty("color_2"))return this.tintFilter.color1=t.color_1,this.tintFilter.color2=t.color_2,this.tintFilter.amount=t.opacity,void(this.filters=[this.tintFilter]);this.filters=[]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1}};BFN.effects.BeautifyEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper,this.beautifyFilter=BFN.ShaderPool.BeautifyFilter,this.pluginName="filter_renderer",this.blurTexture=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture),this.beautifyFilter.blurImage=this.blurTexture}applyEffect(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("beautify_amount"))return this.beautifyFilter.amount=t.beautify_amount,void(this.bfn_shaders=[this.beautifyFilter]);this.bfn_shaders=[],this.filters=[]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}};BFN.effects.MotionColorEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filters={},BFN.CONST.MOTION_COLOR_PRESETS)this.__filters[BFN.CONST.MOTION_COLOR_PRESETS[e]]=new BFN.filters.MotionColorFilter(BFN.CONST.MOTION_COLOR_PRESETS[e]);this.bwMode3=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.exposureFilter=new PIXI.filters.ColorMatrixFilter,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0,"x"),this.blurTexture=null,this.blurAmount=null,this.textureHolder=new PIXI.Sprite}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),null==this.blurTexture&&(this.blurAmount=1,this.exposureFilter.brightness(1,!1),this.exposureFilter.contrast(1.4,!0),this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),r.blurSampler=this.blurTexture,null!=this.effectTexture&&(r.textureSampler=this.effectTexture),t.hasOwnProperty("vignette_amount")&&(r.vignette_amount=t.vignette_amount),this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}renderCustomFilter(e,t,i){null==this[t]&&(this[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=i.constructor===Array?i:[i],BFN.Stage.render(this.textureHolder,this[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("effectTexture"),this.blurTexture=null,this.blurFilter.dispose()}};BFN.effects.LomoArtEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.downloadedGradientTexture=null,this.gradientTexture=null,this.isTileSetup=!1,this.__filters={},BFN.CONST.LOMO_ART_PRESETS)this.__filters[BFN.CONST.LOMO_ART_PRESETS[e]]=new BFN.filters.LomoArtFilter(BFN.CONST.LOMO_ART_PRESETS[e]);this.exposureFilter=new BFN.filters.HSFilter,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurAmount=null,this.textureHolder=new PIXI.Sprite}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==i?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("gradURL")&&(this.isTileSetup||(this.downloadedGradientTexture=BFN.XMLGraphicLoader.getGraphicByName(t.gradURL,256,5),this.setupTile()),null!=this.gradientTexture&&(r.gradientSampler=this.gradientTexture)),null==this.blurTexture&&(this.blurAmount=1,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),r.blurSampler=this.blurTexture,null!=this.effectTexture&&(r.textureSampler=this.effectTexture),t.hasOwnProperty("vignette_amount")&&(r.vignette_amount=t.vignette_amount),t.hasOwnProperty("border_color")&&(r.border_color=t.border_color),t.hasOwnProperty("border_thickness")&&(r.border_thickness=Math.floor(t.border_thickness*Math.max(this.sourceTexture.width,this.sourceTexture.height)/1024)),0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,r]):this.filters=[r]}}handleEffectTextureLoaderTextureLoaded(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}renderCustomFilter(e,t,i){null==this[t]&&(this[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=i.constructor===Array?i:[i],BFN.Stage.render(this.textureHolder,this[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}setupTile(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),t=new PIXI.Sprite(this.downloadedGradientTexture);BFN.Stage.render(t,e),this.disposeTexture("downloadedGradientTexture"),this.disposeTexture("gradientTexture"),this.gradientTexture=e,this.isTileSetup=!0}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("effectTexture"),this.disposeTexture("downloadedGradientTexture"),this.disposeTexture("gradientTexture"),this.isTileSetup=!1,this.blurTexture=null,this.blurFilter.dispose()}};BFN.effects.TouchUpEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.__filters={},BFN.CONST.TOUCH_UP_PRESETS)this.__filters[BFN.CONST.TOUCH_UP_PRESETS[e]]=new BFN.filters.TouchUpFilter(BFN.CONST.TOUCH_UP_PRESETS[e]);this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurFilter2=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurTexture2=null,this.blurAmount=null,this.curvesTexture=null,this.scFilter=new BFN.filters.SkinCandidateFilter,this.averageColor=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];t.hasOwnProperty("isBlur")&&1==t.isBlur&&(null==this.blurTexture&&(this.blurAmount=this.currentPresetID==BFN.CONST.TOUCH_UP_PRESETS.wrinkles?.25:.4,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),r.blurSampler=this.blurTexture),t.hasOwnProperty("isBlur2")&&1==t.isBlur2&&(null==this.blurTexture2&&(this.blurTexture2=this.blurFilter2.render(.07,this.sourceTexture,null,!0)),r.blurSampler2=this.blurTexture2),t.hasOwnProperty("curves")&&(null==this.curvesTexture&&this.setupCurves(BFN.CONST.PALETTE_MAPS[t.curves],t),r.curvesSampler=this.curvesTexture),null==this.averageColor&&this.setupSkinCandidate(),t.hasOwnProperty("strength")&&(r.strength=t.strength),t.hasOwnProperty("color_palette")&&(r.color_palette=t.color_palette),r.averageColor=this.averageColor,this.filters=[r]}}setupCurves(e,t){var i=3==e.length?BFN.FilterHelper.GetCurvesTexture(e[0],e[1],e[2]):2==e.length?BFN.FilterHelper.GetCurvesTexture(e[0],e[1]):BFN.FilterHelper.GetCurvesTexture(e);this.curvesTexture||(this.curvesTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height));var r=new PIXI.Sprite;r.texture=i,BFN.Stage.render(r,this.curvesTexture),i.destroyGC(!0),i=null;try{r.texture.destroyGC(!0)}catch(e){}r=null,this.isSetupCurves=!0}setupSkinCandidate(){var e=Math.min(1,600/this.sourceTexture.width,600/this.sourceTexture.height),t=PIXI.RenderTexture.create(Math.floor(this.sourceTexture.width*e),Math.floor(this.sourceTexture.height*e)),i=new PIXI.Sprite;i.scale.x=e,i.scale.y=e,i.texture=this.sourceTexture,i.filters=[this.scFilter],BFN.Stage.render(i,t),this.averageColor=BFN.Util.getTextureAverageColor(t,!1,!0),t.destroyGC(!0),t=null,i.texture=null,i=null}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("curvesTexture"),this.averageColor=null,this.blurTexture=null,this.blurFilter.dispose(),this.blurTexture2=null,this.blurFilter2.dispose()}};BFN.effects.ColorMixerEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.colorMixerFilter=BFN.ShaderPool.ColorMixerFilter,this.pluginName="filter_renderer"}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t){this.colorMixerFilter.red=t.red,this.colorMixerFilter.green=t.green,this.colorMixerFilter.blue=t.blue,this.colorMixerFilter.bw=t.bw?1:0,this.bfn_shaders=[this.colorMixerFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}};BFN.effects.SoftenEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.softenFilter=new BFN.filters.SoftenFilter,this.blurTexture=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=null,this.currentSoftness=null}applyEffect(e,t){this.softenFilter.lightness=t.lightness,this.currentSoftness!=t.softness&&(this.blurTexture=this.blurFilter.render(t.softness/200,this.sourceTexture),this.currentSoftness=t.softness),this.softenFilter.blurImage=this.blurTexture,this.filters=[this.softenFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.currentSoftness=null,this.blurFilter.dispose()}};BFN.effects.SmoothingEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.smoothingFilter=new BFN.filters.SmoothingFilter,this.blurTexture=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.9,this.sourceTexture),this.smoothingFilter.blurImage=this.blurTexture}applyEffect(e,t){this.smoothingFilter.amount=t.smoothing_amount/100,this.filters=[this.smoothingFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}};BFN.effects.BlurEdgesEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurEdgesFilter=new BFN.filters.BlurEdgesFilter,this.blurTexture=null}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=null,this.currentBlurAmount=null}applyEffect(e,t){this.blurEdgesFilter.size=t.edge_size,this.blurEdgesFilter.shift_vertical=t.shift_vertical,this.blurEdgesFilter.shift_horizontal=t.shift_horizontal,this.currentBlurAmount!=t.blur_amount&&(this.blurTexture=this.blurFilter.render(t.blur_amount/100,this.sourceTexture),this.currentBlurAmount=t.blur_amount),this.blurEdgesFilter.blurImage=this.blurTexture,this.filters=[this.blurEdgesFilter]}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.currentBlurAmount=null,this.blurFilter.dispose()}};BFN.effects.AutoEnhanceEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.bwFilter=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.averageColor=null,this.aeFilter=new BFN.filters.AutoEnhanceFilter,this.aeTexture=null,this._filter=new BFN.filters.AlphaBlendFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}applyEffect(e,t,i){if(this.resolution=e,this.parameters=t,null==this.blurTexture&&(this.blurAmount=.25,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),null==this.averageColor){this.setupAverageColor(),this.aeFilter.blurSampler=this.blurTexture,this.aeFilter.averageColor=this.averageColor,this.aeTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);var r=new PIXI.Sprite;r.texture=this.sourceTexture,r.filters=[this.aeFilter],BFN.Stage.render(r,this.aeTexture),r.texture=null,r=null}this._filter.intensity=t.intensity/100,this._filter.topImage=this.aeTexture,this.filters=[this._filter]}setupAverageColor(){var e=Math.min(1,512/this.sourceTexture.width,512/this.sourceTexture.height),t=PIXI.RenderTexture.create(Math.floor(this.sourceTexture.width*e),Math.floor(this.sourceTexture.height*e)),i=new PIXI.Sprite;i.scale.x=e,i.scale.y=e,i.texture=this.sourceTexture,i.filters=[this.bwFilter],BFN.Stage.render(i,t),this.averageColor=BFN.Util.getTextureAverageColor(t,!1,!0,!0,!0),t.destroyGC(!0),t=null,i.texture=null,i=null}disposeTexture(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.disposeTexture("aeTexture"),this.averageColor=null,this.blurTexture=null,this.blurFilter.dispose()}};function Ih(){PIXI.Sprite.call(this),this.initialized=!1}function Th(){PIXI.Sprite.call(this),this.initialized=!1}function bh(){PIXI.Sprite.call(this),this.initialized=!1}function Sh(){PIXI.Sprite.call(this),this.initialized=!1}BFN.effects.GlowEffect=new class extends PIXI.Sprite{constructor(){super(),this.initialized=!1}initEffect(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.helperSize=1024,this.helperSprite=new PIXI.Sprite,this.glowSize=0,this.glintSize=0,this.tolerance=0,this.saturation=0,this.tintColor=-1,this.intensityMode="normal",this.applied=!1,this.overlayContainer=new PIXI.Container,this.addChild(this.overlayContainer),this.overlaySprite=new PIXI.Sprite,this.overlayContainer.addChild(this.overlaySprite),this.overlaySpriteX=new PIXI.Sprite,this.overlayContainer.addChild(this.overlaySpriteX),this.overlaySpriteY=new PIXI.Sprite,this.overlayContainer.addChild(this.overlaySpriteY),this.glowPrepFilter=new BFN.filters.GlowPrepFilter,this.glowPostFilter=new BFN.filters.GlowPostFilter,this.glowBlurFilter=new BFN.filters.GaussianBlurFilter,this.glintBlurFilter=new BFN.filters.GaussianBlurFilter}setupEffect(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.helperTexture||(this.helperTexture=PIXI.RenderTexture.create(this.helperSize,this.helperSize),this.helperTexture.fillColor(0)),this.overlayTexture||(this.overlayTexture=this.helperTexture.renderClone(),this.overlaySprite.texture=this.overlayTexture),this.overlayTextureX||(this.overlayTextureX=this.helperTexture.renderClone(),this.overlaySpriteX.texture=this.overlayTextureX),this.overlayTextureY||(this.overlayTextureY=this.helperTexture.renderClone(),this.overlaySpriteY.texture=this.overlayTextureY);var t=Math.atan2(this.sourceTexture.height,this.sourceTexture.width)-Math.PI/4,i=Math.sqrt(Math.pow(this.sourceTexture.width,2)+Math.pow(this.sourceTexture.height,2)),r=Math.max(Math.cos(t)*i,Math.sin(t)*i),a=this.helperSize/r;this.helperSprite=new PIXI.Sprite(this.sourceTexture),this.helperSprite.rotation=-Math.PI/4,this.helperSprite.scale.x=this.helperSprite.scale.y=a,this.helperSprite.y=this.helperSize+Math.sin(this.helperSprite.rotation)*this.sourceTexture.height*a,this.helperSprite.filters=[],BFN.Stage.render(this.helperSprite,this.helperTexture,!1),this.helperSprite.texture=this.helperTexture,this.helperSprite.filters=[this.glowPrepFilter,this.glowBlurFilter],this.overlaySprite.anchor.y=this.helperSprite.y/this.helperSize,this.overlaySprite.rotation=Math.PI/4,this.overlaySprite.scale.x=this.overlaySprite.scale.y=1/a,this.overlaySpriteX.anchor.y=this.helperSprite.y/this.helperSize,this.overlaySpriteX.rotation=Math.PI/4,this.overlaySpriteX.scale.x=this.overlaySpriteX.scale.y=1/a,this.overlaySpriteY.anchor.y=this.helperSprite.y/this.helperSize,this.overlaySpriteY.rotation=Math.PI/4,this.overlaySpriteY.scale.x=this.overlaySpriteY.scale.y=1/a,this.helperSprite.rotation=0,this.helperSprite.scale.x=this.helperSprite.scale.y=1,this.helperSprite.y=0,this.texture=this.sourceTexture}applyEffect(e,t){var i=t.intensity_mode;this.intensityMode==i&&this.applied||(this.intensityMode=i,this.overlaySprite.blendMode="intense"==i?PIXI.BLEND_MODES.ADD:PIXI.BLEND_MODES.SCREEN,this.overlaySpriteX.blendMode="intense"==i?PIXI.BLEND_MODES.ADD:PIXI.BLEND_MODES.SCREEN,this.overlaySpriteY.blendMode="intense"==i?PIXI.BLEND_MODES.ADD:PIXI.BLEND_MODES.SCREEN);var r=100-t.tolerance,a=t.saturation,n=t.tint_color;this.tolerance==r&&this.saturation==a&&this.tintColor==n&&this.applied||(this.tolerance=r,this.saturation=a,this.tintColor=n,this.glowPrepFilter.minInput=(r-50)/50*.15+.8,this.glowPrepFilter.maxInput=this.glowPrepFilter.minInput+.05,this.glowPrepFilter.saturation=0,this.glowPrepFilter.tint=n,this.applied=!1);var o=t.glow_size/100;this.overlaySprite.visible=t.glow_size>0,this.overlaySprite.alpha=(o+Math.sin(o*(Math.PI/2)))/2,o>0&&(this.glowSize!=o||!this.applied)&&(this.glowSize=o,this.helperSprite.filters=[this.glowPrepFilter,this.glowPostFilter,this.glowBlurFilter],this.glowBlurFilter.setInputDimensions(this.helperTexture.width,this.helperTexture.height),this.glowBlurFilter.blur=o,this.glowBlurFilter.oneDirection=null,BFN.Stage.render(this.helperSprite,this.overlayTexture));var s=t.glint_size/100;this.overlaySpriteX.visible=this.overlaySpriteY.visible=t.glint_size>0,this.overlaySpriteX.alpha=this.overlaySpriteY.alpha=(s+Math.sin(s*(Math.PI/2)))/2,s>0&&(this.glintSize!=s||!this.applied)&&(this.glintSize=s,this.helperSprite.filters=[this.glowPrepFilter,this.glowPostFilter,this.glintBlurFilter],this.glintBlurFilter.setInputDimensions(this.helperTexture.width,this.helperTexture.height),this.glintBlurFilter.blur=s,this.glintBlurFilter.oneDirection="x",BFN.Stage.render(this.helperSprite,this.overlayTextureX),this.glintBlurFilter.oneDirection="y",BFN.Stage.render(this.helperSprite,this.overlayTextureY)),this.overlayContainer.alpha=t.intensity/100,this.applied=!0}disposeEffect(){this.sourceTexture=null,this.isSetup=!1,this.glowSize=0,this.glintSize=0,this.tolerance=0,this.saturation=0,this.tintColor=-1,this.intensityMode="normal",this.applied=!1,this.helperSprite.filters=[],this.helperTexture&&(this.helperTexture.destroyGC(!0),delete this.helperTexture),this.overlayTextureX&&(this.overlayTextureX.destroyGC(!0),delete this.overlayTextureX),this.overlaySpriteX.texture=PIXI.Texture.EMPTY,this.overlayTextureY&&(this.overlayTextureY.destroyGC(!0),delete this.overlayTextureY),this.overlaySpriteY.texture=PIXI.Texture.EMPTY,this.texture=PIXI.Texture.EMPTY,this.filters=null}},Ih.prototype=Object.create(PIXI.Sprite.prototype),Ih.prototype.initEffect=function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.useVariations=!0,this.bokehBlurFilter=null,this.bokehBlurFilterFull=null,this.bokehPass=0,this.bokehPasses=0,this.delaying=!1,this.validBokehBladeCounts=[3,4,5,6,7,8,9],this.primeBokehBlurFilters={},this.filterSprite=new PIXI.Sprite,this.plainFilter=null,this.bokehBGBlurFilter=null,this.bokehGentleBlurFilter=null,this.bgBlurApplied=!1,this.gentleBlurApplied=!1,this.bokehBlurApplied=!1,this.emptyTexture=PIXI.RenderTexture.create(2,2),this.emptyTexture.clear(),this.handleImagePainterPaintUpdatedBind=this.handleImagePainterPaintUpdated.bind(this)},Ih.prototype.setupEffect=function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.countdown=0},Ih.prototype.applyEffect=function(e,t){var i=this;this.resolution=e,this.parameters=t;var r=parseInt(t.hasOwnProperty("blade_count")?t.blade_count:6);if((this.validBokehBladeCounts.includes(r)||this.sourceTexture)&&!this.delaying){var a=function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;t&&(i.countdown=r),i.delaying=!0,BFN.EffectManager.manageLoadScreen=!1,UIToggler.toggleLoadScreen(!0),requestAnimationFrame(()=>{--i.countdown>0?e(!1):(i.delaying=!1,UIToggler.toggleLoadScreen(!1),BFN.EffectManager.manageLoadScreen=!0,BFN.EffectManager.currentEffect==i&&BFN.EffectManager.processEffect())})};if(!this.texturesBuilt){this.texturesBuilt=!0;var n=Math.max(this.sourceTexture.width,this.sourceTexture.height);return this.bokehScaleFactor=1024/n,this.bokehSourceW=Math.round(this.sourceTexture.width*this.bokehScaleFactor),this.bokehSourceH=Math.round(this.sourceTexture.height*this.bokehScaleFactor),this.bokehSourceTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.bokehSourceTexture.copyPixels(this.sourceTexture,null,null,null,{x:this.bokehSourceW/this.sourceTexture.width,y:this.bokehSourceH/this.sourceTexture.height}),this.bokehSourceSprite=new PIXI.Sprite(this.bokehSourceTexture),this.bgBlurRenderTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.bgBlurRenderTexture.clear(),this.gentleBlurRenderTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.gentleBlurRenderTexture.clear(),this.bokehRenderTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.bokehRenderTexture.clear(),this.bokehEraserTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.bokehEraserTexture.clear(),this.effectRenderTexture=this.sourceTexture.renderClone(),this.texture=this.effectRenderTexture,void a(!0,1)}var o=!1;if(this.plainFilter?this.bokehBGBlurFilter?this.bokehGentleBlurFilter?this.useVariations||this.bokehBlurFilterFull?this.useVariations&&!this.primeBokehBlurFilters.hasOwnProperty(r)&&(this.primeBokehBlurFilters[r]=new BFN.filters.BokehBlurFilter("X"+r),o=!0):(this.bokehBlurFilterFull=new BFN.filters.BokehBlurFilter,o=!0):(this.bokehGentleBlurFilter=new BFN.filters.BokehGentleBlurFilter,o=!0):(this.bokehBGBlurFilter=new BFN.filters.BokehBGBlurFilter,o=!0):(this.plainFilter=new BFN.filters.PlainFilter,o=!0),o)a();else{var s=()=>{""===this.bokehBlurFilter.variation?(this.bokehPasses=t.hasOwnProperty("passes")?t.passes:1,this.bokehBlurFilter.uniforms.pass1Radius=t.hasOwnProperty("pass1Radius")?t.pass1Radius:1,this.bokehBlurFilter.uniforms.pass1Layers=t.hasOwnProperty("pass1Layers")?t.pass1Layers:1,this.bokehBlurFilter.uniforms.pass2Radius=t.hasOwnProperty("pass2Radius")?t.pass2Radius:50,this.bokehBlurFilter.uniforms.pass2Layers=t.hasOwnProperty("pass2Layers")?t.pass2Layers:4,this.bokehBlurFilter.uniforms.pass3Radius=t.hasOwnProperty("pass3Radius")?t.pass3Radius:20,this.bokehBlurFilter.uniforms.pass3Layers=t.hasOwnProperty("pass3Layers")?t.pass3Layers:3,this.bokehBlurFilter.uniforms.pass4Radius=t.hasOwnProperty("pass4Radius")?t.pass4Radius:8.5,this.bokehBlurFilter.uniforms.pass4Layers=t.hasOwnProperty("pass4Layers")?t.pass4Layers:2):this.bokehPasses=4},l=this.useVariations?this.primeBokehBlurFilters[r]:this.bokehBlurFilterFull;l&&this.bokehBlurFilter!==l?(this.bokehBlurFilter&&this.bokehBlurFilter.maskTexture!==l.emptyTexture&&(this.bokehBlurFilter.maskTexture=this.emptyTexture,this.bokehBGBlurFilter.maskTexture=this.emptyTexture,this.bokehGentleBlurFilter.maskTexture=this.emptyTexture),this.bokehBlurFilter=l,this.bokehEraserTexture&&(this.bokehBlurFilter.maskTexture=this.bokehEraserTexture,this.bokehBGBlurFilter.maskTexture=this.bokehEraserTexture,this.bokehGentleBlurFilter.maskTexture=this.bokehEraserTexture),this.bokehSourceW&&this.bokehSourceH&&(this.bokehBlurFilter.dimensions=[this.bokehSourceW,this.bokehSourceH],this.bokehBGBlurFilter.dimensions=[this.bokehSourceW,this.bokehSourceH],this.bokehGentleBlurFilter.dimensions=[this.bokehSourceW,this.bokehSourceH]),s()):l||this.bokehBlurFilter||(this.bokehBlurFilter=new BFN.filters.BokehBlurFilter,s()),this.listening||(this.listening=!0,BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handleImagePainterPaintUpdatedBind),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleImagePainterPaintUpdatedBind),BFN.ImageEffect.addEventListener(BFN.ImageEffectEvents.INVERSE_PAINT.type,this.handleImagePainterPaintUpdatedBind),BFN.ImageEffect.addEventListener(BFN.ImageEffectEvents.CLEAR_PAINT.type,this.handleImagePainterPaintUpdatedBind));(()=>{var e=t.hasOwnProperty("blur_amount")?t.blur_amount/100:1;if(e>0){if(!this.bgBlurApplied)return this.bgBlurApplied=!0,this.filterSprite.texture=this.bokehSourceTexture,this.bokehBGBlurFilter.amount=e,this.bokehBGBlurFilter.maskTextureInverted=BFN.ImageEffect.inverse,this.filterSprite.filters=[this.bokehBGBlurFilter],BFN.Stage.render(this.filterSprite,this.bgBlurRenderTexture),void a(!0,1);if(!this.gentleBlurApplied)return this.gentleBlurApplied=!0,this.filterSprite.texture=this.bokehSourceTexture,this.bokehGentleBlurFilter.mode=1,this.bokehGentleBlurFilter.amount=e,this.bokehGentleBlurFilter.large=!1,this.bokehGentleBlurFilter.bgTexture=this.emptyTexture,this.bokehGentleBlurFilter.threshold=t.hasOwnProperty("bokeh_intensity")?18*(1-t.bokeh_intensity/100)+2:11,this.bokehGentleBlurFilter.intensity=t.hasOwnProperty("bokeh_intensity")?t.bokeh_intensity/100:.5,this.bokehGentleBlurFilter.maskTextureInverted=BFN.ImageEffect.inverse,this.filterSprite.filters=[this.bokehGentleBlurFilter],BFN.Stage.render(this.filterSprite,this.gentleBlurRenderTexture),void a(!0,1);if(this.bokehBlurApplied||(this.bokehBlurApplied=!0,this.flip=this.gentleBlurRenderTexture,this.flop=this.bokehRenderTexture,this.bokehPass=0,this.bokehBlurFilter.amount=e,this.bokehBlurFilter.aperture=t.hasOwnProperty("blade_curvature")?t.blade_curvature/100:1,this.bokehBlurFilter.bladeCount=t.hasOwnProperty("blade_count")?t.blade_count:6,this.bokehBlurFilter.maskTextureInverted=BFN.ImageEffect.inverse),this.bokehPass<this.bokehPasses){this.filterSprite.texture=this.flip,this.bokehBlurFilter.currentPass=this.bokehPass++,this.filterSprite.filters=[this.bokehBlurFilter],BFN.Stage.render(this.filterSprite,this.flop);var i=this.flop;return this.flop=this.flip,this.flip=i,void a(!0,1)}this.bokehGentleBlurFilter.mode=2,this.bokehGentleBlurFilter.large=!0,this.bokehGentleBlurFilter.bgTexture=this.bgBlurRenderTexture,this.filterSprite.texture=this.flip,this.filterSprite.filters=[this.bokehGentleBlurFilter],BFN.Stage.render(this.filterSprite,this.flop);var r=this.flop;this.flop=this.flip,this.flip=r,this.bokehGentleBlurFilter.mode=0,this.bokehGentleBlurFilter.large=!0,this.bokehGentleBlurFilter.bgTexture=this.emptyTexture;for(var n=0;n<2;n++){this.filterSprite.texture=this.flip,BFN.Stage.render(this.filterSprite,this.flop);var o=this.flop;this.flop=this.flip,this.flip=o}this.effectRenderTexture.copyPixels(this.flip,null,null,null,{x:this.effectRenderTexture.width/this.bokehSourceW,y:this.effectRenderTexture.height/this.bokehSourceH}),this.bgBlurApplied=!1,this.gentleBlurApplied=!1,this.bokehBlurApplied=!1}else this.effectRenderTexture.copyPixels(this.sourceTexture)})()}}},Ih.prototype.handleImagePainterPaintUpdated=function(e){if(BFN.ImagePainterUndoManager.imagePainter&&BFN.ImagePainterUndoManager.imagePainter.texture&&this.bokehEraserTexture){var t=BFN.ImagePainterUndoManager.imagePainter.texture;this.bokehEraserTexture.copyPixels(t,null,null,null,{x:this.bokehEraserTexture.width/t.width,y:this.bokehEraserTexture.height/t.height}),UITools.applyTool("lens_blur")}},Ih.prototype.disposeEffect=function(){this.sourceTexture=null,this.isSetup=!1,this.bokehBlurFilter&&(this.bokehBlurFilter.maskTexture=this.emptyTexture),this.bokehBlurFilter=null;try{this.bokehSourceTexture.destroyGC(!0)}catch(e){}this.bokehSourceTexture=null;try{this.bgBlurRenderTexture.destroyGC(!0)}catch(e){}this.bgBlurRenderTexture=null;try{this.gentleBlurRenderTexture.destroyGC(!0)}catch(e){}this.gentleBlurRenderTexture=null;try{this.bokehRenderTexture.destroyGC(!0)}catch(e){}this.bokehRenderTexture=null,this.flip=null,this.flop=null;try{this.bokehEraserTexture.destroyGC(!0)}catch(e){}this.bokehEraserTexture=null;try{this.effectRenderTexture.destroyGC(!0)}catch(e){}this.effectRenderTexture=null,this.texture=PIXI.Texture.EMPTY;try{this.bokehSourceSprite.filters=[],this.bokehSourceSprite.destroy(!1)}catch(e){}this.bokehSourceSprite=null,this.texturesBuilt=!1,BFN.ImagePainterUndoManager.removeEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handleImagePainterPaintUpdatedBind),BFN.ImagePainterUndoManager.removeEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleImagePainterPaintUpdatedBind),BFN.ImageEffect.removeEventListener(BFN.ImageEffectEvents.INVERSE_PAINT.type,this.handleImagePainterPaintUpdatedBind),BFN.ImageEffect.removeEventListener(BFN.ImageEffectEvents.CLEAR_PAINT.type,this.handleImagePainterPaintUpdatedBind),this.listening=!1},BFN.effects.BokehBlurEffect=new Ih,Th.prototype=Object.create(PIXI.Sprite.prototype),Th.prototype.initEffect=function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filters={},BFN.CONST.CINEMATIC_PRESETS)switch(BFN.CONST.CINEMATIC_PRESETS[e]){case BFN.CONST.CINEMATIC_PRESETS.FILM_GRAIN:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.GrainFilter;break;case BFN.CONST.CINEMATIC_PRESETS.COLOR_GRADING:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.ColorGradingFilter;break;case BFN.CONST.CINEMATIC_PRESETS.ANAMORPHIC:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.AnamorphicFilter;break;case BFN.CONST.CINEMATIC_PRESETS.LENS_DISTORTION:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.LensDistortionFilter;break;case BFN.CONST.CINEMATIC_PRESETS.WARPED_BLUR:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.WarpedBlurFilter;break;case BFN.CONST.CINEMATIC_PRESETS.CHROMATIC_ABERRATION:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.ChromaticAberrationFilter}this.filmGrainSeed=1},Th.prototype.setupEffect=function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.filmGrainSeed++},Th.prototype.applyEffect=function(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID],a=[r];switch(this.currentPresetID){case BFN.CONST.CINEMATIC_PRESETS.FILM_GRAIN:r.intensity=t.hasOwnProperty("intensity")?t.intensity/800:.1,r.distribution=4,"generate"===t.updating_id&&this.filmGrainSeed++,r.seed=this.filmGrainSeed,r.monochromatic=!!t.hasOwnProperty("monochromatic")&&t.monochromatic;break;case BFN.CONST.CINEMATIC_PRESETS.COLOR_GRADING:r.shadowColor=t.hasOwnProperty("shadows")?t.shadows:"000000",r.midtoneColor=t.hasOwnProperty("midtones")?t.midtones:"808080",r.highlightColor=t.hasOwnProperty("highlights")?t.highlights:"FFFFFF",r.shadowIntensity=t.hasOwnProperty("shadows_intensity")?t.shadows_intensity:1,r.midtoneIntensity=t.hasOwnProperty("midtones_intensity")?t.midtones_intensity:1,r.highlightIntensity=t.hasOwnProperty("highlights_intensity")?t.highlights_intensity:1;break;case BFN.CONST.CINEMATIC_PRESETS.ANAMORPHIC:r.stretch=t.hasOwnProperty("stretch")?t.stretch/100:1,r.distortion=t.hasOwnProperty("distortion")?t.distortion/100:1,r.vignetteOpacity=t.hasOwnProperty("vignette_opacity")?t.vignette_opacity/200:.5,r.edgeBlur=t.hasOwnProperty("edge_blur")?t.edge_blur/400:.25,r.dimensions=[this.sourceTexture.width,this.sourceTexture.height];break;case BFN.CONST.CINEMATIC_PRESETS.LENS_DISTORTION:r.distortion=t.hasOwnProperty("distortion")?t.distortion/100:.5,r.dimensions=[this.sourceTexture.width,this.sourceTexture.height];break;case BFN.CONST.CINEMATIC_PRESETS.WARPED_BLUR:r.strength=t.hasOwnProperty("blur_amount")?t.blur_amount/100:1,r.phase=t.hasOwnProperty("phase")?t.phase/10:0,r.scale=t.hasOwnProperty("scale")?t.scale/100:1,r.lightness=t.hasOwnProperty("lightness")?t.lightness/100:0,r.dimensions=[this.sourceTexture.width,this.sourceTexture.height],r.mapDimensions=[BFN.FilterHelper.getNextPowerOfTwo(this.sourceTexture.width),BFN.FilterHelper.getNextPowerOfTwo(this.sourceTexture.height)];break;case BFN.CONST.CINEMATIC_PRESETS.CHROMATIC_ABERRATION:r.distortion=t.hasOwnProperty("distortion")?t.distortion/100:.5,r.focalPointX=t.hasOwnProperty("focal_point_x")?t.focal_point_x/100:.5,r.focalPointY=t.hasOwnProperty("focal_point_y")?t.focal_point_y/100:.5,r.dimensions=[this.sourceTexture.width,this.sourceTexture.height]}this.filters=a}},Th.prototype.disposeEffect=function(){this.sourceTexture=null,this.isSetup=!1;try{this.__filters[this.currentPresetID].dispose()}catch(e){}this.currentPresetID=null},BFN.effects.CinematicEffect=new Th,bh.prototype=Object.create(PIXI.Sprite.prototype),bh.prototype.initEffect=function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filters={},BFN.CONST.MULTIMEDIA_PRESETS)switch(BFN.CONST.MULTIMEDIA_PRESETS[e]){case BFN.CONST.MULTIMEDIA_PRESETS.SCAN_LINES:this.__filters[BFN.CONST.MULTIMEDIA_PRESETS[e]]=new BFN.filters.ScanLinesFilter;break;case BFN.CONST.MULTIMEDIA_PRESETS.TELEVISION:this.__filters[BFN.CONST.MULTIMEDIA_PRESETS[e]]=new BFN.filters.TelevisionFilter;break;case BFN.CONST.MULTIMEDIA_PRESETS.HALFTONE_DUO:this.__filters[BFN.CONST.MULTIMEDIA_PRESETS[e]]=new BFN.filters.HalftoneDuoFilter}this.halftoneDuoSrc=null},bh.prototype.setupEffect=function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture;var t=Math.max(1,Math.min(Math.floor(BFN.minImageSize/2),Math.round(this.sourceTexture.height/240)));UITools.setToolValue("cinematic_scan_lines","spacing",t),UITools.updateToolControls("cinematic_scan_lines"),this.halftoneDensity=-1},bh.prototype.applyEffect=function(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID],a=[r];switch(this.currentPresetID){case BFN.CONST.MULTIMEDIA_PRESETS.SCAN_LINES:r.lineColor=t.hasOwnProperty("line_color")?t.line_color:"000000",r.opacity=t.hasOwnProperty("opacity")?t.opacity/100:.5,r.spacing=t.hasOwnProperty("spacing")?t.spacing:.2,r.invert=!!t.hasOwnProperty("invert")&&t.invert;break;case BFN.CONST.MULTIMEDIA_PRESETS.TELEVISION:var n=Math.max(2,Math.floor(this.sourceTexture.width/800));r.pixelSize=n,r.dimensions=[this.sourceTexture.width,this.sourceTexture.height];break;case BFN.CONST.MULTIMEDIA_PRESETS.HALFTONE_DUO:if(this.halftoneDuoSrc||(this.halftoneDuoSrc=PIXI.RenderTexture.create(128,128)),t.hasOwnProperty("density")&&t.density!=this.halftoneDensity){this.halftoneDensity=t.density;var o=(this.halftoneDensity-1)/99,s=(i?75:450*o+50)/Math.max(this.sourceTexture.width,this.sourceTexture.height);this.halftoneDuoSrc.resize(Math.round(this.sourceTexture.width*s),Math.round(this.sourceTexture.height*s)),this.halftoneDuoSrc.copyPixels(this.sourceTexture,null,!0,1,{x:this.halftoneDuoSrc.width/this.sourceTexture.width,y:this.halftoneDuoSrc.height/this.sourceTexture.height}),r.src=this.halftoneDuoSrc,r.srcDimensions=[this.halftoneDuoSrc.width,this.halftoneDuoSrc.height]}r.tolerance=t.hasOwnProperty("tolerance")?t.tolerance/100:.5,r.shadowColor=t.hasOwnProperty("shadow_color")?t.shadow_color:"000000",r.highlightColor=t.hasOwnProperty("highlight_color")?t.highlight_color:"FFFFFF",r.invertColors=!!t.hasOwnProperty("invert")&&t.invert,r.dimensions=[this.sourceTexture.width,this.sourceTexture.height]}this.filters=a}},bh.prototype.disposeEffect=function(){switch(this.sourceTexture=null,this.isSetup=!1,this.currentPresetID){case BFN.CONST.MULTIMEDIA_PRESETS.HALFTONE_DUO:try{this.halftoneDuoSrc.destroyGC(!0)}catch(e){}this.halftoneDuoSrc=null}try{this.__filters[this.currentPresetID].dispose()}catch(e){}this.currentPresetID=null},BFN.effects.MultimediaEffect=new bh,Sh.prototype=Object.create(PIXI.Sprite.prototype),Sh.prototype.initEffect=function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filters={},BFN.CONST.GLITCH_ART_PRESETS)switch(BFN.CONST.GLITCH_ART_PRESETS[e]){case BFN.CONST.GLITCH_ART_PRESETS.CORRUPTED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchCorruptedFilter;break;case BFN.CONST.GLITCH_ART_PRESETS.DISTORTED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchDistortedFilter;break;case BFN.CONST.GLITCH_ART_PRESETS.SEGMENTED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchSegmentedFilter;break;case BFN.CONST.GLITCH_ART_PRESETS.FRAGMENTED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchFragmentedFilter;break;case BFN.CONST.GLITCH_ART_PRESETS.DIGITIZED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchDigitizedFilter}},Sh.prototype.setupEffect=function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture},Sh.prototype.applyEffect=function(e,t,i){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID],a=[r];switch(this.currentPresetID){case BFN.CONST.GLITCH_ART_PRESETS.CORRUPTED:r.setDimensions(this.sourceTexture.width,this.sourceTexture.height),r.seed!==t.phase&&(r.seed=parseInt(t.phase),r.drawGlitchSource()),r.strength=t.hasOwnProperty("strength")?t.strength/100:.5;var n="000"+(t.hasOwnProperty("complexity")?(parseInt(t.complexity)-1).toString(2):"");n=n.substring(n.length-3,n.length),r.vShift=parseInt(n[2]),r.noise=parseInt(n[1]),r.chromatic=parseInt(n[0]);break;case BFN.CONST.GLITCH_ART_PRESETS.DISTORTED:r.setSourceTexture(this.sourceTexture),r.grayscale=t.hasOwnProperty("grayscale")?parseInt(t.grayscale):1,r.phase=t.hasOwnProperty("phase")?t.phase/100:0,r.length=t.hasOwnProperty("length")?t.length/100:.2,r.horizontal=t.hasOwnProperty("slide_horizontal")?t.slide_horizontal/100:.2;break;case BFN.CONST.GLITCH_ART_PRESETS.SEGMENTED:r.setDimensions(this.sourceTexture.width,this.sourceTexture.height),r.grayscale=t.hasOwnProperty("grayscale")?parseInt(t.grayscale):0,r.horizontal=t.hasOwnProperty("slide_horizontal")?t.slide_horizontal/100:.1,r.vertical=t.hasOwnProperty("slide_vertical")?t.slide_vertical/100:.1,r.colorCycle=t.hasOwnProperty("colors")?parseInt(t.colors):0;break;case BFN.CONST.GLITCH_ART_PRESETS.FRAGMENTED:r.setSourceTexture(this.sourceTexture),r.grayscale=t.hasOwnProperty("grayscale")?parseInt(t.grayscale):0,r.highlights=t.hasOwnProperty("highlights")?t.highlights/100:.5,r.offset=t.hasOwnProperty("offset")?t.offset/100:.5;break;case BFN.CONST.GLITCH_ART_PRESETS.DIGITIZED:r.setSourceTexture(this.sourceTexture),r.colorValue=t.hasOwnProperty("color_picker")?t.color_picker:-1,r.highlights=t.hasOwnProperty("highlights")?t.highlights/100:.5,r.weight=t.hasOwnProperty("weight")?t.weight/100:.5,r.horizontal=t.hasOwnProperty("slide_horizontal")?t.slide_horizontal/100:.5}this.filters=a}},Sh.prototype.disposeEffect=function(){switch(this.sourceTexture=null,this.isSetup=!1,this.currentPresetID){case BFN.CONST.GLITCH_ART_PRESETS.GLITCH:try{this.__filters[this.currentPresetID].clearGlitchSource()}catch(e){}break;case BFN.CONST.GLITCH_ART_PRESETS.GLITCH_BW:case BFN.CONST.GLITCH_ART_PRESETS.CYBER_SPACE:try{this.__filters[this.currentPresetID].resetSourceTexture()}catch(e){}}try{this.__filters[this.currentPresetID].dispose()}catch(e){}this.currentPresetID=null},BFN.effects.GlitchArtEffect=new Sh,BFN.effectMap={},BFN.effectMap.analog="AnalogEffect",BFN.effectMap.bwfx="AnalogEffect",BFN.effectMap.warmfx="AnalogEffect",BFN.effectMap.clarity="ClarityEffect",BFN.effectMap.color="ColorEffect",BFN.effectMap.replace_color="ReplaceColorEffect",BFN.effectMap.exposure="ExposureEffect",BFN.effectMap.fill_light="FillLightEffect",BFN.effectMap.gauss_blur="GaussianBlurEffect",BFN.effectMap.blur="GaussianBlurEffect",BFN.effectMap.gray="GrayEffect",BFN.effectMap.desaturate="GrayEffect",BFN.effectMap.invert="InvertEffect",BFN.effectMap.levels="LevelsEffect",BFN.effectMap.sharpen="UnsharpMaskEffect",BFN.effectMap.vibrance="VibranceEffect",BFN.effectMap.vignette="VignetteEffect",BFN.effectMap.bw="BlackWhiteEffect",BFN.effectMap.chromatic="ChromaticEffect",BFN.effectMap.charcoal="CharcoalEffect",BFN.effectMap.cyanotype="CyanotypeEffect",BFN.effectMap.orton_style="OrtonStyleEffect",BFN.effectMap.sepia="SepiaEffect",BFN.effectMap.viewfinder="ViewFinderEffect",BFN.effectMap.summer="SummerEffect",BFN.effectMap.unitedcolors="UnitedColorsEffect",BFN.effectMap.instant="InstantEffect",BFN.effectMap.cooler="CoolingEffect",BFN.effectMap.warmer="WarmingEffect",BFN.effectMap.tinytype="TinyTypeEffect",BFN.effectMap.crossprocess="CrossProcessEffect",BFN.effectMap.vintagecolors="VintageColorsEffect",BFN.effectMap.holgaart="HolgaArtEffect",BFN.effectMap.lineartopia="LineArtopiaEffect",BFN.effectMap.hdr="HDREffect",BFN.effectMap.pinhole="PinholeEffect",BFN.effectMap.colorpinhole="ColorPinholeEffect",BFN.effectMap.stenciler="StencilerEffect",BFN.effectMap.grungefx="GrungeEffect",BFN.effectMap.sunburst="SunburstEffect",BFN.effectMap.oldphotofx="OldPhotoEffect",BFN.effectMap.winterfx="WinterEffect",BFN.effectMap.tiltshiftfx="TiltShiftEffect",BFN.effectMap.patrioticfx="PatrioticEffect",BFN.effectMap.popartfx="PopArtEffect",BFN.effectMap.tint="TintEffect",BFN.effectMap.beautify="BeautifyEffect",BFN.effectMap.motioncolor="MotionColorEffect",BFN.effectMap.lomoart="LomoArtEffect",BFN.effectMap.color_mixer="ColorMixerEffect",BFN.effectMap.soften="SoftenEffect",BFN.effectMap.smoothing="SmoothingEffect",BFN.effectMap.blur_edges="BlurEdgesEffect",BFN.effectMap.auto_enhance="AutoEnhanceEffect",BFN.effectMap.glow="GlowEffect",BFN.effectMap.lens_blur="BokehBlurEffect",BFN.effectMap.cinematic="CinematicEffect",BFN.effectMap.multimedia="MultimediaEffect",BFN.effectMap.glitch_art="GlitchArtEffect",BFN.effectMap.touchup="TouchUpEffect",BFN.effectPresetMap={},BFN.effectIDMap={},BFN.EffectData.forEach(e=>{var t=e.presets,i=e.id;t.forEach(e=>{var t=e.id;BFN.effectPresetMap["".concat(i,"_").concat(t)]=i,BFN.effectIDMap[t]=i})});class Ch{constructor(){this.init()}init(){BeFunky.log("ImageEditManager Init"),this.initDefaultValues()}initDefaultValues(){this.editingImage=!1,this.targetViewstate=null,this.targetImageItem=null,this.targetMaskImageItem=null,this.targetGridCell=null,this.flattenedImage=null,this.handleAppModelViewStateChangedBind=this.handleAppModelViewStateChanged.bind(this),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.handleSourceImageUpdated.bind(this)),this.disregardSourceImageUpdate=!1,this.imageChangedWhileEditing=!1,this.backButton=document.getElementById("app_goto_edit_source_section"),this.backButtonText=this.backButton.querySelector("string"),this.animatingBackground=document.querySelector(".image-edit__bg"),this.animatingImage=document.querySelector(".image-edit__image"),this.secondaryPanel=document.getElementById("secondary-panel"),this.animatingImage.addEventListener("click",()=>{this.targetViewstate&&(BFN.AppModel.viewState=this.targetViewstate)}),this.maxThumbSize=160,this.animatingImageRect={},this.animatingImageAppRect={},this.animatingImageObjectURL=null}openImageInEditor(e){if(e&&"texture"===e.type&&e.projectItemVO&&e.projectItemVO.imageID){var t=e.projectItemVO.imageID;if(!BFN.AppModel.sectionValue(null,"collage","designer"))return;UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"Opening image in Photo Editor"});var i=t=>{t instanceof Blob?(this.targetImageItem=e,this.goToEditor(t)):UIToggler.toggleLoadScreen(!1)};if(e.isShape)return void BFN.TextureUtils.textureToBlobWithErrorHandling(e.itemContent,{isTransparent:!0}).catch(e=>BeFunky.logError("Unable to convert SVG -> Blob for Open Image in Editor",e)).then(i);BFN.ProjectService.getLocalAsset("image",t).catch(e=>BeFunky.logError("Unable to get asset from IndexedDB for Open Image in Editor",e)).then(i)}}openMaskImageInEditor(e){if(e&&"frame_texture"===e.type&&e.projectItemVO&&e.projectItemVO.maskImageID){var t=e.projectItemVO.maskImageID;if(!BFN.AppModel.sectionValue(null,"collage","designer"))return;UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"opening_image_in_editor"}),BFN.ProjectService.getLocalAsset("image",t).catch(BeFunky.logError).then(t=>{t?(this.targetMaskImageItem=e,this.goToEditor(t)):UIToggler.toggleLoadScreen(!1)})}}openGridCellInEditor(e){if(e&&e.menuImageVO){var t=e.menuImageVO.id;UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"opening_image_in_editor"});var i=t=>{t?(this.targetGridCell=e,this.goToEditor(t)):UIToggler.toggleLoadScreen(!1)};if(e.menuImageVO.isSVG)return void BFN.TextureUtils.textureToBlobWithErrorHandling(e.menuImageVO.imageTexture,{isTransparent:!0}).catch(e=>BeFunky.logError("Unable to convert SVG -> Blob for Open Image in Editor",e)).then(i);BFN.ProjectService.getLocalAsset("image",t).catch(e=>BeFunky.logError("Unable to get asset from IndexedDB for Open Image in Editor",e)).then(i)}}goToEditor(e){BFN.ProjectManager.autoSave.editor.allowAutoSave=!1,this.editingImage=!0,this.targetViewstate=BFN.AppModel.viewState,BFN.AppModel.viewingCollage?(BFN.BfnService.track("CREATE","COLLAGE","OPEN_IMAGE_EDITOR"),this.backButtonText.setLang("back_to_collage")):BFN.AppModel.viewingDesigner&&(BFN.BfnService.track("CREATE","DESIGNER","OPEN_IMAGE_EDITOR"),this.backButtonText.setLang("back_to_designer"));var t=!(!BFN.hasEnteredEditor||!BFN.PhotoEditorModel.currentTexture)||BFN.editorProjectShelved;BFN.editorProjectShelved=!1,this.transitionToEditor(i=>{BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,BFN.editorProjectShelved=t,UIToggler.toggleSampleImagePopover(!1),UITools.setToolValue("editor_main","edit",!1),UITools.applyTool("editor_main"),this.toggleFinishButton(!0),this.disregardSourceImageUpdate=!0,this.imageChangedWhileEditing=!1,BFN.PhotoEditorModel.loadBase64OrBlob(e,{filename:"BeFunky-layer",showLoadScreen:!1,callback:i,clearLocalAssets:!1})})}transitionToEditor(e){var t=this.animatingBackground,i=this.animatingImage,r=this.getProjectBoundingClientRect(),a=r.width/r.height;i.setStyles({width:"".concat(r.width,"px"),height:"".concat(r.height,"px"),transform:"translateX(".concat(r.left,"px) translateY(").concat(-r.bottom,"px)"),transition:"none",pointerEvents:"none"}),this.animatingImageRect=r,this.animatingImageAppRect=BFN.appRect;var n,o,s,l,h=Math.round(Math.min(Math.max(r.width,r.height),BFN.maxImageSizeLayer));function c(e,t){setTimeout(()=>requestAnimationFrame(t),e)}n=h,o=(n=>{this.animatingImageObjectURL=n,i.setStyles({backgroundImage:"url(".concat(n,")"),visibility:"visible",outlineWidth:"0"});var o=Math.max(50,Math.min(500,Math.round(Math.pow(h,2)/4e4)));c(o,()=>{t.setStyles({opacity:1})}),c(o+30,()=>{e(e=>{if(!e.success)return UIToggler.toggleLoadScreen(!1),t.removeAttribute("style"),i.removeAttribute("style"),this.completeEditing(),void(BFN.AppModel.viewState=this.targetViewstate);c(0,()=>{UIToggler.toggleLoadScreen(!1);var e=this.maxThumbSize,n=a>1?r.width/e:r.height/e,o=a>1?e:e*a,s=a>1?e/a:e,l="translateX(".concat(16+BFN.CSS.leftMenuBarWidth+BFN.CSS.secondaryMenuWidth,"px) translateY(-").concat(16+BFN.CSS.footerHeight,"px)");i.setStyles({transform:"".concat(l," scale(").concat(1/n,")"),transition:"transform ".concat(600,"ms ease-in-out")}),t.setStyles({transition:"opacity ".concat(500,"ms ease-in-out ").concat(100,"ms"),opacity:0}),c(700,()=>{t.removeAttribute("style"),i.setStyles({width:"".concat(o,"px"),height:"".concat(s,"px"),transform:"",transition:"none"}),c(0,()=>{i.setStyles({transition:"",outlineWidth:"",pointerEvents:""}),i.setAttribute("data-bfntooltip",this.backButtonText.dataset.lang)})})})})})}),s=BFN.AppModel.viewingCollage?BFN.CollageMakerCanvas.getFlattenedImage(!0):BFN.DesignerCanvas.getFlattenedImage(),l=BFN.Util.getThumbTexture(s,n),s.destroyGC(!0),BFN.TextureUtils.textureToBlobWithErrorHandling(l,{isTransparent:!0}).catch(e=>{BeFunky.logError("Unable to generate Blob for Open Image in Editor transition",e)}).then(e=>{l.destroyGC(!0);var t=URL.createObjectURL(e||new Blob),i=new Image;i.onload=i.onerror=(()=>{o(t),i.onerror=void 0}),i.src=t})}getProjectBoundingClientRect(){if(BFN.AppModel.viewingCollage){var e=BFN.CollageMakerCanvas.scale.x,t=BFN.CollageMakerCanvas.canvasPhotoGrid.gridWidth*e,i=BFN.CollageMakerCanvas.canvasPhotoGrid.gridHeight*e,r=BFN.CollageMakerCanvas.canvasContainer.x*e,a=-BFN.CollageMakerCanvas.canvasContainer.y*e;return{width:t,height:i,left:BFN.CollageMakerCanvas.x+r-t/2+BFN.appViewportRect.left,bottom:BFN.CollageMakerCanvas.y+a-i/2+BFN.CSS.footerHeight}}if(!BFN.AppModel.viewingDesigner)throw"Wrong app section";var n=BFN.DesignerCanvas.scale.x,o=BFN.DesignerCanvas.canvasWidth*n,s=BFN.DesignerCanvas.canvasHeight*n,l=BFN.DesignerCanvas.canvasContainer.x*n,h=-BFN.DesignerCanvas.canvasContainer.y*n;return{width:o,height:s,left:BFN.DesignerCanvas.x+l-o/2+BFN.appViewportRect.left,bottom:BFN.DesignerCanvas.y+h-s/2+BFN.CSS.footerHeight}}transitionFromEditor(){var e=this.animatingBackground,t=this.animatingImage,i=this.animatingImageRect,r=this.animatingImageAppRect;function a(e,t){setTimeout(()=>requestAnimationFrame(t),e)}t.setStyles({outlineWidth:"0",pointerEvents:"none",transform:getComputedStyle(t).transform,transition:"none"}),e.setStyles({opacity:1}),requestAnimationFrame(()=>{var n=this.maxThumbSize,o=i.width/i.height>1?i.width/n:i.height/n,s=i.left+(BFN.appRect.width-r.width)/2,l=i.bottom+(BFN.appRect.height-r.height)/2;t.setStyles({transform:"translateX(".concat(s,"px) translateY(").concat(-l,"px) scale(").concat(o,")"),transition:"transform ".concat(500,"ms ease-in-out")}),a(500,()=>{t.setStyles({opacity:0,transition:"opacity ".concat(300,"ms ease-in-out")}),e.setStyles({opacity:0,transition:"opacity ".concat(300,"ms ease-in-out")}),a(300,()=>{e.removeAttribute("style"),t.removeAttribute("style"),this.animatingImageObjectURL&&URL.revokeObjectURL(this.animatingImageObjectURL)})})})}completeEditing(e){BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),this.flattenedImage=e?BFN.PhotoEditorCanvas.getFlattenedImage():null,this.editingImage=!1,this.resetEditor(),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewStateChangedBind)}applyEdit(){if(this.flattenedImage){var e=this.processTexture(this.flattenedImage),t=new PIXI.Point(this.flattenedImage.baseTexture.width,this.flattenedImage.baseTexture.height);if(this.targetImageItem){var i,r,a,n,o=new PIXI.Point(this.targetImageItem.itemContent.texture.baseTexture.width,this.targetImageItem.itemContent.texture.baseTexture.height),s=o.x!=t.x||o.y!=t.y,l=this.targetImageItem;if(s){var h=l.bounds,c=h.width,u=h.height;i=c*l.scale.x,r=u*l.scale.y;var d=Math.sqrt(Math.pow(i,2)+Math.pow(r,2))/2,m=Math.atan2(r/2,i/2);a=l.x+Math.cos(m+l.rotation)*d,n=l.y+Math.sin(m+l.rotation)*d}if(this.targetImageItem.createTransition("edit_image"),this.targetImageItem.projectItemVO.imageID=e.id,this.targetImageItem.itemObject.texture=this.flattenedImage,this.targetImageItem.itemContent.texture=this.flattenedImage,this.targetImageItem.updateContentDimensions(),s){var p=l.bounds,g=p.width,f=p.height,v=g*l.scale.x,y=f*l.scale.y,x=Math.sqrt(Math.pow(v,2)+Math.pow(y,2))/2,_=Math.atan2(y/2,v/2),I=Math.min(i/v,r/y);l.scale.x*=I,l.scale.y*=I,l.x=a+Math.cos(_+Math.PI+l.rotation)*x*I,l.y=n+Math.sin(_+Math.PI+l.rotation)*x*I}this.targetImageItem.registerTransition()}else if(this.targetMaskImageItem){var T=new PIXI.Point(this.targetMaskImageItem.itemContent.texture.baseTexture.width,this.targetMaskImageItem.itemContent.texture.baseTexture.height),b=T.x!=t.x||T.y!=t.y;this.targetMaskImageItem.createTransition("edit_image"),this.targetMaskImageItem.projectItemVO.maskImageID=e.id,this.targetMaskImageItem.itemObject.texture=this.flattenedImage,this.targetMaskImageItem.itemContent.setTexture(this.flattenedImage),b&&(this.targetMaskImageItem.itemContent.textureScale=1,this.targetMaskImageItem.itemContent.offsetFactorX=.5,this.targetMaskImageItem.itemContent.offsetFactorY=.5),this.targetMaskImageItem.itemContent.updateDisplay(),this.targetMaskImageItem.registerTransition()}else if(this.targetGridCell){var S=new PIXI.Point(this.targetGridCell.content.image.frameSprite.texture.baseTexture.width,this.targetGridCell.content.image.frameSprite.texture.baseTexture.height),C=S.x!=t.x||S.y!=t.y;this.targetGridCell.menuImageVO=e,this.targetGridCell.content.setImage(e.imageTexture,C,!1,this.targetGridCell.content.image.frameSprite.rotate)}}this.flattenedImage=null}processTexture(e){switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:UITools.setToolValue("collage_main","image_manager",!1),UITools.applyTool("collage_main");break;case BFN.AppModelViewStates.VIEWING_DESIGNER:UITools.setToolValue("designer_main","image_manager",!1),UITools.applyTool("designer_main")}return BFN.ImageLibraryManager.createMenuImageVOFromTexture(e)}resetEditor(){BFN.PhotoEditorModel.currentTexture&&BFN.PhotoEditorModel.currentTexture!==BFN.PhotoEditorModel.sourceTexture&&BFN.PhotoEditorModel.currentTexture.destroyGC(!0),BFN.PhotoEditorModel.currentTexture=null,BFN.PhotoEditorModel.dispatchEvent(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED),BFN.PhotoEditorModel.dispatchEvent(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED),BFN.ArtsyService.reset(),BFN.BackgroundRemovalManager.reset(),BFN.TransformStateModel.clearTransitions(BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR),BFN.PhotoEditorCanvasModel.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS),BFN.PhotoEditorHistoryModel.resetHistory(),BFN.PhotoEditorModel.sourceTexture.clear(),BFN.PhotoEditorModel.sourceTexture.resize(32,32),showMenuPanel("primary"),BFN.PhotoEditorModel.hasUnsavedChanges=!1}overrideSetAppViewState(e){this.targetViewstate=this.targetViewstate||e;var t=()=>{var e=BFN.UserActionManager.getSaveData(),t=new BFN.UserActionVO;t.eventID="collage_or_designer_image_edited",t.eventObject={targetSection:BFN.AppModel.getSectionValue(this.targetViewstate,"Photo Editor","Collage Maker","Designer"),imageEditMainFunnel:e.actions,imageEditFontsUsed:e.fonts,imageEditLayerSourcesUsed:e.assets},t.register()};BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS?BeFunky.confirm("apply_changes_leave_editor",{onConfirm:()=>{BFN.PhotoEditorCanvasTools.applyCurrentTool(),t(),this.completeEditing(!0),this.transitionFromEditor(),BFN.AppModel.viewState=this.targetViewstate},confirmText:"yes",cancelText:"no_keep_editing"}):(()=>{t(),this.completeEditing(this.imageChangedWhileEditing||BFN.UndoManager.undoExists),this.transitionFromEditor(),BFN.AppModel.viewState=this.targetViewstate})()}toggleFinishButton(e){document.getElementById("app_goto_button").setStyles({display:e?"none":"block"}),this.backButton.setStyles({display:e?"flex":"none"}),this.backButton.removeClass("bounce")}handleAppModelViewStateChanged(){BFN.AppModel.removeEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewStateChangedBind),this.toggleFinishButton(!1),BFN.AppModel.viewState===this.targetViewstate&&(this.flattenedImage&&this.applyEdit(),this.targetImageItem&&this.targetImageItem.selectItem(),this.targetMaskImageItem?this.targetMaskImageItem.selectItem():this.targetGridCell&&(BFN.PhotoGrid.selectedChild=this.targetGridCell,BFN.PhotoGrid.isolateGridChild(this.targetGridCell))),setTimeout(()=>{BFN.ProjectManager.autoSave.editor.allowAutoSave=!0},2e3),this.targetViewstate=null,this.targetImageItem=null,this.targetMaskImageItem=null,this.targetGridCell=null,this.flattenedImage=null}handleSourceImageUpdated(e){if(this.editingImage){if(this.disregardSourceImageUpdate)return void(this.disregardSourceImageUpdate=!1);this.imageChangedWhileEditing=!0}}}BFN.SingletonQueue.add(()=>{BFN.ImageEditManager=new Ch});class Bh{constructor(){this.init()}init(){BeFunky.log("ImageLibraryManager Init"),this.initDefaultValues(),this.initSampleImages()}initDefaultValues(){this.selectedMenuImageVOs=[],this.sampleMenuImageVOs=[],BFN.IndexedDB.get("options__selectedMenuImageVOs").then(e=>{Array.isArray(e)&&e.reverse().forEach(e=>this.addImage(e,{useTracking:!1}))}).catch(e=>{BeFunky.logError("Unable to fetch previous session's selectedMenuImageVOs from IndexedDB",e)}),this.imageLibraryModal=null,this.stockSearchModal=document.getElementById("stock_search_modal"),document.getElementById("image_manager_upload_image").addEventListener("click",()=>this.uploadImages()),document.getElementById("image_manager_open_image_library").addEventListener("click",()=>this.openModal()),document.getElementById("image_manager_search_images").addEventListener("click",()=>this.openModal("stock_images")),this.sidebar=document.getElementById("image_manager"),BFN.UI.imageManager(this.sidebar),document.getElementById("image_manager_autofill").addEventListener("click",()=>this.autofill()),document.getElementById("image_manager_clear").addEventListener("click",()=>this.clearCanvas()),this.initRemoveUnusedButton(),this._mode="IMAGE_MANAGER",this.updateImageStore=BeFunky.debounce(this.updateImageStore,0),this.trackAddImage=BeFunky.debounce(this.trackAddImage,1e3),this.trackRemoveImage=BeFunky.debounce(this.trackRemoveImage,1e3)}initSampleImages(){this.sampleMenuImageVOs=[{name:"Sample1",thumb:"sample_1_thumb.jpg",image:"sample_1_large.jpg"},{name:"Sample2",thumb:"sample_2_thumb.jpg",image:"sample_2_large.jpg"},{name:"Sample3",thumb:"sample_3_thumb.jpg",image:"sample_3_large.jpg"},{name:"Sample4",thumb:"sample_4_thumb.jpg",image:"sample_4_large.jpg"},{name:"Sample5",thumb:"sample_5_thumb.jpg",image:"sample_5_large.jpg"},{name:"Sample6",thumb:"sample_6_thumb.jpg",image:"sample_6_large.jpg"}].map(e=>{var t=new BFN.MenuImageVO;return t.name=e.name,t.createId("sample",e.name),t.thumbURL="".concat(BFN.imagesURL,"app/image-manager/").concat(e.thumb),t.thumbWidth=150,t.thumbHeight=150,t.imageURL="".concat(BFN.imagesURL,"app/image-manager/").concat(e.image,"?io=off"),t.isSaved=!0,t.isRemovable=!1,t}),setTimeout(()=>{this.sampleMenuImageVOs.slice().forEach(e=>this.sidebar.addItem(e,void 0,!0))},0)}initRemoveUnusedButton(){this.removeUnusedButton=document.getElementById("image_manager_remove_unused"),this.removeUnusedButton.addEventListener("click",()=>this.removeUnused()),this.updateRemoveUnusedButton=BeFunky.debounce(this.updateRemoveUnusedButton,100);var e=()=>{BFN.AppModel.viewingCollage&&this.updateRemoveUnusedButton()};BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,e),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.type,e)}setupImageLibraryModal(){this.imageLibraryModal||(this.imageLibraryModal=BeFunky.imageLibraryModal({imageSelectionHandler:(e,i)=>(i&&"google_photos"===BFN.getImageType(e.id)&&"IMAGE_MANAGER"===this.mode&&(e.indexedDBKey="image__".concat(e.id),BeFunky.GooglePhotosManager.downloadGooglePhoto(e).then(i=>{var r=t(i,2),a=r[0],n=r[1];this.selectedMenuImageVOs.find(t=>{return t.id===e.id})&&(this.updateImage(e.id,{thumbURL:a}),BFN.ProjectService.setLocalAsset("imagemanager","image",e.id,n))}).catch(e=>{BeFunky.throwError("Unable to download Google Photo",e)})),"UPLOAD_MENU"===this.mode?(this.imageLibraryModal.close(),BFN.PhotoEditorModel.confirmEditorLoadImage(()=>{this.addImageToPhotoEditorCanvas(e)},()=>{this.mode="UPLOAD_MENU",this.imageLibraryModal.open()}),!1):this.handleImageSelection(e,i)),isSelected:e=>-1!==this.getIndex(e),initialMode:this.mode,transformImageObject:e=>{var t=new BFN.MenuImageVO;t.setObject(e);var i=BFN.getImageType(t.id);return"befunky_layer"!==i&&"befunky_photo"!==i||(t.isSaved=!0,!t.name&&e.title&&(t.name=e.title)),t},extendItem:(e,t)=>{var i=BFN.getImageType(t.id);if("befunky_layer"===i||"befunky_photo"===i){var r=document.createElement("button").setClass("image-gallery__button image-gallery__button--delete");r.setAttribute("data-bfntooltip","delete"),r.innerHTML=BeFunky.getSvgHtml("transform-delete",{classes:"icon icon-size-large"}),e.appendChild(r),e.addClass("image-gallery__item--has-button"),r.addEventListener("click",e=>{e.stopPropagation(),this.deleteImage(t.id)})}},onClose:()=>{this.mode="IMAGE_MANAGER"}}))}openModal(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"IMAGE_MANAGER";"stock_images"===e?(this.stockSearchModal.init||BFN.UI.stockSearchModal(this.stockSearchModal),this.stockSearchModal.open()):this.imageLibraryModal?this.imageLibraryModal.open(e):(this.setupImageLibraryModal(),this.imageLibraryModal.open(e||"befunky")),this.mode=t}uploadImages(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};BFN.MultipleFileUploader.upload(t=>{this.handleImageLoaded(t),e&&e(t)},t)}addImage(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.cloneObject,r=void 0===i||i,a=t.index,n=void 0===a?0:a,o=t.updateImageGalleryItem,s=void 0===o||o,l=t.useTracking,h=void 0===l||l;if(!e.id)throw"MenuImageVO missing id";if(-1===this.getIndex(e.id)){var c;if(r||e instanceof BFN.MenuImageVO||(r=!0,BeFunky.throwError("MenuImageVO cloning forced on plain object",e)),r?(c=new BFN.MenuImageVO).setObject(e):c=e,this.selectedMenuImageVOs.splice(n,0,c),e.indexedDBKey){var u=e.isSVG?"svg":"image";BFN.ProjectService.setLocalAsset("imagemanager",u,e.id,void 0,!0)}if(requestAnimationFrame(()=>this.sidebar.addItem(c,n)),s){var d=["unsplash","pixabay","pexels"].includes(BFN.getImageType(e.id))?this.stockSearchModal:this.imageLibraryModal;d&&d.selectGalleryItem&&d.selectGalleryItem(c.id)}this.updateImageStore(),this.updateRemoveUnusedButton(),h&&this.trackAddImage()}}updateImage(e,t){var i=this.getIndex(e);-1!==i&&(Object.assign(this.selectedMenuImageVOs[i],t),this.updateImageStore())}removeImage(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.updateImageGalleryItem,r=void 0===i||i,a=t.usedBaseTextures,n=void 0===a?null:a,o=this.getIndex(e);if(-1!==o){n||(n=BFN.GlobalHistoryModel.getUsedBaseTextures());var s=this.selectedMenuImageVOs[o];s.imageTexture&&s.imageTexture.valid&&s.imageTexture.baseTexture&&!n.includes(s.imageTexture.baseTexture)&&(s.imageTexture.destroyGC(!0),s.imageTexture=null),this.selectedMenuImageVOs.splice(o,1);var l=s.isSVG?"svg":"image";if(BFN.ProjectService.removeLocalAsset("imagemanager",l,e),requestAnimationFrame(()=>this.sidebar.removeItem(e)),r){var h=["unsplash","pixabay","pexels"].includes(BFN.getImageType(s.id))?this.stockSearchModal:this.imageLibraryModal;h&&h.deselectGalleryItem&&h.deselectGalleryItem(e)}this.updateImageStore(),this.updateRemoveUnusedButton(),this.trackRemoveImage()}}trackAddImage(){var e=BFN.AppModel.sectionValue("PHOTOEDITOR","COLLAGE","DESIGNER");BFN.BfnService.track("CREATE",e,"ADD_PHOTOS")}trackRemoveImage(){var e=BFN.AppModel.sectionValue("PHOTOEDITOR","COLLAGE","DESIGNER");BFN.BfnService.track("CREATE",e,"DELETEITEM_BASKET")}getIndex(e){return this.selectedMenuImageVOs.findIndex(t=>t.id===e)}getSampleIndex(e){return this.sampleMenuImageVOs.findIndex(t=>t.id===e)}getMenuImageVO(e){return("sample"===BFN.getImageType(e)?this.sampleMenuImageVOs:this.selectedMenuImageVOs).find(t=>t.id===e)}updateImageStore(){var e=this.selectedMenuImageVOs.map(e=>e.getObject());e.length||BFN.ProjectService.clearLocalAssets("imagemanager"),BFN.IndexedDB.set("options__selectedMenuImageVOs",e).catch(e=>BeFunky.logError("Unable to update selectedMenuImageVOs in IndexedDB",e))}autofill(){var e=this.selectedMenuImageVOs.length?this.selectedMenuImageVOs:this.sampleMenuImageVOs;BFN.CollageMakerCanvasPhotoGrid.autoFill(e);try{BFN.BfnService.track("CREATE","COLLAGE","AUTOFILL")}catch(e){}}clearCanvas(){BFN.CollageMakerHistoryModel.ignoreSnapshot=!0,BFN.PhotoGrid.clearAllGridChildren(),BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,BFN.CollageMakerHistoryModel.historyAction="cells_cleared",BFN.PhotoGrid.getPhotoGridSnapShot();try{BFN.BfnService.track("CREATE","COLLAGE","CLEARALL")}catch(e){}}removeUnused(){var e=BFN.PhotoGrid.getGridMenuImageVOs().map(e=>{return e.id}),t=this.selectedMenuImageVOs.map(e=>{return e.id}).filter(t=>!e.includes(t));BeFunky.confirm("confirm_remove_unused_images",{onConfirm:()=>{var e=BFN.GlobalHistoryModel.getUsedBaseTextures();t.map(t=>this.removeImage(t,{usedBaseTextures:e}))},confirmText:"yes",cancelText:"no"});try{BFN.BfnService.track("CREATE","COLLAGE","CLEAR_BASKET")}catch(e){}}updateRemoveUnusedButton(){if(BFN.PhotoGrid){var e=BFN.PhotoGrid.getGridMenuImageVOs().map(e=>e.id);this.removeUnusedButton.disabled=!this.selectedMenuImageVOs.find(t=>{var i=t.id;return!e.includes(i)})}}addImageToPhotoEditorCanvas(e){var t=BFN.getImageType(e.id);BFN.BfnService.ToJsUrlUploader(e.imageURL,"",!0,t),"unsplash"===t&&BFN.ImageLibraryService.reportUnsplashImageDownload(e.id),[this.imageLibraryModal,this.stockSearchModal].filter(Boolean).map(e=>e.id).filter(BeFunky.getModal).forEach(BeFunky.closeModal)}createMenuImageVOFromTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=new BFN.MenuImageVO;r.createId("computer"),r.imageTexture=e;var a=BFN.MultipleFileUploader.thumbSize,n=e.width/e.height,o=a*(n>1?n:1/n),s=BFN.Util.getThumbTexture(e,o,!1,!0);s.renderClone().destroyGC(!0);var l,h=BFN.Util.isTransparent(s);r.isTransparent=h,r.thumbURL=BFN.TextureUtils.textureToBase64(s,{isTransparent:h}),r.thumbWidth=s.width,r.thumbHeight=s.height,s.destroyGC(!0),h?(l=!0,r.imageTexture.isTransparent=!0):l=r.imageTexture.determineTransparency(),r.indexedDBKey="image__".concat(r.id);var c=e.renderClone();return BFN.TextureUtils.textureToBlob(c,{isTransparent:l}).then(e=>{c.destroyGC(!0),t&&t(e),BFN.IndexedDB.set(r.indexedDBKey,e).catch(e=>{r.indexedDBKey=null,BeFunky.logError("Unable to store blob in IndexedDB",e)})}),i&&BFN.ImageLibraryManager.addImage(r,{cloneObject:!1}),r}addImageToCanvas(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.generateTexture,r=void 0===i||i,a=t.textureReadyCallback,n=t.initialCenterPosition,o=t.isGoodie,s=void 0!==o&&o,l=t.forceLayer,h=void 0!==l&&l,c=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),u=BFN.AppModel.sectionID;if(e.isSVG&&(s=!0),BFN.TransformModel.awaitingDrop=!1,BFN.TransformModel.focusedTransformItem&&!h&&(BFN.TransformModel.targetTransformItem=BFN.TransformModel.focusedTransformItem,BFN.TransformModel.focusedTransformItem=null),BFN.AppModel.viewingCollage&&!h&&!BFN.CollageMakerCanvasPhotoGridModel.freeform&&!a)if(BFN.PhotoGrid.awaitingDrop)if(BFN.PhotoGrid.awaitingDrop=!1,BFN.PhotoGrid.focusedChild)BFN.PhotoGrid.focusedChild.handleDrop(),BFN.PhotoGrid.targetChild=BFN.PhotoGrid.selectedChild,BFN.PhotoGrid.selectedChild=null;else{if(!n)return;var d=BFN.PhotoGrid.getChildUnderPosition(n.x,n.y);if(!d)return;BFN.PhotoGrid.targetChild=d}else if(BFN.PhotoGrid.targetChild||(BFN.PhotoGrid.targetChild=BFN.PhotoGrid.randomEmptyChild),!BFN.PhotoGrid.targetChild)return;if(!r)return p.bind(this)();var m={saveAssetsSectionID:u};function p(){if(a)return a(e.imageTexture);var t;t=(()=>{var t=BFN.TransformModel.targetTransformItem;if(!t||e.isSVG||t.hasDropOptions&&!t.hasDropOptions)if(BFN.AppModel.viewingCollage&&!h&&BFN.PhotoGrid.targetChild){var i=new BFN.UserActionVO;i.eventID="collage_grid_image_added",i.eventObject={cellImageTypes:[e.isSVG?"Vector":"Rasterized"],cellImageSources:[BFN.UserActionManager.getAssetOrigin(e.id)]},i.actionSection="collage",i.actionTimestamp=Date.now(),i.register(),BFN.CollageMakerCanvasPhotoGrid.assignImageToTargetGridChild(e)}else{var r={type:s||e.isSVG?"texture":"frame_texture",texture:e.imageTexture,projectItemAssetID:e.id};s&&(r.isGoodie=!0,r.graphicStyle=e.style),n&&(r.initialCenterPosition=n),c.addedItem=r}else this.replaceTransformItemOnCanvas(t,e)}),BeFunky.showLoadScreen(),BFN.BfnService.storeBlobForMenuImageVO(e,u,function(){BeFunky.hideLoadScreen(),t(...arguments)})}BFN.BfnService.getTexturesForMenuImageVOs([e],()=>{if(!e.imageTexture)return BeFunky.logError("Unable to generate texture for MenuImageVO",e);"unsplash"===BFN.getImageType(e.id)&&BFN.ImageLibraryService.reportUnsplashImageDownload(e.id),p.bind(this)()},m)}replaceTransformItemOnCanvas(e,t){var i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),r=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),a="convert_to_image"+BeFunky.randomString(10),n=["layerName","transformZIndex","transformX","transformY","transformRotation"],o=null,s=null,l=()=>{BFN.TransformStateModel.startBulkTransition(a),o=new BFN.ProjectItemVO,n.forEach(t=>{o.hasOwnProperty(t)&&e.projectItemVO.hasOwnProperty(t)&&(o[t]=e.projectItemVO[t])})},h=()=>{if(o&&s&&BFN.TransformStateModel.batchTransitionID===a){var n=t=>{BFN.TransformStateModel.safeThumbImages.splice(0),BFN.MainUI.rendering=!0,i.transformLayer.selectItem(t),BeFunky.hideLoadScreen(),BFN.MainUI.requestRender();var r=new BFN.UserActionVO;r.eventID="image_layer_added",r.eventObject={imageLayerTypes:["Rasterized"],imageLayerSources:[t.assetOrigin]},r.actionSection=BFN.AppModel.sectionID,r.actionTimestamp=Date.now(),r.transformItem=t,r.register();var a="text"===e.type?"Text":e.isShape?e.basicShapeVO?"Basic Shape":"Vector":"Rasterized",n=new BFN.UserActionVO;n.eventID="image_layer_masked",n.eventObject={imageLayerMaskedTypes:[a],imageLayerMaskedSources:["text"===e.type?"Text":e.assetOrigin]},n.actionSection=BFN.AppModel.sectionID,n.actionTimestamp=Date.now(),n.transformItem=e,n.register()};"texture"===e.type&&e.isShape&&(s.readyCallback=(()=>{BFN.MainUI.addIdleRenderFunction(n)})),BeFunky.showLoadScreen(),BFN.MainUI.rendering=!1,BFN.TransformStateModel.safeBaseTextures.includes(t.imageTexture.baseTexture)||BFN.TransformStateModel.safeBaseTextures.push(t.imageTexture.baseTexture),e.removeItem(),o.type="mask_image",e.projectItemVO.graphicStyle&&(s.graphicStyle=e.projectItemVO.graphicStyle,o.graphicStyle=e.projectItemVO.graphicStyle),o.maskImageOffsetFactorX=.5,o.maskImageOffsetFactorY=.5,o.maskImageTextureScale={x:1,y:1},o.transformScaleX=1,o.transformScaleY=1,o.maskImageMaskFlippedHorizontal=e.projectItemVO.transformFlippedHorizontal||e.projectItemVO.maskImageMaskFlippedHorizontal,o.maskImageMaskFlippedVertical=e.projectItemVO.transformFlippedVertical||e.projectItemVO.maskImageMaskFlippedVertical,s.projectItemVO=o,BFN.TransformModel.selectItemOnAdd=!1,r.addedItem=s,BFN.TransformModel.selectItemOnAdd=!0;var l=BFN.TransformModel.addedTransformItem;e.projectItemVO.layerName&&(l.layerName=e.projectItemVO.layerName),l.updateThumb();var h=new BFN.TransformItemStateVO;h.imageTexture=l.itemContent.texture,h.parent=i.transformLayer,h.maskImageFrameWidth=o.maskImageFrameWidth,h.maskImageFrameHeight=o.maskImageFrameHeight,h.maskImageOffsetFactorX=o.maskImageOffsetFactorX,h.maskImageOffsetFactorY=o.maskImageOffsetFactorY,h.maskImageTextureScale=o.maskImageTextureScale,BFN.ProjectManager.transferProperties(o,h),l.applyTransformItemState(h),l.createTransition("apply_transform_item_state"),l.registerTransition(!0,!1),l.ignoreAccurateBounds=!1,l.updateAccurateBounds(),BFN.TransformStateModel.stopBulkTransition();var c=new BFN.TransformItemTransitionVO;c.id="convert_to_image",c.batchIDPlaceholder=a,c.transformItem="text"===e.type?null:e,c.useTextIcon="text"===e.type,BFN.TransformStateModel.addTransition(c),BFN.TransformStateModel.safeBaseTextures.splice(0),l.readyCallback||n(l)}};if(e.thumbImage&&e.thumbImage.src&&!BFN.TransformStateModel.safeThumbImages.includes(e.thumbImage)&&BFN.TransformStateModel.safeThumbImages.push(e.thumbImage),"frame_texture"===e.type){var c=()=>{e.itemContentMask?e.replaceImage(t.id,t.imageTexture,"replace_image",0,0,!1,null,!0):e.replaceImage(t.id,t.imageTexture)};if(e.isShape||e.itemContentMask)c();else{if(e.isTransparent){return BeFunky.showDialog({body:"replace_or_mask",buttons:[{text:"replace_image",type:"blue",onClick:c},{text:"use_as_mask",type:"blue",onClick:()=>{BeFunky.showLoadScreen(),l(),o.maskImageID=t.id,o.maskImageFrameWidth=e.itemContentW*e.scale.x,o.maskImageFrameHeight=e.itemContentH*e.scale.y,s={type:"frame_texture",texture:t.imageTexture};var i=new PIXI.Texture(e.itemContent.texture.baseTexture);i.frame=e.itemContent.texture.frame;var r=PIXI.RenderTexture.create(Math.round(i.frame.width),Math.round(i.frame.height));r.fillColor(0);var a=new PIXI.Sprite(i);a.pluginName="blend_picture",a.fillColor=16777215,a.intensity=1,a.width=r.width,a.height=r.height,BFN.Stage.render(a,r,!1),a.destroy(!1),BFN.TextureUtils.textureToBlob(r,{isTransparent:!1}).then(e=>{var t=(new BFN.MenuImageVO).createId("alpha_mask");BFN.ProjectService.setLocalAsset("editor","image",t,e).then(()=>{o.maskImageMaskID=t,s.maskTexture=r,h()})})}}],closeOnClickOutside:!0,onClose:()=>{BFN.TransformModel.targetTransformItem=null,BFN.TransformModel.focusedTransformItem=null}})}c()}}else if("texture"===e.type)if(e.isShape){if(l(),o.maskImageID=t.id,o.maskImageMaskID=e.projectItemVO.graphicID,o.maskImageFrameWidth=e.itemContentW*e.scale.x,o.maskImageFrameHeight=e.itemContentH*e.scale.y,s={type:"frame_texture",texture:t.imageTexture,maskTexture:new PIXI.Texture(e.itemContent.texture.baseTexture),newShape:!0},e.basicShapeVO){var u=e.basicShapeVO.clone();-1===u.fill&&-1===u.stroke&&u.setValues({fill:"FFFFFF",fillAlpha:1}),delete s.newShape,s.maskTexture=PIXI.RenderTexture.create(32,32),s.basicShapeVO=u}h()}else if(l(),o.maskImageID=t.id,o.maskImageFrameWidth=e.itemContentW*e.scale.x,o.maskImageFrameHeight=e.itemContentH*e.scale.y,s={type:"frame_texture",texture:t.imageTexture},e.isTransparent){BeFunky.showLoadScreen();var d=PIXI.RenderTexture.create(e.itemContent.texture.baseTexture.width,e.itemContent.texture.baseTexture.height);d.fillColor(0);var m=new PIXI.Sprite(e.itemContent.texture);m.pluginName="blend_picture",m.fillColor=16777215,m.intensity=1,BFN.Stage.render(m,d,!1),m.destroy(!1),BFN.TextureUtils.textureToBlob(d,{isTransparent:!1}).then(e=>{var t=(new BFN.MenuImageVO).createId("alpha_mask");BFN.ProjectService.setLocalAsset("editor","image",t,e).then(()=>{o.maskImageMaskID=t,s.maskTexture=d,h()})})}else h();else if("text"===e.type){if(BFN.FabricManager.isDefaultText(e.iText.text))return;BeFunky.showLoadScreen(),e.getITextMask(r=>{var a=r.boundsRect,n=r.maskTexture;BFN.TextureUtils.textureToBlob(n,{isTransparent:!1,mimeType:"image/jpeg",quality:.5}).then(r=>{var c=(new BFN.MenuImageVO).createId("text_mask");BFN.ProjectService.setLocalAsset("editor","image",c,r).then(()=>{l(),o.maskImageID=t.id,o.maskImageMaskID=c,o.maskImageFrameWidth=a.width,o.maskImageFrameHeight=a.height;var r=[0,1,3,2][(e.flippedHorizontal?1:0)+(e.flippedVertical?2:0)],u=i.transformLayer.toLocal(e.textPolygon[r],e),d=new PIXI.Point(u.x,u.y);e.flippedHorizontal&&(d.x-=Math.cos(o.transformRotation)*a.width,d.y-=Math.sin(o.transformRotation)*a.width),e.flippedVertical&&(d.x-=Math.cos(o.transformRotation+Math.PI/2)*a.height,d.y-=Math.sin(o.transformRotation+Math.PI/2)*a.height);var m=a.x*(e.flippedHorizontal?-1:1),p=a.y*(e.flippedVertical?-1:1),g=Math.sqrt(Math.pow(m,2)+Math.pow(p,2)),f=Math.atan2(p,m);d.x+=Math.cos(o.transformRotation+f)*g,d.y+=Math.sin(o.transformRotation+f)*g,o.transformX=d.x,o.transformY=d.y,s={type:"frame_texture",texture:t.imageTexture,maskTexture:n},h()})})})}o||BFN.TransformStateModel.safeThumbImages.splice(0),BFN.TransformModel.targetTransformItem=null}saveImageAsLayer(e){if(e.isSaved)BeFunky.logError("Sorry, this image is already saved");else if(BFN.BfnService.userLoggedIn)BFN.BfnService.getTexturesForMenuImageVOs([e],()=>{if(!e.imageTexture)return BeFunky.logError("Unable to generate texture for MenuImageVO",e);BFN.UploadSaveShareManager.altSaveTexture=e.imageTexture;var t=e.name||"";BFN.UploadSaveShareManager.setFileName(void 0,"layer",t),BFN.UploadSaveShareManager.handleSaveOrShareImage("save","befunky",()=>{e.isSaved=!0,this.updateImageStore();var t=this.getIndex(e.id);this.sidebar.removeItem(e.id),this.sidebar.addItem(e,t),BeFunky.ImagesService.resetImageData()})});else{var t=()=>{BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,t),BFN.BfnService.userLoggedIn&&this.saveImageAsLayer(e)};BeFunky.confirm("confirm_layer_save_login",{onConfirm:()=>{BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,t),BFN.BfnService.login(),setTimeout(()=>BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,t),1e4)},confirmText:"yes",cancelText:"no"})}}deleteImage(e){var t=BFN.getImageType(e);if(["befunky_photo","befunky_layer"].includes(t)){var i=e.replace("".concat(t,"_"),""),r="befunky_photo"===t;BeFunky.confirm(r?"confirm_delete_befunky_photo":"confirm_delete_befunky_layer",{onConfirm:()=>{BFN.ImageLibraryService.deleteBeFunkyPhoto.bind(BFN.ImageLibraryService)(i,{showLoadScreen:{isCancellable:!1}}).then(()=>{this.removeImage(e);var t=this.imageLibraryModal.getGallery("befunky").gallery;t.images=t.images.filter(t=>{return t.id!==e}),UIMessages.display("deleted"),BeFunky.ImagesService.resetImageData()}).catch(e=>{BeFunky.logError("Unable to delete ".concat(r?"photo":"layer"),e)})},confirmText:"yes",cancelText:"no"})}else BeFunky.logError("Only BeFunky Photos & Layers can be deleted")}modifier(e){return e.replace(/[^0-9a-z-]/gi,"-").replace(/-{2,}/g,"-").replace(/^-|-$/g,"").toLowerCase()}handleImageSelection(e,t){return t?this.addImage(e):this.removeImage(e.id),!0}handleImageLoaded(e){var t=e.menuImageVO,i=(e.file,e.isComplete),r=null,a=null;switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:r=BFN.PhotoEditorCanvasModel,a="editor_main";break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:r=BFN.CollageMakerCanvasModel,a="collage_main";break;case BFN.AppModelViewStates.VIEWING_DESIGNER:r=BFN.DesignerCanvasModel,a="designer_main"}r&&(i?"image_manager"!==UITools.getToolValue(a,"updating_id")&&(UITools.setToolValue(a,"image_manager",!0),UITools.applyTool(a),UITools.setToolValue(a,"image_manager",!1)):t&&this.addImage(t,{updateImageGalleryItem:!1,scrollToBottom:!1}))}set mode(e){e&&["IMAGE_MANAGER","UPLOAD_MENU"].includes(e)?e!==this._mode&&(this.imageLibraryModal&&this.imageLibraryModal.setState({mode:e}),this.stockSearchModal.removeClass("stock-search--mode-".concat(this.modifier(this._mode))),this.stockSearchModal.addClass("stock-search--mode-".concat(this.modifier(e))),this._mode=e):BeFunky.logError("Invalid Image Library Manager mode specified")}get mode(){return this._mode}get bucketBaseTextures(){for(var e=this.sampleMenuImageVOs.concat(this.selectedMenuImageVOs),t=[],i=0;i<e.length;i++){var r=e[i];r.imageTexture&&r.imageTexture.valid&&t.push(r.imageTexture.baseTexture)}return e.splice(0),e=null,t}}function Fh(){var t=e(['<div class="image-gallery graphic-library__results-gallery"></div>']);return Fh=function(){return t},t}function Eh(){var t=e(['\n            <div class="graphics-editors-choice__row">\n                <div class="graphics-editors-choice__row-header">\n                    <p class="graphics-editors-choice__row-heading">','</p>\n                    <button class="button button--link button--tiny graphics-editors-choice__see-all" @click=',">","</button>\n                </div>\n                ","\n            </div>\n        "]);return Eh=function(){return t},t}function Ph(){var t=e(['<div class="graphics-editors-choice">',"</div>"]);return Ph=function(){return t},t}BFN.SingletonQueue.add(()=>{BFN.ImageLibraryManager=new Bh});var Nh=BeFunky.lit,Mh=Nh.html,Dh=Nh.lang,wh=Nh.elem;function kh(e,t,i,r,a){var n=1300,o=r,s=e.map(e=>{e.tagID,e.graphicData;return function(){var e=wh(Fh()),t=BFN.GraphicLibraryManager.handleGraphicSelection.bind(BFN.GraphicLibraryManager);return BFN.UI.imageGallery(e,{imagesPerRow:10,maxWidth:n,isGraphic:!0,imageSelectionHandler:t,isSelected:e=>-1!==BFN.GraphicLibraryManager.getIndex(e),extendItem:i,startNewRowCondition:()=>!1}),e}()});h(a,r);var l=wh(Ph(),e.map((e,i)=>{var r=e.title,a=e.tagID;return Mh(Eh(),Dh(r,"modal"),()=>t({tagID:a,style:o}),Dh("view_all","modal"),s[i])}));return l.updateGalleries=h,l;function h(t,i){o=i,s.forEach((r,a)=>{var o=e[a].graphicData;r.images=o[i].slice(0,Math.round(t/n*10)),r.currentWidth=t})}}function Lh(){var t=e(['\n            <div class="badge plus-badge image-gallery__badge">\n                ',"\n            </div>\n        "]);return Lh=function(){return t},t}function Oh(){var t=e(['<div class="image-gallery graphic-library__results-gallery"></div>)']);return Oh=function(){return t},t}function Rh(){var t=e(['\n            <div class="editors-choice editors-choice--loading">\n                <div><span class="loading-spinner"></span><string>',"</string></div>\n            </div>\n            "]);return Rh=function(){return t},t}function Ah(){var t=e(['\n            <button class="button button--circle button--outline button--white button--icon button--tiny graphic-library__clear-results" @click=',' data-bfntooltip="cancel">\n                ',"\n            </button>\n        "]);return Ah=function(){return t},t}function Vh(){var t=e(['\n            <div class="graphic-library__results-header">\n                <h3 class="graphic-library__results-heading">',"</h3>\n                ","\n            </div>\n        "]);return Vh=function(){return t},t}function Uh(){var t=e(["<button class=",' @click="','">',"</button>"]);return Uh=function(){return t},t}function Gh(){var t=e(['\n            <div class="panel-header panel-header--modal-section graphic-library__tags-header">\n                <h3 class="panel-header__text panel-header__text--modal-section panel-header__text--wide">','</h3>\n            </div>\n            <div class="graphic-library__tags">\n                ',"\n            </div>\n        "]);return Gh=function(){return t},t}function Hh(){var t=e(['\n        <div class="graphic-library__editors-choice-buttons-container">\n            <button\n            class="','" @click=',"\n            >",'\n            </button>\n            <button\n            class="','" @click=',"\n            >","\n            </button>\n        </div>\n        "]);return Hh=function(){return t},t}function zh(){var t=e(['\n        <div class="graphic-library__styles-container">\n            <div class="panel-header">\n                <h3 class="panel-header__text panel-header__text--modal-section panel-header__text--wide">','</h3>\n            </div>\n            <div class="graphic-library__styles">\n                <button class="','" @click=',">",'</button>\n                <button class="','" @click=',">",'</button>\n                <button class="','" @click=',">",'</button>\n                <button class="','" @click=',">","</button>\n            </div\n        </div>\n        "]);return zh=function(){return t},t}function Xh(){var t=e(['<div class="graphics-library__search-autocomplete" style="top: 40px;left: 0px;width: 240px;"></div>']);return Xh=function(){return t},t}function jh(){var t=e(['<input type="search" class="input search-box__input graphics-library__search-input" required>']);return jh=function(){return t},t}function Wh(){var t=e(['\n            <form role="search" class="search-box graphic-library__search-box">\n                ',"\n                ",'\n                <button type="reset" class="button button--icon button--large button--transparent search-box__clear">\n                    ','\n                </button>\n                <button type="submit" class="button button--icon button--large button--blue search-box__submit" @click="','">\n                    ',"\n                </button>\n            </form>\n        "]);return Wh=function(){return t},t}function Yh(){var t=e(['<div class="panel-header"></div>']);return Yh=function(){return t},t}function qh(){var t=e(['\n        <div class="graphic-preview"></div>\n        ','\n        <div class="modal__body graphic-library__body">\n            <div class="graphic-library__left-panel">\n                ','\n                <div class="graphic-library__left-panel-options">\n                    ',"\n                    ","\n                    ",'\n                </div>\n            </div>\n            <div class="graphic-library__right-panel">\n                ','\n                <div class="modal__right-panel-scroller">\n                    ',"\n                </div>\n            </div>\n        </div>\n        "]);return qh=function(){return t},t}function Kh(){var t=e(['<div id="graphic_library" class="modal graphic-library"></div>']);return Kh=function(){return t},t}var Qh=BeFunky.lit,Zh=Qh.html,Jh=Qh.setupState,$h=Qh.render,ec=Qh.lang,tc=Qh.elem,ic=Qh.icon;function rc(e){var i,r,a,n,o,s=tc(Kh()),l=1600,h=1300,c=["abstract_shapes","geometric_shapes","lines","arrows","social_media","badges","wedding","birthday","ribbons","ornaments","floral","travel","music","food","accessories","weddings","birthdays","animals","speech_bubbles","hearts","emojis","businesses","technology","fashion","sports","nature","real_estate","lifestyle","people","education","infographics"].filter(t=>e.includes(t)),u={mode:"EDITORS_CHOICE",placeholderTags:[],editorsChoiceGraphics:{},searchTerm:"",tagName:"",tagID:"editors_choice",lastSearchTerm:"",lastSearchStyle:"",lastSearchPage:"",searchStyle:"all",currentWidth:l},d=(i=tc(Yh()),BeFunky.panelHeader(i,{name:"graphic_library",closeEnabled:!0,modifier:"modal"}),i),m=(r=tc(Oh()),a=BFN.GraphicLibraryManager.handleGraphicSelection.bind(BFN.GraphicLibraryManager),BFN.UI.imageGallery(r,{imagesPerRow:8,maxWidth:h,isGraphic:!0,imageSelectionHandler:a,isSelected:e=>-1!==BFN.GraphicLibraryManager.getIndex(e),extendItem:D}),r),p=t((n=tc(jh()),o=tc(Xh()),n.setLang("search_graphics","modal"),BeFunky.autocomplete(o,{inputElement:n,minValueLength:3,allowEmpty:!0,generateItem:e=>({html:e.length&&"all_items"!==e?BeFunky.LanguageManager.getStringReplacements("search_for",{query:BeFunky.escapeHTML(e)}):BeFunky.LanguageManager.getString("display_all_graphics"),index:0}),options:e.map(e=>({id:e,label:w(e)})),onSelect:e=>M({tagID:e.id,tagName:e.label})}),[n,o]),2),g=p[0],f=p[1],v=null;m.images=[];var y,x=BeFunky.debounce(()=>{$h(function(){return Zh(qh(),d,Zh(Wh(),g,f,ic("global-cancel-icon","icon icon-size-small"),B,ic("global-search-icon","icon icon-global-search-icon")),Zh(Hh(),"button button--list button--all-caps graphic-library__button ".concat("EDITORS_CHOICE"===I.mode?"graphic-library__button--selected":""),P,ec("editors_choice","modal"),"button button--list button--all-caps graphic-library__button ".concat("ALL_GRAPHICS"===I.mode?"graphic-library__button--selected":""),E,ec("browse_all_graphics","modal")),(e="button button--list graphic-library__style graphic-library__style--selected",Zh(zh(),ec("style"),"all"===I.searchStyle?e:"button button--list graphic-library__style",N("all"),ec("all_graphic_styles"),"line"===I.searchStyle?e:"button button--list graphic-library__style",N("line"),ec("outline"),"solid"===I.searchStyle?e:"button button--list graphic-library__style",N("solid"),ec("solid"),"color"===I.searchStyle?e:"button button--list graphic-library__style",N("color"),ec("multicolor"))),Zh(Gh(),ec("popular_tags"),c.map(e=>Zh(Uh(),I.searchTerm===e?"button graphic-library__tag graphic-library__tag--selected":"button graphic-library__tag",function(e){return function(){M({tagID:e,style:I.searchStyle})}}(e),w(e)))),function(){if("NO_RESULTS"===I.mode)return;var e={EDITORS_CHOICE:"editors_choice",SEARCH:["search_results_for",{query:"<strong>".concat(BeFunky.escapeHTML(I.tagName),"</strong>")}],TAG:I.tagName,ALL_GRAPHICS:"all_graphics"},t="SEARCH"===I.mode;e[I.mode]||BeFunky.throwError("Mode not handled!!!",I.mode);return Zh(Vh(),ec(e[I.mode],"modal"),t?Zh(Ah(),F,ic("global-cancel-icon","icon icon-size-tiny")):"")}(),"EDITORS_CHOICE"===I.mode?function(){if(!I.editorsChoiceGraphics.length)return Zh(Rh(),ec("loading","modal"));y?y.updateGalleries(I.currentWidth-300,I.searchStyle):y=kh(I.editorsChoiceGraphics,M,D,I.searchStyle,I.currentWidth-300);return y}():m);var e}(),s)},"raf"),_=t(Jh(u,x),2),I=_[0],T=_[1],b=BeFunky.setupInfiniteScroll(()=>s.querySelector(".modal__right-panel-scroller")),S=b.listenForScroll,C=b.recalculateScrollPosition;return BeFunky.LanguageManager.addLanguageUpdateListener(()=>{y=!1,x()}),Object.assign(s,{open:function(e){BeFunky.openModal(s,{onOpen:()=>{e?M({tagID:e}):"editors_choice"===I.tagID&&P()},onWindowResize:e=>{var t=e.availableWidth;m.currentWidth=h+(t-l),T({currentWidth:t}),C()},size:"xxl"})},selectGalleryItem:function(e){var t=document.getElementById("image_gallery_item--".concat(e));t&&(t.selected=!0)},deselectGalleryItem:function(e){var t=document.getElementById("image_gallery_item--".concat(e));t&&(t.selected=!1)}}),s;function B(e){e&&e.preventDefault(),M({tagName:document.querySelector(".graphics-library__search-input").value.replace(/[`~!@#$%^&*()_|+=?;:'",.<>{}[\]\\\/]/gi," ").replace(/ {2,}/g," ").trim()})}function F(){M({tagID:"all_items"})}function E(){M({tagID:"all_items"})}function P(){!function(){if(I.editorsChoiceGraphics.length)return;BFN.GraphicLibraryService.getEditorsChoiceGraphics().then(e=>{var t=[];Object.keys(e).forEach((i,r)=>{e[i].data.tags.forEach(e=>{var a=e.tag,n=e.title,o=e.items,s={all:[]};0===r?t.push({tagID:a,title:n,graphicData:s}):s=t.find(e=>{var t=e.tagID;return t===a}).graphicData;var l=BFN.GraphicLibraryService.graphicDataToMenuImageVO(o);s[i]=l.shuffle(),s.all=[...s.all,...l.slice(0,4)].shuffle()})}),T({editorsChoiceGraphics:t})})}(),T({mode:"EDITORS_CHOICE",tagID:"editors_choice",lastSearchTerm:"",searchTerm:""}),g.value=""}function N(e){return function(){if("EDITORS_CHOICE"===I.mode)return T({searchStyle:e}),void(y&&y.updateGalleries(I.currentWidth-300,e));M({style:e,tagName:I.searchTerm,tagID:I.searchTerm})}}function M(t){var i=t.tagID,r=void 0===i?"":i,a=t.tagName,n=void 0===a?"":a,o=t.style,s=void 0===o?"all":o,l=t.page,h=void 0===l?1:l;if(r||(r=function(e){return""===e?"all_items":e.trim().replace(/[^a-z0-9\s]/gi,"").split(/\s+/).map(e=>e.toLowerCase()).join("_").replace(/_+/g,"_")}(n)),r=e.includes(r)?r:"",n=w(r)||n,!r&&!n)throw new Error("Invalid tag name or ID");var c=r||n,u=s;if(c||(c="all_items"),!(c===I.lastSearchTerm&&u===I.lastSearchStyle&&h===I.lastSearchPage||c.length<=2)){v&&v.abort();var d="SEARCH";r&&"all_items"!==r&&(d="TAG"),r&&"all_items"===r&&(d="ALL_GRAPHICS"),T({lastSearchTerm:c,lastSearchStyle:u,lastSearchPage:h,searchTerm:c,searchStyle:u,tagName:n,tagID:r,mode:d}),g.value="ALL_GRAPHICS"===I.mode?"":n,1===h&&(m.images=[],m.scrollTop=0);var p=BFN.GraphicLibraryService.getGraphics(c,s,h,100);v=p.request,m.message="",m.isLoading=!0;var f=1===h&&"ALL_GRAPHICS"!==I.mode;p.then(e=>{console.log("Got ".concat(e.length," results for page ").concat(h));var t=h;m.isLoading=!1,m.images=[...m.images,...e],f&&BFN.BfnService.track("GRAPHICS","SEARCH","".concat(s," : ").concat(c));var i=()=>{M({tagID:r,tagName:n,style:s,page:++t})};e.length>=100&&(()=>S(()=>c!==I.lastSearchTerm||s!==I.lastSearchStyle||h!==I.lastSearchPage,i))()}).catch(e=>{if(m.isLoading=!1,"no_results"===e)m.emptyState={icon:"no-results-icon",text:BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:'<strong>"'.concat(BeFunky.escapeHTML(I.searchTerm),'"</strong>')})},f&&BFN.BfnService.track("GRAPHICS","EMPTY_SEARCH","".concat(s," : ").concat(I.searchTerm));else{if("request_failed"===e&&p.request.wasAborted)return;m.message={isError:!0,text:BeFunky.failureReason(e),buttonText:"try_again",buttonAction:()=>M({tagID:r,tagName:n})},T({lastSearchTerm:null})}})}}function D(e,t){if(t.isPlus&&!BFN.BfnService.userIsPlus){var i=tc(Lh(),ic("upgrade-star","icon icon-size-regular"));e.appendChild(i)}}function w(e){return e.split("_").map(function(e,t){if(0===t||e.length>2&&"the"!==e||"my"===e)return e.charAt(0).toUpperCase()+e.slice(1);return e}).join(" ").replace("s Day","'s Day").replace("St ","St. ").replace("Youtube","YouTube")}}class ac{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.selectedGraphics=[],BFN.IndexedDB.get("options__selectedGraphics").then(e=>{Array.isArray(e)&&e.reverse().forEach(e=>this.addGraphic(e,{useTracking:!1}))}).catch(e=>{BeFunky.logError("Unable to fetch previous session's selectedGraphics from IndexedDB",e)}),this.modal=null,document.getElementById("editor_graphic_search").addEventListener("click",()=>this.openModal()),this.sidebar=document.getElementById("graphic_manager"),BFN.UI.graphicManager(this.sidebar),this.isCategoryMenuSetup=!1,this.updateGraphicStore=BeFunky.debounce(this.updateGraphicStore,0)}handleGraphicCategory(){var e=UITools.getToolValue("editor_graphic","updating_id");"add_layer"===e?(BFN.ImageLibraryManager.uploadImages(e=>{var t=e.menuImageVO;t&&BFN.ImageLibraryManager.addImageToCanvas(t,{forceLayer:!0})},{allowMultiple:!1}),BFN.BfnService.track("CREATE","GOODIES","ADD_YOUR_OWN")):BFN.GraphicLibraryManager.openModal(e)}openModal(e){if(this.modal)return this.modal.open(e);BFN.GraphicLibraryService.getTags().then(t=>{this.modal||(this.modal=rc(t)),this.modal.open(e)},e=>BeFunky.logError("Unable to fetch tags before opening Graphic Search modal",e))}addGraphic(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.cloneObject,a=void 0===r||r,n=i.index,o=void 0===n?0:n,s=i.updateImageGalleryItem,l=void 0===s||s;i.useTracking;if(!e.id)throw"MenuImageVO missing id";-1===this.getIndex(e.id)&&(a||e instanceof BFN.MenuImageVO||(a=!0,BeFunky.throwError("MenuImageVO cloning forced on plain object",e)),a?((t=new BFN.MenuImageVO).setObject(e),t.style=e.style):t=e,this.selectedGraphics.splice(o,0,t),e.indexedDBKey&&BFN.ProjectService.setLocalAsset("graphicmanager","image",e.id,void 0,!0),requestAnimationFrame(()=>{this.sidebar.addItem(t,o);var e=this.sidebar.accordion;e.scrollTop=0,e.activeSections.includes("your_graphics")||(e.activeSections=[...e.activeSections,"your_graphics"])}),l&&this.modal&&this.modal.selectGalleryItem(t.id),this.updateGraphicStore())}removeGraphic(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.updateImageGalleryItem,r=void 0===i||i,a=t.usedBaseTextures,n=void 0===a?null:a,o=this.getIndex(e);if(-1!==o){n||(n=BFN.GlobalHistoryModel.getUsedBaseTextures());var s=this.selectedGraphics[o];s.imageTexture&&s.imageTexture.valid&&s.imageTexture.baseTexture&&!n.includes(s.imageTexture.baseTexture)&&(s.imageTexture.destroyGC(!0),s.imageTexture=null),this.selectedGraphics.splice(o,1),BFN.ProjectService.removeLocalAsset("graphicmanager","image",e),requestAnimationFrame(()=>this.sidebar.removeItem(e)),r&&this.modal&&this.modal.deselectGalleryItem(e),this.updateGraphicStore()}}getIndex(e){if(e.startsWith("graphic_"))return this.selectedGraphics.findIndex(t=>t.id===e);BeFunky.throwError("Invalid Graphic MenuImageVO ID: ".concat(e))}getMenuImageVO(e){if(e.startsWith("graphic_"))return this.selectedGraphics.find(t=>t.id===e);BeFunky.throwError("Invalid Graphic MenuImageVO ID: ".concat(e))}updateGraphicStore(){var e=this.selectedGraphics.map(e=>e.getObject());BFN.IndexedDB.set("options__selectedGraphics",e).catch(e=>BeFunky.logError("Unable to update selectedGraphics in IndexedDB",e))}loadTagsAndSetupMenu(){this.isCategoryMenuSetup||(this.isCategoryMenuSetup=!0,BFN.GraphicLibraryService.getTags().catch(e=>BeFunky.logError("Unable to pre-emptively load tags when entering Graphics menu",e)),BFN.GraphicLibraryService.getEditorsChoiceGraphics().catch(e=>BeFunky.logError("Unable to pre-emptively load editors choice graphics when entering Graphics menu",e)))}modifier(e){return e.replace(/[^0-9a-z-]/gi,"-").replace(/-{2,}/g,"-").replace(/^-|-$/g,"").toLowerCase()}handleGraphicSelection(e,t){return t&&e.isPlus&&!BFN.BfnService.userIsPlus?(BFN.BfnService.upgrade("GOODIES","".concat(e.trackingID,"_UPGRADE")),BFN.UserActionManager.addUpgradeAction(["Add Plus Graphic"],!1),!1):(t?this.addGraphic(e,{updateImageGalleryItem:!1}):this.removeGraphic(e.id,{updateImageGalleryItem:!1}),!0)}}BFN.SingletonQueue.add(()=>{BFN.GraphicLibraryManager=new ac});class nc extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("AccountManager Init"),this.initDefaultValues()}initDefaultValues(){this.welcomed=!1,this.accountMenu=document.getElementById("account_menu"),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged.bind(this))}handleAccountAction(){var e=UITools.getToolVO("user_account");if(e)switch(e.updating_id){case"upgrade":BFN.BfnService.upgrade("GLOBALMENU",void 0,"top_nav_bar"),BFN.UserActionManager.addUpgradeAction(["Top Nav Bar"]);break;case"sign_in":BFN.BfnService.login();break;case"sign_up":BFN.BfnService.register();break;case"logout":BFN.BfnService.signOut();break;case"settings":BeFunky.openModal("user_settings_menu",{size:"extra-small"});break;case"feedback":this.accountMenu.showFeedbackForm()}}handleUserDataChanged(e){var t=BFN.userVo;if(BFN.BfnService.userLoggedIn?(t.pl?(this.accountMenu.accountMode="plus_user",BFN.applyCancelMenu.upgradeMode=!1):(this.accountMenu.accountMode="free_user",BFN.applyCancelMenu.upgradeMode=!0),this.welcomed||(this.welcomed=!0,setTimeout(()=>{BeFunky.waitUntil({condition:()=>BeFunky.LanguageManager.isTranslated("welcome_user"),onSuccess:()=>{requestAnimationFrame(()=>{var e=BeFunky.LanguageManager.getStringReplacements("welcome_user",{user:t.username||""});UIMessages.display(e)})},onTimeout:()=>{}})},333))):(this.accountMenu.accountMode="non_user",BFN.applyCancelMenu.upgradeMode=!0),BFN.userVo&&BFN.userVo.language){var i=BFN.userVo.language;BeFunky.LanguageManager.setLanguage(i,["app"]),BFN.SettingsManager.remoteSettings.language=i}}}BFN.SingletonQueue.add(()=>{BFN.AccountManager=new nc});var oc,sc=He(function(e){!function(){function t(e,t,i){return e.call.apply(e.bind,arguments)}function i(e,t,i){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function r(e,a,n){return(r=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?t:i).apply(null,arguments)}var a=Date.now||function(){return+new Date};function n(e,t){this.a=e,this.o=t||e,this.c=this.o.document}var o=!!window.FontFace;function s(e,t,i,r){if(t=e.c.createElement(t),i)for(var a in i)i.hasOwnProperty(a)&&("style"==a?t.style.cssText=i[a]:t.setAttribute(a,i[a]));return r&&t.appendChild(e.c.createTextNode(r)),t}function l(e,t,i){(e=e.c.getElementsByTagName(t)[0])||(e=document.documentElement),e.insertBefore(i,e.lastChild)}function h(e){e.parentNode&&e.parentNode.removeChild(e)}function c(e,t,i){t=t||[],i=i||[];for(var r=e.className.split(/\s+/),a=0;a<t.length;a+=1){for(var n=!1,o=0;o<r.length;o+=1)if(t[a]===r[o]){n=!0;break}n||r.push(t[a])}for(t=[],a=0;a<r.length;a+=1){for(n=!1,o=0;o<i.length;o+=1)if(r[a]===i[o]){n=!0;break}n||t.push(r[a])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function u(e,t){for(var i=e.className.split(/\s+/),r=0,a=i.length;r<a;r++)if(i[r]==t)return!0;return!1}function d(e,t,i){function r(){c&&a&&n&&(c(h),c=null)}t=s(e,"link",{rel:"stylesheet",href:t,media:"all"});var a=!1,n=!0,h=null,c=i||null;o?(t.onload=function(){a=!0,r()},t.onerror=function(){a=!0,h=Error("Stylesheet failed to load"),r()}):setTimeout(function(){a=!0,r()},0),l(e,"head",t)}function m(e,t,i,r){var a=e.c.getElementsByTagName("head")[0];if(a){var n=s(e,"script",{src:t}),o=!1;return n.onload=n.onreadystatechange=function(){o||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(o=!0,i&&i(null),n.onload=n.onreadystatechange=null,"HEAD"==n.parentNode.tagName&&a.removeChild(n))},a.appendChild(n),setTimeout(function(){o||(o=!0,i&&i(Error("Script load timeout")))},r||5e3),n}return null}function p(){this.a=0,this.c=null}function g(e){return e.a++,function(){e.a--,v(e)}}function f(e,t){e.c=t,v(e)}function v(e){0==e.a&&e.c&&(e.c(),e.c=null)}function y(e){this.a=e||"-"}function x(e,t){this.c=e,this.f=4,this.a="n";var i=(t||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function _(e){var t=[];e=e.split(/,\s*/);for(var i=0;i<e.length;i++){var r=e[i].replace(/['"]/g,"");-1!=r.indexOf(" ")||/^\d/.test(r)?t.push("'"+r+"'"):t.push(r)}return t.join(",")}function I(e){return e.a+e.f}function T(e){var t="normal";return"o"===e.a?t="oblique":"i"===e.a&&(t="italic"),t}function b(e){var t=4,i="n",r=null;return e&&((r=e.match(/(normal|oblique|italic)/i))&&r[1]&&(i=r[1].substr(0,1).toLowerCase()),(r=e.match(/([1-9]00|normal|bold)/i))&&r[1]&&(/bold/i.test(r[1])?t=7:/[1-9]00/.test(r[1])&&(t=parseInt(r[1].substr(0,1),10)))),i+t}function S(e,t){this.c=e,this.f=e.o.document.documentElement,this.h=t,this.a=new y("-"),this.j=!1!==t.events,this.g=!1!==t.classes}function C(e){if(e.g){var t=u(e.f,e.a.c("wf","active")),i=[],r=[e.a.c("wf","loading")];t||i.push(e.a.c("wf","inactive")),c(e.f,i,r)}B(e,"inactive")}function B(e,t,i){e.j&&e.h[t]&&(i?e.h[t](i.c,I(i)):e.h[t]())}function F(){this.c={}}function E(e,t){this.c=e,this.f=t,this.a=s(this.c,"span",{"aria-hidden":"true"},this.f)}function P(e){l(e.c,"body",e.a)}function N(e){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+_(e.c)+";font-style:"+T(e)+";font-weight:"+e.f+"00;"}function M(e,t,i,r,a,n){this.g=e,this.j=t,this.a=r,this.c=i,this.f=a||3e3,this.h=n||void 0}function D(e,t,i,r,a,n,o){this.v=e,this.B=t,this.c=i,this.a=r,this.s=o||"BESbswy",this.f={},this.w=a||3e3,this.u=n||null,this.m=this.j=this.h=this.g=null,this.g=new E(this.c,this.s),this.h=new E(this.c,this.s),this.j=new E(this.c,this.s),this.m=new E(this.c,this.s),e=N(e=new x(this.a.c+",serif",I(this.a))),this.g.a.style.cssText=e,e=N(e=new x(this.a.c+",sans-serif",I(this.a))),this.h.a.style.cssText=e,e=N(e=new x("serif",I(this.a))),this.j.a.style.cssText=e,e=N(e=new x("sans-serif",I(this.a))),this.m.a.style.cssText=e,P(this.g),P(this.h),P(this.j),P(this.m)}y.prototype.c=function(e){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.a)},M.prototype.start=function(){var e=this.c.o.document,t=this,i=a(),r=new Promise(function(r,n){!function o(){a()-i>=t.f?n():e.fonts.load(function(e){return T(e)+" "+e.f+"00 300px "+_(e.c)}(t.a),t.h).then(function(e){1<=e.length?r():setTimeout(o,25)},function(){n()})}()}),n=null,o=new Promise(function(e,i){n=setTimeout(i,t.f)});Promise.race([o,r]).then(function(){n&&(clearTimeout(n),n=null),t.g(t.a)},function(){t.j(t.a)})};var w={D:"serif",C:"sans-serif"},k=null;function L(){if(null===k){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);k=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))}return k}function O(e,t,i){for(var r in w)if(w.hasOwnProperty(r)&&t===e.f[w[r]]&&i===e.f[w[r]])return!0;return!1}function R(e){var t,i=e.g.a.offsetWidth,n=e.h.a.offsetWidth;(t=i===e.f.serif&&n===e.f["sans-serif"])||(t=L()&&O(e,i,n)),t?a()-e.A>=e.w?L()&&O(e,i,n)&&(null===e.u||e.u.hasOwnProperty(e.a.c))?A(e,e.v):A(e,e.B):function(e){setTimeout(r(function(){R(this)},e),50)}(e):A(e,e.v)}function A(e,t){setTimeout(r(function(){h(this.g.a),h(this.h.a),h(this.j.a),h(this.m.a),t(this.a)},e),0)}function V(e,t,i){this.c=e,this.a=t,this.f=0,this.m=this.j=!1,this.s=i}D.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=a(),R(this)};var U=null;function G(e){0==--e.f&&e.j&&(e.m?((e=e.a).g&&c(e.f,[e.a.c("wf","active")],[e.a.c("wf","loading"),e.a.c("wf","inactive")]),B(e,"active")):C(e.a))}function H(e){this.j=e,this.a=new F,this.h=0,this.f=this.g=!0}function z(e,t,i,a,n){var o=0==--e.h;(e.f||e.g)&&setTimeout(function(){var e=n||null,s=a||{};if(0===i.length&&o)C(t.a);else{t.f+=i.length,o&&(t.j=o);var l,h=[];for(l=0;l<i.length;l++){var u=i[l],d=s[u.c],m=t.a,p=u;if(m.g&&c(m.f,[m.a.c("wf",p.c,I(p).toString(),"loading")]),B(m,"fontloading",p),m=null,null===U)if(window.FontFace){p=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var g=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);U=p?42<parseInt(p[1],10):!g}else U=!1;m=U?new M(r(t.g,t),r(t.h,t),t.c,u,t.s,d):new D(r(t.g,t),r(t.h,t),t.c,u,t.s,e,d),h.push(m)}for(l=0;l<h.length;l++)h[l].start()}},0)}function X(e,t){this.c=e,this.a=t}function j(e,t){this.c=e,this.a=t}function W(e,t){this.c=e||Y,this.a=[],this.f=[],this.g=t||""}V.prototype.g=function(e){var t=this.a;t.g&&c(t.f,[t.a.c("wf",e.c,I(e).toString(),"active")],[t.a.c("wf",e.c,I(e).toString(),"loading"),t.a.c("wf",e.c,I(e).toString(),"inactive")]),B(t,"fontactive",e),this.m=!0,G(this)},V.prototype.h=function(e){var t=this.a;if(t.g){var i=u(t.f,t.a.c("wf",e.c,I(e).toString(),"active")),r=[],a=[t.a.c("wf",e.c,I(e).toString(),"loading")];i||r.push(t.a.c("wf",e.c,I(e).toString(),"inactive")),c(t.f,r,a)}B(t,"fontinactive",e),G(this)},H.prototype.load=function(e){this.c=new n(this.j,e.context||this.j),this.g=!1!==e.events,this.f=!1!==e.classes,function(e,t,i){var r=[],a=i.timeout;!function(e){e.g&&c(e.f,[e.a.c("wf","loading")]),B(e,"loading")}(t);var r=function(e,t,i){var r,a=[];for(r in t)if(t.hasOwnProperty(r)){var n=e.c[r];n&&a.push(n(t[r],i))}return a}(e.a,i,e.c),n=new V(e.c,t,a);for(e.h=r.length,t=0,i=r.length;t<i;t++)r[t].load(function(t,i,r){z(e,n,t,i,r)})}(this,new S(this.c,e),e)},X.prototype.load=function(e){var t=this,i=t.a.projectId,r=t.a.version;if(i){var a=t.c.o;m(this.c,(t.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(r?"?v="+r:""),function(r){r?e([]):(a["__MonotypeConfiguration__"+i]=function(){return t.a},function t(){if(a["__mti_fntLst"+i]){var r,n=a["__mti_fntLst"+i](),o=[];if(n)for(var s=0;s<n.length;s++){var l=n[s].fontfamily;null!=n[s].fontStyle&&null!=n[s].fontWeight?(r=n[s].fontStyle+n[s].fontWeight,o.push(new x(l,r))):o.push(new x(l))}e(o)}else setTimeout(function(){t()},50)}())}).id="__MonotypeAPIScript__"+i}else e([])},j.prototype.load=function(e){var t,i,r=this.a.urls||[],a=this.a.families||[],n=this.a.testStrings||{},o=new p;for(t=0,i=r.length;t<i;t++)d(this.c,r[t],g(o));var s=[];for(t=0,i=a.length;t<i;t++)if((r=a[t].split(":"))[1])for(var l=r[1].split(","),h=0;h<l.length;h+=1)s.push(new x(r[0],l[h]));else s.push(new x(r[0]));f(o,function(){e(s,n)})};var Y="https://fonts.googleapis.com/css";function q(e){this.f=e,this.a=[],this.c={}}var K={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Q={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Z={i:"i",italic:"i",n:"n",normal:"n"},J=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function $(e,t){this.c=e,this.a=t}var ee={Arimo:!0,Cousine:!0,Tinos:!0};function te(e,t){this.c=e,this.a=t}function ie(e,t){this.c=e,this.f=t,this.a=[]}$.prototype.load=function(e){var t=new p,i=this.c,r=new W(this.a.api,this.a.text),a=this.a.families;!function(e,t){for(var i=t.length,r=0;r<i;r++){var a=t[r].split(":");3==a.length&&e.f.push(a.pop());var n="";2==a.length&&""!=a[1]&&(n=":"),e.a.push(a.join(n))}}(r,a);var n=new q(a);!function(e){for(var t=e.f.length,i=0;i<t;i++){var r=e.f[i].split(":"),a=r[0].replace(/\+/g," "),n=["n4"];if(2<=r.length){var o;if(o=[],s=r[1])for(var s,l=(s=s.split(",")).length,h=0;h<l;h++){var c;if((c=s[h]).match(/^[\w-]+$/))if(null==(d=J.exec(c.toLowerCase())))c="";else{if(c=null==(c=d[2])||""==c?"n":Z[c],null==(d=d[1])||""==d)d="4";else var u=Q[d],d=u||(isNaN(d)?"4":d.substr(0,1));c=[c,d].join("")}else c="";c&&o.push(c)}0<o.length&&(n=o),3==r.length&&(o=[],0<(r=(r=r[2])?r.split(","):o).length&&(r=K[r[0]])&&(e.c[a]=r))}for(e.c[a]||(r=K[a])&&(e.c[a]=r),r=0;r<n.length;r+=1)e.a.push(new x(a,n[r]))}}(n),d(i,function(e){if(0==e.a.length)throw Error("No fonts to load!");if(-1!=e.c.indexOf("kit="))return e.c;for(var t=e.a.length,i=[],r=0;r<t;r++)i.push(e.a[r].replace(/ /g,"+"));return t=e.c+"?family="+i.join("%7C"),0<e.f.length&&(t+="&subset="+e.f.join(",")),0<e.g.length&&(t+="&text="+encodeURIComponent(e.g)),t}(r),g(t)),f(t,function(){e(n.a,n.c,ee)})},te.prototype.load=function(e){var t=this.a.id,i=this.c.o;t?m(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",function(t){if(t)e([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){t=i.Typekit.config.fn;for(var r=[],a=0;a<t.length;a+=2)for(var n=t[a],o=t[a+1],s=0;s<o.length;s++)r.push(new x(n,o[s]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(e){}e(r)}},2e3):e([])},ie.prototype.load=function(e){var t=this.f.id,i=this.c.o,r=this;t?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[t]=function(t,i){for(var a=0,n=i.fonts.length;a<n;++a){var o=i.fonts[a];r.a.push(new x(o.name,b("font-weight:"+o.weight+";font-style:"+o.style)))}e(r.a)},m(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(e){return e.o.location.hostname||e.a.location.hostname}(this.c)+"/"+t+".js",function(t){t&&e([])})):e([])};var re=new H(window);re.a.c.custom=function(e,t){return new j(t,e)},re.a.c.fontdeck=function(e,t){return new ie(t,e)},re.a.c.monotype=function(e,t){return new X(t,e)},re.a.c.typekit=function(e,t){return new te(t,e)},re.a.c.google=function(e,t){return new $(t,e)};var ae={load:r(re.load,re)};e.exports?e.exports=ae:(window.WebFont=ae,window.WebFontConfig&&re.load(window.WebFontConfig))}()}),lc=He(function(e,t){e.exports=function(e){var t={};function i(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=i(1),n=i(7),o=n.get,s=(n.deepValue,n.isArray),l=function(){function e(t,i){var r=i.location,a=void 0===r?0:r,n=i.distance,s=void 0===n?100:n,l=i.threshold,h=void 0===l?.6:l,c=i.maxPatternLength,u=void 0===c?32:c,d=i.caseSensitive,m=void 0!==d&&d,p=i.tokenSeparator,g=void 0===p?/ +/g:p,f=i.findAllMatches,v=void 0!==f&&f,y=i.minMatchCharLength,x=void 0===y?1:y,_=i.id,I=void 0===_?null:_,T=i.keys,b=void 0===T?[]:T,S=i.shouldSort,C=void 0===S||S,B=i.getFn,F=void 0===B?o:B,E=i.sortFn,P=void 0===E?function(e,t){return e.score-t.score}:E,N=i.tokenize,M=void 0!==N&&N,D=i.matchAllTokens,w=void 0!==D&&D,k=i.includeMatches,L=void 0!==k&&k,O=i.includeScore,R=void 0!==O&&O,A=i.verbose,V=void 0!==A&&A;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:a,distance:s,threshold:h,maxPatternLength:u,isCaseSensitive:m,tokenSeparator:g,findAllMatches:v,minMatchCharLength:x,id:I,keys:b,includeMatches:L,includeScore:R,shouldSort:C,getFn:F,sortFn:P,verbose:V,tokenize:M,matchAllTokens:w},this.setCollection(t),this._processKeys(b)}var t,i;return t=e,(i=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,i=e.length;t<i;t+=1){var r=e[t];this._keyWeights[r]=1,this._keyNames.push(r)}else{for(var a=0,n=0,o=e.length;n<o;n+=1){var s=e[n];if(!s.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var l=s.name;if(this._keyNames.push(l),!s.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var h=s.weight;if(h<0||h>1)throw new Error('"weight" property in key must bein the range of [0, 1)');this._keyWeights[l]=h,a+=h}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var i=this._prepareSearchers(e),r=i.tokenSearchers,a=i.fullSearcher,n=this._search(r,a);return this._computeScore(n),this.options.shouldSort&&this._sort(n),t.limit&&"number"==typeof t.limit&&(n=n.slice(0,t.limit)),this._format(n)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var i=e.split(this.options.tokenSeparator),r=0,n=i.length;r<n;r+=1)t.push(new a(i[r],this.options));return{tokenSearchers:t,fullSearcher:new a(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,i=this.list,r={},a=[];if("string"==typeof i[0]){for(var n=0,o=i.length;n<o;n+=1)this._analyze({key:"",value:i[n],record:n,index:n},{resultMap:r,results:a,tokenSearchers:e,fullSearcher:t});return a}for(var s=0,l=i.length;s<l;s+=1)for(var h=i[s],c=0,u=this._keyNames.length;c<u;c+=1){var d=this._keyNames[c];this._analyze({key:d,value:this.options.getFn(h,d),record:h,index:s},{resultMap:r,results:a,tokenSearchers:e,fullSearcher:t})}return a}},{key:"_analyze",value:function(e,t){var i=this,r=e.key,a=e.arrayIndex,n=void 0===a?-1:a,o=e.value,l=e.record,h=e.index,c=t.tokenSearchers,u=void 0===c?[]:c,d=t.fullSearcher,m=t.resultMap,p=void 0===m?{}:m,g=t.results,f=void 0===g?[]:g;!function e(t,a,n,o){if(null!=a)if("string"==typeof a){var l=!1,h=-1,c=0;i._log("\nKey: ".concat(""===r?"--":r));var m=d.search(a);if(i._log('Full text: "'.concat(a,'", score: ').concat(m.score)),i.options.tokenize){for(var g=a.split(i.options.tokenSeparator),v=g.length,y=[],x=0,_=u.length;x<_;x+=1){var I=u[x];i._log('\nPattern: "'.concat(I.pattern,'"'));for(var T=!1,b=0;b<v;b+=1){var S=g[b],C=I.search(S),B={};C.isMatch?(B[S]=C.score,l=!0,T=!0,y.push(C.score)):(B[S]=1,i.options.matchAllTokens||y.push(1)),i._log('Token: "'.concat(S,'", score: ').concat(B[S]))}T&&(c+=1)}h=y[0];for(var F=y.length,E=1;E<F;E+=1)h+=y[E];h/=F,i._log("Token score average:",h)}var P=m.score;h>-1&&(P=(P+h)/2),i._log("Score average:",P);var N=!i.options.tokenize||!i.options.matchAllTokens||c>=u.length;if(i._log("\nCheck Matches: ".concat(N)),(l||m.isMatch)&&N){var M={key:r,arrayIndex:t,value:a,score:P};i.options.includeMatches&&(M.matchedIndices=m.matchedIndices);var D=p[o];D?D.output.push(M):(p[o]={item:n,output:[M]},f.push(p[o]))}}else if(s(a))for(var w=0,k=a.length;w<k;w+=1)e(w,a[w],n,o)}(n,o,l,h)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,i=!!Object.keys(t).length,r=0,a=e.length;r<a;r+=1){for(var n=e[r],o=n.output,s=o.length,l=1,h=0;h<s;h+=1){var c=o[h],u=c.key,d=i?t[u]:1,m=0===c.score&&t&&t[u]>0?Number.EPSILON:c.score;l*=Math.pow(m,d)}n.score=l,this._log(n)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var i=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,function(e,t){if("object"===r(t)&&null!==t){if(-1!==i.indexOf(t))return;i.push(t)}return t},2)),i=null}var a=[];this.options.includeMatches&&a.push(function(e,t){var i=e.output;t.matches=[];for(var r=0,a=i.length;r<a;r+=1){var n=i[r];if(0!==n.matchedIndices.length){var o={indices:n.matchedIndices,value:n.value};n.key&&(o.key=n.key),n.hasOwnProperty("arrayIndex")&&n.arrayIndex>-1&&(o.arrayIndex=n.arrayIndex),t.matches.push(o)}}}),this.options.includeScore&&a.push(function(e,t){t.score=e.score});for(var n=0,o=e.length;n<o;n+=1){var s=e[n];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),a.length){for(var l={item:s.item},h=0,c=a.length;h<c;h+=1)a[h](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&function(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,i),e}();e.exports=l},function(e,t,i){var r=i(2),a=i(3),n=i(6),o=function(){function e(t,i){var r=i.location,a=void 0===r?0:r,o=i.distance,s=void 0===o?100:o,l=i.threshold,h=void 0===l?.6:l,c=i.maxPatternLength,u=void 0===c?32:c,d=i.isCaseSensitive,m=void 0!==d&&d,p=i.tokenSeparator,g=void 0===p?/ +/g:p,f=i.findAllMatches,v=void 0!==f&&f,y=i.minMatchCharLength,x=void 0===y?1:y,_=i.includeMatches,I=void 0!==_&&_;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:a,distance:s,threshold:h,maxPatternLength:u,isCaseSensitive:m,tokenSeparator:g,findAllMatches:v,includeMatches:I,minMatchCharLength:x},this.pattern=m?t:t.toLowerCase(),this.pattern.length<=u&&(this.patternAlphabet=n(this.pattern))}var t,i;return t=e,(i=[{key:"search",value:function(e){var t=this.options,i=t.isCaseSensitive,n=t.includeMatches;if(i||(e=e.toLowerCase()),this.pattern===e){var o={isMatch:!0,score:0};return n&&(o.matchedIndices=[[0,e.length-1]]),o}var s=this.options,l=s.maxPatternLength,h=s.tokenSeparator;if(this.pattern.length>l)return r(e,this.pattern,h);var c=this.options,u=c.location,d=c.distance,m=c.threshold,p=c.findAllMatches,g=c.minMatchCharLength;return a(e,this.pattern,this.patternAlphabet,{location:u,distance:d,threshold:m,findAllMatches:p,minMatchCharLength:g,includeMatches:n})}}])&&function(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,i),e}();e.exports=o},function(e,t){var i=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,a=new RegExp(t.replace(i,"\\$&").replace(r,"|")),n=e.match(a),o=!!n,s=[];if(o)for(var l=0,h=n.length;l<h;l+=1){var c=n[l];s.push([e.indexOf(c),c.length-1])}return{score:o?.5:1,isMatch:o,matchedIndices:s}}},function(e,t,i){var r=i(4),a=i(5);e.exports=function(e,t,i,n){for(var o=n.location,s=void 0===o?0:o,l=n.distance,h=void 0===l?100:l,c=n.threshold,u=void 0===c?.6:c,d=n.findAllMatches,m=void 0!==d&&d,p=n.minMatchCharLength,g=void 0===p?1:p,f=n.includeMatches,v=void 0!==f&&f,y=s,x=e.length,_=u,I=e.indexOf(t,y),T=t.length,b=[],S=0;S<x;S+=1)b[S]=0;if(-1!==I){var C=r(t,{errors:0,currentLocation:I,expectedLocation:y,distance:h});if(_=Math.min(C,_),-1!==(I=e.lastIndexOf(t,y+T))){var B=r(t,{errors:0,currentLocation:I,expectedLocation:y,distance:h});_=Math.min(B,_)}}I=-1;for(var F=[],E=1,P=T+x,N=1<<(T<=31?T-1:30),M=0;M<T;M+=1){for(var D=0,w=P;D<w;)r(t,{errors:M,currentLocation:y+w,expectedLocation:y,distance:h})<=_?D=w:P=w,w=Math.floor((P-D)/2+D);P=w;var k=Math.max(1,y-w+1),L=m?x:Math.min(y+w,x)+T,O=Array(L+2);O[L+1]=(1<<M)-1;for(var R=L;R>=k;R-=1){var A=R-1,V=i[e.charAt(A)];if(V&&(b[A]=1),O[R]=(O[R+1]<<1|1)&V,0!==M&&(O[R]|=(F[R+1]|F[R])<<1|1|F[R+1]),O[R]&N&&(E=r(t,{errors:M,currentLocation:A,expectedLocation:y,distance:h}))<=_){if(_=E,(I=A)<=y)break;k=Math.max(1,2*y-I)}}if(r(t,{errors:M+1,currentLocation:y,expectedLocation:y,distance:h})>_)break;F=O}var U={isMatch:I>=0,score:0===E?.001:E};return v&&(U.matchedIndices=a(b,g)),U}},function(e,t){e.exports=function(e,t){var i=t.errors,r=void 0===i?0:i,a=t.currentLocation,n=void 0===a?0:a,o=t.expectedLocation,s=void 0===o?0:o,l=t.distance,h=void 0===l?100:l,c=r/e.length,u=Math.abs(s-n);return h?c+u/h:u?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=[],r=-1,a=-1,n=0,o=e.length;n<o;n+=1){var s=e[n];s&&-1===r?r=n:s||-1===r||((a=n-1)-r+1>=t&&i.push([r,a]),r=-1)}return e[n-1]&&n-r>=t&&i.push([r,n-1]),i}},function(e,t){e.exports=function(e){for(var t={},i=e.length,r=0;r<i;r+=1)t[e.charAt(r)]=0;for(var a=0;a<i;a+=1)t[e.charAt(a)]|=1<<i-a-1;return t}},function(e,t){var i=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},r=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},a=function(e){return"string"==typeof e},n=function(e){return"number"==typeof e};e.exports={get:function(e,t){var o=[];return function e(t,s){if(s){var l=s.indexOf("."),h=s,c=null;-1!==l&&(h=s.slice(0,l),c=s.slice(l+1));var u=t[h];if(null!=u)if(c||!a(u)&&!n(u))if(i(u))for(var d=0,m=u.length;d<m;d+=1)e(u[d],c);else c&&e(u,c);else o.push(r(u))}else o.push(t)}(e,t),o},isArray:i,isString:a,isNum:n,toString:r}}])}),hc=(oc=lc)&&oc.__esModule&&Object.prototype.hasOwnProperty.call(oc,"default")?oc.default:oc;lc.Fuse;function cc(){var t=e(['<div class="font-menu__weights-list">',"</div>"]);return cc=function(){return t},t}function uc(){var t=e(['<div class="font-menu__weights"></div>']);return uc=function(){return t},t}function dc(){var t=e(["<div></div>"]);return dc=function(){return t},t}function mc(){var t=e(['<div class="panel-header"></div>']);return mc=function(){return t},t}function pc(){var t=e(["<input @focus="," @blur="," @keyup="," @change=",' class="filter-box__input input" type="search">']);return pc=function(){return t},t}function gc(){var t=e(['<div class="font-menu__not-found">\n            ',"\n            <p>","</p>\n        </div>"]);return gc=function(){return t},t}function fc(){var t=e(['<a href="https://support.befunky.com/hc/en-us/articles/360001571631" target="_blank" rel="noopener">',"</a>"]);return fc=function(){return t},t}function vc(){var t=e(['<div class="','" style="','" @click=',' tabindex="0">',"</div>"]);return vc=function(){return t},t}function yc(){var t=e(['\n        <li class="','" style="','" data-font="','" .isRecent=',' tabindex="0">\n            <string>',"</string>\n            ","\n            ",'\n            <button class="button button--icon font-menu__favorite-button" data-bfntooltip=',">\n                ","\n            </button>\n            ","\n        </li>"]);return yc=function(){return t},t}function xc(){var t=e(['<button class="button button--link button--small" style=',">","</button>"]);return xc=function(){return t},t}function _c(){var t=e(['<span class="loading-spinner"></span>']);return _c=function(){return t},t}function Ic(){var t=e(['\n        <ul class="font-menu__list font-menu__list--search" @click='," @mouseover=",">\n            ","\n        </ul>"]);return Ic=function(){return t},t}function Tc(){var t=e(['\n        <h3 class="font-menu__heading">','</h3>\n        <ul class="font-menu__list font-menu__list--favorites" @click='," @mouseover=",">\n            ","\n        </ul>"]);return Tc=function(){return t},t}function bc(){var t=e(['\n        <h3 class="font-menu__heading">','</h3>\n        <ul class="font-menu__list font-menu__list--recent" @click='," @mouseover=",">\n            ","\n        </ul>"]);return bc=function(){return t},t}function Sc(){var t=e(["\n        ",'\n        <h3 class="font-menu__heading">','</h3>\n        <ul class="font-menu__list font-menu__list--all" @click='," @mouseover=",">\n            ","\n        </ul>\n        "]);return Sc=function(){return t},t}function Cc(){var t=e(['\n                    <button class="button button--icon button--transparent filter-box__clear" @click=',">\n                        ","\n                    </button>"]);return Cc=function(){return t},t}function Bc(){var t=e(["\n            ","\n            ",'\n            <div class="font-menu__header">\n                <div class=',">\n                    ","\n                    ","\n                    ","\n                </div>\n                <button @click=",'\n                    class="','"\n                    data-bfntooltip=',"\n                >\n                    ","\n                </button>\n                <button\n                    @click=",' class="font-menu__tab button button--icon button--outline"\n                    data-bfntooltip="add_fonts"\n                >\n                    ',"\n                </button>\n            </div>\n            ","\n            ","\n            ","\n            ","\n        "]);return Bc=function(){return t},t}function Fc(){var t=e(['<div class="font-menu focus-trap"></div>']);return Fc=function(){return t},t}var Ec=BeFunky.lit,Pc=Ec.html,Nc=Ec.setupState,Mc=Ec.render,Dc=Ec.appLang,wc=Ec.icon,kc=Ec.elem;function Lc(e,i){var r,a=i.onFontSelection,n=i.onRecentFontsChange,o=i.onFavoriteFontsChange,s=i.isFontLoaded,l=i.loadFont,h=i.openFontManager,u=i.testNewSystemFont,m=kc(Fc()),p=null,g=BeFunky.debounce(()=>{!1!==r&&Mc(function(){return requestAnimationFrame(U),Pc(Bc(),B,F,"font-menu__search filter-box ".concat(v.searchInput?"":"filter-box--empty"),wc("global-search-icon","icon icon-size-medium filter-box__icon"),C,v.searchInput?Pc(Cc(),A,wc("global-cancel-icon","icon icon-size-small")):"",R,"font-menu__tab button button--icon ".concat("FAVORITES"===v.mode?"button--grey-2":"button--outline"),"FAVORITES"===v.mode?"show_all_fonts":"show_favorites",wc("favorite-star-fill"),h,wc("zoom-plus-icon","icon icon-size-medium"),"ALL"===v.mode?(i=v.recent.map(e=>v.fonts.find(t=>{var i=t.name;return i===e})).filter(Boolean),Pc(Sc(),i.length?Pc(bc(),Dc("recent_fonts"),L,k,i.map(e=>D(e,!0))):"",Dc("all_fonts"),L,k,v.fonts.map(e=>D(e,!1)))):"","FAVORITES"===v.mode?(t=v.fonts.filter(e=>{var t=e.name;return v.favorites.includes(t)}),Pc(Tc(),Dc("favorites"),L,k,t.length?t.map(e=>D(e,!1)):w("no_favorites_message"))):"","SEARCH"===v.mode?(e=v.searchInput?function(){if(p)return p(v.searchInput);var e=new hc(v.fonts,{shouldSort:!0,includeScore:!0,threshold:.25,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:["name"]});return(p=(t=>e.search(t).map(e=>e.item)))(v.searchInput)}(v.searchInput):v.fonts,Pc(Ic(),L,k,e.length?e.map(e=>D(e,!1)):w("font_not_available"))):"",N);var e;var t;var i}(),m)},"raf"),f=t(Nc(Object.assign({},{activeFontName:"",activeFontWeight:400,fonts:[],favorites:[],recent:[],loading:[],failedToLoad:[],mode:"ALL",searchInput:""},e),e=>{e.activeFontName&&function(){if(!v.activeFontName)return;var e=[...v.recent],t=e.indexOf(v.activeFontName);if(0===t)return;-1!==t&&e.splice(t,1);e.length>=5&&e.pop();e.unshift(v.activeFontName),y({recent:e}),n(e)}(),e.fonts&&(p=null),g()}),2),v=f[0],y=f[1];BeFunky.LanguageManager.addLanguageUpdateListener(g);var x,_,I,T,b,S={name:"",isRecent:!1},C=(x=!1,_=BeFunky.debounce(e=>{if(x){var t=e.target.value.trim();y({mode:"SEARCH",searchInput:t}),t&&u(t)}},100),(I=kc(pc(),e=>{x=!0,e.target.value.trim()&&_(e)},e=>{x=!1,e.target.value.trim()||y({mode:"ALL"})},_,_)).setLang("search_fonts"),I),B=(T=kc(mc()),BeFunky.panelHeader(T,{name:"choose_font",helpEnabled:!0,closeEnabled:!0,modifier:"alternate",helpClueID:"choose_font"}),T.addEventListener("CLOSE",()=>m.hide()),T),F=(b=kc(dc()),BFN.HelpClueManager.setup("choose_font",{side:"left",positionFactor:0,left:"calc(100% + .5rem)",top:"1.75rem",zIndex:1,container:b}),b);m.addEventListener(BeFunky.pointerdown,e=>e.stopImmediatePropagation());var E,P=function(){var e,t=kc(uc()),i=BFN.CSS.topMenuBarHeight+24;return{menu:t,showMenu:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.name,s=n.type,l=n.weights,h=n.itemYOffset,u=n.item;if(t.setStyles({display:""}),"number"==typeof h){var m=36*l.length,p=l.indexOf(d(l));h-=36*p,h=Math.min(h,BFN.appRect.height-m-2),t.setStyles({top:"".concat(h-i,"px")})}Mc(function(e,t,i){return Pc(cc(),i.map(i=>(function(e,t,i){var r=c[i],n=["font-menu__item","font-menu__weights-item",e===v.activeFontName&&i===v.activeFontWeight?"font-menu__item--active":"","button","button--large"].filter(Boolean).join(" "),o="";"system"!==t&&"uploaded"!==t||(o='font-family: "'.concat(e,'", sans-serif; font-weight: ').concat(i));if("google"===t){var s="".concat(BFN.imagesURL,"app/fonts/google/").concat(e.replace(/[^a-z0-9-]/gi,""),"-").concat(i,"w.png");o="color: transparent; background-image: url(".concat(s,")")}return Pc(vc(),n,o,()=>(function(e,t){y({activeFontName:e,activeFontWeight:t}),V(),a(e,t);var i=v.fonts.find(t=>t.name===e);M({name:i.name,type:i.type,weights:i.weights})})(e,i),r)})(e,t,i)))}(o,s,l),t),(e=u)&&e.addClass("font-menu__item--showing-weights");BFN.appContainer.addEventListener(BeFunky.pointerover,r)}};function r(i){t.contains(i.target)||e&&e.contains(i.target)||"UL"!==i.target.nodeName&&(BeFunky.isLoadScreenActive()||function(){t.setStyles({display:"none"}),e&&(e.removeClass("font-menu__item--showing-weights"),e=void 0);BFN.appContainer.removeEventListener(BeFunky.pointerover,r)}())}}(),N=P.menu,M=P.showMenu;return E=(e=>e.hasClass("font-menu__item")&&!e.hasClass("font-menu__item--recent")),BeFunky.addArrowKeyHandler({condition:E,callback:(e,t,i)=>{if("keydown"!==i.type&&"left"!==t&&"right"!==t){var r="up"===t?e.previousElementSibling:e.nextElementSibling;r&&E(r)&&r.click()}}}),Object.assign(m,{setState:y,show:function(){if(r)return;r=!0,g(),m.setStyles({display:"",zIndex:parseInt(UIToggler.alternateContainer.style.zIndex)+1}),requestAnimationFrame(()=>{r&&(m.setStyles({opacity:1}),UIToggler.alternateMenu.addClass("disabled"),BFN.HelpClueManager.show("choose_font"))})},hide:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!r)return;r=!1,UIToggler.alternateMenu.removeClass("disabled"),"SEARCH"===v.mode&&(C.value="",y({mode:"ALL",searchInput:""}));if(e)return void m.setStyles({opacity:0,display:"none"});m.setStyles({opacity:0}),setTimeout(()=>{r||m.setStyles({display:"none"})},200)}}),m;function D(e,t){var i,r=e.name,a=e.type,n=e.bgYOffset,o=e.weights,s=r===v.activeFontName,l=["font-menu__item","font-menu__item--".concat(a),t?"font-menu__item--recent":"",s?"font-menu__item--active":"","button","button--large"].filter(Boolean).join(" ");if("number"==typeof n){var h="google"===a?"google-fonts-sprite.".concat(BeFunky.Params.googleFontsSpriteVersion,".png"):"befunky-fonts-sprite.".concat(BeFunky.Params.befunkyFontsSpriteVersion,".png");i="background-position-y: -".concat(n,"px; background-image: url(").concat(BFN.imagesURL,"app/fonts/").concat(h,")")}else if("google"===a){var c="".concat(BFN.imagesURL,"app/fonts/google/").concat(r.replace(/[^a-z0-9-]/gi,""),"-").concat(d(o),".png");i="background-image: url(".concat(c,")")}else i='font-family: "'.concat(r,'", sans-serif');var u=v.favorites.includes(r),m=v.loading.includes(r)?Pc(_c()):"",p=v.failedToLoad.includes(r)?Pc(xc(),v.failedToLoad.includes(r)?"":"display: none",Dc("font_load_retry")):"";return Pc(yc(),l,i,r,t,r,m,p,u?"favorites_remove":"favorites_add",wc(u?"favorite-star-fill":"favorite-star-empty","icon font-menu__favorite-icon"),G(o)?wc("global-arrow-down-icon","icon icon-size-small font-menu__show-weights-icon"):"")}function w(e){var t=Dc([e,{learn_more:Pc(fc(),(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())(Dc("learn_more",!0)))}]);return Pc(gc(),wc("no_favorites_message"===e?"no-font-favorite-icon":"no-font-found-icon","icon"),t)}function k(e){if("LI"===e.target.nodeName){var t=e.target,i=t.getAttribute("data-font"),r=v.fonts.find(e=>e.name===i);if(!r)return BeFunky.throwError("No font object in menu for rendered font",i);if(!r.weights.length)return BeFunky.throwError("No font weights in menu for rendered font",i);if(G(r.weights)){var a=e.pageY-e.offsetY;M({name:r.name,type:r.type,weights:r.weights,itemYOffset:a,item:t})}}}function L(e){if(e.stopPropagation(),"LI"===e.target.nodeName){var t=e.target,i=t.getAttribute("data-font");return O(t,i)}if("BUTTON"===e.target.nodeName){var r=e.target.parentElement.getAttribute("data-font");if(!e.target.hasClass("font-menu__favorite-button"))return O(e.target.parentElement,r);!function(e){v.favorites.includes(e)?y({favorites:v.favorites.filter(t=>t!==e)}):y({favorites:[...v.favorites,e]});o(v.favorites)}(r)}}function O(e,t){var i=v.fonts.find(e=>e.name===t),r=e.isRecent?v.recent.indexOf(t):-1,n=function(e,t){if(e.includes(t))return t;var i=t>=600,r=e.filter(e=>i?e>=600:e<600);if(r.length)return a=t,r.reduce((e,t)=>Math.abs(t-a)<Math.abs(e-a)?t:e);var a;if(i)return 700;return d(e)}(i.weights,v.activeFontWeight);if(y({activeFontName:t,activeFontWeight:n}),V(),S={fontName:t,isRecent:e.isRecent},a(t,n),G(i.weights)){var o=e.getBoundingClientRect().top;-1!==r&&(o-=36*r),M({name:i.name,type:i.type,weights:i.weights,itemYOffset:o,item:e})}}function R(){C.value="",y({mode:"FAVORITES"===v.mode?"ALL":"FAVORITES",searchInput:""})}function A(){C.value="",y({mode:"ALL",searchInput:""})}function V(){var e=v.activeFontName;s(e)||v.loading.includes(e)||(y({loading:[...v.loading,e],failedToLoad:v.failedToLoad.filter(t=>t!==e)}),l(e).catch(()=>y({failedToLoad:[...v.failedToLoad,e]})).then(()=>y({loading:v.loading.filter(t=>t!==e)})))}function U(){if(v.activeFontName===S.fontName){var e;e="SEARCH"===v.mode?".font-menu__list--search":"FAVORITES"===v.mode?".font-menu__list--favorites":S.isRecent?".font-menu__list--recent":".font-menu__list--all";var t=m.querySelector("".concat(e,' [data-font="').concat(v.activeFontName,'"]'));t&&t.focus(),S={fontName:"",isRecent:!1}}else S={fontName:"",isRecent:!1}}function G(e){return!(e.length<2)&&!(2===e.length&&e[0]<=500&&e[1]>500)}}function Oc(){var t=e(["<div></div>"]);return Oc=function(){return t},t}function Rc(){var t=e(['<div class="panel-header"></div>']);return Rc=function(){return t},t}function Ac(){var t=e(['\n        <div class="checkbox checkbox--light">\n            <input type="checkbox" id="','" @change='," .checked=",'>\n            <label class="checkbox__label control-item-label" for="','">\n                ',"\n                ","\n                <string>","</string>\n            </label>\n        </div>"]);return Ac=function(){return t},t}function Vc(){var t=e(['\n                <button class="button button--icon button--transparent filter-box__clear" @click=',">\n                    ","\n                </button>"]);return Vc=function(){return t},t}function Uc(){var t=e(['\n        <div class="font-manager__google-menu">\n            <div class="font-manager__search filter-box">\n                ',"\n                <input @keyup="," @change=",' class="filter-box__input input" type="search" placeholder=',">\n                ",'\n            </div>\n            <div class="font-manager__google-scroll">\n                <h3 class="font-manager__sub-heading" style="margin-top: 0.5rem">',"</h3>\n                ",'\n                <h3 class="font-manager__sub-heading">',"</h3>\n                ",'\n                <h3 class="font-manager__sub-heading">',"</h3>\n                ","\n            </div>\n        </div>"]);return Uc=function(){return t},t}function Gc(){var t=e(['\n        <li class="','" style="','">\n            <string>','</string>\n            <span class="font-manager__style font-manager__style--google">',"</span>\n            ","\n        </li>"]);return Gc=function(){return t},t}function Hc(){var t=e(["<button @click=",' class="button button--icon button--circle button--outline button--white button--tiny font-manager__add-google-font" data-bfntooltip="add_to_my_fonts">\n                ',"\n            </button>"]);return Hc=function(){return t},t}function zc(){var t=e(['\n        <li class="','" style="','">\n            ',"\n            ","\n            ","\n        </li>"]);return zc=function(){return t},t}function Xc(){var t=e(["\n            <button @click=",' class="button button--icon button--transparent font-manager__button">\n                ',"\n            </button>"]);return Xc=function(){return t},t}function jc(){var t=e(['<span class="font-manager__upload-progress">',"%</span>"]);return jc=function(){return t},t}function Wc(){var t=e(["<string>",' <span class="font-manager__style">',"</span></string>"]);return Wc=function(){return t},t}function Yc(){var t=e(['<span class="font-manager__error"><string>File: ',"</string>","</span>"]);return Yc=function(){return t},t}function qc(){var t=e(['\n        <li class="','" style="','">\n            <string>',"</string>\n            ","\n            <button @click=",' class="button button--icon button--transparent font-manager__button" data-bfntooltip="remove_font">\n                ',"\n            </button>\n        </li>"]);return qc=function(){return t},t}function Kc(){var t=e(['<ul class="font-manager__list">',"</ul>"]);return Kc=function(){return t},t}function Qc(){var t=e(['\n            <div class="font-manager__center-contents">\n                ',"\n            </div>"]);return Qc=function(){return t},t}function Zc(){var t=e(['\n            <div class="font-manager__center-contents">\n                <div><span class="loading-spinner"></span><string>',"</string></div>\n            </div>"]);return Zc=function(){return t},t}function Jc(){var t=e(['\n        <div class="font-manager__list font-manager__list--uploaded">\n            ',"\n        </div>\n        <button @click=",' class="button button--blue font-manager__upload" .disabled=',">","</button>\n        "]);return Jc=function(){return t},t}function $c(){var t=e(['\n        <div class="font-manager__center-contents font-manager__drag-message">\n            ',"\n            <span>","</span>\n        </div>\n        ",""]);return $c=function(){return t},t}function eu(){var t=e(["<a @click=",' href="#">',"</a>"]);return eu=function(){return t},t}function tu(){var t=e(['<ul class="font-manager__list">',"</ul>"]);return tu=function(){return t},t}function iu(){var t=e(['\n            <div class="font-manager__center-contents font-manager__no-added-fonts">\n                ',"\n                <p>","</p>\n            </div>"]);return iu=function(){return t},t}function ru(){var t=e(['<a href="https://support.befunky.com/hc/en-us/articles/360001571631" target="_blank" rel="noopener">',"</a>"]);return ru=function(){return t},t}function au(){var t=e(["\n        <button @click="," class=",">\n            <string>","</string>\n            ","\n        </button>"]);return au=function(){return t},t}function nu(){var t=e(["\n            ","\n            ",'\n            <div class="font-manager__body">\n                <div class="font-manager__left-panel">\n                    ','\n                    <hr class="font-manager__separator">\n                    ',"\n                    ","\n                    ",'\n                </div>\n                <div class="font-manager__right-panel" @scroll=',">\n                    ","\n                    ","\n                    ",'\n                </div>\n                <div class="drag-drop-area">\n                    ',"\n                    <div>","</div>\n                </div>\n            </div>\n        "]);return nu=function(){return t},t}function ou(){var t=e(['<div id="font_manager" class="font-manager modal"></div>']);return ou=function(){return t},t}var su=BeFunky.lit,lu=su.html,hu=su.setupState,cu=su.render,uu=su.modalLang,du=su.icon,mu=su.elem;function pu(e,i){var r,a=i.addGoogleFont,n=i.removeAddedFont,s=i.onFontFilesDropped,l=i.browseForFonts,h=i.uploadFonts,c=i.cancelUpload,m=i.trackFonts,p=mu(ou()),g=BeFunky.debounce(()=>{!1!==r&&cu(function(){return setTimeout(C,0),lu(nu(),B,F,E("ALL","view_added_fonts"),E("UPLOAD","add_fonts_computer"),E("GOOGLE","add_fonts_google"),"GOOGLE"===v.mode?(e=Object.entries(u).map(e=>{var i=t(e,2),r=i[0],a=i[1];return[parseInt(r),a]}),lu(Uc(),du("global-search-icon","icon icon-size-medium filter-box__icon"),T,T,uu("search",!0),v.searchInput?lu(Vc(),O,du("global-cancel-icon","icon icon-size-small")):"",uu("font_category"),[["serif","font_category_serif"],["sans-serif","font_category_sans_serif"],["display","font_category_display"],["handwriting","font_category_handwriting"],["monospace","font_category_monospace"]].map(e=>D("category",e)),uu("font_thickness"),e.map(e=>D("style",e)),uu("language"),[["latin","latin"],["arabic","arabic"],["cyrillic","cyrillic"],["cyrillic-ext","cyrillic_extended"],["devanagari","devanagari"],["greek","greek"],["greek-ext","greek_extended"],["hebrew","hebrew"],["japanese","japanese"],["khmer","khmer"],["korean","korean"],["latin-ext","latin_extended"],["vietnamese","vietnamese"]].map(e=>D("language",e)))):"",S,"ALL"===v.mode?function(){if(!v.fonts.length){var e=uu(["no_user_defined_fonts_message",{learn_more:lu(ru(),(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())(uu("learn_more",!0)))}]);return lu(iu(),du("no-font-added-icon","icon"),e)}return lu(tu(),v.fonts.map(P))}():"","UPLOAD"===v.mode?function(){var e=v.fontsToUpload,t=!1;e.find(e=>"number"==typeof e.uploadProgress)?t=!0:e.every(e=>e.error)&&(t=!0);var i=uu(["drag_drop_fonts",{upload:lu(eu(),w,uu("upload",!0).toLowerCase())}]);return lu($c(),du("font-files-icon","icon",{style:"width: 100%; height: 3rem; margin-bottom: 1rem;"}),i,v.fontsToUpload.length?lu(Jc(),v.fontsToUpload.map(N),L,t,uu("upload_fonts")):"")}():"","GOOGLE"===v.mode?function(){if(!v.googleFontWeights.length)return BeFunky.request("".concat(BFN.assetsURL,"datas/google-fonts.5eff22612f.json"),{},e=>{var t=e.error,i=e.response;if(t)return BeFunky.logError("Unable to request Google Fonts");var r=i,a=o.map(e=>e.split(":")[0]),n=[];r.forEach(e=>{var t=e.name,i=e.weights,r=e.category,o=e.subsets;i.forEach(e=>{n.push({name:t,weight:e,weights:i,category:r,subsets:o,isDefault:a.includes(t)})})}),y({googleFontWeights:n})}),lu(Zc(),uu("loading"));var e=function(){var e=v.googleFontWeights,t=v.selectedCategories,i=v.selectedWeights,r=v.selectedSubsets,a=v.maxFontsToRender,n=e=>e.toLowerCase().replace(/[^a-z0-9 ]/g,""),o=v.searchInput.split(/\s+/).map(n).filter(Boolean),s=!o.length||1===o.length&&1===o[0].length,l=t.length?e=>t.includes(e.category):()=>!0,h=i.length?e=>i.some(t=>t===e.weight):()=>!0,c=r.length?e=>r.some(t=>e.subsets.includes(t)):()=>!0,u=s?()=>!0:e=>{var t=n(e.name);return o.every(e=>t.includes(e))},d=[];b=!1;for(var m=0;m<e.length;m++){var p=e[m];if(l(p)&&h(p)&&c(p)&&u(p)&&(d.push(p),d.length===a&&m+1!==e.length)){b=!0;break}}return d}();return e.length?lu(Kc(),e.map(M)):lu(Qc(),uu(["no_font_results",{input:v.searchInput}]))}():"",du("global-font-icon"),uu("drop_fonts_here"));var e}(),p)},"raf"),f=t(hu(Object.assign({},{fonts:[],mode:"ALL",searchInput:"",googleFontWeights:[],selectedCategories:[],selectedWeights:[],selectedSubsets:["latin"],maxFontsToRender:50,fontsToUpload:[],availableHeight:720},e),g),2),v=f[0],y=f[1];BeFunky.LanguageManager.addLanguageUpdateListener(g);var x,_,I,T=BeFunky.debounce(function(e){var t=e.target.value.trim();y({searchInput:t,maxFontsToRender:50}),x&&(x.scrollTop=0)},50),b=!1,S={handleEvent:BeFunky.throttle(function(e){if("GOOGLE"!==v.mode)return;if(x=x||e.target,!b)return;var t=40*v.maxFontsToRender+24,i=v.availableHeight-50;t-i-e.target.scrollTop<500&&y({maxFontsToRender:v.maxFontsToRender+50})},50),passive:!0},C=BeFunky.once(function(){BFN.DragAndDropManager.dragDropAreas.push({visibleElem:p.querySelector(".drag-drop-area"),listeningElem:p.querySelector(".font-manager__right-panel"),isActive:!1,handler:k})}),B=(_=mu(Rc()),BeFunky.panelHeader(_,{name:"manage_fonts",helpEnabled:!0,closeEnabled:!0,modifier:"modal",helpClueID:"manage_font"}),_.addEventListener("CLOSE",()=>p.hide()),_),F=(I=mu(Oc()),BFN.HelpClueManager.setup("manage_font",{side:"top",positionFactor:.935,left:"calc(100% - 3.75rem)",top:"0.25rem",zIndex:1,container:I}),I);return Object.assign(p,{state:v,setState:y,show:function(){if(r)return;r=!0,g(),m(!1),BeFunky.openModal(p,{size:[720,720],onOpen:()=>{BFN.HelpClueManager.show("manage_font")},onClose:()=>{r=!1,m(!0)},onWindowResize:e=>{var t=e.availableHeight;y({availableHeight:t})}})},hide:function(){if(!r)return;r=!1,BeFunky.closeModal(p)}}),p;function E(e,t){return lu(au(),()=>y({mode:e}),"button button--list button--large button--arrow font-manager__tab ".concat(v.mode===e?"font-manager__tab--selected":""),uu(t),du("global-arrow-down-icon"))}function P(e){var t,i=e.name,r=e.type,a=e.weights,o=["font-manager__item","font-manager__item--added","font-manager__item--".concat(r)].filter(Boolean).join(" ");t="google"===r?"background-image: url(".concat(BFN.imagesURL,"app/fonts/google/").concat(i.replace(/[^a-z0-9-]/gi,""),"-").concat(d(a),".png)"):'font-family: "'.concat(i,'", sans-serif');var s="google"===r?du("google-font-icon","icon font-manager__icon-google","",{tooltip:"added_from_google"}):du("file-icon","icon icon font-manager__icon-file","",{tooltip:"added_from_computer"});return lu(qc(),o,t,i,s,()=>n(i),du("transform-delete"))}function N(e){var t,i=e.fontFamily,r=e.fontWeight,a=e.fileName,n=e.uploadProgress,o=e.error,s=["font-manager__item","font-manager__item--uploaded",o?"font-manager__item--error":""].filter(Boolean).join(" "),l=o?lu(Yc(),a,(t={no_style:"font_not_readable",no_family_name:"font_not_readable",no_weight:"font_not_readable",parse_failed:"font_not_readable",font_type_not_supported:["font_not_supported",{fileType:BFN.getExtension(a).toUpperCase()}],italic_style:"font_italic_not_supported",google_font_conflict:["font_duplicate_google",{fontFamily:i}],already_uploaded:["font_file_already_uploaded",{font:()=>"".concat(i," ").concat(uu(u[r],!0))}]}[o])?uu(t):(BeFunky.logError("Unhandled font error:",o),BeFunky.failureReason(o))):lu(Wc(),i,"- ".concat(uu(u[r],!0))),h=100===n,d=!o&&!h&&"number"==typeof n,m="";d&&(m=lu(jc(),n));var p=h?du("global-apply-icon","icon font-manager__icon-selected",{style:"margin-right: 6px"}):lu(Xc(),function(){if(!d)return y({fontsToUpload:v.fontsToUpload.filter(t=>t!==e)});c(e)},du("global-cancel-icon","icon icon-size-small"));return lu(zc(),s,"",l,m,p)}function M(e){var t,i=e.name,r=e.weights,n=e.weight,o=e.isDefault,s=["font-manager__item","font-manager__item--google"].filter(Boolean).join(" "),l="".concat(BFN.imagesURL,"app/fonts/google/").concat(i.replace(/[^a-z0-9-]/gi,""),"-").concat(n,".png"),h="background-image: url(".concat(l,")");return t=o?du("global-apply-icon","icon font-manager__icon-selected font-manager__icon-selected--default",{tooltip:"font_already_included"}):v.fonts.find(e=>e.name===i&&"google"===e.type)?du("global-apply-icon","icon font-manager__icon-selected",{tooltip:"added_to_my_fonts"}):lu(Hc(),()=>a(i,r),du("zoom-plus-icon","icon icon-size-tiny")),lu(Gc(),s,h,i,uu(u[n]),t)}function D(e,i){var r=t(i,2),a=r[0],n=r[1],o="font_manager_google_".concat(e,"_").concat(a),s={category:R,style:A,language:V},l={category:()=>v.selectedCategories.includes(a),style:()=>v.selectedWeights.includes(a),language:()=>v.selectedSubsets.includes(a)};return lu(Ac(),o,t=>s[e](t,a),l[e](),o,du("checkbox-selected","icon icon-size-medium checkbox__icon checkbox__icon--light checkbox__icon--checked"),du("checkbox-unselected","icon icon-size-medium checkbox__icon checkbox__icon--light checkbox__icon--unchecked"),uu(n))}function w(e){e.preventDefault(),l()}function k(e){y({mode:"UPLOAD"}),s(e)}function L(){y({fontsToUpload:v.fontsToUpload.filter(e=>!e.error)}),h(v.fontsToUpload)}function O(e){e.target.previousElementSibling.value="",y({searchInput:"",maxFontsToRender:50}),x&&(x.scrollTop=0)}function R(e,t){e.target.checked?y({selectedCategories:[...v.selectedCategories,t].unique(),maxFontsToRender:50}):y({selectedCategories:v.selectedCategories.filter(e=>e!==t),maxFontsToRender:50}),x&&(x.scrollTop=0)}function A(e,t){e.target.checked?y({selectedWeights:[...v.selectedWeights,t].unique(),maxFontsToRender:50}):y({selectedWeights:v.selectedWeights.filter(e=>e!==t),maxFontsToRender:50}),x&&(x.scrollTop=0)}function V(e,t){e.target.checked?y({selectedSubsets:[...v.selectedSubsets,t].unique(),maxFontsToRender:50}):y({selectedSubsets:v.selectedSubsets.filter(e=>e!==t),maxFontsToRender:50}),x&&(x.scrollTop=0)}}class gu extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.initDefaultValues(),this.initFontsList(),this.initFontMenu()}initDefaultValues(){this.defaultFontFamily="Open Sans",this.defaultFontWeight=400,this._activeFont=this.defaultFontFamily,this._activeFontWeight=this.defaultFontWeight,this.loadedFonts=[],this.fontLoadingPromises=[],this.userDefinedSystemFontsKey="options__userDefinedSystemFonts",this.customFontStylesheet=document.createElement("style"),this.customFontStylesheet.id="bfn_custom_fonts",document.head.appendChild(this.customFontStylesheet),this.fontTestingContext=null,this.monospaceTextWidth=null,this.serifTextWidth=null,this.monospaceFontList=["Andale Mono","Courier","Courier New","GB18030 Bitmap","Lantinghei TC","Monaco","Apple Braille","Cousine"].map(e=>e.toLowerCase()),this.fontTestingText="abcdefghijklmnopqrstuvwxyz0123456789",this.fontTestingSize="72",this.fontMenuComponent=null,this.favorites=[],this.uploadingFonts={},this.limitFontsForDesigners=null,this.saveUserDefinedSystemFonts=BeFunky.debounce(this.saveUserDefinedSystemFonts.bind(this),200)}initFontsList(){this.getUserDefinedSystemFontNames().then(e=>{var t=!1;e.forEach(e=>{var i=this.getFontObject(e);if(i)"system"===i.type?i.isUserDefined=!0:BeFunky.logError('Unable to add user-defined system font "'.concat(e,'" b/c of conflict'),i);else{t=!0;var r=new f(e,"system",[],{isUserDefined:!0});BFN.CONST.FONT_LIST.push(r)}}),t&&BFN.CONST.FONT_LIST.sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1);var i=BFN.MainUI?BFN.MainUI.addIdleRenderFunction:requestIdleCallback;i(()=>{this.testSystemFonts(!0,()=>{BFN.CONST.FONT_LIST.filter(e=>{var t=e.isUserDefined,i=e.isAvailable,r=e.type;return t&&"system"===r&&!i}).forEach(e=>{var t=e.name;return this.removeUserDefinedFont(t)})}),i(()=>this.migrateOldUserDefinedSystemFonts())})})}initFontMenu(){window.addEventListener("INIT_COMPLETE",()=>{var e=document.getElementById("text_edit_font_button");e.addEventListener("click",()=>{this.openFontMenu()}),this.popoverButtonText=e.querySelector("span"),this.popoverButtonText.textContent=this.activeFont,this.getRecentFonts().then(e=>{this.recentFontsFromPriorSession=e;var t=e[0];t&&(this.isLoaded(t)?Promise.resolve():this.load(t)).then(()=>{var e=BFN.FabricManager.userStyle.charStyles;e.fontFamily||(e.fontFamily=t)}).catch(e=>{BeFunky.logError("Failed to preload last-used font from prior session",e)})})}),this.preloadFontBGImageSprites=BeFunky.once(()=>{["google-fonts-sprite.".concat(BeFunky.Params.googleFontsSpriteVersion,".png"),"befunky-fonts-sprite.".concat(BeFunky.Params.befunkyFontsSpriteVersion,".png")].forEach(e=>{(new Image).src="".concat(BFN.imagesURL,"app/fonts/").concat(e)})})}setupFontMenuComponent(){if(!this.fontMenuComponent){BFN.FontManager.testSystemFonts();var e=BeFunky.debounce(e=>{BFN.IndexedDB.set("options__recentFontFamilies",e).catch(e=>BeFunky.logError("Unable to update recentFontFamilies in IndexedDB",e))},1e3),t={fonts:this.getFontObjectsForFontMenu(),activeFontName:this.activeFont,activeFontWeight:this.activeFontWeight,recent:this.recentFontsFromPriorSession||[],favorites:this.favorites};this.fontMenuComponent=Lc(t,{onFontSelection:(e,t)=>{UITools.setToolValue("text_edit","weight",t),UITools.setToolValue("text_edit","font",e),UITools.applyTool("text_edit"),this.activeFont=e,this.activeFontWeight=t,BFN.BfnService.track("CREATE","FONTS",e.replace(" ","_").toUpperCase())},onRecentFontsChange:e,onFavoriteFontsChange:e=>{BFN.SettingsManager.updateSetting("fonts_fav",e)},isFontLoaded:e=>this.isLoaded(e),loadFont:e=>this.load(e),openFontManager:()=>this.openFontManagerModal(),testNewSystemFont:e=>{if(!(e.length<3||BFN.FontManager.findSimilarFont(e))){var t=e===e.toLowerCase()?BFN.toTitleCase(e):e,i=new f(t,"system",[]);BFN.FontManager.testFonts([i]),i.isAvailable&&this.addUserDefinedSystemFont(t,!0)}}}),BFN.appContainer.appendChild(this.fontMenuComponent),this.preloadUploadedFonts()}}setupFontManagerComponent(){if(this.fontManagerComponent)return!0;if(!BFN.BfnService.userIsPlus)return BeFunky.openTeaserModal("font_management"),!1;var e,t={fonts:BFN.CONST.FONT_LIST.filter(e=>e.isUserDefined&&"system"!==e.type)};return this.fontManagerComponent=pu(t,{addGoogleFont:(e,t)=>{BFN.SettingsManager.getSetting("fonts_added").then(i=>{var r=i.find(t=>t.name===e);if(r)throw r;BFN.SettingsManager.updateSetting("fonts_added",[...i,{name:e,type:"google",weights:t}])})},removeAddedFont:e=>{BFN.SettingsManager.getSetting("fonts_added").then(t=>{BFN.SettingsManager.updateSetting("fonts_added",t.filter(t=>t.name!==e))})},onFontFilesDropped:this.handleUserFontFiles.bind(this),browseForFonts:this.browseForFonts.bind(this),uploadFonts:this.uploadUserFonts.bind(this),cancelUpload:this.cancelUserFontUpload.bind(this),trackFonts:t=>{var i=BFN.CONST.FONT_LIST.filter(e=>e.isUserDefined&&"system"!==e.type).reduce((e,t)=>Object.assign(e,{[t.name]:t.type}),{});if(t){var r=Object.keys(i).filter(t=>!e[t]),a=Object.keys(e).filter(e=>!i[e]),n=[...r.map(e=>i[e]),...a.map(t=>e[t])].unique().map(e=>"google"===e?"Google":"User"),o=new BFN.UserActionVO;o.eventID="font_manager_opened",o.eventObject={},r.length&&(o.eventObject.fontManagerFontsAdded=r),a.length&&(o.eventObject.fontManagerFontsRemoved=a),n.length&&(o.eventObject.fontManagerFontSources=n),console.log(o),o.track()}else e=i}}),this.preloadUploadedFonts(),!0}isLoaded(e){return this.loadedFonts.includes(e)}getFontObject(e){return BFN.CONST.FONT_LIST.find(t=>t.name===e)}isInList(e){return BFN.CONST.FONT_LIST.some(t=>t.name===e)}findSimilarFont(e){if(this.isInList(e))return e;var t=s[e];if(t)return t;var i=e=>e.toLowerCase().replace(/[^a-z \u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]/g,"").trim().replace(/ (ot|tt|ofl)$/,"").replace(/ /g,""),r=i(e),a=BFN.CONST.FONT_LIST.find(e=>i(e.name)===r);return!!a&&a.name}load(e){if(this.fontLoadingPromises[e])return this.fontLoadingPromises[e];var t=BFN.FontManager.getFontObject(e);if(!t){var i='Font "'.concat(e,'" not found in FONT_LIST');return BeFunky.throwError(i),Promise.reject(i)}var r=t.type,a=t.weights,n=t.isAvailable,o=t.fileName,s=t.files,l=new Promise((i,l)=>{if("system"===r)return n?i(e):(this.testFonts([t]),t.isAvailable?(this.testFontWeights([t]),i(e)):l("System font is unavailable"));var c=()=>{var n=a.length||1,o=[],s=[],h=(r,a)=>{var h=100*parseInt(a.replace(/[^\d]/g,""));if(r?o.push(h):s.push(h),o.length+s.length-n==0)return o.length?s.length?(BeFunky.logError("Loaded ".concat(o.length," / ").concat(n,' font weights for font "').concat(e,'"'),{weightsLoaded:o,weightsNotLoaded:s}),o.length>=s.length?i(e):l("Failed to load ".concat(s.length,' font weight(s) for "').concat(e,'"'))):(console.log("Loaded ".concat(1===n?"one weight":"all ".concat(n," weights"),' for font "').concat(e,'"')),this.loadedFonts.push(t.name),i(e)):l('Failed to load font "'.concat(e,'"'))},c={classes:!1,fontactive:(e,t)=>{h(!0,t)},fontinactive:(e,t)=>{h(!1,t)}},u=function(){if("google"===r)return{google:{families:["".concat(e,":").concat(a.join(","))]}};var t=a.length?":".concat(a.map(e=>"n".concat(e/100)).join(",")):"";return{custom:{families:["".concat(e).concat(t)]}}}();sc.load(Object.assign(c,u))};if(this.unloadFont(e,r),"google"===r)return c();if("befunky"===r){var u="".concat(BFN.assetsURL,"fonts/").concat(o);return this.injectFontFace(e,["url('".concat(u,".woff2') format('woff2')"),"url('".concat(u,".woff') format('woff')")]),c()}return"uploaded"===r?(s.forEach(t=>{var i=t.weight,r=t.fileName,a=BFN.getExtension(r),n=(h.find(e=>e.extension===a)||{}).cssFormat;if(!n)return BeFunky.throwError('Unsupported font type: "'.concat(a,'"'),r);var o="url('".concat(BeFunky.Params.userFontsPath).concat(r,"') format('").concat(n,"')");this.injectFontFace(e,[o],i)}),c()):void 0});this.fontLoadingPromises[e]=l;var c=()=>{var t=this.fontLoadingPromises[e].needsReloadedCallback;if(delete this.fontLoadingPromises[e],t){var i=this.getFontObject(e);if(!i||"uploaded"!==i.type)return;this.loadUploadedFont(e,t)}};return l.then(c).catch(c),l}loadUploadedFont(e,t){this.fontLoadingPromises[e]?this.fontLoadingPromises[e].needsReloadedCallback=t:this.load(e).then(t)}unloadFont(e,t){if(["google","befunky","uploaded"].includes(t)){var i=this.isLoaded(e);if(i&&(this.loadedFonts=this.loadedFonts.filter(t=>t!==e)),"uploaded"===t||"befunky"===t){var r=0;[...this.customFontStylesheet.sheet.cssRules].forEach((t,i)=>{p(t.cssText.match(/font-family:([^;]+);/)[1].trim())===e&&(this.customFontStylesheet.sheet.deleteRule(i-r),r++)}),0===r&&i&&BeFunky.throwError("Unable to find @font-face rule for ".concat(t," font ").concat(e))}else{var a="https://fonts.googleapis.com/css?family=".concat(e.split(" ").join("+"),":"),n='link[rel="stylesheet"][href^="'.concat(a,'"]'),o=[];try{o=[...document.head.querySelectorAll(n)]}catch(e){BeFunky.throwError("Invalid Google Font stylesheet selector",n)}o.forEach(e=>e.parentElement.removeChild(e))}}else BeFunky.throwError("Invalid unloadFont type",t)}testSystemFonts(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},i=BFN.CONST.FONT_LIST.filter(e=>"system"===e.type&&null===e.isAvailable);if(!e)return this.testFonts(i),this.testFontWeights(i.filter(e=>e.isAvailable)),void t();var r=e=>{var t=i.filter(e=>null===e.isAvailable);if(!t.length)return a(e);this.testFonts(t,e),requestIdleCallback(r)},a=e=>{var r=i.filter(e=>e.isAvailable&&!e.weights.length);r.length?(this.testFontWeights(r,e),requestIdleCallback(a)):t()};requestIdleCallback(r)}setupFontTestingCanvasContext(){var e=document.createElement("canvas");this.fontTestingContext=e.getContext("2d"),BeFunky.isSafariMojave&&(e.id="system_font_detection_canvas",e.setStyles({display:"none"}),BFN.appContainer.appendChild(e)),this.fontTestingContext.font="".concat(this.fontTestingSize,"px monospace"),this.monospaceTextWidth=this.fontTestingContext.measureText(this.fontTestingText).width,this.fontTestingContext.font="".concat(this.fontTestingSize,"px serif"),this.serifTextWidth=this.fontTestingContext.measureText(this.fontTestingText).width}testFonts(e,t){this.fontTestingContext||this.setupFontTestingCanvasContext(),e.forEach(e=>{if(!(t&&t.timeRemaining()<1)){var i=e.name,r=this.monospaceFontList.includes(i.toLowerCase()),a=r?"serif":"monospace",n=r?this.serifTextWidth:this.monospaceTextWidth;this.fontTestingContext.font="".concat(this.fontTestingSize,"px ").concat(g(i),", ").concat(a);var o=this.fontTestingContext.measureText(this.fontTestingText).width;e.isAvailable=o!==n,e.isAvailable&&(e.originalMeasuredTextSize=o)}})}testFontWeights(e,t){this.fontTestingContext||this.setupFontTestingCanvasContext(),e.forEach(e=>{if(!(t&&t.timeRemaining()<1)){if(!e.isAvailable)throw console.log(e),new Error('Font "'.concat(e.name,'" is not available or has not been tested'));var i=e.name,r=this.monospaceFontList.includes(i.toLowerCase()),a=r?"serif":"monospace",n=r?this.serifTextWidth:this.monospaceTextWidth,o={},s=r=>{if(o[r])return o[r];this.fontTestingContext.font="".concat(r," ").concat(this.fontTestingSize,"px ").concat(g(i),", ").concat(a);var s=this.fontTestingContext.measureText(this.fontTestingText).width;return n===s&&this.debugFontWeightDetection({fontObject:e,weight:r,measuredTextSize:s,baselineFont:a,baselineTextSize:n,deadline:t}),o[r]=s,s};e.weights=(()=>{if(s(100)===s(900))return[400];if(s(100)===s(500)&&s(600)===s(900))return[400,700];for(var e={},t=100;t<=900;t+=100){var r=s(t);e[r]?e[r].push(t):e[r]=[t]}var a=[400,700];return Object.values(e).map(t=>{if(1===t.length)return t[0];var r=a.find(e=>t.includes(e));if(r)return r;t.every((e,i)=>0===i||e-t[i-1]==100)||BeFunky.throwError("Weights for font are not consecutive",i,t,e);var n=Math.max(...t),o=Math.min(...t);return n<400?o:n}).filter(Boolean).sort()})()}})}debugFontWeightDetection(e){var t=e.fontObject,i=e.weight,r=e.measuredTextSize,a=e.baselineFont,n=e.baselineTextSize,o=e.deadline;if(!this.hasDebuggedFontWeightDetection){this.hasDebuggedFontWeightDetection=!0;for(var s={},l=100;l<=900;l+=100)this.fontTestingContext.font="".concat(l," ").concat(this.fontTestingSize,"px ").concat(a),s[l]=this.fontTestingContext.measureText(this.fontTestingText).width;for(var h={},c=100;c<=900;c+=100)this.fontTestingContext.font="".concat(c," ").concat(this.fontTestingSize,"px ").concat(g(t.name),", ").concat(a),h[c]=this.fontTestingContext.measureText(this.fontTestingText).width;var u="monospace"===a?"serif":"monospace",d="monospace"===a?this.serifTextWidth:this.monospaceTextWidth;this.fontTestingContext.font="".concat(this.fontTestingSize,"px ").concat(g(t.name),", ").concat(a);var m=this.fontTestingContext.measureText(this.fontTestingText).width;BeFunky.reportWarning("Font is marked as available but can't be distinguished from baseline",{name:t.name,weight:i,measuredTextSize:r,baselineFont:a,baselineTextSize:n,baselineSizes:JSON.stringify(s),fontSizes:JSON.stringify(h),altBaseLineFont:u,altBaseLineFontSize:d,originalMeasuredTextSize:t.originalMeasuredTextSize,textSizeAtDefaultSize:m,timeRemaining:o?o.timeRemaining():"NA"})}}addUserDefinedSystemFont(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=p(e);var i=this.getFontObject(e);if(i)return BeFunky.throwError("Attempted to add user-defined system font when one already existed",i),!1;var r=new f(e,"system",[],{isUserDefined:!0});if(t)r.isAvailable=!0;else if(this.testFonts([r]),!r.isAvailable)return!1;return this.testFontWeights([r]),console.log("Adding user-defined system font:",r),BFN.CONST.FONT_LIST=BFN.CONST.FONT_LIST.concat([r]).sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1),this.updateFontUI(),this.saveUserDefinedSystemFonts(),!0}addUserDefinedFontFromSettings(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.weights,a=i.files,n=new f(e,t,r,{isUserDefined:!0,files:a}),o=this.getFontObject(e);if(o)if(o.isUserDefined)if("system"===o.type)n.replacedDefaultFont=o;else{if(o.type!==t)return BeFunky.throwError("Can't replace ".concat(o.type," font with ").concat(t," font")),!1;var s=o.weights.isIdenticalTo(r),l=JSON.stringify(o.files)===JSON.stringify(a);if("google"===t){if(s)return;o.weights=r}if("uploaded"===t){if(s&&l)return;o.weights=r,o.files=a}}else n.replacedDefaultFont=o;return n.replacedDefaultFont?(BFN.CONST.FONT_LIST.splice(BFN.CONST.FONT_LIST.indexOf(o),1,n),console.log("Replacing ".concat(o.type," font with user-defined font:"),n)):o||(BFN.CONST.FONT_LIST=BFN.CONST.FONT_LIST.concat([n]).sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1)),(this.fontMenuComponent||this.fontManagerComponent)&&("google"===t?this.updateFontUI():this.loadUploadedFont(e,()=>this.updateFontUI())),!0}removeUserDefinedFont(e){console.log("Removing user-defined font:",e);var t=this.getFontObject(e);if(!t||!t.isUserDefined)return BeFunky.throwError('User-defined font "'.concat(e,'" is not in list.'),t),!1;BFN.CONST.FONT_LIST=BFN.CONST.FONT_LIST.filter(e=>e!==t);var i=t.replacedDefaultFont;return i&&(BFN.CONST.FONT_LIST=BFN.CONST.FONT_LIST.concat([i]).sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1),"system"===i.type&&(this.testFonts([i]),i.isAvailable&&this.testFontWeights([i]))),this.updateFontUI(),"system"===t.type?this.saveUserDefinedSystemFonts():this.unloadFont(e,t.type),!0}getUserDefinedSystemFontNames(){return BFN.IndexedDB.get(this.userDefinedSystemFontsKey).catch(e=>{BeFunky.logError("Unable to get user-defined system font names",e)}).then(e=>Array.isArray(e)?e.filter(e=>e&&"string"==typeof e):[])}saveUserDefinedSystemFonts(){BFN.IndexedDB.set(this.userDefinedSystemFontsKey,BFN.CONST.FONT_LIST.filter(e=>e.isUserDefined&&"system"===e.type).map(e=>e.name)).catch(e=>{BeFunky.logError("Unable to save user-defined system font names",e)})}getRecentFonts(){return BFN.IndexedDB.get("options__recentFontFamilies").catch(e=>(BeFunky.logError("Unable to get recent font families from IndexedDB",e),[])).then(e=>Array.isArray(e)?e.map(e=>this.findSimilarFont(e)).filter(Boolean):[])}injectFontFace(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";this.customFontStylesheet.sheet.insertRule("\n            @font-face {\n                font-family: ".concat(g(e),";\n                src: ").concat(t.join(",\n"),";\n                font-weight: ").concat(i,";\n                font-style: normal;\n            }\n        "),0)}preloadUploadedFonts(){var e=BFN.CONST.FONT_LIST.filter(e=>{var t=e.type,i=e.name;return"uploaded"===t&&!this.isLoaded(i)}).map(e=>{var t=e.name;return BFN.FontManager.load(t).catch(e=>{BeFunky.logError('Unable to preload user-uploaded font "'.concat(t,'"'),e)})});e.length&&Promise.all(e).then(()=>{this.updateFontUI()})}getFontObjectsForFontMenu(){return null===this.limitFontsForDesigners&&(this.limitFontsForDesigners=Boolean(BeFunky.getLocal("exclude_system_fonts"))),this.limitFontsForDesigners?BFN.CONST.FONT_LIST.filter(e=>!e.isUserDefined&&("google"===e.type||"befunky"===e.type)):BFN.CONST.FONT_LIST.filter(e=>!1!==e.isAvailable)}openFontMenu(){this.setupFontMenuComponent(),this.fontMenuComponent.show()}closeFontMenu(){this.fontMenuComponent&&this.fontMenuComponent.hide()}updateFontUI(){this.fontMenuComponent&&this.fontMenuComponent.setState({fonts:this.getFontObjectsForFontMenu()}),this.fontManagerComponent&&this.fontManagerComponent.setState({fonts:BFN.CONST.FONT_LIST.filter(e=>e.isUserDefined&&"system"!==e.type)})}openFontManagerModal(){BFN.FabricManager.currentTextTransformItem&&BFN.FabricManager.currentTextTransformItem.exitTextEditing(),this.setupFontManagerComponent()&&(this.fontManagerComponent.show(),BeFunky.showAnnouncementOnce("font_management"))}browseForFonts(){var e=[];BFN.MultipleFileUploader.upload(t=>{var i=t.file;if(t.isComplete)return this.handleUserFontFiles(e);e.push(i)},{fileType:"fonts",createMenuImageVO:!1})}handleUserFontFiles(e){if(this.setupFontManagerComponent()){var t=this.fontManagerComponent.state.fontsToUpload;t.find(e=>100===e.uploadProgress)&&this.fontManagerComponent.setState({fontsToUpload:t.filter(e=>100!==e.uploadProgress)});var i=this.fontManagerComponent.state.fontsToUpload.map(e=>e.fileName);BeFunky.showLoadScreen(),this.processFontFiles(e,i).then(e=>{var t=this.fontManagerComponent.state.fontsToUpload,i=50-t.length,r=[];if(i>0){var a=(e,t)=>{var i=e.fontFamily,r=e.fontWeight,a=e.fileName,n=e.error;return i?t.fontFamily===i&&t.fontWeight===r&&t.error===n:t.fileName===a&&t.error===n};e.forEach(e=>{i-r.length<=0||t.find(t=>a(e,t))||r.find(t=>a(e,t))||r.push(e)}),this.fontManagerComponent.setState({fontsToUpload:[...r,...this.fontManagerComponent.state.fontsToUpload]})}this.fontManagerComponent.setState({mode:"UPLOAD"}),this.openFontManagerModal(),BeFunky.hideLoadScreen()})}}processFontFiles(e,i){return(e=e.filter(e=>!i.includes(e.name)).filter(e=>BFN.DragAndDropManager.fontExtensions.includes(BFN.getExtension(e.name))).slice(0,50)).length?BFN.RequestUtils.loadScript("opentype.0.8.0.min.js",()=>window.opentype).then(()=>Promise.all(e.map(r))).catch(e=>("request_failed"===e?BeFunky.logError("Unable to load OpenType.js"):BeFunky.throwError("Font processing failed",e),[])):Promise.resolve([]);function r(e){return function(e){var t=BFN.getExtension(e.name);if(!h.map(e=>e.extension).includes(t))return Promise.reject("font_type_not_supported");return function(e){return new Promise((t,i)=>{BFN.BlobUtils.blobToArrayBuffer(e,e=>{var r=e.error,a=e.arrayBuffer;if(r)return i(r);t(a)})})}(e).then(a)}(e).then(t=>{var i,r=t.fontFamily,a=t.fontStyle,o=t.fontWeight;t.isItalic&&(i="italic_style");var s=BFN.CONST.FONT_LIST.find(e=>{return e.name===r});s&&"google"===s.type&&(i="google_font_conflict"),s&&"uploaded"===s.type&&s.files.find(e=>{return e.weight===o})&&(i="already_uploaded");var l=e.name;return{fontFamily:r,fontStyle:a,fontWeight:o,file:e,fileName:l,fileNameToUpload:n(Object.assign({fileName:l},t)),uploadProgress:null,error:i}}).catch(t=>({fileName:e.name,error:t}))}function a(e){var i;try{i=window.opentype.parse(e)}catch(e){throw BeFunky.logError("Unable to parse font file:",e),"parse_failed"}var r=[],a=function(){var e=i.getEnglishName("preferredSubfamily")||i.getEnglishName("fontSubfamily")||"Regular";r.push(e);var t=(i.getEnglishName("postScriptName")||"").split("-"),a=2===t.length?t[1]:"";if(a&&e&&"italic"!==h(e)&&h(a)!==h(e)){r.push(a);if({Reg:"Regular",Lt:"Light",Med:"Medium",SmBd:"Semibold"}[a]===e)return e;var n=i.getEnglishName("fullName")||"",o=n.includes(e),s=n.includes(a);return o&&!s?(BeFunky.logError("Font style (".concat(e,") does not match postScriptName (").concat(a,"). Choosing the former: ").concat(e,"."),i.names),e):(BeFunky.logError("Font style (".concat(e,") does not match postScriptName (").concat(a,"). Choosing the later: ").concat(a,"."),i.names),a)}return e}();if(!a)throw"no_style";var n=function(){var e=i.getEnglishName("preferredFamily");if(e)return e;var t=new RegExp(r.map(e=>e.trim().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"ig"),n=["fullName","fontFamily"].map(e=>i.getEnglishName(e)).filter(Boolean).map(e=>e.replace(t,"").replace(/italic( |$)/i,"").replace(/\s+/g," ").replace(/(^-+)|(-+$)/g,"").trim());if(!n.length)return"";if(1===n.length)return n[0];((e,t)=>(e=h(e).replace(/italic|condensed|extended|oblique/g,""),t=h(t).replace(/italic|condensed|extended|oblique/g,""),e===t))(...n)||BeFunky.throwError("Font family detection should be improved",{fontStyle:a,options:n},i.names);return n[0].length>=n[1].length?n[0]:n[1]}().replace(/'s( |$)/g,"’s$1");if(!n)throw"no_family_name";var o=function(){var e=["italic","condensed","extended","oblique","no\\.? \\d+","caps"],r=a.toLowerCase().trim();r=r.includes(" ")?r.replace(new RegExp("(^| )".concat(e.join("|"),"( |$)"),"g"),""):r.replace(new RegExp(e.join("|"),"g"),"");var o=l(r),s=Object.entries(c).map(e=>{var i=t(e,2),r=i[0],a=i[1];return[r,l(a)]}),u={demibold:"semibold",hairline:"thin"};u[o]&&(o=u[o]);var d=s.find(e=>{var i=t(e,2),r=i[1];return r===o});if(d)return parseInt(d[0]);if(!(/bold/i.test(a)||/light/i.test(a)||/thin/i.test(a)))return"italic"!==h(a)&&BeFunky.logError("Unable to get weight for font. Defaulting to 400.",{fontStyle:a,fontFamily:n}),400;BeFunky.throwError("Font weight matching should be improved",i.names)}();if(!o)throw"no_weight";var s=/italic/i.test(a);return console.log({fontFamily:n,fontStyle:a,fontWeight:o,isItalic:s}),{fontFamily:n,fontStyle:a,fontWeight:o,isItalic:s};function l(e){return e.toLowerCase().replace(/[^a-z]/g,"")}function h(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}}function n(e){var t=e.fileName,i=e.fontFamily,r=e.fontStyle,a=e.fontWeight,n=BFN.getExtension(t),o=i.replace(/[^a-z0-9-]/gi,""),s=r.replace(/[^a-z0-9-]/gi,""),l=BFN.getDateParts().slice(0,3).join(""),h=BeFunky.randomString(10);return"".concat(o,"-").concat(s,"-").concat(a,"-").concat(l,"-").concat(h,".").concat(n)}}migrateOldUserDefinedSystemFonts(){if(BFN.BfnService.userIsPlus){var e=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return BeFunky.logFeature("font_migration",...t)};e("Starting..."),BFN.IndexedDB.get("fonts__added-by-user").then(t=>{if(!Array.isArray(t))throw"no_fonts_to_migrate";if(!(t=t.filter(e=>e&&"string"==typeof e)).length)throw"no_fonts_to_migrate";e("Fonts to migrate:",t);var i=[];if(t.forEach(e=>{this.getFontObject(e)||this.addUserDefinedSystemFont(e)||i.push(e)}),!i.length)return e("No fonts to upload. Clearing data."),BFN.IndexedDB.delete("fonts__added-by-user");var r=i.map(e=>BFN.IndexedDB.get("fonts__".concat(e)).then(t=>(t instanceof Blob?t.name="".concat(e,".otf"):i=i.filter(t=>t!==e),t)).catch(t=>BeFunky.logError("Unable to get stored font ".concat(e),t)));Promise.all(r).then(t=>{t=t.filter(e=>e instanceof Blob),e("Got ".concat(t.length," font files from IndexedDB")),t&&this.processFontFiles(t,[]).then(t=>{var r=t.filter(e=>!e.error);e("Uploading ".concat(r.length," / ").concat(t.length," font files"),t),this.uploadUserFonts(r,!1);var a=()=>{e("Cleaning up IndexedDB after migration"),r.forEach(e=>{var t=e.fileName,r=e.uploadProgress,a=t.replace(".otf","");if(100===r){i=i.filter(e=>e!==a);var n="fonts__".concat(a);BFN.IndexedDB.delete(n).catch(e=>{BeFunky.logError('Unable to delete font "'.concat(a,'" after uploading'),e)})}}),i.length?BFN.IndexedDB.set("fonts__added-by-user",i).catch(BeFunky.logError):BFN.IndexedDB.delete("fonts__added-by-user").catch(BeFunky.logError)};BeFunky.waitUntil({condition:()=>r.every(e=>100===e.uploadProgress),onSuccess:a,onTimeout:a,maxAttempts:30,interval:500})})})}).catch(t=>{"no_fonts_to_migrate"!==t?BeFunky.throwError("Unable to migrate fonts__added-by-user",t):e("No fonts to migrate")})}else window.onUserStatusChange(()=>{BFN.BfnService.userIsPlus&&this.migrateOldUserDefinedSystemFonts()})}uploadUserFonts(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];function i(e){var t=BFN.getExtension(e.name),i=(h.find(e=>e.extension===t)||{}).mimeType;return i||BeFunky.throwError('Unsupported font type "'.concat(t,'"'),e.name),i}e.forEach(e=>{var r=e.fileNameToUpload,a=e.file,n=e.fontFamily,o=e.fontWeight;this.uploadingFonts[r]?BeFunky.throwError("Duplicate font file upload attempt"):(this.updateFontUploadProgress(e,0,t),this.uploadingFonts[r]=BeFunky.uploadFileToS3(a,{bucket:"user-fonts",contentType:i(a),fileName:r,progressHandler:(i,r)=>{var a=Math.round(100*i/r);this.updateFontUploadProgress(e,a,t)}}),this.uploadingFonts[r].then(()=>{this.updateFontUploadProgress(e,100,t),function(e,t,i){BFN.SettingsManager.getSetting("fonts_added").then(r=>{var a={name:e,type:"uploaded",weight:t,fileName:i};BFN.SettingsManager.updateSetting("fonts_added",[...r,a])})}(n,o,r)}).catch(t=>{this.uploadingFonts[r].wasCancelled?BeFunky.logError("Font upload cancelled:",r):(BeFunky.logError("Font upload failed:",t),e.error=t),this.updateFontUploadProgress(e,null)}).then(()=>{delete this.uploadingFonts[r]}))})}cancelUserFontUpload(e){var t=e.fileNameToUpload;this.uploadingFonts[t].cancelUpload(),this.uploadingFonts[t].wasCancelled=!0}updateFontUploadProgress(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.uploadProgress=t,i&&(this.fontManagerComponent.state.fontsToUpload.includes(e)||BeFunky.throwError("Font not in fontsToUpload"),this.fontManagerComponent.setState({fontsToUpload:[...this.fontManagerComponent.state.fontsToUpload]}))}get activeFont(){return this._activeFont}set activeFont(e){(e=p(e))!==this._activeFont&&(this._activeFont=e,this.fontMenuComponent&&this.fontMenuComponent.setState({activeFontName:e}),this.popoverButtonText&&(this.popoverButtonText.textContent=this.activeFont))}get activeFontWeight(){return this._activeFontWeight}set activeFontWeight(e){m(e)?e!==this._activeFontWeight&&(this._activeFontWeight=e,this.fontMenuComponent&&this.fontMenuComponent.setState({activeFontWeight:e})):BeFunky.throwError("Invalid font weight:",e)}}BFN.SingletonQueue.add(()=>{BFN.FontManager=new gu});class fu{constructor(){this.init()}init(){BeFunky.log("FabricManager Init"),this.initDefaultValues(),this.initFabricCanvas(),this.initDefaultFont()}initDefaultValues(){this.$fabricCanvas=document.getElementById("fabricCanvas"),fabric.Object.prototype.transparentCorners=!1,this.textChanged=!1,this.styleChanged=!1,this.styleUpdating=!1,this.globalStylesUpdating=!1,this.styleChangeRequested=!1,this.desiredStyle=null,this.lastSelectionStart=-1,this.lastSelectionEnd=-1,this.mixedCharacter="—",this.userStyle={globalStyles:{},charStyles:{},itemStyles:{}},this.startValues={},this.globalStyles=["textAlign","charSpacing","lineHeight"],this.itemStyles=["backgroundColor","backgroundIntensity","backgroundPadding"],this.handleTextChangedBind=this.handleTextChanged.bind(this),this.handleTextSelectionChangedBind=this.handleTextSelectionChanged.bind(this),this.handleTextEditingExitedBind=this.handleTextEditingExited.bind(this),this.handleTextRightClickBind=this.handleTextRightClick.bind(this),this.handleTextDisplayUpdatedBind=this.handleTextDisplayUpdated.bind(this),this.handleBGMouseDownBind=this.handleBGMouseDown.bind(this),this.handleStageDimensionsUpdatedBind=this.handleStageDimensionsUpdated.bind(this),this.handleMainUIRenderedBind=this.handleMainUIRendered.bind(this),this.handleTextDeselectedBind=this.handleTextDeselected.bind(this),this.addStyleChangesToHistoryDebounced=BeFunky.debounce(this.addStyleChangesToHistoryDebounced.bind(this),200),document.addEventListener("keydown",this.handleDocumentKeyPress.bind(this),!0),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,()=>setTimeout(BFN.FabricManager.updateStageDimensions.bind(this),0)),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.CUSTOM_RESIZE_EVENT.type,()=>setTimeout(BFN.FabricManager.updateStageDimensions.bind(this),0))}initFabricCanvas(){this.updateStageDimensions(),this.fabricCanvas=new fabric.Canvas("fabricCanvas",{enableRetinaScaling:2===window.bfn_resolution,fireRightClick:!0,stopContextMenu:!0}),this.fabricCanvas.selection=!1,this.fabricCanvasContext=this.fabricCanvas.getContext(),this.$fabricCanvas.setStyles({display:"none"})}updateStageDimensions(){var e={width:BFN.appRect.width-BFN.CSS.leftMenuBarWidth,height:BFN.appRect.height-BFN.CSS.topMenuBarHeight};e.width<1&&e.height<1||(this.fabricCanvas?this.fabricCanvas.width===e.width&&this.fabricCanvas.height===e.height||(this.fabricCanvas.setWidth(e.width),this.fabricCanvas.setHeight(e.height)):(this.$fabricCanvas.setAttribute("width",e.width),this.$fabricCanvas.setAttribute("height",e.height)))}initDefaultFont(){this.activeFontFamily=null,this.activeFontWeight=null,setTimeout(()=>{this.loadFont(this.defaultFontFamily,this.defaultFontWeight)},100)}handleTextEditSelection(){var e=this;if("text"===BFN.TransformModel.selectedGroupType){var t=UITools.getToolVO("text_edit"),i=function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t.updating?(e.styleUpdating||(e.styleUpdating=!0,BFN.TransformItemGroup.createTransition(i),r&&r()),!1):(e.styleUpdating||(BFN.TransformItemGroup.createTransition(i),r&&r()),e.styleUpdating=!1,!0)},r=()=>{BFN.TransformItemGroup.transformLayer.transformTool.updateDisplay(),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.increase()},a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;for(var n in t){var o=t[n];e.setUserStyle(n,o)}BFN.TransformItemGroup.selectedItems.forEach(e=>{e.setITextStyle(i?i(e):t)}),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.decrease(),BFN.TransformItemGroup.strokeRectanglePool.clear(),BFN.TransformItemGroup.registerTransition(a,!0,!0,r,!0)};switch(t.updating_id){case"spacing_menu_popover_button":case"background_padding_popover_button":case"outline_width_popover_button":if(!t.updating){var n=document.getElementById("text_edit_".concat(t.updating_id.replace("_button","")));n.hasClass("active")?n.hide():n.show()}return;case"font":if(i(this.activeFontFamily===t.font?"history_font_weight":"history_font_family")){var o=p(t.font);this.setUserStyle("fontFamily",o),this.loadFont(o,t.weight)}break;case"size":i("history_font_size")&&(BFN.TransformItemGroup.selectedItems.forEach(e=>{var i=e.iText,r=i.charSpacing,a=e.textBackgroundPadding,n=t.size/(e.scale.x*e.textScale);for(var o in this.setStyle(i,"fontSize",n),e.conformITextToSmallestFontSize(),e.textScale/=e.fontSizeNormalizeFactor,i.styles){var s=i.styles[o];for(var l in s){var h=s[l];h.hasOwnProperty("strokePercent")&&h.hasOwnProperty("fontSize")&&(h.strokeWidth=h.strokePercent*h.fontSize)}}var c=null;for(var u in i.styles){var d=i.styles[u];for(var m in d){var p=d[m];p.hasOwnProperty("fontSize")&&(null===c||p.fontSize<c)&&(c=p.fontSize)}}var g=1;null!==c&&(g=c/BFN.TransformItemTextBaseFontSize),i.charSpacing=Math.round(r*g),e.textBackgroundPadding=a*g,e.updateITextBackgroundDisplay(),i.__skipDimension=!1,i.initDimensions(),e.setTextWidth(e.iText.width*e.textScale*e.scale.x)}),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.decrease(),BFN.TransformItemGroup.strokeRectanglePool.clear(),BFN.TransformItemGroup.registerTransition(void 0,!0,!0,r,!0));break;case"bold":if(i("history_text_bold"))a({fontWeight:t.bold?this.getBoldWeight(t.font):this.getNormalWeight(t.font)},null,!0);break;case"italic":if(i("history_text_italic"))a({fontStyle:t.italic?"italic":""},null,!0);break;case"underline":if(i("history_text_underline"))a({underline:t.underline},null,!0);break;case"spacing":i("history_letter_spacing")&&a({charSpacing:100*t.spacing});break;case"line_height":i("history_text_line_height")&&a({lineHeight:t.line_height/100});break;case"align":i("history_text_align")&&a({textAlign:t.align},null,!0);break;case"text_color":if(i("history_text_color",()=>{var e=BFN.TransformItemGroup.getTextGroupStyleData();("mixed"!==e.fill&&"#00000000"!==e.fill||-1==t.text_color)&&-1!=t.text_color||(UITools.setToolValue("text_edit","text_color_intensity",1,!1),UITools.updateToolControl("text_edit_text_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}))a({fill:-1==t.text_color?"#00000000":BFN.ColorUtil.hexStringObjectToRGBAString({hex:t.text_color,alpha:t.text_color_intensity})});break;case"background_color":i("history_text_background_color",()=>{var e=BFN.TransformItemGroup.getTextGroupStyleData();("mixed"!==e.backgroundColor&&-1!==e.backgroundColor&&"mixed"!==e.backgroundIntensity||-1==t.background_color)&&-1!=t.background_color||(UITools.setToolValue("text_edit","background_color_intensity",1,!1),UITools.updateToolControl("text_edit_background_color"),BFN.ColorPickerPanel.refreshIntensitySlider())})&&a({backgroundColor:t.background_color,backgroundIntensity:t.background_color_intensity});break;case"background_padding":i("history_text_background_padding")&&a({backgroundPadding:t.background_padding});break;case"stroke_color":if(i("history_text_outline_color",()=>{var e=BFN.TransformItemGroup.getTextGroupStyleData();("mixed"!==e.stroke&&""!==e.stroke||-1==t.stroke_color)&&-1!=t.stroke_color||(UITools.setToolValue("text_edit","stroke_color_intensity",1,!1),UITools.updateToolControl("text_edit_stroke_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}))a({stroke:-1==t.stroke_color?"":BFN.ColorUtil.hexStringObjectToRGBAString({hex:t.stroke_color,alpha:t.stroke_color_intensity})});break;case"stroke_width":if(i("history_text_outline_width"))a({strokePercent:this.factorToTextStrokePercent((t.stroke_width-1)/99)});break;case"highlight_color":if(i("history_text_highlight_color",()=>{var e=BFN.TransformItemGroup.getTextGroupStyleData();("mixed"!==e.textBackgroundColor&&""!==e.textBackgroundColor||-1==t.stroke_color)&&-1!=t.stroke_color||(UITools.setToolValue("text_edit","highlight_color_intensity",1,!1),UITools.updateToolControl("text_edit_highlight_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}))a({textBackgroundColor:-1==t.highlight_color?"":BFN.ColorUtil.hexStringObjectToRGBAString({hex:t.highlight_color,alpha:t.highlight_color_intensity})})}}}handleTextEdit(){if("text"!==BFN.TransformModel.selectedGroupType){var e=UITools.getToolVO("text_edit"),t=this.textTransformItem;if(this.updateLastTransitionIfGlobal=!1,t){this.textChanged&&(this.textChanged=!1,t.setTextWidth(t.iText.width*t.textScale*t.scale.x),t.registerTransition(!1,!1)),this.styleChanged=!1;var i=t.iText;switch(e.updating_id){case"spacing_menu_popover_button":case"background_padding_popover_button":case"outline_width_popover_button":if(!e.updating){var r=document.getElementById("text_edit_".concat(e.updating_id.replace("_button","")));r.hasClass("active")?r.hide():r.show()}return;case"font":var a=this.activeFontFamily!==e.font,n=this.activeFontWeight!==e.weight;if(!a&&!n)return;a?this.createTransformItemTransition(t,"history_font_family"):this.createTransformItemTransition(t,"history_font_weight");var o=p(e.font);return this.loadFont(o,e.weight),this.setUserStyle("fontFamily",o),void this.setUserStyle("fontWeight",e.weight);case"align":e.align!=i.textAlign&&(this.createTransformItemTransition(t,"history_text_align"),this.setStyle(i,"textAlign",e.align,!0),this.setUserStyle("textAlign",e.align)),this.updateLastTransitionIfGlobal=!0;break;case"bold":this.createTransformItemTransition(t,"history_text_bold");var s=this.isBoldWeight(this.getStyle(i,"fontWeight"))?this.getNormalWeight(e.font):this.getBoldWeight(e.font);this.setStyle(i,"fontWeight",s),this.setUserStyle("fontWeight",s),BFN.FontManager.activeFontWeight=this.getWeightNumber(s),this.updateLastTransitionIfGlobal=!0,e.weight!==s&&UITools.setControlValue("text_edit_weight",s);break;case"italic":this.createTransformItemTransition(t,"history_text_italic");var l="italic"===this.getStyle(i,"fontStyle");this.setStyle(i,"fontStyle",l?"":"italic"),this.setUserStyle("fontStyle",l?"":"italic"),this.updateLastTransitionIfGlobal=!0;break;case"underline":this.createTransformItemTransition(t,"history_text_underline");var h=this.getStyle(i,"underline")||!1;this.setStyle(i,"underline",!h),this.setUserStyle("underline",!h),this.updateLastTransitionIfGlobal=!0;break;case"stroke_width":e.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(t,"history_text_outline_width")):(this.styleUpdating||this.createTransformItemTransition(t,"history_text_outline_width"),this.styleUpdating=!1);var c=this.factorToTextStrokePercent((e.stroke_width-1)/99);if(this.setStyle(i,"strokePercent",c),this.setUserStyle("strokePercent",c),"global"===this.textModifyMode)for(var u in i.styles){var d=i.styles[u];for(var m in d){var g=d[m];g.hasOwnProperty("strokePercent")&&g.hasOwnProperty("fontSize")&&(g.strokeWidth=Math.max(g.strokePercent*g.fontSize,1/(t.textScale*t.scale.x)))}}else if("selection"===this.textModifyMode){var f=Math.max(this.getStyle(i,"fontSize")*c,1/(t.textScale*t.scale.x));this.setStyle(i,"strokeWidth",f),this.setUserStyle("strokeWidth",f)}break;case"background_padding":e.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(t,"history_text_background_padding")):(this.styleUpdating||this.createTransformItemTransition(t,"history_text_background_padding"),this.styleUpdating=!1),t.textBackgroundPadding=e.background_padding,t.updateITextBackgroundDisplay(),this.setUserStyle("backgroundPadding",e.background_padding),this.styleChanged=!0;break;case"background_color":if(e.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(t,"history_text_background_color")):(this.styleUpdating||this.createTransformItemTransition(t,"history_text_background_color"),this.styleUpdating=!1),"background_color"===e.updating_id){var v=t.textBackgroundColor;-1==e.background_color&&-1!=v?(UITools.setToolValue("text_edit","background_color_intensity",0),UITools.updateToolControl("text_edit_background_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=e.background_color&&-1==v&&(UITools.setToolValue("text_edit","background_color_intensity",1),UITools.updateToolControl("text_edit_background_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}t.textBackgroundColor=e.background_color,t.textBackgroundIntensity=e.background_color_intensity,t.updateITextBackgroundDisplay(),this.setUserStyle("backgroundColor",e.background_color),this.setUserStyle("backgroundIntensity",e.background_color_intensity),this.styleChanged=!0;break;case"highlight_color":if(e.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(t,"history_text_highlight_color")):(this.styleUpdating||this.createTransformItemTransition(t,"history_text_highlight_color"),this.styleUpdating=!1),"highlight_color"===e.updating_id){var y=this.getStyle(i,"textBackgroundColor");-1==e.highlight_color&&""!=y?(UITools.setToolValue("text_edit","highlight_color_intensity",0),UITools.updateToolControl("text_edit_highlight_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=e.highlight_color&&""==y&&(UITools.setToolValue("text_edit","highlight_color_intensity",1),UITools.updateToolControl("text_edit_highlight_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}var x=-1==e.highlight_color?"":BFN.ColorUtil.hexStringObjectToRGBAString({hex:e.highlight_color,alpha:e.highlight_color_intensity});this.setStyle(i,"textBackgroundColor",x),this.setUserStyle("textBackgroundColor",x);break;case"text_color":if(e.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(t,"global"===this.textModifyMode?"history_text_color":"history_text_color_selection")):(this.styleUpdating||this.createTransformItemTransition(t,"global"===this.textModifyMode?"history_text_color":"history_text_color_selection"),this.styleUpdating=!1),"text_color"===e.updating_id){var _=this.getStyle(i,"fill");-1==e.text_color&&"#00000000"!==_?(UITools.setToolValue("text_edit","text_color_intensity",0),UITools.updateToolControl("text_edit_text_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=e.text_color&&"#00000000"===_&&(UITools.setToolValue("text_edit","text_color_intensity",1),UITools.updateToolControl("text_edit_text_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}var I=-1==e.text_color?"#00000000":BFN.ColorUtil.hexStringObjectToRGBAString({hex:e.text_color,alpha:e.text_color_intensity});this.setStyle(i,"fill",I),this.setUserStyle("fill",I);break;case"stroke_color":if(e.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(t,"history_text_outline_color")):(this.styleUpdating||this.createTransformItemTransition(t,"history_text_outline_color"),this.styleUpdating=!1),"stroke_color"===e.updating_id){var T=this.getStyle(i,"stroke");-1==e.stroke_color&&""!=T?(UITools.setToolValue("text_edit","stroke_color_intensity",0),UITools.updateToolControl("text_edit_stroke_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=e.stroke_color&&""==T&&(UITools.setToolValue("text_edit","stroke_color_intensity",1),UITools.updateToolControl("text_edit_stroke_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}var b=-1==e.stroke_color?"":BFN.ColorUtil.hexStringObjectToRGBAString({hex:e.stroke_color,alpha:e.stroke_color_intensity});this.setStyle(i,"stroke",b),this.setUserStyle("stroke",b);break;case"spacing":e.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(t,"history_letter_spacing")):(this.styleUpdating||this.createTransformItemTransition(t,"history_letter_spacing"),this.styleUpdating=!1),this.setStyle(i,"charSpacing",100*e.spacing,!0),this.setUserStyle("charSpacing",100*e.spacing);break;case"line_height":e.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(t,"history_text_line_height")):(this.styleUpdating||this.createTransformItemTransition(t,"history_text_line_height"),this.styleUpdating=!1),this.setStyle(i,"lineHeight",e.line_height/100,!0),this.setUserStyle("lineHeight",e.line_height/100);break;case"size":var S=()=>{this.startValues.charSpacing=i.charSpacing,this.startValues.textBackgroundPadding=t.textBackgroundPadding,this.createTransformItemTransition(t,"history_font_size")};e.updating?this.styleUpdating||(this.styleUpdating=!0,S()):(this.styleUpdating||S(),this.styleUpdating=!1,this.styleChanged=!0);var C=e.size/(t.scale.x*t.textScale);if(this.setStyle(i,"fontSize",C),this.setUserStyle("fontSize",C),"global"===this.textModifyMode)for(var B in this.styleUpdating||(t.conformITextToSmallestFontSize(),t.textScale/=t.fontSizeNormalizeFactor),i.styles){var F=i.styles[B];for(var E in F){var P=F[E];P.hasOwnProperty("strokePercent")&&P.hasOwnProperty("fontSize")&&(P.strokeWidth=P.strokePercent*P.fontSize)}}else if("selection"===this.textModifyMode){var N=C*this.factorToTextStrokePercent((e.stroke_width-1)/99);this.setStyle(i,"strokeWidth",N)}var M=null;for(var D in i.styles){var w=i.styles[D];for(var k in w){var L=w[k];L.hasOwnProperty("fontSize")&&(null===M||L.fontSize<M)&&(M=L.fontSize)}}var O=1;null!==M&&(O=M/BFN.TransformItemTextBaseFontSize),i.charSpacing=Math.round(this.startValues.charSpacing*O),t.textBackgroundPadding=this.startValues.textBackgroundPadding*O,t.updateITextBackgroundDisplay(),"selection"===this.textModifyMode&&this.styleUpdating&&(this.styleChanged=!1,this.fabricCanvasContext.lineJoin="round",this.fabricCanvas.renderAll())}}var R=!1;if(!e.updating)switch(e.updating_id){case"highlight_color":case"text_color":case"stroke_color":R=!0}this.applyStyleChange(e.updating_id,R)}else this.handleTextEditSelection()}createTransformItemTransition(e,t){!this.styleChangeRequested&&e&&t&&e.createTransition(t)}createNewText(){BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel).addedItem={type:"text"}}editText(e,t,i){this.currentTextTransformItem=e,this.currentTextTransformItem.visible=!1,BFN.MainUI.requestRender(),this.textChanged=!1,this.currentTextTransformItem.createTransition("history_text_content");var r=e.iText;r.backupStyle={};try{var a=r.getSelectionStyles(0,0,!0);a.length&&Object.assign(r.backupStyle,a[0])}catch(e){}if(this.isDefaultText(this.currentTextTransformItem.iText.text))for(var n in r.text="",r.styles)delete r.styles[n];r.onDeselect!=this.handleTextDeselectedBind&&(r.onDeselect=this.handleTextDeselectedBind),r.backgroundColor="rgba(170,170,221,.5)",this.$fabricCanvas.setStyles({display:"block"}),this.conformITextToTransformItem(e),this.fabricCanvas.add(r),document.getElementById("appViewportBG").addClass("active"),document.getElementById("appViewport").addClass("active"),BFN.updateFloatingElementDisplayImmediately(),this.fabricCanvas.setActiveObject(r);var o=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,screenX:t,screenY:i,clientX:t,clientY:i}),s=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,screenX:t,screenY:i,clientX:t,clientY:i});r.fire("mousedown",{e:o}),r.fire("mouseup",{e:s}),r.fire("mousedown",{e:o}),r.fire("mouseup",{e:s}),document.getElementById("appViewportBG").addEventListener(BeFunky.pointerdown,this.handleBGMouseDownBind),requestAnimationFrame(()=>{this.currentTextTransformItem&&(this.currentTextTransformItem.iText.onClick(),this.currentTextTransformItem.iText.selectAll(),this.currentTextTransformItem.iText.hiddenTextarea&&this.currentTextTransformItem.iText.hiddenTextarea.setStyles({lineHeight:"10px"}),r.on("changed",this.handleTextChangedBind),r.on("selection:changed",this.handleTextSelectionChangedBind),r.on("editing:exited",this.handleTextEditingExitedBind),r.on("mousedown",this.handleTextRightClickBind),this.handleTextSelectionChangedBind(),this.fabricCanvasContext.lineJoin="round",this.fabricCanvas.renderAll(),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdatedBind),BFN.PhotoEditorCanvas.handleCanvasMouseOut())})}conformITextToTransformItem(e){if(e){var t=e.iText,i=e.canvasScale*e.textScale*e.scale.x;t.scaleX=t.scaleY=i,t.flipX=e.flippedHorizontal,t.flipY=e.flippedVertical,t.rotate(e.rotation*(180/Math.PI)),t.left=e.transform.worldTransform.tx-BFN.MainUI.x,t.top=e.transform.worldTransform.ty-BFN.MainUI.y}}applyStyleChange(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.textTransformItem;if(i&&this.styleChanged){this.styleChanged=!1;var r=i.iText;if(t)r.__skipDimension=!1,r.initDimensions();else switch(e){case"font":case"size":case"spacing":case"line_height":case"bold":case"italic":case"underline":case"align":case"stroke_width":r.__skipDimension=!1,r.initDimensions()}i.ignoreAccurateBounds=this.styleUpdating,i.setTextWidth(i.iText.width*i.textScale*i.scale.x,!1,!1),"global"===this.textModifyMode&&(this.globalStylesUpdating||(this.globalStylesUpdating=!0,this.showTransformItemIText(i))),this.styleUpdating||(this.styleChangeRequested=!0,i.preventEditText=!0,this.addStyleChangesToHistoryDebounced(i)),"global"===this.textModifyMode?i.transformTool.updateDisplay():!this.styleUpdating&&r.hiddenTextarea&&r.hiddenTextarea.focus(),this.fabricCanvasContext.lineJoin="round",this.fabricCanvas.requestRenderAll()}}addStyleChangesToHistoryDebounced(e){this.styleChangeRequested=!1,e.preventEditText=!1,e.setTextWidth(e.iText.width*e.textScale*e.scale.x,!1,!0),this.globalStylesUpdating&&(this.globalStylesUpdating=!1,requestAnimationFrame(()=>{this.globalStylesUpdating||this.hideTransformItemIText(e)}));var t=this.updateLastTransitionIfGlobal&&"global"===this.textModifyMode;e.registerTransition(t,!1),t||e.createTransition("history_text_content")}showTransformItemIText(e){this.showingTransformItemIText=!0,this.$fabricCanvas.setStyles({display:"block"}),e.toggleHiResText(!0),BFN.MainUI.renderCanvas(),this.conformITextToTransformItem(e),this.fabricCanvas.add(e.iText),this.fabricCanvasContext.lineJoin="round",this.fabricCanvas.renderAll()}hideTransformItemIText(e){this.showingTransformItemIText=!1;var t=()=>{this.showingTransformItemIText||(BFN.HiResTextManager.useHiResText||BFN.MainUI.renderCanvas(),this.removeAllFabricCanvasObjects(),this.$fabricCanvas.setStyles({display:"none"}))};e?e.updateHiResTextBounds(!0,t):t()}removeAllFabricCanvasObjects(){for(var e=this.fabricCanvas.getObjects(),t=0;t<e.length;t++)this.fabricCanvas.remove(e[t]);this.fabricCanvas.clear()}updateTextMenu(e){if(e&&e.hasOwnProperty("fontSizeStart")){for(var t in e)if(void 0===e[t])return;!BFN.TransformModel.selectedTransformItem&&this.currentTextTransformItem&&this.currentTextTransformItem.iText.isEditing;var i={},r=(e,t)=>{i[e]=t};r("font","mixed"===e.fontFamily?this.mixedCharacter:p(e.fontFamily)),r("size","mixed"===e.fontSize?"mixed"===e.fontSizeStart?e.fontSizeMin:e.fontSizeStart:e.fontSize),r("size_mixed","mixed"===e.fontSize),r("weight",this.getWeightNumber(e.fontWeight)),r("bold",this.isBoldWeight(e.fontWeight)),r("italic","italic"===e.fontStyle),r("underline",!!e.underline&&"mixed"!==e.underline),r("spacing","mixed"===e.charSpacing?0:e.charSpacing/100),r("line_height",100*("mixed"===e.lineHeight?BFN.TransformItemTextBaseLineHeight:e.lineHeight)),r("align",e.textAlign);var a=e.fill&&"mixed"!==e.fill?e.fill:"#00000000";if("#00000000"!==a){var n=BFN.ColorUtil.rgbaStringToHexStringObject(a);r("text_color",n.hex),r("text_color_intensity",n.alpha)}else r("text_color",-1),r("text_color_intensity","mixed"===e.fill?1:0);var o=e.backgroundColor&&"mixed"!==e.backgroundColor?e.backgroundColor:-1;-1!=o&&"mixed"!==e.backgroundIntensity?(r("background_color",o),r("background_color_intensity",e.backgroundIntensity)):(r("background_color",-1),r("background_color_intensity","mixed"===e.backgroundColor?1:0)),r("background_padding",e.hasOwnProperty("backgroundPadding")&&"mixed"!==e.backgroundPadding?e.backgroundPadding:0);var s=e.stroke&&"mixed"!==e.stroke?e.stroke:"";if(""!==s){var l=BFN.ColorUtil.rgbaStringToHexStringObject(s);r("stroke_color",l.hex),r("stroke_color_intensity",l.alpha)}else r("stroke_color",-1),r("stroke_color_intensity",0);var h=e.strokePercent&&"mixed"!==e.strokePercent?e.strokePercent:BFN.TransformItemTextStrokePercentDefault;r("stroke_width",Math.round(99*this.textStrokePercentToFactor(h))+1);var c=e.textBackgroundColor&&"mixed"!==e.textBackgroundColor?e.textBackgroundColor:"";if(""!==c){var u=BFN.ColorUtil.rgbaStringToHexStringObject(c);r("highlight_color",u.hex),r("highlight_color_intensity",u.alpha)}else r("highlight_color",-1),r("highlight_color_intensity","mixed"===e.textBackgroundColor?1:0);["font","weight","size","bold","italic","underline","spacing","line_height","align","text_color","text_color_intensity","background_color","background_color_intensity","background_padding","stroke_color","stroke_color_intensity","stroke_width","highlight_color","highlight_color_intensity"].forEach(e=>{i.hasOwnProperty(e)||BeFunky.throwError("Style Data Object Parameter Missing",e),"font"===e?(this.activeFontFamily=i.font===this.mixedCharacter?null:i.font,BFN.FontManager.activeFont=p(i.font)):"weight"===e&&(this.activeFontWeight=BFN.FontManager.activeFontWeight=i.weight),UITools.setToolValue("text_edit",e,i[e])}),UITools.updateToolControls("text_edit"),document.getElementById("text_edit_size").mixed=!!i.size_mixed}}loadFont(e,t){m(t)||(BeFunky.logError("Invalid font weight for ".concat(e,":"),t),t=this.defaultFontWeight),this.activeFontFamily=e,this.activeFontWeight=t;var i=this.isBoldWeight(this.activeFontWeight);if(UITools.getControlValue("text_edit_bold")!==i&&(UITools.setControlValue("text_edit_bold",i),UITools.updateToolControl("text_edit_bold")),BFN.FontManager.isLoaded(e))return this.handleWebFontLoaded(e,t);var r=()=>{this.activeFontFamily=null,BFN.TransformModel.removeEventListener(BFN.TransformModelEvents.TRANSFORM_ITEM_UPDATED.type,r)};BFN.TransformModel.addEventListener(BFN.TransformModelEvents.TRANSFORM_ITEM_UPDATED.type,r),BFN.FontManager.load(e).then(()=>this.handleWebFontLoaded(e,t)).catch(this.handleWebFontLoadError.bind(this))}setUserStyle(e,t){"fontFamily"===e&&(t=g(t)),this.itemStyles.includes(e)?this.userStyle.itemStyles[e]=t:this.globalStyles.includes(e)?this.userStyle.globalStyles[e]=t:this.userStyle.charStyles[e]=t,this.currentTextTransformItem&&this.currentTextTransformItem.iText&&this.currentTextTransformItem.iText.backupStyle&&(this.currentTextTransformItem.iText.backupStyle[e]=t)}setStyle(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"fontFamily"===t&&(i=g(i));var a={};if(a[t]=i,e.setSelectionStyles&&e.isEditing&&!r){var n=e.selectionStart||0,o=e.selectionEnd||0;n===o?(this.desiredStyle||(this.desiredStyle={}),this.desiredStyle[t]=i):e.setSelectionStyles(a,n,o)}else if(this.globalStyles.includes(t))e[t]=i;else{e.__skipDimension=-1!=["textBackgroundColor","fill","stroke"].indexOf(t);for(var s=0;s<e.text.length;s++)e._extendStyles(s,a)}this.styleChanged||(this.styleChanged=!0)}getStyle(e,t){var i="";if(e.getSelectionStyles&&e.isEditing){var r=e.selectionStart||0,a=r+1;e.text.length&&e.selectionStart>0&&(r===e.text.length||e.selectionStart===e.selectionEnd)&&(r--,a--);var n=e.getSelectionStyles(r,a,!0);i=n.length&&n[0].hasOwnProperty(t)?n[0][t]:""}else i=e.styles.hasOwnProperty("0")&&e.styles[0].hasOwnProperty("0")?e.styles[0][0][t]:e[t];return i}factorToTextStrokePercent(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*(BFN.TransformItemTextStrokePercentMax-BFN.TransformItemTextStrokePercentMin)+BFN.TransformItemTextStrokePercentMin}textStrokePercentToFactor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:BFN.TransformItemTextStrokePercentMin;return((e=Math.max(BFN.TransformItemTextStrokePercentMin,Math.min(BFN.TransformItemTextStrokePercentMax,e)))-BFN.TransformItemTextStrokePercentMin)/(BFN.TransformItemTextStrokePercentMax-BFN.TransformItemTextStrokePercentMin)}handleWebFontLoaded(e,t){if(this.activeFontFamily===e&&this.activeFontWeight===t)if("text"===BFN.TransformModel.selectedGroupType)BFN.TransformItemGroup.selectedItems.forEach(i=>{i.setITextStyle({fontFamily:e,fontWeight:t})}),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.decrease(),BFN.TransformItemGroup.strokeRectanglePool.clear(),BFN.TransformItemGroup.registerTransition(void 0,!0,!0,()=>{BFN.TransformItemGroup.transformLayer.transformTool.updateDisplay(),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.increase()},!0);else{var i=this.textTransformItem;i&&(this.setStyle(i.iText,"fontFamily",e,"global"===this.textModifyMode),this.setStyle(i.iText,"fontWeight",t,"global"===this.textModifyMode),this.applyStyleChange("font"))}}handleWebFontLoadError(e){BeFunky.logError(e)}handleTextChanged(){var e=!this.textChanged;if(this.textChanged||(this.textChanged=!0,e=!0),this.lastSelectionStart=-1,this.lastSelectionEnd=-1,this.currentTextTransformItem){var t=this.currentTextTransformItem.iText;t.__skipDimension=!1,t.text.length||(this.lastSelectionStart=0,this.lastSelectionEnd=0,t.inputErase||Object.assign(t.backupStyle,this.userStyle.charStyles));for(var i=t.getSelectionStyles(0,t.textLength||t.text.length,!0),r=Object.assign({},t.backupStyle),a=0;a<i.length;a++)i[a].hasOwnProperty("strokePercent")&&void 0!==i[a].strokePercent?r=Object.assign({},i[a]):r&&(this.desiredStyle&&Object.assign(r,this.desiredStyle),t.setSelectionStyles(r,a,a+1));e=e||1===t.text.length,this.desiredStyle&&t.selectionStart>0&&t.selectionStart===t.selectionEnd?t.setSelectionStyles(this.desiredStyle,t.selectionStart-1,t.selectionStart):e&&t.backupStyle&&1===t.selectionStart&&t.selectionStart===t.selectionEnd&&t.setSelectionStyles(t.backupStyle,t.selectionStart-1,t.selectionStart),t.text.length&&t.selectionStart===t.selectionEnd&&(i=t.selectionStart>0?t.getSelectionStyles(t.selectionStart-1,t.selectionStart,!0):t.getSelectionStyles(t.selectionStart,t.selectionStart+1,!0)).length&&Object.assign(t.backupStyle,i[0]),this.updateTextMenu(this.currentTextTransformItem.getTextStyleData())}this.desiredStyle=null}handleTextSelectionChanged(){if(this.currentTextTransformItem){var e=this.currentTextTransformItem.iText;if(e.getSelectionStyles&&e.isEditing){if(e.selectionStart===this.lastSelectionStart&&e.selectionEnd===this.lastSelectionEnd&&e.selectionStart===e.selectionEnd)return;this.lastSelectionStart=e.selectionStart,this.lastSelectionEnd=e.selectionEnd}}if(this.desiredStyle=null,this.currentTextTransformItem){var t=this.currentTextTransformItem.iText;if(t.getSelectionStyles&&t.isEditing&&t.text.length){var i=t.selectionStart||0,r=i+1,a=t.getSelectionStyles(i,r,!0);a&&a.length&&Object.assign(t.backupStyle,a[0])}this.updateTextMenu(this.currentTextTransformItem.getTextStyleData()),t.cursorColor="#FF0000"}}handleTextEditingExited(e){document.getElementById("appViewportBG").removeEventListener(BeFunky.pointerdown,this.handleBGMouseDownBind),BFN.StageModel.removeEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdatedBind),document.getElementById("appViewportBG").removeClass("active"),document.getElementById("appViewport").removeClass("active"),this.currentTextTransformItem&&(this.currentTextTransformItem.iText.backgroundColor="",this.currentTextTransformItem.iText.off("changed",this.handleTextChangedBind),this.currentTextTransformItem.iText.off("selection:changed",this.handleTextSelectionChangedBind),this.currentTextTransformItem.iText.off("editing:exited",this.handleTextEditingExitedBind),this.currentTextTransformItem.iText.off("mousedown",this.handleTextRightClickBind),this.currentTextTransformItem.refreshItemName(),this.currentTextTransformItem.addEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,this.handleTextDisplayUpdatedBind),this.currentTextTransformItem.setTextWidth(this.currentTextTransformItem.iText.width*this.currentTextTransformItem.textScale*this.currentTextTransformItem.scale.x/this.currentTextTransformItem.fontSizeNormalizeFactor))}handleTextRightClick(e){var t=e.target;if(t&&t.isEditing&&3===e.button){BFN.TooltipScreen.setPosition(e.e.pageX,e.e.pageY);var i=BeFunky.LanguageManager.getStringReplacements("guide_copy_paste",{copyShortcut:BFN.KeyboardManager.shortcutText("C"),pasteShortcut:BFN.KeyboardManager.shortcutText("V")}),r='<div style="line-height: 1.5; margin: 0 .25rem">'.concat(i,"</div>");BFN.TooltipScreen.show(r,!0,!1,!0),setTimeout(()=>{BFN.TooltipScreen.reserved=!1,t.hiddenTextarea&&t.hiddenTextarea.focus()},500)}}handleTextDisplayUpdated(){this.currentTextTransformItem.removeEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,this.handleTextDisplayUpdatedBind),this.currentTextTransformItem.selectItem(),this.currentTextTransformItem.transformTool.conformItemToBounds(),this.currentTextTransformItem.transformTool.updateDisplayForTextResize(),this.textChanged&&(this.textChanged=!1,this.currentTextTransformItem.registerTransition(!1,!1)),this.currentTextTransformItem.visible=!0,this.currentTextTransformItem.updateHiResTextBounds(!0,null,!0),BFN.MainUI.addEventListener(BFN.MainUIEvents.RENDERED.type,this.handleMainUIRenderedBind),BFN.MainUI.requestRender()}handleMainUIRendered(){BFN.MainUI.removeEventListener(BFN.MainUIEvents.RENDERED.type,this.handleMainUIRenderedBind),this.$fabricCanvas.setStyles({display:"none"}),this.removeAllFabricCanvasObjects(),this.currentTextTransformItem&&(delete this.currentTextTransformItem.iText.backupStyle,this.currentTextTransformItem=null),BFN.TransformModel.selectedTransformItemText=null,BFN.updateFloatingElementDisplay()}handleBGMouseDown(){setTimeout(()=>{this.currentTextTransformItem&&this.currentTextTransformItem.exitTextEditing()},0)}handleStageDimensionsUpdated(){this.currentTextTransformItem&&this.currentTextTransformItem.exitTextEditing()}handleTextDeselected(){setTimeout(()=>{this.currentTextTransformItem&&this.currentTextTransformItem.exitTextEditing()},0)}handleDocumentKeyPress(e){this.iTextEditing&&this.currentTextTransformItem&&this.currentTextTransformItem.iText&&this.currentTextTransformItem.iText.hiddenTextarea&&!BeFunky.isTextBoxFocused()&&this.currentTextTransformItem.iText.hiddenTextarea.focus(),90===e.keyCode&&this.iTextEditing&&(e.ctrlKey||e.metaKey)&&(e.stopImmediatePropagation(),e.preventDefault())}isBoldWeight(e){return"bold"===e||parseInt(e)>=600}getWeightNumber(e){var t=parseInt(e);return m(t)?t:"bold"===e?700:400}getFontWeights(e){if(e===this.mixedCharacter)return[];var t=BFN.FontManager.getFontObject(e);return t?(t.weights.length||BFN.FontManager.testFontWeights([t]),t.weights):(BeFunky.throwError("Unable to get font object for font",e),[])}getNormalWeight(e){var t=this.getFontWeights(e);return[400,500,300,200,100].find(e=>t.includes(e))||""}getBoldWeight(e){var t=this.getFontWeights(e);return[700,800,900,600].find(e=>t.includes(e))||"bold"}isDefaultText(e){return e.trim()===BeFunky.LanguageManager.getString("click_when_selected")}get textTransformItem(){return!this.currentTextTransformItem&&BFN.TransformModel.selectedTransformItem&&"text"===BFN.TransformModel.selectedTransformItem.type?BFN.TransformModel.selectedTransformItem:this.currentTextTransformItem&&!BFN.TransformModel.selectedTransformItem?this.currentTextTransformItem:null}get textModifyMode(){return!this.currentTextTransformItem&&BFN.TransformModel.selectedTransformItem&&"text"===BFN.TransformModel.selectedTransformItem.type?"global":this.currentTextTransformItem&&!BFN.TransformModel.selectedTransformItem?"selection":null}get iTextEditing(){return"block"===this.$fabricCanvas.style.display}get defaultFontFamily(){return BFN.FontManager.defaultFontFamily}get defaultFontWeight(){return BFN.FontManager.defaultFontWeight}}function vu(){BFN.EventDispatcher.call(this),this.init()}function yu(){var t=e(["<input @change="," @keyup=",' type="text" class="input focus-initially" maxlength="500" required>']);return yu=function(){return t},t}function xu(){var t=e(['\n        <div class="google-photos-albums__dropdown button-group">\n            ',"\n            <button @click=",' class="button button--icon button--outline" data-bfntooltip="create_album">',"</button>\n        </div>"]);return xu=function(){return t},t}function _u(){var t=e(["<div></div>"]);return _u=function(){return t},t}function Iu(){var t=e(['\n            <div class="google-photos-albums__dropdown button-group">\n                <button @click=',' class="button button--outline" style="justify-content: flex-start;">',"</button>\n            </div>"]);return Iu=function(){return t},t}function Tu(){var t=e(['\n            <div class="google-photos-albums__loading">\n                <div class="loading-spinner"></div> <string>',"</string>\n            </div>"]);return Tu=function(){return t},t}function bu(){var t=e(['\n        <div class="checkbox">\n            <input type="checkbox" id="toggle_google_photos_album" @change='," .checked=",'>\n            <label class="checkbox__label control-item-label" for="toggle_google_photos_album">\n                ',"\n                ","\n                <string>","</string>\n            </label>\n        </div>\n        ","\n        "]);return bu=function(){return t},t}function Su(){var t=e(['<div class="google-photos-albums control-item"></div>']);return Su=function(){return t},t}BFN.SingletonQueue.add(()=>{BFN.FabricManager=new fu}),vu.prototype=Object.create(BFN.EventDispatcher.prototype),vu.prototype.init=function(){BeFunky.log("OverlaysManager Init"),this.initDefaultValues()},vu.prototype.initDefaultValues=function(){this.isDataLoaded=!1,this.loadedItemCategories=[]},vu.prototype.loadCategories=function(){this.isDataLoaded||BFN.OverlaysDataLoader.load(()=>{if(!this.isDataLoaded&&!Object.keys(BFN.OverlaysData).length)return BeFunky.logError("Unable to get overlays data");this.isDataLoaded=!0,this.setupCategoryMenu()})},vu.prototype.setupCategoryMenu=function(){var e=this;BFN.UIMenuData.categoryMenus.editor_overlay.forEach(e=>{var t=e.id,i=e.name,r=t.replace("editor_overlay_","");if(!BFN.OverlaysData.hasOwnProperty(r)||!BFN.OverlaysData[r].freeOverlays.length&&!BFN.OverlaysData[r].plusOverlays.length){var a=document.getElementById(t);a.parentNode.removeChild(a)}BFN.OverlaysData.hasOwnProperty(r)&&(BFN.OverlaysData[r].formattedName=i)}),[...document.getElementById("editor_overlay_category_menu").children].forEach(e=>e.disabled=!1),this.overlayMenuData=[],this.overlayMenuDataHash={},this.overlayCategoryIDMap={},this.overlayPresetMap={},this.overlayIDMap={};var t=function(t){var i=BFN.OverlaysData[t],r={id:i.id,name:i.name,formattedName:i.formattedName,presets:[]},a=(t,i)=>{t.forEach(t=>{var a=r.id+(i?"_plus_":"_free_")+t,n="".concat(r.formattedName," ").concat(r.presets.length+1),o={id:a,name:n,isPlus:i,categoryID:r.id,categoryName:r.name,usePaint:!1,params:[{type:"static",name:"overlayID",defaultValue:a},{type:"static",name:"overlayName",defaultValue:n},{type:"static",name:"categoryID",defaultValue:r.id},{type:"static",name:"categoryName",defaultValue:r.name}]};BFN.toolViewstates["".concat(r.id,"_").concat(o.id)]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY,r.presets.push(o),e.overlayCategoryIDMap["".concat(r.id,"_").concat(o.id)]=o.id,e.overlayIDMap[o.id]=r.id,e.overlayPresetMap[o.id]=o})};a(i.freeOverlays,!1),a(i.plusOverlays,!0),e.overlayMenuData.push(r),e.overlayMenuDataHash[t]=r};for(var i in BFN.OverlaysData)t(i);UITools.initToolVOs(this.overlayMenuData)},vu.prototype.setupCategoryItems=function(e){if(!this.loadedItemCategories.includes(e)&&(this.loadedItemCategories.push(e),this.overlayMenuDataHash.hasOwnProperty(e))){var t=this.overlayMenuDataHash[e];document.getElementById("editor_tool_menu_container").insertAdjacentHTML("beforeend",'\n        <div id="overlay_'.concat(e,'_menu" class="tool-menu">\n            <div class="panel-header"></div>\n            <div class="popover-placeholder"></div>\n            <div class="menu-content tools-scrollable"></div>\n        </div>\n    '));var i=document.getElementById("overlay_".concat(e,"_menu")),r=i.querySelector(".panel-header"),a=i.querySelector(".popover-placeholder");BFN.UI.panelHeader(r,{name:t.formattedName,modifier:"tertiary",helpClueID:"effect_basic_settings"});var n=document.createDocumentFragment();t.presets.forEach(e=>{var i=document.createElement("div");i.id="".concat(e.id,"_menu"),BFN.UI.presetMenuItem(i,{presetID:"".concat(t.id,"_").concat(e.id),presetName:e.name,presetObject:e,genericMenuID:"overlay_generic_menu",brushMenuID:null,applyCancelMenuID:"editor_apply_cancel_menu",presetAmountSliderID:"overlay_generic_opacity",useProcessedThumb:!0,helpClueID:"effect_basic_settings",helpCluePlaceholder:a,header:r}),n.appendChild(i)}),i.querySelector(".menu-content").appendChild(n)}},BFN.SingletonQueue.add(()=>{BFN.OverlaysManager=new vu});var Cu=BeFunky.lit,Bu=Cu.html,Fu=Cu.setupState,Eu=Cu.render,Pu=Cu.elem,Nu=Cu.appLang,Mu=Cu.icon;function Du(e){var i,r=e.fetchAlbums,a=e.createAlbum,n=e.onToggle,o=Pu(Su()),s=BeFunky.debounce(()=>Eu(Bu(bu(),d,h.isEnabled,Mu("checkbox-selected","icon icon-size-medium checkbox__icon checkbox__icon--light checkbox__icon--checked"),Mu("checkbox-unselected","icon icon-size-medium checkbox__icon checkbox__icon--light checkbox__icon--unchecked"),Nu("save_to_album"),h.isEnabled?h.isLoading?Bu(Tu(),Nu("loading")):h.writeableAlbums.length?(i=i||Tr(Pu(_u()),{onChange:()=>{},initialOptions:h.writeableAlbums.map(e=>{var t=e.album_id;return{name:e.title,value:t}}),translateOptionNames:!1}),Bu(xu(),i,m,Mu("zoom-plus-icon","icon icon-size-small"))):Bu(Iu(),m,Nu("create_album")):""),o),"raf"),l=t(Fu({isEnabled:!1,isLoading:!1,writeableAlbums:[]},e=>{e.isEnabled&&function(){h.isEnabled&&u&&p();n(h.isEnabled)}(),e.writeableAlbums&&function(){if(!i)return;var e=h.writeableAlbums.map(e=>{var t=e.album_id,i=e.title;return{name:i,value:t}});if(!e.length)return;i.setState({options:e}),i.selectedValue=e[0].value}(),s()}),2),h=l[0],c=l[1];BeFunky.LanguageManager.addLanguageUpdateListener(s);var u=!1;return p(),Object.assign(o,{getSelectedAlbum:function(){return h.isEnabled&&!h.isLoading&&i&&i.selectedValue?i.selectedValue:void 0}}),o;function d(e){c({isEnabled:e.target.checked})}function m(){var e="",t=Pu(yu(),i,i);function i(){e=t.value.replace(/[^a-zA-Z0-9 !@#$%^&*(){}[\]:;,'".\/?\-_+=™©®]/g,""),t.value=e}BeFunky.confirm(t,{heading:"create_album",confirmText:"save",cancelText:"cancel",size:"extra-small",onConfirm:()=>{(e=e.trim())&&function(e){c({isLoading:!0}),a(e).then(e=>{c({isLoading:!1,writeableAlbums:[e,...h.writeableAlbums]})}).catch(t=>{"cancelled_by_user"!==t&&BeFunky.throwError("Unable to create Google Photos album",e,t),c({isLoading:!1,isEnabled:!1})})}(e)}})}function p(){u=!1,c({isLoading:!0}),r().then(e=>{var t=e.filter(e=>{var t=e.title,i=e.isWritable;return t&&i});c({isLoading:!1,writeableAlbums:t})}).catch(e=>{"cancelled_by_user"!==e&&BeFunky.throwError("Unable to load Google Photos albums",e),c({isLoading:!1,isEnabled:!1}),u=!0})}}class wu{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.handleWatermarkUpdatedBind=this.handleWatermarkUpdated.bind(this),this.handleUserDataChangedBind=this.handleUserDataChanged.bind(this),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChangedBind,!1,0,!0),this.saveShareMenu=document.getElementById("save_and_share_menu"),BFN.UI.saveShareModal(this.saveShareMenu),this.saveTexture=null,this.flattenedImage=null,this.altSaveTexture=null,this.saveCanvas=null,this.saveCanvasMimeType=null,this.previewCanvas=null,this.previewCanvasMimeType=null,this.previewRAF=null,this.watermarkTimestamp=null,this.destroyAltSaveTextureOnDispose=!1,this.imageQualityKey="options__saveImageQuality",window.addEventListener("INIT_COMPLETE",()=>{this.getImageQualityFromIndexedDB()}),setTimeout(()=>{var e="true"===BeFunky.getLocal("disable_save_complete_modal");e&&UITools.setControlValue("save_and_share_disable_save_complete_modal",e)},1e3),this.fileNames={editor:{image:"",project:"",layer:""},collage:{image:"",project:"",layer:""},designer:{image:"",project:"",layer:""}},this.fileNamesKey="options__saveFileNames",setTimeout(()=>this.getFileNamesFromIndexedDB(),1e3),this.saveShareMenu.filenameInput.addEventListener("change",this.saveLastTypedFileName.bind(this)),this.lastImageBlob=null,this.isGeneratingImageBlob=!1,this.imageBlobDebug=0,this.imageSizeCache={},this.imageSizeText=document.getElementById("save_and_share_image_size"),this.lastPDFBlob=null,this.lastFileName="",this.updateImageSize=BeFunky.debounce(this.updateImageSize.bind(this),0),this.updatePreviewImage=BeFunky.debounce(this.updatePreviewImage.bind(this),0),this.updateQualityGuide=BeFunky.debounce(this.updateQualityGuide.bind(this),"raf"),this.toggleImagePDFQuality=BeFunky.debounce(this.toggleImagePDFQuality.bind(this),"raf"),this.persistFileNames=BeFunky.debounce(this.persistFileNames.bind(this),200),this.persistImageQuality=BeFunky.debounce(this.persistImageQuality.bind(this),200),this.saveToComputerCount=0,this.pdfWorker=null,this.pdfCallback=(()=>{}),this.googlePhotosAlbumsComponent=null}handleUserDataChanged(){UITools.getToolValue("editor_save_image","befunky")&&BFN.BfnService.userLoggedIn&&(BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChangedBind),this.handleSave())}handleUpload(){switch(UITools.getToolValue("editor_load_image","updating_id")){case"befunky":BFN.ImageLibraryManager.openModal("befunky","UPLOAD_MENU");break;case"google_drive":BFN.BfnService.importGoogleDriveImage();break;case"google_photos":BFN.ImageLibraryManager.openModal("google","UPLOAD_MENU");break;case"stock_images":BFN.ImageLibraryManager.openModal("stock_images","UPLOAD_MENU");break;case"facebook":BFN.ImageLibraryManager.openModal("facebook","UPLOAD_MENU");break;case"dropbox":BFN.PhotoEditorModel.confirmEditorLoadImage(()=>BFN.BfnService.importDropBoxImage());break;case"webcam":BFN.PhotoEditorModel.openWebcamModal()}}handleOpenProject(){if("computer"===UITools.getToolValue("open_project","updating_id")){if(BFN.AppModel.viewingEditor)return BFN.UploadSaveShareManager.handleEditorLoadImageOrProject();return BFN.MultipleFileUploader.upload(e=>{var t=e.file;if(t){var i=BFN.getExtension(t.name);console.log("User opened file:",{name:t.name,size:BeFunky.formatBytes(t.size),section:BFN.AppModel.sectionID}),BFN.MultipleFileUploader.supportedImages.includes(i)?setTimeout(()=>{BFN.ImageLibraryManager.uploadImages(null,{files:[t]})},0):BFN.ProjectManager.loadFile(t)}},{fileType:"bfd",allowMultiple:!1,createMenuImageVO:!1})}BeFunky.SavedProjectManager.openProjectModal()}handleEditorLoadImageOrProject(){BFN.MultipleFileUploader.upload(e=>{var t=e.file;if(t){var i=BFN.getExtension(t.name);console.log("User opened file:",{name:t.name,size:BeFunky.formatBytes(t.size),section:BFN.AppModel.sectionID}),"bfd"===i?BFN.ProjectManager.loadFile(t):BFN.MultipleFileUploader.supportedImages.includes(i)?BFN.PhotoEditorModel.confirmEditorLoadImage(()=>BFN.PhotoEditorModel.onEditorImageUpload({file:t})):BeFunky.logError("User uploaded unsupported file type")}},{fileType:"imagesAndBFD",allowMultiple:!1,createMenuImageVO:!1})}handleSave(){if(!BeFunky.isPaywallEnabled()||BeFunky.isPlus()){var e=UITools.getToolValue("editor_save_image","updating_id");switch(e){case"befunky":if(BFN.BfnService.userLoggedIn)BFN.UploadSaveShareManager.handleSaveOrShareImage("save","befunky");else{var t=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");BFN.BfnService.track("CREATE",t,"SavePanelEmailRegister"),BFN.BfnService.login(BFN.UploadSaveShareManager.handleSave)}break;case"computer":case"google_drive":case"dropbox":case"project":BFN.UploadSaveShareManager.handleSaveOrShareImage("save",e);break;case"google_photos":BeFunky.GooglePhotosManager.mightBeAuthorized?(BFN.UploadSaveShareManager.setupGooglePhotosAlbums(),BFN.UploadSaveShareManager.handleSaveOrShareImage("save",e)):BeFunky.GooglePhotosManager.login(!1).then(()=>{BFN.UploadSaveShareManager.setupGooglePhotosAlbums(),BFN.UploadSaveShareManager.handleSaveOrShareImage("save",e)},e=>{"cancelled_by_user"!==e&&BeFunky.throwError("Unable to open Save to Google Photos",e)})}}else BeFunky.openTeaserModal("paywall")}handleShare(){if(!BeFunky.isPaywallEnabled()||BeFunky.isPlus())if(BFN.BfnService.userLoggedIn){var e=UITools.getToolValue("editor_share_image","updating_id");switch(e){case"facebook":case"pinterest":case"twitter":BFN.UploadSaveShareManager.handleSaveOrShareImage("share",e)}}else BeFunky.confirm("confirm_sharing_login",{onConfirm:()=>BFN.BfnService.login(BFN.UploadSaveShareManager.handleShare)});else BeFunky.openTeaserModal("paywall")}handleSaveOrShareImage(e,t,i){if(!BeFunky.isPaywallEnabled()||BeFunky.isPlus()){var r="save"===e&&"complete"===t;if(!(this.altSaveTexture&&this.altSaveTexture.valid||r)){try{this.flattenedImage.destroyGC(!0)}catch(e){}if(this.flattenedImage=null,BFN.AppModel.viewingEditor){if(!BFN.PhotoEditorModel.currentTexture)return;if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&BFN.PhotoEditorCanvasTools.currentTool){if(BFN.PhotoEditorCanvasTools.premiumWatermark.showing)return void BFN.PhotoEditorCanvasTools.applyCurrentTool("EDITOR_SAVE");BFN.PhotoEditorCanvasTools.applyCurrentTool(),BFN.PhotoEditorCanvasModel.exitCurrentEditorTool()}}var a=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);if(this.flattenedImage=a.getFlattenedImage(),!this.flattenedImage)return void BeFunky.logError("Unable to create flattened image")}if(this.panelName=t,this.saveShareMenu.mode=[e,t],!r){this.onSaveCallback=i;var n=BFN.AppModel.sectionID,o=this.saveShareMenu.filenameInput;if("project"===t?o.value=this.fileNames[n].project||"BeFunky-project":this.altSaveTexture?o.value=this.fileNames[n].layer||"BeFunky-layer":o.value=this.fileNames[n].image||"BeFunky-".concat(BFN.AppModel.sectionValue("photo","collage","design")),"computer"===t&&this.preloadPDFWorker(),this.updateSaveTexture(!0),this.saveTexture)this.saveShareMenu.dimensions.textContent="".concat(this.saveTexture.width," x ").concat(this.saveTexture.height);else if(BFN.AppModel.viewingEditor){var s=BFN.PhotoEditorModel.currentTextureDimensions,l=s.width,h=s.height;this.saveShareMenu.dimensions.textContent="".concat(l," x ").concat(h)}else{var c=BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).projectVO;this.saveShareMenu.dimensions.textContent="".concat(c.projectWidth," x ").concat(c.projectHeight)}BFN.WatermarkManager.removeEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,this.handleWatermarkUpdatedBind),BFN.WatermarkManager.addEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,this.handleWatermarkUpdatedBind),this.saveShareMenu.watermarkControl.sourceTexture=this.altSaveTexture||this.flattenedImage,BFN.WatermarkManager.activate()}}else BeFunky.openTeaserModal("paywall")}handleSaveAndShareModal(){var e=this,t=UITools.getToolValue("save_and_share","updating_id"),i=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&BFN.AppModel.viewingEditor&&(BFN.PhotoEditorModel.hasUnsavedChanges=!1),e.saveShareMenu.close()},r=e=>{if(BeFunky.hideLoadScreen(),e){if("cancel"===e)return;BeFunky.logError("Save/share error:",e),"not_login"===e&&(e="not_logged_in"),"not_logged_in"===e&&this.saveShareMenu.close();var r="error_invalid_response";BeFunky.LanguageManager.isTranslated("error_".concat(e))?r="error_".concat(e):BeFunky.LanguageManager.isTranslated(e)&&(r=e),UIMessages.display(r,1e3)}else"save"===t?(i(!0),"computer"===this.panelName?UITools.getControlValue("save_and_share_disable_save_complete_modal")?this.showUpgradePromptAfterSaving():this.handleSaveOrShareImage("save","complete"):UIMessages.display("project"===this.panelName?"project_saved":"image_saved")):("twitter"!==this.panelName&&"tumblr"!==this.panelName||UIMessages.display("image_shared"),i());!e&&this.onSaveCallback&&this.onSaveCallback()};if("save"===t||"share"===t){var a={computer:"Computer",befunky:"BeFunky",facebook:"Facebook",pinterest:"Pinterest",google_drive:"Google Drive",google_photos:"Google Photos",dropbox:"Drop Box",twitter:"Twitter",tumblr:"Tumblr"},n=null,o=null,s=!1;if("project"===this.panelName?(n="Project",o=a[UITools.getToolValue("save_and_share","project_location")]):(["computer","befunky","google_photos"].includes(this.panelName)?(n=this.getImageType().toUpperCase(),s=BFN.WatermarkManager.watermarkActive):n="JPG",o=a[this.panelName]),n&&o){var l=BFN.UserActionManager.getSaveData(),h=new BFN.UserActionVO;h.eventID="media_saved",h.eventObject={mediaSaveType:n,mediaSaveLocation:o,mediaSaveWatermark:s,mediaSaveMainFunnel:l.actions,mediaSaveFontsUsed:l.fonts,mediaSaveLayerSourcesUsed:l.assets,mediaSaveGraphicsUsed:l.graphicFileNames,mediaSaveGraphicsStyleUsed:l.graphicStyles},BFN.AppModel.viewingDesigner&&BFN.DesignerModel.projectVO.sourceTemplateID&&(h.eventObject.templateID=BFN.DesignerModel.projectVO.sourceTemplateID),h.peopleObject={lastMediaSaveDate:window.bfn_mp?window.bfn_mp.getISODate():"n/a",lifetimeMediaSaveCount:1,lifetimeImagesSaveCount:1},h.track()}else BeFunky.throwError("Save/share not tracked",{mediaSaveType:n,mediaSaveLocation:o,panelName:this.panelName})}switch(t){case"image_type":return UITools.disableControlItem("save_and_share_image_quality","jpg"!==this.getImageType()),this.updateImageSize(),this.updatePreviewImage(),this.updateQualityGuide(),void this.toggleImagePDFQuality();case"image_quality":case"pdf_quality":return void(UITools.getToolVO("save_and_share").updating?this.isGeneratingImageBlob||this.imageSizeText.addClass("save-image__size-text--updating"):(this.updateImageSize(),this.updatePreviewImage(),this.updateQualityGuide()));case"cancel":return void this.saveShareMenu.close();case"save":var c=!1;BeFunky.showLoadScreen({onCancel:()=>{c=!0}});var u={text:this.saveShareMenu.getText(),texture:this.saveTexture};return u.text?(["computer","befunky","google_photos"].includes(this.panelName)&&"jpg"===this.getImageType()&&this.persistImageQuality(),void{computer:()=>{var e=u.text||(this.altSaveTexture?"Befunky-layer":"Befunky-photo");BFN.BfnService.track("CREATE",BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER"),"SAVE_DESKTOP"),this.getImageBlobForSaving(()=>c).then(t=>{this.saveToComputer(e,t,r)}).catch(()=>{c||r("error_invalid_response")})},befunky:()=>{this.getImageBlobForSaving(()=>c).then(e=>{delete u.texture,u.blob=e,u.isPublic=!1,u.mimeType=e.type,BFN.BfnService.saveToBeFunky(u,e=>{r(e),e||BeFunky.ImagesService.resetImageData()})},()=>{c||r("error_invalid_response")})},google_drive:()=>BFN.BfnService.saveToGoogleDrive(u,r),google_photos:()=>{this.getImageBlobForSaving(()=>c).then(e=>{var t=this.googlePhotosAlbumsComponent.getSelectedAlbum();BeFunky.GooglePhotosManager.uploadMedia(e,u.text,t).then(()=>r(),e=>r(e))},()=>{c||r("error_invalid_response")})},dropbox:()=>BFN.BfnService.saveToDropBox(u,r),project:()=>{var e=UITools.getToolValue("save_and_share","project_location");if("befunky"===e&&!BFN.BfnService.userLoggedIn)return BeFunky.hideLoadScreen(),BFN.BfnService.login();var t=u.text.replace(/\.bfd$/i,"")||"Befunky-project";BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).projectVO.filename=t;var i=BFN.AppModel.sectionID;(()=>BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage?BFN.ProjectManager.getOpenImageInEditorProject():BFN.ProjectManager.requestLocalSave({isLazy:!1,createThumbnail:!0}).then(()=>BFN.ProjectService.getLocalProject(i,{logLevel:"throw"})))().then(t=>{if("befunky"===e)return BFN.ProjectManager.createThumbnail(i,"blob",!0).then(e=>{this.saveProjectToBeFunky(t,e,r),BFN.BfnService.track("CREATE",BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER"),"SAVE_PROJECT_BEFUNKY")});this.saveProjectToComputer(t,r),BFN.BfnService.track("CREATE",BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER"),"SAVE_PROJECT_COMPUTER")}).catch(e=>{var t=e&&e.name?e.name:e;BeFunky.throwError("Failed to save project: ".concat(t),e),"invalid_editor_image_blob"!==e&&"missing_editor_image_blob"!==e||BFN.PhotoEditorModel.saveCurrentTextureBlob(0),r(e)})}}[this.panelName]()):void r("please_enter_text");case"share":BeFunky.showLoadScreen();var d={text:this.saveShareMenu.getText(),texture:this.saveTexture,apptype:this.panelName.toUpperCase()};return d.text?void{twitter:()=>BFN.BfnService.shareToFacebookOrPinterest(d,r),facebook:()=>BFN.BfnService.shareToFacebookOrPinterest(d,r),pinterest:()=>BFN.BfnService.shareToFacebookOrPinterest(d,r)}[this.panelName]():void r("please_enter_text");case"download_again":BeFunky.showLoadScreen(),this.saveToComputer(this.lastFileName,this.lastPDFBlob||this.lastImageBlob,()=>{BeFunky.hideLoadScreen(),this.handleSaveOrShareImage("save","complete")});var m=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");return void BFN.BfnService.track("CREATE",m,"SAVE_DESKTOP_AGAIN");case"disable_save_complete_modal":var p=UITools.getToolValue("save_and_share","disable_save_complete_modal");BeFunky.setLocal("disable_save_complete_modal",p)}}getImageBlobForSaving(e){return new Promise((t,i)=>{var r=BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).projectVO.printDPI;function a(){BeFunky.logError("webglTextureSize:",window.webglTextureSize),BeFunky.logError("Texture Memory: ".concat(BFN.Util.getTotalTextureMemory()," MB")),navigator.deviceMemory&&BeFunky.logError("Device Memory: ".concat(navigator.deviceMemory," GB")),BeFunky.logError("appRect:","".concat(BFN.appRect.width," x ").concat(BFN.appRect.height))}BeFunky.waitUntil({condition:()=>!this.isGeneratingImageBlob&&!e(),onSuccess:()=>{var i,n=this.getImageType();if(BFN.AppModel.viewingEditor&&!this.altSaveTexture&&BFN.PhotoEditorModel.currentEXIF&&(i=BFN.PhotoEditorModel.currentEXIF),"png"!==n)if("pdf"!==n)BFN.ExifTool.insert(this.lastImageBlob,i,r,e=>{var i=e.error,r=e.blob;if(i)return BeFunky.logError("Unable to add EXIF data to image blob. Falling back to original blob.",i),t(this.lastImageBlob),void a();t(r)});else{var o=this.saveTexture,s=o.width,l=o.height,h="print"===UITools.getControlValue("save_and_share_pdf_quality")?r||300:72,c=Math.round(72*s/h),u=Math.round(72*l/h);this.createPDF(this.lastImageBlob,c,u,i=>{var r=i.pdfBlob,a=i.error;if(!e())return r?(this.lastPDFBlob=r,t(r)):void BeFunky.throwError("Unable to create PDF",a);BeFunky.logError("Save cancelled while converting image blob to PDF")})}else BFN.ExifTool.changeDPIForPNG(this.lastImageBlob,r,i).then(t)},onTimeout:()=>{e()||(a(),BeFunky.throwError("Unable to generate blob for saving image in ".concat(20," seconds. Stalled at ").concat(this.imageBlobDebug))),i()},interval:200,maxAttempts:100})})}updateSaveTexture(e){if(this.altSaveTexture||this.flattenedImage){try{this.saveTexture&&this.saveTexture.destroyGC(!0),this.saveTexture=(this.altSaveTexture||this.flattenedImage).renderClone()}catch(e){return void(this.saveTexture=null)}["computer","befunky","google_photos"].includes(this.panelName)&&BFN.WatermarkManager.drawWatermark(this.saveTexture);var t,i=this.saveTexture;["computer","befunky","google_photos"].includes(this.panelName)&&((t=i.determineTransparency())&&e&&this.setImageType("png"),document.getElementById("save_and_share_pdf_option").setStyles({display:"computer"===this.panelName?"":"none"}),"computer"!==this.panelName&&"pdf"===this.getImageType()&&this.setImageType(t?"png":"jpg"),this.imageSizeCache={},this.lastImageBlob=null,this.lastPDFBlob=null,this.updateImageSize(!0)),this.updatePreviewImage(i,t),"dropbox"===this.panelName&&(BeFunky.showLoadScreen(),BFN.BfnService.prepareDropboxSave(i,()=>{BeFunky.hideLoadScreen()}))}}updatePreviewImage(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.saveTexture,t=arguments.length>1?arguments[1]:void 0;if(e){cancelAnimationFrame(this.previewRAF);var i=.92,r=!1;["computer","befunky","google_photos"].includes(this.panelName)&&(r="png"===this.getImageType(),i=this.getImageQuality()),"project"===this.panelName&&("boolean"!=typeof t&&(t=e.determineTransparency()),r=t);var a=r?"image/png":"image/jpeg";if(!this.previewCanvas||this.previewCanvasMimeType!==a){var n=this.saveShareMenu.maxPreviewImageWidth,o=this.saveShareMenu.maxPreviewImageHeight,s=window.previewRatio||2,l=n*s,h=o*s,c=Math.min(1,l/e.width,h/e.height),u=Math.round(e.width*c),d=Math.round(e.height*c),m=BFN.Util.resizeTexture(e,4*u,4*d);if(!m)return void BeFunky.throwError("Unable to create preview",{previewW:u,previewH:d,scale:c,maxRenderedWidth:n,maxRenderedHeight:o});var p=BFN.Util.getThumbTexture(m,Math.max(u,d));m.destroyGC(!0),this.previewCanvas=BFN.TextureUtils.textureToCanvas(p,{isTransparent:r}),p.destroyGC(!0)}var g=this.previewCanvas.toDataURL(a,i);this.previewCanvasMimeType=a,this.previewRAF=requestAnimationFrame(()=>{this.previewCanvas&&this.saveShareMenu.setPreviewImageSrc(g,this.previewCanvas.width,this.previewCanvas.height,r)})}}updateQualityGuide(){var e=this.saveShareMenu.qualityGuide,t=this.getImageType();if("png"===t)return e.setLang("image_quality_best"),void e.setStyles({color:"#3BB150"});if("pdf"===t){var i="print"===UITools.getControlValue("save_and_share_pdf_quality");return e.setLang(i?"pdf_print_quality":"pdf_web_quality"),void e.setStyles({color:"#3BB150"})}var r=this.getImageQuality();r>=.8?(e.setStyles({color:"#3BB150"}),BeFunky.isFirefox?e.setLang(r>=.95?"image_quality_high":"image_quality_good"):BeFunky.isEdgeHTML?e.setLang("image_quality_suggest_png"):e.setLang(1===r?"image_quality_high":"image_quality_good")):r>=.5?(e.setLang("image_quality_low"),e.setStyles({color:""})):(e.setLang("image_quality_worst"),e.setStyles({color:"#CE4051"}))}toggleImagePDFQuality(){this.imageQualitySlider=this.imageQualitySlider||document.querySelector(".save-image__image-quality"),this.pdfQualityButtons=this.pdfQualityButtons||document.querySelector(".save-image__pdf-quality");var e="pdf"===this.getImageType();this.imageQualitySlider.setStyles({display:e?"none":""}),this.pdfQualityButtons.setStyles({display:e?"":"none"})}saveAndShareModalDispose(){if(console.log("disposing Save/Share textures after modal close..."),BFN.WatermarkManager.removeEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,this.handleWatermarkUpdatedBind),this.saveShareMenu.watermarkControl.sourceTexture=null,this.destroyAltSaveTextureOnDispose){this.destroyAltSaveTextureOnDispose=!1;try{this.altSaveTexture.destroyGC(!0)}catch(e){}}this.altSaveTexture=null,this.flattenedImage&&(this.flattenedImage.destroyGC(!0),this.flattenedImage=null),this.saveTexture&&(this.saveTexture.destroyGC(!0),this.saveTexture=null),this.saveCanvas=null,this.saveCanvasMimeType=null,this.previewCanvas=null,this.previewCanvasMimeType=null}showUpgradePromptAfterSaving(){if(!BFN.BfnService.userIsPlus&&(this.saveToComputerCount++,this.saveToComputerCount%3==0)){var e=BFN.AppModel.sectionID;BeFunky.openTeaserModal("save_".concat(e))}}getBlob(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.quality,i=e.mimeType,r=arguments.length>1?arguments[1]:void 0,a="image/png"===i;this.imageBlobDebug=2,this.saveCanvas&&this.saveCanvasMimeType===i||(this.saveCanvas=BFN.TextureUtils.textureToCanvas(this.saveTexture,{isTransparent:a}),this.saveCanvasMimeType=i),this.imageBlobDebug=3,this.saveCanvas.toBlob(e=>{this.imageBlobDebug=4,r({blob:e})},i,t)}updateImageSize(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=()=>{if(!this.saveTexture)return!1;var e=this.getImageQuality(),t=this.getMimeType();return!this.lastImageBlob||e!==this.lastImageBlob.quality||t!==this.lastImageBlob.mimeType||this.watermarkTimestamp!==this.lastImageBlob.watermarkTimestamp},i=()=>{this.imageSizeText.addClass("save-image__size-text--updating");var e=this.getImageQuality(),r=this.getMimeType(),a="image/png"===r?"image/png":r+e,n=this.watermarkTimestamp;this.imageSizeCache[a]&&(this.imageSizeText.textContent=this.imageSizeCache[a]),this.isGeneratingImageBlob||(this.isGeneratingImageBlob=!0,this.imageBlobDebug=1,setTimeout(()=>{this.getBlob({quality:e,mimeType:r},o=>{var s=o.blob;if(null===s)return BeFunky.logError("Unable to extract Blob from canvas. Trying again..."),this.isGeneratingImageBlob=!1,i();this.imageBlobDebug=5,s.quality=e,s.mimeType=r,s.watermarkTimestamp=n,this.lastImageBlob=s,this.isGeneratingImageBlob=!1;var l=function(e){var t=e<Math.pow(1024,2)?0:1;return BeFunky.formatBytes(e,t)}(s.size);this.imageSizeCache[a]=l,t()?i():(this.imageSizeText.textContent=l,this.imageSizeText.removeClass("save-image__size-text--updating"))})},0))};e||t()?i():this.imageSizeText.toggleClass("save-image__size-text--updating",this.isGeneratingImageBlob)}saveToComputer(e,t,i){"string"==typeof e&&e||(e="BeFunky-artwork"),e=e.trim().replace(/(\.(jpe?g|png|pdf))+$/,"");var r="";"image/jpeg"===t.type&&(r=".jpg"),"image/png"===t.type&&(r=".png"),"application/pdf"===t.type&&(r=".pdf"),e+=r,this.lastFileName=e,this.flattenedImage&&(this.flattenedImage.destroyGC(!0),this.flattenedImage=null),this.saveTexture&&(this.saveTexture.destroyGC(!0),this.saveTexture=null);var a=!0;function n(){window.removeEventListener("blur",n),a=!1}function o(){window.removeEventListener("focus",o),a||i()}window.addEventListener("blur",n),window.addEventListener("focus",o),saveAs(t,e),setTimeout(()=>{a&&(window.removeEventListener("blur",n),window.removeEventListener("focus",o),i())},888)}saveProjectToComputer(e,t){BFN.ProjectManager.getCompressedBlob(e).then(i=>{saveAs(i,"".concat(e.filename,".bfd")),t()}).catch(t)}saveProjectToBeFunky(e,t,i){BFN.SavedProjectService.getAllProjects().catch(e=>{if("no_results"===e)return[];throw e}).then(r=>{var a=(r,a)=>{BeFunky.showLoadScreen({message:"uploading"});var n={bfdBlob:r,thumbnailBlob:t,uploadProgressHandler:function(e,t){BeFunky.updateLoadScreenProgress("uploading",100*e/t)},projectObject:e,date:a};BFN.SavedProjectService.saveBfdFileToBeFunky(n,e=>{var t=e.error;e.data;if(t)return i(t);BFN.SavedProjectService.resetProjectData(),BFN.DesignerTemplateManager.recentProjectsComponent&&BFN.DesignerTemplateManager.recentProjectsComponent.fetchProjects();var r=document.querySelector("dashboard-projects");r&&r.fetchProjects(),i()})},n=r.find(t=>t.filename===e.filename);n?BeFunky.confirm("confirm_project_overwrite",{onConfirm:()=>{BFN.ProjectManager.getCompressedBlob(e).then(e=>{BFN.SavedProjectService.deleteBfdFile(n.templateid,t=>{var r=t.error;t.data;if(r)return BeFunky.logError(r),i("Unable to delete existing project with the same name");a(e,n.date)})}).catch(i)},onCancel:()=>i("cancel"),confirmText:"yes",cancelText:"no",focusConfirmButton:!1}):BFN.ProjectManager.getCompressedBlob(e).then(a).catch(i)}).catch(e=>("string"!=typeof e&&BeFunky.throwError(e),i(e)))}getFileNamesFromIndexedDB(){BFN.IndexedDB.get(this.fileNamesKey).then(e=>{"object"==typeof e&&Object.entries(this.fileNames).forEach(i=>{var r=t(i,2),a=r[0],n=r[1];e[a]&&Object.entries(n).forEach(i=>{var r=t(i,2),o=r[0];if(!r[1]){var s=e[a][o];n[o]="string"==typeof s?s:""}})})}).catch(e=>BeFunky.logError("Unable to get file names config from IndexedDB",e))}setFileName(e,t,i){return e=e||BFN.AppModel.sectionID,["editor","collage","designer"].includes(e)?["image","project","layer"].includes(t)?"string"!=typeof i?BeFunky.logError("Invalid file name",i):(this.fileNames[e][t]=i,void this.persistFileNames()):BeFunky.logError("Invalid file type",t):BeFunky.logError("Invalid sectionID",e)}persistFileNames(){BFN.IndexedDB.set(this.fileNamesKey,this.fileNames).catch(e=>BeFunky.logError("Unable to save file names config to IndexedDB",e))}getImageQualityFromIndexedDB(){BFN.IndexedDB.get(this.imageQualityKey).then(e=>{e=parseInt(e),Number.isNaN(e)||e<0||e>100?this.updateQualityGuide():(document.getElementById("save_and_share_image_quality").noUiSlider.set(e),UITools.setControlValue("save_and_share_image_quality",e,!1),UITools.applyToolControl("save_and_share_image_quality"))}).catch(BeFunky.logError)}persistImageQuality(){BFN.IndexedDB.set(this.imageQualityKey,100*this.getImageQuality()).catch(e=>BeFunky.logError("Unable to image quality to IndexedDB",e))}setupGooglePhotosAlbums(){this.googlePhotosAlbumsComponent||(this.googlePhotosAlbumsComponent=Du({fetchAlbums:()=>BeFunky.GooglePhotosManager.getAlbums(),createAlbum:e=>BeFunky.GooglePhotosManager.createAlbum(e),onToggle:function(e){BFN.IndexedDB.set("options__saveToGooglePhotosAlbum",e)}}),document.getElementById("save_and_share_google_photos_albums").appendChild(this.googlePhotosAlbumsComponent))}getImageType(){return UITools.getToolValue("save_and_share","image_type")}setImageType(e){if(!["jpg","png","pdf"].includes(e))throw new Error('Invalid image type "'.concat(e,'"'));UITools.setControlValue("save_and_share_image_type",e),UITools.updateToolControl("save_and_share_image_type"),UITools.applyToolControl("save_and_share_image_type")}getImageQuality(){var e;return e="pdf"===this.getImageType()?"print"===UITools.getToolValue("save_and_share","pdf_quality")?100:98:parseInt(UITools.getToolValue("save_and_share","image_quality")),Number.isNaN(e)&&(e=100),Math.max(1,Math.min(100,e))/100}getMimeType(){return["jpg","pdf"].includes(this.getImageType())?"image/jpeg":"image/png"}saveLastTypedFileName(e){var t=e.target.value;if(t){var i="project"===BFN.UploadSaveShareManager.panelName?"project":this.altSaveTexture?"layer":"image";this.setFileName(void 0,i,t)}}handleWatermarkUpdated(){this.previewCanvas=null,this.saveCanvas=null,this.watermarkTimestamp=BFN.WatermarkManager.useWatermark?Date.now():null,this.updateSaveTexture(!1)}preloadPDFWorker(){this.pdfWorker||(this.pdfWorker=new Worker("".concat(BFN.jsURL,"pdf-worker-v3.min.js")),this.pdfWorker.addEventListener("message",e=>{var t=e.data;return"success"===t.type&&t.content instanceof Blob?this.pdfCallback({pdfBlob:t.content}):this.pdfCallback({error:t})}),this.pdfWorker.addEventListener("error",e=>{BeFunky.throwError("PDF Worker error",e)}))}createPDF(e,t,i,r){this.pdfCallback=(e=>{this.pdfCallback=(()=>{}),r(e)}),this.pdfWorker.postMessage({image:e,width:t,height:i})}}BFN.SingletonQueue.add(()=>{BFN.UploadSaveShareManager=new wu});class ku extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("AppManager Init"),this.initDefaultValues()}initDefaultValues(){UITools.addEventListener(UIToolsEvents.UPDATE_TOOL.type,this.handleUpdateTool.bind(this))}handleUpdateTool(e){var t=e.data,i=UITools.getToolVO(t);if((BFN.PhotoEditorCanvasTools.currentTool||UITools.toolPlusHash[t])&&BFN.toolViewstates.hasOwnProperty(t)&&(BFN.PremiumWatermark.currentToolID=t,BFN.PremiumWatermark.updateDisplay()),i.updating&&!BFN.smoothPictureDisabled?BFN.smoothPictureDisabled=!0:!i.updating&&BFN.smoothPictureDisabled&&(BFN.smoothPictureDisabled=!1),i)switch(t){case"app_goto":BFN.AppModel.handleAppGoto();break;case"user_account":BFN.AccountManager.handleAccountAction();break;case"user_settings":BFN.SettingsManager.handleSettingUpdate();break;case"language":var r=UITools.getToolValue("language","select");BeFunky.LanguageManager.handleUserUpdateLanguage(r);break;case"editor_history_action":BFN.UndoManager.handleEditorHistoryAction();break;case"editor_apply_cancel":BFN.PhotoEditorCanvasTools.handleEditorApplyCancel();break;case"editor_load_image":BFN.UploadSaveShareManager.handleUpload();break;case"editor_save_image":BFN.UploadSaveShareManager.handleSave();break;case"editor_share_image":BFN.UploadSaveShareManager.handleShare();break;case"open_project":BFN.UploadSaveShareManager.handleOpenProject();break;case"save_and_share":BFN.UploadSaveShareManager.handleSaveAndShareModal();break;case"upload_to_web_cam":BFN.PhotoEditorModel.handleWebCamAction();break;case"editor_flatten":BFN.PhotoEditorCanvasModel.handleEditorFlatten();break;case"editor_effect":BFN.FeaturedManager.handleEffectCategory(),BFN.FavoritesManager.handleEffectCategory();break;case"editor_artsy":BFN.FeaturedManager.handleArtsyCategory(),BFN.FavoritesManager.handleArtsyCategory();break;case"editor_frame":BFN.FeaturedManager.handleFrameCategory(),BFN.PhotoEditorCanvasModel.handleUpdateTool("editor_frame");break;case"editor_overlay":BFN.PhotoEditorCanvasModel.handleEditorOverlay();break;case"editor_texture":BFN.FeaturedManager.handleTextureCategory();break;case"text_edit":BFN.FabricManager.handleTextEdit();break;case"editor_graphic":BFN.GraphicLibraryManager.handleGraphicCategory();break;case"zoom":BFN.ZoomManager.handleZoom();break;case"transform":BFN.TransformModel.handleTransform();break;case"layer":BFN.TransformModel.handleLayer();break;case"layers":UILayers.handleLayers();break;case"alignment":BFN.AlignmentOptionsManager.handleAlignmentUpdate();break;case"history":UIHistory.handleHistory();break;case"paint_brush":BFN.ImagePaintBrush.handlePaintBrush();break;case"clone":BFN.ImageClone.handleClone();break;case"blemish_fix":BFN.ImageBlemish.handleBlemish();break;case"background":BFN.ImageBackground.handleBackground();break;case"background_brush":BFN.ImageBackground.handleBackgroundBrush();break;case"matting":BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING&&BFN.ImageMatting.handleMatting();break;case"cutout":BFN.ImageCutout.handleCutout();break;case"touch_up_brush":BFN.ImageTouchUp.handleTouchUpBrush();break;case"effect_generic":BFN.ImageEffect.handleEffectGeneric();break;case"effect_brush":BFN.ImageEffect.handleEffectBrush();break;case"artsy_generic":BFN.ImageArtsy.handleArtsyGeneric();break;case"artsy_brush":BFN.ImageArtsy.handleArtsyBrush();break;case"frame_border":BFN.ImageBorder.handleBorder();break;case"frame_drop_shadow":BFN.ImageDropShadow.handleDropShadow();break;case"frame_crop_rotate_generic":BFN.ImageFrame.handleFrameCropRotateGeneric();break;case"frame_crop_generic":BFN.ImageFrame.handleFrameCropGeneric();break;case"frame_full_generic":BFN.ImageFrame.handleFrameFullGeneric();break;case"texture_generic":BFN.ImageTexture.handleTextureGeneric();break;case"texture_brush":BFN.ImageTexture.handleTextureBrush();break;case"overlay_generic":BFN.ImageOverlay.handleOverlayGeneric();break;case"lens_flare_generic":BFN.ImageLensFlare.handleLensFlareGeneric();break;case"crop":BFN.ImageCrop.handleCrop();break;case"rotate":BFN.ImageRotator.handleRotate();break;case"resize":BFN.ImageResize.handleResize();break;case"slimming":BFN.ImageSlimming.handleSlimming();break;case"reshape":BFN.ImageReshape.handleReshape();break;case"tilt":BFN.ImageTilter.handleTilt();break;case"funky_focus":BFN.ImageFocus.handleFocus();break;case"funky_vignette":BFN.ImageVignette.handleVignette();break;case"color_picker_panel":BFN.ColorPickerPanel.handlePicker();break;case"watermark":BFN.WatermarkManager.handleWatermark();break;case"batch_processing":BFN.BatchProcessingManager.handleBatchProcessing();break;case"batch_resize":BFN.BatchProcessingManager.handleBatchResize();break;case"batch_crop":BFN.BatchProcessingManager.handleBatchCrop();break;case"batch_effect":BFN.BatchProcessingManager.handleBatchEffect();break;case"collage_customize":BFN.CustomizeManager.handleCustomize();break;case"collage_layouts_custom":BFN.CollageMakerCanvasModel.handleCollageLayoutsCustom();break;case"collage_layouts":BFN.CollageMakerTemplateManager.handleTemplateCategory();break;case"collage_patterns":BFN.CollageMakerPatternManager.handlePatternCategory();break;case"collage_image":BFN.CollageMakerCanvas.handleCollageImage();break;default:BFN.PhotoEditorCanvasModel.handleUpdateTool(t),BFN.ImageTouchUp.handleUpdateTool(t),BFN.ImageEffect.handleUpdateTool(t),BFN.ImageArtsy.handleUpdateTool(t),BFN.ImageFrame.handleUpdateTool(t),BFN.ImageTexture.handleUpdateTool(t),BFN.ImageOverlay.handleUpdateTool(t),BFN.ImageLensFlare.handleUpdateTool(t)}}}BFN.SingletonQueue.add(()=>{BFN.AppManager=new ku}),BFN.ImagePainterUndoManagerEvents={IMAGE_PAINTER_UPDATED:new Event("IMAGE_PAINTER_UPDATED"),PAINT_UPDATED:new Event("PAINT_UPDATED"),ALT_TEXTURE_UPDATED:new Event("ALT_TEXTURE_UPDATED")};class Lu extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("ImagePainterUndoManager Init"),this.initDefaultValues()}initDefaultValues(){this.originPoint=new PIXI.Point,this.maxStoredPixels=5*Math.pow(BeFunky.maxImageSize,2),this.imagePainter=null,this.regionVOs=[],this.regionIndex=-1,this.direction="redo",this.memoryFreed=!1,this.regionSprite=new PIXI.Sprite,this.handlePaintUpdatedBind=this.handlePaintUpdated.bind(this)}setImagePainter(e){this.reset(!1),this.imagePainter=e,this.imagePainter&&(this.imagePainter.addEventListener(BFN.ImagePainterEvents.PAINT_UPDATED.type,this.handlePaintUpdatedBind),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.IMAGE_PAINTER_UPDATED)),BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}reset(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.imagePainter&&(this.imagePainter.removeEventListener(BFN.ImagePainterEvents.PAINT_UPDATED.type,this.handlePaintUpdatedBind),this.imagePainter=null,this.clearRegionVOs(),this.direction="redo",e&&this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.IMAGE_PAINTER_UPDATED)),this.memoryFreed=!1,BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}addRegionVO(){if(this.imagePainter&&this.imagePainter.texture&&this.imagePainter.paintBounds.width&&this.imagePainter.paintBounds.height){if(this.redoExists)switch(this.direction){case"undo":this.clearRegionVOs(this.regionIndex);break;case"redo":this.clearRegionVOs(this.regionIndex+1)}var e=this.regionVOs.length?this.regionVOs[this.regionVOs.length-1]:null,t=new BFN.ImagePainterRegionVO;t.originPoint.x=this.imagePainter.paintBounds.left,t.originPoint.y=this.imagePainter.paintBounds.top,t.undoRegionTexture=PIXI.RenderTexture.create(this.imagePainter.paintBounds.width,this.imagePainter.paintBounds.height),t.undoRegionTexture.copyPixels(this.imagePainter.prevTexture,{x:-t.originPoint.x,y:-t.originPoint.y}),t.undoRegionTexture.subjectIsolated=!!e&&!!e.redoRegionTexture.subjectIsolated,t.redoRegionTexture=PIXI.RenderTexture.create(this.imagePainter.paintBounds.width,this.imagePainter.paintBounds.height),t.redoRegionTexture.subjectIsolated=this.currentImagePainter.subjectIsolated;try{this.imagePainter.altTexture.width,t.redoRegionTexture.copyPixels(this.imagePainter.altTexture,{x:-t.originPoint.x,y:-t.originPoint.y})}catch(e){t.redoRegionTexture.copyPixels(this.imagePainter.texture,{x:-t.originPoint.x,y:-t.originPoint.y})}t.totalPixels=this.imagePainter.paintBounds.width*this.imagePainter.paintBounds.height*2,this.regionVOs.push(t),this.regionIndex=this.regionVOs.length-1,this.direction="redo",this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED),this.logPosition()}this.freeMemory(),BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}clearRegionVOs(e){if(null==e&&(e=0),e>=0&&e<this.regionVOs.length){for(var t=e;t<this.regionVOs.length;t++){var i=this.regionVOs[t];i.undoRegionTexture&&i.undoRegionTexture.destroyGC(!0),i.redoRegionTexture&&i.redoRegionTexture.destroyGC(!0),i.undoRegionTexture=null,i.redoRegionTexture=null}this.regionVOs.splice(e),this.regionIndex=this.regionVOs.length-1}}freeMemory(){for(var e,t=0,i=0;i<this.regionVOs.length;i++)t+=(e=this.regionVOs[i]).totalPixels;for(BeFunky.log("~~~"),BeFunky.log("FREE MEMORY:");t>this.maxStoredPixels&&this.regionVOs.length;)(e=this.regionVOs[0]).undoRegionTexture&&e.undoRegionTexture.destroyGC(!0),e.redoRegionTexture&&e.redoRegionTexture.destroyGC(!0),e.undoRegionTexture=null,e.redoRegionTexture=null,BeFunky.log("Removing",e.totalPixels,"Pixels"),t-=e.totalPixels,this.regionIndex=Math.max(0,this.regionIndex-1),this.regionVOs.splice(0,1),this.memoryFreed=!0;BeFunky.log("Using:",Math.round(t/this.maxStoredPixels*100),"%")}undo(){if(this.imagePainter&&this.imagePainter.texture&&this.undoExists){this.imagePainter.preUndoCallback&&this.imagePainter.preUndoCallback(),"undo"===this.direction?this.regionIndex--:this.direction="undo";var e=this.regionVOs[this.regionIndex];switch(this.regionSprite.x=e.originPoint.x,this.regionSprite.y=e.originPoint.y,this.direction){case"undo":this.regionSprite.texture=e.undoRegionTexture;break;case"redo":this.regionSprite.texture=e.redoRegionTexture}try{this.imagePainter.altTexture.width,this.imagePainter.altTexture.clearRect(this.regionSprite.x,this.regionSprite.y,this.regionSprite.texture.width,this.regionSprite.texture.height),BFN.Stage.render(this.regionSprite,this.imagePainter.altTexture,!1),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED)}catch(e){this.imagePainter.texture.clearRect(this.regionSprite.x,this.regionSprite.y,this.regionSprite.texture.width,this.regionSprite.texture.height),BFN.Stage.render(this.regionSprite,this.imagePainter.texture,!1),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED)}this.regionSprite.texture=null,this.imagePainter.updateComplete(),BFN.MainUI.requestRender(),this.logPosition(),BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}this.imagePainter&&this.imagePainter.texture&&!this.undoExists&&(this.imagePainter.paintApplied=!1)}redo(){if(this.imagePainter&&this.imagePainter.texture&&this.redoExists){this.imagePainter.preRedoCallback&&this.imagePainter.preRedoCallback(),"redo"===this.direction?this.regionIndex++:this.direction="redo";var e=this.regionVOs[this.regionIndex];switch(this.regionSprite.x=e.originPoint.x,this.regionSprite.y=e.originPoint.y,this.direction){case"undo":this.regionSprite.texture=e.undoRegionTexture;break;case"redo":this.regionSprite.texture=e.redoRegionTexture}try{this.imagePainter.altTexture.width,this.imagePainter.altTexture.clearRect(this.regionSprite.x,this.regionSprite.y,this.regionSprite.texture.width,this.regionSprite.texture.height),BFN.Stage.render(this.regionSprite,this.imagePainter.altTexture,!1),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED)}catch(e){this.imagePainter.texture.clearRect(this.regionSprite.x,this.regionSprite.y,this.regionSprite.texture.width,this.regionSprite.texture.height),BFN.Stage.render(this.regionSprite,this.imagePainter.texture,!1),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED)}this.regionSprite.texture=null,this.imagePainter.updateComplete(),BFN.MainUI.requestRender(),this.logPosition(),BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}this.imagePainter&&this.imagePainter.texture&&(this.imagePainter.paintApplied=!0)}logPosition(){BeFunky.log("TRACE");for(var e="",t=0;t<this.regionVOs.length;t++){this.regionVOs[t];e+="[",e+=this.regionIndex==t?"undo"===this.direction?"<":">":" ",e+="]"}e+=" ".concat(this.regionIndex),BeFunky.log(e)}handlePaintUpdated(e){this.addRegionVO()}get undoExists(){return"undo"===this.direction&&this.regionIndex>0||"redo"===this.direction&&this.regionIndex>=0}get redoExists(){return"redo"===this.direction&&this.regionIndex<this.regionVOs.length-1||"undo"===this.direction&&this.regionIndex<=this.regionVOs.length-1}get imagePainterOpen(){return!!this.imagePainter}get currentImagePainter(){return this.imagePainter}}BFN.SingletonQueue.add(()=>{BFN.ImagePainterUndoManager=new Lu}),BFN.UndoManagerEvents={TIMESTAMP_UPDATED:new Event("TIMESTAMP_UPDATED")};class Ou extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("UndoManager Init"),this.initDefaultValues()}initDefaultValues(){this.batchHistoryActions=["layers_flattened","crop","rotate","resize","cutout","convert_to_image","resize_item_layer"],this.updating=!1,this.collageSnapshotRequired=!1}handleEditorHistoryAction(){var e=UITools.getToolVO("editor_history_action");if(!BFN.GlobalHistoryModel.historyUpdateQueued)switch(e.updating_id){case"undo":this.undo();break;case"redo":this.redo();break;case"reset":this.reset()}}undo(){if(BFN.ZoomRegion.hide(),this.updating=!0,!this.alternateHistoryAction("undo")){var e=BFN.TransformStateModel.getTimestamp(),t=BFN.TransformStateModel.getLastTimestamp(),i=BFN.PhotoEditorHistoryModel.getTimestamp(),r=(BFN.PhotoEditorHistoryModel.getLastTimestamp(),BFN.CollageMakerHistoryModel.getTimestamp()),a=BFN.CollageMakerHistoryModel.getLastTimestamp(),n="layers_flattened"===BFN.PhotoEditorHistoryModel.currentHistoryAction,o=this.batchHistoryActions.includes(BFN.PhotoEditorHistoryModel.currentHistoryAction),s=BFN.TransformStateModel.undoIsBatch&&(n&&"removeall"===BFN.TransformStateModel.undoIsBatch||!n&&BFN.TransformStateModel.undoIsBatch.includes("offset_items"));BFN.AppModel.viewingEditor&&o&&s?(BFN.PhotoEditorHistoryModel.undo(),BFN.TransformStateModel.undo()):BFN.AppModel.viewingEditor&&!isNaN(i)&&(isNaN(t)||isNaN(e)||t<i)?BFN.PhotoEditorHistoryModel.undo():BFN.AppModel.viewingCollage?(BFN.CollageMakerCanvasPhotoGridModel.collageSettings=null,BFN.CollageMakerCanvasPhotoGridModel.freeform||isNaN(a)||!(isNaN(t)||!isNaN(t)&&t<r)?BFN.TransformStateModel.undo():(BFN.CollageMakerHistoryModel.undo(!1),this.collageSnapshotRequired=!0,BFN.TransformStateModel.undoIsAlternate&&t>a&&BFN.TransformStateModel.applyAlternate(t,!1,BFN.CollageMakerHistoryModel.getLastTimestamp())&&(BFN.TransformStateModel.direction="redo")),BFN.CollageMakerHistoryModel.ignoreSnapshotApply||this.updateCollage()):(BFN.TransformStateModel.undo(),this.updateDesigner())}this.dispatchEvent(BFN.UndoManagerEvents.TIMESTAMP_UPDATED),this.updating=!1}redo(){if(BFN.ZoomRegion.hide(),this.updating=!0,!this.alternateHistoryAction("redo")){var e=BFN.TransformStateModel.getTimestamp(),t=BFN.TransformStateModel.getNextTimestamp(),i=(BFN.PhotoEditorHistoryModel.getTimestamp(),BFN.PhotoEditorHistoryModel.getNextTimestamp()),r=(BFN.CollageMakerHistoryModel.getTimestamp(),BFN.CollageMakerHistoryModel.getNextTimestamp()),a="layers_flattened"===BFN.PhotoEditorHistoryModel.nextHistoryAction,n=this.batchHistoryActions.includes(BFN.PhotoEditorHistoryModel.nextHistoryAction),o=BFN.TransformStateModel.redoIsBatch&&(a&&"removeall"==BFN.TransformStateModel.redoIsBatch||!a&&BFN.TransformStateModel.redoIsBatch.includes("offset_items"));BFN.AppModel.viewingEditor&&n&&o?(BFN.PhotoEditorHistoryModel.redo(),BFN.TransformStateModel.redo()):BFN.AppModel.viewingEditor&&!isNaN(i)&&(isNaN(t)||isNaN(e)||i<t)?BFN.PhotoEditorHistoryModel.redo():BFN.AppModel.viewingCollage?(BFN.CollageMakerCanvasPhotoGridModel.collageSettings=null,BFN.CollageMakerCanvasPhotoGridModel.freeform||isNaN(r)||!(isNaN(t)||!isNaN(t)&&r<t)?BFN.TransformStateModel.redo():(BFN.CollageMakerHistoryModel.redo(!1),this.collageSnapshotRequired=!0),BFN.CollageMakerHistoryModel.ignoreSnapshotApply||this.updateCollage()):(BFN.TransformStateModel.redo(),this.updateDesigner())}this.dispatchEvent(BFN.UndoManagerEvents.TIMESTAMP_UPDATED),this.updating=!1}gotoTimestamp(e){if(BFN.AppModel.viewingCollage&&UIToggler.alternateMenuIDs.length&&(UIToggler.alternateMenuIDs.indexOf("collage_image_menu")>=0||UIToggler.alternateMenuIDs.indexOf("collage_pattern_menu")>=0)&&BFN.PhotoGrid.gridIsolator.gridChild)return BFN.PhotoGrid.gridIsolator.revertChanges(),void BFN.PhotoGrid.isolateGridChild(null);for(this.collageSnapshotRequired=!1,BFN.CollageMakerHistoryModel.ignoreSnapshotApply=!0;;)if(0==e){if(isNaN(BFN.TransformStateModel.getLastTimestamp())||0==BFN.TransformStateModel.getLastTimestamp()&&"undo"==BFN.TransformStateModel.direction){BeFunky.log("done");break}this.undo()}else{var t=this.getTimestamp();if(isNaN(t)&&t==e){BeFunky.log("breakNaN",t!=e);break}if(t>e)this.undo(),BeFunky.log("undo ~");else{if(!(t<e)){if("undo"==BFN.TransformStateModel.direction&&BFN.TransformStateModel.getTimestamp()==t||isNaN(t)){this.redo();continue}BeFunky.log("break");break}this.redo(),BeFunky.log("redo ~")}}BFN.CollageMakerHistoryModel.ignoreSnapshotApply=!1,this.updateCollage(),this.updateDesigner(),this.dispatchEvent(BFN.UndoManagerEvents.TIMESTAMP_UPDATED)}alternateHistoryAction(e){if(BFN.ImageCutout.alternateHistoryAction())return!0;if(BFN.ImagePainterUndoManager.imagePainterOpen)switch(e){case"undo":if(BFN.ImagePainterUndoManager.undoExists)return BFN.ImagePainterUndoManager.undo(),!0;break;case"redo":if(BFN.ImagePainterUndoManager.redoExists)return BFN.ImagePainterUndoManager.redo(),!0;if(BFN.ImagePainterUndoManager.undoExists)return!0}if((BFN.AppModel.viewingEditor||BFN.TransformItemIsolator.active)&&BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)return BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),!0;if(BFN.AppModel.viewingCollage&&UIToggler.alternateMenuIDs.length&&(UIToggler.alternateMenuIDs.indexOf("collage_image_menu")>=0||UIToggler.alternateMenuIDs.indexOf("collage_pattern_menu")>=0))return BFN.PhotoGrid.gridIsolator.gridChild?(BFN.PhotoGrid.gridIsolator.revertChanges(),BFN.PhotoGrid.isolateGridChild(null)):BFN.CollageMakerHistoryModel.applySnapshot(),!0;if(BFN.TransformItemIsolator.animating)return!0;if(BFN.TransformItemIsolator.active){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e&&console.log(e),BFN.TransformItemIsolator.releaseTransformItem(),!0},i="undo"===e,r=!i;if(i&&!this.undoExists)return t();if(r&&!this.redoExists)return!0;if(i&&BFN.TransformStateModel.undoIsBatch||r&&BFN.TransformStateModel.redoIsBatch)return t();BFN.GlobalHistoryModel.updateSelectedHistoryID();var a=BFN.GlobalHistoryModel.globalHistoryVOHash[BFN.GlobalHistoryModel.selectedHistoryID[BFN.AppModel.viewState]],n=BFN.GlobalHistoryModel.globalHistoryVOs.indexOf(a)+(r?1:0);if(i&&n<0)return t();if(r&&n>=BFN.GlobalHistoryModel.globalHistoryVOs.length)return!0;var o=BFN.GlobalHistoryModel.globalHistoryVOs[n].timestamp,s=i?BFN.TransformStateModel.getLastTimestamp():BFN.TransformStateModel.getNextTimestamp(),l=[void 0,null,NaN];if(i&&(l.includes(o)||l.includes(s)||0===s))return t();if(r&&(l.includes(o)||l.includes(s)))return!0;if(o!==s)return t();var h=BFN.TransformStateModel.getTransitions(),c=BFN.TransformStateModel.getTransitionIndex(),u=h[c],d=u;i&&"undo"===BFN.TransformStateModel.direction?d=h[c-1]:r&&"redo"===BFN.TransformStateModel.direction&&(d=h[c+1]);var m=BFN.TransformItemIsolator.isolatedTransformItem;if(d.transformItem!==m)return t();if(["edit_image","replace_image"].includes(d.id))return t();var p=i?"redo"===BFN.TransformStateModel.direction?u.startState:d.startState:"undo"===BFN.TransformStateModel.direction?u.endState:d.endState,g=m.itemContent.texture?m.itemContent.texture.baseTexture:null,f=p.imageTexture?p.imageTexture.baseTexture:null;if(!g||!f)return t();if(!f.backgroundSpritePosition)return t();if(g===f)return t()}return!1}updateCollage(){BFN.AppModel.viewingCollage&&(this.collageSnapshotRequired&&(this.collageSnapshotRequired=!1,BFN.CollageMakerHistoryModel.applySnapshot()),BFN.CollageMakerCanvasPhotoGridModel.collageSettings&&(BFN.CollageMakerCanvasPhotoGridModel.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.COLLAGE_SETTINGS_UPDATED),BFN.CollageMakerCanvasPhotoGridModel.collageSettings=null))}updateDesigner(){BFN.AppModel.viewingDesigner&&BFN.DesignerCanvasModel.designerSettings&&(BFN.DesignerCanvasModel.dispatchEvent(BFN.DesignerCanvasModelEvents.DESIGNER_SETTINGS_UPDATED),BFN.DesignerCanvasModel.designerSettings=null)}reset(){BFN.ImageCutout.alternateHistoryAction()||BeFunky.confirm("confirm_reset",{onConfirm:function(){if(BFN.TransformGuides.setTransformGuideData(),BFN.TransformGuides.saveGuides(!1),BFN.AppModel.viewingEditor)return(BFN.PhotoEditorCanvasTools.currentTool||BFN.activePresetMenuItem)&&document.getElementById("editor_apply_cancel_cancel").click(),UIToggler.toggleMainMenu(!1),UIToggler.toggleZoomMenu(!1),UIToggler.toggleSampleImagePopover(!0),UIToggler.toggleSaveButtons(!1),BFN.ImageEditManager.resetEditor(),BFN.ProjectService.clearLocalAssets("editor"),BFN.ProjectService.removeLocalProject("editor"),BFN.ProjectManager.autoSave.editor.cancelLazySave(),BFN.GroupManager.clearGroups("editor"),void BFN.PhotoEditorModel.updateProjectVO(!0,!1);if(BFN.AppModel.viewingCollage)return BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),BFN.CollageMakerCanvasPhotoGridModel.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.CLEAR_ALL),BFN.ProjectService.clearLocalAssets("collage"),BFN.GroupManager.clearGroups("collage"),void(BFN.CollageMakerModel.projectVO._wasReset=!0);BFN.AppModel.viewingDesigner&&(BFN.GroupManager.clearGroups("designer"),BFN.DesignerModel.loadBlankProject())},confirmText:"yes",cancelText:"no"})}getTimestamp(){var e="redo"==BFN.TransformStateModel.direction?BFN.TransformStateModel.getTimestamp():BFN.TransformStateModel.getLastTimestamp();if(BFN.AppModel.viewingEditor)if(isNaN(e)||BFN.TransformStateModel.undoIsBatch)e=BFN.PhotoEditorHistoryModel.getTimestamp();else{var t=BFN.PhotoEditorHistoryModel.getTimestamp();isNaN(t)||(e=Math.max(e,t))}else if(BFN.AppModel.viewingCollage&&!BFN.CollageMakerCanvasPhotoGridModel.freeform)if(isNaN(e)||BFN.TransformStateModel.undoIsBatch)e=BFN.CollageMakerHistoryModel.getTimestamp();else{var i=BFN.CollageMakerHistoryModel.getTimestamp();isNaN(i)||(e=Math.max(e,i))}else BFN.AppModel.viewingDesigner&&isNaN(e)&&(e=0);return e}get undoExists(){if(BFN.ImagePainterUndoManager.imagePainterOpen||BFN.TransformItemIsolator.active)return!0;if(BFN.AppModel.viewingEditor){var e=isNaN(BFN.PhotoEditorHistoryModel.getLastTimestamp()),t=isNaN(BFN.TransformStateModel.getLastTimestamp())||0==BFN.TransformStateModel.getLastTimestamp()&&"undo"==BFN.TransformStateModel.direction;return!(e&&t)}if(BFN.AppModel.viewingCollage){var i=isNaN(BFN.CollageMakerHistoryModel.getLastTimestamp()),r=isNaN(BFN.TransformStateModel.getLastTimestamp())||0==BFN.TransformStateModel.getLastTimestamp()&&"undo"==BFN.TransformStateModel.direction;return!(i&&r)}return!(isNaN(BFN.TransformStateModel.getLastTimestamp())||0==BFN.TransformStateModel.getLastTimestamp()&&"undo"==BFN.TransformStateModel.direction)}get redoExists(){return BFN.ImagePainterUndoManager.imagePainterOpen?BFN.ImagePainterUndoManager.redoExists:BFN.AppModel.viewingEditor?!(isNaN(BFN.TransformStateModel.getNextTimestamp())&&isNaN(BFN.PhotoEditorHistoryModel.getNextTimestamp())):BFN.AppModel.viewingCollage?!(isNaN(BFN.TransformStateModel.getNextTimestamp())&&isNaN(BFN.CollageMakerHistoryModel.getNextTimestamp())):!isNaN(BFN.TransformStateModel.getNextTimestamp())}get isBatchHistoryAction(){return this.batchHistoryActions.includes(BFN.PhotoEditorHistoryModel.currentHistoryAction)}}BFN.SingletonQueue.add(()=>{BFN.UndoManager=new Ou}),BFN.EffectManagerEvents={EFFECT_UPDATED:new Event("EFFECT_UPDATED"),EFFECT_COMPLETE:new Event("EFFECT_COMPLETE")};class Ru extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("EffectManager Init"),this.changingImageMaxSize=1e3,this.resolution=1,this.changingResolution=1,this.somethingChanged=!1,this.intervalRunning=!1,this.selectedEffectID=null,this.effectChanging=!1,this.sourceTexture=null,this.renderTexture=null,this.sourceSprite=new PIXI.Sprite,this.currentEffect=null,this.currentComponent=null,this.autoProcess=!0,this.useThumbs=!1,this.manageLoadScreen=!0,this.handleUserEffectCancelBind=this.handleUserEffectCancel.bind(this),this.transparentBackgroundFixer=new BFN.filters.TransparentBackgroundFixFilter,this.effectTexture=null,this.effectSprite=new PIXI.Sprite,this.effectSprite.filters=[this.transparentBackgroundFixer]}setSourceTexture(e){this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.sourceTexture&&(this.transparentBackgroundFixer.iChannel1=this.sourceTexture);var t=Math.min(1,this.changingImageMaxSize/this.sourceTexture.width,this.changingImageMaxSize/this.sourceTexture.height);this.changingResolution=1,t<1&&(this.changingResolution=.5,t<.5&&(this.changingResolution=.25,t<.25&&(this.changingResolution=.125,t<.125&&(this.changingResolution=.0625)))),BeFunky.log("CHANGING RESOLUTION:",this.changingResolution,", ACTUAL:",t)}setRenderTexture(e){this.renderTexture=e,this.autoProcess&&this.processEffect()}setupEffect(){if(this.currentEffect){this.currentEffect.disposeEffect(),this.currentEffect=null;try{BFN.FilterHelper.emptyPoolForFilter()}catch(e){BeFunky.log("ERR FILTER MANAGER DESTROY: ",e)}}this.sourceTexture&&this.selectedEffectID&&BFN.effectMap.hasOwnProperty(this.selectedEffectID)&&BFN.effects.hasOwnProperty(BFN.effectMap[this.selectedEffectID])&&(this.currentEffect=BFN.effects[BFN.effectMap[this.selectedEffectID]],this.currentEffect.setupEffect(this.sourceTexture)),this.dispatchEvent(BFN.EffectManagerEvents.EFFECT_UPDATED),this.effectParameters=null,this.autoProcess&&this.processEffect()}processEffectTimeout(){this.effectChanging?(this.somethingChanged&&(this.somethingChanged=!1,this.processEffect()),this.intervalRunning=!0,setTimeout(this.processEffectTimeout.bind(this),BFN.frameInterval)):this.intervalRunning=!1}processEffect(){var e=null;this.currentEffect&&this.currentEffect.isSetup?(this.resolution=this.effectChanging?this.changingResolution:1,this.effectParameters||this.effectID&&UITools.getToolVO(this.effectID)&&(this.effectParameters=UITools.getToolVO(this.effectID)),this.effectParameters&&this.currentEffect.applyEffect(this.resolution,this.effectParameters,this.useThumbs),e=this.currentEffect):e=this.sourceSprite;var t=this.useThumbs;this.currentEffect&&this.effectParameters&&this.effectParameters.hasOwnProperty("imageURL")?this.currentEffect.effectTexture&&(t=!0):t=!0,t?(this.sourceTexture&&this.renderTexture&&(this.sourceTexture.width!==this.renderTexture.width||this.sourceTexture.height!==this.renderTexture.height)&&this.renderTexture.resize(this.sourceTexture.width,this.sourceTexture.height),this.effectParameters&&this.effectParameters.fixTransparency?(this.effectTexture||(this.effectTexture=PIXI.RenderTexture.create(16,16),this.effectSprite.texture=this.effectTexture),!this.renderTexture||this.effectTexture.width===this.renderTexture.width&&this.effectTexture.height===this.renderTexture.height||this.effectTexture.resize(this.renderTexture.width,this.renderTexture.height),BFN.Stage.render(e,this.effectTexture),BFN.Stage.render(this.effectSprite,this.renderTexture)):BFN.Stage.render(e,this.renderTexture),this.dispatchEvent(BFN.EffectManagerEvents.EFFECT_COMPLETE),!this.useThumbs&&this.manageLoadScreen&&UIToggler.toggleLoadScreen(!1)):!this.useThumbs&&this.manageLoadScreen&&UIToggler.toggleLoadScreen(!0,{onCancel:this.handleUserEffectCancelBind})}reset(){if(this.resolution=1,this.changingResolution=1,this.effectParameters=null,this.somethingChanged=!1,this.intervalRunning=!1,this.selectedEffectID=null,this.effectChanging=!1,this.sourceTexture=null,this.renderTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY,this.effectTexture&&this.effectTexture.resize(16,16),this.transparentBackgroundFixer.iChannel1=PIXI.Texture.EMPTY,this.currentEffect){this.currentEffect.disposeEffect(),this.currentEffect=null;try{BFN.FilterHelper.emptyPoolForFilter()}catch(e){BeFunky.log("ERR FILTER MANAGER DESTROY: ",e)}}this.dispatchEvent(BFN.EffectManagerEvents.EFFECT_UPDATED)}handleUserEffectCancel(){document.getElementById("editor_apply_cancel_cancel").click()}set effectID(e){this.selectedEffectID=e,this.setupEffect()}get effectID(){return this.selectedEffectID}set parameters(e){this.effectParameters=e,this.effectParameters&&(this.somethingChanged=!0,this.intervalRunning||this.processEffectTimeout())}get parameters(){return this.effectParameters}set changing(e){this.effectChanging=e,BFN.StageModel.setRefreshFactor(this.effectChanging?.25:1),this.processEffect()}get changing(){return this.effectChanging}}BFN.SingletonQueue.add(()=>{BFN.EffectManager=new Ru}),BFN.ArtsyManagerEvents={ARTSY_UPDATED:new Event("ARTSY_UPDATED"),ARTSY_COMPLETE:new Event("ARTSY_COMPLETE")};class Au extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("ArtsyManager Init"),this.processing=!1,this.selectedArtsyID=null,this.artsyAmount=1,this.sourceTexture=null,this.renderTexture=null,this.sourceSprite=new PIXI.Sprite,this.transparentBackgroundFixer=new BFN.filters.TransparentBackgroundFixFilter,this.artsySprite=new PIXI.Sprite,this.artsySprite.filters=[this.transparentBackgroundFixer],BFN.ArtsyService.addEventListener(BFN.ArtsyServiceEvents.FAILED.type,this.handleArtsyServiceFailed.bind(this)),BFN.ArtsyService.addEventListener(BFN.ArtsyServiceEvents.COMPLETED.type,this.handleArtsyServiceCompleted.bind(this)),BFN.ArtsyService.addEventListener(BFN.ArtsyServiceEvents.CANCELLED.type,this.handleArtsyServiceCancelled.bind(this))}setSourceTexture(e){this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.sourceTexture&&(this.transparentBackgroundFixer.iChannel1=this.sourceTexture)}setRenderTexture(e){this.renderTexture=e}setupArtsy(){}processArtsy(){this.sourceTexture&&!this.processing&&(BFN.ArtsyService.currentTexture!=this.sourceTexture&&(BFN.ArtsyService.reset(),BFN.ArtsyService.currentTexture=this.sourceTexture),this.processing=!0,UIToggler.toggleLoadScreen(!0,{onCancel:this.cancel}),BeFunky.log("PROCESS IMAGE"),BFN.ArtsyService.processImage())}cancel(){BFN.ArtsyManager.processing=!1,BFN.ArtsyService.cancel(),BFN.ArtsyManager.reset()}reset(){this.selectedArtsyID=null,this.sourceTexture=null,this.renderTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY,this.transparentBackgroundFixer.iChannel1=PIXI.Texture.EMPTY,this.dispatchEvent(BFN.ArtsyManagerEvents.ARTSY_UPDATED)}handleArtsyServiceFailed(e){this.processing=!1,BFN.Stage.render(this.sourceSprite,this.renderTexture),BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),UIToggler.toggleLoadScreen(!1),this.dispatchEvent(BFN.ArtsyManagerEvents.ARTSY_COMPLETE)}handleArtsyServiceCancelled(e){this.processing=!1,BFN.Stage.render(this.sourceSprite,this.renderTexture),BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),UIToggler.toggleLoadScreen(!1),this.dispatchEvent(BFN.ArtsyManagerEvents.ARTSY_COMPLETE)}handleArtsyServiceCompleted(e){if(null!=this.renderTexture||0!=this.processing){this.processing=!1;var t=BFN.Util.resizeTexture(e.data,this.renderTexture.width,this.renderTexture.height);t&&(this.artsySprite.texture=t,BFN.Stage.render(this.artsySprite,this.renderTexture),this.artsySprite.texture=PIXI.Texture.EMPTY,t.destroyGC(!0)),UIToggler.toggleLoadScreen(!1),this.dispatchEvent(BFN.ArtsyManagerEvents.ARTSY_COMPLETE)}}set artsyID(e){this.selectedArtsyID=e,this.setupArtsy()}get artsyID(){return this.selectedArtsyID}set parameters(e){this.artsyParameters=e,this.artsyParameters&&(BFN.ArtsyService.currentArtsyParams=this.artsyParameters,this.processArtsy())}get parameters(){return this.artsyParameters}}BFN.SingletonQueue.add(()=>{BFN.ArtsyManager=new Au}),BFN.LensFlareManagerEvents={ASSETS_LOADED:new Event("ASSETS_LOADED"),THUMBS_LOADED:new Event("THUMBS_LOADED")};class Vu extends BFN.EventDispatcher{constructor(e){super(e),this.init()}init(){BeFunky.log("LensFlareManager Init"),this.initDefaultValues()}initDefaultValues(){this.assetLoader=new BFN.GraphicLoader,this.assetLoader.addEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleAssetLoaderLoadingComplete.bind(this)),this.thumbLoader=new BFN.GraphicLoader,this.thumbLoader.addEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleThumbLoaderLoadingComplete.bind(this))}loadAssets(e){var t=!1;if(this.assetLoader.reset(),e)for(var i=0;i<e.length;i++){var r=e[i];if(BFN.LensFlareData.assets.hasOwnProperty(r)){var a=BFN.LensFlareData.assets[r];!a.imageTexture&&a.imageURL&&(t=!0,this.assetLoader.graphicsData[r]=a.imageURL)}}t?(UIToggler.toggleLoadScreen(!0),this.assetLoader.loadGraphics()):this.dispatchEvent(BFN.LensFlareManagerEvents.ASSETS_LOADED)}loadAssetThumbs(e){var t=!1;if(this.thumbLoader.reset(),e)for(var i=0;i<e.length;i++){var r=e[i];if(BFN.LensFlareData.assets.hasOwnProperty(r)){var a=BFN.LensFlareData.assets[r];!a.thumbTexture&&a.thumbURL&&(t=!0,this.thumbLoader.graphicsData[r]=a.thumbURL)}}t?(UIToggler.toggleLoadScreen(!0),this.thumbLoader.loadGraphics()):this.dispatchEvent(BFN.LensFlareManagerEvents.THUMBS_LOADED)}handleAssetLoaderLoadingComplete(e){for(var t in this.assetLoader.graphics){var i=this.assetLoader.graphics[t];if(BFN.LensFlareData.assets.hasOwnProperty(t)){var r=BFN.LensFlareData.assets[t];r.imageTexture||i===this.assetLoader.missingTexture||(r.imageTexture=i.renderClone())}}this.assetLoader.reset(),UIToggler.toggleLoadScreen(!1),this.dispatchEvent(BFN.LensFlareManagerEvents.ASSETS_LOADED)}handleThumbLoaderLoadingComplete(e){for(var t in this.thumbLoader.graphics){var i=this.thumbLoader.graphics[t];if(BFN.LensFlareData.assets.hasOwnProperty(t)){var r=BFN.LensFlareData.assets[t];r.thumbTexture||i===this.thumbLoader.missingTexture||(r.thumbTexture=i.renderClone())}}this.thumbLoader.reset(),UIToggler.toggleLoadScreen(!1),this.dispatchEvent(BFN.LensFlareManagerEvents.THUMBS_LOADED)}}BFN.SingletonQueue.add(()=>{BFN.LensFlareManager=new Vu}),BFN.PresetMenuItemThumbManagerEvents={PROCESSING_QUEUE_UPDATED:new Event("PROCESSING_QUEUE_UPDATED")};class Uu extends BFN.EventDispatcher{constructor(e){super(e),this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.queuedPresetMenuItems=[],this.processingQueue=!1,this.currentPresetMenuItem=null,this.presetMenuItemObjectURLs=[],this.lastProcessedItems=null,this.sourceTexture=null,this.thumbSourceTexture=null,this.thumbRenderTexture=null,this.thumbGraphicLoader=new BFN.GraphicLoader,this.thumbTransformSprite=new PIXI.Sprite,this.lensFlareThumbTextures={},this.frameDisplay=new BFN.FrameDisplay,this.handleEffectCompletedBind=this.handleEffectCompleted.bind(this),this.handleThumbGraphicLoadedBind=this.handleThumbGraphicLoaded.bind(this),this.handleLensFlareElementsAddedBind=this.handleLensFlareElementsAdded.bind(this),this.handleOverlayThumbsLoadedBind=this.handleOverlayThumbsLoaded.bind(this),this.handleFrameDisplayFrameLoadedBind=this.handleFrameDisplayFrameLoaded.bind(this),BFN.PhotoEditorMenuModel.addEventListener(BFN.PhotoEditorMenuModelEvents.CURRENT_IMAGE_THUMB_UPDATED.type,this.handleCurrentImageThumbUpdated.bind(this))}processItems(e){if(this.thumbSourceTexture&&this.thumbRenderTexture){this.lastProcessedItems=e;for(var t=0;t<e.length;t++){var i=e[t];this.queuedPresetMenuItems.push(i)}this.processingQueue||(this.processingQueue=!0,this.dispatchEvent(BFN.PresetMenuItemThumbManagerEvents.PROCESSING_QUEUE_UPDATED),this.processQueue())}}processQueue(){if(this.queuedPresetMenuItems.length&&this.thumbSourceTexture&&this.thumbRenderTexture)if(UIToggler.toggleLoadScreen(!0),this.currentPresetMenuItem=this.queuedPresetMenuItems.shift(),this.currentPresetMenuItem.thumbProcessed||!this.currentPresetMenuItem.options.useProcessedThumb)this.processQueue();else{var e=this.currentPresetMenuItem.options.presetID;switch(BFN.toolViewstates[e]){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:if(BFN.effectPresetMap.hasOwnProperty(e)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[e])){var t=BFN.effectPresetMap[e];if(t){var i=UITools.getToolVO(e);BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!1,BFN.EffectManager.useThumbs=!0,BFN.EffectManager.setSourceTexture(i.useHiResThumb&&this.sourceTexture?this.sourceTexture:this.thumbSourceTexture),BFN.EffectManager.setRenderTexture(this.thumbRenderTexture),BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,this.handleEffectCompletedBind),BFN.EffectManager.effectID=t,BFN.EffectManager.effectParameters=i.defaultValues,BFN.EffectManager.processEffect(),BFN.EffectManager.autoProcess=!0,BFN.EffectManager.useThumbs=!1}}break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE:var r=UITools.getToolVO(e).defaultValues;this.blendTexture(BFN.XMLGraphicLoader.getGraphicByName(r.texture),r.blendMode,r.alpha),this.assignProcessedThumb();break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY:var a=this.currentPresetMenuItem.options.presetObject.categoryID;BFN.OverlaysThumbLoader.addEventListener(BFN.OverlaysThumbLoaderEvents.LOADED.type,this.handleOverlayThumbsLoadedBind),BFN.OverlaysThumbLoader.load(a);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME:var n=UITools.getToolVO(e),o="".concat(BFN.imagesURL,"app/frames/").concat(n.texture_category,"/png/thumbs/").concat(n.texture,".png");this.frameDisplay.addEventListener(BFN.FrameDisplayEvents.FRAME_LOADED.type,this.handleFrameDisplayFrameLoadedBind),this.frameDisplay.setupFrame(this.thumbSourceTexture,o,n.texture_data,186,120,186,120,!0);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE:if(this.lensFlareThumbTextures.hasOwnProperty(e))this.handleLensFlareElementsAdded();else{var s=UITools.getToolVO(e),l=s.presetID;if(BFN.LensFlareData.presets.hasOwnProperty(l)){var h=this,c=function(){for(var e=BFN.LensFlareData.presets[l].elementVOs,t=[],i=0;i<e.length;i++){var r=e[i];t.push(r.clone())}h.lensFlareDisplay.addEventListener(BFN.LensFlareDisplayEvents.ELEMENTS_ADDED.type,h.handleLensFlareElementsAddedBind),h.lensFlareDisplay.addElements(t);for(var a=null,n=1;n<=5;n++)s.hasOwnProperty("color_value_".concat(n))&&(a||(a={}),a[n]=s["color_value_".concat(n)]);a&&h.lensFlareDisplay.setGlobalColors(a)};if(void 0!==this.lensFlareDisplay&&void 0!==this.lensFlareDisplay.addEventListener)c();else var u=setInterval(()=>{if(void 0!==this.lensFlareDisplay&&void 0!==this.lensFlareDisplay.addEventListener){try{clearInterval(u)}catch(e){}u=null,c()}},10)}else this.processQueue()}break;default:this.processQueue()}}else BFN.EffectManager.reset(),this.processingQueue=!1,this.dispatchEvent(BFN.PresetMenuItemThumbManagerEvents.PROCESSING_QUEUE_UPDATED),UIToggler.toggleLoadScreen(!1)}blendTexture(e,t,i){this.thumbTransformSprite.texture=e,this.thumbTransformSprite.scale.x=this.thumbTransformSprite.scale.y=Math.max(this.thumbRenderTexture.width/e.width,this.thumbRenderTexture.height/e.height),this.thumbTransformSprite.x=(this.thumbRenderTexture.width-this.thumbTransformSprite.texture.width*this.thumbTransformSprite.scale.x)/2,this.thumbTransformSprite.y=(this.thumbRenderTexture.height-this.thumbTransformSprite.texture.height*this.thumbTransformSprite.scale.y)/2,BFN.Stage.render(this.thumbTransformSprite,this.thumbRenderTexture);try{e.destroyGC(!0),e=null}catch(e){}this.blendModeSprite.setBlendMode(t),this.blendModeSprite.setBlendIntensity(i),this.blendModeSprite.renderDisplay(),BFN.Stage.render(this.blendModeSprite,this.thumbRenderTexture)}assignProcessedThumb(){if(this.thumbRenderTexture.width!==this.thumbSourceTexture.width||this.thumbRenderTexture.height!==this.thumbSourceTexture.height){var e=BFN.PhotoEditorMenuModel.getPresetItemThumbTexture(this.thumbRenderTexture);this.thumbRenderTexture.resize(this.thumbSourceTexture.width,this.thumbSourceTexture.height),this.thumbRenderTexture.copyPixels(e,void 0,void 0,void 0,{x:this.thumbRenderTexture.width/e.width,y:this.thumbRenderTexture.height/e.height}),e.destroyGC(!0)}BFN.Stage.extract.canvas(this.thumbRenderTexture).toBlob(e=>{var t=window.URL.createObjectURL(e);this.presetMenuItemObjectURLs.push(t),this.currentPresetMenuItem.setBackground(t,!0),this.currentPresetMenuItem=null,this.processQueue()},"image/jpeg",.9)}handleCurrentImageThumbUpdated(){this.presetMenuItemObjectURLs.forEach(e=>URL.revokeObjectURL(e)),this.presetMenuItemObjectURLs=[];try{this.sourceTexture.destroyGC(!0)}catch(e){}if(this.sourceTexture=null,BFN.PhotoEditorModel.sourceTexture&&(this.sourceTexture=BFN.Util.getThumbTexture(BFN.PhotoEditorModel.sourceTexture,1024)),this.thumbSourceTexture=BFN.PhotoEditorMenuModel.currentImageThumbTexture,!this.thumbRenderTexture||this.thumbRenderTexture&&(this.thumbRenderTexture.width!==this.thumbSourceTexture.width||this.thumbRenderTexture.height!==this.thumbSourceTexture.height)){try{this.thumbRenderTexture.destroyGC(!0)}catch(e){}this.thumbRenderTexture=PIXI.RenderTexture.create(this.thumbSourceTexture.width,this.thumbSourceTexture.height),this.thumbRenderTexture.clear()}if(this.hasOwnProperty("blendModeSprite")||(this.blendModeSprite=new BFN.BlendModeSprite(!1)),this.blendModeSprite.setBaseTexture(this.thumbSourceTexture),this.blendModeSprite.setBlendTexture(this.thumbRenderTexture),this.hasOwnProperty("lensFlareDisplay")||(this.lensFlareDisplay=new BFN.LensFlareDisplay(!0)),this.lensFlareDisplay.itemWidth!==this.thumbSourceTexture.width||this.lensFlareDisplay.itemHeight!==this.thumbSourceTexture.height){this.lensFlareDisplay.setDisplayDimensions(this.thumbSourceTexture.width,this.thumbSourceTexture.height);var e=Math.min(this.lensFlareDisplay.itemWidth,this.lensFlareDisplay.itemHeight)/4;this.lensFlareDisplay.setSourcePoint(e,-e),this.lensFlareDisplay.setCenterPoint(0,0),this.lensFlareDisplay.x=this.lensFlareDisplay.itemWidth/2,this.lensFlareDisplay.y=this.lensFlareDisplay.itemHeight/2}this.lastProcessedItems&&setTimeout(()=>{this.processItems(this.lastProcessedItems)},0)}handleEffectCompleted(){BFN.EffectManager.removeEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,this.handleEffectCompletedBind),this.assignProcessedThumb()}handleThumbGraphicLoaded(){this.thumbGraphicLoader.removeEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleThumbGraphicLoadedBind);var e=this.currentPresetMenuItem.options.presetID,t=UITools.getToolVO(e).defaultValues;this.blendTexture(this.thumbGraphicLoader.graphics[e],t.blendMode,t.alpha),this.assignProcessedThumb()}handleOverlayThumbsLoaded(){BFN.OverlaysThumbLoader.removeEventListener(BFN.OverlaysThumbLoaderEvents.LOADED.type,this.handleOverlayThumbsLoadedBind);var e=this.currentPresetMenuItem.options.presetObject.categoryID,t=this.currentPresetMenuItem.options.presetObject.id;BFN.OverlaysThumbLoader.getImage(e,t,!0,this.handleOverlayThumbLoaded.bind(this))}handleOverlayThumbLoaded(e){var t=this.currentPresetMenuItem.options.presetObject.categoryID;this.thumbRenderTexture.copyPixels(this.thumbSourceTexture);var i=new PIXI.Graphics;i.beginFill(16777215,.9),i.drawRect(0,0,this.thumbSourceTexture.width,this.thumbSourceTexture.height),i.endFill(),BFN.Stage.render(i,this.thumbRenderTexture,!1);var r=new PIXI.Sprite(this.thumbSourceTexture),a=new PIXI.Sprite(e),n=new PIXI.Container;if(n.addChild(r),n.addChild(a),a.anchor.x=a.anchor.y=.5,r.mask=a,"patterns"===t)for(var o=-1;o<=1;o++)for(var s=-1;s<=1;s++)a.x=this.thumbSourceTexture.width/2+e.width*o,a.y=this.thumbSourceTexture.height/2+e.height*s,BFN.Stage.render(n,this.thumbRenderTexture,!1);else a.x=this.thumbSourceTexture.width/2,a.y=this.thumbSourceTexture.height/2,BFN.Stage.render(n,this.thumbRenderTexture,!1);n.removeChild(r),n.removeChild(a),r.texture=null,a.texture=null,e.destroyGC(!0),this.assignProcessedThumb()}handleFrameDisplayFrameLoaded(){this.frameDisplay.removeEventListener(BFN.FrameDisplayEvents.FRAME_LOADED.type,this.handleFrameDisplayFrameLoadedBind);var e=this.currentPresetMenuItem.options.presetID,t=UITools.getToolVO(e).defaultValues;this.frameDisplay.setBlendMode(t.hasOwnProperty("blendMode")?t.blendMode:BFN.CONST.BLEND_MODES.NORMAL),BFN.Stage.render(this.frameDisplay,this.thumbRenderTexture,!0),setTimeout(()=>{BFN.Stage.render(this.frameDisplay,this.thumbRenderTexture,!0),setTimeout(()=>{this.thumbRenderTexture.fillColor(2434605),this.frameDisplay.x=this.thumbRenderTexture.width/2-this.frameDisplay.itemWidth/2,this.frameDisplay.y=this.thumbRenderTexture.height/2-this.frameDisplay.itemHeight/2,BFN.Stage.render(this.frameDisplay,this.thumbRenderTexture,!1),this.assignProcessedThumb()},0)},0)}handleLensFlareElementsAdded(){UIToggler.toggleLoadScreen(!0),this.lensFlareDisplay.removeEventListener(BFN.LensFlareDisplayEvents.ELEMENTS_ADDED.type,this.handleLensFlareElementsAddedBind);var e=this.currentPresetMenuItem.options.presetID;this.lensFlareThumbTextures.hasOwnProperty(e)||(this.lensFlareThumbTextures[e]=PIXI.RenderTexture.create(this.lensFlareDisplay.itemWidth,this.lensFlareDisplay.itemHeight),BFN.Stage.render(this.lensFlareDisplay,this.lensFlareThumbTextures[e])),this.thumbRenderTexture.copyPixels(this.lensFlareThumbTextures[e]),this.blendModeSprite.setBlendMode(BFN.CONST.BLEND_MODES.SCREEN),this.blendModeSprite.setBlendIntensity(1),this.blendModeSprite.renderDisplay(),BFN.Stage.render(this.blendModeSprite,this.thumbRenderTexture),this.assignProcessedThumb()}}BFN.SingletonQueue.add(()=>{BFN.PresetMenuItemThumbManager=new Uu});class Gu{constructor(){this.init()}init(){BeFunky.log("FeaturedManager Init"),this.initDefaultValues()}initDefaultValues(){this.featuredIDs=[],this.featuredEffectIDs=BFN.FeaturedData.effect,this.featuredArtsyIDs=BFN.FeaturedData.artsy,this.featuredFrameIDs=BFN.FeaturedData.frame,this.featuredTextureIDs=BFN.FeaturedData.texture,this.featuredIDs.concat(this.featuredEffectIDs,this.featuredArtsyIDs),this.effectPresetItems=[],this.artsyPresetItems=[],this.framePresetItems=[],this.texturePresetItems=[],BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_COMPLETE.type,this.handleAppComplete.bind(this))}initFeaturedMenus(){}handleEffectCategory(){this.returnPresetItems(this.effectPresetItems,this.effectMenu),"effect_featured"===UITools.getToolValue("editor_effect","updating_id")&&this.borrowPresetItems(this.featuredEffectIDs,BFN.effectIDMap,this.effectPresetItems,this.effectMenu)}handleArtsyCategory(){}handleFrameCategory(){this.returnPresetItems(this.framePresetItems,this.frameMenu),"frame_featured"===UITools.getToolValue("editor_frame","updating_id")&&this.borrowPresetItems(this.featuredFrameIDs,BFN.frameIDMap,this.framePresetItems,this.frameMenu)}handleTextureCategory(){this.returnPresetItems(this.texturePresetItems,this.textureMenu),"texture_featured"===UITools.getToolValue("editor_texture","updating_id")&&this.borrowPresetItems(this.featuredTextureIDs,BFN.textureIDMap,this.texturePresetItems,this.textureMenu)}borrowPresetItems(e,t,i,r){var a=document.createDocumentFragment();if(e.length){for(var n=0;n<e.length;n++){var o=e[n],s=t.hasOwnProperty(o)?t[o]:"null",l="".concat(s,"_").concat(o,"_menu"),h=document.getElementById(l);if(h){if(!document.getElementById("".concat(l,"_placeholder"))){var c=document.createElement("div");c.id="".concat(l,"_placeholder"),h.insertAdjacentElement("afterend",c)}a.appendChild(h),i.push(h)}}r.appendChild(a)}else r.innerHTML='<string class="tool-menu__message">- - - - -</string>'}returnPresetItems(e,t){if(e&&t){for(var i=0;i<e.length;i++){var r=e[i];if(t.querySelector("#".concat(r.id))){var a=document.getElementById("".concat(r.id,"_placeholder"));a.insertAdjacentElement("afterend",r),a.parentNode.removeChild(a)}}e.splice(0),t.innerHTML=""}}handleAppComplete(e){this.initFeaturedMenus()}get effectMenu(){return document.getElementById("effect_featured_menu").querySelector(".menu-content")}get frameMenu(){return document.getElementById("frame_featured_menu").querySelector(".menu-content")}get textureMenu(){return document.getElementById("texture_featured_menu").querySelector(".menu-content")}}BFN.SingletonQueue.add(()=>{BFN.FeaturedManager=new Gu});class Hu{constructor(){this.init()}init(){BeFunky.log("FavoritesManager Init"),this.initDefaultValues()}initDefaultValues(){this.favoriteStars={},this.favoriteEffectIDs=[],this.favoriteArtsyIDs=[],this.effectPresetItems=[],this.artsyPresetItems=[],this._effectMenu=null,this._artsyMenu=null,this.favoriteRemoved=!1,this.NOT_ALLOWED_FAVS=["ART_0020","ART_0022","ART_0021","ART_0023"],BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_COMPLETE.type,this.handleAppComplete.bind(this))}handleEffectCategory(){if(this.returnPresetItems(this.effectPresetItems,this.effectMenu),"effect_favorites"===UITools.getToolValue("editor_effect","updating_id"))if(this.favoriteEffectIDs.length){for(var e=document.createDocumentFragment(),t=0;t<this.favoriteEffectIDs.length;t++){var i=this.favoriteEffectIDs[t],r=BFN.effectIDMap.hasOwnProperty(i)?BFN.effectIDMap[i]:"null",a="".concat(r,"_").concat(i,"_menu"),n=document.getElementById(a);if(n){if(!document.getElementById("".concat(a,"_placeholder"))){var o=document.createElement("div");o.id="".concat(a,"_placeholder"),n.insertAdjacentElement("afterend",o)}e.appendChild(n),this.effectPresetItems.push(n)}}this.effectMenu.appendChild(e),this.effectPresetItems.forEach(e=>e.generateItem()),BFN.PresetMenuItemThumbManager.processItems(this.effectPresetItems)}else this.effectMenu.appendChild(document.createElement("string").addClass("tool-menu__message").setLang("no_favorites"))}handleArtsyCategory(){if(this.returnPresetItems(this.artsyPresetItems,this.artsyMenu),"artsy_favorites"===UITools.getToolVO("editor_artsy").updating_id){var e=document.createDocumentFragment();if(this.favoriteArtsyIDs.length){for(var t=0;t<this.favoriteArtsyIDs.length;t++){var i=this.favoriteArtsyIDs[t],r=BFN.artsyIDMap.hasOwnProperty(i)?BFN.artsyIDMap[i]:"null",a="".concat(r,"_").concat(i,"_menu"),n=document.getElementById(a);if(n){if(!document.getElementById("".concat(a,"_placeholder"))){var o=document.createElement("div");o.id="".concat(a,"_placeholder"),n.insertAdjacentElement("afterend",o)}e.appendChild(n),this.artsyPresetItems.push(n)}}this.artsyMenu.appendChild(e),this.artsyPresetItems.forEach(e=>e.generateItem()),BFN.PresetMenuItemThumbManager.processItems(this.artsyPresetItems)}else this.artsyMenu.innerHTML='<string class="tool-menu__message" data-lang="no_favorites">'.concat(BeFunky.LanguageManager.getString("no_favorites"),"</string>")}}updateFavoriteMenuButtons(){var e=BFN.BfnService.userLoggedIn?"block":"none";document.getElementById("editor_effect_effect_favorites").setStyles({display:e}),document.getElementById("editor_artsy_artsy_favorites").setStyles({display:e})}returnPresetItems(e,t){if(e&&t){for(var i=0;i<e.length;i++){var r=e[i];if(r===BFN.activePresetMenuItem&&document.getElementById("editor_apply_cancel_cancel").click(),t.querySelector("#".concat(r.id))){var a=document.getElementById("".concat(r.id,"_placeholder"));a.insertAdjacentElement("afterend",r),a.parentNode.removeChild(a)}}e.splice(0),t.innerHTML=""}}registerFavoriteStar(e){e&&e.favoriteID?(this.favoriteStars[e.favoriteID]=e,e.selected=this.favoriteIDs.includes(e.favoriteID),e.addEventListener("click",()=>{if(BFN.BfnService.userLoggedIn){if(!BFN.toolViewstates.hasOwnProperty(e.presetID))return BeFunky.throwError("BFN.toolViewstates missing favorite star presetID",e.presetID),void UIMessages.display("Error");var t=null,i=null,r=null;switch(BFN.toolViewstates[e.presetID]){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:t="effect",i="effects_fav",r=BFN.FavoritesManager.favoriteEffectIDs.slice(0);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY:t="artsy",i="artsy_fav",r=BFN.FavoritesManager.favoriteArtsyIDs.slice(0)}i&&(e.selected?(BFN.FavoritesManager.favoriteRemoved=!0,r.splice(r.indexOf(e.favoriteID),1),UIMessages.display("favorite_removed")):(r.push(e.favoriteID),UIMessages.display("favorite_added")),BFN.SettingsManager.updateSetting(i,r),BFN.SettingsManager.getSetting(i).then(e=>{BFN.FavoritesManager.handleFavoritesLoaded(t,e)}))}else UIMessages.display("error_not_logged_in",1500)})):BeFunky.throwError("Invalid favorite star registered",e)}updateFavoriteStars(){Object.entries(this.favoriteStars).forEach(e=>{var i=t(e,2),r=i[0];i[1].selected=this.favoriteIDs.includes(r)})}handleAppComplete(e){this.updateFavoriteMenuButtons(),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged.bind(this))}handleUserDataChanged(e){this.updateFavoriteMenuButtons()}handleFavoritesLoaded(e,t){var i,r;switch(e){case"artsy":i=this.favoriteArtsyIDs,r=this.handleArtsyCategory.bind(this);break;case"effect":i=this.favoriteEffectIDs,r=this.handleEffectCategory.bind(this)}if(!i)return BeFunky.logError("Invalid Favorites category",e);i.splice(0),t.filter(e=>!this.NOT_ALLOWED_FAVS.includes(e)).forEach(e=>{i.push(e)}),this.updateFavoriteStars(),this.favoriteRemoved&&BFN.PhotoEditorCanvasTools.currentTool&&(this.favoriteRemoved=!1),r()}get favoriteIDs(){return[...this.favoriteEffectIDs,...this.favoriteArtsyIDs]}get effectMenu(){return this._effectMenu||(this._effectMenu=document.querySelector("#effect_favorites_menu .menu-content")),this._effectMenu}get artsyMenu(){return this._artsyMenu||(this._artsyMenu=document.querySelector("#artsy_favorites_menu .menu-content")),this._artsyMenu}}BFN.SingletonQueue.add(()=>{BFN.FavoritesManager=new Hu});class zu{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.buttons={},this.panelHeaders={}}registerButtonIcon(e){e&&e.batchToolID?this.buttons[e.batchToolID]?BeFunky.throwError("Batch processing button icon already registered for batchToolID",e.batchToolID):(this.buttons[e.batchToolID]=e,e.selected=this.isSelected(e.batchToolID),e.addEventListener("click",()=>{this.showHelpClue(()=>{var t=e.getBoundingClientRect();return{left:"".concat(t.right+30,"px"),top:"".concat(Math.round(t.top+t.height/2),"px")}}).then(t=>{if(t){var i=e.closest(".preset-menu-item");i&&i.helpClueID&&BFN.HelpClueManager.hide(i.helpClueID)}this.handleIconClick(e.batchToolID,t)})})):BeFunky.throwError("Invalid batch processing button icon registered",e)}updateButtonIcons(){Object.entries(this.buttons).forEach(e=>{var i=t(e,2),r=i[0];i[1].selected=this.isSelected(r)})}registerPanelHeader(e){e&&e.batchToolID?this.panelHeaders[e.batchToolID]?BeFunky.throwError("Batch processing Panel Header icon already registered for batchToolID",e.batchToolID):(this.panelHeaders[e.batchToolID]=e,this.isSelected(e.batchToolID)&&e.updateButtonData("batch",{icon:"batch-icon-blue",tooltip:"batch_tool_remove"}),e.addEventListener("BATCH",()=>{this.showHelpClue(()=>{var t=e.getBoundingClientRect();return{left:"".concat(t.right+12,"px"),top:"".concat(t.top+t.height/2+4,"px")}}).then(t=>{this.handleIconClick(e.batchToolID,t)})})):BeFunky.throwError("Invalid batch processing panel header registered",e)}updatePanelHeaders(){var e=["batch-icon-blue","batch-icon-white"],i=["batch_tool_remove","batch_tool_add"];Object.entries(this.panelHeaders).forEach(r=>{var a=t(r,2),n=a[0],o=a[1],s=this.isSelected(n);if(s&&o.buttonData.batch.icon!==e[0]){var l="".concat(e[0]).concat(o.hasClass("panel-header--preset")?"-14":"");o.updateButtonData("batch",{icon:l,tooltip:i[0]})}else if(!s&&o.buttonData.batch.icon!==e[1]){var h="".concat(e[1]).concat(o.hasClass("panel-header--preset")?"-14":"");o.updateButtonData("batch",{icon:h,tooltip:i[1]})}})}showHelpClue(e){return BFN.HelpClueManager.wasClueDismissed("batch_icon").then(t=>{if(t)return!1;var i=e(),r=i.top,a=i.left,n=document.getElementById("batch_icon_walkthrough");return BFN.HelpClueManager.show("batch_icon",{force:!0,renderOptions:{side:"left",positionFactor:0,strong:!1,top:r,left:a,zIndex:"10",container:n,button:{langID:"try_it_now",onClick:()=>BFN.BatchProcessingManager.openModal()}}}),requestAnimationFrame(()=>{var e=n.firstElementChild,t=e.container.getBoundingClientRect(),i=t.bottom-BFN.appRect.bottom;i<-16||(e.positionFactor+=(i+16)/(t.height-32-e.arrowBase))}),!0})}isSelected(e){return BFN.BatchToolManager.selectedIDs.includes(e)}handleIconClick(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=BFN.BatchToolManager.selectedIDs.slice(0),r=this.isSelected(e);r&&t||(r?(i.splice(i.indexOf(e),1),UIMessages.display("batch_tool_removed")):(i.push(e),UIMessages.display("batch_tool_added")),BFN.BatchToolManager.selectedIDs=i)}}BFN.SingletonQueue.add(()=>{BFN.BatchIconManager=new zu});class Xu{constructor(){this.init()}init(){BeFunky.log("ZoomManager Init"),this.initDefaultValues()}initDefaultValues(){this.zoomWheelActive=!1,this.zoomWheelTimer=0,this.zoomSlider=null,this.zoomPercentLabel=null,BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this)),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppViewstateUpdated.bind(this)),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),UITools.addEventListener(UIToolsEvents.TOOL_PARAM_UPDATED.type,this.handleZoomAmountChange.bind(this))}handleZoom(){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),t=UITools.getToolVO("zoom");if(e.canvasScaling!==t.updating&&(e.canvasScaling=t.updating),e.canvasScaling){var i=t.stagger_factor;"minus"===t.updating_id?e.canvasScale*=1-.2*i:"plus"===t.updating_id?e.canvasScale*=1+.25*i:e.canvasScale!==t.amount/100&&(e.canvasScale=t.amount/100)}if(UITools.getToolValue("zoom","exact_fit"))switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:e.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME);break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:e.dispatchEvent(BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME);break;case BFN.AppModelViewStates.VIEWING_DESIGNER:e.dispatchEvent(BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME)}UITools.getToolValue("zoom","full_screen")&&BFN.AppModel.toggleFullscreen(),BFN.ZoomRegion.show()}handleZoomAmountChange(e){"zoom"===e.data.toolID&&"amount"===e.data.paramID&&(this.zoomPercentLabel||(this.zoomPercentLabel=document.getElementById("zoom_percent_label")),this.zoomPercentLabel.textContent=Math.round(e.data.value).toString())}updateZoomRange(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null,i=0,r=0;switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:t=BFN.PhotoEditorCanvasModel,BFN.PhotoEditorModel.currentTexture&&(i=BFN.PhotoEditorModel.currentTexture.width,r=BFN.PhotoEditorModel.currentTexture.height,BFN.PhotoEditorCanvasTools.currentTool&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemWidth")&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemHeight")&&(i=BFN.PhotoEditorCanvasTools.currentTool.itemWidth,r=BFN.PhotoEditorCanvasTools.currentTool.itemHeight));break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:t=BFN.CollageMakerCanvasModel,i=BFN.CollageMakerCanvasPhotoGrid.gridWidth,r=BFN.CollageMakerCanvasPhotoGrid.gridHeight;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:t=BFN.DesignerCanvasModel,i=BFN.DesignerCanvas.canvasWidth,r=BFN.DesignerCanvas.canvasHeight}if(BFN.TransformItemIsolator.active&&(i=BFN.TransformItemIsolator.itemWidth,r=BFN.TransformItemIsolator.itemHeight),t&&i>0&&r>0){var a=BFN.StageModel.stageW,n=BFN.StageModel.stageH;t.minCanvasScale=.4*Math.min(1,a/i,n/r);var o=Math.round(100*t.minCanvasScale),s=Math.round(100*t.maxCanvasScale);if(this.zoomSlider=this.zoomSlider||document.getElementById("zoom_amount").noUiSlider,!this.zoomSlider)return;var l=this.zoomSlider.get();this.zoomSlider.updateOptions({range:{min:o,max:s}}),e?(UITools.setToolValue("zoom","amount",100*t.canvasScale),UITools.updateToolControl("zoom_amount")):l<o&&(this.zoomSlider.set(o),t.canvasScaling=!0,t.canvasScale=o/100,t.canvasScaling=!1,BFN.MainUI.requestRender())}}handleAppReady(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_WHEEL.type,this.handleMainUIMouseWheel.bind(this))}handleAppViewstateUpdated(){this.updateZoomRange(!0)}handleStageDimensionsUpdated(){this.updateZoomRange()}handleMainUIMouseWheel(e){BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture||BFN.ImageCutout.cutoutActive||BeFunky.isPointerDown||BFN.ImagePainterUndoManager&&BFN.ImagePainterUndoManager.currentImagePainter&&BFN.ImagePainterUndoManager.currentImagePainter.mouseDown||(this.zoomWheelTimer=20,this.zoomWheelActive||(this.zoomWheelActive=!0,this.tickZoomWheelTimer()),UITools.setToolValue("zoom","stagger_factor",Math.abs(e.deltaY/100)),e.deltaY<0?UITools.setToolValue("zoom","plus",!1,!0):e.deltaY>0&&UITools.setToolValue("zoom","minus",!1,!0),UITools.applyTool("zoom"))}tickZoomWheelTimer(){--this.zoomWheelTimer<=0?(this.zoomWheelActive=!1,UITools.setToolValue("zoom","stagger_factor",1),UITools.setToolValue("zoom","amount",UITools.getToolValue("zoom","amount"),!1),UITools.applyTool("zoom")):setTimeout(this.tickZoomWheelTimer.bind(this),0)}}BFN.SingletonQueue.add(()=>{BFN.ZoomManager=new Xu});class ju{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){var e=document.getElementById("collage_customize_menu");this.panelHeader=e.querySelector(".panel-header"),this.collageControls=e.querySelector(".collage-controls"),this.designerControls=e.querySelector(".designer-controls"),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppViewstateUpdated.bind(this))}handleCustomize(){switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:BFN.CollageMakerCanvas.handleCustomize();break;case BFN.AppModelViewStates.VIEWING_DESIGNER:BFN.DesignerCanvas.handleCustomize()}}updateMenuDisplay(){switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:UITools.setToolValue("collage_customize","background_color",BFN.CollageMakerCanvasBackground.color),UITools.updateToolControls("collage_customize"),this.collageControls.setStyles({display:"block"}),this.designerControls.setStyles({display:"none"}),this.panelHeader.helpEnabled=!1;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:UITools.setToolValue("collage_customize","background_color",BFN.DesignerCanvasBackground.color),UITools.updateToolControls("collage_customize"),this.collageControls.setStyles({display:"none"}),this.designerControls.setStyles({display:"block"}),this.panelHeader.helpEnabled=!0}}handleAppViewstateUpdated(){this.updateMenuDisplay()}}BFN.SingletonQueue.add(()=>{BFN.CustomizeManager=new ju});class Wu{constructor(){this.isNeedToOpenTouchUp=!1,this.category=null}openPhotoEditorSideMenu(e){if(e&&BFN.PhotoEditorModel.currentTexture){switch(this.category=null,e){case"edit-photo":this.category={main:"editor_main",sub:"edit"};break;case"touch-up":this.category={main:"editor_main",sub:"touch_up"};break;case"photo-effects":this.category={main:"editor_main",sub:"effect"};break;case"photo-to-art":this.category={main:"editor_main",sub:"artsy"};break;case"frames":this.category={main:"editor_main",sub:"frame"};break;case"graphics":this.category={main:"editor_main",sub:"graphic"};break;case"overlay":this.category={main:"editor_main",sub:"overlay"};break;case"text-editor":this.category={main:"editor_main",sub:"text"};break;case"textures":this.category={main:"editor_main",sub:"texture"};break;case"crop-photo":case"recortar-fotos":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"crop"};break;case"resize-image":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"resize"};break;case"background-remover":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"background"};break;case"cutout":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"cutout"};break;case"blur-image":case"difuminar-fotos":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"blur"};break;case"replace-color":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"replace_color"};break;case"hair-color":this.category={first_main:"editor_main",first_sub:"touch_up",main:"editor_touch_up",sub:"hair_color"};break;case"effect-pop-art":this.category={first_main:"editor_main",first_sub:"effect",main:"editor_effect",sub:"popartfx"};break;case"effect-featured":case"effect-chromatic":case"effect-black&white":case"effect-charcoal":case"effect-color-pinhole":case"effect-cooler":case"effect-cross-process":case"effect-cyanotype":case"effect-grunge":case"effect-hdr":case"effect-holga-art":case"effect-instant":case"effect-line-artopia":case"effect-lomo-art":case"effect-motion-color":case"effect-old-photo":case"effect-orton-style":case"effect-patriotic":case"effect-pinhole":case"effect-sepia":case"effect-stenciler":case"effect-summer":case"effect-sunburst":case"effect-tilt-shift":case"effect-tin-type":case"effect-united-colors":case"effect-warmer":case"effect-viewfinder":case"effect-vintage-colors":case"effect-winter":var t=e.replace("effect-","").replace("-","").replace("fx","");"black&white"===t?t="bw":"tintype"===t&&(t="tinytype"),this.category={first_main:"editor_main",first_sub:"effect",main:"editor_effect",sub:t};break;case"lens-flare":this.category={first_main:"editor_main",first_sub:"effect",main:"editor_effect",sub:"lens_flares"};break;case"digital-art":this.category={first_main:"editor_main",first_sub:"artsy",main:"editor_artsy",sub:"digitalart"};break;case"photo-enhancer":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"edit_dlx"};break;case"cartoonizer":this.category={first_main:"editor_main",first_sub:"artsy",main:"editor_artsy",sub:"cartoonizer"};break;case"fathers-day":this.category={first_main:"editor_main",first_sub:"graphic",main:"editor_graphic",sub:"holiday_fathers_day"}}if(this.category){if(this.category.hasOwnProperty("first_main")&&(UITools.setToolValue(this.category.first_main,this.category.first_sub,!1),UITools.applyTool(this.category.first_main)),this.category.hasOwnProperty("sub")){if("edit_dlx"===this.category.sub){var i=document.getElementById("editor_edit_accordion_menu");return void(i.activeSections.includes("enhance_dlx")||(i.activeSections=["enhance_dlx",...i.activeSections]))}if("edit"===this.category.sub&&this.isNeedToOpenTouchUp&&(this.category.sub="touch_up"),UITools.setToolValue(this.category.main,this.category.sub,!1),UITools.applyTool(this.category.main),"editor_effect"===this.category.main&&!BFN.PresetMenuItemThumbManager.thumbSourceTexture){var r=this.category.sub;BFN.PhotoEditorMenuModel.addEventListener(BFN.PhotoEditorMenuModelEvents.CURRENT_IMAGE_THUMB_UPDATED.type,BeFunky.once(()=>{BeFunky.waitUntil({condition:()=>BFN.XMLGraphicLoader._isLoaded,onSuccess:()=>{var e=document.getElementById("".concat(r,"_menu"));if(e&&e.hasClass("active")){var t=e.querySelectorAll(".preset-menu-item");BFN.PresetMenuItemThumbManager.processItems(t)}},onTimeout:()=>{BeFunky.reportWarning("Deep link effect thumbnails timed out")},interval:100,maxAttempts:30})}))}}this.category=null,this.isNeedToOpenTouchUp=!1}}}handleEditorDeepLink(){if("batch"===window.currentDeepLinkParameters.type&&!BeFunky.ignoreDeepLinkAction)return BeFunky.ignoreDeepLinkAction=!0,BFN.BatchProcessingManager.openModal();BFN.PhotoEditorModel.currentTexture&&this.handleEditorImageDeepLink()}handleEditorImageDeepLink(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{},t=window.currentDeepLinkParameters.type,i=window.currentDeepLinkParameters.tag;if("batch"!==t||BeFunky.ignoreDeepLinkAction||(BeFunky.ignoreDeepLinkAction=!0,BFN.BatchProcessingManager.openModal()),"graphics"===t&&i&&!BeFunky.ignoreDeepLinkAction&&BFN.GraphicLibraryManager.openModal(i),"photoeditor"===t||BeFunky.ignoreDeepLinkAction){if(BFN.mainMenuStates.editor.secondary)return e();t="edit-photo"}["collage","designer"].includes(t)&&(BeFunky.reportWarning("Invalid editor deep link type: ".concat(t)),t="edit-photo"),BFN.DeepLinkManager.openPhotoEditorSideMenu(t),setTimeout(()=>{BeFunky.waitUntil({condition:()=>!BFN.MainUI.viewportUpdating,onSuccess:e,onTimeout:()=>{BeFunky.reportWarning("viewportUpdating timed out"),e()},interval:100,maxAttempts:50})},0),BeFunky.ignoreDeepLinkAction=!0}getDesignerDeepLinkData(){var e=window.currentDeepLinkParameters,t=e.tag,i=e.template;return BeFunky.ignoreDeepLinkAction||!i&&!t?{deepLinkTagID:null,deepLinkTemplateID:null,deepLinkTemplateRoute:null}:{deepLinkTagID:t||null,deepLinkTemplateID:i||null,deepLinkTemplateRoute:BeFunky.sessionRoutes[BeFunky.sessionRoutes.length-1]}}handleDesignerDeepLink(){if(!BeFunky.ignoreDeepLinkAction){var e=this.getDesignerDeepLinkData(),t=e.deepLinkTagID,i=e.deepLinkTemplateID,r=e.deepLinkTemplateRoute;t?BFN.DesignerTemplateManager.openModal(t):i?BFN.DesignerTemplateManager.openDeepLinkTemplatePreview(i,r):BFN.DesignerModel.projectVO._wasReset&&BFN.DesignerTemplateManager.openModal()}}}BFN.SingletonQueue.add(()=>{BFN.DeepLinkManager=new Wu});class Yu{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.isDataLoaded=!1,this.loadedPatternCategories=[],this.loadedPatternImages=[],this.menuImageVOs=[],this.usedPatternBaseTextures=[]}handlePatternCategory(){var e=UITools.getToolValue("collage_patterns","updating_id");if(!this.loadedPatternCategories.includes(e)){this.loadedPatternCategories.push(e);var t=[],i=i=>r=>{t.push({isPlus:i,id:"patterns_".concat(e,"_").concat(i?"plus":"free","_").concat(r),num:r})},r=BFN.PatternsData["patterns_".concat(e)];r.freePatterns.forEach(i(!1)),r.plusPatterns.forEach(i(!0)),this.createTertiaryMenu(e,r.name,t)}this.loadedPatternImages.includes(e)||BFN.PatternsThumbLoader.load("patterns_".concat(e),function(t){t.success;var i=t.error;if(i)return BeFunky.logError(i);this.loadedPatternImages.push(e),BFN.PatternsThumbLoader.thumbs["patterns_".concat(e)].forEach(e=>{var t=e.id,i=e.data,r=document.getElementById(t);r.menuImageVO.thumbURL=i,r.querySelector(".tertiary-grid__image").setStyles({backgroundImage:"url(".concat(i,")")})})}.bind(this))}loadCategories(){this.isDataLoaded||BFN.PatternsDataLoader.load(()=>{if(!this.isDataLoaded&&!Object.keys(BFN.PatternsData).length)return BeFunky.logError("Unable to get pattern category data");this.isDataLoaded=!0,[...document.getElementById("collage_patterns_category_menu").children].forEach(e=>e.disabled=!1)})}createTertiaryMenu(e,t,i){var r="collage_patterns_".concat(e,"_menu"),a=document.createElement("div");a.id=r,a.addClass("tool-menu"),a.setStyles({paddingBottom:0});var n=document.createElement("div");n.addClass("panel-header"),BFN.UI.panelHeader(n,{name:e,modifier:"tertiary"});var o=document.createElement("div");o.addClass("tools-scrollable");var s=document.createElement("div");s.addClass("tertiary-grid"),i.forEach(e=>{var i=document.createElement("button"),r=e.id;i.categoryName=t,i.id=r,i.isPlus=e.isPlus,i.className="tertiary-grid__item tertiary-grid__item--pattern",i.dataset.bfntooltip="drag_or_double_click_pattern",i.isPlus&&i.addClass("tertiary-grid__item--is-plus");var a=document.createElement("span");a.className="tertiary-grid__image tertiary-grid__image--pattern",i.appendChild(a);var n=document.createElement("span");n.innerHTML=e.isPlus?'<svg class="icon icon-size-regular"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#upgrade-star"></use></svg>':"Free",n.className=e.isPlus?"tertiary-grid__badge badge badge-warning plus-badge":"tertiary-grid__badge badge badge-default free-badge",i.appendChild(n),s.appendChild(i);var l=this.getMenuImageVO(r);l.name="".concat(t," Pattern ").concat(e.num),l.imageURL="".concat(BFN.patternsUrl).concat(t.split(" ").join("-"),"/").concat(r,".png?io=off"),i.menuImageVO=l,BFN.UI.draggableElement(i,o),i.addEventListener("dblclick",this.handleItemDoubleClick),i.addEventListener("dragstarted",this.handleItemDragStarted),i.addEventListener("dragstopped",this.handleItemDragStopped)}),a.appendChild(n),a.appendChild(o),o.appendChild(s),document.getElementById("editor_tool_menu_container").appendChild(a)}doubleBlobDimensions(e,t,i){BFN.TextureUtils.blobOrBase64ToTexture(t,t=>{var r=t.error,a=t.texture;if(r)return i({error:r});var n=BFN.Util.getTextureAverageColor(a,!0),o=PIXI.RenderTexture.create(2*a.width,2*a.height);o.copyPixels(a,new PIXI.Point(0,0)),o.copyPixels(a,new PIXI.Point(a.width,0),!1),o.copyPixels(a,new PIXI.Point(0,a.height),!1),o.copyPixels(a,new PIXI.Point(a.width,a.height),!1),a.destroyGC(!0),(a=o).baseTexture.averageColor=n,a.baseTexture.isPattern=!0,e.imageTexture=a,BFN.TextureUtils.textureToBlobWithErrorHandling(a,{isTransparent:!1}).then(e=>i({blob:e}),e=>i({error:e}))})}destroyUnusedPatternBaseTextures(){this.updateUsedPatternBaseTextures(),this.destroyPatternBaseTextures(this.usedPatternBaseTextures)}updateUsedPatternBaseTextures(){var e=e=>{e&&e.isPattern&&!this.usedPatternBaseTextures.includes(e)&&this.usedPatternBaseTextures.push(e)};this.usedPatternBaseTextures.splice(0),Object.values(BFN.AppModelViewStates).forEach(t=>{BFN.TransformStateModel.getTransitions(t).forEach(t=>{e(t.startState.collageSettings.backgroundPatternBaseTexture),e(t.endState.collageSettings.backgroundPatternBaseTexture),e(t.startState.imageTexture?t.startState.imageTexture.baseTexture:null),e(t.endState.imageTexture?t.endState.imageTexture.baseTexture:null)})}),BFN.CollageMakerCanvas.transformLayer.transformItems.forEach(t=>{e(t.itemContent.texture?t.itemContent.texture.baseTexture:null)}),BFN.CollageMakerHistoryModel.snapshotVOs.forEach(t=>{e(t.backgroundPatternBaseTexture),t.snapshotChildren.forEach(t=>{e(t.texture?t.texture.baseTexture:null)})})}destroyPatternBaseTextures(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.menuImageVOs.forEach(t=>{if(t.imageTexture&&t.imageTexture.baseTexture&&!e.includes(t.imageTexture.baseTexture)){try{t.imageTexture.destroyGC(!0)}catch(e){}t.imageTexture=null}})}getMenuImageVO(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.startsWith("patterns_"))return BeFunky.logError("Invalid Pattern MenuImageVO ID: ".concat(e));var i=this.menuImageVOs.find(t=>t.id===e);if(i||!t)return i;var r=new BFN.MenuImageVO;return r.id=e,r.indexedDBKey="image__".concat(e),r.isPattern=!0,this.menuImageVOs.push(r),r}handleItemDoubleClick(e){var t=e.target;if(t.isPlus&&!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("COLLAGE","PATTERN_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Add Plus Pattern"]);BFN.ImageLibraryManager.addImageToCanvas(t.menuImageVO,{textureReadyCallback(e){BFN.CollageMakerCanvasPhotoGrid.createHistoryTransition("background_pattern"),BFN.CollageMakerCanvasPhotoGrid.setPatternBackgroundTexture(e),BFN.CollageMakerCanvasPhotoGrid.registerHistoryTransition()}})}handleItemDragStarted(e){var t=e.target;BFN.DragScreen.show(t.menuImageVO.thumbURL),BFN.AppModel.viewState!==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER||BFN.CollageMakerCanvasPhotoGridModel.freeform||(BFN.PhotoGrid.awaitingDrop=!0),BFN.TransformModel.awaitingDrop=!0}handleItemDragStopped(e){var t=e.target,i=e.detail.canvasCoordinates;if(t.isPlus&&!BFN.BfnService.userIsPlus)return BFN.PhotoGrid.awaitingDrop=!1,BFN.BfnService.upgrade("COLLAGE","PATTERN_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Add Plus Pattern"]);i?BFN.ImageLibraryManager.addImageToCanvas(t.menuImageVO,{initialCenterPosition:i}):BFN.PhotoGrid.awaitingDrop=!1}}BFN.SingletonQueue.add(()=>{BFN.CollageMakerPatternManager=new Yu});class qu{constructor(){this.init()}init(){this.loadedTemplateCategories=[],this.spriteHasLoaded=!1,this.spriteLoadAttempt=0,this.spriteUrl="".concat(BFN.imagesURL,"app/collage-templates-sprite.png"),BFN.CollageMakerTemplateModel.addEventListener(BFN.CollageMakerTemplateModelEvents.CURRENT_TEMPLATE_UPDATED.type,()=>{var e="tertiary-grid__item--selected",t=BFN.CollageMakerTemplateModel.currentTemplate.menuItems,i=document.querySelectorAll(".tertiary-grid__item--layout.".concat(e));requestAnimationFrame(()=>{i.removeClass(e),t.forEach(t=>t.addClass(e))})})}handleTemplateCategory(){var e=UITools.getToolValue("collage_layouts","updating_id"),t="collage_layout_".concat(e,"_menu");if(this.loadBackgroundSprite(),!this.loadedTemplateCategories.includes(e)){this.loadedTemplateCategories.push(e);var i=BFN.CollageMakerTemplateData.templateCategoryVOs.find(t=>{return t.id===e}),r=i.templateVOs,a=document.createElement("div");a.id=t,a.addClass("tool-menu"),a.setStyles({paddingBottom:0});var n=document.createElement("div");n.addClass("panel-header"),BFN.UI.panelHeader(n,{name:i.name,modifier:"tertiary"});var o=document.createElement("div");o.addClass("tools-scrollable");var s=document.createElement("div");s.addClass("tertiary-grid"),r.forEach(e=>{var t=document.createElement("button");t.className="tertiary-grid__item tertiary-grid__item--layout",e.isPlus&&t.addClass("tertiary-grid__item--is-plus"),t.templateVO=e,e.menuItems.push(t),BFN.CollageMakerTemplateModel.currentTemplate===e&&t.addClass("tertiary-grid__item--selected");var i=document.createElement("span");i.className="tertiary-grid__image tertiary-grid__image--layout",i.setStyles({backgroundPosition:e.spritePosition,backgroundSize:e.spriteSize,imageRendering:BeFunky.isChromium?"pixelated":BeFunky.isFirefox?"-moz-crisp-edges":""}),t.appendChild(i),t.addEventListener("click",function(){if(e.isPlus&&!BFN.BfnService.userIsPlus){BFN.BfnService.upgrade("TEMPLATES","".concat(e.name.toUpperCase(),"_")+"UPGRADE","template");var t=null;return BFN.CollageMakerTemplateData.templateCategories.forEach(i=>{t||e.categoryID!==i.id||(t=i.name)}),void(t&&BFN.UserActionManager.addUpgradeAction(["Select Plus Layout",t,e.name]))}BFN.CollageMakerTemplateModel.currentTemplate=this.templateVO});var r=document.createElement("span");r.innerHTML=e.isPlus?'<svg class="icon icon-size-regular"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#upgrade-star"></use></svg>':"Free",r.className=e.isPlus?"tertiary-grid__badge tertiary-grid__badge--layout badge badge-warning plus-badge":"tertiary-grid__badge tertiary-grid__badge--layout badge badge-default free-badge",t.appendChild(r),s.appendChild(t)}),a.appendChild(n),a.appendChild(o),o.appendChild(s),document.getElementById("editor_tool_menu_container").appendChild(a)}}loadBackgroundSprite(){if(!this.spriteHasLoaded){var e=new Image;e.onload=(()=>{this.spriteHasLoaded=!0;var t=document.createElement("style");document.head.appendChild(t),t.sheet.insertRule(".bfn .tertiary-grid__image--layout {  background-image: url(".concat(e.src,"); }"),0)}),e.src=this.spriteUrl+(this.spriteLoadAttempt?"?attempt=".concat(this.spriteLoadAttempt):""),this.spriteLoadAttempt++}}}function Ku(){var t=e(['\n        <div class="recent-projects__header">\n            ','\n            <button class="button button--icon button--transparent" @click=','" ?disabled=',">\n                ",'\n            </button>\n        </div>\n        <div class="recent-projects__scroll-container">\n            <div class="recent-projects__content">\n                <image-gallery\n                    .images=',"\n                    .isLoading=","\n                    .message=","\n                    .onSelectItem=","\n                    .emptyState=","\n                    .currentWidth=","\n                    .rowHeight=","\n                    .gutterWidth=","\n                />\n            </div>\n        </div>"]);return Ku=function(){return t},t}function Qu(){var t=e(['<div class="recent-projects"></div>']);return Qu=function(){return t},t}BFN.SingletonQueue.add(()=>{BFN.CollageMakerTemplateManager=new qu});var Zu=BeFunky.lit,Ju=Zu.html,$u=Zu.setupState,ed=Zu.render,td=(Zu.lang,Zu.icon),id=Zu.elem;function rd(){var e=id(Qu()),i=BeFunky.debounce(()=>ed(function(){var e=a.isLoggedIn?a.isLoading?{isLoading:!0}:a.fetchProjectsError?{message:{isError:!0,text:BeFunky.failureReason(a.fetchProjectsError),buttonText:"try_again",buttonAction:()=>u()}}:a.projects.length?{images:(a.projects,m=BeFunky.isRetina()?202:101,p={width:m,height:m,fit:"crop",auto:"webp"},a.projects.map(e=>{e.id=e.templateid;var t=new BFN.MenuImageVO;return t.createId("befunky_project",e.id),t.name=e.filename,t.thumbURL=BeFunky.addParamsToURL(e.thumburl,p),t.thumbWidth=m,t.thumbHeight=m,t.isTransparent=/\.png($|\?)/.test(e.thumburl),t})),onSelectItem:e=>{var t=e.id.replace(/^befunky_project_/,""),i=a.projects.find(e=>e.id===t);BeFunky.SavedProjectManager.openUserSavedProject(i).catch(e=>{BeFunky.logError("Failed to open recent project",e)})}}:{emptyState:{icon:"no-project-icon",text:"no_saved_projects",linkText:"learn_more",linkHref:"https://support.befunky.com/hc/en-us/articles/360003279091-How-Do-I-Save-My-Project-So-I-Can-Edit-It-Later-"}}:{emptyState:{icon:"no-project-icon",text:"login_load_projects",buttonText:"sign_in",buttonAction:c}},t=e.isLoading,i=void 0!==t&&t,r=e.images,n=void 0===r?[]:r,o=e.message,l=e.emptyState,d=e.onSelectItem;var m,p;return Ju(Ku(),s,h,0===a.projects.length,td("view-current-projects","icon icon-size-medium"),n,i,o,d,l,214,100,12)}(),e),"raf"),r=t($u({isLoggedIn:!1,isLoading:!1,fetchProjectsError:"",projects:[]},i),2),a=r[0],n=r[1];BeFunky.LanguageManager.addLanguageUpdateListener(i),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,l),l();var o,s=(o=document.createElement("div"),BeFunky.panelHeader(o,{name:"recent_projects",tag:"h3",modifier:"accordion"}),o.addClass("recent-projects__heading"),o);return Object.assign(e,{fetchProjects:u}),e;function l(){var e=BeFunky.isLoggedIn(),t=a.isLoggedIn;n({isLoggedIn:e}),e&&!t&&u()}function h(){if(!a.isLoggedIn)return BFN.BfnService.login(()=>BeFunky.SavedProjectManager.openProjectModal());BeFunky.SavedProjectManager.openProjectModal()}function c(){return BFN.BfnService.login()}function u(){n({isLoading:!0}),BFN.SavedProjectService.getFirst100Projects().then(e=>{n({isLoading:!1,fetchProjectsError:"",projects:e.slice(0,10)})}).catch(e=>{n({isLoading:!1,fetchProjectsError:"no_results"===e?"":e,projects:[]})})}}function ad(){var t=e(['\n                    <p class="template-preview__sign-in">\n                        ','\n                        <button class="button button--link" @click=',">","</button>\n                    </p>\n                "]);return ad=function(){return t},t}function nd(){var t=e(['\n                    <button class="template-preview__button button button--blue button--lg" @click=',">","</button>\n                "]);return nd=function(){return t},t}function od(){var t=e(['\n                    <p class="template-preview__description">','</p>\n                    <button class="template-preview__button button button--blue-gradient button--lg" @click=',">","</button>\n                "]);return od=function(){return t},t}function sd(){var t=e(['\n            <div class="template-preview__left-column">\n                <div class="template-preview__image-outer">\n                    <div class="template-preview__image-inner" style=','>\n                        <div class="template-preview__image-placeholder" style=','></div>\n                    </div>\n                </div>\n            </div>\n            <div class="modal__body template-preview__content">\n                <div class="template-preview__header">\n                    <h3 class="template-preview__name">','</h3>\n                    <p class="template-preview__dimensions">',"</p>\n                </div>\n                ","\n                ","\n            </div>\n        "]);return sd=function(){return t},t}function ld(){var t=e(['<div id="template_preview" class="modal template-preview"></div>']);return ld=function(){return t},t}var hd=BeFunky.lit,cd=hd.html,ud=hd.setupState,dd=hd.render,md=hd.lang,pd=hd.elem;function gd(){var e=pd(ld()),i={templateID:"",thumbURL:"",imageURL:"",imageWidth:100,imageHeight:100,isTemplatePlus:!1,name:"",dimensions:"",version:void 0,trackSearchTerm:"",prevImageURL:"",nextImageURL:"",onPrev:void 0,onNext:void 0},r={isLoggedIn:BeFunky.isLoggedIn(),isPlus:BeFunky.isPlus()||BeFunky.isPaywallEnabled(),imageToRender:"",maxImageSize:[400,400],isFreeTrialEnabled:BeFunky.getFreeTrialEnabled()},a={},n=Object.assign({},i,r),o=BeFunky.debounce(()=>dd(function(){var e=l.isTemplatePlus&&!BeFunky.isPlus()&&!BeFunky.isPaywallEnabled(),t=[l.imageToRender?"background-image: url(".concat(l.imageToRender,")"):"","padding-bottom: ".concat(100/(l.imageWidth/l.imageHeight),"%")].filter(Boolean).join("; "),i=BFN.DesignerTemplateManager.parseDimensions(l.dimensions),r=i.printSize,a=i.pixelSize;return cd(sd(),"width: ".concat(function(){if(!l.imageURL)return 100;var e=l.imageWidth/l.imageHeight,t=l.maxImageSize[0]/l.maxImageSize[1];return e>=t?100:100*e/t}(),"%"),t,l.name,r?"".concat(a," (").concat(r,")"):a,e?cd(od(),f("designer_template_upgrade"),u,f(l.isFreeTrialEnabled?"start_trial":"upgrade")):cd(nd(),d,f("use_template")),l.isLoggedIn?"":cd(ad(),f("teaser_modal_have_an_account"),c,f("sign_in")))}(),e),"raf"),s=t(ud(n,e=>{!function(e){if(!e.imageURL)return;if(!l.imageURL)return h({imageToRender:""});function t(e){return!0===a[e]?Promise.resolve():a[e]instanceof Promise?a[e]:(a[e]=new Promise((t,i)=>{var r=new Image;r.src=e,r.onload=(()=>{t(),a[e]=!0}),r.onerror=(()=>{i(),delete a[e]})}),a[e])}h({imageToRender:l.thumbURL||l.imageURL}),t(l.imageURL).then(()=>{requestIdleCallback(()=>{h({imageToRender:l.imageURL})})}).catch(()=>{BeFunky.logError("Failed to preload Template preview",l.imageURL)}).then(()=>{[l.nextImageURL,l.prevImageURL].filter(Boolean).map(t)})}(e),o()}),2),l=s[0],h=s[1];return BeFunky.LanguageManager.addLanguageUpdateListener(o),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,function(){h({isLoggedIn:BeFunky.isLoggedIn(),isPlus:BeFunky.isPlus()||BeFunky.isPaywallEnabled()})}),BeFunky.onFreeTrialEnabledChange(e=>h({isFreeTrialEnabled:e}),!1),Object.assign(e,{open:function(){BeFunky.openModal(e,{addCloseButton:!0,onArrowClick:m,onOpen:()=>{var i=t(BeFunky.getModal(e.id).arrowButtons,2),r=i[0],a=i[1];r.disabled=!l.onPrev,a.disabled=!l.onNext},onClose:()=>{h(i)},onWindowResize:g})},close:p,setState:h}),e;function c(){BeFunky.openLoginPanel("SIGNIN")}function u(){BFN.UserActionManager.addUpgradeAction(["Select Plus Template",BFN.UserActionManager.translateToReadable(l.templateID)]),BFN.BfnService.upgrade("DESIGNER_TEMPLATE",l.templateID.replace(/ /g,"_").toUpperCase(),"designer_templates")}function d(){BFN.BfnService.track("CREATE","DESIGNER_TEMPLATE",l.templateID.replace(" ","_").toUpperCase());var e=l.imageURL;return BFN.ProjectManager.confirmLoadNewProject({onConfirm:()=>{BFN.DesignerTemplateManager.applyTemplate({id:l.templateID,name:l.name,version:l.version,trackingData:{id:l.templateID,name:l.name,searchTerm:l.trackSearchTerm}}),setTimeout(()=>{requestAnimationFrame(()=>{p(),BeFunky.closeModal("template_library",!1)})},100)},projectSection:"designer",getNewProjectThumbnail:()=>Promise.resolve({image:e})})}function m(e){"left"===e?l.onPrev():l.onNext()}function p(){BeFunky.closeModal(e)}function g(t){var i=t.availableWidth,r=t.availableHeight,a=Math.min(i,960),n=Math.min(688,Math.max(400,r));e.setStyles({width:"".concat(a,"px"),height:"".concat(n,"px")});var o=[.618*a-96,n-96];o.isIdenticalTo(l.maxImageSize)||h({maxImageSize:o})}function f(e){return md(e,"app")}}function fd(){var t=e(['<div style="flex: ',' 1 0%"></div>']);return fd=function(){return t},t}function vd(){var t=e(['<span class="badge badge-warning plus-badge editors-choice__plus-badge">',"</span>"]);return vd=function(){return t},t}function yd(){var t=e(['\n                            <div class="editors-choice__item"\n                                style="background-image: url(',");\n                                flex: ",' 1 0%;"\n                                @click=','>\n                            <div style="padding-bottom: ','%"></div>\n                            ',"\n                            </div>\n                        "]);return yd=function(){return t},t}function xd(){var t=e(['\n            <div class="editors-choice__row">\n                <div class="editors-choice__row-header">\n                    <p class="editors-choice__row-heading">','</p>\n                    <button class="button button--link button--tiny editors-choice__see-all" @click=',">",'</button>\n                </div>\n                <div class="editors-choice__images">\n                    ',"\n                    \x3c!-- Filler div if images do not fill up row --\x3e\n                    ","\n                </div>\n            </div>\n        "]);return xd=function(){return t},t}function _d(){var t=e(['\n    <div class="editors-choice" style=',">\n        ","\n    </div>"]);return _d=function(){return t},t}function Id(){var t=e(['\n        <div class="editors-choice editors-choice--loading">\n            <div><span class="loading-spinner"></span><string>',"</string></div>\n        </div>"]);return Id=function(){return t},t}var Td=BeFunky.lit,bd=Td.html,Sd=Td.icon,Cd=Td.lang;function Bd(e,t,i,r,a){var n={"Facebook & Instagram Stories":.916*r,"Facebook & Instagram Posts":1.16*r,"Facebook Page Covers":1.5*r,"YouTube Channel Art":1.3*r,"YouTube Thumbnails":1.3*r,"Twitter Headers":1.6*r,Invitations:1.2*r,"Business Cards":1.2*r,Infographics:.7*r};return e.length?bd(_d(),"width: ".concat(a,"px"),e.map(e=>{var i=e.title,o=e.tagID,s=e.templateData,l=0,h=n[i]||r;return bd(xd(),Cd(i,"modal"),()=>t({tagID:o}),Cd("view_all","modal"),s.sort((e,t)=>e.isPlus-t.isPlus).map((e,t)=>{var i=e.thumbWidth,r=e.thumbHeight,n=e.getImageURL,o=i&&r?i/r:1;if((l+=o>2?2+.3*(o-2):o)>h&&t>0)return"";var c=a*o/h,u=n?n(c):e.thumbURL;return e.lastRenderedThumb={url:u,renderedWidth:c},bd(yd(),u,o,()=>{!function e(t,i,r){var a=t.isPlus,n=t.projectFileName,o=t.dimensions,s=t.displayName,l=t.imageWidth,h=t.imageHeight,c=t.imageURL,u=t.lastRenderedThumb,d=t.version;var m=n.replace(".bfd","");var p=0!==i;var g=i!==r.length-1;BFN.DesignerTemplateManager.openPreviewModal({templateID:m,thumbURL:u.url,imageURL:c,imageWidth:l,imageHeight:h,name:s,dimensions:o,trackSearchTerm:"editors_choice",version:d,isTemplatePlus:a,prevImageURL:p&&r[i-1].imageURL,nextImageURL:g&&r[i+1].imageURL,onPrev:p?()=>{e(r[i-1],i-1,r)}:void 0,onNext:g?()=>{e(r[i+1],i+1,r)}:void 0})}(e,t,s)},100/o,e.isPlus&&!BFN.BfnService.userIsPlus?bd(vd(),Sd("upgrade-star","icon icon-size-regular")):"")}),l<h?bd(fd(),h-l):"")})):bd(Id(),Cd("loading","modal"))}function Fd(){var t=e(['<div id="template_library_custom_template_height" class="scrubber"></div>']);return Fd=function(){return t},t}function Ed(){var t=e(['<div id="template_library_custom_template_width" class="scrubber"></div>']);return Ed=function(){return t},t}function Pd(){var t=e(['\n                    <div class="blank-canvas__template-description">\n                        <p class="blank-canvas__template-title">','</p>\n                        <p class="blank-canvas__template-dimensions">',"</p>\n                    </div>\n                "]);return Pd=function(){return t},t}function Nd(){var t=e(['\n            <div class="blank-canvas__row-header">\n                <p class="blank-canvas__row-heading">','</p>\n            </div>\n            <div class="blank-canvas__gallery-row">\n                ',"\n            </div>\n        "]);return Nd=function(){return t},t}function Md(){var t=e(['\n            <h3 class="blank-canvas__custom-heading">','</h3>\n                <div class="control-item-columns blank-canvas__dimensions-scrubber">\n                    <div class="control-item">\n                    <label class="control-item-label">',"</label>\n                        ",'\n                    </div>\n                    <button class="button button--icon button--outline blank-canvas__swap-dimensions" @click="','">\n                        ','\n                    </button>\n                    <div class="control-item">\n                    <label class="control-item-label">',"</label>\n                        ",'\n                    </div>\n                    <button class="modal__button button button--blue button--medium" style="display: inline" @click="','">','</button>\n                </div>\n            <div class="blank-canvas__image-gallery">\n                ',"\n            </div>\n        "]);return Md=function(){return t},t}function Dd(){var t=e(['<div class="blank-canvas__section"></div>']);return Dd=function(){return t},t}var wd=BeFunky.lit,kd=wd.html,Ld=wd.render,Od=wd.lang,Rd=wd.elem,Ad=wd.icon;function Vd(e){var t,i,r={social:[{dimensions:"1024px x 768px",title:"Presentation (4:3)",image:"social_1024_768"},{dimensions:"1920px x 1080px",title:"Presentation (16:9)",image:"social_1920_1080"},{dimensions:"1080px x 1920px",title:"Social Media Story",image:"social_1080_1920"},{dimensions:"1080px x 1080px",title:"Instagram Post",image:"social_1080_1080"},{dimensions:"1200px x 1200px",title:"Facebook Post",image:"social_1200_1200"},{dimensions:"1702px x 630px",title:"Facebook Cover",image:"social_1702_630"},{dimensions:"1640px x 624px",title:"Facebook Page Cover",image:"social_1640_624"},{dimensions:"1920px x 1080px",title:"Facebook Event Cover",image:"social_facebook_event"},{dimensions:"2560px x 1440px",title:"YouTube Channel Art",image:"social_2560_1440"},{dimensions:"1280px x 720px",title:"YouTube Thumbnail",image:"social_1280_720"},{dimensions:"1200px x 675px",title:"Twitter Post",image:"social_1200_675"},{dimensions:"1500px x 500px",title:"Twitter Header",image:"social_1500_500"},{dimensions:"1000px x 1500px",title:"Pinterest Pin ",image:"social_1200_1800"},{dimensions:"3360px x 840px",title:"Etsy Big Banner",image:"social_3360_840"},{dimensions:"3360px x 448px",title:"Etsy Mini Banner",image:"social_3360_448"},{dimensions:"760px x 100px",title:"Etsy Order Receipt Banner",image:"social_760_100"}],print:[{dimensions:"3300px x 3300px",title:"Square",image:"print_11_11"},{dimensions:"1050px x 600px",title:"Business Card",image:"print_3point5_2"},{dimensions:"1500px x 900px",title:"Thank You Card",image:"print_5_3"},{dimensions:"1800px x 1200px",title:"Postcard",image:"print_6_4"},{dimensions:"2100px x 1500px",title:"Greeting Card",image:"print_7_5"},{dimensions:"1650px x 2550px",title:"Half Letter",image:"print_5point5_8point5"},{dimensions:"1200px x 2700px",title:"Rack Card",image:"print_4_9"},{dimensions:"2550px x 3300px",title:"Letter",image:"print_8point5_11"},{dimensions:"2481px x 3507px",title:"A4",image:"print_A4"},{dimensions:"2640px x 4080px",title:"Poster",image:"print_poster"}],ad:[{dimensions:"1200px x 628px",title:"Facebook Ad",image:"1200_628"},{dimensions:"120px x 600px",title:"Skyscraper",image:"online120_600"},{dimensions:"160px x 600px",title:"Wide Skyscraper",image:"online160_600"},{dimensions:"728px x 90px",title:"Leaderboard",image:"online728_90"},{dimensions:"728px x 210px",title:"Large Leaderboard",image:"728_210"},{dimensions:"300px x 250px",title:"Medium Rectangle",image:"300_250"},{dimensions:"336px x 280px",title:"Large Rectangle",image:"336_280"},{dimensions:"300px x 600px",title:"Half Page",image:"300_600"},{dimensions:"320px x 100px",title:"Large Mobile",image:"320_100"}]},a=Rd(Dd()),n=["social","print","ad"].map(t=>(function(t){var i=document.createElement("div");return i.setClass("image-gallery blank-canvas__gallery blank-canvas__gallery--".concat(t)),i.type=t,BFN.UI.imageGallery(i,{imagesPerRow:6,maxWidth:e,isGraphic:!0,imageSelectionHandler:e=>{var i=r[t][e.imageIndex],a=i.dimensions,n=i.title,o=BFN.DesignerTemplateManager.parseDimensions(a),s=o.width,l=o.height;return h(s,l,n),!1},extendItem:(e,i)=>{e.addClass("image-gallery__item--blank");var a=r[t][i.imageIndex],n=a.dimensions,o=a.title,s=BFN.DesignerTemplateManager.parseDimensions(n),l=s.pixelSize,h=s.printSize,c=Rd(Pd(),o,h||l);e.appendChild(c)}}),i})(t));n.forEach(e=>{e.images=function(e){return r[e].map((e,t)=>{var i=new BFN.MenuImageVO;return i.createId("designer_template",e.image),i.thumbURL="".concat(BFN.imagesURL,"app/blank-templates/").concat(e.image,".svg"),i.isSVG=!0,i.imageIndex=t,i})}(e.type)}),t=Rd(Ed()),i=Rd(Fd()),BFN.UI.scrubber(t),BFN.UI.scrubber(i),t.unit=i.unit="px",t.minValue=i.minValue=BFN.minImageSize,t.maxValue=i.maxValue=BFN.maxImageSize,t.currentValue=BFN.DesignerModel.projectVO.projectWidth||300,i.currentValue=BFN.DesignerModel.projectVO.projectHeight||300;var o=()=>Ld(kd(Md(),Od("create_your_own_canvas","modal"),Od("width","modal"),t,s,Ad("switch-button-icon"),Od("height","modal"),i,l,Od("create","modal"),["social_media","print","online_advertising"].map((e,t)=>kd(Nd(),Od(e,"modal"),n[t]))),a);return o(),BeFunky.LanguageManager.addLanguageUpdateListener(o),a.updateScrubberDimensions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;t.currentValue=e,i.currentValue=r},a.blankCanvasGalleries=n,a;function s(){var e=i.currentValue,r=t.currentValue;t.currentValue=e,i.currentValue=r}function l(){h(t.currentValue,i.currentValue)}function h(e,t,i){var r=new BFN.ProjectVO;if(r.version=2,r.section="designer",r.projectWidth=e,r.projectHeight=t,r.designerBackgroundColor="FFFFFF",i){r.sourceTemplateID="blank_".concat((e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/(^_+)|(_+$)/g,""))(i),"_").concat(e,"_").concat(t)}BFN.ProjectManager.confirmLoadNewProject({onConfirm:()=>{var a=i?{type:"Preset",name:"Blank ".concat(i),id:r.sourceTemplateID}:{type:"Custom",name:"Blank Custom"};BFN.ProjectManager.loadProject(r,!0,a),BeFunky.closeModal("template_library");var n="".concat(e," x ").concat(t).toUpperCase().replace(/ /g,"_").replace("_X_","x");BFN.BfnService.track("CREATE","DESIGNER_TEMPLATE","CUSTOM_".concat(n))},projectSection:"designer",getNewProjectThumbnail:()=>Promise.resolve({aspectRatio:e/t})})}}function Ud(){var t=e(['<div class="template-library__tags"></div>']);return Ud=function(){return t},t}function Gd(){var t=e(['<div class="template-library__search-autocomplete"></div>']);return Gd=function(){return t},t}function Hd(){var t=e(['<input type="search" id="template_library_search" class="input template-library__search-input search-box__input" required>']);return Hd=function(){return t},t}function zd(){var t=e(['<div class="badge plus-badge image-gallery__badge">',"</div>"]);return zd=function(){return t},t}function Xd(){var t=e(['<image-gallery\n            class="gallery template-library__results-gallery"\n            .images=',"\n            .message=","\n            .emptyState=","\n            .isLoading=","\n            .onSelectItem=","\n            .rowHeight=","\n            .currentWidth=","\n            .viewport=","\n            .debug=","\n            .extendItemTemplate=","\n        ></image-gallery>"]);return Xd=function(){return t},t}function jd(){var t=e(['\n        <div class="template-library__right-panel">\n            ','\n            <div class="modal__right-panel-scroller">\n            ',"\n            </div>\n        </div>"]);return jd=function(){return t},t}function Wd(){var t=e(['\n            <button class="button button--circle button--outline button--white button--icon button--tiny template-library__clear-results" @click="','" data-bfntooltip="cancel">\n                ',"\n            </button>\n        "]);return Wd=function(){return t},t}function Yd(){var t=e(['\n            <div class="template-library__results-header template-library__results-header--left">\n                <h3 class="template-library__results-heading">',"</h3>\n                ","\n            </div>\n        "]);return Yd=function(){return t},t}function qd(){var t=e(['\n        <div class="template-library__left-panel">\n            <form role="search" class="search-box template-library__search-box" @submit=',">\n                ","\n                ",'\n                <button type="reset" class="button button--icon button--large button--transparent search-box__clear">\n                    ','\n                </button>\n                <button type="submit" class="button button--icon button--large button--blue search-box__submit">\n                    ','\n                </button>\n            </form>\n            <div class="template-library__buttons">\n                <button\n                    class="','"\n                    @click="','"\n                    >','\n                </button>\n                <button\n                    class="','"\n                    id="designer_view_all_templates"\n                    @click="','"\n                    >',"\n                </button>\n            </div>\n            ","\n        </div>\n        ","\n        "]);return qd=function(){return t},t}function Kd(){var t=e(['\n        <div class="template-library__tabs">\n            <div class="toggle-group">\n                <label class="toggle-group__label">\n                    <input type="radio" @change='," .checked=",' name="template_library_tabs">\n                    <span class="toggle-group__button">','</span>\n                </label>\n                <label class="toggle-group__label">\n                    <input type="radio" @change='," .checked=",' name="template_library_tabs">\n                    <span class="toggle-group__button">','</span>\n                </label>\n            </div>\n            <div class="template-library__popover-placeholder"></div>\n        </div>\n        ']);return Kd=function(){return t},t}function Qd(){var t=e(['<div class="panel-header"></div>']);return Qd=function(){return t},t}function Zd(){var t=e(["\n            ","\n            ",'\n            <div class="modal__body template-library__body">\n                ',"\n            </div>\n        "]);return Zd=function(){return t},t}function Jd(){var t=e(['<div id="template_library" class="modal template-library"></div>']);return Jd=function(){return t},t}var $d=BeFunky.lit,em=$d.html,tm=$d.setupState,im=$d.render,rm=$d.lang,am=$d.elem,nm=$d.icon;function om(e){var i=am(Jd()),r=[],a=1600,n=a-288-48,o={viewBlankCanvas:!1,mode:"EDITORS_CHOICE",lastSearchTerm:"",lastSearchPage:-1,searchTerm:"",tagID:"editors_choice",tagName:"",editorsChoiceTemplates:[],targetAspectRatio:6,currentWidth:a,images:[],isLoading:!1,message:null,emptyState:null,viewport:void 0},s=!0,l=BeFunky.debounce(()=>{im(function(){return em(Zd(),b,em(Kd(),e=>d({viewBlankCanvas:!e.target.checked}),!u.viewBlankCanvas,rm("templates","modal"),e=>d({viewBlankCanvas:e.target.checked}),u.viewBlankCanvas,rm("blank_canvas","modal")),u.viewBlankCanvas?(v=v||Vd(a-80),C=!1,v.blankCanvasGalleries.forEach(e=>{e.currentWidth=u.currentWidth-80}),v):em(qd(),M,I,T,nm("global-cancel-icon","icon icon-size-small"),nm("global-search-icon","icon icon-global-search-icon"),"button button--list button--all-caps template-library__button ".concat("EDITORS_CHOICE"===u.mode?"template-library__button--selected":""),E,rm("editors_choice","modal"),"button button--list button--all-caps template-library__button ".concat("ALL_TEMPLATES"===u.mode?"template-library__button--selected":""),N,rm("browse_all_templates","modal"),S,(e=u.currentWidth-288-48,em(jd(),function(){if("NO_RESULTS"!==u.mode){var e={EDITORS_CHOICE:"editors_choice",SEARCH:["search_results_for",{query:"<strong>".concat(BeFunky.escapeHTML(u.tagName),"</strong>")}],ALL_TEMPLATES:"all_templates",TAG:BeFunky.escapeHTML(u.tagName)},t="SEARCH"===u.mode;return e[u.mode]||BeFunky.throwError("Mode not handled!!!",u.mode),em(Yd(),rm(e[u.mode],"modal"),t?em(Wd(),E,nm("global-cancel-icon","icon icon-size-tiny")):"")}}(),"EDITORS_CHOICE"===u.mode?Bd(u.editorsChoiceTemplates,F,0,u.targetAspectRatio,e):function(e){return em(Xd(),u.images,u.message,u.emptyState,u.isLoading,D,215,e,u.viewport,!1,B)}(e)))));var e}(),i),function(e){e&&(requestAnimationFrame(()=>{BeFunky.isAndroid||u.viewBlankCanvas||"EDITORS_CHOICE"!==u.mode||(I.focus(),T.hide())}),BFN.HelpClueManager.show("template_library",{renderOptions:{positionFactor:.155,side:"top",zIndex:"1",container:()=>document.querySelector(".template-library__popover-placeholder")}}));C||u.viewBlankCanvas||(C=BeFunky.listenForScroll(i.querySelector(".modal__right-panel-scroller"),w).recalculateScrollPosition)}(s),s=!1},"raf"),h=tm(o,e=>{e.tagID&&r.forEach(e=>{var i=t(e,3),r=i[0],a=i[1],n=i[2],o=r===u.tagID;n.toggleClass("template-library__tag--selected",o),o&&!S.activeSections.includes(a)&&(S.activeSections=[...S.activeSections,a])}),l()}),c=t(h,2),u=c[0],d=c[1];BeFunky.LanguageManager.addLanguageUpdateListener(l),P();var m,p,g,f,v,y,x=function(){var i=e.map(e=>({id:e,label:k(e)})),r=/(^holiday|holiday$|cards?$)/;[].concat(...e.map(e=>{if(e.includes("_and_"))return!1;var t=e.match(r);return!!t&&[e,t[0]]}).filter(Boolean).map(e=>{var i=t(e,2),r=i[0],a=i[1];return[a,r.replace(a,"").replace(/(^_|_$)/g,"")]})).unique().filter(t=>!e.includes(t)).forEach(e=>{i.push({id:e,label:k(e)})}),i.sort((e,t)=>{var i=e.id.length-t.id.length;return i>0?1:i<0?-1:e.id.charAt(0)<t.id.charAt(0)?-1:1});var a=/^id=([a-z0-9_.]+)$/,n=am(Hd());n.setLang("search_templates","modal");var o=am(Gd());return BFN.UI.autocomplete(o,{inputElement:n,minValueLength:3,options:i,generateItem:e=>{var t=e.trim().match(a);return t?{html:"Template ID = ".concat(t[1]),index:0}:{html:BeFunky.LanguageManager.getStringReplacements("search_for",{query:BeFunky.escapeHTML(e)},"modal"),index:0}},onSelect:e=>{F({tagID:e.id,tagName:e.label})}}),[n,o]}(),_=t(x,2),I=_[0],T=_[1],b=(m=am(Qd()),BeFunky.panelHeader(m,{name:"start_a_design",closeEnabled:!0,modifier:"modal"}),m),S=(p=am(Ud()),g=((e,t,i)=>'<button class="button button--list template-library__tag" data-tag="'.concat(e,'" data-section="').concat(i,'">\n            ').concat(k(t),"\n        </button>")),f=((e,t)=>t.map(t=>Array.isArray(t)?g(...t,e):g(t,t,e)).join("")),BFN.UI.accordionLayout(p,{sections:{social_media:{isOpen:!1,content:f("social_media",[["social_media","all_social_media"],"instagram_posts","instagram_stories","facebook_covers","facebook_page_covers","facebook_event_covers","facebook_stories","facebook_posts","twitter_headers","twitter_posts","youtube_thumbnails","youtube_channel_art","pinterest_graphics","etsy_big_banners","etsy_mini_banners","etsy_order_receipt_banners","blog_images"])},business_marketing:{isOpen:!1,content:f("business_marketing",[["business_marketing","all_business_marketing"],"business_cards","posters","flyers","brochures","postcards","letterhead","menus"])},online_advertising:{isOpen:!1,content:f("online_advertising",[["online_advertising","all_online_advertising"],"facebook_ads","skyscrapers","leaderboards","medium_rectangles","large_rectangles","half_pages","large_mobile"])},events_and_cards:{isOpen:!1,content:f("events_and_cards",[["events_and_cards","all_events_and_cards"],["invitations","all_invitations"],["greeting_cards","all_cards"],"birthdays","wedding_sets","valentines_day","mothers_day","winter_holiday"])}}}),(r=[...p.querySelectorAll(".template-library__tag")].map(e=>[e.getAttribute("data-tag"),e.getAttribute("data-section"),e])).forEach(e=>{var i=t(e,3),r=i[0];i[1],i[2].addEventListener("click",()=>{F({tagID:r})})}),p),C=!1;return Object.assign(i,{open:function(e){if(!window.isFlashOpenned)return void BeFunky.logError("Not opening template library on site");BeFunky.openModal(i,{onOpen:()=>{e||s&&(e="editors_choice");var t="blank_canvas"===e;d({viewBlankCanvas:t}),e&&!t&&F({tagID:e})},onWindowResize:e=>{var t=e.availableWidth,i=n+(t-a),r=6*i/n;d({currentWidth:t,targetAspectRatio:r}),"function"==typeof C&&C()},size:"xxl",closeOnEscape:()=>{var e=document.activeElement;return"template_library_search"===e.id?(e.value?e.value="":e.blur(),!1):!I.contains(e)||(e.value="",e.focus(),!1)}})}}),i;function B(e){return!e.isPlus||BeFunky.isPlus()?"":em(zd(),nm("upgrade-star","icon icon-size-regular"))}function F(t){var i=t.tagID,r=void 0===i?"":i,a=t.tagName,n=void 0===a?"":a,o=t.page,s=void 0===o?1:o,l=t.fetchAllTags,h=void 0!==l&&l;if(r||(r=function(e){return e.trim().replace(/[^a-z0-9\s]/gi,"").split(/\s+/).map(e=>e.toLowerCase()).join("_").replace(/_+/g,"_")}(n)),r=e.includes(r)?r:"",n=k(r)||n,!r&&!n)throw new Error("Invalid tag name or ID");if("editors_choice"===r)return E();var c=r||n;if(!(c===u.lastSearchTerm&&s===u.lastSearchPage||c.length<=2)){y=void 0;var m=c.match(/^id=([a-z0-9_.]+)$/),p=m?m[1]:void 0,g="SEARCH";r&&(g="TAG"),h&&(g="ALL_TEMPLATES"),d({mode:g,tagName:n,tagID:r,searchTerm:c,lastSearchTerm:c,lastSearchPage:s,images:1===s?[]:u.images,message:null,isLoading:!0}),I.value=h?"":n;var f=1===s&&!p,v=()=>c!==u.lastSearchTerm||s!==u.lastSearchPage;(p?BFN.DesignerTemplateService.getTemplate(p).then(e=>[e]):BFN.DesignerTemplateService.getTemplates(c,s,100,h)).then(e=>{if(!v()){var t=BFN.DesignerTemplateService.templateObjectsToMenuImageVOs(e),i=s;d({isLoading:!1,images:[...u.images,...t]}),"function"==typeof C&&C(),f&&BFN.BfnService.track("TEMPLATES","SEARCH",c);t.length>=100&&(y=(()=>{console.log("Load next page of results",r,i+1),F({tagID:r,tagName:n,page:++i,fetchAllTags:h})}))}},e=>{v()||(BeFunky.logError("Unable to fetch templates",e),"no_results"===e?(d({isLoading:!1,mode:"NO_RESULTS",emptyState:{icon:"no-results-icon",text:["no_results_for",{query:'"<strong>'.concat(BeFunky.escapeHTML(u.searchTerm),'</strong>"')}]}}),f&&BFN.BfnService.track("TEMPLATES","EMPTY_SEARCH",c)):d({isLoading:!1,message:{isError:!0,text:BeFunky.failureReason(e),buttonText:"try_again",buttonAction:()=>F({tagID:r,tagName:n,fetchAllTags:h})},lastSearchTerm:""}))})}}function E(){d({mode:"EDITORS_CHOICE",tagID:"editors_choice",lastSearchTerm:""}),I.value="",u.editorsChoiceTemplates.length||P()}function P(){BFN.DesignerTemplateService.getEditorsChoiceTemplates().then(e=>{var t=e.map(e=>{var t=e.tag,i=e.items;return{tagID:t,title:e.title,templateData:BFN.DesignerTemplateService.templateObjectsToMenuImageVOs(i)}});d({editorsChoiceTemplates:t})})}function N(){F({tagID:"",tagName:BeFunky.LanguageManager.getString("all_templates","modal"),fetchAllTags:!0})}function M(e){e&&e.preventDefault();var t=I.value.replace(/[`~!@#$%^&*()_|+=?;:'",.<>{}[\]\\\/]/gi," ").replace(/ {2,}/g," ").trim();t.length<3||F({tagName:t})}function D(e,t,i){var r,a,n,o=e.id.replace("designer_template_",""),s=e.version,l=e.dimensions,h=e.displayName,c=e.imageURL,d=e.imageWidth,m=e.imageHeight,p=e.isPlus,g=e.lastRenderedThumb,f=u.images.findIndex(t=>{return t.id===e.id}),v=x(u.images,f,-1),y=x(u.images,f,1);return BFN.DesignerTemplateManager.openPreviewModal({templateID:o,thumbURL:i||g.url,imageURL:c,imageWidth:d,imageHeight:m,isTemplatePlus:p,name:h,dimensions:l,version:s,trackSearchTerm:(r=BFN.DeepLinkManager.getDesignerDeepLinkData(),a=r.deepLinkTagID,n=r.deepLinkTemplateRoute,"TAG"===u.mode&&u.tagID===a&&n?n:u.lastSearchTerm),prevImageURL:v&&v.imageURL,nextImageURL:y&&y.imageURL,onPrev:v?()=>{D(v)}:void 0,onNext:y?()=>{D(y)}:void 0}),!1;function x(e,t,i){for(;e[t+i];){var r=e[t+i];if(!r.isBlank)return r;t+=i}}}function w(e){var t=e.scrollHeight,i=e.offsetHeight,r=e.scrollTop;if(u.images.length&&(d({viewport:[r,r+i]}),y)){t-i-r<=800&&y()}}function k(e){return e.split("_").map(function(e,t){if(0===t||e.length>2&&"the"!==e||"my"===e)return e.charAt(0).toUpperCase()+e.slice(1);return e}).join(" ").replace("s Day","'s Day").replace("St ","St. ").replace("Youtube","YouTube")}}class sm{constructor(){this.init()}init(){this.initDefaultValues(),this.initCustomTemplate()}initDefaultValues(){this.isDataLoaded=!1,this.loadedTemplateCategories=[],this.selectedTemplateButton=null,document.addEventListener("keyup",this.handleKeyUp),document.getElementById("designer_search_templates").addEventListener("click",()=>this.openModal())}initCustomTemplate(){var e=document.getElementById("resize_template_modal");document.getElementById("designer_create_custom_template").addEventListener("click",()=>{this.openModal("blank_canvas")}),document.getElementById("designer_resize_template").addEventListener("click",()=>{e.open||BFN.UI.resizeTemplateModal(e),e.open()})}preloadTags(){var e=BFN.DesignerTemplateService.tags;Array.isArray(e)&&e.length||BFN.DesignerTemplateService.getTags().catch(e=>{"request_failed"!==e&&BeFunky.throwError("Unable to preload tags")})}setupRecentProjects(){this.recentProjectsComponent||(this.recentProjectsComponent=rd(),document.getElementById("designer_templates_menu").appendChild(this.recentProjectsComponent))}openPreviewModal(e){this.previewModalComponent||(this.previewModalComponent=gd()),this.previewModalComponent.setState(e),this.previewModalComponent.open()}getTemplateImages(e){var i=e.id,r=e.isBlank,a=e.dimensions,n=e.version,o=e.isRetina,s=this.parseDimensions(a);if(!s)return BeFunky.throwError("Template ".concat(i," has invalid dimensions string")),{};var l,h,c,u,d,m,p=s.width,g=s.height;if(r){h=300,l=Math.round(p*h/g);var f='<svg style="background: '.concat("#3f414c",'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ').concat(l," ").concat(h,'"></svg>');return{thumbHeight:h,thumbWidth:l,thumbURL:c="data:image/svg+xml;utf8,".concat((e=>e.replace(/#/g,"%23").replace(/>\s+</g,"><"))(f))}}var v=o?1.75:1,y=300*v;l=p*((h=Math.max(200,Math.min(y,g)))/g),c=b(i,{h:h,version:n});var x=Math.round(500*v),_=Math.round(600*v),I=p/x,T=g/_;if(I<=1&&T<=1){p<480&&g<480?p>g?(u=480,d=Math.floor(g*(480/p))):(u=Math.floor(480*p/g),d=480):(u=p,d=g),m=b(i,{w:u,version:n})}else I>T?(u=x,d=Math.floor(g/I),m=b(i,{w:x,version:n})):(u=Math.floor(p/T),d=_,m=b(i,{h:_,version:n}));return{thumbWidth:l,thumbHeight:h,thumbURL:c,imageWidth:u,imageHeight:d,imageURL:m,getImageURL:e=>(function(e,t){var i="".concat(BFN.designerTemplatePreviewsUrl).concat(e,"_preview.jpg"),r={auto:"webp",width:(a=t,20*Math.ceil(a/20))};var a;"number"==typeof n&&(r.nocache=n);return BeFunky.addParamsToURL(i,r)})(i,e*(BeFunky.isRetina()?1.75:1))};function b(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(BFN.designerTemplatePreviewsUrl).concat(e,"_preview.jpg");i.auto="format","number"==typeof i.version&&(i.nocache=i.version,delete i.version);var a=Object.entries(i).map(e=>{var i=t(e,2),r=i[0],a=i[1];return"".concat(r,"=").concat(encodeURIComponent(a))}).join("&");return"".concat(r,"?").concat(a)}}openModal(e){if(this.modal)return this.modal.open(e);BFN.DesignerTemplateService.getTags().then(t=>{this.modal||(this.modal=om(t)),this.modal.open(e)},e=>BeFunky.logError("Unable to fetch tags before opening Designer Template Search modal",e))}applyTemplate(e){var t=e.id,i=e.version,r=e.name,a=void 0===r?"BeFunky-project":r,n=e.trackingData,o=void 0===n?null:n,s="".concat(BFN.designerSourceTemplateURL).concat(t,".bfd");"number"==typeof i&&(s+="?nocache=".concat(i)),BFN.SavedProjectService.fetchBFD(s).then(e=>BFN.ParseBFD.objectToProjectVO(e).then(e=>{if(e.sourceTemplateID=t,e.filename=a,!e.printDPI){var i=this.parseDimensions([e.projectWidth,e.projectHeight]);e.printDPI=i?i.dpi:300}BFN.ProjectManager.loadProject(e,!0,o)})).catch(e=>{BeFunky.logError(e),BeFunky.hideLoadScreen()})}loadTemplateForTesting(e){console.log("Testing > Designer template:",e),BFN.DesignerTemplateService.getTemplate(e).then(t=>{var i=t.version;this.applyTemplate({id:e,version:i})})}openDeepLinkTemplatePreview(e,t){BFN.AppModel.viewingDesigner||BeFunky.throwError("Template preview requested while not in Designer"),BFN.DesignerTemplateService.getTemplate(e).then(i=>{var r=BFN.DesignerTemplateService.templateObjectsToMenuImageVOs([i])[0],a=r.displayName,n=r.dimensions,o=r.isPlus,s=r.version,l=r.imageURL,h=r.imageWidth,c=r.imageHeight;this.openPreviewModal({templateID:e,imageURL:l,imageWidth:h,imageHeight:c,isTemplatePlus:o,name:a,dimensions:n,version:s,trackSearchTerm:"Deep Link: ".concat(t)})},t=>BeFunky.throwError("Unable to get template ".concat(e," by ID"),t))}parseDimensions(e){var i,r;if("string"==typeof e){var a=e.match(/(\d+)px x (\d+)px/);if(!a)return!1;var n=t(a.map(e=>parseInt(e)),3);i=n[1],r=n[2]}else if(Array.isArray(e)){var o=t(e,2);i=o[0],r=o[1]}if(![i,r].every(e=>e&&"number"==typeof e))return!1;var s={"3300,3300":{size:'11 × 11"',name:"Square"},"1050,600":{size:'3.5 × 2"',name:"Business Card"},"1500,900":{size:'5 × 3"',name:"Thank You Card"},"1800,1200":{size:'6 × 4"',name:"Postcard"},"1500,2100":{size:'5 × 7"',name:"Greeting Card"},"2100,1500":{size:'7 × 5"',name:"Greeting Card"},"1650,1260":{size:'5.5 × 4.2"',name:"Postcard"},"1650,2550":{size:'5.5 × 8.5"',name:"Half Letter"},"1200,2700":{size:'4 × 9"',name:"Rack Card"},"2550,3300":{size:'8.5 × 11"',name:"Letter"},"3300,2550":{size:'11 × 8.5"',name:"Letter"},"2481,3507":{size:"21 × 29.7cm",name:"A4"},"2640,4080":{size:'11 × 17"',name:"Poster",dpi:240}}["".concat(i,",").concat(r)]||{};return{width:i,height:r,pixelSize:"".concat(i," × ").concat(r,"px"),printSize:s.size,printName:s.name,storedSize:"".concat(i,"px x ").concat(r,"px"),dpi:s.dpi||300}}handleKeyUp(e){function t(e){e&&BeFunky.logError(e)}BFN.AppModel.viewingDesigner&&69===e.which&&e.ctrlKey&&e.shiftKey&&BFN.ProjectManager.requestLocalSave({isLazy:!1}).then(()=>BFN.ProjectService.getLocalProject("designer")).then(e=>{e.filename=e.sourceTemplateID||"unknown_template",BFN.UploadSaveShareManager.saveProjectToComputer(e,t)}).catch(t)}}BFN.SingletonQueue.add(()=>{BFN.DesignerTemplateManager=new sm});class lm{constructor(){this.init()}init(){var e;this.initDefaultValues(),("draggable"in(e=document.createElement("div"))||"ondragstart"in e&&"ondrop"in e)&&window.addEventListener("INIT_COMPLETE",this.initDragDropAreas.bind(this))}initDefaultValues(){this.fontExtensions=["dfont","eot","otc","otf","svg","ttc","ttf","woff","woff2"]}initDragDropAreas(){["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(e=>BFN.appContainer.addEventListener(e,e=>{e.target.draggable||(e.preventDefault(),e.stopPropagation())})),this.dragDropAreas=[{visibleElem:document.getElementById("canvas_drag_drop_area"),listeningElem:BFN.Stage.view,isActive:!1,handler:this.handleCanvasDrop.bind(this)},{visibleElem:document.getElementById("image_manager_drag_drop_area"),listeningElem:document.getElementById("editor_image_manager_menu"),isActive:!1,handler:this.handleImageManagerDrop.bind(this)},{visibleElem:document.getElementById("batch_processing_drag_drop_area"),listeningElem:document.querySelector(".batch-processing__images-container"),isActive:!1,handler:this.handleBatchProcessingDrop.bind(this)},{visibleElem:document.getElementById("watermark_upload_drop_area"),listeningElem:document.getElementById("watermark_upload"),isActive:!1,handler:this.handleWatermarkUploadDrop.bind(this)}];var e=e=>{if(!BFN.isSortableListDragActive){var t=this.dragDropAreas.find(t=>!t.isActive&&t.listeningElem.contains(e.target));t&&(t.isActive=!0,t.visibleElem.addClass("drag-drop-area--active"),t.listeningElem.addClass("drag-drop-listener"))}},t=e=>{if(!BFN.isSortableListDragActive){var t=this.dragDropAreas.find(t=>t.isActive&&e.target===t.listeningElem);t&&(t.isActive=!1,t.visibleElem.removeClass("drag-drop-area--active"),t.listeningElem.removeClass("drag-drop-listener"))}};BFN.appContainer.addEventListener("dragenter",e),BFN.appContainer.addEventListener("dragover",e),BFN.appContainer.addEventListener("dragleave",t),BFN.appContainer.addEventListener("dragend",t),BFN.appContainer.addEventListener("drop",t),BFN.appContainer.addEventListener("drop",e=>{var t;try{t=[...e.dataTransfer.files]}catch(t){BeFunky.throwError(t,{event:e})}if(t&&t.length){t.forEach(e=>{e.extension=BFN.getExtension(e.name)});var i=this.dragDropAreas.find(t=>t.listeningElem===e.target);i&&i.handler(t,e)}})}handleCanvasDrop(e,t){if(BFN.TransformModel.selectedTransformItem){var i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);i&&i.transformLayer&&i.transformLayer.deselectItem()}var r=e[0];return"bfd"===r.extension?this.handleBFD(r):BFN.MultipleFileUploader.supportedImages.includes(r.extension)?void(BFN.AppModel.viewingEditor?this.handleEditorImage(r):BFN.AppModel.viewingCollage?this.handleCollageImage(r,t):this.handleDesignerImage(r,t)):e.some(e=>this.fontExtensions.includes(e.extension))?BFN.FontManager.handleUserFontFiles(e):BeFunky.logError("Unsupported file type:",r.name)}handleImageManagerDrop(e,t){var i=e.filter(e=>/^image\/+/.test(e.type));i.length&&this.handleImageManagerImages(i)}handleFontListDrop(e,t){var i=e.filter(e=>this.fontExtensions.includes(e.extension));i.length&&this.handleFonts(i)}handleBatchProcessingDrop(e,t){var i=e.filter(e=>/^image\/+/.test(e.type)&&!e.type.includes("svg"));i.length&&this.handleBatchProcessingImages(i)}handleWatermarkUploadDrop(e,t){if(e.filter(e=>/^image\/+/.test(e.type)&&!e.type.includes("svg")).length){var i=e[0];this.handleWatermarkImage(i)}}handleBFD(e){var t={files:[e],createMenuImageVO:!1};BFN.MultipleFileUploader.upload(e=>{var t=e.file;t&&BFN.ProjectManager.loadFile(t)},t)}handleImageManagerImages(e){BFN.ImageLibraryManager.uploadImages(()=>{},{files:e})}handleBatchProcessingImages(e){BFN.BatchProcessingManager.loadImages(e)}handleWatermarkImage(e){BFN.WatermarkManager.uploadWatermark(e)}handleEditorImage(e){var t=BFN.PhotoEditorModel.onEditorImageUpload.bind(BFN.PhotoEditorModel),i={files:[e],createMenuImageVO:!1};BFN.PhotoEditorModel.confirmEditorLoadImage(()=>BFN.MultipleFileUploader.upload(t,i))}handleCollageImage(e,t){var i={files:[e]},r={initialCenterPosition:BFN.getCanvasCoordinates(t.pageX,t.pageY,BFN.CollageMakerCanvas)};BFN.ImageLibraryManager.uploadImages(e=>{var t=e.menuImageVO;t&&(BFN.AppModel.viewingCollage&&!BFN.CollageMakerCanvasPhotoGridModel.freeform&&(BFN.PhotoGrid.awaitingDrop=!0),BFN.ImageLibraryManager.addImageToCanvas(t,r))},i)}handleDesignerImage(e,t){var i={files:[e],keepImageTexture:!0},r={initialCenterPosition:BFN.getCanvasCoordinates(t.pageX,t.pageY,BFN.DesignerCanvas),generateTexture:!1};BFN.ImageLibraryManager.uploadImages(e=>{var t=e.menuImageVO;t&&BFN.ImageLibraryManager.addImageToCanvas(t,r)},i)}}BFN.SingletonQueue.add(()=>{BFN.DragAndDropManager=new lm});class hm{constructor(){this.init()}init(){BeFunky.log("SVGManager Init"),this.initDefaultValues(),this.initFabricStaticCanvas()}initDefaultValues(){this.processing=!1,this.shapeObjects=null,this.svgData=null,this.callback=null,this.queuedShapeObjects=null,this.combinedSVGKey=null,this.cachedCombinedSVGs={},this.cachedCombinedShapes={},this.updatingTexture=null,this.updatingShape=null,this.idleCanvasSize=16,this.svgContainer=document.createElement("div"),this.svgContainer.id="svg_measurement",BFN.appContainer.appendChild(this.svgContainer)}initFabricStaticCanvas(){setTimeout(()=>{this.fabricStaticCanvasElement=document.createElement("canvas"),this.fabricStaticCanvasElement.width=this.idleCanvasSize,this.fabricStaticCanvasElement.height=this.idleCanvasSize,this.debugFabricCanvas=!1,this.debugFabricCanvas&&(this.fabricStaticCanvasElement.setStyles({zIndex:1e11,pointerEvents:"none",background:"rgba(175,175,255,.4)",position:"absolute",left:"320px",top:"55px",display:"block"}),BFN.appContainer.appendChild(this.fabricStaticCanvasElement)),fabric.Object.NUM_FRACTION_DIGITS=10,this.fabricStaticCanvas=new fabric.StaticCanvas(this.fabricStaticCanvasElement,{enableRetinaScaling:!1}),this.fabricStaticCanvas.renderOnAddRemove=!1,this.fabricStaticCanvas.renderAll()},0)}sanitizeSVG(e){if("string"!=typeof e)return"";this.svgContainer.innerHTML=e;var t=this.svgContainer.firstElementChild;if("function"!=typeof t.getBBox)return"";var i=["x","y","width","height","viewBox"].reduce((e,i)=>(e[i]=t.getAttribute(i),e),{});t.removeAttribute("x"),t.removeAttribute("y"),t.removeAttribute("viewBox"),[...t.querySelectorAll("image")].forEach(e=>{e.hasAttribute("xlink:href")&&!e.getAttribute("xlink:href").startsWith("data:")&&(BeFunky.logError("Removed externally-linked image tag in SVG"),e.parentElement.removeChild(e))});var r=0;[...t.querySelectorAll(["altGlyph","circle","ellipse","path","polygon","polyline","rect","text","textPath","tref","tspan"].join(","))].forEach(e=>{if(e.hasAttribute("stroke-width"))r=Math.max(r,parseInt(e.getAttribute("stroke-width"))||0);else{var t=parseInt(getComputedStyle(e).strokeWidth)||0;if(t){r=Math.max(r,t);var i=e.getAttribute("style");i&&i.includes("stroke-width")||e.setAttribute("stroke-width",t)}}});var a=e=>Math.round(100*e)/100,n=t.getBBox(),o=n.x,s=n.y,l=n.width,h=n.height;return BeFunky.isFirefox&&o<-1e4&&(BeFunky.logError("Not trusting Firefox getBBox for SVG",{x:o,y:s,width:l,height:h}),o=parseFloat(i.x)||0,s=parseFloat(i.y)||0,l=parseFloat(i.width)||parseFloat(i.viewBox.split(" ")[2]),h=parseFloat(i.height)||parseFloat(i.viewBox.split(" ")[3]),console.log("Using these values instead:",{x:o,y:s,width:l,height:h})),t.setAttribute("viewBox","".concat(a(o-r/2)," ").concat(a(s-r/2)," ").concat(a(l+r)," ").concat(a(h+r))),BeFunky.isFirefox&&(t.setAttribute("width",l),t.setAttribute("height",h)),[...t.querySelectorAll("style")].forEach(e=>{e.textContent||(BeFunky.logError("Removing empty style tag from SVG"),e.parentElement.removeChild(e))}),e=(new XMLSerializer).serializeToString(t),this.svgContainer.innerHTML="",e=e.replace(/>\s+</g,"><")}createDataURI(e){if("string"!=typeof e)return"";var t={whitespace:/\s+/g,urlHexPairs:/%[\dA-F]{2}/g};function i(e){switch(e){case"%20":return" ";case"%3D":return"=";case"%3A":return":";case"%2F":return"/";default:return e.toLowerCase()}}65279===e.charCodeAt(0)&&(e=e.slice(1));var r=e.trim().replace(t.whitespace," ");return"data:image/svg+xml,".concat(encodeURIComponent(r).replace(t.urlHexPairs,i))}clearCache(){for(var e in this.cachedCombinedSVGs)this.cachedCombinedSVGs[e]=null,delete this.cachedCombinedSVGs[e];for(var t in this.cachedCombinedShapes)this.cachedCombinedShapes[t]=null,delete this.cachedCombinedShapes[t]}combineSVGs(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.processing)BeFunky.logError("Already Processing - BFN.SVGManager.combineSVGs()");else{if(this.combinedSVGKey=null,e.length){this.combinedSVGKey="";for(var n=0;n<e.length;n++){var o=e[n];this.combinedSVGKey+="".concat(n?"_":"").concat(o.svgID,"_").concat(o.scaleX.toString()).concat(o.scaleY.toString()).concat(o.x.toString()).concat(o.y.toString()).concat(o.rotation.toString()).concat(o.alpha.toString())}}if(this.combinedSVGKey=this.combinedSVGKey?"template_svg_".concat(BeFunky.hash(this.combinedSVGKey).toString(36)):null,this.combinedSVGKey&&this.cachedCombinedSVGs.hasOwnProperty(this.combinedSVGKey))i(this.combinedSVGKey,this.cachedCombinedSVGs[this.combinedSVGKey]);else{this.processing=!0,this.shapeObjects=e,this.svgData=t,this.callback=i,this.makeWhite=r,this.resetCoords=a,this.queuedShapeObjects=[];for(var s=0;s<this.shapeObjects.length;s++)this.queuedShapeObjects.push(this.shapeObjects[s]);this.processShapeObjectQueue()}}}processShapeObjectQueue(){if(this.queuedShapeObjects&&this.queuedShapeObjects.length){var e=this.queuedShapeObjects.shift();this.svgData.hasOwnProperty(e.svgID)?(e.svgData=this.svgData[e.svgID],this.getSVGShape(e.svgData,t=>{e.svgShape=t,this.processShapeObjectQueue()})):this.processShapeObjectQueue()}else this.createCombinedSVG()}createCombinedSVG(){for(var e=[],t={},i=0;i<this.shapeObjects.length;i++){var r=this.shapeObjects[i];if(r.svgID&&r.svgShape){var a=r.svgShape,n="shape_".concat(i+1);a.id=n,a.scaleX=r.scaleX,a.scaleY=r.scaleY,a.left=r.x,a.top=r.y,a.angle=r.rotation*(180/Math.PI),a.opacity=r.alpha,e.push(a),t[n]=a}}this.clearCanvas();var o=null;if(e.length){var s=new fabric.Group(e);this.resetCoords&&(s.left=0,s.top=0);var l=s.left,h=s.width,c=s.top,u=s.height;this.fabricStaticCanvasElement.width=Math.round(l+h),this.fabricStaticCanvasElement.height=Math.round(c+u),this.fabricStaticCanvasElement.setStyles({width:"".concat(this.fabricStaticCanvasElement.width,"px"),height:"".concat(this.fabricStaticCanvasElement.height,"px")}),this.fabricStaticCanvas.width=this.fabricStaticCanvasElement.width,this.fabricStaticCanvas.height=this.fabricStaticCanvasElement.height,this.fabricStaticCanvas.add(s),this.fabricStaticCanvas.renderAll();var d=new DOMParser,m=new XMLSerializer;o=(o=this.fabricStaticCanvas.toSVG({suppressPreamble:!0,width:h,height:u,viewBox:{x:0,y:0,width:h,height:u}},e=>{var i=d.parseFromString('<svg xmlns="http://www.w3.org/2000/svg">'.concat(e,"</svg>"),"image/svg+xml").documentElement.firstElementChild,r=i.getAttribute("id");if(r&&r in t){var a=t[r];if(i.style.opacity=a.opacity,this.makeWhite){i.style.fill="rgb(255,255,255)";for(var n=i.getElementsByTagName("*"),o=0;o<n.length;o++)n[o].style.fill="rgb(255,255,255)"}return m.serializeToString(i).replace('xmlns="http://www.w3.org/2000/svg"',"")}return e})).replace(/\n?<desc>[^>]+>/,"").replace(/\n?<defs>[^>]+>/,""),this.resetCanvas(),e.splice(0),e=null}else this.combinedSVGKey=null;var p=this.callback;this.processing=!1,this.shapeObjects=null,this.svgData=null,this.callback=null,this.queuedShapeObjects=null,this.combinedSVGKey&&!this.cachedCombinedSVGs.hasOwnProperty(this.combinedSVGKey)&&(this.cachedCombinedSVGs[this.combinedSVGKey]=o),p(this.combinedSVGKey)}getSVGShape(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i&&this.cachedCombinedShapes.hasOwnProperty(i)?t(this.cachedCombinedShapes[i]):fabric.loadSVGFromString(e,(e,a)=>{var n=fabric.util.groupSVGElements(e,a);n.objectCaching=!0,r?n.set({left:0,top:0}).setCoords():n.set({left:Math.max(0,n.left),top:Math.max(0,n.top)}).setCoords(),n.baseScaleX=n.scaleX,n.baseScaleY=n.scaleY,i&&!this.cachedCombinedShapes.hasOwnProperty(i)&&(this.cachedCombinedShapes[i]=n),n.baseBoundingRect=n.getBoundingRect(),n.containsObjectFills=!1;for(var o=[],s=[],l={},h=0;h<e.length;h++){var c=e[h];if(c.fill)if("string"==typeof c.fill&&c.fill.length){var u=new fabric.Color(c.fill).toHex();c.fill="#"+u,o.includes(u)||(o.push(u),s.push(h));var d=s[o.indexOf(u)];l.hasOwnProperty(d)||(l[d]={colorHash:u,colorOpacity:0,objects:[],fillObject:null}),l[d].colorOpacity=Math.max(l[d].colorOpacity,c.opacity),l[d].objects.push(c),c.opacityOriginal=c.opacity}else if("object"==typeof c.fill){n.containsObjectFills=!0;var m=c.fill;o.includes(m)||(o.push(m),s.push(h));var p=s[o.indexOf(m)];l.hasOwnProperty(p)||(l[p]={colorHash:-1,colorOpacity:0,objects:[],fillObject:m}),l[p].colorOpacity=Math.max(l[p].colorOpacity,c.opacity),l[p].objects.push(c),c.opacityOriginal=c.opacity}}n.colorMap=l,t(n)})}getTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.scaleX=e.baseScaleX?e.baseScaleX:1,e.scaleY=e.baseScaleY?e.baseScaleY:1,e.left=e.baseBoundingRect?e.baseBoundingRect.left:0,e.top=e.baseBoundingRect?e.baseBoundingRect.top:0,this.fabricStaticCanvas.add(e),this.fabricStaticCanvas.renderAll(),this.clearCanvas();var i=e.getBoundingRect();this.fabricStaticCanvasElement.width=Math.round(i.left+i.width),this.fabricStaticCanvasElement.height=Math.round(i.top+i.height),this.fabricStaticCanvasElement.setStyles({width:"".concat(this.fabricStaticCanvasElement.width,"px"),height:"".concat(this.fabricStaticCanvasElement.height,"px")}),this.fabricStaticCanvas.width=this.fabricStaticCanvasElement.width,this.fabricStaticCanvas.height=this.fabricStaticCanvasElement.height,this.fabricStaticCanvas.add(e),this.fabricStaticCanvas.renderAll();var r=new PIXI.Texture(new PIXI.BaseTexture(this.fabricStaticCanvasElement));r.baseTexture.mipmap=!1,r.baseTexture.fabricShape=e;var a=r.baseTexture.fabricShape.colorMap;if(a)for(var n in r.baseTexture.fabricShapeColorMap={},a){var o=a[n];r.baseTexture.fabricShapeColorMap[n]={colorHash:o.fillObject?-1:o.colorHash,colorHashOriginal:o.fillObject?-1:o.colorHash,colorOpacity:o.colorOpacity,colorOpacityOriginal:o.colorOpacity,objects:o.objects,fillObject:o.fillObject}}return r.baseTexture.drawPeriod=0,BFN.Stage.uploadTextureData(r.baseTexture,()=>{this.resetCanvas(),t&&t()}),r}textureHasModifiedShapeColors(e){var t=!1;if(e&&e.baseTexture&&e.baseTexture.fabricShapeColorMap){var i=e.baseTexture.fabricShapeColorMap;if(i)for(var r in i)if(!t){var a=i[r];t=a.colorHash!==a.colorHashOriginal||a.colorOpacity!==a.colorOpacityOriginal}}return t}updateTexture(e,t,i){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(this.updatingTexture&&this.updatingTexture==e||(this.clearCanvas(),e.baseTexture.hasOwnProperty("fabricShape")&&(this.updatingTexture=e,this.updatingShape=e.baseTexture.fabricShape,this.fabricStaticCanvas.add(this.updatingShape))),this.updatingTexture&&this.updatingShape){var l=this.updatingTexture.baseTexture.fabricShapeColorMap;if(l){var h=function(e){var t=l[e];t.objects&&t.objects.forEach(e=>{var i;if(i=t.fillObject&&-1===t.colorHashOriginal&&(-1===t.colorHash||s)?t.fillObject:"#"+(s?t.colorHashOriginal:t.colorHash),e.fill!==i&&(e.fill=i,r.updatingShape.dirty=!0),t.colorOpacityOriginal>0){var a=s?e.opacityOriginal:e.opacityOriginal*(t.colorOpacity/t.colorOpacityOriginal);e.opacity!==a&&(e.opacity=a,r.updatingShape.dirty=!0)}})};for(var c in l)h(c)}var u=this.updatingShape.baseBoundingRect.left+this.updatingShape.baseBoundingRect.width,d=this.updatingShape.baseBoundingRect.top+this.updatingShape.baseBoundingRect.height;t=null!=a?a/u:t,i=null!=n?n/d:i;var m=null!=a?a:u*t,p=null!=n?n:d*i,g=Math.min(1,BFN.maxImageSize/m,BFN.maxImageSize/p);i*=g;var f=(t*=g)*this.updatingShape.baseScaleX,v=i*this.updatingShape.baseScaleY,y=this.updatingShape.baseBoundingRect.left*t,x=this.updatingShape.baseBoundingRect.top*i,_=this.updatingShape.dirty;if((_=(_=(_=(_=_||this.updatingShape.scaleX!==f)||this.updatingShape.scaleY!==v)||this.updatingShape.left!==y)||this.updatingShape.top!==x)||s){var I=performance.now();this.updatingShape.scaleX=f,this.updatingShape.scaleY=v,this.updatingShape.left=y,this.updatingShape.top=x,this.fabricStaticCanvasElement.width=Math.round(u*t),this.fabricStaticCanvasElement.height=Math.round(d*i),this.fabricStaticCanvasElement.setStyles({width:"".concat(this.fabricStaticCanvasElement.width,"px"),height:"".concat(this.fabricStaticCanvasElement.height,"px")}),this.fabricStaticCanvas.width=this.fabricStaticCanvasElement.width,this.fabricStaticCanvas.height=this.fabricStaticCanvasElement.height,this.fabricStaticCanvas.renderAll(),e.update(),o&&!this.debugFabricCanvas&&this.resetCanvas(),e.baseTexture.drawPeriod=Math.ceil(performance.now()-I)}return{x:t,y:i}}return{x:1,y:1}}clearCanvas(){for(var e=this.fabricStaticCanvas.getObjects(),t=0;t<e.length;t++)this.fabricStaticCanvas.remove(e[t]);this.fabricStaticCanvas.clear(),this.updatingTexture=null,this.updatingShape=null}resetCanvas(){this.clearCanvas(),this.fabricStaticCanvasElement.width=this.idleCanvasSize,this.fabricStaticCanvasElement.height=this.idleCanvasSize,this.fabricStaticCanvasElement.setStyles({width:"".concat(this.idleCanvasSize,"px"),height:"".concat(this.idleCanvasSize,"px")}),this.fabricStaticCanvas.width=this.idleCanvasSize,this.fabricStaticCanvas.height=this.idleCanvasSize}}function cm(){var t=e(["<li>"," → ","</li>"]);return cm=function(){return t},t}function um(){var t=e(["\n                <div>\n                    <p>","</p>\n                    <ul >\n                        ",'\n                    </ul>\n                    <a href="https://support.befunky.com/hc/en-us/articles/360033317211" target="_blank" rel="noopener">',"</a>\n                </div>\n            "]);return um=function(){return t},t}function dm(){var t=e(['<div class="side-by-side__image-box">\n                    ',"\n                    <string>","</string>\n                </div>"]);return dm=function(){return t},t}function mm(){var t=e(['<div class="side-by-side__image-box">\n                    <div style=',">\n                        <div style=","></div>\n                    </div>\n                </div>"]);return mm=function(){return t},t}function pm(){var t=e(['<div class="side-by-side__image-box" style=',"></div>"]);return pm=function(){return t},t}function gm(){var t=e(['\n                <div>\n                    <div class="side-by-side">\n                        <div class="side-by-side__column">\n                            <h3 class="side-by-side__heading">',"</h3>\n                            ","\n                        </div>\n                        ",'\n                        <div class="side-by-side__column">\n                            <h3 class="side-by-side__heading">',"</h3>\n                            ","\n                        </div>\n                    </div>\n                    <p>","</p>\n                </div>"]);return gm=function(){return t},t}function fm(){var t=e(['<div id="project_bounds"></div>']);return fm=function(){return t},t}BFN.SingletonQueue.add(()=>{BFN.SVGManager=new hm});var vm=BeFunky.lit,ym=vm.elem,xm=vm.html,_m=vm.icon,Im=vm.appLang;class Tm{constructor(){this.init()}init(){BeFunky.log("ProjectManager Init"),this.initDefaultValues()}initDefaultValues(){this.projectLoading=!1,this.resolveProjectLoading=(()=>{}),this.rejectProjectLoading=(()=>{}),this.transformItemsPending=!1,this.transformItemsPending=!1,this.queuedProjectVO=null,this.queuedProjectItemVOs=null,this.sourceTemplateLoading=!1,this.trackingData=null,this.savedCanvasThumbs={},this.projectImageBaseTextures={},this.handleEditorImageLoadCompleteBind=this.handleEditorImageLoadComplete.bind(this),this.handleEditorImageLoadErrorBind=this.handleEditorImageLoadError.bind(this),this.autoSave={editor:{lastSaveLocation:"",allowAutoSave:!0,cancelLazySave:()=>{},saveQueue:[]},collage:{lastSaveLocation:"",allowAutoSave:!0,cancelLazySave:()=>{},saveQueue:[]},designer:{lastSaveLocation:"",allowAutoSave:!0,cancelLazySave:()=>{},saveQueue:[]}},this.autoSaveInterval=1e3,window.onbeforeunload=(()=>this.isFullyAutoSaved()?null:"You are about to leave BeFunky. If you do not save your changes, they will be lost.")}loadProject(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((r,a)=>{if(this.projectLoading)throw new Error("Attempting to open new project while an existing project is loading");if(this.projectLoading=!0,this.resolveProjectLoading=r,this.rejectProjectLoading=a,BFN.TransformGuides.setTransformGuideData(),this.queuedProjectVO=e,this.queuedProjectItemVOs=[...e.collageGridChildren,...e.transformGraphics,...e.transformImages,...e.transformMaskImages,...e.transformLabels],this.sourceTemplateLoading=t,this.trackingData=i,this.projectImageBaseTextures={},Object.keys(e.imageData).forEach(e=>{var t;switch(BFN.getImageType(e)){case"graphic":t=BFN.GraphicLibraryManager.getMenuImageVO(e);break;case"patterns":t=BFN.CollageMakerPatternManager.getMenuImageVO(e);break;default:t=BFN.ImageLibraryManager.getMenuImageVO(e)}t&&t.hasUsableTexture()&&!this.projectImageBaseTextures.hasOwnProperty(e)&&(this.projectImageBaseTextures[e]=t.imageTexture.baseTexture)}),"editor"===e.section){BFN.AppModel.viewingEditor||(BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR);var n="string"==typeof e.editorImageBase64&&e.editorImageBase64.startsWith("data:")?BFN.BlobUtils.base64ToBlob(e.editorImageBase64):e.editorImageBase64;if(!(n instanceof Blob))throw this.projectLoading=!1,new Error("Unable to get blob for main Photo Editor image");BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),BFN.ImageEditManager.resetEditor(),UITools.setToolValue("editor_main","edit",!0),UITools.applyTool("editor_main"),UITools.setToolValue("editor_main","edit",!1),BeFunky.showLoadScreen({isCancellable:!1}),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_COMPLETE.type,this.handleEditorImageLoadCompleteBind),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_ERROR.type,this.handleEditorImageLoadErrorBind),BFN.PhotoEditorModel.loadBase64OrBlob(n,{filename:e.filename||"",showLoadScreen:!1,clearLocalAssets:!1,saveBlobAsIs:!0})}else"collage"===e.section?(BFN.AppModel.viewingCollage||(BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER),BeFunky.showLoadScreen({isCancellable:!1}),e.collageBackgroundPatternBase64?BFN.TextureUtils.blobOrBase64ToTexture(e.collageBackgroundPatternBase64,t=>{var i=t.texture;!t.error&&i&&(i.baseTexture.isPattern=!0,i.baseTexture.averageColor=BFN.Util.getTextureAverageColor(i,!0),e.collageBackgroundPatternTexture=i),this.processQueuedProjectItemVOs()}):this.processQueuedProjectItemVOs(),BFN.CollageMakerModel.hasUnsavedChanges=!1):"designer"===e.section&&(BFN.AppModel.viewingDesigner||(BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_DESIGNER),BFN.DesignerModel.hasUnsavedChanges=!1,BeFunky.showLoadScreen({isCancellable:!1}),this.processQueuedProjectItemVOs());BFN.UploadSaveShareManager.setFileName(e.section,"image",e.filename||""),BFN.UploadSaveShareManager.setFileName(e.section,"project",e.filename||"")})}handleEditorImageLoadComplete(e){BFN.PhotoEditorModel.removeEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_COMPLETE.type,this.handleEditorImageLoadCompleteBind),BFN.PhotoEditorModel.removeEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_ERROR.type,this.handleEditorImageLoadErrorBind),this.processQueuedProjectItemVOs()}handleEditorImageLoadError(){this.projectLoading=!1,this.rejectProjectLoading("Unable to load Editor image"),BFN.PhotoEditorModel.removeEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_COMPLETE.type,this.handleEditorImageLoadCompleteBind),BFN.PhotoEditorModel.removeEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_ERROR.type,this.handleEditorImageLoadErrorBind),BeFunky.hideLoadScreen();var e=BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture;throw UIToggler.toggleSampleImagePopover(e),UIToggler.toggleSaveButtons(!e),showMenuPanel("primary"),"invalid image data"}processQueuedProjectItemVOs(){if(this.queuedProjectVO&&this.queuedProjectItemVOs&&this.queuedProjectItemVOs.length){var e=this.queuedProjectItemVOs.shift();switch(e.type){case"grid_cell":return this.processGridCell(e,()=>this.processQueuedProjectItemVOs());case"graphic":return this.processGraphic(e,()=>this.processQueuedProjectItemVOs());case"image":return this.processImage(e,()=>this.processQueuedProjectItemVOs());case"mask_image":return this.processMaskImage(e,()=>this.processQueuedProjectItemVOs());default:return this.processQueuedProjectItemVOs()}}else{var t=this.queuedProjectVO;this.queuedProjectVO=null,this.queuedProjectItemVOs=null,BFN.SVGManager.clearCache(),["editor","collage","designer"].includes(t.section)?this.addProject(t):(this.projectLoading=!1,this.rejectProjectLoading("Invalid project section"))}}processGridCell(e,t){var i=e.gridCellImageID,r=this.queuedProjectVO,a=r.imageData,n=r.svgData;if(!i)return t();if(this.projectImageBaseTextures.hasOwnProperty(i))return e.gridCellTexture=new PIXI.Texture(this.projectImageBaseTextures[i]),this.assignTextureToMenuImageVO(i,e.gridCellTexture),t();var o=r=>{var a=r.error,n=r.texture;return a?BeFunky.logError('Unable to generate texture from grid cell "'.concat(i,'" image or SVG data')):("patterns"===BFN.getImageType(i)&&(n.baseTexture.isPattern=!0),this.projectImageBaseTextures[i]=n.baseTexture,e.gridCellTexture=n,this.assignTextureToMenuImageVO(i,e.gridCellTexture)),t()};return a.hasOwnProperty(i)?BFN.TextureUtils.blobOrBase64ToTexture(a[i],o):n.hasOwnProperty(i)?BFN.TextureUtils.svgStringToTexture(n[i],o):(BeFunky.logError("Project grid cell missing image/SVG data"),void t())}processGraphic(e,t){if(e.basicShapeValues)t();else{var i=e.graphicID,r=this.queuedProjectVO.svgData;if(!i)return BeFunky.logError("Project graphic missing ID"),t();if(!r.hasOwnProperty(i))return BeFunky.logError("Project graphic missing SVG data"),t();BFN.TextureUtils.svgStringToTexture(r[i],i=>{var r=i.error,a=i.texture;r?BeFunky.logError("Unable to convert graphic SVG string to texture"):e.graphicTexture=a,t()})}}processImage(e,t){var i=e.imageID,r=this.queuedProjectVO.imageData,a=t=>{e.transformWidth>0&&e.transformHeight>0&&(e.transformScaleX=e.transformWidth/t.width,e.transformScaleY=e.transformHeight/t.height)};return i?r.hasOwnProperty(i)?this.projectImageBaseTextures.hasOwnProperty(i)?(e.imageTexture=new PIXI.Texture(this.projectImageBaseTextures[i]),this.assignTextureToMenuImageVO(i,e.imageTexture),a(e.imageTexture.baseTexture),t()):void BFN.TextureUtils.blobOrBase64ToTexture(r[i],r=>{var n=r.texture;r.error?BeFunky.logError("Unable to generate texture from project image data"):("patterns"===BFN.getImageType(i)&&(n.baseTexture.isPattern=!0),this.projectImageBaseTextures[i]=n.baseTexture,e.imageTexture=n,this.assignTextureToMenuImageVO(i,e.imageTexture),a(e.imageTexture.baseTexture)),t()}):(BeFunky.logError("Project image missing image data"),t()):(BeFunky.logError("Project image missing ID"),t())}processMaskImage(e,t){var i=e.maskImageID,r=this.queuedProjectVO,a=r.svgData,n=r.imageData;if(!i)return BeFunky.logError("Project mask image missing ID"),t();if(!n.hasOwnProperty(i))return BeFunky.logError("Project mask image missing image data"),t();var o=()=>{if(!e.maskImageMaskID)return t();if(a.hasOwnProperty(e.maskImageMaskID))BFN.SVGManager.getSVGShape(a[e.maskImageMaskID],i=>{e.maskImageMaskTexture=BFN.SVGManager.getTexture(i,t)},e.maskImageMaskID,!0);else{if(!n.hasOwnProperty(e.maskImageMaskID))return t();BFN.TextureUtils.blobOrBase64ToTexture(n[e.maskImageMaskID],i=>{var r=i.error,a=i.texture;return r?(BeFunky.logError("Unable to generate texture from project image data"),t()):(e.maskImageMaskTexture=a,t())})}};if(this.projectImageBaseTextures.hasOwnProperty(i))return e.maskImageTexture=new PIXI.Texture(this.projectImageBaseTextures[i]),this.assignTextureToMenuImageVO(i,e.maskImageTexture),o();BFN.TextureUtils.blobOrBase64ToTexture(n[i],r=>{var a=r.error,n=r.texture;return a?(BeFunky.logError("Unable to generate texture from project image data"),t()):("patterns"===BFN.getImageType(i)&&(n.baseTexture.isPattern=!0),this.projectImageBaseTextures[i]=n.baseTexture,e.maskImageTexture=n,this.assignTextureToMenuImageVO(i,e.maskImageTexture),o())})}addProject(e){var t=null,i=null,r=null,a=null;switch(e.section){case"editor":t=BFN.PhotoEditorModel,i=BFN.PhotoEditorCanvasModel,r=BFN.PhotoEditorCanvas,a=e.section;break;case"collage":t=BFN.CollageMakerModel,i=BFN.CollageMakerCanvasModel,r=BFN.CollageMakerCanvas,a=e.section,BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),BFN.CollageMakerHistoryModel.resetHistory(),BFN.CollageMakerCanvasPhotoGridModel.freeform=e.collageFreeform,BFN.CollageMakerCanvasPhotoGridModel.freeform?(BFN.CollageMakerCanvasPhotoGrid.updateToolVO(e.projectWidth,e.projectHeight,0,0,e.collageBackgroundColor,!1,!1,!1),BFN.CollageMakerCanvasPhotoGrid.preparePhotoGrid(e.projectWidth,e.projectHeight,0,0)):(BFN.CollageMakerCanvasPhotoGrid.updateToolVO(e.projectWidth,e.projectHeight,e.collageGap,e.collageRounding,e.collageBackgroundColor,!1,!0,!0),BFN.CollageMakerCanvasPhotoGrid.preparePhotoGrid(e.collageGridWidth,e.collageGridHeight,e.collageGap/100,e.collageRounding/100)),BFN.CollageMakerCanvasPhotoGrid._gridWidth=e.projectWidth,BFN.CollageMakerCanvasPhotoGrid._gridHeight=e.projectHeight,BFN.CollageMakerCanvasBackground.color!==e.collageBackgroundColor&&(BFN.CollageMakerCanvasBackground.color=e.collageBackgroundColor),e.hasOwnProperty("collageBackgroundPatternTexture")?(BFN.CollageMakerCanvasPhotoGrid.setPatternBackgroundTexture(e.collageBackgroundPatternTexture),delete e.collageBackgroundPatternTexture):(BFN.CollageMakerCanvasPhotoGrid.setPatternBackgroundTexture(null),BFN.PhotoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color),BFN.CollageMakerCanvasPhotoGridModel.freeform||(BFN.CollageMakerHistoryModel.ignoreSnapshot=!0,e.collageGridChildren.forEach(e=>{var t=BFN.PhotoGrid.addGridChild(e.gridCellRect.x,e.gridCellRect.y,e.gridCellRect.width,e.gridCellRect.height);if(e.gridCellImageID)if(e.gridCellTexture){var i=BFN.ImageLibraryManager.getSampleIndex(e.gridCellImageID),r=BFN.ImageLibraryManager.getIndex(e.gridCellImageID),a=null;if(-1!==i)a=BFN.ImageLibraryManager.sampleMenuImageVOs[i];else if(-1!==r)a=BFN.ImageLibraryManager.selectedMenuImageVOs[r];else{(a=new BFN.MenuImageVO).id=e.gridCellImageID;var n=e.gridCellTexture,o=BFN.MultipleFileUploader.thumbSize,s=n.width/n.height,l=o*(s>1?s:1/s),h=BFN.Util.getThumbTexture(n,l,!1,!0);h.renderClone().destroyGC(!0),a.isTransparent=e.gridCellTexture.determineTransparency(),a.thumbURL=BFN.TextureUtils.textureToBase64(h,{isTransparent:a.isTransparent}),a.thumbWidth=h.width,a.thumbHeight=h.height,h.destroyGC(!0)}a.imageTexture=e.gridCellTexture,delete e.gridCellTexture,t.menuImageVO=a,a.imageTexture&&a.imageTexture.valid&&t.content.setImage(a.imageTexture),t.content.image.frameSprite.offsetFactorX=e.gridCellTextureOffsetFactorX,t.content.image.frameSprite.offsetFactorY=e.gridCellTextureOffsetFactorY,t.content.image.frameSprite.rotate=e.gridCellTextureRotate,t.content.image.frameSprite.textureScale=e.gridCellTextureScale,t.content.image.frameSprite.offsetFactorX=e.gridCellTextureOffsetFactorX,t.content.image.frameSprite.offsetFactorY=e.gridCellTextureOffsetFactorY,t.content.image.frameSprite.updateDisplay()}else e.gridCellImageID=null,e.gridCellTextureOffsetFactorX=.5,e.gridCellTextureOffsetFactorY=.5,e.gridCellTextureRotate=0,e.gridCellTextureScale=1;t.updateProjectItemVO()}),BFN.CollageMakerHistoryModel.ignoreSnapshot=!1),BFN.CollageMakerCanvasPhotoGrid.updateSettings(),BFN.CollageMakerCanvasPhotoGridModel.freeform||(BFN.CollageMakerHistoryModel.historyAction="new_grid_template",BFN.CollageMakerCanvasPhotoGrid.photoGrid.getPhotoGridSnapShot());break;case"designer":t=BFN.DesignerModel,i=BFN.DesignerCanvasModel,r=BFN.DesignerCanvas,a=e.section,BFN.DesignerCanvasModel.dispatchEvent(BFN.DesignerCanvasModelEvents.CLEAR_ITEMS),BFN.DesignerCanvas.setSize(e.projectWidth,e.projectHeight),BFN.DesignerCanvasBackground.color=e.designerBackgroundColor,UITools.setToolValue("collage_customize","background_color",e.designerBackgroundColor),UITools.updateToolControls("collage_customize"),BFN.ZoomManager.updateZoomRange(),BFN.DesignerCanvas.fitDesignerToFrame()}if(t&&i&&r&&a){this.transformItemsPending=!0,t.projectVO=e,BeFunky.showLoadScreen({isCancellable:!1}),BFN.GroupManager.clearGroups(e.section),BFN.GroupManager.addGroups(e.section,e.transformGroups),BFN.TransformStateModel.blockAddedTransitions=!0,BFN.TransformModel.selectItemOnAdd=!1;var n=[];e.transformGraphics.filter(e=>e.graphicTexture||e.basicShapeValues).forEach(t=>{t.graphicTexture?i.addedItem={type:"texture",texture:t.graphicTexture,isGoodie:!0,projectItemVO:t,projectVO:e,graphicStyle:t.graphicStyle}:t.basicShapeValues&&(i.addedItem={type:"texture",texture:null,isGoodie:!0,projectItemVO:t,projectVO:e,basicShapeVO:new BFN.BasicShapeVO(t.basicShapeValues.type,t.basicShapeValues)});var a=BFN.TransformModel.addedTransformItem,o=new BFN.TransformItemStateVO;t.hasOwnProperty("graphicTexture")&&t.graphicTexture&&(o.imageTexture=t.graphicTexture,delete t.graphicTexture),o.parent=r.transformLayer,this.transferProperties(t,o),a.applyTransformItemState(o),n.push({zIndex:o.zIndex,item:a,state:o})});for(var o=e.transformImages.length;--o>-1;){var s=e.transformImages[o];if(!s.isGoodie&&s.hasOwnProperty("imageTexture")){e.transformImages.splice(o,1),s.maskImageTexture=s.imageTexture,delete s.imageTexture,s.type="mask_image",s.maskImageID=s.imageID,s.imageID=null;var l=s.maskImageTexture.baseTexture;s.maskImageFrameWidth=s.transformScaleX*l.width,s.maskImageFrameHeight=s.transformScaleY*l.height;var h=Math.max(s.maskImageFrameWidth/l.width,s.maskImageFrameHeight/l.height),c=l.width*h,u=l.height*h;s.maskImageTextureScale={x:s.maskImageFrameWidth/c,y:s.maskImageFrameHeight/u},s.transformScaleX=1,s.transformScaleY=1,e.transformMaskImages.push(s)}}if(e.transformImages.filter(e=>e.imageTexture).forEach(t=>{var a={type:"texture",texture:t.imageTexture,projectItemVO:t,projectVO:e,graphicStyle:t.graphicStyle};t.isGoodie&&(a.isGoodie=!0),i.addedItem=a;var o=BFN.TransformModel.addedTransformItem,s=new BFN.TransformItemStateVO;s.imageTexture=t.imageTexture,delete t.imageTexture,s.parent=r.transformLayer,this.transferProperties(t,s),o.applyTransformItemState(s),n.push({zIndex:s.zIndex,item:o,state:s})}),e.transformMaskImages.filter(e=>e.maskImageTexture).forEach(t=>{if(t.hasOwnProperty("maskImageFlashVars")){var a=t.maskImageTexture.baseTexture;if(t.maskImageFrameWidth=t.maskImageFlashVars.maskImageWidth,t.maskImageFrameHeight=t.maskImageFlashVars.maskImageHeight,t.maskImageFlashVars.maskImageScaleX=Math.round(100*t.maskImageFlashVars.maskImageScaleX)/100,t.maskImageFlashVars.maskImageScaleY=Math.round(100*t.maskImageFlashVars.maskImageScaleY)/100,t.maskImageFlashVars.maskImageScaleX===t.maskImageFlashVars.maskImageScaleY){var o=Math.min(a.width*t.maskImageFlashVars.maskImageScaleX/t.maskImageFrameWidth,a.height*t.maskImageFlashVars.maskImageScaleY/t.maskImageFrameHeight),s=Math.max(0,a.width*t.maskImageFlashVars.maskImageScaleX-t.maskImageFlashVars.maskImageWidth),l=Math.max(0,a.height*t.maskImageFlashVars.maskImageScaleY-t.maskImageFlashVars.maskImageHeight);t.maskImageOffsetFactorX=s?Math.abs(t.maskImageFlashVars.maskImageX)/s:.5,t.maskImageOffsetFactorY=l?Math.abs(t.maskImageFlashVars.maskImageY)/l:.5,t.maskImageTextureScale=o}delete t.maskImageFlashVars}var h={x:1,y:1};"object"==typeof t.maskImageTextureScale&&t.maskImageTextureScale.hasOwnProperty("x")&&t.maskImageTextureScale.hasOwnProperty("y")?(h.x=t.maskImageTextureScale.x,h.y=t.maskImageTextureScale.y):"number"==typeof t.maskImageTextureScale&&(h.x=t.maskImageTextureScale,h.y=t.maskImageTextureScale),t.maskImageTextureScale=h;var c=null;t.hasOwnProperty("maskImageMaskTexture")&&t.maskImageMaskTexture?c=t.maskImageMaskTexture:t.basicShapeValues&&(c=PIXI.RenderTexture.create(32,32));var u={type:"frame_texture",texture:t.maskImageTexture,maskTexture:c,projectItemVO:t,projectVO:e};t.graphicStyle&&(u.graphicStyle=t.graphicStyle),t.basicShapeValues&&(u.basicShapeVO=new BFN.BasicShapeVO(t.basicShapeValues.type,t.basicShapeValues)),i.addedItem=u;var d=BFN.TransformModel.addedTransformItem,m=new BFN.TransformItemStateVO;m.imageTexture=t.maskImageTexture,delete t.maskImageTexture,t.hasOwnProperty("maskImageMaskTexture")&&delete t.maskImageMaskTexture,m.parent=r.transformLayer,m.maskImageFrameWidth=t.maskImageFrameWidth,m.maskImageFrameHeight=t.maskImageFrameHeight,m.maskImageOffsetFactorX=t.maskImageOffsetFactorX,m.maskImageOffsetFactorY=t.maskImageOffsetFactorY,m.maskImageTextureScale=t.maskImageTextureScale,this.transferProperties(t,m),d.applyTransformItemState(m),n.push({zIndex:m.zIndex,item:d,state:m})}),e.transformLabels.length&&(BFN.UndoManager.updating=!0,e.transformLabels.forEach(t=>{var a=t.labelTextStyles.styles;BFN.ParseBFD.forEachCharacterStyle(a,e=>{e.hasOwnProperty("desiredStrokeWidth")&&(!e.hasOwnProperty("strokePercent")&&e.hasOwnProperty("fontSize")&&(e.strokePercent=Math.max(BFN.TransformItemTextStrokePercentMin,Math.min(BFN.TransformItemTextStrokePercentMax,e.desiredStrokeWidth/Math.max(.001,e.fontSize)))),delete e.desiredStrokeWidth)});for(var o={fontFamily:BFN.FabricManager.defaultFontFamily,fontSize:BFN.TransformItemTextBaseFontSize,fill:"rgb(0,0,0,1)",textBackgroundColor:"",stroke:"",strokeWidth:1,strokePercent:BFN.TransformItemTextStrokePercentDefault},s={},l=t.labelTextStyles.styles,h=t.labelText.split("\n"),c=0;c<h.length;c++){c<h.length-1&&(h[c]+="\n"),s[c]={};for(var u=0;u<h[c].length;u++)l&&l[c]&&l[c][u]&&(o=Object.assign({},l[c][u])),s[c][u]=Object.assign({},o)}t.labelTextStyles.styles=s,i.addedItem={type:"text",projectItemVO:t,projectVO:e};var d=BFN.TransformModel.addedTransformItem,m=new BFN.TransformItemStateVO;d.updateStateVO(m),m.parent=r.transformLayer,m.text=t.labelText,m.textStyle=t.labelTextStyles,m.textWidth=t.labelWidth,m.textScale=t.labelTextScale,m.textItemScale=t.labelTextItemScale,m.textBackgroundColor=t.labelTextBackgroundColor,m.textBackgroundIntensity=t.labelTextBackgroundIntensity,m.textBackgroundPadding=t.labelTextBackgroundPadding,this.transferProperties(t,m),d.applyTransformItemState(m),n.push({zIndex:m.zIndex,item:d,state:m})}),BFN.MainUI.rendering=!0,BFN.MainUI.renderCanvas(),BFN.MainUI.rendering=!1,BFN.UndoManager.updating=!1),this.trackingData&&"designer"===e.section){var d=this.trackingData.type;d||(d=this.trackingData.id?"Preset":"Custom");var m=new BFN.UserActionVO;m.eventID="design_layout_selected",m.eventObject={templateType:d,templateName:this.trackingData.name||"Custom",templateID:this.trackingData.id||"custom",templateSearchKeyword:this.trackingData.searchTerm||""},m.track()}this.sourceTemplateLoading=!1,this.trackingData=null,BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.selectedTransformItem.deselectItem(),BFN.MainUI.renderCanvas(),n.forEach(e=>{var t=e.item;t.ignoreAccurateBounds=!0,t.visible=!1}),BFN.MainUI.renderCanvas();var p=!1,g=()=>{if(!BFN.updatingShapeQueue.length&&!BFN.updatingTextQueue.length&&(p||(p=!0,n.length&&(n.sort((e,t)=>e.zIndex-t.zIndex),n.forEach((e,t)=>{var i=e.item,r=e.state;i.parent.setChildIndex(i,t),setTimeout(()=>{i.updateShapeTexture()},t),r.zIndex=t,i.ignoreAccurateBounds=!1,i.updateAccurateBounds(),i.setTransitionStartState(),i.setTransitionEndState()}))),!BFN.accurateBoundsQueue.length)){n.forEach(e=>{var t=e.item;t.visible=!0,t.preloadThumbnail(5*o+50),t.refreshItemName(),"text"!==t.type||t.iText.wordBreaksEnabled||(t.iText.wordBreaksEnabled=!0)}),BFN.MainUI.requestRender(),BFN.TransformStateModel.blockAddedTransitions=!1,BFN.TransformModel.selectItemOnAdd=!0,BeFunky.hideLoadScreen();var t=0;if("editor"===a&&BFN.PhotoEditorHistoryModel.historyVOs.length)t=BFN.PhotoEditorHistoryModel.historyVOs[0].timestamp;return BFN.TextureHistoryManager.addTextureHistory(t),Object.keys(this.projectImageBaseTextures).forEach(e=>{delete this.projectImageBaseTextures[e]}),this.projectImageBaseTextures={},this.transformItemsPending=!1,BFN.TransformLayerManager.updateTransformItems(),BFN.TransformGuides.setTransformGuideData(e.transformGuides,e.transformGuidesLocked),this.projectLoading=!1,this.resolveProjectLoading(),this.saveProjectAssets(e),void this.requestLocalSave()}setTimeout(g,0)};setTimeout(g,0)}else BeFunky.throwError("Unable to add project",e.section),this.projectLoading=!1,this.rejectProjectLoading("Unable to add project")}saveProjectAssets(e){BeFunky.testingFlags.includes("add_screenshot_mask")&&requestIdleCallback(this.createScreenshotMask);var t=!!e._isLocalProject;delete e._isLocalProject;var i=e.section,r={image:e.imageData,svg:e.svgData};e.imageData={},e.svgData={};var a=Object.keys(r.image),n=Object.keys(r.svg);e.imageDataKeys.splice(0),e.svgDataKeys.splice(0),e.imageDataKeys.push(...a),e.svgDataKeys.push(...n);var o=[...a.map(e=>"image__".concat(e)),...n.map(e=>"svg__".concat(e))];t&&o.push("image__".concat(i,"_thumb")),"editor"===i&&o.push("image__editor_canvas_image");(()=>BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage?Promise.resolve():BFN.ProjectService.clearLocalAssets(i,o))().then(()=>{if(!t)a.map(t=>e(t,"image")),n.map(t=>e(t,"svg"));function e(e,t){var a=r[t][e];if("image"===t&&"string"==typeof a)try{a=BFN.BlobUtils.base64ToBlob(a)}catch(t){BeFunky.logError("Unable to convert project image ".concat(e," from base64 -> blob before saving in IndexedDB"))}return BFN.ProjectService.setLocalAsset(i,t,e,a).catch(t=>{BeFunky.logError("Unable to save project asset",e,t)})}})}createScreenshotMask(){var e;BeFunky.waitUntil({condition:()=>(e=BFN.AppModel.viewingEditor?function(){var e=BFN.PhotoEditorCanvas.scale.x,t=BFN.PhotoEditorCanvasImage.imageWidth*e,i=BFN.PhotoEditorCanvasImage.imageHeight*e,r=BFN.PhotoEditorCanvas.canvasContainer.x*e,a=-BFN.PhotoEditorCanvas.canvasContainer.y*e;return{width:t,height:i,left:BFN.PhotoEditorCanvas.x+r-t/2+BFN.appViewportRect.left,bottom:BFN.PhotoEditorCanvas.y+a-i/2+BFN.CSS.footerHeight}}():BFN.ImageEditManager.getProjectBoundingClientRect()).width>1,onTimeout:()=>{BeFunky.logError("Unable to get template dimensions")},onSuccess:()=>{!function(){var t=document.getElementById("project_bounds");t||(t=BeFunky.lit.elem(fm()),document.body.appendChild(t));t.setStyles({position:"absolute",width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),left:"".concat(e.left,"px"),bottom:"".concat(e.bottom,"px")}),console.log("Testing > Positioned project_bounds div over canvas","".concat(e.width," x ").concat(e.height))}()},interval:500,maxAttempts:6})}getProjectVO(e){var i=new BFN.ProjectVO;return Object.assign(i,e),i.collageGridChildren=[],i.transformGraphics=[],i.transformImages=[],i.transformMaskImages=[],i.transformLabels=[],i.transformGroups=[],e.collageGridChildren.forEach(e=>i.collageGridChildren.push(this.getProjectItemVO(e))),e.transformGraphics.forEach(e=>i.transformGraphics.push(this.getProjectItemVO(e))),e.transformImages.forEach(e=>i.transformImages.push(this.getProjectItemVO(e))),e.transformMaskImages.forEach(e=>i.transformMaskImages.push(this.getProjectItemVO(e))),e.transformLabels.forEach(e=>i.transformLabels.push(this.getProjectItemVO(e))),e.transformGroups&&e.transformGroups.forEach(e=>i.transformGroups.push(this.getTransformItemGroupVO(e))),i.svgData={},Object.entries(e.svgData).forEach(e=>{var r=t(e,2),a=r[0],n=r[1];i.svgData[a]=n.startsWith("<")?n:atob(n)}),i}getProjectItemVO(e){var t=new BFN.ProjectItemVO;return Object.assign(t,e),e.gridCellRect&&(t.gridCellRect=new BFN.Rectangle(e.gridCellRect.x,e.gridCellRect.y,e.gridCellRect.width,e.gridCellRect.height)),t}getTransformItemGroupVO(e){var t=new BFN.TransformItemGroupVO;return Object.assign(t,e),t}getProjectObject(e){var t={};return Object.assign(t,e),t.collageGridChildren=[],t.transformGraphics=[],t.transformImages=[],t.transformMaskImages=[],t.transformLabels=[],e.collageGridChildren.forEach(e=>t.collageGridChildren.push(this.getProjectItemObject(e))),e.transformGraphics.forEach(e=>t.transformGraphics.push(this.getProjectItemObject(e))),e.transformImages.forEach(e=>t.transformImages.push(this.getProjectItemObject(e))),e.transformMaskImages.forEach(e=>t.transformMaskImages.push(this.getProjectItemObject(e))),e.transformLabels.forEach(e=>t.transformLabels.push(this.getProjectItemObject(e))),t}getProjectItemObject(e){var t={};return Object.assign(t,e),t.gridCellRect&&(t.gridCellRect={x:t.gridCellRect.x,y:t.gridCellRect.y,width:t.gridCellRect.width,height:t.gridCellRect.height}),delete t.graphicTexture,delete t.imageTexture,delete t.maskImageTexture,delete t.maskImageMaskTexture,delete t.gridCellTexture,t}transferProperties(e,t){t.basicShapeValues=e.basicShapeValues,t.shapeColorMap=e.shapeColorMap,t.zIndex=e.transformZIndex,t.locked=e.transformLocked,t.x=e.transformX,t.y=e.transformY,t.scaleX=e.transformScaleX,t.scaleY=e.transformScaleY,t.rotation=e.transformRotation,t.opacity=e.transformOpacity,t.blendMode=e.transformBlendMode,t.flippedHorizontal=e.transformFlippedHorizontal,t.flippedVertical=e.transformFlippedVertical,t.overlayColor=e.transformOverlayColor,t.overlayColorIntensity=e.transformOverlayColorIntensity,t.tint=e.transformTintColor}assignTextureToMenuImageVO(e,t){var i;switch(BFN.getImageType(e)){case"graphic":i=BFN.GraphicLibraryManager.getMenuImageVO(e);break;case"patterns":t.baseTexture.isPattern=!0,i=BFN.CollageMakerPatternManager.getMenuImageVO(e);break;default:i=BFN.ImageLibraryManager.getMenuImageVO(e)}i&&(!i.imageTexture||i.imageTexture&&!i.imageTexture.baseTexture)&&(i.imageTexture=new PIXI.Texture(t.baseTexture))}updateProjectVOItems(e,t){if(!this.projectLoading){e.projectVO.imageDataKeys.splice(0),e.projectVO.svgDataKeys.splice(0),e.projectVO.transformGraphics.splice(0),e.projectVO.transformImages.splice(0),e.projectVO.transformMaskImages.splice(0),e.projectVO.transformLabels.splice(0);var i="editor";e===BFN.CollageMakerModel&&(i="collage"),e===BFN.DesignerModel&&(i="designer"),t.children.filter(e=>"group"!==e.type&&e.projectItemVO).forEach(r=>{var a=r.projectItemVO;switch(a.transformZIndex=t.children.indexOf(r),a.type){case"graphic":a.graphicID?(e.projectVO.svgDataKeys.includes(a.graphicID)||(e.projectVO.svgDataKeys.push(a.graphicID),BFN.ProjectService.setLocalAsset(i,"svg",a.graphicID,void 0,!0)),e.projectVO.transformGraphics.push(a)):a.basicShapeValues&&e.projectVO.transformGraphics.push(a);break;case"image":a.imageID&&(e.projectVO.imageDataKeys.includes(a.imageID)||(e.projectVO.imageDataKeys.push(a.imageID),BFN.ProjectService.setLocalAsset(i,"image",a.imageID,void 0,!0)),e.projectVO.transformImages.push(a));break;case"mask_image":if(a.maskImageID&&(e.projectVO.imageDataKeys.includes(a.maskImageID)||(e.projectVO.imageDataKeys.push(a.maskImageID),BFN.ProjectService.setLocalAsset(i,"image",a.maskImageID,void 0,!0)),e.projectVO.transformMaskImages.push(a)),a.maskImageMaskID)r.itemContentMask&&!r.isShape?e.projectVO.imageDataKeys.includes(a.maskImageMaskID)||(e.projectVO.imageDataKeys.push(a.maskImageMaskID),BFN.ProjectService.setLocalAsset(i,"image",a.maskImageMaskID,void 0,!0)):e.projectVO.svgDataKeys.includes(a.maskImageMaskID)||(e.projectVO.svgDataKeys.push(a.maskImageMaskID),BFN.ProjectService.setLocalAsset(i,"svg",a.maskImageMaskID,void 0,!0));break;case"label":e.projectVO.transformLabels.push(a)}})}}validateProject(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.allowReset,r=void 0!==i&&i,a=t.logLevel,n=void 0===a?"none":a,o=t.requireEditorMainImage,s=void 0===o||o;if(!e||"object"!=typeof e)return l("Not an object"),!1;if(!["editor","collage","designer"].includes(e.section))return l("Invalid section"),!1;if("number"!=typeof e.version)return l("Invalid version: not a number"),!1;if("number"!=typeof e.projectWidth||"number"!=typeof e.projectHeight)return l("Invalid projectWidth/projectHeight: not a number"),!1;if(!r){if(e.projectWidth<=0||e.projectHeight<=0)return l("Invalid projectWidth/projectHeight: not greater than zero"),!1;if("editor"===e.section&&s&&!e.editorImageBase64)return l("Missing editorImageBase64"),!1}return!0;function l(t){if("none"!==n){var i="projectVO failed validation: ".concat(t);return"console"===n?BeFunky.logError(i,e):"throw"===n?BeFunky.throwError(i,e):BeFunky.logError("Invalid log level",n)}}}requestLocalSave(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sectionID,i=void 0===t?BFN.AppModel.sectionID:t,r=e.isLazy,a=void 0===r||r,n=e.allowReset,o=void 0!==n&&n,s=e.createThumbnail,l=this.autoSave[i],h=BFN.toTitleCase(i),c=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return BeFunky.logFeature("autosave",...t)},u=Date.now();if(l.cancelLazySave(),!a){var d=f(i);return this.validateProject(d,{allowReset:o,logLevel:"throw",requireEditorMainImage:!1})?g(d,"boolean"!=typeof s||s):Promise.reject("".concat(h," projectVO failed validation"))}if(BFN.ZoomRegion&&BFN.ZoomRegion.updatePreview(),l.allowAutoSave){var m=!1;v();var p=setTimeout(()=>BFN.MainUI.addIdleRenderFunction(()=>{if(l.allowAutoSave&&!m){var e=f(i);if(!this.validateProject(e,{allowReset:o,logLevel:"console",requireEditorMainImage:!1}))return BeFunky.logError("".concat(h," lazy save cancelled b/c projectVO failed validation")),void y();g(e,!e._wasReset&&this.checkThumbnailAvailability(i).isAvailable).catch(e=>{BeFunky.logError("".concat(h," lazy save failed:"),e)})}else y()}),this.autoSaveInterval);l.cancelLazySave=(()=>{clearTimeout(p),m=!0,y()})}function g(e,t){v(),c("Saving",i,{isLazy:a,needsThumbnail:t});var r=t?function(){var e=Date.now();return BFN.ProjectManager.createThumbnail(i,"blob",!1).then(t=>(c("Thumbnail created",Date.now()-e),e=Date.now(),BFN.ProjectService.setLocalAsset(i,"image","".concat(i,"_thumb"),t))).then(()=>{c("Thumbnail saved",Date.now()-e)})}():Promise.resolve(),n=Date.now();return BFN.ProjectService.saveLocalProject(i,BFN.ProjectManager.getProjectObject(e)).then(e=>{var t=e.store;c("Project saved in ",Date.now()-n),l.lastSaveLocation=t}).then(()=>r).then(()=>y(),e=>{throw y(),e})}function f(e){var t={editor:BFN.PhotoEditorModel,collage:BFN.CollageMakerModel,designer:BFN.DesignerModel}[e].projectVO;return t.thumbBase64=null,t.editorImageBase64=null,t}function v(){l.saveQueue.push(u),l.saveQueue=l.saveQueue.unique()}function y(){l.saveQueue=l.saveQueue.filter(e=>e!==u)}}isFullyAutoSaved(){var e=Object.values(BFN.ProjectManager.autoSave),t=e.every(e=>"memory"!==e.lastSaveLocation),i=e.every(e=>0===e.saveQueue.length);return t&&i}checkThumbnailAvailability(e){return BFN.openedSections.includes(e)||"editor"===e&&BFN.ImageEditManager.editingImage?"editor"===e&&BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS?{isAvailable:!1,reason:"not_viewing_canvas"}:BFN.FabricManager.showingTransformItemIText?{isAvailable:!1,reason:"fabric_canvas_showing"}:BFN.TransformItemIsolator.active||BFN.TransformItemIsolator.animating?{isAvailable:!1,reason:"transform_item_isolated"}:BFN.PhotoGrid.gridIsolator.gridChild?{isAvailable:!1,reason:"grid_item_isolated"}:{isAvailable:!0,reason:"all_is_well"}:{isAvailable:!1,reason:"section_has_not_been_opened"}}createThumbnail(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blob",a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.checkThumbnailAvailability(e),o=n.isAvailable,s=n.reason;if(!o)return Promise.reject(s);switch(e){case"editor":i=BFN.PhotoEditorCanvas.getFlattenedImage();break;case"collage":i=BFN.CollageMakerCanvas.getFlattenedImage();break;case"designer":i=BFN.DesignerCanvas.getFlattenedImage()}if(!i)return Promise.reject("no_flattened_image");var l,h,c=i.width/i.height;if(a){var u=c>=1?c:1/c,d=Math.round(720*u),m=t(BFN.TextureUtils.getScaledDimensions(i,{maxWidth:d,maxHeight:d}),2);l=m[0],h=m[1]}else{var p=t(BFN.TextureUtils.getScaledDimensions(i,{maxWidth:300,maxHeight:200}),2);l=p[0],h=p[1]}var g=i.width===l&&i.height===h?i:BFN.Util.getThumbTexture(i,Math.max(l,h)),f=!!a&&BFN.Util.isTransparent(g),v=a?1:.9,y="base64"===r?Promise.resolve(BFN.TextureUtils.textureToBase64(g,{isTransparent:f,quality:v})):BFN.TextureUtils.textureToBlobWithErrorHandling(g,{isTransparent:f,quality:v}),x=g.width,_=g.height,I=i.width,T=i.height;return y.then(t=>{var i=t=>{this.savedCanvasThumbs.hasOwnProperty(e)||(this.savedCanvasThumbs[e]={});var i=this.savedCanvasThumbs[e];i.thumbID=BeFunky.randomString(10),i.thumbSRC=t,i.thumbW=x,i.thumbH=_,i.canvasW=I,i.canvasH=T,BFN.ZoomRegion.updatePreview()};"base64"===r?i(t):BFN.BlobUtils.blobToBase64(t).then(i)}),i.destroyGC(!0),g.destroyGC(!0),y}getThumbnailHtmlForDialog(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.width,a=i.height;return function(){if("string"==typeof e&&e.startsWith("data:image/"))return Promise.resolve(e);if(e instanceof Blob)return BFN.BlobUtils.blobToBase64(e);return Promise.reject("no_blob")}().then(function(e){var i="contain";if(r&&a){var n=BFN.TextureUtils.getScaledDimensions({width:r,height:a},{maxWidth:300,maxHeight:200}),o=t(n,2),s=o[0],l=o[1];i="".concat(s," ").concat(l)}return'<div style="background: #1E2024; margin-bottom: 1rem">\n                <div style="background: url(\''.concat(e,"') no-repeat center; background-size: ").concat(i,'; height: 200px; width: 300px; margin: 0 auto;"></div>\n            </div>')})}getOpenImageInEditorProject(){return BFN.PhotoEditorModel.getCurrentTextureBlob().then(e=>{var t=BFN.PhotoEditorModel.projectVO;if(t.editorImageBase64=e,!this.validateProject(t,{logLevel:"throw"}))throw"Invalid Open in Editor project";var i=this.getProjectObject(t),r=BFN.ProjectManager.createThumbnail("editor","base64",!1).then(e=>{i.thumbBase64=e}),a=BFN.ProjectService.addImagesToProject(i);return Promise.all([r,a]).then(()=>i)})}loadFile(e){if("bfd"!==BFN.getExtension(e.name))return BeFunky.logError("User attempted to load non-BFD file as a project",e&&e.name);BeFunky.showLoadScreen({isCancellable:!1}),BFN.SavedProjectService.decodeProjectFile(e,t=>{var i=t.data,r=t.error;if(r)return BeFunky.hideLoadScreen(),BeFunky.logError("Unable to decode BFD file \n",r);BFN.ObjectCompressor.decompress(i).catch(e=>{BeFunky.logError("Unable to decompress project file",e)}).then(t=>{BeFunky.hideLoadScreen(),"object"==typeof t&&this.openProject(t,{filename:e.name.replace(/\.bfd$/i,""),source:"computer"}).catch(e=>{BeFunky.logError("Unable to open project file",e)})})})}openProject(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.filename,r=t.source,a=t.thumbnail;return new Promise((t,a)=>{e.thumbRect&&(e.version=e.version||"1.0",e.section=e.section||"designer");var o=e.section;if(!["editor","collage","designer"].includes(o))return a("Invalid project section: ".concat(BeFunky.stringValue(o)));this.confirmLoadNewProject({onConfirm:()=>(function(t){return BFN.ParseBFD.objectToProjectVO(e).then(e=>BFN.ProjectManager.confirmSwapFonts().then(()=>{if(i&&(e.filename=i),BFN.BfnService.trackMediaOpened("project",r),BFN.AppModel.sectionID===t)return BFN.ProjectManager.loadProject(e);BeFunky.projectToOpenInSection[t]={projectVO:e};var a={editor:BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,collage:BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,designer:BFN.AppModelViewStates.VIEWING_DESIGNER};return BFN.AppModel.viewState=a[t],"pending_section_change"})).catch(e=>"cancelled_by_user"===e?Promise.reject(e):new Promise(r=>{BFN.ProjectManager.handleOpenProjectError(e,t,i,()=>r(e))}))})(o).then(t,a),onCancel:()=>a("cancelled_by_user"),projectSection:o,getNewProjectThumbnail:n})});function n(){if(a)return Promise.resolve({image:a});var t=e.version,i=e.thumbBase64,r=e.thumbRect;return new Promise(e=>{"1.0"===t?BFN.ByteArrayUtil.AS3ByteArrayToPixel(i,r.width,r.height,t=>{var i=t.src;e({image:i})}):e({image:i})})}}confirmLoadNewProject(e){var i=e.onConfirm,r=e.onCancel,a=e.projectSection,n=void 0===a?BFN.AppModel.sectionID:a,o=e.getNewProjectThumbnail;if(n===BFN.AppModel.sectionID&&!("editor"===n?BFN.PhotoEditorModel.hasUnsavedChanges:"collage"===n?BFN.CollageMakerModel.hasUnsavedChanges:BFN.DesignerModel.hasUnsavedChanges)&&h())return console.log("Replacing ".concat(n," project without asking")),i();var s=!1;function l(e){var t,i=e.image,r=e.aspectRatio;return!i&&r?Promise.resolve((t=r>1.54?"100%":"".concat(200*r,"px"),xm(mm(),"width: ".concat(t,";"),"padding-bottom: ".concat(100/r,"%; background: white;")))):"string"==typeof i&&i.length>5?Promise.resolve(a(i)):i instanceof Blob?BFN.BlobUtils.blobToBase64(i).then(e=>a(e)).catch(()=>n()):Promise.resolve(n());function a(e){return xm(pm(),"background-image: url('".concat(e,"');"))}function n(){return xm(dm(),_m("images-empty-border-icon","icon",{style:"width: 5rem; height: 4rem;"}),Im("no_image"))}}function h(){return BFN.openedSections.includes(n)}BeFunky.showLoadScreen({onCancel:()=>{s=!0}}),(h()?Promise.resolve():BFN.SettingsManager.getSetting("autosave").then(e=>{if("no"===e)throw"start_new_mode"})).then(()=>BFN.ProjectService.getAutosavedProjectThumbnail(n)).then(e=>({image:e})).then(e=>s?r():(BeFunky.hideLoadScreen(),o().then(a=>{!function(e,a){function o(){return{editor:"photo_editor",collage:"collage_maker",designer:"designer"}[n]}Promise.all([e,a].map(l)).then(e=>{var a=t(e,2),n=a[0],s=a[1],l=ym(gm(),Im("current_project"),n,_m("global-arrow-icon","icon icon-size-x-large side-by-side__arrow"),Im("new_project"),s,Im(["confirm_project_change",{app_section:Im(o())}]));BeFunky.confirm(l,{onConfirm:i,onCancel:r,confirmText:"yes",cancelText:"no",size:"medium"})})}(e,a)})),()=>{if(s)return r();BeFunky.hideLoadScreen(),i()})}handleOpenProjectError(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(r=>{BeFunky.logError("Unable to open ".concat(t," project"),e),BeFunky.hideLoadScreen();var a=BeFunky.LanguageManager.getStringReplacements("error_opening_project",{app_section:BeFunky.LanguageManager.getString({editor:"photo_editor",collage:"collage_maker",designer:"designer"}[t]),project_name:i?'"'.concat(i,'"'):""}).replace(/\s+/," ");BeFunky.acknowledge(a,{onAcknowledge:r})})}confirmSwapFonts(){return new Promise((e,i)=>{var r=Object.entries(BFN.ParseBFD.swappedFonts);if(!r.length)return e();var a=ym(um(),Im("confirm_swap_fonts"),r.map(e=>{var i=t(e,2),r=i[0],a=i[1];return xm(cm(),r,a)}),Im("learn_more"));BeFunky.confirm(a,{onConfirm:()=>e(),onCancel:()=>i("cancelled_by_user"),confirmText:"continue",cancelText:"cancel_install_fonts"})})}getCompressedBlob(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.layerImageQuality,r=void 0===i?.95:i,a=t.compressSmallLayers,n=void 0!==a&&a,o=t.compressStyles,s=void 0===o||o,l=Object.assign({},e);return new Promise((e,t)=>{var i=0,a=0;s&&l.transformLabels.forEach(e=>{e.labelTextStyles.compressedStyles=BFN.ParseBFD.compressCharacterStyles(e.labelTextStyles.styles),delete e.labelTextStyles.styles}),l.editorImageBase64 instanceof Blob&&(i+=1,BFN.BlobUtils.blobToBase64(l.editorImageBase64).then(e=>{l.editorImageBase64=e,++a===i&&c()},e=>(BeFunky.logError("Unable to convert editorImageBase64 Blob (from IndexedDB) to base64. Trying again...",e),BFN.PhotoEditorModel.getCurrentTextureBlob().then(e=>BFN.BlobUtils.blobToBase64(e)).then(e=>{l.editorImageBase64=e,++a===i&&c()},e=>{BeFunky.throwError("Unable to get editorImageBase64 for saving",e),t(e)})))),l.thumbBase64 instanceof Blob&&(i+=1,BFN.BlobUtils.blobToBase64(l.thumbBase64).catch(e=>(BeFunky.logError("Unable to convert project thumbnail to base64",e),"")).then(e=>{l.thumbBase64=e,++a===i&&c()}));var o=Object.keys(l.imageData).filter(e=>l.imageData[e]instanceof Blob),h=Math.max(l.projectWidth,l.projectHeight,BFN.maxImageSizeLayer);if(i+=o.length,o.forEach(e=>{BFN.BlobUtils.downsizeImageBlob(l.imageData[e],{maxSize:h,quality:r,skipSmallImages:!n}).catch(t=>("skipped_small_image"!==t&&BeFunky.logError("Unable to downsize project blob",t),l.imageData[e])).then(e=>BFN.BlobUtils.blobToBase64(e)).catch(e=>(BeFunky.logError("Unable to convert project blob to base64",e),"")).then(t=>{l.imageData[e]=t,++a===i&&c()})}),!i)return c();function c(){return BFN.ObjectCompressor.compress(l).then(t=>{e(new Blob([t],{type:"text/plain;charset=utf-8"}))})}})}}BFN.SingletonQueue.add(()=>{BFN.ProjectManager=new Tm});class bm{constructor(){this.init()}init(){BeFunky.log("TextureHistoryManager Init"),this.initDefaultValues()}initDefaultValues(){this.validViewStates=[BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,BFN.AppModelViewStates.VIEWING_DESIGNER],this.historyHash={},this.historyModifiedHash={},this.validViewStates.forEach(e=>{this.historyModifiedHash[e]=!1}),this.allowedTextureMegaBytes=BFN.sectionMemoryLimitMB,this.minHistoryStates=2,BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS.type,this.handlePhotoEditorCanvasModelClearItems.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS.type,this.handleCollageMakerCanvasModelClearItems.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CLEAR_ITEMS.type,this.handleDesignerCanvasModelClearItems.bind(this))}addTextureHistory(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(t=t||BFN.AppModel.viewState,this.validViewStates.includes(t)){this.historyHash.hasOwnProperty(t)||(this.historyHash[t]={});var r=new BFN.TextureHistoryVO(e),a=this.historyHash[t];a.hasOwnProperty(e)&&(a[e].clear(),delete a[e]),a[e]=r,i.forEach(e=>{r.addUsedTexture(e)}),BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children.filter(e=>e instanceof BFN.TransformItem).forEach(e=>r.addUsedTexture(e.itemContent.texture)),BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&BFN.PhotoEditorModel.currentTexture&&r.addUsedTexture(BFN.PhotoEditorModel.currentTexture),BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&(BFN.PhotoGrid.gridChildren.forEach(e=>{e.menuImageVO&&r.addUsedTexture(e.menuImageVO.imageTexture)}),r.addUsedTexture(BFN.CollageMakerCanvasPhotoGridModel.backgroundPatternTexture))}}updateTextureHistory(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t=t||BFN.AppModel.viewState,this.validViewStates.includes(t)){this.historyHash.hasOwnProperty(t)||(this.historyHash[t]={});var i=this.historyHash[t];for(var r in i)e.includes(parseInt(r))||(i[r].clear(),delete i[r])}}getTextureHistory(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e=e||BFN.AppModel.viewState,this.validViewStates.includes(e)?(this.historyHash.hasOwnProperty(e)||(this.historyHash[e]={}),Object.assign({},this.historyHash[e])):{}}getBaseTextures(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e=e||BFN.AppModel.viewState,!this.validViewStates.includes(e)||!this.historyHash.hasOwnProperty(e))return[];var i=[],r=this.historyHash[e];if(t.length)t.forEach(e=>{r.hasOwnProperty(e)&&r[e].baseTextures.forEach(e=>{e._destroyed||i.includes(e)||i.push(e)})});else for(var a in r){r[a].baseTextures.forEach(e=>{e._destroyed||i.includes(e)||i.push(e)})}return i}getTextureHistoryStatus(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e=e||BFN.AppModel.viewState,this.validViewStates.includes(e)){this.historyHash.hasOwnProperty(e)||(this.historyHash[e]={});var t=this.getTextureHistory(e),i=[];for(var r in t)i.push(parseInt(r));i.sort((e,t)=>e-t);var a=this.getBaseTextures(e),n=a.reduce((e,t)=>e+(t._destroyed?0:t.width*t.height),0);return{textureHistory:t,timestamps:i,baseTextures:a,megabytes:Math.round(4*n/Math.pow(1024,2)*100)/100}}}printTextureHistory(){}cleanupTextureHistory(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t=t||BFN.AppModel.viewState;var i=!1;if(this.validViewStates.includes(t)){var r=this.getTextureHistoryStatus(t);r.megabytes>this.allowedTextureMegaBytes&&r.timestamps.length>this.minHistoryStates&&function(){for(var a=[],n=r.timestamps.length;--n>=r.timestamps.length-e.minHistoryStates;)a.push(r.timestamps[n]);var o=e.getBaseTextures(null,a),s=[...e.validViewStates];s.splice(s.indexOf(t),1),s.forEach(t=>{e.getBaseTextures(t).forEach(e=>{o.includes(e)||o.push(e)})});var l=-1;for(n=r.timestamps.length-e.minHistoryStates;--n>-1;){var h=r.timestamps[n],c=e.getBaseTextures(t,[h]);if(c.length)if("break"===function(){var e=!0;if(c.forEach(t=>{e&&!o.includes(t)&&(e=!1)}),!e)return l=h,"break"}())break}if(t===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&r.timestamps.length>1){var u=BFN.PhotoEditorHistoryModel.getTimestamp(),d=BFN.PhotoEditorHistoryModel.getLastTimestamp(),m=r.timestamps[r.timestamps.length-1];isNaN(m)||isNaN(u)||!isNaN(d)||m!=u||(l=r.timestamps[r.timestamps.length-2])}if(l>=0){e.purgeEarlierTextureHistory(t,l,o);i=!0,e.historyModifiedHash[t]=!0}}()}return i}purgeEarlierTextureHistory(e,t,i){var r=0;return r+=BFN.TransformStateModel.purgeEarlierTransitions(e,t,i),e===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&(r+=BFN.PhotoEditorHistoryModel.purgeEarlierHistory(t,i)),e===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&(r+=BFN.CollageMakerHistoryModel.purgeEarlierHistory(t,i)),r}handlePhotoEditorCanvasModelClearItems(e){this.historyModifiedHash[BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR]=!1}handleCollageMakerCanvasModelClearItems(e){this.historyModifiedHash[BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER]=!1}handleDesignerCanvasModelClearItems(e){this.historyModifiedHash[BFN.AppModelViewStates.VIEWING_DESIGNER]=!1}}BFN.SingletonQueue.add(()=>{BFN.TextureHistoryManager=new bm});BFN.ShaderManager=new class{constructor(){this.init()}init(){BFN.ShaderPool={},this.cnt=0,this.setupFilters=[{key:"ColorFilter",cls:BFN.filters.ColorFilter},{key:"ExposureFilter",cls:BFN.filters.ExposureFilter},{key:"FillLightFilter",cls:BFN.filters.FillLightFilter},{key:"BeautifyFilter",cls:BFN.filters.BeautifyFilter},{key:"VibranceFilter",cls:BFN.filters.VibranceFilter},{key:"ColorMixerFilter",cls:BFN.filters.ColorMixerFilter},{key:"BrushFilter",cls:BFN.filters.BrushFilter},{key:"ColorReplaceFilter",cls:BFN.filters.ColorReplaceFilter},{key:"GaussianBlurFilter",cls:BFN.filters.GaussianBlurFilter,type:"filter"},{key:"LevelsFilter",cls:BFN.filters.LevelsFilter,type:"filter"}]}createShaderPool(e){if(null!==(BFN&&void 0!==BFN.ObjectRenderer&&void 0!==BFN.ObjectRenderer.gl?BFN.ObjectRenderer.gl:BFN&&void 0!==BFN.Stage&&void 0!==BFN.Stage.gl?BFN.Stage.gl:null))if(this.cnt<this.setupFilters.length){var t=this.setupFilters[this.cnt];BFN.ShaderPool[t.key]=void 0!==t.type&&"filter"==t.type?new t.cls:new t.cls(BFN.ObjectRenderer.gl),this.cnt++,requestAnimationFrame(function(){this.createShaderPool(e)}.bind(this))}else e();else e()}};class Sm{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this._settings={autosave:"ask",language:BeFunky.LanguageManager.language.app,artsy_fav:[],effects_fav:[],texture_fav:[],watermarks:[],batch_processing_fav:[],fonts_fav:[],fonts_added:[],use_case:"",snapping:"yes",display_distances:"no",guides:"no",dismissed_messages:[],trialing:""};var e=Object.keys(this._settings);this.nonLocalSettings=["language","artsy_fav","effects_fav","texture_fav","watermarks","fonts_added","trialing"],this.localSettings={},this.remoteSettings={},this.allowLocalSaving=!1,this.allowRemoteSaving=!1,this.getLocalSettings=Promise.all(e.filter(e=>!this.nonLocalSettings.includes(e)).map(e=>BFN.IndexedDB.get("options__".concat(e)).then(t=>{this.localSettings[e]=t},()=>{}))),this.getRemoteSettings=new Promise(e=>{if(BFN.BfnService.userLoggedIn)return e(this.fetchRemoteSettings());e(),this.handleLoginBind=this.handleLogin.bind(this),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleLoginBind)}),this.settingsReady=Promise.all([this.getLocalSettings,this.getRemoteSettings]),this.settingsReady.then(()=>{this.allowLocalSaving=!0,e.forEach(e=>{if(this.isValid(e,this.remoteSettings[e])){if("language"===e)return;this.updateSetting(e,this.remoteSettings[e],{updateUI:!1})}else this.isValid(e,this.localSettings[e])&&this.updateSetting(e,this.localSettings[e],{updateUI:!1});var t=JSON.parse(JSON.stringify(this._settings[e]));this.updateUI(e,t)})}),this.uiReady=!1,this.queuedUiUpdates={},window.addEventListener("INIT_COMPLETE",()=>{BFN.MainUI.addIdleRenderFunction(()=>{this.uiReady=!0,Object.values(this.queuedUiUpdates).forEach(e=>e())})}),this.persistSettings=BeFunky.debounce(this.persistSettings.bind(this),1e3)}handleSettingUpdate(){var e=UITools.getToolValue("user_settings","updating_id"),t=UITools.getControlValue("user_settings_".concat(e));this.updateSetting(e,t,{updateUI:!1})}handleLogin(){BFN.BfnService.userLoggedIn&&(BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleLoginBind),this.settingsReady=new Promise(e=>{this.fetchRemoteSettings().then(()=>{Object.keys(this._settings).forEach(e=>{if("language"!==e&&this.isValid(e,this.remoteSettings[e])){if("batch_processing_fav"===e){var t=!this.remoteSettings[e].length,i=!this._settings[e].isIdenticalTo(BFN.BatchToolManager.defaultBatchToolIDs);if(t||i)return void this.updateSetting(e,[...this._settings[e],...this.remoteSettings[e]].unique())}if("dismissed_messages"===e){var r=e=>e.endsWith("_clue"),a=!this.remoteSettings[e].find(r),n=this._settings[e].filter(r);if(a&&n.length)return console.log("Merging migrated help clues into remote settings"),void this.updateSetting(e,[...this.remoteSettings[e],...n].unique())}this.updateSetting(e,this.remoteSettings[e])}}),e()}).catch(t=>{BeFunky.throwError("Unable to fetch remote settings after user login",t),e()})}))}isValidID(e){return this._settings.hasOwnProperty(e)}isValid(e,t){return BeFunky.SettingsService.isValid(e,t)}getSetting(e){if(!this.isValidID(e))throw"Invalid setting ID";return this.settingsReady.then(()=>this._settings[e])}updateSetting(e,t){var i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).updateUI,r=void 0===i||i;if(!this.isValidID(e))throw console.log({id:e}),"Invalid setting ID";if(!this.isValid(e,t))throw console.log({id:e,value:t}),"Invalid setting value";Array.isArray(t)&&(t=t.slice()).unique();var a=JSON.stringify(t);JSON.stringify(this._settings[e])!==a&&(this._settings[e]=JSON.parse(a),r&&this.updateUI(e,JSON.parse(a)),this.persistSettings())}updateUI(e,t){var i={autosave:()=>{UITools.setControlValue("user_settings_".concat(e),t,!1),UITools.updateToolControl("user_settings_".concat(e))},language:()=>{BeFunky.LanguageManager.setLanguage(t,["app"]),UITools.setToolValue("language","select",t),UITools.updateToolControls("language")},artsy_fav:()=>{BFN.BfnService.userLoggedIn&&BFN.FavoritesManager.handleFavoritesLoaded("artsy",t)},effects_fav:()=>{BFN.BfnService.userLoggedIn&&BFN.FavoritesManager.handleFavoritesLoaded("effect",t)},watermarks:()=>{BFN.BfnService.userIsPlus&&BFN.WatermarkManager.loadWatermarkPresets(t)},texture_fav:()=>{},batch_processing_fav:()=>{BFN.BatchToolManager.selectedIDs=t},fonts_fav:()=>{BFN.FontManager.fontMenuComponent?BFN.FontManager.fontMenuComponent.setState({favorites:t}):BFN.FontManager.favorites=t},fonts_added:()=>{if(BFN.BfnService.userIsPlus){var e=t.map(e=>{return e.name}).unique(),i=t.filter(e=>{return"google"===e.type}),r=t.filter(e=>{return"uploaded"===e.type});i.forEach(e=>{var t=e.name,i=e.weights;BFN.FontManager.addUserDefinedFontFromSettings(t,"google",{weights:i,updateIfDuplicate:!0})}),r.reduce((e,t)=>{var i=t.name,r=t.weight,a=t.fileName,n=e.find(e=>e.name===i);if(n)return n.weights=[...n.weights,r],n.files=[...n.files,{weight:r,fileName:a}],e;var o=new f(i,"uploaded",[r],{isUserDefined:!0,files:[{weight:r,fileName:a}]});return[...e,o]},[]).forEach(e=>{var t=e.name,i=e.weights,r=e.files;BFN.FontManager.addUserDefinedFontFromSettings(t,"uploaded",{weights:i,files:r,updateIfDuplicate:!0})}),BFN.CONST.FONT_LIST.filter(t=>{var i=t.isUserDefined,r=t.type,a=t.name;return i&&"system"!==r&&!e.includes(a)}).forEach(e=>{var t=e.name;BFN.FontManager.removeUserDefinedFont(t)})}},use_case:()=>{},snapping:()=>{UITools.setControlValue("alignment_".concat(e),"yes"===t?"enabled":"disabled",!1),UITools.updateToolControl("alignment_".concat(e)),UITools.applyToolControl("alignment_".concat(e))},display_distances:()=>{UITools.setControlValue("alignment_".concat(e),"yes"===t?"enabled":"disabled",!1),UITools.updateToolControl("alignment_".concat(e)),UITools.applyToolControl("alignment_".concat(e))},guides:()=>{UITools.setControlValue("alignment_".concat(e),"yes"===t?"enabled":"disabled",!1),UITools.updateToolControl("alignment_".concat(e)),UITools.applyToolControl("alignment_".concat(e))},dismissed_messages:()=>{},trialing:()=>{}};return this.uiReady?i[e]():"fonts_added"===e?i[e]():void(this.queuedUiUpdates[e]=(()=>i[e]()))}persistSettings(){if(!this.allowLocalSaving)return this.persistSettings();var e=this.diffSettings(this.localSettings,this.nonLocalSettings);Object.keys(e).length&&Object.entries(e).forEach(e=>{var i=t(e,2),r=i[0],a=i[1];BFN.IndexedDB.set("options__".concat(r),a).then(()=>{this.localSettings[r]=a},e=>BeFunky.logError("Unable to update local setting ".concat(r),e))});var i=this.allowRemoteSaving?[]:Object.keys(this._settings).filter(e=>"language"!==e),r=this.diffSettings(this.remoteSettings,i);Object.keys(r).length&&BeFunky.SettingsService.updateUserSettings(r,e=>{var t=e.error;e.success;if(t)return BeFunky.logError("Unable to update remote settings",t);this.remoteSettings=Object.assign(this.remoteSettings,r)})}diffSettings(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r={};return Object.entries(this._settings).forEach(a=>{var n=t(a,2),o=n[0],s=n[1];i.includes(o)||(e.hasOwnProperty(o)||!Array.isArray(s)||s.length)&&JSON.stringify(e[o])!==JSON.stringify(s)&&(r[o]=s)}),r}fetchRemoteSettings(){return new Promise(e=>{BeFunky.SettingsService.getUserSettings(t=>{var i=t.error,r=t.settings;if(i)return BeFunky.logError("Unable to get settings from DynamoDB",i),e();this.remoteSettings=Object.assign({},r),this.allowRemoteSaving=!0,e()})})}}BFN.SingletonQueue.add(()=>{BFN.SettingsManager=new Sm});var Cm=BeFunky.lit.appLang,Bm={portrait_enhancer:[{type:"header",langID:"portrait_enhancer_announcement_clue_header"},{type:"text",langID:"portrait_enhancer_clue_body_1"},{type:"text",langID:"portrait_enhancer_clue_body_2"},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.siteUrl,"learn/ai-portrait-enhancer/")}],image_enhancer:[{type:"header",langID:"image_enhancer_clue_headline"},{type:"text",langID:"image_enhancer_clue_body"},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.siteUrl,"learn/ai-image-enhancer/")}],choose_font:[{type:"header",langID:"font_clue_title"},{type:"text",langID:"font_clue_choose_body"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360001571631-How-Do-I-Add-My-Fonts-To-BeFunky-"}],manage_font:[{type:"header",langID:"font_clue_title"},{type:"text",langID:"font_clue_manage_body"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360001571631-How-Do-I-Add-My-Fonts-To-BeFunky-"}],template_library:[{type:"text",langID:"guide_template_library"}],global_history:[{type:"text",langID:"guide_global_history"}],image_manager:[{type:"text",langID:"guide_image_manager"}],template_search:[{type:"header",langID:"guide_template_search_1"},{type:"text",langID:"guide_template_search_2"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360034833692"}],basic_shapes:[{type:"header",langID:"guide_basic_shapes_1"},{type:"text",langID:"guide_basic_shapes_2"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360034831012"}],clone:[{type:"text",langID:"guide_clone"}],effect_basic_settings:[{type:"icon_text",iconID:"guide-setting-icon",iconSize:"16px",langID:"guide_icon_settings",iconColor:"#FFFFFF"},{type:"icon_text",iconID:"guide-cancel-icon",iconSize:"12px",langID:"guide_icon_cancel",iconColor:"#D0021B"},{type:"icon_text",iconID:"guide-apply-icon",iconSize:"14px",langID:"guide_icon_checkmark",iconColor:"#44B854"},{type:"icon_text",iconID:"guide-slider-icon",langID:"guide_icon_slider",iconColor:"#387DCD"},{type:"icon_text",iconID:"upgrade-star",langID:"guide_icon_premium",iconColor:"#FF8E00",hideIfPremium:!0},{type:"link",langID:"guide_icon_premium_link",url:"http://support.befunky.com/hc/en-us/articles/203840999-How-do-I-upgrade-to-BeFunky-Plus-",hideIfPremium:!0}],effect_basic_settings_frames:[{type:"icon_text",iconID:"guide-setting-icon",iconSize:"16px",langID:"guide_icon_settings",iconColor:"#FFFFFF"},{type:"icon_text",iconID:"guide-cancel-icon",iconSize:"12px",langID:"guide_icon_cancel",iconColor:"#D0021B"},{type:"icon_text",iconID:"guide-apply-icon",iconSize:"14px",langID:"guide_icon_checkmark",iconColor:"#44B854"},{type:"icon_text",iconID:"guide-slider-icon",langID:"guide_icon_slider_frames",iconColor:"#387DCD"},{type:"icon_text",iconID:"upgrade-star",langID:"guide_icon_premium",iconColor:"#FF8E00",hideIfPremium:!0},{type:"link",langID:"guide_icon_premium_link",url:"http://support.befunky.com/hc/en-us/articles/203840999-How-do-I-upgrade-to-BeFunky-Plus-",hideIfPremium:!0}],effect_basic_settings_favorites:[{type:"icon_text",iconID:"guide-favorite-icon",iconSize:"16px",langID:"guide_icon_favorite",iconColor:"#FF8E00"},{type:"icon_text",iconID:"guide-setting-icon",iconSize:"16px",langID:"guide_icon_settings",iconColor:"#FFFFFF"},{type:"icon_text",iconID:"guide-cancel-icon",iconSize:"12px",langID:"guide_icon_cancel",iconColor:"#D0021B"},{type:"icon_text",iconID:"guide-apply-icon",iconSize:"14px",langID:"guide_icon_checkmark",iconColor:"#44B854"},{type:"icon_text",iconID:"guide-slider-icon",langID:"guide_icon_slider",iconColor:"#387DCD"},{type:"icon_text",iconID:"upgrade-star",langID:"guide_icon_premium",iconColor:"#FF8E00",hideIfPremium:!0},{type:"link",langID:"guide_icon_premium_link",url:"http://support.befunky.com/hc/en-us/articles/203840999-How-do-I-upgrade-to-BeFunky-Plus-",hideIfPremium:!0}],effect_lens_flare:[{type:"icon_text",iconID:"guide-target-icon",iconSize:"16px",langID:"guide_icon_lens_flare_controls"},{type:"link",langID:"tutorial_link",url:"".concat(BeFunky.Params.blogUrl,"lens-flare/"),linkTracking:"CREATE|HELP|LENS_FLARE"},{type:"spacer",spaceHeight:1,color:"#464F61",alpha:1},{type:"icon_text",iconID:"guide-setting-icon",iconSize:"16px",langID:"guide_icon_settings",iconColor:"#FFFFFF"},{type:"icon_text",iconID:"guide-cancel-icon",iconSize:"12px",langID:"guide_icon_cancel",iconColor:"#D0021B"},{type:"icon_text",iconID:"guide-apply-icon",iconSize:"14px",langID:"guide_icon_checkmark",iconColor:"#44B854"},{type:"icon_text",iconID:"guide-slider-icon",langID:"guide_icon_slider",iconColor:"#387DCD"},{type:"icon_text",iconID:"upgrade-star",langID:"guide_icon_premium",iconColor:"#FF8E00",hideIfPremium:!0},{type:"link",langID:"guide_icon_premium_link",url:"http://support.befunky.com/hc/en-us/articles/203840999-How-do-I-upgrade-to-BeFunky-Plus-",hideIfPremium:!0}],erase_mode:[{type:"text",langID:"erase_clue_description"},{type:"text",langID:["erase_clue_isolate_subject",{isolate_subject:()=>"<strong>".concat(Cm("isolate_subject",!0),"</strong>")}]},{type:"icon_text",iconID:"global-reverse-icon",iconSize:"16px",iconColor:"#FFFFFF",langID:"guide_icon_invert"},{type:"icon_text",iconID:"edit-menu-vignette-icon",iconSize:"16px",iconColor:"#FFFFFF",langID:"guide_icon_mask"},{type:"text",langID:["erase_clue_remove_keep",{keep:()=>"<strong>".concat(Cm("keep",!0),"</strong>"),remove:()=>"<strong>".concat(Cm("remove",!0),"</strong>")}]},{type:"text",langID:"guide_paint_mode_zoomed_in"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360042227431"}],erase_mode_background:[{type:"text",langID:"erase_clue_description"},{type:"text",langID:["erase_clue_isolate_subject_background",{isolate_subject:()=>"<strong>".concat(Cm("isolate_subject",!0),"</strong>")}]},{type:"icon_text",iconID:"global-reverse-icon",iconSize:"16px",iconColor:"#FFFFFF",langID:"guide_icon_invert"},{type:"icon_text",iconID:"edit-menu-vignette-icon",iconSize:"16px",iconColor:"#FFFFFF",langID:"guide_icon_mask"},{type:"text",langID:["erase_clue_remove_keep",{keep:()=>"<strong>".concat(Cm("keep",!0),"</strong>"),remove:()=>"<strong>".concat(Cm("remove",!0),"</strong>")}]},{type:"text",langID:"guide_paint_mode_zoomed_in"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360041749552"}],collage_layouts:[{type:"text",langID:"guide_collage_layout_1"},{type:"text",langID:"guide_collage_layout_2"},{type:"text",langID:"guide_collage_layout_3"}],collage_wizard:[{type:"text",langID:"guide_collage_wizard_next"}],layers_groups:[{type:"text",langID:"guide_layers_groups"},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.blogUrl,"layers-and-groups/")}],resize_template:[{type:"header",langID:"guide_resize_template_1"},{type:"text",langID:"guide_resize_template_2"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360034937232"}],alignment_options:[{type:"text",langID:"guide_alignment_options"},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.blogUrl,"snap-lines/")}],cutout:[{type:"header",langID:["cutout_clue_title",{"new!":BeFunky.LanguageManager.getString("new!")}]},{type:"text",langID:["cutout_clue_remove_background",{remove_background:()=>"<strong>".concat(Cm("remove_background",!0),"</strong>")}]},{type:"icon_text",iconID:"global-reverse-icon",iconSize:"16px",iconColor:"#FFFFFF",langID:"guide_icon_invert"},{type:"icon_text",iconID:"edit-menu-vignette-icon",iconSize:"16px",iconColor:"#FFFFFF",langID:"guide_icon_mask"},{type:"text",langID:["cutout_clue_remove_keep",{keep:()=>"<strong>".concat(Cm("keep",!0),"</strong>"),remove:()=>"<strong>".concat(Cm("remove",!0),"</strong>")}]},{type:"text",langID:["cutout_clue_background_color",{background_color:()=>"<strong>".concat(Cm("background_color",!0),"</strong>")}]},{type:"text",langID:"guide_paint_mode_zoomed_in"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360041749552"}],batch_processing:[{type:"text",langID:"guide_batch_upload_steps"},{type:"text",langID:["guide_batch_edit_steps",{icon:BeFunky.getSvgHtml("batch-icon-white-14",{classes:"icon icon-size-medium"})}]},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.blogUrl,"batch-processing-photos/")}],batch_upload:[{type:"header",langID:"guide_batch_upload"},{type:"text",langID:"guide_batch_upload_steps"}],batch_edit:[{type:"header",langID:"guide_batch_edit"},{type:"text",langID:["guide_batch_edit_steps",{icon:BeFunky.getSvgHtml("batch-icon-white-14",{classes:"icon icon-size-medium"})}]}],batch_icon:[{type:"text",langID:["batch_icon_guide_1",{icon:BeFunky.getSvgHtml("batch-icon-white-14",{classes:"icon icon-size-medium"})}]},{type:"text",langID:"batch_icon_guide_2"}]},Fm={};function Em(){var t=e(['\n        <div class="help-clue" style="width: 350px">\n            ','\n            <div class="help-clue__footer">\n                ',"\n            </div>\n        </div>\n        "]);return Em=function(){return t},t}function Pm(){var t=e(["<button @click=",' class="help-clue__dismiss button button--link">',"</button>"]);return Pm=function(){return t},t}function Nm(){var t=e(['\n            <p class="help-clue__item help-clue__icon-text">\n                ',"\n                <string>","</string>\n            </p>"]);return Nm=function(){return t},t}function Mm(){var t=e(['\n            <p class="help-clue__item">\n                <a class="help-clue__link" href=',' target="_blank" rel="noopener" data-bfntrack=',">","</a>\n            </p>"]);return Mm=function(){return t},t}function Dm(){var t=e(['<p class="help-clue__item">',"</p>"]);return Dm=function(){return t},t}function wm(){var t=e(['<h5 class="help-clue__item help-clue__header">',"</h5>"]);return wm=function(){return t},t}function km(){var t=e(['<div class="popover"></div>']);return km=function(){return t},t}Object.keys(Bm).forEach(e=>{Fm[e]={content:Bm[e],visibility:"HIDDEN",popover:null,renderContent:()=>{BeFunky.throwError("Help clue popover not set up yet")}}});var Lm=BeFunky.lit,Om=Lm.elem,Rm=Lm.html,Am=Lm.appLang,Vm=Lm.render,Um=Lm.icon;class Gm{constructor(){this.init()}init(){this.clueIDs=Object.keys(Fm),this.cluesIDsDismissedThisSession=[],this.hasMigratedFromLocalStorage=!1}setup(e,t){return this._setRenderOptions(e,t)}show(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.force,r=void 0!==i&&i,a=t.renderOptions;if(!this._setRenderOptions(e,a))return Promise.resolve(!1);if(r)return this._renderAndFadeIn(e),Promise.resolve(!0);var n=Fm[e];return n.visibility="PENDING",this.wasClueDismissed(e).then(t=>"PENDING"!==n.visibility?"VISIBLE"===n.visibility:t?(n.visibility="HIDDEN",!1):(this._renderAndFadeIn(e),!0))}hide(e){if(this._validateID(e)){var t=Fm[e];t.visibility="HIDDEN",t.popover&&t.popover.hide()}}toggle(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.renderOptions,a=i.force,n=void 0===a||a;if(!this._setRenderOptions(e,r))return Promise.resolve(!1);"boolean"!=typeof t&&(t="HIDDEN"===Fm[e].visibility),t?this.show(e,{force:n}):this.hide(e)}wasClueDismissed(e){return this._validateID(e)?this.cluesIDsDismissedThisSession.includes(e)?Promise.resolve(!0):this._getDismissedIDs().then(t=>Boolean(t.find(t=>t==="".concat(e,"_clue")))):Promise.resolve(!1)}showWalkthrough(e){e.some(e=>!this._validateID(e)),e.every(e=>Fm[e].renderOptions)||BeFunky.throwError("Walkthrough clues not setup"),this._getDismissedIDs().then(t=>!e.every(e=>t.includes("".concat(e,"_clue")))&&(e.slice(0,e.length-1).forEach((t,i)=>{Fm[t].renderOptions.button={langID:"next",onClick:()=>this.show(e[i+1],{force:!0})}}),e.slice(1).forEach(e=>{this.hide(e)}),this.show(e[0],{force:!0}),!0))}_validateID(e){return!!this.clueIDs.includes(e)||(BeFunky.throwError('Invalid help clue ID "'.concat(e,'"')),!1)}_setRenderOptions(e,t){return!!this._validateID(e)&&(t?Fm[e].renderOptions=t:t=Fm[e].renderOptions,t?"function"==typeof t.container||t.container instanceof HTMLElement||(BeFunky.throwError('No container for help clue "'.concat(e,'"'),t.container),!1):(BeFunky.throwError('No render options for help clue "'.concat(e,'"')),!1))}_getDismissedIDs(){return BFN.SettingsManager.getSetting("dismissed_messages").then(e=>this._migrateClueDataFromLocalStorage(e))}_dismissClue(e){if(this._validateID(e)){this.hide(e),this.cluesIDsDismissedThisSession.push(e);var t="".concat(e,"_clue");this._getDismissedIDs().then(e=>{e.includes(t)||BFN.SettingsManager.updateSetting("dismissed_messages",[...e,t])})}}_renderAndFadeIn(e){var i=Fm[e],r=i.renderOptions;i.popover?i.renderContent():(i.popover=this._createPopover(e),i.popover.strong=!0);var a=["left","right","top","zIndex"],n=["side","positionFactor","strong"];Object.entries(r).forEach(r=>{var o=t(r,2),s=o[0],l=o[1];if(a.includes(s))i.popover.setStyles({[s]:l});else if(n.includes(s))i.popover[s]!==l&&(i.popover[s]=l);else if("container"===s){var h=i.popover.parentElement;"function"==typeof l&&(l=l()),l instanceof HTMLElement?h!==l&&l.appendChild(i.popover):BeFunky.throwError('Invalid container for help clue "'.concat(e,'"'),l)}else"button"!==s&&BeFunky.throwError('Unknown help clue render option "'.concat(s,'"'))}),i.visibility="VISIBLE",requestAnimationFrame(()=>{"VISIBLE"===i.visibility&&i.popover.show(!0)})}_createPopover(e){var t=Om(km());return BFN.UI.popover(t),this._addContent(e,t.container),t}_addContent(e,t){var i=Fm[e],r=i.content,a=i.renderOptions,n={header:e=>{var t=e.langID;return Rm(wm(),Am(t))},text:e=>{var t=e.langID;return Rm(Dm(),Am(t))},link:e=>{var t=e.langID,i=e.url,r=e.linkTracking,a=void 0===r?"":r;return Rm(Mm(),i,a,Am(t))},icon_text:e=>{var t=e.langID,i=e.iconID,r=e.iconHeight,a=e.iconColor,n=void 0===a?"#fff":a;return Rm(Nm(),Um(i,"icon help-clue__icon",{style:"".concat(r?"height: ".concat(r,";"):""," color: ").concat(n)}),Am(t))}},o=e=>e.hideIfPremium&&BeFunky.isPlus()?"":n[e.type]?n[e.type](e):"",s=()=>{var t=a.button&&a.button.langID?a.button.langID:"ok_got_it";return Rm(Pm(),()=>{a.button&&a.button.onClick&&a.button.onClick(),this._dismissClue(e)},Am(t))},l=()=>Vm((()=>Rm(Em(),r.map(o),s()))(),t);BeFunky.LanguageManager.addLanguageUpdateListener(l),r.find(e=>e.hideIfPremium)&&BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,l),l(),i.renderContent=l}_migrateClueDataFromLocalStorage(e){if(this.hasMigratedFromLocalStorage)return e;if(this.hasMigratedFromLocalStorage=!0,e.find(e=>e.endsWith("_clue")))return e;var i=[];try{i=Object.keys(localStorage)}catch(e){}var r=i.filter(e=>e.startsWith("guide_")).map(e=>{BeFunky.removeLocal(e);var t=e.replace("guide_","");return!!this.clueIDs.includes(t)&&t}).filter(Boolean);return Object.entries({walkthrough_batch_processing:["batch_upload","batch_edit"],walkthrough_batch_icon:["batch_icon"]}).forEach(e=>{var a=t(e,2),n=a[0],o=a[1];i.includes(n)&&(BeFunky.removeLocal(n),r.push(...o))}),i.includes("disableTips")&&BeFunky.removeLocal("disableTips"),console.log("Migrated ".concat(r.length," clues from LocalStorage"),r),r.length&&(e=[...e,...r.map(e=>"".concat(e,"_clue"))].unique(),BFN.SettingsManager.updateSetting("dismissed_messages",e)),e}}BFN.SingletonQueue.add(()=>{BFN.HelpClueManager=new Gm});class Hm extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.zoomKeyCodes=[70,48,BeFunky.isFirefox?61:187,BeFunky.isFirefox?173:189],this.editorOverrideKeyCodes=[66,79],this.keyActionPerformed=!1,this.handleDocumentKeyDownBind=this.handleDocumentKeyDown.bind(this),this.handleDocumentKeyUpBind=this.handleDocumentKeyUp.bind(this),document.addEventListener("keydown",this.handleDocumentKeyDownBind,!0),window.addEventListener("INIT_COMPLETE",()=>{BFN.MainUI.addIdleRenderFunction(()=>this.addShortcutsToUI())})}processZoomKey(e){if(!(BFN.ImageCutout.cutoutActive||BFN.ImagePainterUndoManager&&BFN.ImagePainterUndoManager.currentImagePainter&&BFN.ImagePainterUndoManager.currentImagePainter.mouseDown))switch(e){case 70:UITools.setToolValue("zoom","full_screen",!0,!1),UITools.applyTool("zoom"),UITools.setToolValue("zoom","full_screen",!1,!1);break;case 48:UITools.setToolValue("zoom","exact_fit",!0),UITools.applyTool("zoom"),UITools.setToolValue("zoom","exact_fit",!1),UITools.applyToolControl("zoom_minus");break;case 187:case 61:UITools.setControlValue("zoom_plus",!0,!0),UITools.applyToolControl("zoom_plus"),UITools.setControlValue("zoom_plus",!1,!1),UITools.applyToolControl("zoom_minus");break;case 189:case 173:UITools.setControlValue("zoom_minus",!0,!0),UITools.applyToolControl("zoom_minus"),UITools.setControlValue("zoom_minus",!1,!1),UITools.applyToolControl("zoom_minus")}}processSaveKey(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;"computer"!==e&&"project"!==e||(this.exitTransformToolFrameIfActive(),UITools.setToolValue("editor_save_image",e,!0,!1),UITools.applyTool("editor_save_image"),UITools.setToolValue("editor_save_image",e,!1,!1))}processOpenKey(){UITools.setToolValue("open_project","computer",!0,!1),UITools.applyTool("open_project"),UITools.setToolValue("open_project","computer",!1,!1)}processUndoRedo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;"undo"!==e&&"redo"!==e||(UITools.setToolValue("editor_history_action",e,!0),UITools.applyTool("editor_history_action"),UITools.setToolValue("editor_history_action",e,!1))}processSelectAll(){this.exitTransformToolFrameIfActive();var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer),t=[...e.children];if(t.includes(BFN.TransformItemGroup)&&t.splice(t.indexOf(BFN.TransformItemGroup),1),t.length>1)e.children.includes(BFN.TransformItemGroup)||(BFN.TransformItemGroup.transformLayer=e,e.addChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.canvasScale=e.canvasScale,BFN.TransformItemGroup.addGroupItems(t),e.updateTransformItemGroup();else if(1===t.length){var i=t[0];i.selectedByMouse=!1,i.selectItem()}}showBatchProcessor(){this.exitTransformToolFrameIfActive(),BFN.BatchProcessingManager.openModal()}processGroupItems(){if(this.exitTransformToolFrameIfActive(),BFN.TransformItemGroup.selectedItems.length){var e="transform_create_group";UITools.setControlValue(e,!0),UITools.applyToolControl(e),UITools.setControlValue(e,!1)}}exitTransformToolFrameIfActive(){return!(!BFN.TransformModel.transformToolFrame||!BFN.TransformModel.transformToolFrame.active)&&(BFN.TransformModel.transformToolFrame.setup(null),!0)}addShortcutsToUI(){var e=e=>this.shortcutString(this.shortcutText(e));document.getElementById("open_project_computer").appendChild(e("O")),document.getElementById("editor_save_image_computer").appendChild(e("S")),document.getElementById("editor_save_image_project").appendChild(e("⇧S"))}getShortcutTooltip(e){var t=e=>BeFunky.LanguageManager.getString(e),i=e=>this.shortcutString(this.shortcutText(e)),r={undo:"".concat(t("undo")," ").concat(i("Z").outerHTML),redo:"".concat(t("redo")," ").concat(i("⇧Z").outerHTML),batch:"".concat(t("batch_processing")," ").concat(i("B").outerHTML),fullscreen:"".concat(t("fullscreen")," ").concat(i("F").outerHTML)}[e];return r||(BeFunky.throwError("Invalid shortcut tooltip",e),"")}handleDocumentKeyDown(e){if(window.isFlashOpenned){var t=!0;t=(t=(t=(t=(t=(t=(t=t&&(BFN.AppModel.viewingEditor&&(BFN.PhotoEditorModel.currentTexture||this.editorOverrideKeyCodes.includes(e.keyCode))||BFN.AppModel.viewingCollage||BFN.AppModel.viewingDesigner))&&!BeFunky.isModalOpen())&&!BeFunky.isLoadScreenActive())&&!BFN.FabricManager.iTextEditing)&&!this.keyActionPerformed)&&!BFN.isSortableListDragActive)&&!BeFunky.isPointerDown;var i=[];if(BFN.TransformItemIsolator.active&&i.push(83,65,66,71,67,79,13),t=t&&!i.includes(e.keyCode),e.ctrlKey||e.metaKey||[13].includes(e.keyCode)){var r=!1;if(this.zoomKeyCodes.includes(e.keyCode)&&(r=!0,t&&this.processZoomKey(e.keyCode)),83===e.keyCode&&(r=!0,t&&this.processSaveKey(e.shiftKey?"project":"computer")),79===e.keyCode&&(r=!0,t&&this.processOpenKey()),90===e.keyCode&&(BFN.FabricManager.iTextEditing||(r=!0,t&&this.processUndoRedo(e.shiftKey?"redo":"undo"))),65===e.keyCode&&(BeFunky.isTextBoxFocused()||(r=!0,t&&this.processSelectAll())),66===e.keyCode&&(r=!0,t&&this.showBatchProcessor()),71===e.keyCode&&(r=!0,t&&this.processGroupItems()),BFN.TransformModel.transformToolFrame&&!BeFunky.isTextBoxFocused())switch(e.keyCode){case 13:r=this.exitTransformToolFrameIfActive()}r&&(e.preventDefault(),t&&(this.keyActionPerformed=!0,setTimeout(()=>{this.keyActionPerformed=!1},80)))}}}handleDocumentKeyUp(e){}shortcutText(e){return[BeFunky.isMac?"⌘":"Ctrl",...e.split("")].join(BeFunky.isMac?" ":"".concat(" ","+").concat(" "))}shortcutString(e){var t=document.createElement("string");return t.className="shortcut",BeFunky.isMac||t.setStyles({letterSpacing:"-0.5px"}),t.textContent=e,t}}BFN.SingletonQueue.add(()=>{BFN.KeyboardManager=new Hm});class zm{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.resetValues(),this.handlePointerMoveBind=this.handlePointerMove.bind(this),this.handlePointerUpBind=this.handlePointerUp.bind(this)}initiateLongPress(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];BeFunky.isPointerDown&&!this.longPressPending&&BeFunky.globalPointerEvent&&(r&&"touch"!=BeFunky.globalPointerEvent.pointerType||(this.longPressPending=!0,this.longPressEvent=BeFunky.globalPointerEvent,this.longPressCallback=e,this.longPressPixelThreshold=t,this.longPressDuration=i,this.longPressEndTime=performance.now()+this.longPressDuration,document.addEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUpBind,!0),this.longPressTimer()))}longPressTimer(){this.longPressPending&&(performance.now()>this.longPressEndTime?(this.longPressCallback&&this.longPressCallback(this.longPressEvent),this.handlePointerUpBind()):requestAnimationFrame(this.longPressTimer.bind(this)))}resetValues(){this.longPressPending=!1,this.longPressEvent=null,this.longPressCallback=null,this.longPressPixelThreshold=null,this.longPressDuration=null,this.longPressEndTime=null}handlePointerMove(e){var t=this.longPressEvent.pageX-e.pageX,i=this.longPressEvent.pageY-e.pageY,r=Math.sqrt(Math.pow(t,2)+Math.pow(i,2));this.longPressEndTime=performance.now()+this.longPressDuration,r>=this.longPressPixelThreshold&&this.handlePointerUpBind()}handlePointerUp(e){this.resetValues(),document.removeEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpBind,!0)}}BFN.SingletonQueue.add(function(){BFN.LongPressManager=new zm}),BFN.GroupManagerEvents={GROUPS_UPDATED:new Event("GROUPS_UPDATED")};class Xm extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.sections=["editor","collage","designer"],this.groupData={},this.sections.forEach(e=>{this.groupData[e]=[]}),this.modal=document.getElementById("create_group_modal"),BFN.UI.createGroupModal(this.modal,e=>{UILayers.switchToGroupsTab(),BFN.TransformItemGroup.createGroup(e)}),this.dispatchGroupsUpdated=BeFunky.debounce(this.dispatchGroupsUpdated,50)}createGroup(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&t.length>1){var r=this.sections.includes(i)?i:BFN.AppModel.sectionID,a=new BFN.TransformItemGroupVO;a.id="item_group_".concat(BeFunky.randomString(10)),a.name=e,t.forEach(e=>{e.projectItemVO&&e.projectItemVO.itemID&&a.itemIDs.push(e.projectItemVO.itemID)}),a.itemIDs.length>1&&this.addGroup(r,a,!0)}}addGroup(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.sections.includes(e)?e:BFN.AppModel.sectionID;(t&&(this.groupData[r].push(t),this.setGroupVOName(t,t.name)),i)&&(this.getSectionValue(r,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated())}addGroups(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.sections.includes(e)?e:BFN.AppModel.sectionID;(t.forEach(e=>{this.addGroup(r,e)}),i)&&(this.getSectionValue(r,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated())}clearGroups(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.sections.includes(e)?e:BFN.AppModel.sectionID;(this.groupData[i].splice(0),t)&&(this.getSectionValue(i,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated())}deleteGroup(e){for(var t=null,i=this.sections.length;--i>-1;){for(var r=this.sections[i],a=this.groupData[r].length;--a>-1;){var n=this.groupData[r][a];if(n.id==e){n.itemIDs.splice(0),this.groupData[r].splice(a,1),t=r;break}}if(t)break}t&&(this.getSectionValue(t,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated())}selectGroupsByName(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){var t=BFN.AppModel.sectionID,i=this.groupData[t],r=[];i.forEach(t=>{e.includes(t.name)&&!r.includes(t.id)&&r.push(t.id)}),this.selectGroups(r)}}selectGroups(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length){var r=BFN.AppModel.sectionID,a=this.groupData[r];if(a.length){var n=[...BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children];n.includes(BFN.TransformItemGroup)&&n.splice(n.indexOf(BFN.TransformItemGroup),1);var o=[],s=[];if(n.forEach(e=>{e.projectItemVO&&e.projectItemVO.itemID&&(o.push(e),s.push(e.projectItemVO.itemID))}),o.length){var l=[];a.forEach(t=>{e.includes(t.id)&&t.itemIDs.forEach(e=>{if(s.includes(e)){var t=o[s.indexOf(e)];l.includes(t)||l.push(t)}})}),i&&BFN.TransformItemGroup.selectedItems.length&&BFN.TransformItemGroup.selectedItems.forEach(e=>{l.includes(e)||l.push(e)}),this.selectItems(l,t)}return[...BFN.TransformItemGroup.selectedItems]}}}selectItems(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer);if(e.length>1)i.children.includes(BFN.TransformItemGroup)||(BFN.TransformItemGroup.transformLayer=i,i.addChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.canvasScale=i.canvasScale,BFN.TransformItemGroup.updateSelectedItems(e,t),i.updateTransformItemGroup();else if(i.resetTransformItemGroup(),1===e.length){var r=e[0];r.selectedByMouse=!1,r.selectItem(),r.transformLayer.lastPressedItem=r,r.transformLayer.lastSelectedItem=r}return[...BFN.TransformItemGroup.selectedItems]}renameGroup(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&t){var r=this.getAllGroups(),a=null;if(r.forEach(t=>{t.id==e&&(a=t)}),a&&a.name!=t){this.setGroupVOName(a,t);var n=this.sections.includes(i)?i:BFN.AppModel.sectionID;return this.getSectionValue(n,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),a.name}}return null}setGroupVOName(e,t){var i=null;if(this.sections.forEach(t=>{this.groupData[t].forEach(r=>{r==e&&(i=t)})}),i){var r=[];if(this.groupData[i].forEach(t=>{t!=e&&r.push(t.name)}),r.includes(t))for(var a=0;++a;){var n="".concat(t," (").concat(a,")");if(!r.includes(n)){e.name=n;break}}else e.name=t}else e.name=t}addItemsToGroup(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!1;if(this.getAllGroups().forEach(i=>{i.id==e&&t.forEach(e=>{i.itemIDs.includes(e)||(i.itemIDs.push(e),r=!0)})}),r){var a=this.sections.includes(i)?i:BFN.AppModel.sectionID;this.getSectionValue(a,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated()}}removeItemsFromGroup(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!1;if(this.getAllGroups().forEach(i=>{if(i.id==e)for(var a=i.itemIDs.length;--a>-1;){var n=i.itemIDs[a];t.includes(n)&&(i.itemIDs.splice(a,1),r=!0)}}),r){var a=this.sections.includes(i)?i:BFN.AppModel.sectionID;this.getSectionValue(a,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated()}}getSectionGroupVOs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.sections.includes(e)?e:BFN.AppModel.sectionID;return[...this.groupData[t]]}getSectionGroupObjects(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.sections.includes(i)?i:BFN.AppModel.sectionID;r&&(e=this.getSectionValue(a,BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer),t=[],e.children.forEach(e=>{e instanceof BFN.TransformItem&&t.push(e.itemID)}));var n=[];return this.groupData[a].forEach(e=>{var i={};Object.assign(i,e),r?(i.itemIDs=[],e.itemIDs.forEach(e=>{t.includes(e)&&i.itemIDs.push(e)})):i.itemIDs=[...e.itemIDs],n.push(i)}),n}getGroupIDs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.sections.includes(e)?e:BFN.AppModel.sectionID,i=[];return this.groupData[t].forEach(e=>{var t=e.id;i.push(t)}),i}getAllGroups(){var e=[];for(var t in this.groupData){this.groupData[t].forEach(t=>{e.push(t)})}return e}getGroupVOsFromItemIDs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[];return this.getAllGroups().forEach(i=>{i.itemIDs.forEach(r=>{e.includes(r)&&!t.includes(i)&&t.push(i)})}),t}getCommonGroupVOsFromItemIDs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.getGroupVOsFromItemIDs(e),i=[];e.forEach(e=>{var r=this.getGroupVOsFromItemIDs([e]);t.forEach(e=>{r.includes(e)||i.includes(e)||i.push(e)})});for(var r=t.length;--r>-1;){var a=t[r];i.includes(a)&&t.splice(r,1)}return t}getSectionValue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;switch(e){case"editor":return t;case"collage":return i;case"designer":return r}return null}dispatchGroupsUpdated(){this.dispatchEvent(BFN.GroupManagerEvents.GROUPS_UPDATED)}}BFN.SingletonQueue.add(()=>{BFN.GroupManager=new Xm});class jm{constructor(){this.init()}init(){this.initDefaultValues(),this.initContextMenu()}initDefaultValues(){this.batchMode=null,this.batchSection=null,this.resizeMode="none",this.effectAmount=100,this.effectFadeable=!1,this.backgroundUpdateAllowed=!1,this.cropRatio=1,this.cropOrientation="landscape",this.saveData=[],this.itemSize=320,this.cropMinSize=40,this.processedImageItems=[],this.newlyProcessedImageItems=[],this.visibleImageItems=[],this.hiddenImageItems=[],this.processingVisibleImageItems=!1,this.queuedBatchImageVOs=null,this.queuedImageItems=[],this.queuedImageItemsNum=0,this.effectTexture=null,this.effectID=null,this.effectParams=null,this.savePrefix="",this.saveSuffix="",this.defaultImageType="jpg",this.defaultImageQuality=98,this.maxImageQuality=99,this.imageType=this.defaultImageType,this.imageQuality=this.defaultImageQuality,this.handleImageItemPressedBind=this.handleImageItemPressed.bind(this),this.handleDocumentMouseDownCropBind=this.handleDocumentMouseDownCrop.bind(this),this.handleDocumentMouseMoveCropBind=this.handleDocumentMouseMoveCrop.bind(this),this.handleDocumentMouseUpCropBind=this.handleDocumentMouseUpCrop.bind(this),this.modal=document.getElementById("batch_processing"),this.zipLoader=null,BeFunky.onFreeTrialEnabledChange(e=>{var t=document.getElementById("batch_processing_upgrade");t&&t.querySelector("string").setLang(e?"start_trial":"upgrade")})}initContextMenu(){this.contextMenu=document.getElementById("context_menu_batch_processing_image_item"),BeFunky.contextMenu(this.contextMenu,{remove_image:{onClick:()=>{this.rightClickItemAction("remove"),this.contextMenu.hide()}},reset_frame:{onClick:()=>{this.rightClickItemAction("reset"),this.contextMenu.hide()}}}),this.contextMenu.enabled=!0,this.contextMenu.addEventListener("HIDE",()=>{this.rightClickItem=null})}handleBatchProcessing(){var e=UITools.getToolVO("batch_processing");if("open_modal"!==e.updating_id){if(this.batchSection!==e.section)this.batchSection=e.section,this.modal.getImageItems().forEach(e=>{100!==this.effectAmount&&e.setImageOverlayOpacity(100),e.setImageOverlaySRC(null),this.batchSection||e.toggleImageOverlayVeil(!1,!1)}),this.effectAmount=100,this.setBatchSection(this.batchSection);if(this.backgroundUpdateAllowed&&this.backgroundColor!==e.background_color&&this.setBackgroundColor(e.background_color),!1!==e[e.updating_id])switch(e.updating_id){case"manage_tools":this.showPopover("batch_processing_manage_tools_popover");break;case"cancel":UITools.setToolValue("batch_processing","section",null,!1),UITools.applyTool("batch_processing");break;case"apply":this.processImages(!0);break;case"load_images":this.loadImages();break;case"clear_images":this.clearImages();break;case"upgrade":BFN.BfnService.upgrade("BATCH","BATCH_UPGRADE","batch_processing"),BFN.UserActionManager.addUpgradeAction(["Batch Processing Upgrade"],!1);break;case"save_images":if(BeFunky.isPaywallEnabled()&&!BeFunky.isPlus())return void BeFunky.openTeaserModal("paywall");if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("BATCH","BATCH_UPGRADE","batch_processing"),void BFN.UserActionManager.addUpgradeAction(["Batch Processing Save"],!1);var t=e.add_text,i=e.add_text_mode;UITools.setToolValue("batch_processing","image_quality",this.defaultImageQuality),UITools.setToolValue("batch_processing","add_text",t),UITools.setToolValue("batch_processing","add_text_mode",i),this.setImageType(e.image_type),this.setImageQuality(e.image_quality),this.modal.openSaveDialog(this.saveImages.bind(this)),UITools.disableControlItem("batch_processing_image_quality","png"===this.imageType),UITools.updateToolControl("batch_processing_image_quality"),UITools.updateToolControl("batch_processing_add_text"),UITools.updateToolControl("batch_processing_add_text_mode"),this.refreshBatchExampleName();break;case"image_type":this.setImageType(e.image_type),UITools.disableControlItem("batch_processing_image_quality","png"===this.imageType),this.refreshBatchExampleName();break;case"image_quality":this.setImageQuality(e.image_quality);break;case"add_text":case"add_text_mode":this.refreshBatchExampleName()}}else this.openModal()}refreshBatchExampleName(){var e=UITools.getToolVO("batch_processing"),t=document.getElementById("batch_processing_add_text"),i=document.getElementById("batch_processing_example_name");if(t&&i){var r=t.value.replace(/\s+/g," ");switch(this.savePrefix="",this.saveSuffix="",e.add_text_mode){case"before":this.savePrefix=r.replace(/^\s+/,"");break;case"after":this.saveSuffix=r.replace(/\s+$/,"")}i.textContent="".concat(this.savePrefix+BeFunky.LanguageManager.getString("filename").toLowerCase()+this.saveSuffix,".").concat(this.imageType)}}handleBatchResize(){var e=UITools.getToolVO("batch_resize");"mode"===e.updating_id&&this.modal.setResizeMode(e.mode),this.resizeMode=e.mode,this.modal.getImageItems().forEach(e=>{e.resize(this.resizeMode)})}handleBatchCrop(){var e=UITools.getToolVO("batch_crop"),t=this.modal.getImageItems();switch(e.updating_id){case"aspect_ratio":case"orientation":this.cropRatio="freeform"===e.aspect_ratio?-2:BFN.CropRatioMap[e.aspect_ratio],this.cropOrientation=e.orientation,t.forEach(e=>{e.setCropRatio(this.cropRatio,this.cropOrientation)}),"aspect_ratio"===e.updating_id&&UITools.disableControlItem("batch_crop_orientation","freeform"===e.aspect_ratio||1===BFN.CropRatioMap[e.aspect_ratio]);break;case"focal_point_align":this.showPopover("batch_crop_focal_point_align_popover");break;case"reset":UITools.setToolValue("batch_crop","aspect_ratio",e.aspect_ratio,!1),UITools.updateToolControl("batch_crop_aspect_ratio"),UITools.applyTool("batch_crop")}if("focal_point_align"!==e.updating_id&&e.updating_id.includes("focal_point_")&&e[e.updating_id]){var i=e.updating_id.replace("focal_point_","");"auto"===i?this.smartCrop():this.setCropFocalPoint(i)}}handleBatchEffect(){var e=UITools.getToolVO("batch_effect");e.updating||"reset"!==e.updating_id||(Object.assign(e,e.defaultValues),UITools.updateToolControls("batch_effect"));var t=this.modal.getImageItems();this.effectFadeable=e.hasOwnProperty("amount"),this.effectFadeable&&this.effectAmount!=e.amount&&(this.effectAmount=e.amount,t.forEach(e=>{e.setImageOverlayOpacity(this.effectAmount)})),e.updating||"amount"===e.updating_id||this.processVisibleImageItems(!0)}openModal(){this.modal.open||(BFN.UI.batchProcessingModal(this.modal),BFN.BatchToolManager.initManageToolsList()),this.modal.open(),this.loadZipLibrary()}setBatchSection(e){this.batchSection=e,this.batchMode=e,this.resizeMode="none",this.backgroundUpdateAllowed="resize"===this.batchSection,this.backgroundUpdateAllowed||this.setBackgroundColor(-1),document.removeEventListener(BeFunky.pointerdown,this.handleDocumentMouseDownCropBind,!0);var t=null;switch(this.batchMode){case"resize":var i=UITools.getToolVO("batch_resize");UITools.setToolValue("batch_resize","mode",i.mode,!1),this.handleBatchResize();break;case"crop":var r=UITools.getToolVO("batch_crop");UITools.setToolValue("batch_crop","aspect_ratio",r.aspect_ratio,!1),this.handleBatchCrop(),document.addEventListener(BeFunky.pointerdown,this.handleDocumentMouseDownCropBind,!0);break;default:var a=this.batchMode,n=null;if(BFN.effectMap.hasOwnProperty(a)?n=a:BFN.effectPresetMap.hasOwnProperty(a)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[a])&&(n=BFN.effectPresetMap[a]),n){var o=null;if(n==a){if(BFN.UIToolData[n]&&BFN.UIToolData[n].controls){var s=BFN.UIToolData[n].controls;for(var l in o=[],s){var h=l.replace("".concat(n,"_"),"");o.push({toolID:a,controlID:"batch_effect_".concat(h),controlName:h,controlParamObject:Object.assign({},s[l])})}t=a}}else{var c=a.replace("".concat(n,"_"),""),u=null,d=null,m=!1;if(BFN.EffectData.some(e=>e.id==n&&(u=e.name,e.presets.some((e,t)=>e.id==c&&(m=!e.hasOwnProperty("useBasicAmount")||e.useBasicAmount,e.hasOwnProperty("name")?u=e.name:u+=" ".concat(t+1),d=e.params,!0)),!0)),d){o=[];var p=!1;if(d.forEach(e=>{o.push({toolID:a,controlID:"batch_effect_".concat(e.name),controlName:e.name,controlParamObject:Object.assign({},e)}),"amount"===e.name&&(p=!0)}),!p&&m){var g={toolID:a,controlID:"batch_effect_amount",controlName:"amount",controlParamObject:{type:"slider_item",name:"amount",min:0,max:100,defaultValue:100}};o.splice(0,0,g)}t=u}}o&&this.modal.setDynamicControls(o,a)?(this.batchMode="dynamic",this.handleBatchEffect()):this.batchMode=null}else this.batchMode=null}requestAnimationFrame(()=>{this.modal.getImageItems().forEach(e=>{e.setBatchMode(this.batchMode)}),this.modal.showControls(this.batchMode,t)})}setBackgroundColor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.backgroundColor=e,this.modal.getImageItems().forEach(e=>{e.setBackgroundColor(this.backgroundColor)})}setImageType(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"jpg";["jpg","png"].includes(e)&&(this.imageType=e,this.modal.getImageItems().forEach(e=>{e.setImageType(this.imageType)}))}setImageQuality(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:99;this.imageQuality=Math.max(0,Math.min(100,e))}rightClickItemAction(e){if(this.rightClickItem)switch(e){case"remove":this.removeImageItem(this.rightClickItem,!0);break;case"reset":switch(this.batchMode){case"crop":this.rightClickItem.setCropRatio(this.cropRatio,this.cropOrientation)}}}smartCrop(){"crop"===this.batchMode&&(this.queuedSmartCropItems=this.modal.getImageItems(),UIToggler.toggleLoadScreen(!0,{isCancellable:!1}),this.processSmartCrop())}processSmartCrop(){if(this.queuedSmartCropItems)if(this.queuedSmartCropItems.length){var e=this.queuedSmartCropItems.shift(),t=new Image;t.addEventListener("load",i=>{var r=e.batchImageVO,a=r.cropData,n=Math.round(a.width/r.imageW*r.thumbW),o=Math.round(a.height/r.imageH*r.thumbH);window.smartcrop.crop(t,{width:n,height:o}).then(t=>{var i=t.topCrop,a=parseFloat(e.cropRegion.style.width.replace("%",""))/100*r.thumbW,n=parseFloat(e.cropRegion.style.height.replace("%",""))/100*r.thumbH,o=Math.max(0,Math.min(r.thumbW-a,i.x+i.width/2-a/2)),s=Math.max(0,Math.min(r.thumbH-n,i.y+i.height/2-n/2));e.cropRegion.setStyles({left:"".concat(o/r.thumbW*100,"%"),top:"".concat(s/r.thumbH*100,"%")}),e.updateCropVeil(),e.updateCropData(),this.processSmartCrop()})}),t.src=e.batchImageVO.thumbSRC}else UIToggler.toggleLoadScreen(!1)}setCropFocalPoint(e){this.modal.getImageItems().forEach(t=>{var i=t.batchImageVO,r=parseFloat(t.cropRegion.style.width.replace("%",""))/100*i.thumbW,a=parseFloat(t.cropRegion.style.height.replace("%",""))/100*i.thumbH,n=parseFloat(t.cropRegion.style.left.replace("%",""))/100*i.thumbW,o=parseFloat(t.cropRegion.style.top.replace("%",""))/100*i.thumbH;e.includes("l")?n=0:e.includes("c")?n=i.thumbW/2-r/2:e.includes("r")&&(n=i.thumbW-r),e.includes("t")?o=0:e.includes("m")?o=i.thumbH/2-a/2:e.includes("b")&&(o=i.thumbH-a),n=Math.max(0,Math.min(i.thumbW-r,n)),o=Math.max(0,Math.min(i.thumbH-a,o)),t.cropRegion.setStyles({left:"".concat(n/i.thumbW*100,"%"),top:"".concat(o/i.thumbH*100,"%")}),t.updateCropVeil(),t.updateCropData()})}loadImages(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={fileType:"imagesExceptSVG",saveInIndexedDB:!1,thumbnailLongestSide:this.itemSize,keepThumbTexture:!0,files:e,onBeforeUpload:(e,t)=>{var i=this.getRecommendedUploadLimit();if(i-this.modal.getTotalImageBytes()>=e.reduce((e,t)=>e+t.size,0))return t(e);var r=i/Math.pow(1024,2),a=r<1e3?"".concat(Math.round(r)," MB"):"".concat(Math.round(r/1024)," GB"),n='\n                <h3 style="font-size: inherit; font-weight: bold; margin-bottom: 1rem;">'.concat(BeFunky.LanguageManager.getStringReplacements("batch_file_size",{size:a}),"</h3>\n                <span>").concat(BeFunky.LanguageManager.getString("batch_file_size_body"),"</span>\n            ");BeFunky.confirm(n,{onConfirm:()=>t(e),onCancel:()=>t([]),confirmText:"continue"})}},i=0;BFN.MultipleFileUploader.upload(e=>{var t=e.file,r=e.menuImageVO,a=e.isComplete;if(r){var n=new BFN.BatchImageVO;return n.originalName=r.name,n.originalTransparent=BFN.Util.isTransparent(r.thumbTexture),n.name=r.name,n.extension=r.extension,n.imageBlob=t,n.imageW=r.imageWidth,n.imageH=r.imageHeight,n.thumbSRC=r.thumbURL,n.thumbTexture=r.thumbTexture,n.thumbW=r.thumbWidth,n.thumbH=r.thumbHeight,n.resizeData.width=n.imageW,n.resizeData.height=n.imageH,n.cropData.x=0,n.cropData.y=0,n.cropData.width=n.imageW,n.cropData.height=n.imageH,i++,void this.addImageItem(n)}if(a){this.modal.updateImageItems();var o={};this.modal.getImageItems().forEach(e=>{var t=e.batchImageVO;o.hasOwnProperty(t.originalName)||(o[t.originalName]=0);var i=o[t.originalName]++;t.name=t.originalName+(i?" (".concat(i,")"):"")}),"dynamic"===this.batchMode&&this.processVisibleImageItems(),this.modal.popoverWalkthrough&&0===this.modal.popoverWalkthrough.index&&(this.modal.popoverWalkthrough.index=1);var s=new BFN.UserActionVO;s.eventID="media_opened",s.eventObject={mediaType:"Image",mediaOpenLocation:"Computer",batchMediaOpen:i},s.peopleObject={lastMediaOpenDate:window.bfn_mp?window.bfn_mp.getISODate():"n/a",lifetimeMediaOpenCount:1,lifetimeImagesOpenCount:i},s.track()}},t)}addImageItem(e){var t=this.modal.addBatchImage(e);t.setBatchMode(this.batchMode),t.setImageOverlayOpacity(this.effectAmount),t.resize(this.resizeMode),t.setCropRatio(this.cropRatio,this.cropOrientation),t.setBackgroundColor(this.backgroundColor),t.setImageType(this.imageType),t.addEventListener(BeFunky.pointerdown,this.handleImageItemPressedBind,!0),t.oncontextmenu=(()=>!1)}removeImageItem(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(e.removeEventListener(BeFunky.pointerdown,this.handleImageItemPressedBind,!0),e.destroy(),t&&this.modal.updateImageItems())}clearImages(){var e=this.modal.getImageItems();e.length?BeFunky.confirm("confirm_clear_all_images",{onConfirm:()=>{e.forEach(e=>{this.removeImageItem(e)}),this.modal.updateImageItems()}}):UIMessages.display("no_images_to_clear")}saveImages(){this.modal.getImageItems().length?(this.savePending=!0,this.saveData.splice(0),this.processImages()):UIMessages.display("no_images_to_save")}processVisibleImageItems(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.processingVisibleImageItems&&"dynamic"===this.batchMode){var t=UITools.getToolVO("batch_effect"),i=t.toolID,r=null;if(BFN.effectMap.hasOwnProperty(i)?r=i:BFN.effectPresetMap.hasOwnProperty(i)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[i])&&(r=BFN.effectPresetMap[i]),r){if(e&&this.processedImageItems.splice(0),this.newlyProcessedImageItems.splice(0),this.queuedImageItems.splice(0),this.visibleImageItems=this.modal.getVisibleImageItems(),this.visibleImageItems.forEach(e=>{this.processedImageItems.length&&this.processedImageItems.includes(e)||(e.toggleImageOverlayVeil(!0,!0),this.queuedImageItems.push(e))}),e){this.hiddenImageItems=this.modal.getImageItems();for(var a=this.hiddenImageItems.length;--a>-1;){var n=this.hiddenImageItems[a];this.visibleImageItems.includes(n)&&this.hiddenImageItems.splice(a,1)}}else this.hiddenImageItems=[];BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!1,BFN.EffectManager.useThumbs=!0,this.effectID=r,this.effectParams=t,this.processQueuedImageItems()}}}processQueuedImageItems(){if(this.queuedImageItems.length){var e=this.queuedImageItems.shift(),t=()=>{BFN.EffectManager.removeEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,t);var i=UITools.getToolVO("batch_effect"),r=e.batchImageVO.originalTransparent;r=r||"replace_color"===i.toolID&&-1===i.target_color;var a=this.defaultImageQuality/100;BFN.TextureUtils.textureToBlob(this.effectTexture,{isTransparent:r,quality:a}).then(t=>{this.effectTexture.destroyGC(!0),delete this.effectTexture,BFN.BlobUtils.blobToImageElement(t,t=>{var i=t.imageElement,r=t.error;i&&!r?(this.newlyProcessedImageItems.push(e),e.setImageOverlaySRC(i.src,this.effectFadeable,!0)):e.setImageOverlaySRC(null,this.effectFadeable,!0),this.processQueuedImageItems()},{cleanUpMemory:!1})})};this.effectTexture&&this.effectTexture.destroyGC(!0),this.effectTexture=PIXI.RenderTexture.create(e.batchImageVO.thumbTexture.width,e.batchImageVO.thumbTexture.height),this.processingVisibleImageItems=!0,BFN.EffectManager.setSourceTexture(e.batchImageVO.thumbTexture),BFN.EffectManager.setRenderTexture(this.effectTexture),BFN.EffectManager.effectID=this.effectID,BFN.EffectManager.effectParameters=this.effectParams,BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,t),BFN.EffectManager.processEffect()}else this.effectID=null,this.effectParams=null,BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!0,BFN.EffectManager.useThumbs=!1,this.newlyProcessedImageItems.forEach(e=>{e.applyImageOverlaySRC(),e.toggleImageOverlayVeil(!1,!1)}),this.processedImageItems.push(...this.newlyProcessedImageItems),this.newlyProcessedImageItems.splice(0),this.hiddenImageItems.forEach(e=>{e.toggleImageOverlayVeil(!0,!1),e.setImageOverlaySRC(null,this.effectFadeable)}),this.processingVisibleImageItems=!1}processImages(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.updateOriginals=e,this.queuedBatchImageVOs=this.modal.getImageItems().map(e=>e.batchImageVO),this.totalQueuedBatchImageVOs=this.queuedBatchImageVOs.length,!this.batchMode&&this.savePending)for(var t=this.queuedBatchImageVOs.length;--t>-1;){var i=this.queuedBatchImageVOs[t],r=!1;switch(i.extension){case"jpg":case"jpeg":r="jpg"===this.imageType&&this.imageQuality==this.defaultImageQuality;break;case"png":r="png"===this.imageType}(r=r&&!BFN.WatermarkManager.watermarkActive)&&(this.saveData.push({name:i.name,blob:i.imageBlob}),this.queuedBatchImageVOs.splice(t,1))}this.updateOriginals&&this.modal.getImageItems().forEach(e=>{e.toggleImageOverlayVeil(!0,!1)});var a=null;switch(this.batchMode){case"resize":case"crop":a=this.batchMode;break;case"dynamic":a=UITools.getToolVO("batch_effect").toolID}this.batchApplyUserActionVO=null;var n=BFN.UserActionManager.getEditorToolObject(a);n&&(n.batchEditingApplied=this.totalQueuedBatchImageVOs,this.batchApplyUserActionVO=new BFN.UserActionVO,this.batchApplyUserActionVO.eventID="editing_applied",this.batchApplyUserActionVO.eventObject=n),UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"processing",showIris:!1}),this.processQueuedBatchImageVOs()}processQueuedBatchImageVOs(){var e=this;if(this.queuedBatchImageVOs&&this.queuedBatchImageVOs.length){var t=this.queuedBatchImageVOs.shift(),i=this.totalQueuedBatchImageVOs,r=i-this.queuedBatchImageVOs.length;UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"".concat(BeFunky.LanguageManager.getString("processing")," ").concat(r," / ").concat(i),showIris:!1}),BFN.TextureUtils.blobOrBase64ToTexture(t.imageBlob,i=>{var r=i.texture,a=function(i){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];requestAnimationFrame(()=>{e.savePending&&!e.updateOriginals&&BFN.WatermarkManager.watermarkActive&&BFN.WatermarkManager.drawWatermark(i);var a=BFN.Util.getThumbTexture(i,e.itemSize),n=r?BFN.Util.isTransparent(a):t.originalTransparent,o=e.savePending&&!e.updateOriginals?"png"===e.imageType:n,s=Math.max(1,Math.min(e.maxImageQuality,e.updateOriginals&&!e.savePending?e.defaultImageQuality:e.imageQuality))/100;BFN.TextureUtils.textureToBlob(i,{isTransparent:o,quality:s}).then(r=>{if(e.savePending&&e.saveData.push({name:t.name,blob:r}),e.updateOriginals){t.originalTransparent=n,t.extension=o?"png":"jpg",t.imageBlob=r,t.imageW=i.width,t.imageH=t.resizeData.height=i.height;try{t.thumbTexture.destroyGC(!0)}catch(e){}t.thumbTexture=a,t.thumbW=a.width,t.thumbH=a.height,t.resizeData.width=t.imageW,t.resizeData.height=t.imageH,t.cropData.x=0,t.cropData.y=0,t.cropData.width=t.imageW,t.cropData.height=t.imageH,i.destroyGC(!0),BFN.TextureUtils.textureToBlob(a,{isTransparent:o}).then(i=>{BFN.BlobUtils.blobToImageElement(i,i=>{var r=i.imageElement,a=i.error;if(t.thumbSRC&&(t.thumbSRC.startsWith("data:")||URL.revokeObjectURL(t.thumbSRC),t.thumbSRC=null),r&&!a){t.thumbSRC=r.src;var n=e.modal.getImageItems().find(e=>e.batchImageVO==t);if(n&&(n.setImageOverlaySRC(null),n.resize("scale"),n.setBatchMode(null),requestAnimationFrame(()=>{n.toggleImageOverlayVeil(!1,!1)}),e.batchApplyUserActionVO&&e.batchApplyUserActionVO.eventObject)){var o=e.batchApplyUserActionVO.eventObject;n.batchImageVO.addAction(BFN.UserActionManager.getFunnelString(o.toolType,o.toolName))}}e.processQueuedBatchImageVOs()},{cleanUpMemory:!1})})}else i.destroyGC(!0),a.destroyGC(!0),e.processQueuedBatchImageVOs()})})};switch(this.updateOriginals&&(t.imageBlob=null),this.batchMode){case"resize":var n=t.resizeData,o=!1;if(n.width!=t.imageW||n.height!=t.imageH){var s=BFN.Util.fitTextureInRect(r,n.width,n.height,!n.padding,t.backgroundColor);r.destroyGC(!0),r=s;var l=UITools.getToolVO("batch_resize");o="exact_size"===l.mode&&l.use_padding}a(r,o);break;case"crop":var h=t.cropData;if(h.width!=t.imageW||h.height!=t.imageH){var c=Math.min(r.width/t.imageW,r.height/t.imageH);h.x=Math.round(h.x*c),h.y=Math.round(h.y*c),h.width=Math.min(r.width-h.x,Math.round(h.width*c)),h.height=Math.min(r.height-h.y,Math.round(h.height*c));var u=PIXI.RenderTexture.create(h.width,h.height);u.copyPixels(r,{x:-h.x,y:-h.y}),r.destroyGC(!0),r=u}a(r);break;case"dynamic":var d=UITools.getToolVO("batch_effect"),m=d.toolID,p=null;if(BFN.effectMap.hasOwnProperty(m)?p=m:BFN.effectPresetMap.hasOwnProperty(m)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[m])&&(p=BFN.effectPresetMap[m]),p){var g=r.renderClone(),f=e=>{BFN.EffectManager.removeEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,f);var t=d.hasOwnProperty("amount"),i=t?d.amount/100:1;r.copyPixels(g,null,!t,i),g.destroyGC(!0);var n=!1;"replace_color"===d.toolID&&-1===d.target_color&&(n=!0),a(r,n)};BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!1,BFN.EffectManager.manageLoadScreen=!1,BFN.EffectManager.setSourceTexture(r),BFN.EffectManager.setRenderTexture(g),BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,f),BFN.EffectManager.effectID=p,BFN.EffectManager.effectParameters=d,BFN.EffectManager.processEffect()}else a(r);break;default:a(r)}},{textureSize:BFN.maxImageSize})}else{var a=this.modal.getImageItems();if(a.length){var n="";switch(this.batchMode){case"crop":n="CROP";break;case"resize":n="RESIZE"}BFN.EffectManager.parameters&&(n=BFN.UIToolData.hasOwnProperty(BFN.EffectManager.parameters.toolID)?BFN.EffectManager.parameters.toolID.toUpperCase():BFN.EffectManager.parameters.toolID.split("_").slice(1).join("_").toUpperCase()),BFN.BfnService.track("CREATE","BATCH",n),this.updateOriginals&&(this.updateOriginals=!1,UITools.setToolValue("batch_resize","scale",100,!1),UITools.updateToolControl("batch_resize_scale"),a.forEach(e=>{e.updateImageDisplay(),e.resize(this.resizeMode)}),"crop"===this.batchMode&&(UITools.setToolValue("batch_crop","aspect_ratio","freeform",!1),UITools.updateToolControl("batch_crop_aspect_ratio"),UITools.applyTool("batch_crop"))),this.batchApplyUserActionVO&&this.batchApplyUserActionVO.track(),this.savePending?(this.savePending=!1,this.saveData.length&&(BFN.BfnService.track("CREATE","BATCH","SAVE"),UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"zipping...",showIris:!1}),this.loadZipLibrary().then(()=>{var e=BFN.maxZipSizeMB,t=[],i=this.saveData.length,r=0;if(-1===e)t.push([...this.saveData]);else{var n=null,o=0;this.saveData.forEach((i,r)=>{var a=i.blob.size/Math.pow(1024,2);o+a>e&&(n=null,o=0),n||((n=[]).startIndex=r,t.push(n)),n.push(i),o+=a,n.sizeMB=o,n.firstImageNum=n.startIndex+1,n.lastImageNum=n.startIndex+n.length})}this.saveData.splice(0);var s=[],l=()=>{if(t.length){var e=t.shift(),n=null,o=new zip.BlobWriter,h=0,c=()=>{if(h===e.length)n.close(t=>{s.push({firstImageNum:e.firstImageNum,lastImageNum:e.lastImageNum,blob:t}),l()});else{var t=e[h];n.add("".concat((this.savePrefix+t.name+this.saveSuffix).trim(),".").concat(this.imageType),new zip.BlobReader(t.blob),()=>{UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"Zipping... ".concat(r," / ").concat(i),showIris:!1}),h++,r++,c()})}};zip.createWriter(o,e=>{n=e,c()},()=>{},!0)}else{if(window.bfn_mp){var u=new BFN.UserActionVO;u.eventID="media_saved",u.eventObject={mediaSaveType:[],mediaSaveLocation:"Computer",batchMediaSave:i,mediaSaveWatermark:BFN.WatermarkManager.watermarkActive,mediaSaveMainFunnel:[],mediaSaveFontsUsed:[],mediaSaveLayerSourcesUsed:[]},u.peopleObject={lastMediaSaveDate:window.bfn_mp?window.bfn_mp.getISODate():"n/a",lifetimeMediaSaveCount:1,lifetimeImagesSaveCount:i};var d=u.eventObject.mediaSaveType,m=u.eventObject.mediaSaveMainFunnel;if(a.forEach(e=>{var t=e.batchImageVO,i=t.extension.toUpperCase();i="PNG"===i?i:"JPG",d.includes(i)||d.push(i),t.actions&&t.actions.forEach(e=>{m.includes(e)||m.push(e)})}),this.batchApplyUserActionVO&&this.batchApplyUserActionVO.eventObject){var p=this.batchApplyUserActionVO.eventObject,g=BFN.UserActionManager.getFunnelString(p.toolType,p.toolName);m.includes(g)||m.push(g)}d.sort(),m.sort(),u.track()}UIToggler.toggleLoadScreen(!1);var f=1===s.length?"download_images_single":"download_images_multiple",v=s.map(e=>e.firstImageNum===e.lastImageNum?"":"".concat(e.firstImageNum," - ").concat(e.lastImageNum)).map((e,t)=>'\n                                        <div class="control-item" style="margin: 0 0 .5rem;">\n                                            <button class="button button--fullwidth button--list batch-processing__download-button" id="batch_zip_'.concat(t,'">\n                                                ').concat(BeFunky.LanguageManager.getStringReplacements("download_images_button",{range:e}),'\n                                                <span class="batch-processing__download-icons">\n                                                    ').concat(BeFunky.getSvgHtml("global-download-icon"),"\n                                                    ").concat(BeFunky.getSvgHtml("global-apply-icon"),"\n                                                </span>\n                                            </button>\n                                        </div>")),y='\n                                        <div id="batch_processing_download_panel_header" class="panel-header"></div>\n                                        <div class="modal__body">\n                                            <p>'.concat(BeFunky.LanguageManager.getString(f),"</p>\n                                            ").concat(v.join(""),"\n                                        </div>\n                                    "),x=document.createElement("div").addClass("modal");x.id="batch_processing_download",x.innerHTML=y;var _=x.querySelector(".panel-header");BFN.UI.panelHeader(_,{name:"download_images",modifier:"modal",closeEnabled:!0}),s.forEach((e,t)=>{var i=x.querySelector("#batch_zip_".concat(t));i.addEventListener("click",()=>{var r="batch_processed_images".concat(s.length>1?"_part_".concat(t+1):"",".zip");saveAs(e.blob,r),i.addClass("batch-processing__download-button--downloaded")})}),requestAnimationFrame(()=>{BeFunky.openModal(x,{onClose:()=>{s.splice(0)},size:"extra-small",destroyOnClose:!0})})}};l()}).catch(e=>{BeFunky.logError("Batch Processing save failed",e),UIToggler.toggleLoadScreen(!1)}))):(UIToggler.toggleLoadScreen(!1),UITools.setToolValue("batch_processing","section",null,!1),UITools.applyTool("batch_processing"))}else UIToggler.toggleLoadScreen(!1),UITools.setToolValue("batch_processing","section",null,!1),UITools.applyTool("batch_processing");BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!0,BFN.EffectManager.manageLoadScreen=!0}}showPopover(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=document.getElementById(e),r=document.getElementById("".concat(e,"_placeholder")).getBoundingClientRect(),a=this.modal.getBoundingClientRect();i.setStyles({left:"".concat(r.x-a.x+t,"px"),top:"".concat(r.y-a.y,"px")}),i.show()}loadZipLibrary(){return this.zipLoader?this.zipLoader:(this.zipLoader=BFN.RequestUtils.loadScript("zip.0.0.4.js",()=>window.zip).then(()=>{var e="".concat(BFN.jsURL,"z-worker.js"),t="".concat(BFN.jsURL,"pako-1.0.10.min.js"),i="".concat(BFN.jsURL,"pako-codecs.0.0.1.js");zip.workerScripts={deflater:[e,t,i]}}).catch(e=>{throw BeFunky.logError("Unable to load zip.js library",e),this.zipLoader=null,e}),this.zipLoader)}getRecommendedUploadLimit(){return(parseInt(navigator.deviceMemory)||4)/4*Math.pow(1024,3)}showContextMenu(e){"crop"===this.batchMode?this.contextMenu.showButton("reset_frame"):this.contextMenu.hideButton("reset_frame"),this.rightClickItem=this.pressedTarget,this.contextMenu.show(e.pageX-16,e.pageY-16)}handleImageItemPressed(e){this.pressedTarget=e.currentTarget,2===e.button?(this.showContextMenu(e),e.stopPropagation(),e.preventDefault()):BFN.LongPressManager.initiateLongPress(this.showContextMenu.bind(this))}handleDocumentMouseDownCrop(e){if(2!==e.button&&(this.cropControl=null,this.cropDragType=null,this.imageItem=null,this.cropContainer=null,this.cropRegion=null,this.cropAspectRatio=null,e.target&&e.target instanceof HTMLDivElement)){var t=e.target;if(this.mouseStartPosition=null,t.hasClass("batch-item__crop-region")||t.hasClass("batch-item__crop-region-handle")){this.cropControl=t,this.cropDragType=t.hasClass("batch-item__crop-region-handle")?"handle":"region",this.imageItem=t.imageItem,this.cropContainer=t.container,this.cropRegion=t.region,this.cropAspectRatio=this.imageItem.batchImageVO.cropData.height/this.imageItem.batchImageVO.cropData.width;var i=this.cropControl.container.getBoundingClientRect(),r=this.cropControl.region.getBoundingClientRect();this.cropContainer.rect=new BFN.Rectangle(0,0,i.width,i.height),this.cropRegion.rect=new BFN.Rectangle(r.x-i.x,r.y-i.y,r.width,r.height),this.mouseStartPosition={globalX:e.pageX,globalY:e.pageY,localX:e.pageX-i.x,localY:e.pageY-i.y},document.addEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveCropBind),document.addEventListener(BeFunky.pointerup,this.handleDocumentMouseUpCropBind,!0),e.stopImmediatePropagation(),e.preventDefault(),BFN.LongPressManager.initiateLongPress(e=>{this.handleDocumentMouseUpCropBind(),this.showContextMenu(e)})}}}handleDocumentMouseMoveCrop(e){var t=e.pageX-this.mouseStartPosition.globalX,i=e.pageY-this.mouseStartPosition.globalY,r={};switch(this.cropDragType){case"region":var a=Math.max(0,Math.min(this.cropContainer.rect.width-this.cropRegion.rect.width,this.cropRegion.rect.x+t)),n=Math.max(0,Math.min(this.cropContainer.rect.height-this.cropRegion.rect.height,this.cropRegion.rect.y+i)),o=a/this.cropContainer.rect.width*100,s=n/this.cropContainer.rect.height*100;r.left="".concat(o,"%"),r.top="".concat(s,"%");break;case"handle":var l=this.cropControl.handleID,h=this.cropControl.handleType,c=this.cropRegion.width,u=this.cropRegion.height,d=this.cropContainer.rect.width,m=this.cropContainer.rect.height;if(l.includes("top")?(m=this.cropRegion.rect.bottom,u=Math.max(this.cropMinSize,Math.min(m,this.cropRegion.rect.height-i))):l.includes("bottom")&&(m=this.cropContainer.rect.height-this.cropRegion.rect.top,u=Math.max(this.cropMinSize,Math.min(m,this.cropRegion.rect.height+i))),l.includes("left")?(d=this.cropRegion.rect.right,c=Math.max(this.cropMinSize,Math.min(d,this.cropRegion.rect.width-t))):l.includes("right")&&(d=this.cropContainer.rect.width-this.cropRegion.rect.left,c=Math.max(this.cropMinSize,Math.min(d,this.cropRegion.rect.width+t))),"corner"===h&&(this.cropAspectRatio<1?u=(c=Math.max(this.cropMinSize,Math.min(d,u/this.cropAspectRatio)))*this.cropAspectRatio:c=(u=Math.max(this.cropMinSize,Math.min(m,c*this.cropAspectRatio)))/this.cropAspectRatio),l.includes("top")){var p=(this.cropRegion.rect.bottom-u)/this.cropContainer.rect.height*100,g=u/this.cropContainer.rect.height*100;r.top="".concat(p,"%"),r.height="".concat(g,"%")}else if(l.includes("bottom")){var f=u/this.cropContainer.rect.height*100;r.height="".concat(f,"%")}if(l.includes("left")){var v=(this.cropRegion.rect.right-c)/this.cropContainer.rect.width*100,y=c/this.cropContainer.rect.width*100;r.left="".concat(v,"%"),r.width="".concat(y,"%")}else if(l.includes("right")){var x=c/this.cropContainer.rect.width*100;r.width="".concat(x,"%")}}this.imageItem.cropRegion.setStyles(r),this.imageItem.updateCropVeil(),this.imageItem.updateCropData()}handleDocumentMouseUpCrop(e){document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveCropBind),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUpCropBind,!0)}}BFN.SingletonQueue.add(()=>{BFN.BatchProcessingManager=new jm});class Wm{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.batchEditToolIDs=["crop","resize","exposure","vignette","levels","vibrance","color","replace_color","fill_light","sharpen","clarity","tint","beautify","color_mixer","auto_enhance","glow","blur_edges","smoothing","soften","blur"],this.batchToolData=this.getBatchToolData(),this.defaultBatchToolIDs=["crop","resize","exposure","color","auto_enhance","sharpen"],BFN.FeaturedData.effect.forEach(e=>{BFN.effectIDMap[e]&&this.defaultBatchToolIDs.push("".concat(BFN.effectIDMap[e],"_").concat(e))}),this._selectedIDs=[],this.selectedIDs=this.defaultBatchToolIDs}initManageToolsList(){this.manageToolsList=document.getElementById("batch_processing_manage_tools_popover_content"),BFN.UI.selectableList(this.manageToolsList,"manage_tools",this.batchToolData,e=>{this.selectedIDs=e}),this.updateModalToolLists()}updateModalToolLists(){if(this.manageToolsList){var e=this.batchToolData.filter(e=>{var t=e.id;return this.selectedIDs.includes(t)}).sort((e,t)=>this.selectedIDs.indexOf(e.id)-this.selectedIDs.indexOf(t.id));BFN.BatchProcessingManager.modal.updateToolButtons(e),this.manageToolsList.selectedIDs=this.selectedIDs}}getBatchToolData(){var e=[];return this.batchEditToolIDs.forEach(t=>{e.push({id:t,name:t})}),BFN.EffectData.forEach(t=>{"effect_featured"!==t.id&&"effect_favorites"!==t.id&&"touchup"!==t.id&&t.presets.forEach((i,r)=>{var a="".concat(t.id,"_").concat(i.id),n=i.name?i.name:"".concat(t.name," ").concat(r+1);e.push({id:a,name:n})})}),e}set selectedIDs(e){Array.isArray(e)?this._selectedIDs.isIdenticalTo(e)||(this._selectedIDs=e.slice(),this.updateModalToolLists(),BFN.BatchIconManager.updateButtonIcons(),BFN.BatchIconManager.updatePanelHeaders(),BFN.SettingsManager.updateSetting("batch_processing_fav",e.slice())):BeFunky.throwError("Invalid selectedIDs: ".concat(BeFunky.getType(e),"}"),{_value:e})}get selectedIDs(){return this._selectedIDs}}BFN.SingletonQueue.add(()=>{BFN.BatchToolManager=new Wm}),BFN.TransformLayerManagerEvents={ITEMS_UPDATED:new Event("ITEMS_UPDATED"),SELECTION_UPDATED:new Event("SELECTION_UPDATED")};class Ym extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.initDefaultValues()}initDefaultValues(){this._transformItemIDs=[],this._transformItems=[],this._selectedItemIDs=[],this._selectedItems=[],this.updateTransformItems=BeFunky.debounce(this.updateTransformItemsImmediately,50),this.updateSelectedItems=BeFunky.debounce(this.updateSelectedItemsImmediately,50),window.addEventListener("INIT_COMPLETE",()=>{BFN.PhotoEditorCanvas.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,this.handleTransformLayerItemsUpdated.bind(this)),BFN.CollageMakerCanvas.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,this.handleTransformLayerItemsUpdated.bind(this)),BFN.DesignerCanvas.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,this.handleTransformLayerItemsUpdated.bind(this)),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppViewstateUpdated.bind(this))})}updateTransformItemsImmediately(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children.filter(e=>e instanceof BFN.TransformItem),i=t.map(e=>e.itemID);this._transformItemIDs.isIdenticalTo(i)&&this._transformItems[0]===t[0]||(this._transformItemIDs.splice(0),this._transformItems.splice(0),t.forEach(e=>{this._transformItemIDs.push(e.itemID),this._transformItems.push(e)}),e&&this.dispatchEvent(BFN.TransformLayerManagerEvents.ITEMS_UPDATED))}updateSelectedItemsImmediately(){var e=[];e.push(...BFN.TransformItemGroup.selectedItems),BFN.TransformModel.selectedTransformItem&&"group"!==BFN.TransformModel.selectedTransformItem.type&&!e.includes(BFN.TransformModel.selectedTransformItem)&&e.push(BFN.TransformModel.selectedTransformItem),e.sort((e,t)=>e.itemID>t.itemID?1:-1);var t=e.map(e=>{return e.itemID});this._selectedItemIDs.isIdenticalTo(t)||(this._selectedItemIDs.splice(0),this._selectedItems.splice(0),this._selectedItemIDs.push(...t),this._selectedItems.push(...e),this.dispatchEvent(BFN.TransformLayerManagerEvents.SELECTION_UPDATED))}smartResizeLayers(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e||!t)return null;var i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),r=i.transformLayer,a=i.transformTool,n=r.frameWidth,o=r.frameHeight,s=Math.abs(e),l=Math.abs(t),h=Math.min(s/n,l/o),c=[...r.children];if(c.includes(BFN.TransformItemGroup)&&c.splice(c.indexOf(BFN.TransformItemGroup),1),c.length){var u="resize_item_layer"+BeFunky.randomString(10);return BFN.TransformStateModel.startBulkTransition(u),c.forEach(e=>{e.createTransition("resize_item_layer");var t=e.bounds,i=t.width,r=t.height/i/(e.scale.x/e.scale.y),n=a.minSize;switch(e.type){case"text":n=a.minSizeText;break;case"frame_texture":n=a.minSizeFrame;break;case"texture":e.isShape||(n=a.minSizeFrame)}var o=n,s=o*r,l=Math.sqrt(Math.pow(o,2)+Math.pow(s,2)),c=n,u=c/r,d=Math.sqrt(Math.pow(u,2)+Math.pow(c,2)),m=Math.max(l,d)/2,p=e.itemContentW*e.scale.x,g=e.itemContentH*e.scale.y,f=Math.sqrt(Math.pow(p,2)+Math.pow(g,2))/2,v=Math.atan2(g/2,p/2),y=e.x+Math.cos(v+e.rotation)*f,x=e.y+Math.sin(v+e.rotation)*f,_=y*h,I=x*h,T=p*h,b=g*h,S=Math.max(m,Math.sqrt(Math.pow(T,2)+Math.pow(b,2))/2),C=S/f;T=p*C,b=g*C,S=Math.sqrt(Math.pow(T,2)+Math.pow(b,2))/2,e.scale.x*=C,e.scale.y*=C,e.updateFrameTextureDisplay(),e.x=_-Math.cos(e.rotation+v)*S,e.y=I-Math.sin(e.rotation+v)*S,e.updateShapeTexture(!1),e.resetFrameTextureScale(),e.basicShapeVO&&e.basicShapeVO.strokeWidth&&(e.basicShapeVO.strokeWidth=Math.max(1,Math.min(100,Math.round(e.basicShapeVO.strokeWidth*C)))),e.updateShapeTexture(),"text"===e.type?e.setTextWidth(T,!0):(e.updateHitArea(),e.updateAccurateBounds()),e.updateSmoothingScale(),e.registerTransition(!1)}),BFN.TransformStateModel.stopBulkTransition(),BFN.MainUI.requestRender(),u}return null}handleTransformLayerItemsUpdated(){this.updateTransformItems()}handleAppViewstateUpdated(){this.updateTransformItems()}get transformItemIDs(){return this._transformItemIDs}get transformItems(){return this._transformItems}get selectedItemIDs(){return this._selectedItemIDs}get selectedItems(){return this._selectedItems}}BFN.SingletonQueue.add(()=>{BFN.TransformLayerManager=new Ym}),BFN.WatermarkManagerEvents={WATERMARK_UPDATED:new Event("WATERMARK_UPDATED")};class qm extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.initDefaultValues(),this.initGraphicLoader(),this.initWatermarkControls(),this.setInitialValues(),this.setUseWatermarkIndexedDB=BeFunky.debounce(this.setUseWatermarkIndexedDB.bind(this),500),this.saveWatermarkPresets=BeFunky.debounce(this.saveWatermarkPresets.bind(this),500)}initDefaultValues(){this.editModal=document.getElementById("watermark_edit_modal"),this.presetModal=document.getElementById("watermark_preset_modal"),window.addEventListener("INIT_COMPLETE",()=>{BFN.UI.watermarkEditModal(this.editModal),BFN.UI.watermarkPresetModal(this.presetModal)}),this.previewWatermarkURL=null,this.previewWatermarkObjectURL=null,this.previewWatermarkBlob=null,this.watermarkData=null,this.watermarkURL=null,this.watermarkTexture=null,this.watermarkPresets=[],this.activated=!1}initGraphicLoader(){this.graphicLoader=new BFN.GraphicLoader,this.graphicLoader.addEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleGraphicLoaderComplete.bind(this))}initWatermarkControls(){this.watermarkControls=[...document.querySelectorAll(".watermark-control")],this.watermarkControls.forEach(e=>{BFN.UI.watermarkControl(e)})}setInitialValues(){BFN.IndexedDB.get("options__useWatermark").then(e=>{this.useWatermarkDB=e}).catch(()=>{this.useWatermarkDB=!1}).then(()=>{this.useWatermark=this.useWatermarkDB})}setUseWatermarkIndexedDB(){this.useWatermarkDB!==this._useWatermark&&(this.useWatermarkDB=this._useWatermark,BFN.IndexedDB.set("options__useWatermark",this._useWatermark))}handleWatermark(){var e=UITools.getToolVO("watermark");switch(e.updating_id){case"upload":this.uploadWatermark();break;case"placement_popover_button":this.showPopover("watermark_placement_popover",16);break;case"placement":this.editModal.setPreviewWatermarkParams({placement:e.placement});break;case"size":this.editModal.setPreviewWatermarkParams({size:e.size});break;case"padding":this.editModal.setPreviewWatermarkParams({padding:e.padding});break;case"opacity":this.editModal.setPreviewWatermarkParams({opacity:e.opacity});break;case"save":if(this.previewWatermarkURL){var t=this.editModal.nameInputValue;if(t.length){if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("WATERMARK","WATERMARK_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Watermark Preset Save"]);var i=()=>{BFN.WatermarkManager.saveWatermarkPreset(t,()=>{this.editModal.close()})};if(this.editModal.editingExistingPreset)i();else BFN.WatermarkManager.watermarkPresets.map(e=>e.presetName).includes(t)?BeFunky.confirm(["confirm_overwrite_existing_watermark_preset",{name:t}],{onConfirm:()=>{i()}}):i()}else BeFunky.acknowledge("please_enter_watermark_preset_name")}else BeFunky.acknowledge("please_upload_your_watermark")}}activate(){this.activated||(this.activated=!0,this.watermarkData&&this.setWatermarkData(this.watermarkData))}uploadWatermark(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=[];e&&t.push(e);var i={allowMultiple:!1,fileType:"imagesExceptSVG",saveInIndexedDB:!1,thumbnailLongestSide:115,createMenuImageVO:!1,files:t};BFN.MultipleFileUploader.upload(e=>{var t=e.file;if(t){var i=t.type;if(["image/jpeg","image/png","image/gif"].includes(i)){var r=()=>{this.clearPreviewWatermark(),this.previewWatermarkBlob=t,this.previewWatermarkObjectURL=URL.createObjectURL(this.previewWatermarkBlob),this.previewWatermarkURL=this.previewWatermarkObjectURL,this.editModal.setPreviewWatermarkSRC(this.previewWatermarkURL)};if("image/gif"===i){var a=URL.createObjectURL(t),n=document.createElement("img");n.onload=(()=>{var e=document.createElement("canvas"),i=e.width=n.width,o=e.height=n.height;e.getContext("2d").drawImage(n,0,0,i,o);var s=e.toDataURL("image/gif");t=BFN.BlobUtils.base64ToBlob(s),URL.revokeObjectURL(a),n.src="",n.onerror=null,r()}),n.onerror=(()=>{URL.revokeObjectURL(a),n.src="",UIMessages.display("Watermark upload error",1e3)}),n.src=a}else r()}else BeFunky.acknowledge("acknowledge_watermark_invalid_filetype")}},i)}clearPreviewWatermark(){this.previewWatermarkBlob=null,this.previewWatermarkObjectURL&&URL.revokeObjectURL(this.previewWatermarkObjectURL),this.previewWatermarkObjectURL=null,this.previewWatermarkURL=null}clearWatermarkTexture(){this.watermarkTexture&&this.watermarkTexture.destroyGC(!0),this.watermarkTexture=null}updateWatermarkPresetOrder(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={};this.watermarkPresets.forEach(e=>{t[e.presetID]=e}),this.watermarkPresets.splice(0),e.forEach(e=>{this.watermarkPresets.push(t[e])}),this.saveWatermarkPresets()}deleteWatermarkPreset(e){for(var t=null,i=0,r=this.watermarkPresets.length;--r>-1;){var a=this.watermarkPresets[r];if(a.presetID===e){t=a,this.watermarkPresets.splice(r,1),i=Math.max(0,Math.min(this.watermarkPresets.length-1,r));break}}if(t){var n=!0;if(this.watermarkPresets.forEach(e=>{e.watermarkURL==t.watermarkURL&&(n=!1)}),n&&this.deleteWatermarkFromServer(t.watermarkURL),t.presetID===this.selectedPresetID)if(i<this.watermarkPresets.length){var o=this.watermarkPresets[i];this.selectedPresetID=o.presetID}else this.selectedPresetID=null;return this.saveWatermarkPresets(),this.watermarkControls.forEach(e=>{e.updatePresetList(this.watermarkPresets)}),this.watermarkPresets.length||this.dispatchEvent(BFN.WatermarkManagerEvents.WATERMARK_UPDATED),!0}return!1}saveWatermarkPresets(){BFN.SettingsManager.updateSetting("watermarks",this.watermarkPresets,{updateUI:!1})}loadWatermarkPresets(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.watermarkPresets.splice(0),this.watermarkPresets.push(...e),this.presetModal.updatePresetButtons(this.watermarkPresets),this.watermarkControls.forEach(e=>{e.updatePresetList(this.watermarkPresets)}),this.editModal.isOpen||this.updateSelectedPreset()}updateSelectedPreset(){var e=this.getSelectedPresetObject();e?this.selectedPresetID=e.presetID:this.watermarkPresets.length?(e=this.watermarkPresets[0],this.selectedPresetID=e.presetID):this.selectedPresetID=null}saveWatermarkToServer(e,t){e?BFN.BfnWatermarkService.uploadImage(this.previewWatermarkBlob,t):t&&t({error:"no_blob"})}deleteWatermarkFromServer(e){if(e){BFN.BfnWatermarkService.deleteImage(e,e=>{e.success})}}renameWatermarkPreset(e,t){if(e||t&&"string"==typeof t&&t.trim().length){var i=!1;if(this.watermarkPresets.forEach(r=>{i||r.presetID==e||r.presetName!=t||(i=!0)}),i)BeFunky.acknowledge("acknowledge_watermark_preset_name_taken");else{var r=null;this.watermarkPresets.forEach(t=>{r||t.presetID!==e||(r=t)}),r&&(r.presetName=t,this.presetModal.updatePresetButtons(this.watermarkPresets),this.watermarkControls.forEach(e=>{e.updatePresetList(this.watermarkPresets)}),this.saveWatermarkPresets())}}}saveWatermarkPreset(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&this.previewWatermarkURL){var i=null,r=()=>{var r=null;this.watermarkPresets.forEach(t=>{r||t.presetName!==e||(r=t)});var a=this.editModal.getWatermarkData();if(r){var n=r.watermarkURL||null;Object.assign(r,a),(a=r).watermarkURL=i,n&&(this.watermarkPresets.forEach(e=>{n&&e.watermarkURL===n&&(n=null)}),n&&this.deleteWatermarkFromServer(n))}else a.presetID="preset_".concat(BeFunky.hash(e).toString(36)),a.presetName=e,a.watermarkURL=i,this.watermarkPresets.push(a);this.presetModal.updatePresetButtons(this.watermarkPresets),this.watermarkControls.forEach(e=>{e.updatePresetList(this.watermarkPresets)}),this.selectedPresetID=a.presetID,this.saveWatermarkPresets(),t&&t()};if(this.previewWatermarkBlob){var a=!1;UIToggler.toggleLoadScreen(!0,{message:"uploading_watermark",onCancel:()=>{a=!0}}),this.saveWatermarkToServer(this.previewWatermarkBlob,e=>{UIToggler.toggleLoadScreen(!1),e.url?a?this.deleteWatermarkFromServer(e.url):(i=e.url,r()):(BeFunky.logError("Watermark Upload Error".concat(e.error?" : ".concat(e.error):"")),BeFunky.acknowledge("acknowledge_watermark_upload_error"))})}else i=this.previewWatermarkURL,r()}}setWatermarkData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.watermarkData=null;["frameW","frameH","framePadding","watermarkPlacement","watermarkW","watermarkH","watermarkAlpha","watermarkURL"].forEach(t=>{e.hasOwnProperty(t)}),this.watermarkData=e,this.activated&&this.loadWatermarkFromURL(this.watermarkData.watermarkURL)}loadWatermarkFromURL(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.clearWatermarkTexture(),e&&(UIToggler.toggleLoadScreen(!0),BeFunky.isSafari&&(e="".concat(e,"?nocache=").concat(Math.random().toString().split(".")[1])),this.watermarkURL=e,this.graphicLoader.graphicsData.watermarkTexture=this.watermarkURL,this.graphicLoader.loadGraphics())}drawWatermark(e){if(this.watermarkActive&&e&&e.baseTexture){var t=this.watermarkTexture,i=this.watermarkData,r=Math.sqrt(Math.pow(i.frameW,2)+Math.pow(i.frameH,2)),a=Math.sqrt(Math.pow(i.watermarkW,2)+Math.pow(i.watermarkH,2)),n=e.baseTexture.width,o=e.baseTexture.height,s=Math.sqrt(Math.pow(n,2)+Math.pow(o,2))/r,l=t.baseTexture.width,h=t.baseTexture.height,c=a/Math.sqrt(Math.pow(l,2)+Math.pow(h,2)),u=i.framePadding*s,d=n-2*u,m=o-2*u,p=Math.min(s*c,d/l,m/h),g=0,f=0;i.watermarkPlacement.includes("l")&&(g=u),i.watermarkPlacement.includes("c")&&(g=n/2-l/2*p),i.watermarkPlacement.includes("r")&&(g=n-u-l*p),i.watermarkPlacement.includes("t")&&(f=u),i.watermarkPlacement.includes("m")&&(f=o/2-h/2*p),i.watermarkPlacement.includes("b")&&(f=o-u-h*p),e.copyPixels(t,{x:g,y:f},!1,i.watermarkAlpha,p)}}showPopover(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e){var r=document.getElementById(e),a=document.getElementById("".concat(e,"_placeholder"));if(r&&a){var n=a.getBoundingClientRect(),o=this.editModal.getBoundingClientRect();r.setStyles({left:"".concat(n.x-o.x+t,"px"),top:"".concat(n.y-o.y+i,"px")}),r.show()}}}getPresetObjectById(e){var t=null;return this.watermarkPresets.forEach(i=>{i.presetID&&i.presetID===e&&(t=i)}),t}setSelectedPresetObject(e){var t=this.getSelectedPresetObject();this.watermarkPresets.forEach(t=>{t.selected=e==t}),t!=this.getSelectedPresetObject()&&this.saveWatermarkPresets()}getSelectedPresetObject(){var e=null;return this.watermarkPresets.forEach(t=>{!e&&t.selected&&(e=t)}),e}handleGraphicLoaderComplete(e){this.clearWatermarkTexture(),this.graphicLoader.graphics.watermarkTexture&&(this.watermarkTexture=this.graphicLoader.graphics.watermarkTexture.renderClone()),this.graphicLoader.reset(),this.useWatermark&&this.dispatchEvent(BFN.WatermarkManagerEvents.WATERMARK_UPDATED),UIToggler.toggleLoadScreen(!1)}set useWatermark(e){(e=!!e)!=this._useWatermark&&(this._useWatermark=e,this.watermarkControls.forEach(e=>{e.selected=this._useWatermark}),this.setUseWatermarkIndexedDB(),this.dispatchEvent(BFN.WatermarkManagerEvents.WATERMARK_UPDATED))}get useWatermark(){return this._useWatermark}set selectedPresetID(e){this.clearWatermarkTexture();var t=this.getPresetObjectById(e);this._selectedPresetID=t?t.presetID:null,this.watermarkControls.forEach(e=>{e.selectedPresetID=this._selectedPresetID}),this.presetModal.selectedPresetID=this._selectedPresetID,this.setWatermarkData(t||{}),this.setSelectedPresetObject(t)}get selectedPresetID(){return this._selectedPresetID}get watermarkActive(){return!!(this._useWatermark&&this.watermarkTexture&&this.watermarkTexture.baseTexture&&this.watermarkData)}}BFN.SingletonQueue.add(()=>{BFN.WatermarkManager=new qm});class Km extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.funnelEvents=["editing_applied","text_added","image_layer_added","image_layer_masked","collage_layout_selected","collage_grid_image_added"],this.noParentActions=["image_layer_masked"],this.userActionVOs={editor:[],collage:[],designer:[]},this.pendingImageLayerAddedUserActionVOs={editor:[],collage:[],designer:[]},this.trackImageLayerAddedUserActionVOs=BeFunky.debounce(this.trackImageLayerAddedUserActionVOs.bind(this),3e4),this.pendingImageLayerMaskedUserActionVOs={editor:[],collage:[],designer:[]},this.trackImageLayerMaskedUserActionVOs=BeFunky.debounce(this.trackImageLayerMaskedUserActionVOs.bind(this),3e4),this.pendingCollageGridImageAddedUserActionVOs=[],this.trackCollageGridImageAddedUserActionVOs=BeFunky.debounce(this.trackCollageGridImageAddedUserActionVOs.bind(this),3e4),this.trackedCollageLayoutSelectedUserActionVO=null,this.pendingCollageLayoutSelectedUserActionVO=null,this.trackPendingCollageLayoutSelectedUserActionVO=BeFunky.debounce(this.trackPendingCollageLayoutSelectedUserActionVO.bind(this),3e4),this.lastEventID=null,this.lastAppViewState=null,window.addEventListener("INIT_COMPLETE",()=>{this.lastAppViewState=BFN.AppModel.viewState}),this.sessionStarted=!1,this.isTrackable=!1,this._upgradeActions=[],BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged.bind(this)),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppViewStateUpdated.bind(this)),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.type,this.handleGlobalHistoryIDUpdated.bind(this)),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,this.handleGlobalHistoryUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS.type,this.handlePhotoEditorClearItems.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS.type,this.handleCollageMakerClearItems.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CLEAR_ITEMS.type,this.handleDesignerClearItems.bind(this))}trackImageLayerAddedUserActionVOs(){this.trackImageLayerAddedUserActionVOsImmediately()}trackImageLayerAddedUserActionVOsImmediately(){for(var e in this.pendingImageLayerAddedUserActionVOs){var t=null,i=this.pendingImageLayerAddedUserActionVOs[e];if(i.length){for(var r=i.length;--r>-1;){var a=i[r];if(a.transformItem.destroyed)i.splice(r,1);else if(a.active&&a.transformItem.parent){var n=a.eventObject;t||(t={imageLayerTypes:[],imageLayerSources:[]}),t.imageLayerTypes.push(...n.imageLayerTypes),t.imageLayerSources.push(...n.imageLayerSources),n.imageLayerGraphicsStyle&&(t.imageLayerGraphicsStyle=t.imageLayerGraphicsStyle||[],t.imageLayerGraphicsStyle.push(...n.imageLayerGraphicsStyle)),i.splice(r,1)}}t&&(t.imageLayerTypes=t.imageLayerTypes.unique().sort(),t.imageLayerSources=t.imageLayerSources.unique().sort(),t.imageLayerGraphicsStyle&&(t.imageLayerGraphicsStyle=t.imageLayerGraphicsStyle.unique().sort()),window.bfn_mp&&window.bfn_mp.track("image_layer_added",t))}}}trackImageLayerMaskedUserActionVOs(){this.trackImageLayerMaskedUserActionVOsImmediately()}trackImageLayerMaskedUserActionVOsImmediately(){for(var e in this.pendingImageLayerMaskedUserActionVOs){var t=null,i=this.pendingImageLayerMaskedUserActionVOs[e];if(i.length){for(var r=i.length;--r>-1;){var a=i[r];if(a.transformItem.destroyed)i.splice(r,1);else if(a.active&&(a.transformItem.parent||this.noParentActions.includes(a.eventID))){var n=a.eventObject;t||(t={imageLayerMaskedTypes:[],imageLayerMaskedSources:[]}),t.imageLayerMaskedTypes.push(...n.imageLayerMaskedTypes),t.imageLayerMaskedSources.push(...n.imageLayerMaskedSources),i.splice(r,1)}}t&&(t.imageLayerMaskedTypes=t.imageLayerMaskedTypes.unique().sort(),t.imageLayerMaskedSources=t.imageLayerMaskedSources.unique().sort(),window.bfn_mp&&window.bfn_mp.track("image_layer_masked",t))}}}trackCollageGridImageAddedUserActionVOs(){this.trackCollageGridImageAddedUserActionVOsImmediately()}trackCollageGridImageAddedUserActionVOsImmediately(){var e=null,t=this.pendingCollageGridImageAddedUserActionVOs;if(t.length){for(var i=t.length;--i>-1;){var r=t[i];if(r.active){var a=r.eventObject;e||(e={cellImageTypes:[],cellImageSources:[]}),e.cellImageTypes.push(...a.cellImageTypes),e.cellImageSources.push(...a.cellImageSources),t.splice(i,1)}}e&&(e.cellImageTypes=e.cellImageTypes.unique().sort(),e.cellImageSources=e.cellImageSources.unique().sort(),window.bfn_mp&&window.bfn_mp.track("collage_grid_image_added",e))}}updatePendingCollageLayoutSelectedUserActionVO(){if(BFN.AppModel.viewingCollage){for(var e=null,t=this.getActiveUserActionVOs("collage"),i=t.length;--i>-1;){var r=t[i];if("collage_layout_selected"===r.eventID){e=r;break}}e&&(e!==this.trackedCollageLayoutSelectedUserActionVO?this.pendingCollageLayoutSelectedUserActionVO=e:this.pendingCollageLayoutSelectedUserActionVO=null)}}trackPendingCollageLayoutSelectedUserActionVO(){this.trackPendingCollageLayoutSelectedUserActionVOImmediately()}trackPendingCollageLayoutSelectedUserActionVOImmediately(){this.pendingCollageLayoutSelectedUserActionVO&&(this.pendingCollageLayoutSelectedUserActionVO.track(),this.trackedCollageLayoutSelectedUserActionVO=this.pendingCollageLayoutSelectedUserActionVO,this.pendingCollageLayoutSelectedUserActionVO=null)}registerUserAction(e){if(e&&e.isValid){if(this.funnelEvents.includes(e.eventID))switch(e.actionSection){case"editor":case"collage":case"designer":this.purgeInactiveUserActionVOs(e.actionSection),this.userActionVOs[e.actionSection].push(e)}switch("image_layer_added"===this.lastEventID&&"image_layer_added"!==e.eventID&&this.trackImageLayerAddedUserActionVOsImmediately(),"image_layer_masked"===this.lastEventID&&"image_layer_masked"!==e.eventID&&this.trackImageLayerMaskedUserActionVOsImmediately(),"collage_grid_image_added"===this.lastEventID&&"collage_grid_image_added"!==e.eventID&&this.trackCollageGridImageAddedUserActionVOsImmediately(),"collage_layout_selected"!==e.eventID&&this.trackPendingCollageLayoutSelectedUserActionVOImmediately(),e.eventID){case"text_added":this.lastEventID!==e.eventID&&e.track();break;case"image_layer_added":switch(e.actionSection){case"editor":case"collage":case"designer":e.transformItem&&(this.pendingImageLayerAddedUserActionVOs[e.actionSection].push(e),this.trackImageLayerAddedUserActionVOs())}break;case"image_layer_masked":switch(e.actionSection){case"editor":case"collage":case"designer":e.transformItem&&(this.pendingImageLayerMaskedUserActionVOs[e.actionSection].push(e),this.trackImageLayerMaskedUserActionVOs())}break;case"collage_grid_image_added":switch(e.actionSection){case"editor":case"collage":case"designer":this.pendingCollageGridImageAddedUserActionVOs.push(e),this.trackCollageGridImageAddedUserActionVOs()}break;case"collage_layout_selected":switch(e.actionSection){case"editor":case"collage":case"designer":this.updatePendingCollageLayoutSelectedUserActionVO(),this.trackPendingCollageLayoutSelectedUserActionVO()}break;default:e.track()}this.lastEventID=e.eventID}}purgeInactiveUserActionVOs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(e=e||BFN.AppModel.sectionID){case"editor":case"collage":case"designer":for(var t=this.userActionVOs[e],i=t.length;--i>-1;){t[i].active||t.splice(i,1)}}}purgeUserActionVOs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(e=e||BFN.AppModel.sectionID){case"editor":case"collage":case"designer":this.userActionVOs[e].splice(0),this.pendingImageLayerAddedUserActionVOs[e].splice(0),this.pendingImageLayerMaskedUserActionVOs[e].splice(0),"collage"===e&&this.pendingCollageGridImageAddedUserActionVOs.splice(0)}}updateUserActionVOsActiveState(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=e||BFN.AppModel.sectionID;var t=BFN.AppModel.getSectionValue(e,BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,BFN.AppModelViewStates.VIEWING_DESIGNER),i=BFN.GlobalHistoryModel.selectedHistoryID[t];if(i){var r=BFN.GlobalHistoryModel.globalHistoryVOHash[i];if(r){var a=BFN.AppModel.sectionID;this.userActionVOs[a].forEach(e=>{e.active=e.actionTimestamp<=r.timestamp})}}}addUpgradeAction(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=t?BFN.AppModel.sectionValue("Photo Editor","Collage Maker","Designer"):"";e.forEach(e=>{e&&"string"==typeof e&&(i||(i=r),i+=(i?" - ":"")+e)});var a=BeFunky.getLocal("upgradeActions");a&&(a=a.split(","),this._upgradeActions.splice(0),this._upgradeActions.push(...a)),i&&!this._upgradeActions.includes(i)&&(this._upgradeActions.push(i),BeFunky.setLocal("upgradeActions",this._upgradeActions))}translateToReadable(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof e?"":e.toLowerCase().split(" ").join("_").split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}getActiveUserActionVOs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(e=e||BFN.AppModel.sectionID){case"editor":case"collage":case"designer":return this.userActionVOs[e].filter(e=>e.active).sort((e,t)=>e.actionTimestamp-t.actionTimestamp)}return[]}getSaveData(){this.trackImageLayerAddedUserActionVOsImmediately(),this.trackCollageGridImageAddedUserActionVOsImmediately(),this.trackPendingCollageLayoutSelectedUserActionVOImmediately();var e=BFN.AppModel.sectionID,t={actions:[],fonts:[],assets:[],graphicFileNames:[],graphicStyles:[]},i=this.getActiveUserActionVOs(e),r=[];BFN.AppModel.getSectionValue(BFN.AppModel.viewState,BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children.forEach(e=>{e instanceof BFN.TransformItem&&r.push(e)});for(var a=i.length;--a>-1;){var n=i[a];n.transformItems&&n.transformItems.length&&n.transformItems.forEach(e=>{r.includes(e)||r.push(e)});var o=null;if(this.funnelEvents.includes(n.eventID))switch(n.eventID){case"editing_applied":o=this.getFunnelString(n.eventObject.toolType,n.eventObject.toolName);break;case"text_added":o="Text Added";break;case"image_layer_added":o="Image Layer Added";break;case"image_layer_masked":o="Image Layer Masked";break;case"collage_grid_image_added":o="Collage Grid Image Added"}o&&!t.actions.includes(o)&&t.actions.push(o)}if("collage"===e){for(var s=null,l=this.getActiveUserActionVOs("collage"),h=l.length;--h>-1;){var c=l[h];if("collage_layout_selected"===c.eventID){s=c;break}}var u="Collage Layout : ";if(s){var d=s.eventObject.templateType,m=s.eventObject.templateCategory;u+=d&&m?this.getFunnelString(d,m):"Unknown"}else u+="User Project";t.actions.push(u)}if("designer"===e&&BFN.DesignerModel.projectVO){var p=BFN.DesignerModel.projectVO.sourceTemplateID,g="Design Layout : ";g+=p?"Preset ".concat(p):"Custom",t.actions.push(g)}return r.forEach(e=>{if("text"===e.type){var i=e.iText;for(var r in i.styles)for(var a in i.styles[r]){var n=i.styles[r][a];n.hasOwnProperty("fontFamily")&&!t.fonts.includes(n.fontFamily)&&t.fonts.push(n.fontFamily)}}else{var o=e.assetOrigin;o&&!t.assets.includes(o)&&t.assets.push(o);var s={line:"Outline",solid:"Solid",color:"Multicolor"}[e.graphicStyle];s&&!t.graphicStyles.includes(s)&&t.graphicStyles.push(s);var l=e.projectItemVO,h=[l.graphicID,l.maskImageMaskID,l.imageID].find(e=>e&&e.startsWith("graphic_"));if(h){var c=e.isShape?"svg":"png",u="".concat(h.replace("graphic_",""),".").concat(c);u&&!t.graphicFileNames.includes(u)&&t.graphicFileNames.push(u)}}}),"collage"!==e||BFN.CollageMakerCanvasPhotoGridModel.freeform||BFN.PhotoGrid.gridChildren.forEach(e=>{if(e.menuImageVO&&e.menuImageVO.id){var i=e.menuImageVO.id,r=this.getAssetOrigin(i);r&&!t.assets.includes(r)&&t.assets.push(r)}}),t.actions.sort(),t.fonts.sort(),t.assets.sort(),t}getAssetOrigin(e){var t="Unknown";switch(BFN.getImageType(e)){case"computer":t="Computer";break;case"sample":t="Sample";break;case"befunky_photo":t="BeFunky Photo";break;case"befunky_layer":t="BeFunky Layer";break;case"pixabay":t="Pixabay";break;case"unsplash":t="Unsplash";break;case"pexels":t="Pexels";break;case"facebook":t="Facebook";break;case"patterns":t="Patterns";break;case"graphic":case"template_svg":t="Graphic Library";break;case"image":case"mask_image":t="Template"}return t}getFunnelString(){for(var e=null,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return i.forEach(t=>{t&&"string"==typeof t&&(e||(e=""),e&&(e+=" - "),e+=t)}),e}getEditorToolObject(e){if(!e)return null;var t=e=>BeFunky.LanguageManager.languageData.en[e]||e,i={},r=!0;if(r&&BFN.ArtsyAdjustAndPaintToolObjects.hasOwnProperty(e)){var a=BFN.ArtsyAdjustAndPaintToolObjects[e];if(a.hasOwnProperty("controls")){var n=a.controls;if(n.hasOwnProperty(e+"_id")){switch(i.toolID=e,i.toolName=t(a.name||e),i.toolPresetID=n[e+"_id"].defaultValue,i.toolSearchID=e,a.type){case"edit":i.toolType="Edit";break;case"touch_up":i.toolType="Touch Up";break;case"effect":i.toolType="Basic Effect";break;case"artsy":i.toolType="Artsy";break;case"frame":i.toolType="Frame";break;case"texture":i.toolType="Texture";break;case"overlay":i.toolType="Overlay";break;default:i.toolType="Edit"}r=!1}}}if(r)for(var o in BFN.UIMenuData.accordionMenus){if(!r)break;for(var s=BFN.UIMenuData.accordionMenus[o],l=0;l<s.length&&r;l++)for(var h=s[l].items,c=0;c<h.length&&r;c++){var u=h[c];if(u.name===e){switch(o){case"editor_edit":i.toolType="Edit";break;case"editor_touch_up":i.toolType="Touch Up"}i.toolName=t(u.name),i.toolID=u.name,i.toolSearchID=e,r=!1}}}if(r){var d=BFN.effectPresetMap[e];if(d)for(var m=0;m<BFN.EffectData.length&&r;m++){var p=BFN.EffectData[m];d===p.id&&(i.toolType="Basic Effect",i.toolName=p.name,i.toolID=p.id,i.toolPresetID=e.replace(d+"_",""),i.toolSearchID=e,r=!1)}}if(r&&BFN.LensFlareData.presets.hasOwnProperty(e)){var g=BFN.LensFlareData.presets[e];i.toolType="Basic Effect",i.toolName="Lens Flare",i.toolID="lens_flare",i.toolPresetID=g.presetID,i.toolSearchID=e,r=!1}if(r&&BFN.ArtsyPresetObjects.hasOwnProperty(e)&&BFN.artsyPresetMap.hasOwnProperty(e)){var f=BFN.ArtsyPresetObjects[e],v=BFN.artsyPresetMap[e];if(f.isArtsy)for(var y=["digitalart"],x=0;x<BFN.ArtsyData.length&&r;x++){var _=BFN.ArtsyData[x];v===_.id&&(i.toolType="Artsy",i.toolName=y.includes(_.id)?f.name:_.name,i.toolID=_.id,i.toolPresetID=f.id,i.toolSearchID=e,r=!1)}}if(r){var I=BFN.textureCategoryIDMap[e];if(I){var T=BFN.textureIDMap[I];if(T)for(var b=0;b<BFN.TextureData.length&&r;b++){var S=BFN.TextureData[b];T===S.id&&(i.toolType="Texture",i.toolName=S.name,i.toolID=S.id,i.toolPresetID=I,i.toolSearchID=e,r=!1)}}}if(r)switch(e){case"border":i.toolType="Frame",i.toolName="Border",i.toolID="border",i.toolSearchID=e,r=!1;break;case"drop_shadow":i.toolType="Frame",i.toolName="Drop Shadow",i.toolID="drop_shadow",i.toolSearchID=e,r=!1;break;default:var C=BFN.frameCategoryIDMap[e];if(C){var B=BFN.frameIDMap[C];if(B)for(var F in BFN.FrameData){if(!r)break;for(var E=BFN.FrameData[F],P=0;P<E.length&&r;P++){var N=E[P];B===N.id&&(i.toolType="Frame",i.toolName=N.name,i.toolID=N.id,i.toolPresetID=C,i.toolSearchID=e,r=!1)}}}}if(r&&BFN.OverlaysManager.isDataLoaded){var M=BFN.OverlaysManager.overlayCategoryIDMap[e];if(M){var D=BFN.OverlaysManager.overlayIDMap[M];if(D)for(var w=0;w<BFN.OverlaysManager.overlayMenuData.length&&r;w++){var k=BFN.OverlaysManager.overlayMenuData[w];D===k.id&&(i.toolType="Overlay",i.toolName=k.formattedName,i.toolID=k.id,i.toolPresetID=M,i.toolSearchID=e,r=!1)}}}return!r&&i.toolType&&i.toolName?(i.toolSearchID=e,i):null}handleUserDataChanged(e){!this.sessionStarted&&BFN.BfnService.userLoggedIn&&window.bfn_mp&&(this.sessionStarted=!0,BeFunky.waitUntil({condition:()=>!!BFN.AppModel.viewState,onSuccess:()=>{this.isTrackable=!0,window.bfn_mp.track("app_session_started")},onTimeout:()=>BeFunky.throwError("Unable to track app_session_started")}))}handleAppViewStateUpdated(e){if(this.lastAppViewState!==BFN.AppModel.viewState){var t=this.lastAppViewState;if(this.lastAppViewState=BFN.AppModel.viewState,!t)return;var i=new BFN.UserActionVO;i.eventID="app_section_changed",BFN.AppModel.viewStateChangeReason&&"string"==typeof BFN.AppModel.viewStateChangeReason&&(i.eventObject={reason:BFN.AppModel.viewStateChangeReason},BFN.AppModel.viewStateChangeReason=null),i.superObject={appSection:BFN.AppModel.sectionValue("Photo Editor","Collage Maker","Designer")},i.register()}}handleGlobalHistoryIDUpdated(e){this.updateUserActionVOsActiveState(),this.trackImageLayerAddedUserActionVOsImmediately(),this.trackCollageGridImageAddedUserActionVOsImmediately(),this.updatePendingCollageLayoutSelectedUserActionVO()}handleGlobalHistoryUpdated(e){this.updateUserActionVOsActiveState()}handlePhotoEditorClearItems(e){this.purgeUserActionVOs("editor")}handleCollageMakerClearItems(e){this.purgeUserActionVOs("collage")}handleDesignerClearItems(e){this.purgeUserActionVOs("designer")}get upgradeActions(){var e=BeFunky.getLocal("upgradeActions");return e&&(e=e.split(",")).forEach(e=>{this._upgradeActions.includes(e)||this._upgradeActions.splice(0,0,e)}),this._upgradeActions}}BFN.SingletonQueue.add(function(){BFN.UserActionManager=new Km});class Qm{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.alignmentPanel=null,this.popoverWalkthrough=null,BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.updateAlignmentAvailable.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.updateAlignmentAvailable.bind(this)),BFN.TransformLayerManager.addEventListener(BFN.TransformLayerManagerEvents.ITEMS_UPDATED.type,this.updateAlignmentAvailable.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.updateAlignmentAvailable.bind(this)),document.getElementById("alignment_toggle_panel").parentElement.querySelector('label[for="alignment_toggle_panel"]').preventItemDeselect=!0}initAlignmentPanel(){this.alignmentPanel=document.getElementById("alignment_options_panel"),this.alignmentPanel.setStyles({display:""}),BFN.UI.draggablePanel(this.alignmentPanel),BFN.HelpClueManager.show("alignment_options",{renderOptions:{side:"left",positionFactor:.16,left:"242px",container:this.alignmentPanel.querySelector(".popover-placeholder")}}),this.initPanelHeader()}initPanelHeader(){var e=this.alignmentPanel.querySelector(".panel-header");BFN.UI.panelHeader(e,{name:"alignment",modifier:"alternate",closeEnabled:!0,helpEnabled:!0,helpClueID:"alignment_options"}),e.addEventListener("CLOSE",()=>{UITools.setToolValue("alignment","toggle_panel",!1,!1),UITools.applyTool("alignment"),UITools.updateToolControls("alignment")})}toggleAlignmentPanel(e){this.alignmentPanel||this.initAlignmentPanel();var t=()=>{if(!BFN.MainUI.viewportUpdating||!e||e&&this.temporarilyHidePanel)if(e){var i=this.alignmentPanel.panelSize,r=BFN.appViewportRect;this.temporarilyHidePanel?(this.temporarilyHidePanel=!1,this.alignmentPanel.show()):this.alignmentPanel.show(r.x+26,r.y+r.height-i.height-10)}else this.hasOwnProperty(this.togglePanelTimeoutID)&&(clearTimeout(this.togglePanelTimeoutID),delete this.togglePanelTimeoutID),this.alignmentPanel.hide();else this.togglePanelTimeoutID=setTimeout(()=>{t()},10)};t()}updateAlignmentAvailable(){var e=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&!BFN.TransformItemIsolator.active;BFN.AppModel.viewingEditor?e=e&&BFN.PhotoEditorModel.currentTexture:e&&this.temporarilyHidePanel&&(UITools.setToolValue("alignment","toggle_panel",!0),UITools.applyTool("alignment"),UITools.updateToolControls("alignment")),!e&&UITools.getToolValue("alignment","toggle_panel")?this.temporarilyHidePanel=!0:e&&this.temporarilyHidePanel&&(UITools.setToolValue("alignment","toggle_panel",!0),UITools.applyTool("alignment"),UITools.updateToolControls("alignment")),document.getElementById("alignment_toggle_panel").disabled=!e,!e&&UITools.getToolValue("alignment","toggle_panel")&&(UITools.setToolValue("alignment","toggle_panel",!1),UITools.applyTool("alignment"),UITools.updateToolControls("alignment"))}handleAlignmentUpdate(){var e=UITools.getToolVO("alignment");switch(e.updating_id){case"toggle_panel":this.toggleAlignmentPanel(e.toggle_panel);break;case"snapping":var t="enabled"===e.snapping;BFN.TransformModel.snappingEnabled=t,BFN.SettingsManager.updateSetting("snapping",t?"yes":"no");break;case"display_distances":var i="enabled"===e.display_distances;BFN.TransformModel.showMeasurements=i,BFN.SettingsManager.updateSetting("display_distances",i?"yes":"no");break;case"guides":var r="enabled"===e.guides;BFN.TransformGuides.updateVisibility(),BFN.SettingsManager.updateSetting("guides",r?"yes":"no")}}}BFN.SingletonQueue.add(()=>{BFN.AlignmentOptionsManager=new Qm});class Zm{constructor(){this.init()}init(){BeFunky.log("BasicShapeManager Init"),this.initDefaultValues()}initDefaultValues(){this.validShapeTypes=["group","line","rectangle","triangle","ellipse","polygon","star","arrow"],this.defaultValues={fill:"FFFFFF",fillAlpha:1,stroke:-1,strokeAlpha:1,strokeWidth:10,lineStyle:"solid",lineSegmentWidth:3,lineGapSize:.5,rectangleCornerRounding:0,polygonSides:5,polygonShiftOrientation:!1,starPoints:5,starInsetWeight:.5,starShiftOrientation:!1,arrowWeight:.25,arrowStyle:"thick",arrowDoubleSided:!1},this.ghostColor=8421504,this.ghostAlpha=.5}createShape(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.validShapeTypes.includes(e)){switch(i.hasOwnProperty("fill")||(i.fill=this.defaultValues.fill),i.hasOwnProperty("fillAlpha")||(i.fillAlpha=this.defaultValues.fillAlpha),i.hasOwnProperty("stroke")||(i.stroke=this.defaultValues.stroke),i.hasOwnProperty("strokeAlpha")||(i.strokeAlpha=this.defaultValues.strokeAlpha),i.hasOwnProperty("strokeWidth")||(i.strokeWidth=this.defaultValues.strokeWidth),e){case"line":i.hasOwnProperty("lineStyle")||(i.lineStyle=this.defaultValues.lineStyle),i.hasOwnProperty("lineSegmentWidth")||(i.lineSegmentWidth=this.defaultValues.lineSegmentWidth),i.hasOwnProperty("lineGapSize")||(i.lineGapSize=this.defaultValues.lineGapSize),i.fill=-1,i.fillAlpha=1;break;case"rectangle":i.hasOwnProperty("rectangleCornerRounding")||(i.rectangleCornerRounding=Math.min(.5,this.defaultValues.rectangleCornerRounding));break;case"polygon":i.hasOwnProperty("polygonSides")||(i.polygonSides=this.defaultValues.polygonSides),i.hasOwnProperty("polygonShiftOrientation")||(i.polygonShiftOrientation=this.defaultValues.polygonShiftOrientation);break;case"star":i.hasOwnProperty("starPoints")||(i.starPoints=this.defaultValues.starPoints),i.hasOwnProperty("starInsetWeight")||(i.starInsetWeight=this.defaultValues.starInsetWeight),i.hasOwnProperty("starShiftOrientation")||(i.starShiftOrientation=this.defaultValues.starShiftOrientation),i.stroke=-1,i.strokeAlpha=1,i.strokeWidth=0;break;case"arrow":i.hasOwnProperty("arrowWeight")||(i.arrowWeight=this.defaultValues.arrowWeight),i.hasOwnProperty("arrowStyle")||(i.arrowStyle=this.defaultValues.arrowStyle),i.hasOwnProperty("arrowDoubleSided")||(i.arrowDoubleSided=this.defaultValues.arrowDoubleSided),i.stroke=-1,i.strokeAlpha=1,i.strokeWidth=0}"line"===e&&-1===i.stroke&&(i.stroke="FFFFFF",i.strokeAlpha=1);var r=new BFN.BasicShapeVO(e,i),a=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),n={type:"texture",texture:null,isGoodie:!0,basicShapeVO:r};t&&(n.initialCenterPosition=t),a.addedItem=n}}updateDefaultValues(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e)this.defaultValues.hasOwnProperty(t)&&(this.defaultValues[t]=e[t])}drawShape(e){if(e){var t=["line"].includes(e.type),i=e.fillColor,r=Math.max(.01,e.fillAlpha),a=e.strokeColor,n=Math.max(.01,e.strokeAlpha),o=-1!==e.stroke||t?e.strokeWidth*e.fitScale:0,s=e.shapeW,l=e.shapeH;e.shape.clear();var h=null;switch(e.type){case"line":this.drawLine(e,s,l,o);break;case"triangle":h=this.getTrianglePoints(s,l,o);break;case"rectangle":h=this.getRectPoints(s,l,o,e.attributes.rectangleCornerRounding);break;case"ellipse":h=this.getPolygonPoints(s,l,o,128,!0);break;case"polygon":h=this.getPolygonPoints(s,l,o,e.attributes.polygonSides,e.attributes.polygonShiftOrientation);break;case"star":h=this.getStarPoints(s,l,e.attributes.starPoints,e.attributes.starInsetWeight,e.attributes.starShiftOrientation);break;case"arrow":h=this.getArrowPoints(s,l,e.attributes.arrowStyle,e.attributes.arrowWeight,e.attributes.arrowDoubleSided)}h&&this.drawInsetShape(e,h.outerPoints,h.innerPoints,i,r,a,n,o)}}drawInsetShape(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(e&&t)if(i=i||null,window.testShapes)this.drawRect(e,e.shapeW,e.shapeH,16711680),this.drawFill(e,t,16777215,1),i&&(i.forEach((t,r)=>{r||e.shape.lineStyle(2,0),e.shape.moveTo(t.x,t.y);var a=i[(r+1)%i.length];e.shape.lineTo(a.x,a.y)}),e.shape.lineStyle(null),i.forEach(t=>{t.invalid?e.shape.beginFill(16711680,.6):t.intersection?e.shape.beginFill(16711935,.6):e.shape.beginFill(255,.6),e.shape.drawCircle(t.x,t.y,t.invalid?5:10),e.shape.endFill()}));else if(i&&!i.length)s?null!==n?this.drawFill(e,t,n,o):this.drawFill(e,t,this.ghostColor,this.ghostAlpha):null!==r?this.drawFill(e,t,r,a):this.drawFill(e,t,this.ghostColor,this.ghostAlpha);else{var l=!1,h=!1;i&&(i.length&&(t.push(t[0]),i.reverse(),t.push(...i),t.push(i[0])),this.drawFill(e,t,n,o),l=!0),null!==r&&(s&&i&&i.length?(l&&i.reverse(),this.drawFill(e,i,r,a)):this.drawFill(e,t,r,a),h=!0),h||l||this.drawFill(e,t,this.ghostColor,this.ghostAlpha)}}drawFill(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e&&t&&!(t.length<3)){var a=e.shape;a.lineStyle(null),null!==i&&a.beginFill(i,r),t.forEach((e,t)=>{t?a.lineTo(e.x,e.y):a.moveTo(e.x,e.y)}),null!==i?a.endFill():a.addHole()}}drawRect(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!(!e||t<=0||i<=0)){var n=t,o=i,s=e.shapeW/2,l=e.shapeH/2;this.drawFill(e,[{x:s-n/2,y:l-o/2},{x:s+n/2,y:l-o/2},{x:s+n/2,y:l+o/2},{x:s-n/2,y:l+o/2}],r,a)}}drawLine(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!(!e||t<=0||i<=0||r<=0)){switch(e.shape.drawRect(0,(i-r)/2,t,r),e.shape.beginFill(e.strokeColor,e.strokeAlpha),e.attributes.lineStyle){case"solid":e.shape.drawRect(0,(i-r)/2,t,r);break;case"dashed":for(var a=Math.min(t,r*e.attributes.lineSegmentWidth),n=a*(1+e.attributes.lineGapSize),o=0;o<t;o+=n)e.shape.drawRect(o,(i-r)/2,Math.min(a,t-o),r);break;case"dotted":for(var s=Math.min(t,r)/2,l=s*(2+2*e.attributes.lineGapSize),h=s;h<t;h+=l)h+s<=t&&e.shape.drawCircle(h,i/2,s)}e.shape.endFill()}}drawBezierEllipse(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(!(!e||t<=0||i<=0)){var o=.551915024494,s=Math.abs(t),l=Math.abs(i),h=e.shapeW/2,c=e.shapeH/2,u=h-.5*s,d=h+.5*s,m=c-.5*l,p=c+.5*l,g=o*s*.5,f=l*o*.5;null!==r&&e.shape.beginFill(r,a),e.shape.lineStyle(null),e.shape.moveTo(h,m),e.shape.bezierCurveTo(h+g,m,d,c-f,d,c),e.shape.bezierCurveTo(d,c+f,h+g,p,h,p),e.shape.bezierCurveTo(h-g,p,u,c+f,u,c),e.shape.bezierCurveTo(u,c-f,h-g,m,h,m),null!==n&&n<=Math.min(s,l)/2&&(u=h-.5*(s-=2*n),d=h+.5*s,m=c-.5*(l-=2*n),p=c+.5*l,g=o*s*.5,f=l*o*.5,e.shape.lineTo(h,m),e.shape.bezierCurveTo(h-g,m,u,c-f,u,c),e.shape.bezierCurveTo(u,c+f,h-g,p,h,p),e.shape.bezierCurveTo(h+g,p,d,c+f,d,c),e.shape.bezierCurveTo(d,c-f,h+g,m,h,m)),null!==r?e.shape.endFill():e.shape.addHole()}}getLinePoints(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e<=0||t<=0||i<=0?{outerPoints:[],innerPoints:[]}:{outerPoints:[new PIXI.Point(0,Math.round((t-i)/2)),new PIXI.Point(e,Math.round((t-i)/2)),new PIXI.Point(e,Math.round((t+i)/2)),new PIXI.Point(0,Math.round((t+i)/2))],innerPoints:[]}}getTrianglePoints(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<=0||t<=0||i<0)return{outerPoints:[],innerPoints:[]};var r=[new PIXI.Point(e/2,0),new PIXI.Point(0,t),new PIXI.Point(e,t)],a=Math.atan(t/(e/2)),n=Math.atan(e/2/t),o=i/Math.sin(a)+Math.tan(Math.PI/2-a)*i,s=i/Math.sin(n),l=Math.max(0,e-2*o),h=Math.max(0,t-s-i),c=[];return i>0&&l>0&&h>0&&(c=[new PIXI.Point(e/2,s),new PIXI.Point(o,t-i),new PIXI.Point(e-o,t-i)]),{outerPoints:r,innerPoints:c}}getRectPoints(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=e-2*i,n=t-2*i;if(a<=0||n<=0)return[];var o=[];if(r>0){for(var s=[],l=Math.min(a,n)/2*r,h=Math.max(8,Math.min(128,Math.round(l*(2*Math.PI)/4))),c=(h-=h%4)/4,u=-Math.PI/2,d=0;d<h;d++){var m=new PIXI.Point(Math.cos(u)*l,Math.sin(u)*l);m.x+=e/2,m.y+=t/2,s.push(m),u+=2*Math.PI/h}for(var p=0;p<4;p++)for(var g=0;g<=c;g++){var f=s[(p*c+g)%s.length].clone();f.x+=(a/2-l)*([0,1].includes(p)?1:-1),f.y+=(n/2-l)*([1,2].includes(p)?1:-1);var v=!0;g===c&&(a===2*l&&[1,3].includes(p)&&(v=!1),n===2*l&&[0,2].includes(p)&&(v=!1)),v&&o.push(f)}}else{var y=(e-a)/2,x=(t-n)/2;o.push(new PIXI.Point(e-y,x),new PIXI.Point(e-y,t-x),new PIXI.Point(y,t-x),new PIXI.Point(y,x))}return o};return{outerPoints:a(0),innerPoints:i>0?a(i):null}}getPolygonPoints(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e<=0||t<=0)return{outerPoints:[],innerPoints:null};for(var n=[],o=-Math.PI/2,s=0;s<r;s++){var l=new PIXI.Point(Math.cos(o)*(e/2),Math.sin(o)*(t/2));n.push(l),o+=2*Math.PI/r}if(a){for(var h=[],c=0;c<n.length;c++){var u=n[c],d=n[(c+1)%n.length],m=new PIXI.Point((u.x+d.x)/2,(u.y+d.y)/2);h.push(m)}n.splice(0),n.push(...h)}var p=null;n.forEach(e=>{p?(p.left=Math.min(p.left,e.x),p.right=Math.max(p.right,e.x),p.top=Math.min(p.top,e.y),p.bottom=Math.max(p.bottom,e.y)):p=new BFN.Rectangle(e.x,e.y)});var g=Math.min(e/p.width,t/p.height);n.forEach(i=>{i.x*=g,i.y*=g,i.x+=e/2-p.center*g,i.y+=t/2-p.middle*g});var f=null;return i>0&&(f=this.insetPolygon(n,i)),{outerPoints:n,innerPoints:f,centerPoint:new PIXI.Point(e/2-p.center*g,t/2-p.middle*g)}}insetPolygon(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e||e.length<3)return null;if(!t)return[...e];t=Math.abs(t);for(var i=[],r=null,a=null,n=0;n<e.length;n++){var o=e[n],s=e[(n-1+e.length)%e.length],l=e[(n+1)%e.length],h=Math.atan2(s.y-o.y,s.x-o.x),c=Math.atan2(l.y-o.y,l.x-o.x),u=Math.abs(c-h),d=(h+c)/2;u>Math.PI&&(u=2*Math.PI-u,d+=Math.PI);var m=u/2,p=t/Math.sin(m),g=new PIXI.Point(o.x+Math.cos(d)*p,o.y+Math.sin(d)*p);(null===r||o.y>r)&&(r=o.y,a=g.y),i.push(g)}var f=i[0].y>a,v=[];if(!f){v.push(...this.getIntersectionPoints(i));for(var y=v.length;--y>-1;){var x=v[y];i.splice(x.index+1,0,x)}}for(var _=!1,I=f,T=0;T<i.length;T++){var b=i[T],S=i[(T+1)%i.length];!T&&!f&&e.length>3&&(I=(I=Math.cos(Math.atan2(S.y-b.y,S.x-b.x))<-1e-10)||b.x-i[i.length-1].x<0),f?b.invalid=!0:b.intersection?(b.invalid=!1,I=!I):b.invalid=I,_=_||I}if(!window.testShapes){if(_)for(var C=i.length;--C>-1;){i[C].invalid&&i.splice(C,1)}if(v.length)for(var B=i.length;--B>0;){var F=i[B],E=i[B-1];F.intersection&&E.intersection&&F.rootPoint===E.rootPoint&&i.splice(B,1)}}return i}getIntersectionPoints(e){if(!e||e.length<3)return null;var t=[];e.forEach((i,r)=>{var a={ptA:i,ptB:e[(r+1)%e.length],bounds:new BFN.Rectangle(i.x,i.y)};a.bounds.left=Math.min(a.ptA.x,a.ptB.x),a.bounds.right=Math.max(a.ptA.x,a.ptB.x),a.bounds.top=Math.min(a.ptA.y,a.ptB.y),a.bounds.bottom=Math.max(a.ptA.y,a.ptB.y);var n=Math.atan2(a.ptB.y-a.ptA.y,a.ptB.x-a.ptA.x),o=Math.sin(n),s=Math.cos(n);a.slope=o?s?o/s:1/0:0,a.intercept=a.slope===1/0?NaN:0===a.slope?a.ptB.y:a.ptB.y-a.slope*a.ptB.x,t.push(a)});for(var i=(e,t,i,r)=>{var a=(t.x-e.x)*(r.y-i.y)-(r.x-i.x)*(t.y-e.y);if(0===a)return!1;var n=((r.y-i.y)*(r.x-e.x)+(i.x-r.x)*(r.y-e.y))/a,o=((e.y-t.y)*(r.x-e.x)+(t.x-e.x)*(r.y-e.y))/a;return 0<n&&n<1&&0<o&&o<1},r={},a=0;a<t.length;a++)for(var n=t[a],o=0;o<t.length;o++)if(![a-1,a,(a+1)%t.length].includes(o)){var s=t[o];if(n.slope!==s.slope&&i(n.ptA,n.ptB,s.ptA,s.ptB)){var l=Math.min(a,o)+"_"+Math.max(a,o),h=new PIXI.Point;h.startIndex=Math.min(a,o),h.endIndex=Math.max(a,o),n.slope===1/0&&0===s.slope?(h.x=n.ptA.x,h.y=s.ptA.y):s.slope===1/0&&0===n.slope?(h.x=s.ptA.x,h.y=n.ptA.y):(h.x=(s.intercept-n.intercept)/(n.slope-s.slope),h.y=s.slope*h.x+s.intercept),r.hasOwnProperty(l)?(r[l].x=(r[l].x+h.x)/2,r[l].y=(r[l].y+h.y)/2):r[l]=h}}var c=(e,t)=>{var i=e.clone();return i.index=t,i.intersection=!0,i.rootPoint=e,i},u=[];for(var d in r){var m=r[d];u.push(c(m,m.startIndex),c(m,m.endIndex))}return u.sort((e,t)=>e.index-t.index),u}getStarPoints(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e<=0||t<=0)return{outerPoints:[],innerPoints:null};for(var n=this.getPolygonPoints(e,t,0,i,a),o=[],s=0;s<n.outerPoints.length;s++){var l=n.outerPoints[s],h=n.outerPoints[(s+1)%n.outerPoints.length],c=new PIXI.Point((l.x+h.x)/2,(l.y+h.y)/2),u=c.x-n.centerPoint.x,d=c.y-n.centerPoint.y,m=Math.sqrt(Math.pow(u,2)+Math.pow(d,2)),p=Math.atan2(d,u),g=Math.max(Math.min(2,e/2,t/2),m*(1-r)),f=new PIXI.Point(n.centerPoint.x+Math.cos(p)*g,n.centerPoint.y+Math.sin(p)*g);o.push(l,f)}return{outerPoints:o,innerPoints:null}}getArrowPoints(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"thick",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e<=0||t<=0||!["thick","thin"].includes(i))return{outerPoints:[],innerPoints:null};var n=[];switch(i){case"thick":var o=t/2/Math.tan(Math.PI/6),s=a?e/2:0,l=Math.max(s,e-o),h=e/2,c=Math.min(h,o);if(n.push(new PIXI.Point(l,0),new PIXI.Point(e,t/2),new PIXI.Point(l,t)),l>s){var u=t/2*(1-r),d=Math.round(t-2*u),m=Math.round((t-d)/2),p=Math.round((t+d)/2);r<1&&n.push(new PIXI.Point(e-o,p)),n.push(new PIXI.Point(a?c:0,p)),a&&n.push(new PIXI.Point(c,t),new PIXI.Point(0,t/2),new PIXI.Point(c,0)),n.push(new PIXI.Point(a?c:0,m)),r<1&&n.push(new PIXI.Point(e-o,m))}else n.push(new PIXI.Point(0,t/2));break;case"thin":var g=r*(t/(1+2*Math.sin(Math.PI/4))/1-2)+2,f=t/2,v=Math.sin(Math.PI/4)*g,y=f+v,x=a?e/2:0,_=e/2;if(a){var I=[new PIXI.Point(0,t/2),new PIXI.Point(f,0),new PIXI.Point(y,v)];1===r&&I.pop(),I.forEach(e=>{e.x=Math.min(_,e.x)}),n.push(...I)}n.push(new PIXI.Point(a?Math.min(_,2*v+g/2):0,t/2-g/2));var T=[new PIXI.Point(e-2*v-g/2,t/2-g/2),new PIXI.Point(e-y,v),new PIXI.Point(e-f,0),new PIXI.Point(e,t/2),new PIXI.Point(e-f,t),new PIXI.Point(e-y,t-v),new PIXI.Point(e-2*v-g/2,t/2+g/2)];if(1===r&&(T.pop(),T.shift()),T.forEach(e=>{e.x=Math.max(x,e.x)}),n.push(...T),n.push(new PIXI.Point(a?Math.min(_,2*v+g/2):0,t/2+g/2)),a){var b=[new PIXI.Point(y,t-v),new PIXI.Point(f,t)];1===r&&b.shift(),b.forEach(e=>{e.x=Math.min(_,e.x)}),n.push(...b)}n.forEach(e=>{e.y=Math.floor(e.y)})}return{outerPoints:n,innerPoints:null}}}function Jm(){var t=e(["<strong>","</strong>"]);return Jm=function(){return t},t}function $m(){var t=e(["<strong>","</strong>"]);return $m=function(){return t},t}function ep(){var t=e(["\n    <div id=",' class="modal image-preview">\n        <div class="image-preview__left-column">\n            <div class="image-preview__image-wrapper">\n                <img class="image-preview__image" src="','" alt="Image with background removed">\n            </div>\n        </div>\n        <div class="image-preview__right-column">\n            <h3 class="image-preview__header">',"</h3>\n            <p>","</p>\n            <p>",'</p>\n            <div class="checkbox">\n                <input type="checkbox" id="','" @change=','>\n                <label class="checkbox__label control-item-label" for="','">\n                    ',"\n                    ","\n                    <string>",'</string>\n                </label>\n            </div>\n            <div class="image-preview__footer button-group">\n                <button class="modal__button button button--grey button--cancel" @click=',">\n                    ",'\n                </button>\n                <button class="modal__button button button--blue focus-initially" @click=',">\n                    ","\n                </button>\n            </div>\n        </div>\n    </div>"]);return ep=function(){return t},t}BFN.SingletonQueue.add(()=>{BFN.BasicShapeManager=new Zm});var tp=BeFunky.lit,ip=tp.appLang,rp=tp.icon,ap=tp.elem,np=tp.html;class op{constructor(){this.init()}init(){BeFunky.log("BackgroundRemovalManager Init"),this.artsyServiceURL="https://upload.befunky.com/artsy/",this.initDefaultValues(),this.initPreviewComponents()}initDefaultValues(){this.lastSourceTexture=null,this.lastUploadUrl=null}initPreviewComponents(){this.maskedContainer=new PIXI.Container,this.backgroundSprite=new PIXI.Sprite,this.backgroundSprite.texture=PIXI.Texture.EMPTY,this.maskedContainer.addChild(this.backgroundSprite),this.sourceSprite=new PIXI.Sprite,this.maskedContainer.addChild(this.sourceSprite),this.maskSprite=new PIXI.Sprite,this.maskedContainer.addChild(this.maskSprite),this.sourceSprite.mask=this.maskSprite}getRandomFileName(e,t){var i,r,a,n,o,s=(r=i?new Date(i):new Date,a="".concat(r.getMonth()+1),n="".concat(r.getDate()),o=r.getFullYear(),a.length<2&&(a="0".concat(a)),n.length<2&&(n="0".concat(n)),[o,a,n]),l=function(e){return(e?new Date(e):new Date).toTimeString().split(" ")[0].split(":")}();return"".concat(e,"_").concat(s.join(""),"_").concat(l.join(""),"_").concat(Math.random().toString(36).substr(2,5),".").concat(t)}reset(){this.lastSourceTexture=null,this.lastUploadUrl=null}removeBackground(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};if(e)if(e&&e.baseTexture&&e.baseTexture.maskTexture)t(e.baseTexture.maskTexture);else{var i=!1;BeFunky.showLoadScreen({onCancel:()=>{i=!0,t()}});var r=(r,a)=>{var o=this.artsyServiceURL,s={method:"api/remove-background/",image:r,masking:"0"};BeFunky.Params.isAdmin&&(s.is_beta="1");var l={method:"POST",body:BeFunky.createFormData(s),headers:{"X-CSRF-Token":getCsToken()}};UIMessages.display("isolating_subject",650);var h=BeFunky.trackUserTiming("Background Removal","remove_background","network");BeFunky.request(o,l,r=>{var o=r.error,s=r.response;if(h(),!i){if(o||!s||s&&!s.data)return n("Background removal request failed",o||"no_response");var l=s.data,c=l.image;if(!l.success)return n("Background removal failed",s);if(!c)return n("Got invalid response from background removal API",s);var u={textureSize:BFN.maxImageSize,readEXIF:!1};BFN.RequestUtils.getTexture(c,u,r=>{var o=r.error,s=r.texture;if(!i){if(o)return n("Unable to download image and convert to texture",o);BeFunky.hideLoadScreen(),this.handleBackgroundRemovalImageTexture(e,s,a,t)}})}})},a=PIXI.RenderTexture.create(e.width,e.height);a.fillColor(0),a.copyPixels(e,null,!1),BFN.Stage.extract.canvas(a).toBlob(t=>{if(a.destroyGC(!0),!i){if(!t)return n("Unable to generate blob background removal",t);if(null!=this.lastUploadUrl&&e===this.lastSourceTexture)r(this.lastUploadUrl,t);else if(void 0!==window.DirectUPL){UIMessages.display("preparing_image");var o=BeFunky.trackUserTiming("Background Removal","upload_image","network");this.lastSourceTexture=e,window.DirectUPL.upload(e=>{if(e&&e.url&&e.s3_name){if(o(),this.lastUploadUrl=e.url,i)return;r(e.url,t)}else n("Background removal image upload failed",e)},{bucket:"background-removal",content_type:"image/jpeg",blob:t,filename:"uploads/".concat(this.getRandomFileName("BGR","jpg"))})}}},"image/jpeg",.95)}else t();function n(e,r){BeFunky.throwError(e,r),i||(t(),BeFunky.hideLoadScreen(),UIMessages.display(e,1500))}}isolateSubjectOnPainter(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};if(e&&BFN.ImagePainterUndoManager.currentImagePainter)if(this.isolateSubjectOnPainterWithHistory())i();else{var r=BFN.ImagePainterUndoManager.currentImagePainter;this.removeBackground(e,e=>{if(e){var a=!!r.altTexture,n=a?r.altTexture:r.texture;r.subjectIsolated=!0,r.updatePrevTexture(),a&&n.fillColor(0),n.copyPixels(e,void 0,!a),t&&(n.invert(),a||n.convertLumaToAlpha()),r.updateComplete(),r.paintBounds=new PIXI.Rectangle(0,0,n.width,n.height),r.paintApplied=!0,r.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED),r.subjectIsolated=!1,i(),BFN.MainUI.requestRender()}else i()})}}isolateSubjectOnPainterWithHistory(){if(BFN.ImagePainterUndoManager.currentImagePainter&&BFN.ImagePainterUndoManager.regionVOs.length){var e=BFN.ImagePainterUndoManager.regionVOs[BFN.ImagePainterUndoManager.regionIndex];if(e.redoRegionTexture.subjectIsolated){switch(BFN.ImagePainterUndoManager.direction){case"undo":if(BFN.UndoManager.redoExists)return console.log("SIMPLE REDO, THEN CLEAR REMAINING REGION VOs (SUBJECT ALREADY ISOLATED IN REDO)"),BFN.ImagePainterUndoManager.clearRegionVOs(BFN.ImagePainterUndoManager.regionIndex+1),BFN.UndoManager.redo(),!0;break;case"redo":return console.log("DO NOTHING BUT CLEAR REMAINING REGION VOs (SUBJECT ALREADY ISOLATED)"),BFN.ImagePainterUndoManager.clearRegionVOs(BFN.ImagePainterUndoManager.regionIndex+1),!0}return!1}if(e.undoRegionTexture.subjectIsolated&&"undo"===BFN.ImagePainterUndoManager.direction)return console.log("DO NOTHING (SUBJECT ALREADY ISOLATED IN UNDO STATE)"),!0}return!1}getCurrentEditorToolObject(){var e=BFN.PhotoEditorCanvasTools,t=null,i=null;switch(e.currentTool){case e.cutout:i="cutout";break;case e.background:i="background";break;case e.effect:if(t=BFN.EffectManager.effectID&&BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("effectName")?BFN.EffectManager.parameters.effectName:BFN.EffectManager.effectID,null!=BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("toolID"))try{i=(BFN.UIToolData.hasOwnProperty(BFN.EffectManager.parameters.toolID),BFN.EffectManager.parameters.toolID)}catch(e){}break;case e.artsy:t="artsy",i=BFN.ImageArtsy.currentToolID?BFN.ImageArtsy.currentToolID:null,BFN.ImageArtsy.currentToolID&&BFN.ArtsyPresetObjects.hasOwnProperty(BFN.ImageArtsy.currentToolID)&&BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID]&&BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].name&&(t=BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].name);break;case e.texture:t=BFN.ImageTexture.currentTextureName,i=BFN.ImageTexture.currentTextureID?BFN.ImageTexture.currentTextureID:null}return i||t?BFN.UserActionManager.getEditorToolObject(i||t):{}}handleBackgroundRemovalImageTexture(e,t,i,r){e.altTexture?(this.backgroundSprite.texture=e.altTextureInverse?e.renderClone():e.altTexture.renderClone(),this.backgroundSprite.texture.fillColorOverlap(16711680,.5),this.sourceSprite.texture=e.altTextureInverse?e.altTexture:e):(this.backgroundSprite.texture=PIXI.Texture.EMPTY,this.sourceSprite.texture=e),this.maskSprite.texture=t;var a,n=PIXI.RenderTexture.create(e.width,e.height);if(BFN.Stage.render(this.maskedContainer,n),this.backgroundSprite.texture!==PIXI.Texture.EMPTY&&(this.backgroundSprite.texture.destroyGC(!0),this.backgroundSprite.texture=PIXI.Texture.EMPTY),this.sourceSprite.texture=PIXI.Texture.EMPTY,this.maskSprite.texture=PIXI.Texture.EMPTY,BFN.BfnService.userIsPlus){a=Math.max(...BFN.TextureUtils.getScaledDimensions(n,{maxWidth:544,maxHeight:384}))}else a=480;var o=BFN.Util.getThumbTexture(n,a);n.destroyGC(!0);var s=BFN.TextureUtils.textureToBase64(o),l=o.width/o.height;o.destroyGC(!0);var h=()=>{function e(){BeFunky.logError(...arguments)}UIMessages.display("thanks_for_sharing"),BeFunky.requestAPI("photo/rec-ai-errored-image",{image:this.lastUploadUrl}).then(t=>{"success"!==t.data&&e("Share background removal image failed:",t.data)}).catch(t=>{e("Share background removal image request failed:",t||"no_response")})},c=(e,t)=>{var i=this.getCurrentEditorToolObject();i.imageLayer=!!BFN.TransformModel.layerItem,i.imageShared=e,i.imageRejected=t;var r=new BFN.UserActionVO;r.eventID="background_remover_applied",r.eventObject=i,r.track()};if(BFN.BfnService.userIsPlus)!function(e){var t=e.previewBase64,i=e.onApply,r=e.onCancel,a=!1,n=!1,o=!1,s="background_remover_preview_".concat(BeFunky.randomString(10)),l="background_remover_share_".concat(BeFunky.randomString(10)),h=ap(ep(),s,t,ip("preview_your_results"),ip("background_remover_preview_modal_body_1"),ip(["background_remover_preview_modal_body_2",{keep:np($m(),ip("keep",!0)),remove:np(Jm(),ip("remove",!0))}]),l,e=>{a=e.target.checked},l,rp("checkbox-selected","icon icon-size-medium checkbox__icon checkbox__icon--light checkbox__icon--checked"),rp("checkbox-unselected","icon icon-size-medium checkbox__icon checkbox__icon--light checkbox__icon--unchecked"),ip("background_remover_preview_modal_checkbox"),function(){o=!0,n=!1,BeFunky.closeModal(s)},rp("global-cancel-icon","icon icon-size-medium"),function(){o=!0,n=!0,BeFunky.closeModal(s)},rp("global-apply-icon","icon icon-size-large"));BeFunky.openModal(h,{destroyOnClose:!0,size:[960,480],onClose:()=>{if(!o)return r(!1);n?i(a):r(a)},closeOnClickOutside:!1})}({previewBase64:s,onApply:i=>{r?(t.convertLumaToAlpha(),e.baseTexture.maskTexture=t,r(t)):t.destroyGC(!0),i&&h(),c(i,!1)},onCancel:e=>{t.destroyGC(!0),r&&r(),e&&h(),c(e,!0)}});else{var u=Boolean(e.altTexture);t.destroyGC(!0),r&&r();var d=BFN.Util.getThumbTexture(e,a),m=BFN.TextureUtils.textureToBase64(d);d.destroyGC(!0),u?BeFunky.createAndOpenTeaser("isolate_subject",{featureName:"this_feature",text:"teaser_isolate_subject_body",images:[m,s],imageAspectRatio:l,learnMoreLink:"".concat(BeFunky.Params.siteUrl,"learn/automatic-background-remover/")}):BeFunky.createAndOpenTeaser("background_removal",{headingText:"teaser_background_remover_title",text:"teaser_background_remover_body",images:[m,s],imageAspectRatio:l,learnMoreLink:"".concat(BeFunky.Params.siteUrl,"learn/automatic-background-remover/")});var p=this.getCurrentEditorToolObject(),g=["Background Remover"];p.toolType&&g.push(p.toolType),p.toolName&&g.push(p.toolName),p.toolSearchID&&g.push(p.toolSearchID),BFN.UserActionManager.addUpgradeAction(g)}}}BFN.SingletonQueue.add(()=>{BFN.BackgroundRemovalManager=new op}),BFN.EditLayerManagerEvents={};class sp extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){BeFunky.log("EditLayerManager Init"),this.initDefaultValues()}initDefaultValues(){}editTransformItem(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=BFN.TransformModel.selectedTransformItem;!r||r.isGoodie||"texture"!=r.type&&"frame_texture"!=r.type||(BFN.TransformModel.layerItem=r,BFN.TransformItemIsolator.isolateTransformItem(BFN.TransformModel.selectedTransformItem,()=>{switch(BFN.PhotoEditorMenuModel.createCurrentImageThumb(r.getPresetItemThumbTexture(),!0),BFN.TransformItemIsolator.itemSprite.visible=!0,UIToggler.toggleMainMenu(!0),BFN.updateAppMenuDisplay("edit_layer"),e){case"cutout":UITools.setToolValue("editor_edit","cutout",!0),UITools.applyTool("editor_edit"),UITools.setToolValue("editor_edit","cutout",!1)}t&&t()},()=>{BFN.PhotoEditorModel.sourceTexture&&BFN.PhotoEditorMenuModel.createCurrentImageThumb(BFN.PhotoEditorModel.sourceTexture),BFN.TransformModel.layerItem=null,BFN.updateAppMenuDisplay(),this.updatePanelsAvailable(),i&&i()}),this.updatePanelsAvailable())}editTransformItemAlternateMenu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!BFN.TransformItemIsolator.isolatedTransformItem&&e&&BFN.toolViewstates.hasOwnProperty(e)){var r=BFN.toolViewstates[e],a=e+"_menu",n="tool_controls",o=null,s=null,l=null,h=()=>{if(o=document.getElementById(a))try{o.generateItem(),o.setupItem(),o.buildItem(),s=o.querySelector(".preset-menu-item-advanced-settings-padding-container"),n=o.options.presetName,l=o}catch(e){console.log("error",e)}};switch(r){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP:BFN.touchupPaintMenus.hasOwnProperty(a)&&"touchup"===BFN.effectIDMap[e]&&(BFN.setupTouchupPaintMenu(a),(o=document.getElementById(a))&&(s=o.querySelector(".control-item-set")),n=e);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:BFN.effectPresetMap.hasOwnProperty(e)?h():BFN.adjustAndPaintMenus.hasOwnProperty(a)&&(BFN.setupAdjustAndPaintMenu(a),(o=document.getElementById(a))&&(s=o.querySelector(".control-item-set")),n=e);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY:BFN.artsyPresetMap.hasOwnProperty(e)&&h();break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME:break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE:BFN.textureCategoryIDMap.hasOwnProperty(e)&&BFN.texturePresetMap.hasOwnProperty(BFN.textureCategoryIDMap[e])&&h();break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY:break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE:BFN.lensFlarePresetMap.hasOwnProperty(e)&&h();break;default:(o=document.getElementById(a))&&(s=o.querySelector(".control-item-set")),n=e}if(s){var c=BFN.TransformModel.selectedTransformItem;if(c&&!c.isGoodie&&("texture"==c.type||"frame_texture"==c.type)){var u=s.querySelector(".apply_cancel_menu_container");if(u){var d=document.getElementById("editor_apply_cancel_menu");d.upgradeMode=!!UITools.toolPlusHash[e]&&!BFN.BfnService.userIsPlus,u.appendChild(d),document.getElementById("layer_isolator_tool_menu_header").headingText=n,BFN.TransformModel.layerItem=c,l&&(BFN.activePresetMenuItem=l);for(var m=document.createElement("div");s.firstChild;)m.appendChild(s.firstChild);document.getElementById("layer_isolator_tool_menu").appendChild(m);var p=BFN.EDITOR_MENU.presetGenericMenuIDs[e];if(p)m.querySelector(".generic_menu_container").appendChild(document.getElementById(p));var g=BFN.EDITOR_MENU.presetBrushMenuIDs[e];if(g){var f=m.querySelector(".brush_menu_container");f&&f.appendChild(document.getElementById(g))}document.getElementById("layer_isolator_edit_complete").setStyles({visibility:"hidden"}),BFN.TransformItemIsolator.isolateTransformItem(BFN.TransformModel.selectedTransformItem,()=>{BFN.PhotoEditorCanvas.canvasTools.altSourceTexture=BFN.TransformItemIsolator.altSourceTexture,BFN.PhotoEditorCanvasModel.viewState=r,BFN.PhotoEditorCanvas.canvasTools.altSourceTexture=null,UITools.applyTool(e);try{o.updateImagePainter()}catch(e){}t?t():requestAnimationFrame(()=>{UIToggler.toggleAlternateMenuImmediately(!0,"layer_isolator_tool_menu_header","layer_isolator_tool_menu")})},()=>{for(document.getElementById("layer_isolator_edit_complete").setStyles({visibility:""}),BFN.activePresetMenuItem&&BFN.activePresetMenuItem===l&&(BFN.activePresetMenuItem=null);m.firstChild;)s.appendChild(m.firstChild);m.remove(),this.updatePanelsAvailable(),i&&i()},!0),this.updatePanelsAvailable()}}}}}updatePanelsAvailable(){UILayers.updateLayersAvailable(),UIHistory.updateHistoryAvailable(),BFN.AlignmentOptionsManager.updateAlignmentAvailable()}}BFN.SingletonQueue.add(()=>{BFN.EditLayerManager=new sp});class lp{constructor(){this.init()}init(){BeFunky.log("HiResTextManager Init"),this.initDefaultValues()}initDefaultValues(){this.useHiResText=!0,this.showHiResTextHelpers=!1,this.showHiResTextCanvas=!1,this.multiRealtime=!1,this.enableRetinaScaling=window.bfn_resolution&&window.bfn_resolution>1,this.hiResTextViewportBounds=new BFN.Rectangle,this.hiResTextItemQueue=[],this.processingHiResTextItemQueue=!1,this.processingHiResTextItem=null,this.showHiResTextHelpers&&(this.hiResTextViewport=new PIXI.Graphics),this.updateHighResTextRAF=BeFunky.debounce(this.updateHiResTextImmediately.bind(this),"raf"),this.updateHighResText=BeFunky.debounce(this.updateHighResTextRAF.bind(this),Math.round(12*BFN.frameInterval)),this.processHiResTextItemQueue=BeFunky.debounce(this.processHiResTextItemQueueImmediately.bind(this),"raf"),this.handleAppReadyBind=this.handleAppReady.bind(this),this.handleCanvasUpdatedBind=this.handleCanvasUpdated.bind(this),BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReadyBind)}initEventListeners(){BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvasPhotoGrid.addEventListener(BFN.CollageMakerCanvasPhotoGridEvents.RESIZING.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasUpdatedBind),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasUpdatedBind),BFN.DesignerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasUpdatedBind),BFN.DesignerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasUpdatedBind),BFN.UndoManager.addEventListener(BFN.UndoManagerEvents.TIMESTAMP_UPDATED.type,this.handleCanvasUpdatedBind)}updateHiResTextViewport(){if(this.useHiResText){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),t=0,i=0;switch(e){case BFN.PhotoEditorCanvas:t=e.canvasImage.imageWidth,i=e.canvasImage.imageHeight;break;case BFN.CollageMakerCanvas:t=e.canvasPhotoGrid.gridWidth,i=e.canvasPhotoGrid.gridHeight;break;case BFN.DesignerCanvas:t=e.canvasWidth,i=e.canvasHeight}if(t&&i){var r=this.showHiResTextHelpers?20:0,a=BFN.MainUI.toLocal(new PIXI.Point(0,0),e.canvas),n=BFN.MainUI.toLocal(new PIXI.Point(t,i),e.canvas);this.hiResTextViewportBounds.left=Math.floor(Math.max(r,a.x)),this.hiResTextViewportBounds.top=Math.floor(Math.max(r,a.y)),this.hiResTextViewportBounds.right=Math.ceil(Math.min(BFN.StageModel.stageW-r,n.x)),this.hiResTextViewportBounds.bottom=Math.ceil(Math.min(BFN.StageModel.stageH-r,n.y)),e.transformLayer.children.forEach(e=>{e instanceof BFN.TransformItem&&"text"===e.type&&e.updateHiResTextBounds(this.multiRealtime)}),this.showHiResTextHelpers&&(this.hiResTextViewport.clear(),this.hiResTextViewport.lineStyle(1,16711935),this.hiResTextViewport.drawRect(this.hiResTextViewportBounds.x,this.hiResTextViewportBounds.y,this.hiResTextViewportBounds.width,this.hiResTextViewportBounds.height),this.hiResTextViewport.drawRect(this.hiResTextViewportBounds.x+5,this.hiResTextViewportBounds.y+5,this.hiResTextViewportBounds.width-10,this.hiResTextViewportBounds.height-10),this.hiResTextViewport.drawRect(this.hiResTextViewportBounds.x+10,this.hiResTextViewportBounds.y+10,this.hiResTextViewportBounds.width-20,this.hiResTextViewportBounds.height-20)),this.hiResTextItemQueue.splice(0),this.processingHiResTextItemQueue=!1,this.processingHiResTextItem=null,this.multiRealtime||this.updateHighResText()}}}updateHiResTextImmediately(){if(this.useHiResText&&BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&!BFN.TransformItemIsolator.active&&!BFN.PhotoGrid.gridIsolator.gridChild){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);this.conformHiResTextCanvas(),e.transformLayer.children.forEach(e=>{this.processHiResTextItem(e)})}}conformHiResTextCanvas(){if(this.useHiResText){this.hasOwnProperty("hiResTextCanvas")||(this.hiResTextCanvasElement=document.createElement("canvas"),BFN.appContainer.appendChild(this.hiResTextCanvasElement),this.showHiResTextCanvas?this.hiResTextCanvasElement.setStyles({zIndex:9999,pointerEvents:"none",background:"rgba(175,175,255,.4)",position:"absolute",left:0,top:0,display:"block"}):this.hiResTextCanvasElement.setStyles({display:"none"}),this.hiResTextCanvas=new fabric.StaticCanvas(this.hiResTextCanvasElement,{enableRetinaScaling:this.enableRetinaScaling}),this.hiResTextCanvasContext=this.hiResTextCanvas.getContext(),this.hiResTextCanvas.renderOnAddRemove=!1);var e=Math.ceil(this.hiResTextViewportBounds.width),t=Math.ceil(this.hiResTextViewportBounds.height),i=this.hiResTextViewportBounds.width*(this.enableRetinaScaling?fabric.devicePixelRatio:1)+"px",r=this.hiResTextViewportBounds.height*(this.enableRetinaScaling?fabric.devicePixelRatio:1)+"px";this.hiResTextCanvasElement.width===e&&this.hiResTextCanvasElement.style.width===i||(this.hiResTextCanvasElement.width=e,this.hiResTextCanvasElement.setStyles({width:i}),this.hiResTextCanvas.setWidth(this.hiResTextCanvasElement.width)),this.hiResTextCanvasElement.height===t&&this.hiResTextCanvasElement.style.height===r||(this.hiResTextCanvasElement.height=t,this.hiResTextCanvasElement.setStyles({height:r}),this.hiResTextCanvas.setHeight(this.hiResTextCanvasElement.height))}}conformITextToTransformItem(e){if(this.useHiResText&&e&&e.iText){var t=e.iText;t.scaleX=t.scaleY=e.canvasScale*e.textScale*e.scale.x,t.flipX=e.flippedHorizontal,t.flipY=e.flippedVertical,t.rotate(e.rotation*(180/Math.PI));var i=BFN.MainUI.toLocal(new PIXI.Point,e);t.left=i.x-this.hiResTextViewportBounds.x,t.top=i.y-this.hiResTextViewportBounds.y}}drawHiResTextToTransformItem(e){if(this.hasOwnProperty("hiResTextCanvas")&&this.useHiResText&&e&&e.iText){var t=e.iText;this.hiResTextCanvasContext.lineJoin="round",this.showHiResTextCanvas&&(this.hiResTextCanvas.remove(t),this.hiResTextCanvas.clear()),this.hiResTextCanvas.add(t),this.hiResTextCanvas.renderAll(),this.hasOwnProperty("hiResCanvasTexture")?this.hiResCanvasTexture.update():(this.hiResCanvasTexture=new PIXI.Texture(new PIXI.BaseTexture.fromCanvas(this.hiResTextCanvasElement)),this.hiResCanvasTexture.baseTexture.mipmap=!1,this.hiResCanvasTexture.setScaleMode(PIXI.SCALE_MODES.LINEAR)),e.hiResTextTexture.copyPixels(this.hiResCanvasTexture,{x:this.hiResTextViewportBounds.x-e.hiResTextRect.globalX,y:this.hiResTextViewportBounds.y-e.hiResTextRect.globalY},!BFN.HiResTextManager.showHiResTextHelpers,void 0,{x:1/(this.enableRetinaScaling?fabric.devicePixelRatio:1),y:1/(this.enableRetinaScaling?fabric.devicePixelRatio:1)}),this.showHiResTextCanvas||(this.hiResTextCanvas.remove(t),this.hiResTextCanvas.clear()),BFN.FabricManager.conformITextToTransformItem(e)}}processHiResTextItem(e){this.useHiResText&&e&&e instanceof BFN.TransformItem&&"text"===e.type&&e.hiResTextRect&&e.hiResTextRect.width&&e.hiResTextRect.height&&(this.hiResTextItemQueue.includes(e)||e===this.processingHiResTextItem||this.hiResTextItemQueue.push(e),this.hiResTextItemQueue.length&&!this.processingHiResTextItemQueue&&this.processHiResTextItemQueue())}processHiResTextItemQueueImmediately(){this.useHiResText&&(this.hiResTextItemQueue.length?(this.processingHiResTextItemQueue||(this.processingHiResTextItemQueue=!0,this.processQueueStartTime=performance.now()),this.processingHiResTextItem=this.hiResTextItemQueue.shift(),this.processingHiResTextItem.renderHiResText(()=>{performance.now()-this.processQueueStartTime<1e3/60?this.processHiResTextItemQueueImmediately():requestAnimationFrame(()=>{this.processQueueStartTime=performance.now(),this.processHiResTextItemQueueImmediately()})})):(this.processingHiResTextItemQueue=!1,this.processingHiResTextItem=null))}handleAppReady(e){BFN.AppModel.removeEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReadyBind),this.useHiResText&&(this.initEventListeners(),this.handleCanvasUpdated(e))}handleCanvasUpdated(e){this.updateHiResTextViewport()}}if(BFN.SingletonQueue.add(()=>{BFN.HiResTextManager=new lp}),BFN.EventDispatcher){function hp(){BFN.EventDispatcher.call(this),this.init()}BFN.AnimatorEvents={UPDATE:new Event("UPDATE"),UPDATE_COMPLETE:new Event("UPDATE_COMPLETE"),INCREASE_COMPLETE:new Event("INCREASE_COMPLETE"),DECREASE_COMPLETE:new Event("DECREASE_COMPLETE")},BFN.AnimatorTypes={ANIMATION_TYPE_LINEAR:new Event("ANIMATION_TYPE_LINEAR"),ANIMATION_TYPE_EASE_IN:new Event("ANIMATION_TYPE_EASE_IN")},hp.prototype=Object.create(BFN.EventDispatcher.prototype),hp.prototype.init=function(){BeFunky.log("Animator Init"),this.initDefaultValues()},hp.prototype.initDefaultValues=function(){this.id=null,this.animating=!1,this.animationFactor=0,this.animationType=BFN.AnimatorTypes.ANIMATION_TYPE_LINEAR,this.linearSteps=5,this.easeInDivisor=2,this.increasing=!1,this.decreasing=!1,this.animationEaseValue=0,this.animationGoalValue=0,this.recommendedFrameRate=48,this.speedFactor=this.recommendedFrameRate/BFN.frameRate,this.ignoreAnimationCalls=!1},hp.prototype.setAnimatorFactor=function(e){this.animationFactor=Math.max(0,Math.min(1,e)),this.dispatchEvent(BFN.AnimatorEvents.UPDATE)},hp.prototype.increase=function(){this.ignoreAnimationCalls||(this.animating=!0,this.increasing=!0,this.decreasing=!1,this.timeDuration=Math.round(this.linearSteps/this.recommendedFrameRate*1e3),this.timeStart=this.getTime()-this.timeDuration*this.animationFactor,this.timeEnd=this.timeStart+this.timeDuration,this.increaseUpdate())},hp.prototype.decrease=function(){this.ignoreAnimationCalls||(this.animating=!0,this.increasing=!1,this.decreasing=!0,this.timeDuration=Math.round(this.linearSteps/this.recommendedFrameRate*1e3)*this.animationFactor,this.timeStart=this.getTime(),this.timeEnd=this.timeStart+this.timeDuration,this.decreaseUpdate())},hp.prototype.easeValue=function(){this.ignoreAnimationCalls||(this.animating=!0,this.easeValueUpdate())},hp.prototype.startUpdate=function(){this.ignoreAnimationCalls||(this.animating=!0,this.update())},hp.prototype.stopUpdate=function(){this.ignoreAnimationCalls||(this.animating=!1)},hp.prototype.increaseUpdate=function(){if(this.increasing){switch(this.animationType){case BFN.AnimatorTypes.ANIMATION_TYPE_LINEAR:this.animationFactor=this.timeEnd>this.timeStart?Math.min(1,(this.getTime()-this.timeStart)/(this.timeEnd-this.timeStart)):1;break;case BFN.AnimatorTypes.ANIMATION_TYPE_EASE_IN:var e=Math.max(1.1,this.easeInDivisor*this.speedFactor);Math.abs(1-this.animationFactor)/e>.001?this.animationFactor+=(1-this.animationFactor)/this.easeInDivisor:this.animationFactor=1}this.dispatchEvent(BFN.AnimatorEvents.UPDATE),1==this.animationFactor&&(this.animating=!1,this.increasing=!1,this.dispatchEvent(BFN.AnimatorEvents.UPDATE_COMPLETE),this.dispatchEvent(BFN.AnimatorEvents.INCREASE_COMPLETE));try{BFN.MainUI.requestRender()}catch(e){}setTimeout(this.increaseUpdate.bind(this),BFN.frameInterval)}},hp.prototype.decreaseUpdate=function(){if(this.decreasing){switch(this.animationType){case BFN.AnimatorTypes.ANIMATION_TYPE_LINEAR:this.animationFactor=this.timeEnd>this.timeStart?1-Math.min(1,(this.getTime()-this.timeStart)/(this.timeEnd-this.timeStart)):0;break;case BFN.AnimatorTypes.ANIMATION_TYPE_EASE_IN:var e=Math.max(1.1,this.easeInDivisor*this.speedFactor);Math.abs(0-this.animationFactor)/e>.001?this.animationFactor+=(0-this.animationFactor)/this.easeInDivisor:this.animationFactor=0}this.dispatchEvent(BFN.AnimatorEvents.UPDATE),0==this.animationFactor&&(this.animating=!1,this.decreasing=!1,this.dispatchEvent(BFN.AnimatorEvents.UPDATE_COMPLETE),this.dispatchEvent(BFN.AnimatorEvents.DECREASE_COMPLETE));try{BFN.MainUI.requestRender()}catch(e){}setTimeout(this.decreaseUpdate.bind(this),BFN.frameInterval)}},hp.prototype.easeValueUpdate=function(){if(this.animating){var e=Math.max(1.1,this.easeInDivisor*this.speedFactor);Math.abs(this.animationGoalValue-this.animationEaseValue)/e>.005?(this.animationEaseValue+=(this.animationGoalValue-this.animationEaseValue)/this.easeInDivisor,this.dispatchEvent(BFN.AnimatorEvents.UPDATE)):(this.animationEaseValue=this.animationGoalValue,this.animating=!1,this.dispatchEvent(BFN.AnimatorEvents.UPDATE),this.dispatchEvent(BFN.AnimatorEvents.UPDATE_COMPLETE));try{BFN.MainUI.requestRender()}catch(e){}setTimeout(this.easeValueUpdate.bind(this),BFN.frameInterval)}},hp.prototype.update=function(){if(this.animating){this.dispatchEvent(BFN.AnimatorEvents.UPDATE);try{BFN.MainUI.requestRender()}catch(e){}setTimeout(this.update.bind(this),BFN.frameInterval)}},hp.prototype.getTime=function(){return(new Date).getTime()},Object.defineProperty(hp.prototype,"animationCosFactor",{get:function(){return(1+(this.animationFactor<.5?Math.sin(this.animationFactor*Math.PI)-1:1-Math.sin(this.animationFactor*Math.PI)))/2}}),Object.defineProperty(hp.prototype,"animationSinFactor",{get:function(){return(Math.sin(this.animationFactor*Math.PI-Math.PI/2)+1)/2}}),BFN.Animator=hp}BFN.DraggerEvents={DRAGGING_STARTED:new Event("DRAGGING_STARTED"),DRAGGING:new Event("DRAGGING"),DRAGGING_COMPLETE:new Event("DRAGGING_COMPLETE")},BFN.ActiveDraggers=[];function cp(){PIXI.Container.call(this),this.init()}function up(e,t,i){PIXI.Container.call(this),this._type=BFN.CropHandleTypes.hasOwnProperty(e)?e:BFN.CropHandleTypes.TYPE_CORNER,this._rotation=t||0,this._size=i||12,this.init()}function dp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16777215;PIXI.Container.call(this),this._color=e,this.init()}function mp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.appViewState=e,this.init()}function pp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.baseOpacity=Math.max(0,Math.min(1,t)),this._color=e,this._opacity=this.baseOpacity,this._fitPaddingX=i,this._fitPaddingY=r,this.init()}function gp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;PIXI.Container.call(this),this._color=e,this._opacity=t,this.init()}function fp(){PIXI.Sprite.call(this),this.init()}function vp(){PIXI.Sprite.call(this),this.init()}function yp(){PIXI.Sprite.call(this),this.init()}function xp(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4294967295,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4278190080,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;PIXI.Sprite.call(this),this.dashed=e,this.smoothPadding=t,this.lineThickness=i,this.isLinear=r,this.lighterColor=a,this.darkerColor=n,this.uniqueTextureID=o,this.isRuler=!1,this.init()}function _p(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4294967295,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4278190080,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;PIXI.Sprite.call(this),this.dashed=e,this.smoothPadding=t,this.lineThickness=i,this.isLinear=r,this.lighterColor=a,this.darkerColor=n,this.uniqueTextureID=o,this.init()}function Ip(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4294967295,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4278190080,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;PIXI.Container.call(this),this.dashed=e,this.smoothPadding=t,this.lineThickness=i,this.isLinear=r,this.lighterColor=a,this.darkerColor=n,this.uniqueTextureID=o,this.init()}function Tp(){PIXI.Sprite.call(this),this.init()}function bp(){PIXI.Container.call(this),this.init()}function Sp(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];PIXI.Sprite.call(this),this.autoRender=e,this.init()}function Cp(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];PIXI.Sprite.call(this),this.autoRender=e,this.init()}function Bp(){PIXI.Sprite.call(this),this.init()}function Fp(){PIXI.Container.call(this),this.init()}function Ep(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;PIXI.Container.call(this),this.init(),this.texture=e,this.width=t,this.height=i}function Pp(){PIXI.Container.call(this),this.init()}function Np(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;PIXI.particles.ParticleContainer.call(this,2*e,{scale:!1,position:!1,rotation:!1,uvs:!1,alpha:!0},e,!0),this.init()}function Mp(){this.hGuidesNum=BFN.maxImageSize,this.vGuidesNum=BFN.maxImageSize;var e=this.hGuidesNum+this.vGuidesNum;PIXI.particles.ParticleContainer.call(this,e,{scale:!0,position:!0,rotation:!0,uvs:!1,alpha:!1},e,!0),this.init()}function Dp(){PIXI.Graphics.call(this),this.init()}function wp(){PIXI.Container.call(this),this.init()}function kp(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function Lp(){this.init()}function Op(){PIXI.Sprite.call(this),BeFunky.isEdgeHTML&&(BFN.maxBrushSize=512),this.init()}function Rp(){PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.init()}function Ap(){PIXI.Sprite.call(this),this.init()}function Vp(){PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.init()}function Up(){PIXI.Sprite.call(this),this.init()}function Gp(){PIXI.Sprite.call(this),this.init()}function Hp(){PIXI.Sprite.call(this),this.init()}function zp(){PIXI.Sprite.call(this),this.init()}function Xp(){PIXI.Sprite.call(this),this.init()}function jp(){PIXI.Sprite.call(this),this.init()}function Wp(e,t,i,r,a){PIXI.Sprite.call(this),this._elementVO=e,this._sourcePoint=t,this._centerPoint=i,this._displayDimensions=r,this.useThumb=a||!1,this.init()}function Yp(e){PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.useThumbs=e||!1,this.init()}function qp(){PIXI.Sprite.call(this),this.init()}function Kp(){PIXI.Sprite.call(this),this.init()}function Qp(){PIXI.Sprite.call(this),this.init()}function Zp(){PIXI.Sprite.call(this),this.init()}function Jp(){PIXI.Sprite.call(this),this.init()}function $p(){PIXI.Sprite.call(this),this.init()}function eg(){PIXI.Sprite.call(this),this.init()}function tg(){PIXI.Sprite.call(this),this.init()}function ig(){PIXI.Sprite.call(this),this.init()}function rg(){PIXI.Sprite.call(this),this.init()}function ag(){PIXI.Sprite.call(this),this.init()}function ng(){PIXI.Sprite.call(this),this.init()}function og(){PIXI.Container.call(this),this.init()}function sg(){PIXI.Sprite.call(this),this.init()}function lg(){PIXI.Sprite.call(this),this.init()}function hg(){PIXI.Container.call(this),this.init()}function cg(e,t){switch(PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.itemObject=e,this.appViewState=t,this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:this.transformLayer=BFN.PhotoEditorCanvas.transformLayer;break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:this.transformLayer=BFN.CollageMakerCanvas.transformLayer;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:this.transformLayer=BFN.DesignerCanvas.transformLayer}this.init()}function ug(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function dg(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function mg(){PIXI.Container.call(this),this.init()}function pg(e,t){switch(PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.appViewState=e,this.canvas=t,this.model=null,this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:this.model=BFN.PhotoEditorModel;break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:this.model=BFN.CollageMakerModel;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:this.model=BFN.DesignerModel}this.init()}function gg(){PIXI.Container.call(this),this.init()}function fg(e){PIXI.Sprite.call(this),this.transformLayer=e,this.init()}function vg(e){PIXI.Container.call(this),this.transformTool=e,this.init()}function yg(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function xg(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function _g(){PIXI.Sprite.call(this),this.init()}function Ig(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function Tg(){PIXI.Sprite.call(this),this.init()}function bg(){PIXI.Sprite.call(this),this.init()}BFN.Dragger=class extends BFN.EventDispatcher{constructor(){super(),this.init()}init(){this.draggedItem=null,this.item=null,this.itemStartX=0,this.itemStartY=0,this.mouseStartX=0,this.mouseStartY=0,this.mouseDeltaX=0,this.mouseDeltaY=0,this.draggedX=0,this.draggedY=0,this.scale=1,this.useBounds=!0,this.autoDrag=!0,this.stickyDrag=!0,this.active=!1,this.dragging=!1,this.wasDragged=!1,this.pixelDragThreshold=0,this.pixelDragThresholdPassed=!1,this.pixelDragThresholdPreventEvent=!1,this.pointerEvent=null,this.altScale=null,this.altStickyDrag=null,this.preventSelectionDrag=!1,this.deselectItemGroup=!0,this.preRenderDragOnly=!1,this.draggingEventEmissionPending=!1,this.completeStopDragTimeoutID=null,this.bounds={minX:0,minY:0,maxX:100,maxY:100},this.ctrlKey=!1,this.shiftKey=!1,this.altKey=!1,this.lastMousePosition=new PIXI.Point,this.currentMousePosition=new PIXI.Point,this.dragVelocity=0,this.handleItemReleasedBind=this.handleItemReleased.bind(this),this.handleItemMouseMoveBind=this.handleItemMouseMove.bind(this),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)}drag(e){if(!this.active){this.active=!0,this.dragging=!0,this.item=e;var t=BeFunky.globalPointerCoords;this.itemStartX=this.draggedX=this.item.x,this.itemStartY=this.draggedY=this.item.y,this.mouseStartX=t.x,this.mouseStartY=t.y,document.removeEventListener(BeFunky.pointerup,this.handleItemReleasedBind,!0),document.removeEventListener(BeFunky.pointermove,this.handleItemMouseMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handleItemReleasedBind,!0),document.addEventListener(BeFunky.pointermove,this.handleItemMouseMoveBind,!0),this.dispatchEvent(BFN.DraggerEvents.DRAGGING_STARTED),this.lastMousePosition.x=this.currentMousePosition.x=t.x,this.lastMousePosition.y=this.currentMousePosition.y=t.y,this.pixelDragThresholdPassed=!1,BFN.ActiveDraggers.includes(this)||BFN.ActiveDraggers.push(this),this.preRenderDragOnly&&BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),BFN.MainUI.requestRender()}}stopDrag(){this.active&&(this.preRenderDragOnly&&this.draggingEventEmissionPending&&this.dispatchEvent(BFN.DraggerEvents.DRAGGING),this.draggingEventEmissionPending=!1,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.dragging=!1,this.ctrlKey=!1,this.shiftKey=!1,this.altKey=!1,document.removeEventListener(BeFunky.pointerup,this.handleItemReleasedBind,!0),document.removeEventListener(BeFunky.pointermove,this.handleItemMouseMoveBind,!0),this.draggedItem=this.item,this.item=null,BFN.MainUI.requestRender(),this.pointerEvent=null,this.completeStopDragTimeoutID=setTimeout(this.completeStopDrag.bind(this),0))}completeStopDrag(){this.active&&(this.dispatchEvent(BFN.DraggerEvents.DRAGGING_COMPLETE),this.draggedItem=null,this.wasDragged=!1,this.altScale=null,this.altStickyDrag=null,BFN.ActiveDraggers.includes(this)&&BFN.ActiveDraggers.splice(BFN.ActiveDraggers.indexOf(this),1),this.active=!1,null!==this.completeStopDragTimeoutID&&(clearTimeout(this.completeStopDragTimeoutID),this.completeStopDragTimeoutID=null))}setBounds(e,t,i,r){this.bounds.minX=e,this.bounds.minY=t,this.bounds.maxX=i,this.bounds.maxY=r}handleItemReleased(){this.stopDrag()}handleItemMouseMove(e){if(this.item){this.ctrlKey=e.ctrlKey||e.metaKey,this.shiftKey=e.shiftKey,this.altKey=e.altKey;var t=null===this.altScale?this.scale:this.altScale,i=null===this.altStickyDrag?this.stickyDrag:this.altStickyDrag,r=BeFunky.globalPointerCoords;if(this.mouseDeltaX=(r.x-this.mouseStartX)/t,this.mouseDeltaY=(r.y-this.mouseStartY)/t,this.pixelDragThreshold&&!this.pixelDragThresholdPassed){if(Math.sqrt(Math.pow(r.x-this.mouseStartX,2)+Math.pow(r.y-this.mouseStartY,2))>this.pixelDragThreshold)this.pixelDragThresholdPassed=!0,this.mouseStartX=r.x,this.mouseStartY=r.y;else if(this.pixelDragThresholdPreventEvent)return;this.mouseDeltaX=this.mouseDeltaY=0}if(this.wasDragged||!this.mouseDeltaX&&!this.mouseDeltaY||(this.wasDragged=!0),this.draggedX=this.itemStartX+this.mouseDeltaX,this.draggedY=this.itemStartY+this.mouseDeltaY,this.useBounds){var a=Math.max(this.bounds.minX,Math.min(this.bounds.maxX,this.draggedX)),n=Math.max(this.bounds.minY,Math.min(this.bounds.maxY,this.draggedY));i&&(this.draggedX<this.bounds.minX?this.mouseStartX+=(this.draggedX-this.bounds.minX)*t:this.draggedX>this.bounds.maxX&&(this.mouseStartX+=(this.draggedX-this.bounds.maxX)*t),this.draggedY<this.bounds.minY?this.mouseStartY+=(this.draggedY-this.bounds.minY)*t:this.draggedY>this.bounds.maxY&&(this.mouseStartY+=(this.draggedY-this.bounds.maxY)*t)),this.draggedX=a,this.draggedY=n}this.autoDrag&&(this.item.x=this.draggedX,this.item.y=this.draggedY);var o=BeFunky.globalPointerCoords;this.currentMousePosition.x=o.x,this.currentMousePosition.y=o.y;var s=this.currentMousePosition.x-this.lastMousePosition.x,l=this.currentMousePosition.y-this.lastMousePosition.y,h=Math.sqrt(Math.pow(s,2)+Math.pow(l,2));this.dragVelocity=h,this.lastMousePosition.x=this.currentMousePosition.x,this.lastMousePosition.y=this.currentMousePosition.y,BFN.MainUI.requestRender(),this.pointerEvent=e,this.preRenderDragOnly?this.draggingEventEmissionPending=!0:this.dispatchEvent(BFN.DraggerEvents.DRAGGING)}}handleMainUIPreRender(){this.preRenderDragOnly?this.draggingEventEmissionPending&&(this.draggingEventEmissionPending=!1,this.dispatchEvent(BFN.DraggerEvents.DRAGGING)):BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)}get validDrag(){return this.item&&(!this.useBounds||this.useBounds&&(Math.abs(this.bounds.maxX-this.bounds.minX)>.1||Math.abs(this.bounds.maxY-this.bounds.minY)>.1))}},cp.prototype=Object.create(PIXI.Container.prototype),cp.prototype.init=function(){BeFunky.log("HoverButton Init"),this.initDefaultValues(),this.initButtonContainer(),this.initButtonSprite(),this.initAnimators()},cp.prototype.initDefaultValues=function(){this.interactive=this.buttonMode=!0,this._selected=!1,this._hovered=!1,this._active=!0,this.mouseover=this.handleMouseOver.bind(this),this.mouseout=this.handleMouseOut.bind(this)},cp.prototype.initButtonContainer=function(){this.buttonContainer=new PIXI.Container,this.addChild(this.buttonContainer)},cp.prototype.initButtonSprite=function(){this.buttonSprite=new PIXI.Sprite,this.buttonSprite.anchor.x=this.buttonSprite.anchor.y=.5,this.buttonContainer.addChild(this.buttonSprite)},cp.prototype.initAnimators=function(){this.hoverAnimator=new BFN.Animator,this.hoverAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.selectAnimator=new BFN.Animator,this.selectAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.activeAnimator=new BFN.Animator,this.activeAnimator.setAnimatorFactor(1),this.activeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleActiveAnimatorUpdate.bind(this))},cp.prototype.updateDisplay=function(){var e=1;e=BFN.Util.interpolateNumber(e,1.2,this.hoverAnimator.animationFactor),e=BFN.Util.interpolateNumber(e,1.2,this.selectAnimator.animationFactor),this.buttonSprite.scale.x=this.buttonSprite.scale.y=e},cp.prototype.handleMouseOver=function(){this._hovered=!0,this.hoverAnimator.increase()},cp.prototype.handleMouseOut=function(){this._hovered=!1,this.hoverAnimator.decrease()},cp.prototype.handleAnimatorUpdate=function(){this.updateDisplay()},cp.prototype.handleActiveAnimatorUpdate=function(){this.buttonContainer.scale.x=this.buttonContainer.scale.y=.25*this.activeAnimator.animationFactor+.75,this.buttonContainer.alpha=this.activeAnimator.animationFactor},Object.defineProperty(cp.prototype,"texture",{set:function(e){this.buttonSprite.texture=e},get:function(){return this.buttonSprite.texture}}),Object.defineProperty(cp.prototype,"selected",{set:function(e){this._selected=e,this._selected?this.selectAnimator.increase():this.selectAnimator.decrease()},get:function(){return this._selected}}),Object.defineProperty(cp.prototype,"hovered",{get:function(){return this._hovered}}),Object.defineProperty(cp.prototype,"active",{set:function(e){this._active!=!!e&&(this._active=!!e,this.interactive=this.interactiveChildren=this._active,this._active?this.activeAnimator.increase():this.activeAnimator.decrease())},get:function(){return this._active}}),BFN.HoverButton=cp,BFN.CropHandleTypes={TYPE_CORNER:"TYPE_CORNER",TYPE_EDGE:"TYPE_EDGE"},up.prototype=Object.create(PIXI.Container.prototype),up.prototype.init=function(){BeFunky.log("CropHandle Init"),this.initDefaultValues(),this.initHandle(),this.initAnimator()},up.prototype.initDefaultValues=function(){this.interactive=this.buttonMode=!0,this.hovered=!1,this.mouseDown=!1,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.handleMouseDownBind=this.handleMouseDown.bind(this),this.handleMouseUpBind=this.handleMouseUp.bind(this),this.on("pointerover",this.handleMouseOverBind),this.on("pointerout",this.handleMouseOutBind),this.on("pointerdown",this.handleMouseDownBind)},up.prototype.initHandle=function(){switch(this.handle=new PIXI.Sprite,this.handle.rotation=this._rotation,this.addChild(this.handle),this.fill=new PIXI.Graphics,this.handle.addChild(this.fill),this.outline=new PIXI.Graphics,this.handle.addChild(this.outline),this._type){case BFN.CropHandleTypes.TYPE_CORNER:this.initCorner();break;case BFN.CropHandleTypes.TYPE_EDGE:this.initEdge()}},up.prototype.initCorner=function(){this.fill.x=this.fill.y=5,this.fill.beginFill(0,0),this.fill.drawRect(-this._size,-this._size,2*this._size,2*this._size),this.fill.endFill(),this.fill.beginFill(16777215),this.fill.moveTo(0,0),this.fill.lineTo(this._size+0,0),this.fill.lineTo(this._size+0,this._size/3+0),this.fill.lineTo(this._size/3+0,this._size/3+0),this.fill.lineTo(this._size/3+0,this._size+0),this.fill.lineTo(0,this._size+0),this.fill.lineTo(0,0),this.fill.endFill(),this.outline.x=this.outline.y=5,this.outline.lineStyle(1,0),this.outline.moveTo(0,0),this.outline.lineTo(this._size+0,0),this.outline.lineTo(this._size+0,this._size/3+0),this.outline.lineTo(this._size/3+0,this._size/3+0),this.outline.lineTo(this._size/3+0,this._size+0),this.outline.lineTo(0,this._size+0),this.outline.lineTo(0,0)},up.prototype.initEdge=function(){this.fill.y=5,this.fill.beginFill(0,0),this.fill.drawRect(-this._size/2,-this._size,this._size,2*this._size),this.fill.endFill(),this.fill.beginFill(16777215),this.fill.drawRect(-this._size/2,0,this._size,this._size/3),this.fill.endFill(),this.outline.y=5,this.outline.lineStyle(1,0),this.outline.drawRect(-this._size/2,0,this._size,this._size/3)},up.prototype.initAnimator=function(){this.animator=new BFN.Animator,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this))},up.prototype.handleMouseOver=function(){this.hovered=!0,this.animator.increase()},up.prototype.handleMouseOut=function(){this.hovered=!1,this.mouseDown||this.animator.decrease()},up.prototype.handleMouseDown=function(){this.mouseDown=!0,document.addEventListener(BeFunky.pointerup,this.handleMouseUpBind)},up.prototype.handleMouseUp=function(){this.mouseDown=!1,document.removeEventListener(BeFunky.pointerup,this.handleMouseUpBind),this.hovered||this.handleMouseOutBind()},up.prototype.handleAnimatorUpdate=function(){this.fill.alpha=1-this.animator.animationFactor/2},BFN.CropHandle=up,dp.prototype=Object.create(PIXI.Container.prototype),dp.prototype.init=function(){BeFunky.log("SquareButton Init"),this.initDefaultValues(),this.initSquareGraphic(),this.initAnimators()},dp.prototype.initDefaultValues=function(){this.interactive=!0,this._itemWidth=10,this._itemHeight=10,this.hovered=!1,this._selected=!1,this._unhoveredAlpha=.25,this._hoveredAlpha=.75,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.on("pointerover",this.handleMouseOverBind),this.on("pointerout",this.handleMouseOutBind)},dp.prototype.initSquareGraphic=function(){this.squareGraphic=new PIXI.Graphics,this.addChild(this.squareGraphic),this.drawButton()},dp.prototype.initAnimators=function(){this.hoverAnimator=new BFN.Animator,this.hoverAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.hoverAnimator.setAnimatorFactor(0)},dp.prototype.setHoverAlphas=function(e,t){this._unhoveredAlpha=e,this._hoveredAlpha=t,this.updateDisplay()},dp.prototype.drawButton=function(){this.squareGraphic.clear(),this.squareGraphic.beginFill(this._color),this.squareGraphic.drawRect(0,0,10,10),this.squareGraphic.endFill()},dp.prototype.updateDisplay=function(){this.squareGraphic.width=this._itemWidth,this.squareGraphic.height=this._itemHeight,this.squareGraphic.alpha=this.hoverAnimator.animationFactor*(this._hoveredAlpha=this._unhoveredAlpha)+this._unhoveredAlpha},dp.prototype.handleMouseOver=function(){this.hovered=!0,this.hoverAnimator.increase()},dp.prototype.handleMouseOut=function(){this.hovered=!1,this.selected||this.hoverAnimator.decrease()},dp.prototype.handleAnimatorUpdate=function(){this.updateDisplay()},Object.defineProperty(dp.prototype,"color",{set:function(e){this._color!=e&&(this._color=e,this.drawButton())},get:function(){return this._selected}}),Object.defineProperty(dp.prototype,"selected",{set:function(e){this._selected=e,this.hovered||this.selected||this.hoverAnimator.decrease()},get:function(){return this._selected}}),Object.defineProperty(dp.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateDisplay()},get:function(){return this._itemWidth}}),Object.defineProperty(dp.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateDisplay()},get:function(){return this._itemHeight}}),BFN.SquareButton=dp,BFN.CanvasScaleBarsEvents={SCALING_STARTED:new Event("SCALING_STARTED"),SCALING_COMPLETE:new Event("SCALING_COMPLETE"),DIMENSIONS_UPDATED:new Event("DIMENSIONS_UPDATED"),SCALE_BAR_ACTION:new Event("SCALE_BAR_ACTION")},mp.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),mp.prototype.init=function(){BeFunky.log("CanvasScaleBars Init"),this.initDefaultValues(),this.initScaleBars(),this.initFadeAnimator(),this.updateScaleBarPositions(),this.updateScaleBarSizes(),this.updateScaleBarScales()},mp.prototype.initDefaultValues=function(){switch(this.interactive=!0,this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:this.canvasModel=BFN.PhotoEditorCanvasModel;break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:this.canvasModel=BFN.CollageMakerCanvasModel;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:this.canvasModel=BFN.DesignerCanvasModel}this.minSize=BFN.minImageSize,this.maxSize=BFN.maxImageSize,this._active=!0,this._showing=!1,this._enabled=!0,this._canvasScale=1,this._canvasWidth=100,this._canvasHeight=100,this.isTouch=!1,this.currentScaleBar=null,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data={id:null,action:null},this.appViewState&&(this.hovered=!1,this.dragging=!1,setTimeout(function(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_OVER.type,this.handleMainUIMouseOver.bind(this)),BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_OUT.type,this.handleMainUIMouseOut.bind(this))}.bind(this),100),document.addEventListener(BeFunky.pointerdown,this.handleDocumentPressed.bind(this),!0),document.addEventListener(BeFunky.pointerup,this.handleDocumentReleased.bind(this),!0))},mp.prototype.handleDocumentPressed=function(){requestAnimationFrame(function(){this.interactive=this.interactiveChildren=!1}.bind(this))},mp.prototype.handleDocumentReleased=function(){this.interactive=this.interactiveChildren=!0},mp.prototype.initScaleBars=function(){this.scaleBarData=[{id:"left",rotation:Math.PI/2,direction:"vertical"},{id:"right",rotation:-Math.PI/2,direction:"vertical"},{id:"top",rotation:Math.PI,direction:"horizontal"},{id:"bottom",rotation:0,direction:"horizontal"},{id:"topLeft",rotation:Math.PI,direction:"none"},{id:"topRight",rotation:-Math.PI/2,direction:"none"},{id:"bottomLeft",rotation:Math.PI/2,direction:"none"},{id:"bottomRight",rotation:0,direction:"none"}],this.handleScaleBarMouseOverBind=this.handleScaleBarMouseOver.bind(this),this.handleScaleBarMouseOutBind=this.handleScaleBarMouseOut.bind(this),this.handleScaleBarPressedBind=this.handleScaleBarPressed.bind(this),this.handleScaleBarReleasedBind=this.handleScaleBarReleased.bind(this),this.handleScaleBarDraggerDraggingBind=this.handleScaleBarDraggerDragging.bind(this),this.handleScaleBarDraggerDraggingStartedBind=this.handleScaleBarDraggerDraggingStarted.bind(this),this.handleScaleBarDraggerDraggingCompleteBind=this.handleScaleBarDraggerDraggingComplete.bind(this),this.scaleBars={};for(var e=0;e<this.scaleBarData.length;e++){var t=this.scaleBarData[e],i=new BFN.SquareButton(4145484);switch(i.buttonMode=!1,i.itemWidth=i.itemHeight=20,i.setHoverAlphas(.6,1),i.id=t.id,i.rotation=t.rotation,i.roundedRectFilter=new BFN.filters.RoundedRectFilter,i.roundedRectFilter.strokeWidth=0,i.roundedRectFilter.strokeColor=0,i.roundedRectFilter.useTexture=1,i.roundedRectFilter.getCornerRadiusFromShortestSide=1,i.filters=[i.roundedRectFilter],t.direction){case"vertical":i.roundedRectFilter.edgePaddingX=4,i.roundedRectFilter.edgePaddingY=1;break;case"horizontal":i.roundedRectFilter.edgePaddingX=1,i.roundedRectFilter.edgePaddingY=4;break;case"none":i.roundedRectFilter.edgePadding=4}i.on(BeFunky.pointerover,this.handleScaleBarMouseOverBind),i.on(BeFunky.pointerout,this.handleScaleBarMouseOutBind),i.on(BeFunky.pointerdown,this.handleScaleBarPressedBind),this.addChild(i),this.scaleBars[i.id]=i}this.scaleBarDragger=new BFN.Dragger,this.scaleBarDragger.stickyDrag=!1,this.scaleBarDragger.preventSelectionDrag=!0,this.scaleBarDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleScaleBarDraggerDraggingBind),this.scaleBarDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleScaleBarDraggerDraggingStartedBind),this.scaleBarDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleScaleBarDraggerDraggingCompleteBind)},mp.prototype.initFadeAnimator=function(){this.fadeAnimator=new BFN.Animator,this.fadeAnimator.linearSteps=10,this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdate.bind(this)),this.appViewState&&this.fadeAnimator.setAnimatorFactor(1)},mp.prototype.show=function(){this._showing=!0,this._active&&this.fadeAnimator.increase()},mp.prototype.hide=function(){this._showing=!1,this.fadeAnimator.decrease()},mp.prototype.updateScaleBarPositions=function(){this.scaleBars.left.x=this.scaleBars.bottom.x=this.scaleBars.topLeft.x=this.scaleBars.bottomLeft.x=-this._canvasWidth/2,this.scaleBars.right.x=this.scaleBars.top.x=this.scaleBars.topRight.x=this.scaleBars.bottomRight.x=this._canvasWidth/2,this.scaleBars.left.y=this.scaleBars.top.y=this.scaleBars.topLeft.y=this.scaleBars.topRight.y=-this._canvasHeight/2,this.scaleBars.right.y=this.scaleBars.bottom.y=this.scaleBars.bottomLeft.y=this.scaleBars.bottomRight.y=this._canvasHeight/2},mp.prototype.updateScaleBarSizes=function(){this.scaleBars.left.itemWidth=this.scaleBars.right.itemWidth=this._canvasHeight,this.scaleBars.top.itemWidth=this.scaleBars.bottom.itemWidth=this._canvasWidth},mp.prototype.updateScaleBarScales=function(){for(var e in this.scaleBars){var t=this.scaleBars[e];switch(t.scale.y=1/this._canvasScale,e){case"topLeft":case"topRight":case"bottomLeft":case"bottomRight":t.scale.x=t.scale.y}}},mp.prototype.handleMainUIMouseOver=function(e){BFN.AppModel.viewState==this.appViewState&&(this.hovered=!0,this.isTouch=!1,this.show())},mp.prototype.handleMainUIMouseOut=function(e){this.hovered=!1,this.dragging||this.isTouch||this.hide()},mp.prototype.handleScaleBarMouseOver=function(e){!this.scaleBarDragger.dragging&&this._enabled&&(this.hoveredScaleBarID=e.currentTarget.id,setTimeout(function(){BFN.CursorScreen.cursor="arrow";var e=this.hoveredScaleBarID;switch(e){case"left":case"right":BFN.CursorScreen.cursorRotation=0;break;case"top":case"bottom":BFN.CursorScreen.cursorRotation=Math.PI/2;break;case"topLeft":case"bottomRight":BFN.CursorScreen.cursorRotation=Math.PI/4;break;case"topRight":case"bottomLeft":BFN.CursorScreen.cursorRotation=-Math.PI/4}BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=e,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.action="over",this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION)}.bind(this),0))},mp.prototype.handleScaleBarMouseOut=function(e){this.currentScaleBar?BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=this.currentScaleBar.id:(BFN.CursorScreen.cursor=null,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=null),BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.action="out",this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION)},mp.prototype.handleScaleBarPressed=function(e){if(!this.canvasModel.canvasScaling&&this._enabled){this.currentAspectRatio=this._canvasHeight/this._canvasWidth,this.currentScaleBar=e.currentTarget,this.hovered||(this.isTouch=!0,this.show()),this.isTouch&&(this.handleScaleBarMouseOverBind(e),this.currentScaleBar.handleMouseOver(),this.currentScaleBar.selected=!0);var t=this.currentScaleBar.id;switch(t){case"left":this.scaleBarDragger.setBounds(-this.maxSize,this.currentScaleBar.y,-this.minSize/2,this.currentScaleBar.y);break;case"right":this.scaleBarDragger.setBounds(this.minSize/2,this.currentScaleBar.y,this.maxSize,this.currentScaleBar.y);break;case"top":this.scaleBarDragger.setBounds(this.currentScaleBar.x,-this.maxSize,this.currentScaleBar.x,-this.minSize/2);break;case"bottom":this.scaleBarDragger.setBounds(this.currentScaleBar.x,this.minSize/2,this.currentScaleBar.x,this.maxSize);break;case"topLeft":this.scaleBarDragger.setBounds(-this.maxSize,-this.maxSize,-this.minSize/2,-this.minSize/2);break;case"topRight":this.scaleBarDragger.setBounds(this.minSize/2,-this.maxSize,this.maxSize,-this.minSize/2);break;case"bottomLeft":this.scaleBarDragger.setBounds(-this.maxSize,this.minSize/2,-this.minSize/2,this.maxSize);break;case"bottomRight":this.scaleBarDragger.setBounds(this.minSize/2,this.minSize/2,this.maxSize,this.maxSize)}for(var i in BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=t,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.action="press",this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION),BFN.CursorScreen.cursorLock=!0,document.addEventListener(BeFunky.pointerup,this.handleScaleBarReleasedBind),this.scaleBarDragger.drag(this.currentScaleBar),this.scaleBars){var r=this.scaleBars[i];r.selected=r==this.currentScaleBar,r.interactive=r==this.currentScaleBar}}},mp.prototype.handleScaleBarReleased=function(e){if(this.isTouch&&(this.handleScaleBarMouseOutBind(e),this.currentScaleBar&&(this.currentScaleBar.handleMouseOut(),this.currentScaleBar.selected=!1)),BFN.CursorScreen.cursorLock=!1,document.removeEventListener(BeFunky.pointerup,this.handleScaleBarReleasedBind),this.currentScaleBar){if(this.currentScaleBar.hovered){var t=this.currentScaleBar.id;BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=t}else BFN.CursorScreen.cursor=null,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=null;for(var i in BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.action="release",this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION),this.currentScaleBar=null,this.scaleBars){var r=this.scaleBars[i];r.selected=!1,r.interactive=!0}}},mp.prototype.handleScaleBarDraggerDragging=function(e){this.currentScaleBar&&(this._canvasWidth=Math.round(Math.abs(2*this.currentScaleBar.x)),this._canvasHeight=Math.round(Math.abs(2*this.currentScaleBar.y)),this.updateScaleBarPositions(),this.updateScaleBarSizes(),this.dispatchEvent(BFN.CanvasScaleBarsEvents.DIMENSIONS_UPDATED))},mp.prototype.handleScaleBarDraggerDraggingStarted=function(e){this.dragging=!0,this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALING_STARTED)},mp.prototype.handleScaleBarDraggerDraggingComplete=function(e){this.dragging=!1,this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALING_COMPLETE),this.hovered||this.handleMainUIMouseOut()},mp.prototype.handleFadeAnimatorUpdate=function(e){this.alpha=this.fadeAnimator.animationFactor},Object.defineProperty(mp.prototype,"enabled",{set:function(e){this._enabled=e},get:function(){return this._enabled}}),Object.defineProperty(mp.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.scaleBarDragger.scale=this._canvasScale,this.updateScaleBarScales()},get:function(){return this._canvasScale}}),Object.defineProperty(mp.prototype,"canvasWidth",{set:function(e){this._canvasWidth=e,this.updateScaleBarPositions(),this.updateScaleBarSizes()},get:function(){return this._canvasWidth}}),Object.defineProperty(mp.prototype,"canvasHeight",{set:function(e){this._canvasHeight=e,this.updateScaleBarPositions(),this.updateScaleBarSizes()},get:function(){return this._canvasHeight}}),Object.defineProperty(mp.prototype,"active",{set:function(e){this._active=e,this._active?this._active&&this._showing&&this.show():this.hide()},get:function(){return this._active}}),BFN.CanvasScaleBars=mp,pp.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),pp.prototype.init=function(){BeFunky.log("CanvasFrame Init"),this.initDefaultValues(),this.initRectangles(),this.setInnerDimensions(100,100),this.setOuterDimensions(200,200)},pp.prototype.initDefaultValues=function(){this.rectBaseSize=128,this._canvasScale=1},pp.prototype.initRectangles=function(){this.rectangles={},this.rectangles.top=this.createRect(-this.rectBaseSize/2,-this.rectBaseSize,this.rectBaseSize,this.rectBaseSize),this.rectangles.bottom=this.createRect(-this.rectBaseSize/2,0,this.rectBaseSize,this.rectBaseSize),this.rectangles.left=this.createRect(-this.rectBaseSize,-this.rectBaseSize/2,this.rectBaseSize,this.rectBaseSize),this.rectangles.right=this.createRect(0,-this.rectBaseSize/2,this.rectBaseSize,this.rectBaseSize)},pp.prototype.setInnerDimensions=function(e,t){this.innerW=e,this.innerH=t,this.rectangles.left.x=-this.innerW/2,this.rectangles.right.x=this.innerW/2,this.rectangles.top.y=-this.innerH/2,this.rectangles.bottom.y=this.innerH/2,this.updateDisplay()},pp.prototype.setOuterDimensions=function(e,t){this.outerW=e,this.outerH=t,this.updateDisplay()},pp.prototype.updateDisplay=function(){var e=Math.max(this._fitPaddingX/this._canvasScale,(this.outerW-this.innerW*this._canvasScale)/2/this._canvasScale)/this.rectBaseSize,t=this.innerH/this.rectBaseSize,i=(this.innerW+e*this.rectBaseSize*2)/this.rectBaseSize,r=Math.max(this._fitPaddingY/this._canvasScale,(this.outerH-this.innerH*this._canvasScale)/2/this._canvasScale)/this.rectBaseSize;this.rectangles.left.scale.x=this.rectangles.right.scale.x=e,this.rectangles.left.scale.y=this.rectangles.right.scale.y=t,this.rectangles.top.scale.x=this.rectangles.bottom.scale.x=i,this.rectangles.top.scale.y=this.rectangles.bottom.scale.y=r,BFN.MainUI&&BFN.MainUI.requestRender()},pp.prototype.createRect=function(e,t,i,r){var a=new PIXI.Sprite(PIXI.RenderTexture.create(i,r));return a.anchor.x=Math.max(0,Math.min(1,Math.abs(e/i))),a.anchor.y=Math.max(0,Math.min(1,Math.abs(t/r))),a.texture.fillColor(this._color,1),a.alpha=this._opacity,this.addChild(a),a},Object.defineProperty(pp.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.updateDisplay()},get:function(){return this._canvasScale}}),Object.defineProperty(pp.prototype,"opacity",{set:function(e){for(var t in this._opacity=Math.max(0,Math.min(1,e)),this.rectangles){this.rectangles[t].alpha=this._opacity}BFN.MainUI.requestRender()},get:function(){return this._opacity}}),BFN.CanvasFrame=pp,gp.prototype=Object.create(PIXI.Container.prototype),gp.prototype.init=function(){BeFunky.log("WindowedVeil Init"),this.initDefaultValues(),this.initVeil(),this.initVeilMask(),this.update(200,200,50,50,100,100)},gp.prototype.initDefaultValues=function(){this.rectBaseSize=32,this.alphaFilter=new PIXI.filters.AlphaFilter,this.filters=[this.alphaFilter]},gp.prototype.initVeil=function(){this.veilSprite=new PIXI.Sprite(PIXI.RenderTexture.create(this.rectBaseSize,this.rectBaseSize)),this.veilSprite.texture.fillColor(this._color,this._opacity),this.veilSprite.pluginName="smooth_picture",this.addChild(this.veilSprite)},gp.prototype.initVeilMask=function(){this.veilMaskTexture=PIXI.RenderTexture.create(this.rectBaseSize,this.rectBaseSize),this.veilMaskTexture.fillColor(16777215),this.veilMaskSprite=new PIXI.Sprite(this.veilMaskTexture),this.veilMaskSprite.pluginName="blend_picture",this.veilMaskSprite.blendMode=BFN.CONST.BLEND_MODES.ALPHA,this.addChild(this.veilMaskSprite)},gp.prototype.update=function(e,t,i,r,a,n){this.outerW=e,this.outerH=t,this.innerX=i,this.innerY=r,this.innerW=a,this.innerH=n,this.updateDisplay()},gp.prototype.updateDisplay=function(){this.veilSprite.width=this.outerW,this.veilSprite.height=this.outerH,this.veilMaskSprite.x=this.innerX,this.veilMaskSprite.y=this.innerY,this.veilMaskSprite.width=this.innerW,this.veilMaskSprite.height=this.innerH,BFN.MainUI&&BFN.MainUI.requestRender()},gp.prototype.setMaskTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;if(e&&e.baseTexture){var r=new PIXI.Texture(e.baseTexture);r.rotate=[0,12,8,4][t+2*i],this.veilMaskTexture.resize(r.width,r.height),this.veilMaskTexture.copyPixels(r),r.destroy(!1)}else this.veilMaskTexture.resize(this.rectBaseSize,this.rectBaseSize),this.veilMaskTexture.fillColor(16777215);this.updateDisplay()},BFN.WindowedVeil=gp,fp.prototype=Object.create(PIXI.Sprite.prototype),fp.prototype.init=function(){BeFunky.log("EyeDropper Init"),this.initDefaultValues(),this.initHitSurface(),this.initEyeDropper(),this.initEyeDropperMask(),this.initEyeDropperOutline(),this.initAnimator()},fp.prototype.initDefaultValues=function(){this.interactive=!0,this.sourceTexture=null,this.showing=!1,this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},fp.prototype.initHitSurface=function(){this.hitSurface=new PIXI.Graphics,this.hitSurface.beginFill(0,0),this.hitSurface.drawRect(0,0,100,100),this.hitSurface.endFill(),this.addChild(this.hitSurface)},fp.prototype.initEyeDropper=function(){this.pixelSize=16,this.pixelRows=5,this.pixelCols=5,this.pixelThresholdX=Math.floor(this.pixelCols/2),this.pixelThresholdY=Math.floor(this.pixelRows/2),this.eyeDropperW=this.pixelSize*this.pixelCols,this.eyeDropperH=this.pixelSize*this.pixelRows,this.positionChanged=!1,this.offsetPoint=new PIXI.Point,this.eyeDropperContainer=new PIXI.Container,this.addChild(this.eyeDropperContainer),this.eyeDropperTexture=PIXI.RenderTexture.create(this.pixelCols,this.pixelRows,PIXI.SCALE_MODES.NEAREST),this.eyeDropperSprite=new PIXI.Sprite(this.eyeDropperTexture),this.eyeDropperSprite.anchor.x=this.eyeDropperSprite.anchor.y=.5,this.eyeDropperSprite.scale.x=this.eyeDropperSprite.scale.y=this.pixelSize,this.eyeDropperContainer.addChild(this.eyeDropperSprite),this.selectionSquare=new PIXI.Graphics,this.selectionSquare.lineStyle(3,0,.5),this.selectionSquare.drawRect(-this.pixelSize/2,-this.pixelSize/2,this.pixelSize,this.pixelSize),this.selectionSquare.lineStyle(2,16777215,1),this.selectionSquare.drawRect(-this.pixelSize/2,-this.pixelSize/2,this.pixelSize,this.pixelSize),this.eyeDropperContainer.addChild(this.selectionSquare)},fp.prototype.initEyeDropperMask=function(){this.maskTexture=PIXI.RenderTexture.create(this.eyeDropperW,this.eyeDropperH),BFN.graphics.drawShape("roundedRect",this.maskTexture,{strokeWidth:0,strokeColor:0,fillColor:4294967295,cornerRadius:Math.min(this.eyeDropperW,this.eyeDropperH)/2,paddingX:4,paddingY:4,clear:!0}),this.maskSprite=new PIXI.Sprite(this.maskTexture),this.maskSprite.anchor.x=this.maskSprite.anchor.y=.5,this.eyeDropperContainer.addChild(this.maskSprite),this.eyeDropperSprite.mask=this.maskSprite},fp.prototype.initEyeDropperOutline=function(){this.outlineTexture=PIXI.RenderTexture.create(this.eyeDropperW,this.eyeDropperH),BFN.graphics.drawShape("roundedRect",this.outlineTexture,{strokeWidth:4,strokeColor:2147483648,fillColor:0,cornerRadius:Math.min(this.eyeDropperW,this.eyeDropperH)/2,paddingX:2,paddingY:2,clear:!0}),BFN.graphics.drawShape("roundedRect",this.outlineTexture,{strokeWidth:2,strokeColor:4294967295,fillColor:0,cornerRadius:Math.min(this.eyeDropperW,this.eyeDropperH)/2,paddingX:3,paddingY:3,clear:!1}),this.outlineSprite=new PIXI.Sprite(this.outlineTexture),this.outlineSprite.anchor.x=this.outlineSprite.anchor.y=.5,this.eyeDropperContainer.addChild(this.outlineSprite)},fp.prototype.initAnimator=function(){this.animator=new BFN.Animator,this.animator.linearSteps=10,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.animator.setAnimatorFactor(0)},fp.prototype.activate=function(e,t,i){this.reset(),BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.sourceTexture=e,this.eyeDropperContainer.x=t,this.eyeDropperContainer.y=i,this.positionChanged=!0,BFN.MainUI.requestRender(),this.updateHitSurface()},fp.prototype.update=function(e,t){this.showing||(this.showing=!0,this.animator.increase()),this.eyeDropperContainer.x=e,this.eyeDropperContainer.y=t,this.positionChanged=!0,BFN.MainUI.requestRender()},fp.prototype.deactivate=function(){this.handleMainUIPreRender(),this.animator.setAnimatorFactor(1),this.animator.decrease(),this.reset()},fp.prototype.reset=function(){BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.showing=!1;try{this.sourceTexture.destroyGC(!0)}catch(e){}this.sourceTexture=null},fp.prototype.updateHitSurface=function(){this.hitSurface.width=BFN.StageModel.stageW,this.hitSurface.height=BFN.StageModel.stageH},fp.prototype.handleMainUIPreRender=function(e){if(this.positionChanged){this.positionChanged=!1;var t=this.eyeDropperSprite.x<=this.pixelThresholdX||this.eyeDropperSprite.x>=this.sourceTexture.width-this.pixelThresholdX||this.eyeDropperSprite.y<=this.pixelThresholdY||this.eyeDropperSprite.y>=this.sourceTexture.height-this.pixelThresholdY;t&&this.eyeDropperTexture.fillColor(BFN.AppBackgroundColor),this.offsetPoint.x=this.pixelThresholdX-this.eyeDropperContainer.x,this.offsetPoint.y=this.pixelThresholdY-this.eyeDropperContainer.y,this.eyeDropperTexture.copyPixels(this.sourceTexture,this.offsetPoint,!t)}},fp.prototype.handleAnimatorUpdate=function(e){this.visible=this.animator.animationFactor>0,this.eyeDropperContainer.alpha=this.animator.animationFactor,this.eyeDropperContainer.scale.x=this.eyeDropperContainer.scale.y=1.2-.2*this.animator.animationFactor},Object.defineProperty(BFN,"EyeDropper",{get:function(){return BFN._EyeDropper||(BFN._EyeDropper=new fp,BFN.MainUI.eyeDropperContainer.addChild(BFN._EyeDropper)),BFN._EyeDropper}}),vp.prototype=Object.create(PIXI.Sprite.prototype),vp.prototype.init=function(){BeFunky.log("BrushCircle Init"),this.initDefaultValues(),this.initBrushGraphic(),this.initBrushSprite(),this.initAnimator()},vp.prototype.initDefaultValues=function(){this.visible=!1,this.showing=!1,this._radius=0,this._targetEnabled=!1,this._locked=!1,this.strokeWidth=2,this.strokeShadowWidth=.5,this.handleMouseMoveBind=this.handleMouseMove.bind(this)},vp.prototype.initBrushGraphic=function(){this.brushGraphic=new PIXI.Graphics,this.brushGraphic.boundsPadding=2},vp.prototype.initBrushSprite=function(){this.brushSpriteTexture=PIXI.RenderTexture.create(32,32),this.brushSprite=new PIXI.Sprite(this.brushSpriteTexture),this.brushSprite.anchor.x=this.brushSprite.anchor.y=.5,this.addChild(this.brushSprite)},vp.prototype.initAnimator=function(){this.animator=new BFN.Animator,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.animator.setAnimatorFactor(0)},vp.prototype.show=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._locked=this._locked||i,document.body.setStyles({cursor:"none"}),this.showing=!0,BFN.MainUI.on("pointermove",this.handleMouseMoveBind),null!=e&&this._radius!=Math.max(1,Math.round(e))&&(this._radius=Math.max(1,Math.round(e)),this.updateCircle()),this.animator.increase(),this.updatePosition(t)},vp.prototype.hide=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._locked=!e&&this._locked,this._locked||(document.body.setStyles({cursor:"auto"}),this.showing=!1,BFN.MainUI.off("pointermove",this.handleMouseMoveBind),this.animator.decrease())},vp.prototype.updateCircle=function(){var e=Math.round(2*(this._radius+this.strokeWidth/2+this.strokeShadowWidth));if(this.brushSprite.texture.resize(e,e),BFN.graphics.drawShape("ellipse",this.brushSprite.texture,{strokeWidth:this.strokeWidth+2*this.strokeShadowWidth,strokeColor:2147483648}),this._targetEnabled){var t=this.strokeWidth+2*this.strokeShadowWidth,i=e/2-this.strokeWidth/2-this.strokeShadowWidth-1;BFN.graphics.drawShape("roundedRect",this.brushSprite.texture,{fillColor:2147483648,paddingX:t,paddingY:i,clear:!1}),BFN.graphics.drawShape("roundedRect",this.brushSprite.texture,{fillColor:2147483648,paddingX:i,paddingY:t,clear:!1})}if(BFN.graphics.drawShape("ellipse",this.brushSprite.texture,{strokeWidth:this.strokeWidth,strokeColor:4294967295,paddingX:this.strokeShadowWidth,paddingY:this.strokeShadowWidth,clear:!1}),this._targetEnabled){var r=this.strokeWidth+this.strokeShadowWidth,a=e/2-this.strokeWidth/2-1;BFN.graphics.drawShape("roundedRect",this.brushSprite.texture,{fillColor:4294967295,paddingX:r,paddingY:a,clear:!1}),BFN.graphics.drawShape("roundedRect",this.brushSprite.texture,{fillColor:4294967295,paddingX:a,paddingY:r,clear:!1})}BFN.MainUI.requestRender()},vp.prototype.updatePosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e?e.data.getLocalPosition(BFN.MainUI):BFN.MainUI.getMousePosition();this.x=t.x,this.y=t.y,BFN.MainUI.requestRender()},vp.prototype.handleMouseMove=function(e){this.updatePosition(e)},vp.prototype.handleAnimatorUpdate=function(e){this.alpha=this.animator.animationFactor,this.visible=this.alpha>0},Object.defineProperty(vp.prototype,"targetEnabled",{set:function(e){this._targetEnabled!=e&&(this._targetEnabled=e,this.updateCircle())},get:function(){return this._targetEnabled}}),Object.defineProperty(vp.prototype,"radius",{set:function(e){var t=Math.max(1,Math.round(e));this._radius!=t&&(this._radius=Math.round(t),this.updateCircle())},get:function(){return this._radius}}),BFN.SingletonQueue.add(function(){BFN.BrushCircle=new vp}),yp.prototype=Object.create(PIXI.Sprite.prototype),yp.prototype.init=function(){BeFunky.log("BrushCirclePreview Init"),this.initDefaultValues(),this.initAnimator()},yp.prototype.initDefaultValues=function(){this._radius=0,this.strokeWidth=2,this.strokeShadowWidth=.5,this.texture=PIXI.RenderTexture.create(32,32),this.texture.clear(),this.anchor.x=this.anchor.y=.5},yp.prototype.initAnimator=function(){this.animator=new BFN.Animator,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.animator.setAnimatorFactor(0)},yp.prototype.show=function(e){if(this.visible||(this.x=BFN.StageModel.stageW/2,this.y=BFN.StageModel.stageH/2,this.animator.increase()),this._radius!=Math.max(1,Math.round(e))){this._radius=Math.max(1,Math.round(e));var t=Math.round(2*(this._radius+this.strokeWidth/2+this.strokeShadowWidth));this.texture.resize(t,t),BFN.graphics.drawShape("ellipse",this.texture,{strokeWidth:this.strokeWidth+2*this.strokeShadowWidth,strokeColor:2147483648}),BFN.graphics.drawShape("ellipse",this.texture,{strokeWidth:this.strokeWidth,strokeColor:4294967295,clear:!1,paddingX:this.strokeShadowWidth,paddingY:this.strokeShadowWidth}),BFN.MainUI.requestRender()}},yp.prototype.hide=function(){this.animator.decrease()},yp.prototype.handleAnimatorUpdate=function(e){this.alpha=this.animator.animationFactor,this.visible=this.alpha>0},BFN.SingletonQueue.add(function(){BFN.BrushCirclePreview=new yp}),xp.prototype=Object.create(PIXI.Sprite.prototype),xp.prototype.init=function(){BeFunky.log("StrokeLine Init"),this.initDefaultValues(),this.initLineSprite()},xp.prototype.initDefaultValues=function(){this._scale=1,this._length=1,this._highlight=!1,this.smoothPaddingAmount=10},xp.prototype.initLineSprite=function(){this.uniqueTextureID&&(BFN.uniqueStrokeLineTextures||(BFN.uniqueStrokeLineTextures={})),this.uniqueTextureID&&BFN.uniqueStrokeLineTextures.hasOwnProperty(this.uniqueTextureID)&&(this.strokeLineTexture=BFN.uniqueStrokeLineTextures[this.uniqueTextureID]),this.strokeLineTexture||(this.dashed?(this.strokeLineTexture=PIXI.RenderTexture.create(8,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0),this.isLinear?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST),BFN.graphics.drawShape("roundedRect",this.strokeLineTexture,{fillColor:this.darkerColor,edgePadding:0,paddingY:this.smoothPadding?this.smoothPaddingAmount/2:0,cornerRadius:0,clear:!0,paddingR:4}),BFN.graphics.drawShape("roundedRect",this.strokeLineTexture,{fillColor:this.lighterColor,edgePadding:0,paddingY:this.smoothPadding?this.smoothPaddingAmount/2:0,cornerRadius:0,clear:!1,paddingL:4})):(this.strokeLineTexture=PIXI.RenderTexture.create(8,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0),this.isLinear?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST),BFN.graphics.drawShape("roundedRect",this.strokeLineTexture,{fillColor:this.lighterColor,edgePadding:0,paddingY:this.smoothPadding?this.smoothPaddingAmount/2:0,cornerRadius:0})),this.uniqueTextureID&&(BFN.uniqueStrokeLineTextures[this.uniqueTextureID]=this.strokeLineTexture)),this.strokeLine=new PIXI.extras.TilingSprite(this.strokeLineTexture,2,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0)),this.strokeLine.anchor.y=.5,this.strokeLine.y=-.001,this.addChild(this.strokeLine)},xp.prototype.convertToMasked=function(){this.isMasked||(this.isMasked=!0,this.strokeLineMask=new PIXI.Graphics,this.strokeLine.mask=this.strokeLineMask,this.addChild(this.strokeLineMask),this.strokeLineMaskH=2*Math.ceil(this.strokeLineTexture.height/2))},xp.prototype.showMaskedLines=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isMasked&&(this.maskedSegmentsClear||(this.strokeLineMask.clear(),this.maskedSegmentsClear=!0),e?(this.strokeLine.mask=this.strokeLineMask,e.forEach(e=>{this.maskedSegmentsClear&&(this.maskedSegmentsClear=!1);var t=e.start,i=e.end;t<i&&(this.strokeLineMask.beginFill(16777215),this.strokeLineMask.drawRect(t,-this.strokeLineMaskH/2,i-t,this.strokeLineMaskH),this.strokeLineMask.endFill())})):this.strokeLine.mask=null)},xp.prototype.convertToRuler=function(){this.isRuler||(this.isRuler=!0,this.isRulerClear=!0,this.uniqueTextureID&&BFN.uniqueStrokeLineTextures.hasOwnProperty(this.uniqueTextureID+"_ruler")&&(this.rulerTexture=BFN.uniqueStrokeLineTextures[this.uniqueTextureID+"_ruler"]),this.rulerTexture||(this.rulerTexture=PIXI.RenderTexture.create(8,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0),this.isLinear?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST),BFN.graphics.drawShape("roundedRect",this.rulerTexture,{fillColor:4294902015,edgePadding:0,paddingY:this.smoothPadding?this.smoothPaddingAmount/2:0,cornerRadius:0}),this.uniqueTextureID&&(BFN.uniqueStrokeLineTextures[this.uniqueTextureID+"_ruler"]=this.rulerTexture)),this.rulerLine=new PIXI.extras.TilingSprite(this.rulerTexture,2,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0)),this.rulerLine.anchor.y=.5,this.addChild(this.rulerLine),this.rulerMask=new PIXI.Graphics,this.rulerLine.mask=this.rulerMask,this.addChild(this.rulerMask),this.rulerMaskH=2*Math.ceil(this.rulerTexture.height/2))},xp.prototype.showRulers=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isRuler&&(this.isRulerClear||(this.rulerMask.clear(),this.isRulerClear=!0),e&&e.forEach(e=>{if(e&&e.hasOwnProperty("start")&&e.hasOwnProperty("end")){this.isRulerClear&&(this.isRulerClear=!1);var t=e.start,i=e.end;t<i&&(this.rulerMask.beginFill(16777215),this.rulerMask.drawRect(t,-this.rulerMaskH/2,i-t,this.rulerMaskH),this.rulerMask.endFill())}}))},xp.prototype.getStrokeLineHighlightTexture=function(){if(!this.strokeLineHighlightTexture)if(this.uniqueTextureID&&BFN.uniqueStrokeLineTextures.hasOwnProperty(this.uniqueTextureID+"_highlight"))this.strokeLineHighlightTexture=BFN.uniqueStrokeLineTextures[this.uniqueTextureID+"_highlight"];else{var e=BFN.ColorUtil.rgbaObjectToHexStringObject(BFN.ColorUtil.hexNumberToRGBAObject(this.lighterColor));this.strokeLineHighlightTexture=PIXI.RenderTexture.create(this.strokeLineTexture.width,Math.max(this.strokeLineTexture.height,this.lineThickness+6));var t=(this.strokeLineHighlightTexture.height-this.lineThickness)/2-3;this.strokeLineHighlightTexture.clear();for(var i=0;i<3;i++)this.strokeLineHighlightTexture.fillColorOverlap(parseInt("0x"+e.hex),Math.max(0,Math.min(1,e.alpha*(.05+.075*i))),0,t+i,this.strokeLineHighlightTexture.width,this.lineThickness+2*(3-i));this.strokeLineHighlightTexture.copyPixels(this.strokeLineTexture,{x:0,y:(this.strokeLineHighlightTexture.height-this.strokeLineTexture.height)/2},!1),this.uniqueTextureID&&(BFN.uniqueStrokeLineTextures[this.uniqueTextureID+"_highlight"]=this.strokeLineHighlightTexture)}return this.strokeLineHighlightTexture},Object.defineProperty(xp.prototype,"length",{set:function(e){this._length=e,this.strokeLine.width=this._length*this._scale,this.isRuler&&(this.strokeLine.width=this.strokeLine.width);try{BFN.MainUI.requestRender()}catch(e){}},get:function(){return this.strokeLine.width}}),Object.defineProperty(xp.prototype,"scale",{set:function(e){this._scale=e,this.strokeLine.width=this._length*this._scale,this.strokeLine.scale.x=1/this._scale,this.strokeLine.scale.y=1/this._scale,this.isMasked&&(this.strokeLineMask.scale.x=this.strokeLine.scale.x,this.strokeLineMask.scale.y=this.strokeLine.scale.y),this.isRuler&&(this.rulerLine.width=this.strokeLine.width,this.rulerLine.scale.x=this.strokeLine.scale.x,this.rulerLine.scale.y=this.strokeLine.scale.y,this.rulerMask.scale.x=this.strokeLine.scale.x,this.rulerMask.scale.y=this.strokeLine.scale.y);try{BFN.MainUI.requestRender()}catch(e){}},get:function(){return this._scale}}),Object.defineProperty(xp.prototype,"highlight",{set:function(e){if(this._highlight!=!!e){this._highlight=!!e,this._highlight?this.strokeLine.texture=this.getStrokeLineHighlightTexture():this.strokeLine.texture!=this.strokeLineTexture&&(this.strokeLine.texture=this.strokeLineTexture);try{BFN.MainUI.requestRender()}catch(e){}}},get:function(){return this._highlight}}),BFN.StrokeLine=xp,_p.prototype=Object.create(PIXI.Sprite.prototype),_p.prototype.init=function(){BeFunky.log("StrokeRectangle Init"),this.initDefaultValues(),this.initStrokeLines(),this.updateDisplay()},_p.prototype.initDefaultValues=function(){this._width=100,this._height=100,this._scale=1,this._highlight=!1},_p.prototype.initStrokeLines=function(){this.strokeLineTop=new BFN.StrokeLine(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID),this.strokeLineTop.rotation=0*Math.PI,this.addChild(this.strokeLineTop),this.strokeLineRight=new BFN.StrokeLine(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID),this.strokeLineRight.rotation=.5*Math.PI,this.addChild(this.strokeLineRight),this.strokeLineBottom=new BFN.StrokeLine(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID),this.strokeLineBottom.rotation=1*Math.PI,this.addChild(this.strokeLineBottom),this.strokeLineLeft=new BFN.StrokeLine(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID),this.strokeLineLeft.rotation=1.5*Math.PI,this.addChild(this.strokeLineLeft)},_p.prototype.setDimensions=function(e,t){this._width=Math.abs(e),this._height=Math.abs(t),this.updateDisplay()},_p.prototype.updateDisplay=function(){this.strokeLineTop.x=-this._width/2,this.strokeLineTop.y=-this._height/2,this.strokeLineTop.length=this._width,this.strokeLineRight.x=this._width/2,this.strokeLineRight.y=-this._height/2,this.strokeLineRight.length=this._height,this.strokeLineBottom.x=this._width/2,this.strokeLineBottom.y=this._height/2,this.strokeLineBottom.length=this._width,this.strokeLineLeft.x=-this._width/2,this.strokeLineLeft.y=this._height/2,this.strokeLineLeft.length=this._height},Object.defineProperty(_p.prototype,"scale",{set:function(e){this._scale=e,this.strokeLineTop.scale=this._scale,this.strokeLineRight.scale=this._scale,this.strokeLineBottom.scale=this._scale,this.strokeLineLeft.scale=this._scale,this.updateDisplay(),BFN.MainUI.requestRender()},get:function(){return this._scale}}),Object.defineProperty(_p.prototype,"width",{get:function(){return this._width}}),Object.defineProperty(_p.prototype,"height",{get:function(){return this._height}}),Object.defineProperty(_p.prototype,"highlight",{set:function(e){this._highlight!=!!e&&(this._highlight=!!e,this.strokeLineLeft.highlight=this._highlight,this.strokeLineRight.highlight=this._highlight,this.strokeLineTop.highlight=this._highlight,this.strokeLineBottom.highlight=this._highlight)},get:function(){return this._highlight}}),BFN.StrokeRectangle=_p,Ip.prototype=Object.create(PIXI.Container.prototype),Ip.prototype.init=function(){BeFunky.log("StrokeRectanglePool Init"),this.initDefaultValues()},Ip.prototype.initDefaultValues=function(){this.interactive=!1,this.strokeRectangles=[],this.strokeRectangleIndex=0},Ip.prototype.add=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:128,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=this.strokeRectangleIndex>=this.strokeRectangles.length?this.createStrokeRectangle():this.strokeRectangles[this.strokeRectangleIndex];return this.setTransform(n,e,t,i,r,a),this.addChild(n),this.strokeRectangleIndex++,BFN.MainUI.requestRender(),n},Ip.prototype.setTransform=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:128,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:128,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(e){var o=Math.sqrt(Math.pow(r,2)+Math.pow(a,2)),s=Math.atan2(a,r);e.x=t+Math.cos(n+s)*(o/2),e.y=i+Math.sin(n+s)*(o/2),e.setDimensions(r,a),e.rotation=n,e.scale=this._scale}},Ip.prototype.clear=function(){for(this.strokeRectangleIndex=0;this.children.length;)this.removeChild(this.children[0]);BFN.MainUI.requestRender()},Ip.prototype.createStrokeRectangle=function(){var e=new BFN.StrokeRectangle(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID);return this.strokeRectangles.push(e),e},Object.defineProperty(Ip.prototype,"poolScale",{set:function(e){this._scale=e,this.children.forEach(t=>{t.scale=e}),BFN.MainUI.requestRender()},get:function(){return this._scale}}),BFN.StrokeRectanglePool=Ip,Tp.prototype=Object.create(PIXI.Sprite.prototype),Tp.prototype.init=function(){BeFunky.log("CropGrid Init"),this.initDefaultValues(),this.initOutline(),this.initGridLines(),this.updateDisplay(),this.outlineFilter=new BFN.filters.OutlineFilter(1,0),this.filters=[this.outlineFilter]},Tp.prototype.initDefaultValues=function(){this._width=100,this._height=100,this._scale=1},Tp.prototype.initOutline=function(){this.outline=new BFN.StrokeRectangle,this.addChild(this.outline)},Tp.prototype.initGridLines=function(){this.gridLineTop=new BFN.StrokeLine,this.gridLineTop.rotation=0*Math.PI,this.addChild(this.gridLineTop),this.gridLineRight=new BFN.StrokeLine,this.gridLineRight.rotation=.5*Math.PI,this.addChild(this.gridLineRight),this.gridLineBottom=new BFN.StrokeLine,this.gridLineBottom.rotation=1*Math.PI,this.addChild(this.gridLineBottom),this.gridLineLeft=new BFN.StrokeLine,this.gridLineLeft.rotation=1.5*Math.PI,this.addChild(this.gridLineLeft)},Tp.prototype.setDimensions=function(e,t){this._width=Math.abs(e),this._height=Math.abs(t),this.updateDisplay()},Tp.prototype.updateDisplay=function(){this.outline.setDimensions(this._width,this._height),this.gridLineTop.x=-this._width/2,this.gridLineTop.y=-this._height/6,this.gridLineTop.length=this._width,this.gridLineRight.x=this._width/6,this.gridLineRight.y=-this._height/2,this.gridLineRight.length=this._height,this.gridLineBottom.x=this._width/2,this.gridLineBottom.y=this._height/6,this.gridLineBottom.length=this._width,this.gridLineLeft.x=-this._width/6,this.gridLineLeft.y=this._height/2,this.gridLineLeft.length=this._height},Object.defineProperty(Tp.prototype,"scale",{set:function(e){this._scale=e,this.outline.scale=this._scale,this.gridLineTop.scale=this._scale,this.gridLineRight.scale=this._scale,this.gridLineBottom.scale=this._scale,this.gridLineLeft.scale=this._scale,this.updateDisplay(),BFN.MainUI.requestRender()},get:function(){return this._scale}}),BFN.CropGrid=Tp,bp.prototype=Object.create(PIXI.Container.prototype),bp.prototype.init=function(){BeFunky.log("CheckerPanel Init"),this.initDefaultValues(),this.initCheckerTexture(),this.initCheckerSprite()},bp.prototype.initDefaultValues=function(){this.interactive=!1,this.checkerSize=8,this.checkerColorA=14474460,this.checkerColorB=16777215,this._centered=!0,this._width=20,this._height=20,this._scale=1},bp.prototype.initCheckerTexture=function(){this.checkerTexture=PIXI.RenderTexture.create(2*this.checkerSize,2*this.checkerSize),this.checkerTexture.fillRect(0,0,2*this.checkerSize,2*this.checkerSize,this.checkerColorA,1),this.checkerTexture.fillRect(0,0,this.checkerSize,this.checkerSize,this.checkerColorB,1),this.checkerTexture.fillRect(this.checkerSize,this.checkerSize,this.checkerSize,this.checkerSize,this.checkerColorB,1),this.checkerTexture.setScaleMode(PIXI.SCALE_MODES.NEAREST)},bp.prototype.initCheckerSprite=function(){this.checkerSprite=new PIXI.extras.TilingSprite(this.checkerTexture,2*this.checkerSize,2*this.checkerSize),this.checkerSprite.interactive=!1,this.addChild(this.checkerSprite)},bp.prototype.setDimensions=function(e,t){this._width=Math.abs(e),this._height=Math.abs(t),this.updateDisplay()},bp.prototype.updateDisplay=function(){this.checkerSprite.anchor.x=this.checkerSprite.anchor.y=this._centered?.5:0,this.checkerSprite.scale.x=this.checkerSprite.scale.y=1/this._scale,this.checkerSprite.width=Math.max(0,this._width/this.checkerSprite.scale.x-1),this.checkerSprite.height=Math.max(0,this._height/this.checkerSprite.scale.y-1);try{BFN.MainUI.requestRender()}catch(e){}},Object.defineProperty(bp.prototype,"centered",{set:function(e){this._centered=e,this.updateDisplay()},get:function(){return this._centered}}),Object.defineProperty(bp.prototype,"width",{set:function(e){this._width=Math.abs(e),this.updateDisplay()},get:function(){return this._width}}),Object.defineProperty(bp.prototype,"height",{set:function(e){this._height=Math.abs(e),this.updateDisplay()},get:function(){return this._height}}),Object.defineProperty(bp.prototype,"scale",{set:function(e){this._scale=e,this.updateDisplay()},get:function(){return this._scale}}),BFN.CheckerPanel=bp,Sp.prototype=Object.create(PIXI.Sprite.prototype),Sp.prototype.init=function(){BeFunky.log("BlendModeSprite Init"),this.initDefaultValues(),this.initSourceSprite(),this.initBlendFilters(),BFN.AppModel.appReady?(BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)),this.setBlendMode(BFN.CONST.BLEND_MODES.NORMAL)):BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,function(e){BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)),this.setBlendMode(BFN.CONST.BLEND_MODES.NORMAL)}.bind(this))},Sp.prototype.initDefaultValues=function(){this._intensity=1,this.texture=null,this.renderPending=!1},Sp.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite},Sp.prototype.initBlendFilters=function(){for(var e in this.blendFilters={},BFN.CONST.BLEND_MODES)this.blendFilters[BFN.CONST.BLEND_MODES[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES[e])},Sp.prototype.setBlendMode=function(e){this.blendFilters.hasOwnProperty(e)?this.sourceSprite.filters=[this.blendFilters[e]]:this.sourceSprite.filters=[],this.updateDisplay()},Sp.prototype.setBaseTexture=function(e){null!=this.texture&&(this.texture.destroyGC(!0),this.texture=null),e&&(this.sourceSprite.texture=e,this.texture=PIXI.RenderTexture.create(this.sourceSprite.texture.width,this.sourceSprite.texture.height),this.updateDisplay())},Sp.prototype.setBlendIntensity=function(e){for(var t in e=Math.min(1,Math.max(0,e)),this.blendFilters)this.blendFilters[t].intensity=e;this.updateDisplay()},Sp.prototype.setBlendTexture=function(e){if(e){for(var t in this.blendFilters)this.blendFilters[t].iChannel1=e;this.updateDisplay()}},Sp.prototype.updateDisplay=function(){this.autoRender&&(this.renderPending=!0,BFN.MainUI.requestRender())},Sp.prototype.renderDisplay=function(){BFN.Stage.render(this.sourceSprite,this.texture)},Sp.prototype.handleMainUIPreRender=function(){this.renderPending&&(this.renderPending=!1,this.texture&&this.renderDisplay())},Object.defineProperty(Sp.prototype,"intensity",{set:function(e){this._intensity=Math.max(0,Math.min(1,e))},get:function(){return this._intensity}}),BFN.BlendModeSprite=Sp,Cp.prototype=Object.create(PIXI.Sprite.prototype),Cp.prototype.init=function(){BeFunky.log("MaskBlendSprite Init"),this.initDefaultValues()},Cp.prototype.initDefaultValues=function(){this.maskBlendTexture=null,this.displayUpdatePending=!1,this.renderPending=!1,this.sourceSprite=new PIXI.Sprite,this.maskBlendFilter=new BFN.filters.MaskBlendFilter,BFN.AppModel.appReady?BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)):BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,function(e){BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this))}.bind(this))},Cp.prototype.updateDisplay=function(){this.displayUpdatePending=!0,this.autoRender&&this.maskBlendTexture&&!this.renderPending&&(this.displayUpdatePending=!1,this.renderPending=!0,BFN.MainUI.requestRender())},Cp.prototype.renderDisplay=function(){this.maskBlendTexture&&BFN.Stage.render(this.sourceSprite,this.texture)},Cp.prototype.reset=function(){this.displayUpdatePending=!1,this.inverse=!1,this.blendColor=null,this.blendIntensity=1,this.inputTexture=null,this.blendTexture=null,this.maskTexture=null},Cp.prototype.handleMainUIPreRender=function(){this.renderPending&&(this.renderPending=!1,this.renderDisplay())},Object.defineProperty(Cp.prototype,"autoRender",{set:function(e){this._autoRender=e,this._autoRender&&this.displayUpdatePending&&this.updateDisplay()},get:function(){return this._autoRender}}),Object.defineProperty(Cp.prototype,"inverse",{set:function(e){e!=this.maskBlendFilter.inverse&&(this.maskBlendFilter.inverse=e,this.updateDisplay())},get:function(){return this.maskBlendFilter.inverse}}),Object.defineProperty(Cp.prototype,"unmaskedAlpha",{set:function(e){e!=this.maskBlendFilter.unmaskedAlpha&&(this.maskBlendFilter.unmaskedAlpha=e,this.updateDisplay())},get:function(){return this.maskBlendFilter.unmaskedAlpha}}),Object.defineProperty(Cp.prototype,"blendColor",{set:function(e){e!=this.maskBlendFilter.blendColor&&(this.maskBlendFilter.blendColor=e,this.updateDisplay())},get:function(){return this.maskBlendFilter.blendColor}}),Object.defineProperty(Cp.prototype,"blendIntensity",{set:function(e){e!=this.maskBlendFilter.blendIntensity&&(this.maskBlendFilter.blendIntensity=e,this.updateDisplay())},get:function(){return this.maskBlendFilter.blendIntensity}}),Object.defineProperty(Cp.prototype,"inputTexture",{set:function(e){if(null!==this.maskBlendTexture){try{this.maskBlendTexture.destroyGC(!0)}catch(e){}this.maskBlendTexture=null,this.texture=PIXI.Texture.EMPTY}e?(this.sourceSprite.texture=e,this.sourceSprite.filters=[this.maskBlendFilter],this.maskBlendTexture=PIXI.RenderTexture.create(this.sourceSprite.texture.width,this.sourceSprite.texture.height),this.texture=this.maskBlendTexture,this.updateDisplay()):(this.sourceSprite.texture=PIXI.Texture.EMPTY,this.sourceSprite.filters=[])},get:function(){return this.sourceSprite.texture}}),Object.defineProperty(Cp.prototype,"blendTexture",{set:function(e){this.maskBlendFilter.blendTexture=e,this.updateDisplay()},get:function(){return this.maskBlendFilter.blendTexture}}),Object.defineProperty(Cp.prototype,"maskTexture",{set:function(e){this.maskBlendFilter.maskTexture=e,this.updateDisplay()},get:function(){return this.maskBlendFilter.maskTexture}}),Object.defineProperty(Cp.prototype,"useInputAlpha",{set:function(e){this.maskBlendFilter.useInputAlpha=e,this.updateDisplay()},get:function(){return this.maskBlendFilter.useInputAlpha}}),BFN.MaskBlendSprite=Cp,Bp.prototype=Object.create(PIXI.Sprite.prototype),Bp.prototype.init=function(){BeFunky.log("FrameSprite Init"),this.initDefaultValues()},Bp.prototype.initDefaultValues=function(){this.frameSprite=this,this.rotateValues=[0,2,4,6,8,10,12,14],this._frameWidth=100,this._frameHeight=100,this._offsetFactorX=.5,this._offsetFactorY=.5,this._textureScale=1,this._textureScaleX=1,this._textureScaleY=1,this._isEmpty=!0,this._imageRect=new PIXI.Rectangle,this.textureFrame=new PIXI.Rectangle,this.adjustScale=1,this.excessX=0,this.excessY=0,this.frameScaling=!1,this.frameStretching=!1,this.frameAnchorSide=null,this.frameAnchorPoint=new PIXI.Point,this.updateDisplayCallback=null},Bp.prototype.setTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.texture=e,this.baseTexture=this.texture&&this.texture.baseTexture?this.texture.baseTexture:null,this.updateValues()},Bp.prototype.updateValues=function(){this.textureFrame=new PIXI.Rectangle,this.baseWidth=this.texture.baseTexture.width,this.baseHeight=this.texture.baseTexture.height},Bp.prototype.startFrameScaling=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(["l","tl","t","tr","r","br","b","bl"].includes(e)){this.frameScalingCentered&&!t&&this.stopFrameScaling(),this.frameScaling=!0,this.frameScalingCentered=t,this.frameAnchorSide=e;var i=this._frameWidth,r=this._frameHeight,a=Math.max(i/this.baseWidth,r/this.baseHeight),n=a*this._textureScaleX,o=a*this._textureScaleY,s=this.baseWidth*n,l=this.baseHeight*o,h=l-r,c=(s-i)*this._offsetFactorX,u=h*this._offsetFactorY;switch(this.initialRealDimensions=new PIXI.Point(s,l),this.initialFrameCenter=new PIXI.Point((c+i/2)/this.initialRealDimensions.x*this.baseWidth,(u+r/2)/this.initialRealDimensions.y*this.baseHeight),this.frameAnchorSide){case"l":this.frameAnchorPoint.x=c,this.frameAnchorPoint.y=u+r/2;break;case"tl":this.frameAnchorPoint.x=c,this.frameAnchorPoint.y=u;break;case"t":this.frameAnchorPoint.x=c+i/2,this.frameAnchorPoint.y=u;break;case"tr":this.frameAnchorPoint.x=c+i,this.frameAnchorPoint.y=u;break;case"r":this.frameAnchorPoint.x=c+i,this.frameAnchorPoint.y=u+r/2;break;case"br":this.frameAnchorPoint.x=c+i,this.frameAnchorPoint.y=u+r;break;case"b":this.frameAnchorPoint.x=c+i/2,this.frameAnchorPoint.y=u+r;break;case"bl":this.frameAnchorPoint.x=c,this.frameAnchorPoint.y=u+r}}else this.stopFrameScaling()},Bp.prototype.stopFrameScaling=function(){this.frameAnchorSide=null,this.frameScaling&&(this.frameScaling=!1),this.frameScalingCentered&&(this.frameScalingCentered=!1)},Bp.prototype.startFrameStretching=function(){this.frameStretching&&this.stopFrameStretching(),this.frameStretching=!0},Bp.prototype.stopFrameStretching=function(){this.frameStretching=!1},Bp.prototype.modifyFrameBorders=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=Math.max(0,this.textureFrame.x-e),r=Math.max(0,this.textureFrame.y-e),a=Math.max(i+1,Math.min(this.baseWidth,this.textureFrame.x+this.textureFrame.width+e)),n=Math.max(i+1,Math.min(this.baseHeight,this.textureFrame.y+this.textureFrame.height+e)),o=Math.max(1,a-i),s=Math.max(1,n-r),l=Math.max(o/this.baseWidth,s/this.baseHeight),h=this.baseWidth*l,c=this.baseHeight*l;this.textureScaleX=this.baseWidth/h,this.textureScaleY=this.baseHeight/c,this.offsetFactorX=this.baseWidth==o?.5:i/(this.baseWidth-o),this.offsetFactorY=this.baseHeight==s?.5:r/(this.baseHeight-s),t&&this.updateDisplay()},Bp.prototype.conformOffsetFactors=function(){if(this.texture.valid)try{var e=PIXI.GroupD8.isVertical(this.texture.rotate),t=e?this._frameHeight:this._frameWidth,i=e?this._frameWidth:this._frameHeight,r=Math.min(this.baseWidth/t,this.baseHeight/i),a=r/this._textureScaleX,n=r/this._textureScaleY,o=t*a,s=i*n,l=this.textureFrame.x+this.textureFrame.width/2,h=this.textureFrame.y+this.textureFrame.height/2,c=l-o/2,u=h-s/2,d=Math.max(0,this.baseWidth-o),m=Math.max(0,this.baseHeight-s);this.offsetFactorX=d?c/d:this._offsetFactorX,this.offsetFactorY=m?u/m:this._offsetFactorY}catch(e){}},Bp.prototype.updateDisplay=function(){if(this.texture.valid)try{this.frameStretching&&!this.frameWasStretching&&(this.frameWasStretching=!0);var e=PIXI.GroupD8.isVertical(this.texture.rotate),t=e?this._frameHeight:this._frameWidth,i=e?this._frameWidth:this._frameHeight;if(this.frameScaling){var r=this.initialRealDimensions.y/this.initialRealDimensions.x,a=t/this.initialRealDimensions.x,n=i/this.initialRealDimensions.y;this.textureFrame.width=Math.min(this.baseWidth,this.baseWidth*a),this.textureFrame.height=Math.min(this.baseHeight,this.baseHeight*n);var o=this.baseWidth/this.textureFrame.width*t,s=this.baseHeight/this.textureFrame.height*i,l=s/r,h=o*r;l>o&&(this.textureFrame.width=this.textureFrame.width*(o/l)),h>s&&(this.textureFrame.height=this.textureFrame.height*(s/h));var c=this.baseWidth/this.textureFrame.width*this.frameWidth,u=this.baseHeight/this.textureFrame.height*this.frameHeight;this.excessX=Math.max(0,this.baseWidth-this.textureFrame.width),this.excessY=Math.max(0,this.baseHeight-this.textureFrame.height);var d=this.frameAnchorPoint.x/this.initialRealDimensions.x*this.baseWidth,m=this.frameAnchorPoint.y/this.initialRealDimensions.y*this.baseHeight,p=new PIXI.Point(this.baseWidth/2-this.textureFrame.width/2,this.baseHeight/2-this.textureFrame.height/2);if(this.frameScalingCentered)p.x=this.initialFrameCenter.x-this.textureFrame.width/2,p.y=this.initialFrameCenter.y-this.textureFrame.height/2;else switch(this.frameAnchorSide){case"l":p.x=d,p.y=m-this.textureFrame.height/2;break;case"tl":p.x=d,p.y=m;break;case"t":p.x=d-this.textureFrame.width/2,p.y=m;break;case"tr":p.x=d-this.textureFrame.width,p.y=m;break;case"r":p.x=d-this.textureFrame.width,p.y=m-this.textureFrame.height/2;break;case"br":p.x=d-this.textureFrame.width,p.y=m-this.textureFrame.height;break;case"b":p.x=d-this.textureFrame.width/2,p.y=m-this.textureFrame.height;break;case"bl":p.x=d,p.y=m-this.textureFrame.height}this.textureFrame.x=Math.max(0,Math.min(this.baseWidth-this.textureFrame.width,p.x)),this.textureFrame.y=Math.max(0,Math.min(this.baseHeight-this.textureFrame.height,p.y)),this._offsetFactorX=this.excessX>.01?this.textureFrame.x/this.excessX:.5,this._offsetFactorY=this.excessY>.01?this.textureFrame.y/this.excessY:.5;var g=Math.max(t/this.baseWidth,i/this.baseHeight),f=this.baseWidth*g,v=this.baseHeight*g;this._textureScaleX=c/f,this._textureScaleY=u/v}else if(!this.frameStretching){var y=Math.min(this.baseWidth/t,this.baseHeight/i);this.frameWasStretching&&(this.frameWasStretching=!1,this._textureScaleX=y/(this.textureFrame.width/t),this._textureScaleY=y/(this.textureFrame.height/i));var x=y/this._textureScaleX,_=y/this._textureScaleY;this.textureFrame.width=Math.max(0,Math.min(this.baseWidth,Math.round(t*x))),this.textureFrame.height=Math.max(0,Math.min(this.baseHeight,Math.round(i*_))),this.excessX=Math.max(0,this.baseWidth-this.textureFrame.width),this.excessY=Math.max(0,this.baseHeight-this.textureFrame.height),this.textureFrame.x=this._offsetFactorX*this.excessX,this.textureFrame.y=this._offsetFactorY*this.excessY}this.texture.frame=this.textureFrame,this.adjustScale=1/Math.min(this.baseWidth/t,this.baseHeight/i),this.texture.orig=this.texture.trim=new PIXI.Rectangle(0,0,this._frameWidth,this._frameHeight),this.visible=this._frameWidth>1||this._frameHeight>1,this._imageRect.width=this.width/this.textureFrame.width*this.baseWidth,this._imageRect.height=this.height/this.textureFrame.height*this.baseHeight,this._imageRect.x=-(this._imageRect.width-this.width)*this._offsetFactorX,this._imageRect.y=-(this._imageRect.height-this.height)*this._offsetFactorY,this.updateDisplayCallback&&this.updateDisplayCallback(),BFN.MainUI.requestRender()}catch(e){}},Bp.prototype.flipH=function(){switch(this.texture.rotate){case 0:this.texture.rotate=12;break;case 2:this.texture.rotate=14;break;case 4:this.texture.rotate=8;break;case 6:this.texture.rotate=10;break;case 8:this.texture.rotate=4;break;case 10:this.texture.rotate=6;break;case 12:this.texture.rotate=0;break;case 14:this.texture.rotate=2}this.updateDisplay()},Bp.prototype.flipV=function(){switch(this.texture.rotate){case 0:this.texture.rotate=8;break;case 2:this.texture.rotate=10;break;case 4:this.texture.rotate=12;break;case 6:this.texture.rotate=14;break;case 8:this.texture.rotate=0;break;case 10:this.texture.rotate=2;break;case 12:this.texture.rotate=4;break;case 14:this.texture.rotate=6}this.updateDisplay()},Bp.prototype.rotateL=function(){switch(this.texture.rotate){case 0:this.texture.rotate=2;break;case 2:this.texture.rotate=4;break;case 4:this.texture.rotate=6;break;case 6:this.texture.rotate=0;break;case 8:this.texture.rotate=14;break;case 10:this.texture.rotate=8;break;case 12:this.texture.rotate=10;break;case 14:this.texture.rotate=12}this.conformOffsetFactors(),this.updateDisplay()},Bp.prototype.rotateR=function(){switch(this.texture.rotate){case 0:this.texture.rotate=6;break;case 2:this.texture.rotate=0;break;case 4:this.texture.rotate=2;break;case 6:this.texture.rotate=4;break;case 8:this.texture.rotate=10;break;case 10:this.texture.rotate=12;break;case 12:this.texture.rotate=14;break;case 14:this.texture.rotate=8}this.conformOffsetFactors(),this.updateDisplay()},Bp.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{this.texture.destroyGC(e)}catch(e){}this.texture=PIXI.Texture.EMPTY},Object.defineProperty(Bp.prototype,"frameWidth",{set:function(e){this._frameWidth=Math.max(1,e)},get:function(){return this._frameWidth}}),Object.defineProperty(Bp.prototype,"frameHeight",{set:function(e){this._frameHeight=Math.max(1,e)},get:function(){return this._frameHeight}}),Object.defineProperty(Bp.prototype,"offsetFactorX",{set:function(e){this._offsetFactorX=Math.max(0,Math.min(1,e))},get:function(){return this._offsetFactorX}}),Object.defineProperty(Bp.prototype,"offsetFactorY",{set:function(e){this._offsetFactorY=Math.max(0,Math.min(1,e))},get:function(){return this._offsetFactorY}}),Object.defineProperty(Bp.prototype,"rotate",{set:function(e){-1!=this.rotateValues.indexOf(e)&&(this.texture.rotate=e,this.conformOffsetFactors())},get:function(){return this.texture.rotate}}),Object.defineProperty(Bp.prototype,"textureScale",{set:function(e){this._textureScale=Math.max(0,e),this._textureScaleX=this._textureScale,this._textureScaleY=this._textureScale,this.conformOffsetFactors()},get:function(){return this._textureScale}}),Object.defineProperty(Bp.prototype,"textureScaleX",{set:function(e){this._textureScaleX=Math.max(0,e),this.conformOffsetFactors()},get:function(){return this._textureScaleX}}),Object.defineProperty(Bp.prototype,"textureScaleY",{set:function(e){this._textureScaleY=Math.max(0,e),this.conformOffsetFactors()},get:function(){return this._textureScaleY}}),Object.defineProperty(Bp.prototype,"isEmpty",{get:function(){return this._isEmpty}}),Object.defineProperty(Bp.prototype,"imageRect",{get:function(){return this._imageRect}}),BFN.FrameSprite=Bp,Fp.prototype=Object.create(PIXI.Container.prototype),Fp.prototype.init=function(){BeFunky.log("PremiumWatermark Init"),this.initDefaultValues(),this.initEmblem(),this.initGraphicLoader()},Fp.prototype.initDefaultValues=function(){this.interactive=!1,this.visible=!1,this._showing=!1,this.frameWidth=0,this.frameHeight=0,this.currentToolID=null,this._canvasScale=1,this._canvasScaling=!1,BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged.bind(this))},Fp.prototype.initEmblem=function(){this.emblem=new PIXI.Sprite,this.emblem.interactive=!0,this.emblem.buttonMode=!0,this.emblem.anchor.y=1,this.emblem.pluginName="blend_picture",this.emblem.currentScale=1,this.emblem.on("click",function(){BFN.PhotoEditorCanvasTools.applyCurrentTool("WATERMARK","")})},Fp.prototype.initGraphicLoader=function(){this.graphicLoader=new BFN.GraphicLoader,this.graphicLoader.graphicsData.emblem=BFN.imagesURL+"app/premium_emblem.png",this.graphicLoader.addEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleGraphicsLoaded.bind(this)),setTimeout(function(){this.graphicLoader.loadGraphics()}.bind(this),1e3)},Fp.prototype.setDimensions=function(e,t){this.frameWidth=Math.abs(e),this.frameHeight=Math.abs(t),this.updateDimensions()},Fp.prototype.updateDimensions=function(){this.graphicLoader.graphicsLoaded&&(this.emblem.scale.x=this.emblem.scale.y=Math.min(this.frameWidth/3/this.emblem.texture.width,this.frameHeight/3/this.emblem.texture.height),this.emblem.x=Math.round(-this.frameWidth/2+10*this.emblem.scale.x),this.emblem.y=Math.round(this.frameHeight/2-10*this.emblem.scale.y),this.updateSmoothing()),BFN.MainUI.requestRender()},Fp.prototype.updateSmoothing=function(){this.emblem.currentScale=this._canvasScaling?1:this.emblem.scale.x*this._canvasScale,BFN.MainUI.requestRender()},Fp.prototype.updateDisplay=function(){this._showing=this.currentToolID&&UITools.toolPlusHash[this.currentToolID]&&!BFN.BfnService.userIsPlus,this.visible=this._showing,BFN.MainUI.requestRender()},Fp.prototype.handleUserDataChanged=function(e){this.updateDisplay()},Fp.prototype.handleGraphicsLoaded=function(e){this.emblem.texture=this.graphicLoader.graphics.emblem,this.addChild(this.emblem),this.updateDimensions()},Object.defineProperty(Fp.prototype,"showing",{get:function(){return this._showing}}),Object.defineProperty(Fp.prototype,"canvasScaling",{set:function(e){this._canvasScaling=e,this.updateSmoothing()},get:function(){return this._canvasScaling}}),Object.defineProperty(Fp.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.updateSmoothing()},get:function(){return this._canvasScale}}),BFN.SingletonQueue.add(function(){BFN.PremiumWatermark=new Fp}),Ep.prototype=Object.create(PIXI.Container.prototype),Ep.prototype.init=function(){BeFunky.log("TileContainer Init"),this.initDefaultValues(),this.initTileContainer(),this.initTileContainerMask(),this.initTilePool()},Ep.prototype.initDefaultValues=function(){this.tiles=[],this.tilesX=0,this.tilesY=0,this.tilesNum=0,this.tilesTotalW=0,this.tilesTotalH=0,this.globalOffsetPoint=new PIXI.Point,this.localOffsetPoint=new PIXI.Point,this._smoothScale=1},Ep.prototype.initTileContainer=function(){this.tileContainer=new PIXI.Container,this.addChild(this.tileContainer)},Ep.prototype.initTileContainerMask=function(){this.tileContainerMask=new PIXI.Graphics,this.tileContainerMask.beginFill(16777215),this.tileContainerMask.drawRect(0,0,100,100),this.tileContainerMask.endFill(),this.addChild(this.tileContainerMask),this.tileContainer.mask=this.tileContainerMask},Ep.prototype.initTilePool=function(){this.tilePool=new BFN.SpritePool,this.tilePool.grow(100)},Ep.prototype.offset=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.globalOffsetPoint.x=e,this.globalOffsetPoint.y=t,this.updateSpritePlacement()},Ep.prototype.rotate=function(e){this.tileContainer.rotation=e;var t=Math.sqrt(Math.pow(this.localOffsetPoint.x,2)+Math.pow(this.localOffsetPoint.y,2)),i=Math.atan2(this.localOffsetPoint.y,this.localOffsetPoint.x)+this.tileContainer.rotation;this.globalOffsetPoint.x=Math.cos(i)*t,this.globalOffsetPoint.y=Math.sin(i)*t,BFN.MainUI.requestRender()},Ep.prototype.updateDisplay=function(){if(this.tileContainer.children.length&&this.tileContainer.removeChildren(0,this.tileContainer.children.length),this.tiles.splice(0),this.tilesX=0,this.tilesY=0,this.tilesNum=0,this.tilesTotalW=0,this.tilesTotalH=0,this._texture){this.tilesX=Math.ceil(this.containerDiagonal/this._texture.width)+1,this.tilesY=Math.ceil(this.containerDiagonal/this._texture.height)+1,this.tilesX+=this.tilesX%2?0:1,this.tilesY+=this.tilesY%2?0:1,this.tilesTotalW=this.tilesX*this._texture.width,this.tilesTotalH=this.tilesY*this._texture.height,this.tilesNum=this.tilesX*this.tilesY,this.tilePool.growTo(this.tilesNum);for(var e=0;e<this.tilesNum;e++){var t=this.tilePool.getSprite(e,null,this._texture);this.tiles.push(t),this.tileContainer.addChild(t)}this.updateSpritePlacement(),this.updateSpriteSmoothing()}BFN.MainUI.requestRender()},Ep.prototype.updateSpritePlacement=function(){if(this._texture){var e=Math.sqrt(Math.pow(this.globalOffsetPoint.x,2)+Math.pow(this.globalOffsetPoint.y,2)),t=Math.atan2(this.globalOffsetPoint.y,this.globalOffsetPoint.x)-this.tileContainer.rotation;this.localOffsetPoint.x=Math.cos(t)*e%this._texture.width,this.localOffsetPoint.y=Math.sin(t)*e%this._texture.height;var i=Math.sqrt(Math.pow(this.localOffsetPoint.x,2)+Math.pow(this.localOffsetPoint.y,2)),r=Math.atan2(this.localOffsetPoint.y,this.localOffsetPoint.x)+this.tileContainer.rotation;this.globalOffsetPoint.x=Math.cos(r)*i,this.globalOffsetPoint.y=Math.sin(r)*i;for(var a=0;a<this.tilesNum;a++){var n=a%this.tilesX*this._texture.width-this.tilesTotalW/2+this._texture.width/2,o=Math.floor(a/this.tilesY)*this._texture.height-this.tilesTotalH/2+this._texture.height/2;for(n+=this.localOffsetPoint.x,o+=this.localOffsetPoint.y;n<-this.tilesTotalW/2;)n+=this.tilesTotalW;for(;n>this.tilesTotalW/2;)n-=this.tilesTotalW;for(;o<-this.tilesTotalH/2;)o+=this.tilesTotalH;for(;o>this.tilesTotalH/2;)o-=this.tilesTotalH;var s=this.tiles[a];s.x=n,s.y=o}BFN.MainUI.requestRender()}},Ep.prototype.updateSpriteSmoothing=function(){for(var e=0;e<this.tiles.length;e++){var t=this.tiles[e];this._smoothScale<=1?("smooth_picture"!=t.pluginName&&(t.pluginName="smooth_picture",t.expandVertex=0),t.currentScale=this._smoothScale):"sprite"!=t.pluginName&&(t.pluginName="sprite",t.currentScale=1)}},Object.defineProperty(Ep.prototype,"texture",{set:function(e){this._texture=e},get:function(){return this._texture}}),Object.defineProperty(Ep.prototype,"width",{set:function(e){this._width=e,this.containerDiagonal=Math.floor(Math.sqrt(Math.pow(this._width,2)+Math.pow(this._height,2))),this.tileContainer.x=this._width/2,this.tileContainerMask.width=this._width},get:function(){return this._width}}),Object.defineProperty(Ep.prototype,"height",{set:function(e){this._height=e,this.containerDiagonal=Math.floor(Math.sqrt(Math.pow(this._width,2)+Math.pow(this._height,2))),this.tileContainer.y=this._height/2,this.tileContainerMask.height=this._height},get:function(){return this._height}}),Object.defineProperty(Ep.prototype,"smoothScale",{set:function(e){this._smoothScale=e,this.updateSpriteSmoothing()},get:function(){return this._smoothScale}}),BFN.TileContainer=Ep,Pp.prototype=Object.create(PIXI.Container.prototype),Pp.prototype.init=function(){BeFunky.log("GraphicsPixelGrid Init"),this.initDefaultValues()},Pp.prototype.initDefaultValues=function(){this.pixelHash={},this._itemWidth=0,this._itemHeight=0},Pp.prototype.clear=function(){for(var e in this.pixelHash){var t=this.pixelHash[e];for(var i in t)this.destroyPixel(i,e),delete t[i];delete this.pixelHash[e]}this.pixelHash={},this._itemWidth=0,this._itemHeight=0},Pp.prototype.generate=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.clear();for(var a=0;a<t;a++){var n={};this.pixelHash[a]=n;for(var o=0;o<e;o++)n[o]=this.createPixelGraphic(o,a,i,r)}this._itemWidth=e,this._itemHeight=t},Pp.prototype.getPixel=function(e,t){return this.pixelHash.hasOwnProperty(t)&&this.pixelHash[t].hasOwnProperty(e)?this.pixelHash[t][e]:null},Pp.prototype.destroyPixel=function(e,t){var i=this.getPixel(e,t);i&&(i.clear(),this.removeChild(i),this.pixelHash[t][e]=null)},Pp.prototype.setPixelColor=function(e,t,i){var r=this.getPixel(e,t);if(r){var a=r.alpha;this.destroyPixel(e,t),r=this.createPixelGraphic(e,t,i,a),this.pixelHash[t][e]=r}},Pp.prototype.setPixelAlpha=function(e,t,i){var r=this.getPixel(e,t);r&&(r.alpha=i)},Pp.prototype.createPixelGraphic=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new PIXI.Graphics;return a.beginFill(i,r),a.drawRect(0,0,1,1),a.endFill(),a.x=e,a.y=t,this.addChild(a),a},Object.defineProperty(Pp.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(Pp.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.GraphicsPixelGrid=Pp,Np.prototype=Object.create(PIXI.particles.ParticleContainer.prototype),Np.prototype.init=function(){BeFunky.log("SpritePixelGrid Init"),this.initDefaultValues()},Np.prototype.initDefaultValues=function(){this.pixelTexture=PIXI.RenderTexture.create(2,2),this.pixelTexture.setScaleMode(PIXI.SCALE_MODES.NEAREST),this.spritePool=new BFN.SpritePool,this.spritePool.spriteAnchor.x=this.spritePool.spriteAnchor.y=0,this._itemWidth=0,this._itemHeight=0},Np.prototype.clear=function(){for(var e in this.removeChildren(),this.pixelHash){var t=this.pixelHash[e];for(var i in t)delete t[i];delete this.pixelHash[e]}this.pixelHash={},this._itemWidth=0,this._itemHeight=0},Np.prototype.generate=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.clear(),this.pixelTexture.fillRect(0,0,1,1,i),this.spritePool.growTo(e*t);for(var a=0;a<t;a++){var n={};this.pixelHash[a]=n;for(var o=0;o<e;o++){var s=this.spritePool.getSprite(a*e+o,{x:o,y:a},this.pixelTexture);s.alpha=r,this.addChild(s),n[o]=s}}this._itemWidth=e,this._itemHeight=t},Np.prototype.getPixel=function(e,t){return this.pixelHash.hasOwnProperty(t)&&this.pixelHash[t].hasOwnProperty(e)?this.pixelHash[t][e]:null},Np.prototype.destroyPixel=function(e,t){var i=this.getPixel(e,t);i&&(this.removeChild(i),this.pixelHash[t][e]=null)},Np.prototype.setPixelAlpha=function(e,t,i){var r=this.getPixel(e,t);r&&(r.alpha=i)},Np.prototype.setEveryPixelAlpha=function(e){for(var t in this.pixelHash){var i=this.pixelHash[t];for(var r in i){var a=i[r];a&&(a.alpha=e)}}},Object.defineProperty(Np.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(Np.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.SpritePixelGrid=Np,Mp.prototype=Object.create(PIXI.particles.ParticleContainer.prototype),Mp.prototype.init=function(){BeFunky.log("PixelGrid Init"),this.initDefaultValues(),this.initGuides()},Mp.prototype.initDefaultValues=function(){this._frameWidth=0,this._frameHeight=0,this.active=!0},Mp.prototype.initGuides=function(){this.guideTexture=PIXI.RenderTexture.create(10,3),this.guideTexture.fillRect(0,1,10,1,16777215,.5),this.guideTexture.setScaleMode(PIXI.SCALE_MODES.NEAREST);var e=(e,t,i)=>{var r=new PIXI.Sprite(this.guideTexture);return r.anchor.x=r.anchor.y=.5,r.x=e,r.y=t,r.rotation=i,this.addChild(r),r};this.hGuides=[];for(var t=-Math.floor(this.hGuidesNum/2);t<Math.floor(this.hGuidesNum/2);t++)this.hGuides.push(e(0,1*t,0));this.vGuides=[];for(var i=-Math.floor(this.vGuidesNum/2);i<Math.floor(this.vGuidesNum/2);i++)this.vGuides.push(e(1*i,0,Math.PI/2))},Mp.prototype.setFrameDimensions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._frameWidth=e,this._frameHeight=t,this.updateDisplay()},Mp.prototype.updateDisplay=function(){this.active?(this._scale<5.5&&this.visible?this.visible=!1:this._scale<6?(this.alpha=(this._scale-5.5)/.5,this.visible||(this.visible=!0)):(this.alpha<1||!this.visible)&&(this.alpha=1,this.visible=!0),this.visible&&(this.hGuides.forEach(e=>{e.scale.x=this._frameWidth/this._scale,e.scale.y=1/this._scale}),this.vGuides.forEach(e=>{e.scale.x=this._frameHeight/this._scale,e.scale.y=1/this._scale}),BFN.MainUI&&BFN.MainUI.requestRender())):this.visible&&(this.visible=!1)},Object.defineProperty(Mp.prototype,"frameWidth",{set:function(e){this._frameWidth=e,this.updateDisplay()},get:function(){return this._frameWidth}}),Object.defineProperty(Mp.prototype,"frameHeight",{set:function(e){this._frameHeight=e,this.updateDisplay()},get:function(){return this._frameHeight}}),Object.defineProperty(Mp.prototype,"canvasScale",{set:function(e){this._scale=e,this.updateDisplay()},get:function(){return this._canvasScale}}),BFN.PixelGrid=Mp,Dp.prototype=Object.create(PIXI.Graphics.prototype),Dp.prototype.init=function(){BeFunky.log("AutoCollageGeneratorClusterItem Init"),this.initDefaultValues()},Dp.prototype.initDefaultValues=function(){this._menuImageVO=null,this._itemWidth=0,this._itemHeight=0},Dp.prototype.destroy=function(){this._menuImageVO=null,this.clear()},Object.defineProperty(Dp.prototype,"menuImageVO",{set:function(e){this._menuImageVO=e,this.clear(),this._menuImageVO.imageTexture&&this._menuImageVO.imageTexture.valid&&this._menuImageVO.imageTexture.baseTexture&&(this._itemWidth=this._menuImageVO.imageTexture.baseTexture.width,this._itemHeight=this._menuImageVO.imageTexture.baseTexture.height,this.beginFill(16777215),this.drawRect(0,0,this._itemWidth,this._itemHeight),this.endFill())},get:function(){return this._menuImageVO}}),Object.defineProperty(Dp.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(Dp.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.AutoCollageGeneratorClusterItem=Dp,wp.prototype=Object.create(PIXI.Container.prototype),wp.prototype.init=function(){BeFunky.log("AutoCollageGeneratorCluster Init"),this.initDefaultValues()},wp.prototype.initDefaultValues=function(){this._itemsNum=0,this._itemWidth=0,this._itemHeight=0,this.clusters=null,this.item=null,this.cluster=null,this.clusterA=null,this.clusterB=null,this.clusterC=null,this.hWidth=0,this.hHeight=0,this.hRatio=0,this.vWidth=0,this.vHeight=0,this.vRatio=0,this.hsRect=new BFN.Rectangle,this.hsWidth=0,this.hsHeight=0,this.hsRatio=0,this.vsRect=new BFN.Rectangle,this.vsWidth=0,this.vsHeight=0,this.vsRatio=0},wp.prototype.addItem=function(e){this.item&&(this.removeChild(this.item),this.item.destroy(),this.item=null,this._itemWidth=0,this._itemHeight=0),e&&e.menuImageVO&&!this.clusters&&(this.item=e,this.item.x=this.item.y=0,this.item.scale.x=this.item.scale.y=1,this.addChild(this.item),this._itemWidth=this.item.width,this._itemHeight=this.item.height)},wp.prototype.addCluster=function(e){this.item||(this.clusters||(this.clusters=[]),this.clusters.length<3&&(this.clusters.push(e),this._itemsNum=this.clusters.length,this.addChild(e),this.arrangeClusters()))},wp.prototype.clear=function(){if(this.item&&(this.removeChild(this.item),this.item.destroy(),this.item=null),this.clusters){for(var e=0;e<this.clusters.length;e++)this.cluster=this.clusters[e],this.removeChild(this.cluster),this.cluster.clear(),this.cluster=null;this.clusters.splice(0),this.clusters=null}this._itemWidth=0,this._itemHeight=null},wp.prototype.arrangeClusters=function(){for(var e=0;e<this.clusters.length;e++)this.cluster=this.clusters[e],this.cluster.x=this.cluster.y=0,this.cluster.scale.x=this.cluster.scale.y=1;if(1==this.clusters.length)this.cluster=this.clusters[0],this._itemWidth=this.cluster.width,this._itemHeight=this.cluster.height;else if(2==this.clusters.length)this.clusterA=this.clusters[0],this.clusterB=this.clusters[1],this.hWidth=this.getCombinedWidth(this.clusterA.rect,this.clusterB.rect),this.hHeight=this.clusterA.height,this.hRatio=this.getLongRatio(this.hWidth,this.hHeight),this.vWidth=this.clusterA.width,this.vHeight=this.getCombinedHeight(this.clusterA.rect,this.clusterB.rect),this.vRatio=this.getLongRatio(this.vWidth,this.vHeight),this.hRatio<this.vRatio?(this.clusterB.x=this.clusterA.width,this.clusterB.width=this.hWidth-this.clusterA.width,this.clusterB.height=this.clusterA.height,this._itemWidth=this.hWidth,this._itemHeight=this.hHeight):(this.clusterB.y=this.clusterA.height,this.clusterB.width=this.clusterA.width,this.clusterB.height=this.vHeight-this.clusterA.height,this._itemWidth=this.vWidth,this._itemHeight=this.vHeight);else if(3==this.clusters.length){for(var t=Number.MAX_VALUE,i=Math.random()<.5,r=0;r<this.clusters.length;r++){this.clusterA=this.clusters[r];for(var a=0;a<this.clusters.length;a++)if(this.clusters[r]!=this.clusters[a]){this.clusterB=this.clusters[a];for(var n=0;n<this.clusters.length;n++)if(this.clusters[r]!=this.clusters[n]&&this.clusters[a]!=this.clusters[n]){this.clusterC=this.clusters[n],this.hWidth=this.getCombinedWidth(this.clusterA.rect,this.clusterB.rect)+(this.getCombinedWidth(this.clusterA.rect,this.clusterC.rect)-this.clusterA.width),this.hHeight=this.clusterA.height,this.hRatio=this.getLongRatio(this.hWidth,this.hHeight),this.vWidth=this.clusterA.width,this.vHeight=this.getCombinedHeight(this.clusterA.rect,this.clusterB.rect)+(this.getCombinedHeight(this.clusterA.rect,this.clusterC.rect)-this.clusterA.height),this.vRatio=this.getLongRatio(this.vWidth,this.vHeight),this.hsRect.width=this.clusterB.itemWidth,this.hsRect.height=this.getCombinedHeight(this.clusterB.rect,this.clusterC.rect),this.hsWidth=this.getCombinedWidth(this.clusterA.rect,this.hsRect),this.hsHeight=this.clusterA.height,this.hsRatio=this.getLongRatio(this.hsWidth,this.hsHeight),this.vsRect.width=this.getCombinedWidth(this.clusterB.rect,this.clusterC.rect),this.vsRect.height=this.clusterB.itemHeight,this.vsWidth=this.clusterA.width,this.vsHeight=this.getCombinedHeight(this.clusterA.rect,this.vsRect),this.vsRatio=this.getLongRatio(this.vsWidth,this.vsHeight);var o=i?Math.min(this.hRatio,this.vRatio):Math.min(this.hRatio,this.vRatio,this.hsRatio,this.vsRatio);if(o<t){t=o;var s=this.getClusterObject(),l=this.getClusterObject(),h=this.getClusterObject();switch(o){case this.hRatio:this._itemWidth=this.hWidth,this._itemHeight=this.hHeight,s.cluster=this.clusterA,s.width=this.clusterA.width,s.height=this.clusterA.height,l.cluster=this.clusterB,l.x=s.width,l.width=this.hWidth-this.getCombinedWidth(this.clusterA.rect,this.clusterC.rect),l.height=s.height,h.cluster=this.clusterC,h.x=l.x+l.width,h.width=this.hWidth-h.x,h.height=s.height;break;case this.vRatio:this._itemWidth=this.vWidth,this._itemHeight=this.vHeight,s.cluster=this.clusterA,s.width=this.clusterA.width,s.height=this.clusterA.height,l.cluster=this.clusterB,l.y=s.height,l.width=s.width,l.height=this.vHeight-this.getCombinedHeight(this.clusterA.rect,this.clusterC.rect),h.cluster=this.clusterC,h.y=l.y+l.height,h.width=s.width,h.height=this.vHeight-h.y;break;case this.hsRatio:this._itemWidth=this.hsWidth,this._itemHeight=this.hsHeight,s.cluster=this.clusterA,s.width=this.clusterA.width,s.height=this.clusterA.height,l.cluster=this.clusterB,l.x=s.width,l.width=this.hsWidth-s.width,l.height=Math.round(l.width/this.clusterB.width*this.clusterB.height),h.cluster=this.clusterC,h.x=s.width,h.y=l.height,h.width=this.hsWidth-s.width,h.height=this.hsHeight-l.height,Math.random()<.5&&(s.x=l.width,l.x=h.x=0);break;case this.vsRatio:this._itemWidth=this.vsWidth,this._itemHeight=this.vsHeight,s.cluster=this.clusterA,s.width=this.clusterA.width,s.height=this.clusterA.height,l.cluster=this.clusterB,l.y=s.height,l.height=this.vsHeight-s.height,l.width=Math.round(l.height/this.clusterB.height*this.clusterB.width),h.cluster=this.clusterC,h.x=l.width,h.y=s.height,h.width=this.vsWidth-l.width,h.height=this.vsHeight-s.height,Math.random()<.5&&(s.y=l.height,l.y=h.y=0)}}}}}try{s.cluster.x=s.x,s.cluster.y=s.y,s.cluster.width=s.width,s.cluster.height=s.height,l.cluster.x=l.x,l.cluster.y=l.y,l.cluster.width=l.width,l.cluster.height=l.height,h.cluster.x=h.x,h.cluster.y=h.y,h.cluster.width=h.width,h.cluster.height=h.height}catch(e){}}},wp.prototype.getCombinedWidth=function(e,t){return Math.floor(e.width+Math.round(t.width*(e.height/t.height)))},wp.prototype.getCombinedHeight=function(e,t){return Math.floor(e.height+Math.round(t.height*(e.width/t.width)))},wp.prototype.getLongRatio=function(e,t){return(e=Math.floor(e))>(t=Math.floor(t))?e/t:t/e},wp.prototype.getClusterObject=function(){return{cluster:null,x:0,y:0,width:0,height:0}},Object.defineProperty(wp.prototype,"rect",{get:function(){return new BFN.Rectangle(0,0,this._itemWidth,this._itemHeight)}}),Object.defineProperty(wp.prototype,"itemsNum",{get:function(){return this._itemsNum}}),Object.defineProperty(wp.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(wp.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.AutoCollageGeneratorCluster=wp,BFN.AutoCollageGeneratorEvents={SIZE_UPDATED:new Event("SIZE_UPDATED")},kp.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),kp.prototype.init=function(){BeFunky.log("AutoCollageGenerator Init"),this.initDefaultValues(),this.initClusterContainer()},kp.prototype.initDefaultValues=function(){this._itemWidth=0,this._itemHeight=0,this.rootCluster=null,this.clusterItems=[]},kp.prototype.initClusterContainer=function(){this.clusterContainer=new PIXI.Container,this.addChild(this.clusterContainer)},kp.prototype.generate=function(e){if(this.clear(),e&&e.length)for(var t=0;t<e.length;t++){var i=e[t],r=new BFN.AutoCollageGeneratorClusterItem;r.menuImageVO=i,r.menuImageVO&&this.clusterItems.push(r)}this.generateCollage();for(var a=[],n=0;n<this.clusterItems.length;n++){var o=this.clusterItems[n];if(o.menuImageVO){var s={},l=this.toLocal(o.toGlobal(new PIXI.Point(0,0))),h=this.toLocal(o.toGlobal(new PIXI.Point(o.itemWidth,o.itemHeight)));s.menuImageVO=o.menuImageVO,s.rect=new BFN.Rectangle(Math.round(l.x),Math.round(l.y),Math.round(h.x)-Math.round(l.x),Math.round(h.y)-Math.round(l.y)),a.push(s)}}return a},kp.prototype.clear=function(){this.clearDisplay(),this.clusterItems.splice(0)},kp.prototype.clearDisplay=function(){this.rootCluster&&(this.rootCluster.clear(),this.rootCluster=null,this.clusterContainer.removeChildren())},kp.prototype.generateCollage=function(){this.clearDisplay();for(var e=[],t=0;t<this.clusterItems.length;t++)e.push(this.clusterItems[t]);for(var i=[];e.length;){var r=Math.floor(Math.random()*e.length);i.push(e[r]),e.splice(r,1)}for(var a=[];i.length;)this.cluster=new BFN.AutoCollageGeneratorCluster,this.cluster.addItem(i.pop()),a.push(this.cluster);for(i.splice(0);a.length>1;){for(var n=[],o=0;o<a.length;o++)n.push(a[o]);a.splice(0);for(var s=null;n.length;)s||(s=new BFN.AutoCollageGeneratorCluster,a.push(s)),s.itemsNum<2?s.addCluster(n.pop()):2==s.itemsNum&&(1==n.length&&s.addCluster(n.pop()),s=null)}this.rootCluster=a[0],this.clusterContainer.addChild(this.rootCluster),a.splice(0),this.clusterContainer.scale.x=this.clusterContainer.scale.y=Math.min(Math.max(1,2e3/this.rootCluster.itemWidth,2e3/this.rootCluster.itemHeight),4e3/this.rootCluster.itemWidth,4e3/this.rootCluster.itemHeight),this._itemWidth=this.clusterContainer.width=Math.floor(this.clusterContainer.width),this._itemHeight=this.clusterContainer.height=Math.floor(this.clusterContainer.height),this.dispatchEvent(BFN.AutoCollageGeneratorEvents.SIZE_UPDATED)},Object.defineProperty(kp.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(kp.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.AutoCollageGenerator=kp,Lp.prototype.init=function(){BeFunky.log("AutoCollage Init"),this.initDefaultValues(),this.initAutoCollageGenerator()},Lp.prototype.initDefaultValues=function(){this._collageMenuImageVOs=null,this.layoutObjects=[],this.layoutIndex=0,this.previewFitSize=1024},Lp.prototype.initAutoCollageGenerator=function(){this.autoCollageGenerator=new BFN.AutoCollageGenerator},Lp.prototype.reset=function(){if(this._collageMenuImageVOs){this._collageMenuImageVOs.splice(0),this._collageMenuImageVOs=null;for(var e=0;e<this.layoutObjects.length;e++)this.clearLayoutObject(this.layoutObjects[e]);this.layoutObjects.splice(0),this.layoutIndex=0,BFN.CollageWizardModal.togglePrevButton(!1),BFN.CollageWizardModal.toggleNextButton(!1),BFN.CollageWizardModal.updatePreviewImage(null)}},Lp.prototype.generateAutoCollage=function(e){if(this.reset(),e&&e.length){this._collageMenuImageVOs=[];for(var t=0;t<e.length;t++)this._collageMenuImageVOs.push(e[t]);this._collageMenuImageVOs.length&&BFN.BfnService.getTexturesForMenuImageVOs(this._collageMenuImageVOs,this.nextLayout.bind(this))}},Lp.prototype.nextLayout=function(){if(this._collageMenuImageVOs&&this._collageMenuImageVOs.length){var e=null;this.layoutObjects.length?this.layoutIndex<this.layoutObjects.length-1?e=this.layoutObjects[++this.layoutIndex]:(e=this.getNewLayout())&&(this.layoutObjects.push(e),this.layoutIndex=this.layoutObjects.length-1):(e=this.getNewLayout())&&(this.layoutObjects.push(e),this.layoutIndex=0),BFN.CollageWizardModal.togglePrevButton(this.layoutIndex>0),e&&this.createPreview(e)}},Lp.prototype.prevLayout=function(){if(this._collageMenuImageVOs&&this._collageMenuImageVOs.length&&this.layoutIndex>0){var e=this.layoutObjects[--this.layoutIndex];BFN.CollageWizardModal.togglePrevButton(this.layoutIndex>0),e&&this.createPreview(e)}},Lp.prototype.getNewLayout=function(){if(this._collageMenuImageVOs){var e={};return e.data=this.autoCollageGenerator.generate(this._collageMenuImageVOs),e.width=this.autoCollageGenerator.itemWidth,e.height=this.autoCollageGenerator.itemHeight,this.autoCollageGenerator.clear(),e}return null},Lp.prototype.createPreview=function(e){if(BFN.CollageWizardModal.toggleSelectCollageButton(e.data.length>0),e.imageSRC)this.setPreview(e.imageSRC);else{UIToggler.toggleLoadScreen(!0),BFN.CollageWizardModal.toggleNextButton(!1);var t=PIXI.RenderTexture.create(e.width,e.height);t.clear();var i=null,r=new PIXI.Sprite;r.pluginName="smooth_picture";for(var a=0;a<e.data.length;a++){var n=e.data[a],o=n.menuImageVO,s=n.rect;i=new PIXI.Texture(o.imageTexture.baseTexture),r.texture=i,r.scale.x=r.currentScale=s.width/i.width,r.scale.y=r.currentScaleY=s.height/i.height,r.x=s.x,r.y=s.y,BFN.Stage.render(r,t,!1),i.destroyGC(!1)}var l=Math.min(this.previewFitSize/t.width,this.previewFitSize/t.height),h=PIXI.RenderTexture.create(Math.floor(t.width*l),Math.floor(t.height*l));r.texture=t,r.scale.x=r.currentScale=h.width/t.width,r.scale.y=r.currentScaleY=h.height/t.height,r.x=0,r.y=0,BFN.Stage.render(r,h),t.destroyGC(!0),r.destroy(!0),BFN.Util.getHTMLImage(h,function(t){h.destroyGC(!0),e.imageSRC=t.src,BFN.AutoCollage.setPreview(e.imageSRC),BFN.CollageWizardModal.toggleNextButton(!0),UIToggler.toggleLoadScreen(!1)},!0)}},Lp.prototype.setPreview=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";BFN.CollageWizardModal.updatePreviewImage(e)},Lp.prototype.selectCurrentLayout=function(){this.layoutObjects.length&&this.layoutIndex<this.layoutObjects.length&&(BFN.CollageMakerCanvasPhotoGridModel.autoCollageLayoutObject=this.layoutObjects[this.layoutIndex])},Lp.prototype.clearLayoutObject=function(e){for(var t=0;t<e.data.length;t++){var i=e.data[t];i.menuImageVO=null,i.rect=null,i.imageSRC=null,delete i.menuImageVO,delete i.rect,delete i.imageSRC}e.data.splice(0),e.data=null,delete e.data,delete e.width,delete e.height},BFN.AutoCollage=new Lp,BFN.maxBrushSize=1024,Op.prototype=Object.create(PIXI.Sprite.prototype),Op.prototype.init=function(){BeFunky.log("ImagePainterBrush Init"),this.initDefaultValues()},Op.prototype.initDefaultValues=function(){this.radius=25,this.hardness=1,this.strength=1,this.opacity=1,this.inverse=!1,this.useRoughCircleBrush=!1,this.sourceSprite=new PIXI.Sprite,this.sourceSprite.texture=null,this.texture=null,this.sourceSprite.pluginName="filter_renderer",this.brushFilter=BFN.ShaderPool.BrushFilter,this.brushFilter.resolution=1,this.brushFilter.mode="paint"},Op.prototype.reset=function(){this.sourceSprite.texture&&(this.sourceSprite.texture.destroyGC(!0),this.sourceSprite.texture=null),this.texture&&(this.texture.destroyGC(!0),this.texture=null)},Op.prototype.updateBrush=function(){this.reset(),this.brushFilter.mode="paint",this.sourceSprite.texture=PIXI.RenderTexture.create(2*this.radius,2*this.radius,1),this.sourceSprite.texture.clear(),this.texture=PIXI.RenderTexture.create(2*this.radius,2*this.radius,1)},Op.prototype.updateFilter=function(){this.useRoughCircleBrush?(this.roughCircleBrushGraphic||(this.roughCircleBrushGraphic=new PIXI.Graphics),this.roughCircleBrushGraphic.clear(),this.roughCircleBrushGraphic.beginFill(8421504),this.roughCircleBrushGraphic.drawCircle(this.radius,this.radius,this.radius),this.roughCircleBrushGraphic.endFill(),this.sourceSprite.pluginName="sprite",this.sourceSprite.mask=this.roughCircleBrushGraphic):(this.brushFilter.radius=this.radius,this.brushFilter.hardness=this.hardness,this.brushFilter.strength=this.strength,this.brushFilter.opacity=this.opacity,this.brushFilter.inverse=this.inverse,this.sourceSprite.pluginName="filter_renderer",this.sourceSprite.mask=null,this.sourceSprite.bfn_shaders=[this.brushFilter]),this.updateTexture()},Op.prototype.updateTexture=function(){this.texture&&BFN.Stage.render(this.sourceSprite,this.texture)},Object.defineProperty(Op.prototype,"sourceTexture",{get:function(){return this.sourceSprite.texture}}),BFN.ImagePainterBrush=Op,BFN.ImagePainterEvents={BRUSH_RADIUS_UPDATED:new Event("BRUSH_RADIUS_UPDATED"),BRUSH_APPLIED:new Event("BRUSH_APPLIED"),PAINT_UPDATED:new Event("PAINT_UPDATED"),PAINT_UPDATED_PRE_HISTORY:new Event("PAINT_UPDATED_PRE_HISTORY"),PAINTING_STARTED:new Event("PAINTING_STARTED"),PAINTING_COMPLETE:new Event("PAINTING_COMPLETE"),PAINT_APPLIED_UPDATED:new Event("PAINT_APPLIED_UPDATED"),PAINTING_ENABLED_UPDATED:new Event("PAINTING_ENABLED_UPDATED")},Rp.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),Rp.prototype.init=function(){BeFunky.log("ImagePainter Init"),this.initDefaultValues(),this.initBrushPool(),this.initBrush()},Rp.prototype.initDefaultValues=function(){this.interactive=!0,this.brushHardnessAdjustFactor=1,this.textureClone=null,this.textureCloneSprite=new PIXI.Sprite,this.paintTexture=null,this.paintTextureSprite=new PIXI.Sprite,this.referenceContainer=new PIXI.Container,this.referenceContainer.addChild(this.textureCloneSprite),this.referenceContainer.addChild(this.paintTextureSprite),this.prevTexture=null,this.altTexture=null,this.regionTexture=null,this.regionSprite=new PIXI.Sprite,this.lowerResolutionForLargeImages=!0,this.enabled=!0,this._paintingEnabled=!0,this.dispatchEventsAfterUpdate=!0,this.eraseMode=!1,this.singleClick=!1,this.ignoreInitialPress=!1,this.ignoreMouseMove=!1,this._brushSizeFactor=.25,this.brushRadius=25,this.brushHardness=1,this.brushStrength=1,this.brushOpacity=1,this._brushColor=16777215,this.painterWidth=0,this.painterHeight=0,this._scale=1,this._adjustScale=1,this.isSetup=!1,this.setupPending=!1,this.delaySetupTillPaintingEnabled=!1,this.brushEnabled=!0,this.allowBrushCircle=!1,this.clicksEnabled=!0,this.scaleAffectsBrushRadius=!0,this.minBrushRadius=1,this.maxBrushRadius=BFN.maxBrushSize/2,this.brushStepDistance=10,this.brushX=0,this.brushX=0,this.brushPoint=new PIXI.Point,this.brushRect=new PIXI.Rectangle,this.brushBeta=0,this.backgroundColor=null,this.nearestScaleMode=!1,this._paintBounds={x:5,y:5,width:20,height:20,left:5,top:5,right:25,bottom:25},this._paintApplied=!1,this.brushGraphic=new PIXI.Graphics,this.staggerEnabled=!1,this.staggerInterval=5,this.staggerTimer=0,this.mouseDown=!1,this.mouseHovering=!1,this.brushSizeChanged=!1,this.hideBrushCircleAfterPaint=!1,this.batchRender=!1,this.brushPoints=[],this.brushDragRequested=!1,this.subjectIsolated=!1,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.handleHoveredMouseMoveBind=this.handleHoveredMouseMove.bind(this),this.handleMouseDownBind=this.handleMouseDown.bind(this),this.handleMouseMoveBind=this.handleMouseMove.bind(this),this.handleMouseUpBind=this.handleMouseUp.bind(this),this.handleCanvasScalingUpdatedBind=this.handleCanvasScalingUpdated.bind(this),this.preUndoCallback=null,this.preRedoCallback=null},Rp.prototype.initBrushPool=function(){BFN.hasOwnProperty("BrushPool")||(BFN.BrushPool=new BFN.SpritePool,BFN.BrushPool.grow(200)),this.brushPool=BFN.BrushPool,this.brushSpriteContainer=new PIXI.particles.ParticleContainer(5e3,{scale:!1,position:!0,rotation:!1,uvs:!1,alpha:!1}),this.maskRegionGraphic=new PIXI.Graphics,this.maskRegionGraphic.beginFill(16777215,1),this.maskRegionGraphic.drawRect(0,0,100,100),this.maskRegionGraphic.endFill(),BFN.Stage.state.blendModes[20]=[0,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA]},Rp.prototype.initBrush=function(){this.brush=new BFN.ImagePainterBrush,this.brush.radius=this.brushRadius,this.brush.hardness=this.brushHardness,this.brush.strength=this.brushStrength},Rp.prototype.setup=function(e,t){this.reset(),this.painterWidth=e,this.painterHeight=t,this.texture&&(this.texture.destroyGC(!0),this.texture=null),this.texture=null,this.setupPending=!0,(!this.delaySetupTillPaintingEnabled||this.delaySetupTillPaintingEnabled&&this._paintingEnabled)&&this.completeSetup(),BFN.ImagePainterUndoManager.setImagePainter(this)},Rp.prototype.completeSetup=function(){if(this.enabled&&this.setupPending){var e=this.lowerResolutionForLargeImages&&this.painterWidth*this.painterHeight>Math.pow(2048,2)?.5:1,t=this.nearestScaleMode?PIXI.SCALE_MODES.NEAREST:PIXI.settings.SCALE_MODE;this.texture=PIXI.RenderTexture.create(this.painterWidth,this.painterHeight,t,e),null===this.backgroundColor?this.texture.clear():this.texture.fillColor(this.backgroundColor),this.textureClone=PIXI.RenderTexture.create(this.painterWidth,this.painterHeight,PIXI.settings.SCALE_MODE,e),null===this.backgroundColor?this.textureClone.clear():this.textureClone.fillColor(this.backgroundColor),this.textureCloneSprite.texture=this.textureClone,this.paintTexture=PIXI.RenderTexture.create(this.painterWidth,this.painterHeight),this.paintTexture.clear(),this.paintTextureSprite.texture=this.paintTexture,this.prevTexture=PIXI.RenderTexture.create(this.painterWidth,this.painterHeight,PIXI.settings.SCALE_MODE,e),this.prevTexture.clear(),this.updatePrevTexture(),this.updateHitArea(),this.brushSizeFactor=this.brushSizeFactor,requestAnimationFrame(()=>{this.updateBrush()}),this.on("pointerover",this.handleMouseOverBind),this.on("pointerout",this.handleMouseOutBind),this.on("pointerdown",this.handleMouseDownBind);var i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),r=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents,BFN.CollageMakerCanvasModelEvents,BFN.DesignerCanvasModelEvents);i.addEventListener(r.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),this.isSetup=!0,this.setupPending=!1}},Rp.prototype.clear=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.paintApplied=!1,this.texture&&(null===this.backgroundColor?this.texture.clear():this.texture.fillColor(this.backgroundColor),this.paintTexture.clear(),null===this.backgroundColor?this.textureClone.clear():this.textureClone.fillColor(this.backgroundColor),e&&BFN.ImagePainterUndoManager.setImagePainter(this)),BFN.MainUI.requestRender()},Rp.prototype.reset=function(){if(this.paintApplied=!1,this.delaySetupTillPaintingEnabled&&(this._paintingEnabled=!1),this.isSetup){if(this.isSetup=!1,this.setupPending=!1,this.painterWidth=0,this.painterHeight=0,this.brush.reset(),this.texture){try{this.texture.destroyGC(!0)}catch(e){}this.texture=PIXI.Texture.EMPTY}try{this.textureClone.destroyGC(!0)}catch(e){}this.textureClone=null,this.textureCloneSprite.texture=PIXI.Texture.EMPTY;try{this.paintTexture.destroyGC(!0)}catch(e){}this.paintTexture=null,this.paintTextureSprite.texture=PIXI.Texture.EMPTY;try{this.prevTexture.destroyGC(!0)}catch(e){}this.prevTexture=null;try{this.regionTexture.destroyGC(!0)}catch(e){}this.regionTexture=null,this.regionSprite.texture=null,this.altTexture=null,this.updateHitArea(),BFN.ImagePainterUndoManager.reset(),BFN.BrushCirclePreview.hide(),BFN.BrushCircle.hide(),this.off("pointerover",this.handleMouseOverBind),this.off("pointerout",this.handleMouseOutBind),this.off("pointerdown",this.handleMouseDownBind);var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents,BFN.CollageMakerCanvasModelEvents,BFN.DesignerCanvasModelEvents);e.removeEventListener(t.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind)}},Rp.prototype.updateBrush=function(){this.brushGraphic.clear(),this.brushGraphic.beginFill(this._brushColor,1),this.brushGraphic.drawRect(0,0,2*this.brushRadius,2*this.brushRadius),this.brushGraphic.endFill(),this.brush.radius=this.brushRadius,this.brush.hardness=.98*this.brushHardness*Math.max(0,Math.min(1,this.brushHardnessAdjustFactor)),this.brush.strength=.95*this.brushHardness+.05,this.brush.opacity=this.brushOpacity,this.brush.updateBrush(),this.regionTexture?this.regionTexture.resize(2*this.brushRadius,2*this.brushRadius):this.regionTexture=PIXI.RenderTexture.create(2*this.brushRadius,2*this.brushRadius),this.regionSprite.texture=this.regionTexture,this.updateHitArea(),this.brushSizeChanged=!1,this.isSetup&&(this.mouseHovering&&this._paintingEnabled&&BFN.BrushCircle.show(this.brushRadius*this._scale/this._adjustScale),BFN.BrushCirclePreview.hide())},Rp.prototype.updateHitArea=function(){this.hitArea=new PIXI.Rectangle(-this.brushRadius,-this.brushRadius,this.painterWidth+2*this.brushRadius,this.painterHeight+2*this.brushRadius)},Rp.prototype.applyBrush=function(){this.paintApplied=!0,this.brushPoint.x=this.brushRect.x=this.brush.x=this.regionSprite.x=this.brushX-this.brushRadius,this.brushPoint.y=this.brushRect.y=this.brush.y=this.regionSprite.y=this.brushY-this.brushRadius,this.brushRect.width=2*this.brushRadius,this.brushRect.height=2*this.brushRadius,this._paintBounds.left=Math.max(0,Math.min(this._paintBounds.left,Math.floor(this.brushX-this.brushRadius))),this._paintBounds.right=Math.min(this.painterWidth,Math.max(this._paintBounds.right,Math.ceil(this.brushX+this.brushRadius))),this._paintBounds.top=Math.max(0,Math.min(this._paintBounds.top,Math.floor(this.brushY-this.brushRadius))),this._paintBounds.bottom=Math.min(this.painterHeight,Math.max(this._paintBounds.bottom,Math.ceil(this.brushY+this.brushRadius))),this.updatePaintBounds(),BFN.MainUI.requestRender(),this.dispatchEvent(BFN.ImagePainterEvents.BRUSH_APPLIED)},Rp.prototype.moveBrushTo=function(e,t){this.brushX=Math.floor(e),this.brushY=Math.floor(t),this.brushBeta=this.mouseDown?this.brushBeta:0,this._paintBounds.left=this._paintBounds.right=this.brushX,this._paintBounds.top=this._paintBounds.bottom=this.brushY,this.updatePaintBounds()},Rp.prototype.dragBrushTo=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Math.floor(e)-this.brushX,a=Math.floor(t)-this.brushY,n=Math.sqrt(r*r+a*a),o=Math.atan2(a,r);if(i||!(n<this.brushStepDistance)){this.brushBeta=this.mouseDown?this.brushBeta:o;var s=Math.max(1,Math.ceil(n/Math.max(1,this.brushStepDistance))),l=this.brushX,h=this.brushY;this.batchRender=!0,this.brushPoints.splice(0);for(var c=1;c<=s;c++)this.brushPoints.push(new PIXI.Point(Math.floor(l+Math.cos(o)*n*(c/s)),Math.floor(h+Math.sin(o)*n*(c/s))));if(this.brushPoints.length){if(this.brushEnabled){this.eraseMode?this.paintTextureSprite.blendMode=20:this.paintTextureSprite.blendMode=0,this.brushPool.growTo(this.brushPoints.length);for(var u=0;u<this.brushPoints.length;u++){var d=this.brushPool.getSprite(u,this.brushPoints[u],this.brush.texture);this.brushSpriteContainer.addChild(d)}var m=this.getDraggedBrushBounds(this.brushPoints,this.brushRadius);this.maskRegionGraphic.clear(),this.maskRegionGraphic.beginFill(16777215,1),this.maskRegionGraphic.drawRect(m.x,m.y,m.width,m.height),this.maskRegionGraphic.endFill(),this.brushSpriteContainer.mask=this.maskRegionGraphic,BFN.Stage.render(this.brushSpriteContainer,this.paintTexture,!1),this.brushSpriteContainer.mask=null,this.brushSpriteContainer.children.length&&this.brushSpriteContainer.removeChildren(0,this.brushSpriteContainer.children.length),this.texture.clearRect(m.x,m.y,m.width,m.height),this.referenceContainer.mask=this.maskRegionGraphic,BFN.Stage.render(this.referenceContainer,this.texture,!1),this.referenceContainer.mask=null}for(var p=0;p<this.brushPoints.length;p++)this.brushX=this.brushPoints[p].x,this.brushY=this.brushPoints[p].y,this.applyBrush();this.batchRender=!1}}},Rp.prototype.getDraggedBrushBounds=function(e,t){var i={x:0,y:0,width:0,height:0};if(e.length){var r,a,n,o,s=e[0],l=e[e.length-1],h=l.x-s.x,c=l.y-s.y;h<0?c<0?(r=l.x,a=l.y,n=s.x,o=s.y):(r=l.x,a=s.y,n=s.x,o=l.y):c<0?(r=s.x,a=l.y,n=l.x,o=s.y):(r=s.x,a=s.y,n=l.x,o=l.y),i.x=r-t,i.y=a-t,i.width=n-r+2*t,i.height=o-a+2*t}return i},Rp.prototype.updatePrevTexture=function(){this.altTexture?this.prevTexture.copyPixels(this.altTexture):this.prevTexture.copyPixels(this.texture)},Rp.prototype.updatePaintBounds=function(){this._paintBounds.x=this._paintBounds.left,this._paintBounds.y=this._paintBounds.top,this._paintBounds.width=Math.abs(this._paintBounds.right-this._paintBounds.left),this._paintBounds.height=Math.abs(this._paintBounds.bottom-this._paintBounds.top)},Rp.prototype.updateComplete=function(){this.textureClone.copyPixels(this.texture),this.paintTexture.clear()},Rp.prototype.updateStaggerTimer=function(){this.mouseDown&&(this.staggerTimer++,this.staggerTimer>=this.staggerInterval&&(this.staggerTimer=0,this.applyBrush()),setTimeout(this.updateStaggerTimer.bind(this),0))},Rp.prototype.cancelPaintStroke=function(){this.mouseDown&&(this.mouseDown=!1,this.brushDragRequested=!1,this.mouseHovering||this.handleMouseOutBind(this),this.paintTexture.clear(),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),this.singleClick&&!this.altTexture||BFN.MainUI.off("pointermove",this.handleMouseMoveBind),window.UIScreens.toggleMouseEvent(!0))},Rp.prototype.showBrushCircle=function(e){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel);!this.isSetup||t.canvasScaling||this.brushSizeChanged||!this._paintingEnabled&&!this.allowBrushCircle||BFN.BrushCircle.show(this.brushRadius*this._scale/this._adjustScale,e)},Rp.prototype.hideBrushCircle=function(){this.isSetup&&BFN.BrushCircle.showing&&!this.mouseDown&&BFN.BrushCircle.hide()},Rp.prototype.handleMouseOver=function(e){this.mouseHovering=!0,BFN.MainUI.on("pointermove",this.handleHoveredMouseMoveBind),this.brushSizeChanged&&this.updateBrush(),this.showBrushCircle(e)},Rp.prototype.handleMouseOut=function(e){this.mouseHovering=!1,BFN.MainUI.off("pointermove",this.handleHoveredMouseMoveBind),this.hideBrushCircle()},Rp.prototype.handleHoveredMouseMove=function(e){this.isSetup&&!BFN.BrushCircle.showing&&this.showBrushCircle(e)},Rp.prototype.handleMouseDown=function(e){if(this._paintingEnabled&&this.clicksEnabled){this.mouseDown=!0,this.brushDragRequested=!1,this.updatePrevTexture(),BFN.Stage.render(this.brushGraphic,this.brush.sourceTexture),this.brush.updateFilter(),this.brushBeta=0,this.mouseStartPosition=this.getPointerPosition(e);var t=this.getMousePosition();t.x!=this.mouseStartPosition.x&&t.y!=this.mouseStartPosition.y&&(this.hideBrushCircleAfterPaint=!0,this.showBrushCircle(e)),this.moveBrushTo(this.mouseStartPosition.x,this.mouseStartPosition.y),this.ignoreInitialPress||this.dragBrushTo(this.mouseStartPosition.x,this.mouseStartPosition.y,!0),window.UIScreens.toggleMouseEvent(!1),BFN.MainUI.on("pointerup",this.handleMouseUpBind),BFN.MainUI.on("pointerupoutside",this.handleMouseUpBind),this.dispatchEvent(BFN.ImagePainterEvents.PAINTING_STARTED),this.singleClick||(this.staggerEnabled&&(this.staggerTimer=0,this.updateStaggerTimer()),BFN.MainUI.on("pointermove",this.handleMouseMoveBind),BFN.smoothPictureDisabled=!0)}},Rp.prototype.handleMouseMove=function(e){this.ignoreMouseMove||(this.staggerTimer=0,this.lastMouseMoveEvent=e,this.brushDragRequested||(this.brushDragRequested=!0,this.handleMainUIPreRenderBind||(this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)),BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)))},Rp.prototype.handleMainUIPreRender=function(e){BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.processBrushDrag(this.lastMouseMoveEvent)},Rp.prototype.processBrushDrag=function(e){if(this.brushDragRequested&&this.mouseDown){this.brushDragRequested=!1,this.mouseCurrentPosition=this.getPointerPosition(e);var t=this.mouseCurrentPosition.x-this.mouseStartPosition.x,i=this.mouseCurrentPosition.y-this.mouseStartPosition.y;this.brushBeta=Math.atan2(i,t),this.dragBrushTo(this.mouseCurrentPosition.x,this.mouseCurrentPosition.y),this.mouseStartPosition=this.mouseCurrentPosition}},Rp.prototype.handleMouseUp=function(e){BFN.smoothPictureDisabled=!1,this.mouseDown=!1,this.brushDragRequested=!1,this.mouseHovering?this.hideBrushCircleAfterPaint&&(this.hideBrushCircle(),this.hideBrushCircleAfterPaint=!1):this.handleMouseOutBind(this),this.dispatchEvent(BFN.ImagePainterEvents.PAINTING_COMPLETE),this.updateComplete(),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),window.UIScreens.toggleMouseEvent(!0),this.singleClick&&!this.altTexture||(BFN.MainUI.off("pointermove",this.handleMouseMoveBind),this.dispatchEventsAfterUpdate&&(this.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED_PRE_HISTORY),this.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)))},Rp.prototype.handleCanvasScalingUpdated=function(e){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel);BFN.ImagePainterUndoManager.currentImagePainter!=this||t.canvasScaling||(this.toolScale=this._scale,this.updateBrush())},Object.defineProperty(Rp.prototype,"toolScale",{set:function(e){this._scale=e,this.scaleUpdated=!0,this.brushSizeFactor=this.brushSizeFactor,this.scaleUpdated=!1},get:function(){return this._scale}}),Object.defineProperty(Rp.prototype,"adjustScale",{set:function(e){this._adjustScale=e},get:function(){return this._adjustScale}}),Object.defineProperty(Rp.prototype,"brushSizeFactor",{set:function(e){this._brushSizeFactor=Math.max(0,Math.min(1,e));var t=e*e;this.scaleAffectsBrushRadius?this.brushRadius=Math.round((Math.min(this.maxBrushRadius,this.painterWidth/2,this.painterHeight/2,this.painterWidth/2*(1/this._scale),this.painterHeight/2*(1/this._scale))-this.minBrushRadius)*t+this.minBrushRadius):this.brushRadius=Math.round((Math.min(this.maxBrushRadius,this.painterWidth/2,this.painterHeight/2)-this.minBrushRadius)*t+this.minBrushRadius),this.brushStepDistance=Math.round(Math.max(this.brushRadius/4,1)),this.dispatchEvent(BFN.ImagePainterEvents.BRUSH_RADIUS_UPDATED),BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel).canvasScaling||(this.brushSizeChanged||(this.brushSizeChanged=!0,this.isSetup&&BFN.BrushCircle.showing&&BFN.BrushCircle.hide()),this.isSetup&&!this.scaleUpdated&&BFN.BrushCirclePreview.show(this.brushRadius*this._scale/this._adjustScale)),this.targetStep=Math.round(Math.min(Math.max(Math.max(this.painterWidth,this.painterHeight)/(2*this.brushRadius),4),10))},get:function(){return this._brushSizeFactor}}),Object.defineProperty(Rp.prototype,"brushHardnessFactor",{set:function(e){this.brushHardness=Math.max(0,Math.min(1,e))},get:function(){return this.brushHardness}}),Object.defineProperty(Rp.prototype,"brushStrengthFactor",{set:function(e){this.brushStrength=Math.max(0,Math.min(1,.95*e+.05)),this.paintTextureSprite.alpha=this.brushStrength},get:function(){return this.brushStrength}}),Object.defineProperty(Rp.prototype,"brushOpacityFactor",{set:function(e){this.brushOpacity=Math.max(0,Math.min(1,e))},get:function(){return this.brushOpacity}}),Object.defineProperty(Rp.prototype,"brushColor",{set:function(e){this._brushColor=e},get:function(){return this._brushColor}}),Object.defineProperty(Rp.prototype,"paintingEnabled",{set:function(e){this._paintingEnabled!=e&&(this._paintingEnabled=e,this.delaySetupTillPaintingEnabled&&this._paintingEnabled&&this.completeSetup(),this.dispatchEvent(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED))},get:function(){return this._paintingEnabled}}),Object.defineProperty(Rp.prototype,"paintBounds",{set:function(e){e&&(this._paintBounds.x=this._paintBounds.left=Math.floor(e.x)-1,this._paintBounds.y=this._paintBounds.top=Math.floor(e.y)-1,this._paintBounds.width=Math.ceil(e.width)+2,this._paintBounds.height=Math.ceil(e.height)+2,this._paintBounds.right=this._paintBounds.x+this._paintBounds.width,this._paintBounds.bottom=this._paintBounds.y+this._paintBounds.height)},get:function(){return this._paintBounds}}),Object.defineProperty(Rp.prototype,"paintApplied",{set:function(e){e!=this._paintApplied&&(this._paintApplied=e,this.dispatchEvent(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED))},get:function(){return BFN.ImagePainterUndoManager.currentImagePainter===this?this._paintApplied||BFN.ImagePainterUndoManager.memoryFreed:this._paintApplied}}),BFN.ImagePainter=Rp,Ap.prototype=Object.create(PIXI.Sprite.prototype),Ap.prototype.init=function(){BeFunky.log("ImageTouchUp Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initRenderSprite(),this.initPainter()},Ap.prototype.initDefaultValues=function(){this.sourceTexture=null,this.renderTexture=null,this._scale=1,this.active=!1,BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,this.handleEffectComplete.bind(this))},Ap.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Ap.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Ap.prototype.initRenderSprite=function(){this.renderSprite=new PIXI.Sprite,this.renderSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.renderSprite)},Ap.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.brushOpacityFactor=.1,this.painter.brushHardnessAdjustFactor=.7,this.imageContainer.addChild(this.painter),this.renderSprite.mask=this.painter},Ap.prototype.handleTouchUpBrush=function(){this.updateTouchUpBrushParameters()},Ap.prototype.handleUpdateTool=function(e){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP){var t=e,i=null;if(BFN.effectPresetMap.hasOwnProperty("touchup_"+t)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap["touchup_"+t])&&(i=BFN.effectPresetMap["touchup_"+t]),i){switch(this.painter.brushOpacityFactor=.1,this.painter.brushHardnessAdjustFactor=.7,t){case"fix_redeye":this.painter.brushOpacityFactor=1,this.painter.brushHardnessAdjustFactor=1}var r=!1;t!=i&&UITools.getToolVO(i)!=UITools.getToolVO(t)&&(UITools.toolVOs[i]=UITools.getToolVO(t),r=!0);var a=UITools.getToolVO(t);this.currentToolID!=e&&(this.currentToolID=e,UITools.setToolValue("touch_up_brush","size",Math.round(100*a.brush_size)),UITools.setToolValue("touch_up_brush","hardness",Math.round(100*a.brush_hardness)),UITools.updateToolControls("touch_up_brush"),this.updateTouchUpBrushParameters());var n=!1;if(BFN.EffectManager.effectID!=i||r){n=!0,BFN.applyCancelMenu.setStyles({pointerEvents:"none"}),clearTimeout(this.timeoutID);var o=()=>{BFN.MainUI.viewportUpdating?this.timeoutID=setTimeout(o,16):(this.active&&(BFN.EffectManager.effectID=i),BFN.applyCancelMenu.setStyles({pointerEvents:""}))};this.timeoutID=setTimeout(o,16)}BFN.EffectManager.changing!=a.updating&&(BFN.EffectManager.changing=a.updating),n||(BFN.EffectManager.parameters=a),a.updating||n||BFN.EffectManager.processEffect()}}},Ap.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.renderTexture&&(this.renderTexture.destroyGC(!0),this.renderTexture=null),this.active=!1,this.currentToolID=null,null!=e?(this.active=!0,this.sourceTexture=e,this.renderTexture=PIXI.RenderTexture.create(32,32),BFN.EffectManager.setSourceTexture(this.sourceTexture),BFN.EffectManager.setRenderTexture(this.renderTexture),BFN.EffectManager.currentComponent=this,this.sourceSprite.texture=this.sourceTexture,this.renderSprite.texture=this.renderTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),UITools.setToolValue("touch_up_brush","erase",!1),UITools.updateToolControl("touch_up_brush_erase"),this.updateTouchUpBrushParameters()):(this.painter.reset(),BFN.EffectManager.currentComponent==this&&BFN.EffectManager.reset())},Ap.prototype.updateTouchUpBrushParameters=function(){var e=UITools.getToolVO("touch_up_brush");if(e){e.clear&&(this.painter.clear(!0),UITools.setToolValue("touch_up_brush","erase",!1),UITools.updateToolControl("touch_up_brush_erase")),this.painter.eraseMode!=e.erase&&(this.painter.eraseMode=e.erase),e.updating&&"size"==e.updating_id&&this.painter.brushSizeFactor!=e.size/100&&(this.painter.brushSizeFactor=e.size/100);var t=!1;e.updating||"size"!=e.updating_id&&this.painter.brushSizeFactor==e.size/100||(this.painter.brushSizeFactor=e.size/100,t=!0),e.updating||"hardness"!=e.updating_id&&this.painter.brushHardnessFactor==e.hardness/100||(this.painter.brushHardnessFactor=e.hardness/100,t=!0),t&&this.painter.updateBrush(),this.currentToolID&&(UITools.setToolValue(this.currentToolID,"brush_size",this.painter.brushSizeFactor),UITools.setToolValue(this.currentToolID,"brush_hardness",this.painter.brushHardnessFactor))}},Ap.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.renderSprite.currentScale=e,this.painter.currentScale=e},Ap.prototype.handleEffectComplete=function(){BFN.MainUI.requestRender()},Object.defineProperty(Ap.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Ap.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceSprite.width,this.sourceSprite.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),e}}),Object.defineProperty(BFN,"ImageTouchUp",{get:function(){return!BFN._ImageTouchUp&&(BFN._ImageTouchUp=new Ap),BFN._ImageTouchUp}}),BFN.ImageEffectEvents={CLEAR_PAINT:new Event("CLEAR_PAINT"),INVERSE_PAINT:new Event("INVERSE_PAINT")},Vp.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),Vp.prototype.init=function(){BeFunky.log("ImageEffect Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initRenderSprite(),this.initMaskBlendSprite(),this.initMaskSprite(),this.initPainter()},Vp.prototype.initDefaultValues=function(){this.sourceTexture=null,this.renderTexture=null,this._inverse=!1,this._scale=1,this.active=!1,this.effectToolVO=null,this.effectReady=!1,this.effectFadeable=!1,this.sourceTransparency=!1,this.transparentMode=!1,BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,this.handleEffectComplete.bind(this))},Vp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Vp.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Vp.prototype.initRenderSprite=function(){this.renderSprite=new PIXI.Sprite,this.renderSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.renderSprite)},Vp.prototype.initMaskBlendSprite=function(){this.maskBlendSprite=new BFN.MaskBlendSprite,this.maskBlendSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.maskBlendSprite)},Vp.prototype.initMaskSprite=function(){this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.maskSprite.interactive=!1,this.imageContainer.addChild(this.maskSprite)},Vp.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.paintingEnabled=!1,this.painter.delaySetupTillPaintingEnabled=!0,this.imageContainer.addChild(this.painter),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handlePainterUpdated.bind(this)),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED.type,this.handlePainterPaintAppliedUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED.type,this.handlePainterPaintingEnabledUpdated.bind(this))},Vp.prototype.handleEffectGeneric=function(){var e=UITools.getToolVO("effect_generic");"amount"==e.updating_id&&(this.updateEffectIntensity(),this.effectToolVO&&this.effectToolVO.hasOwnProperty("amount")&&(this.effectToolVO.amount=e.amount),BFN.MainUI.requestRender())},Vp.prototype.handleEffectBrush=function(){this.updateEffectBrushParameters()},Vp.prototype.handleUpdateTool=function(e){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT){var t=e,i=null;if(BFN.effectMap.hasOwnProperty(t)?i=t:BFN.effectPresetMap.hasOwnProperty(t)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[t])&&(i=BFN.effectPresetMap[t]),i){var r=!1;t!=i&&UITools.getToolVO(i)!=UITools.getToolVO(t)&&(UITools.toolVOs[i]=UITools.getToolVO(t),r=!0,this.effectReady=!1),this.painter.visible=!BFN.EffectsNoPaint.includes(t);var a=UITools.getToolVO(t);this.effectFadeable=!!a.fadeable,this.effectToolVO=a,this.effectToolVO.hasOwnProperty("amount")||(this.effectToolVO.amount=100),this.currentToolID!=e&&(this.currentToolID=e,UITools.setToolValue("effect_generic","amount",a.hasOwnProperty("amount")?a.amount:100),UITools.applyTool("effect_generic"),UITools.updateToolControls("effect_generic")),"reset"==a.updating_id&&(Object.assign(a,a.defaultValues),UITools.updateToolControls(t),this.painter.clear(!0),UITools.setToolValue("effect_brush","erase",!1),UITools.updateToolControl("effect_brush_erase"));var n=!1;if(BFN.EffectManager.effectID!=i||r){var o;n=BFN.EffectManager.autoProcess,BFN.applyCancelMenu.setStyles({pointerEvents:"none"}),setTimeout(()=>{(o=BFN.activePresetMenuItem&&BFN.activePresetMenuItem.basicSettings?BFN.activePresetMenuItem.basicSettings:void 0)&&o.setStyles({pointerEvents:"none"})},0),clearTimeout(this.timeoutID);var s=()=>{BFN.MainUI.viewportUpdating?this.timeoutID=setTimeout(s,16):(this.active&&(BFN.EffectManager.effectID=i),BFN.applyCancelMenu.setStyles({pointerEvents:""}),o&&o.setStyles({pointerEvents:""}))};this.timeoutID=setTimeout(s,16),this.updateMaskDisplay()}BFN.EffectManager.changing!=a.updating&&(a.hasOwnProperty("real_time")&&!a.real_time||(BFN.EffectManager.changing=a.updating)),n||a.hasOwnProperty("real_time")&&!a.real_time||(BFN.EffectManager.parameters=a),a.updating||n||BFN.EffectManager.processEffect()}}},Vp.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.renderTexture&&(this.renderTexture.destroyGC(!0),this.renderTexture=null,this.renderSprite.texture=PIXI.Texture.EMPTY),this.active=!1,this.currentToolID=null,this.effectReady=!1,this.effectFadeable=!1,this.sourceTransparency=!1,e?(this.active=!0,this.sourceTexture=e,this.renderTexture=e.renderClone(),BFN.EffectManager.autoProcess=!1,BFN.EffectManager.setSourceTexture(this.sourceTexture),BFN.EffectManager.setRenderTexture(this.renderTexture),BFN.EffectManager.currentComponent=this,BFN.EffectManager.autoProcess=!0,this.sourceTransparency=this.sourceTexture.determineTransparency(),this.updateTransparentMode(!0),this.maskSprite.width=this.sourceTexture.width,this.maskSprite.height=this.sourceTexture.height,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.inverse=!1,this.updateMaskDisplay(),UITools.setToolValue("effect_brush","show_mask",!1),UITools.setToolValue("effect_brush","select_action","subtract"),UITools.updateToolControls("effect_brush"),this.updateEffectBrushParameters()):(this.renderSprite.mask=null,this.maskBlendSprite.reset(),this.painter.reset(),BFN.EffectManager.currentComponent==this&&BFN.EffectManager.reset())},Vp.prototype.updateEffectIntensity=function(){var e=UITools.getToolVO("effect_generic");this.transparentMode?this.maskBlendSprite.blendIntensity=e.amount/100:this.renderSprite.alpha=e.amount/100},Vp.prototype.updateTransparentMode=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.sourceTransparency||!(!BFN.EffectManager.currentEffect||!BFN.EffectManager.currentEffect.outputTransparent);(this.transparentMode!==t||e)&&(this.transparentMode=t,this.transparentMode?(this.sourceSprite.visible=!1,this.sourceSprite.texture=this.sourceTexture,this.renderSprite.visible=!1,this.renderSprite.texture=PIXI.Texture.EMPTY,this.maskBlendSprite.visible=!0,this.maskBlendSprite.inputTexture=this.sourceTexture,this.maskBlendSprite.blendTexture=this.renderTexture,e||(this.showMask=this.showMask,this.handlePainterUpdated())):(this.renderSprite.visible=!0,this.renderSprite.texture=this.renderTexture,this.sourceSprite.visible=!0,this.sourceSprite.texture=this.sourceTexture,this.maskBlendSprite.visible=!1,this.maskBlendSprite.reset()),e||(this.updateEffectIntensity(),this.updateMaskDisplay()))},Vp.prototype.updateEffectBrushParameters=function(){var e=UITools.getToolVO("effect_brush");if(e){if("isolate_subject"===e.updating_id&&!e.updating){for(var t=["blur","glow","replace_color","cinematic_film_grain","holgaart","motioncolor","multimedia","orton","sunburst","viewfinder","winter"],i=!1,r=0;r<t.length;r++){var a=t[r];if(this.currentToolID.includes(a)){i=!0;break}}var n=i?this.inverse:!this.inverse;return this.sourceTexture.altTexture=this.renderTexture,this.sourceTexture.altTextureInverse=!i,void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,n,()=>{delete this.sourceTexture.altTexture,delete this.sourceTexture.altTextureInverse})}e.clear&&(this.painter.clear(!0),UITools.setToolValue("effect_brush","erase",!1),UITools.updateToolControl("effect_brush_erase"),this.transparentMode&&this.maskBlendSprite.updateDisplay(),this.inverse&&(this.inverse=!1,this.updateMaskDisplay()),this.dispatchEvent(BFN.ImageEffectEvents.CLEAR_PAINT)),this.showMask!==e.show_mask&&(this.showMask=e.show_mask,this.updateMaskDisplay()),"invert"===e.updating_id&&(this.inverse=!this.inverse,this.updateMaskDisplay());var o="subtract"===e.select_action?this.inverse:!this.inverse;this.painter.eraseMode!=o&&(this.painter.eraseMode=o),e.updating&&"size"==e.updating_id&&this.painter.brushSizeFactor!=e.size/100&&(this.painter.brushSizeFactor=e.size/100);var s=!1;e.updating||"size"!=e.updating_id&&this.painter.brushSizeFactor==e.size/100||(this.painter.brushSizeFactor=e.size/100,s=!0),e.updating||"hardness"!=e.updating_id&&this.painter.brushHardnessFactor==e.hardness/100||(this.painter.brushHardnessFactor=e.hardness/100,s=!0),e.updating||"strength"!=e.updating_id&&this.painter.brushStrengthFactor==e.strength/100||(this.painter.brushStrengthFactor=e.strength/100,s=!0),s&&this.painter.updateBrush()}},Vp.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=!!(null===e?this.showMask:e),this.sourceSprite.visible=e&&this.transparentMode||!this.transparentMode&&(this.effectFadeable||this.painter.paintApplied||!this.painter.paintApplied&&(e||this.inverse)),this.renderSprite.visible=!(e||this.inverse&&!this.painter.paintApplied||this.transparentMode),this.maskBlendSprite.visible=!e&&this.transparentMode,this.maskSprite.visible=e&&!(this.inverse&&!this.painter.paintApplied);var t=this.painter.isSetup&&this.painter.paintApplied?this.painter:null;this.renderSprite.mask!==t&&(this.renderSprite.mask=this.transparentMode?null:t),this.maskSprite.mask!==t&&(this.maskSprite.mask=t),this.painter.renderable=!1,BFN.MainUI.requestRender()},Vp.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.renderSprite.currentScale=e,this.maskBlendSprite.currentScale=e,this.painter.currentScale=e},Vp.prototype.handleEffectComplete=function(){this.updateTransparentMode(),this.effectReady||(this.effectReady=!0,this.inverse=this.inverse),this.transparentMode&&this.maskBlendSprite.updateDisplay()},Vp.prototype.handlePainterUpdated=function(e){BFN.ImagePainterUndoManager.currentImagePainter===this.painter&&this.painter.isSetup&&this.transparentMode&&(this.maskBlendSprite.maskTexture!==this.painter.texture&&(this.maskBlendSprite.maskTexture=this.painter.texture),this.maskBlendSprite.updateDisplay())},Vp.prototype.handlePainterPaintAppliedUpdated=function(e){this.updateMaskDisplay()},Vp.prototype.handlePainterPaintingEnabledUpdated=function(){this.painter.isSetup&&!this.painter.paintingEnabled&&this.showMask&&(UITools.setToolValue("effect_brush","show_mask",!1),UITools.updateToolControl("effect_brush_show_mask"),this.showMask=UITools.getToolValue("effect_brush","show_mask"),this.updateMaskDisplay())},Object.defineProperty(Vp.prototype,"showMask",{set:function(e){this._showMask=e,this.transparentMode&&(this.maskBlendSprite.autoRender=!this.showMask)},get:function(){return this._showMask}}),Object.defineProperty(Vp.prototype,"inverse",{set:function(e){this._inverse=e,this.maskBlendSprite.inverse=this._inverse,this.painter.inverseMask=!this._inverse,this.dispatchEvent(BFN.ImageEffectEvents.INVERSE_PAINT),BFN.MainUI.requestRender()},get:function(){return this._inverse}}),Object.defineProperty(Vp.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Vp.prototype,"modifiedTexture",{get:function(){this.transparentMode&&this.maskBlendSprite.displayUpdatePending&&this.maskBlendSprite.renderDisplay();var e=PIXI.RenderTexture.create(this.sourceSprite.width,this.sourceSprite.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.updateMaskDisplay(),e}}),Object.defineProperty(BFN,"ImageEffect",{get:function(){return!BFN._ImageEffect&&(BFN._ImageEffect=new Vp),BFN._ImageEffect}}),Up.prototype=Object.create(PIXI.Sprite.prototype),Up.prototype.init=function(){BeFunky.log("ImageArtsy Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initRenderSprite(),this.initMaskBlendSprite(),this.initMaskSprite(),this.initPainter()},Up.prototype.initDefaultValues=function(){this.sourceTexture=null,this.renderTexture=null,this._inverse=!1,this._scale=1,this.sourceTransparency=!1,BFN.ArtsyManager.addEventListener(BFN.ArtsyManagerEvents.ARTSY_COMPLETE.type,this.handleArtsyComplete.bind(this))},Up.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Up.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Up.prototype.initRenderSprite=function(){this.renderSprite=new PIXI.Sprite,this.renderSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.renderSprite)},Up.prototype.initMaskBlendSprite=function(){this.maskBlendSprite=new BFN.MaskBlendSprite,this.maskBlendSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.maskBlendSprite)},Up.prototype.initMaskSprite=function(){this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.maskSprite.interactive=!1,this.imageContainer.addChild(this.maskSprite)},Up.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.paintingEnabled=!1,this.painter.delaySetupTillPaintingEnabled=!0,this.imageContainer.addChild(this.painter),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handlePainterUpdated.bind(this)),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED.type,this.handlePainterPaintAppliedUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED.type,this.handlePainterPaintingEnabledUpdated.bind(this))},Up.prototype.handleArtsyGeneric=function(){var e=UITools.getToolVO("artsy_generic");"amount"==e.updating_id&&(this.sourceTransparency?this.maskBlendSprite.blendIntensity=e.amount/100:this.renderSprite.alpha=e.amount/100,BFN.MainUI.requestRender())},Up.prototype.handleArtsyBrush=function(){this.updateArtsyBrushParameters()},Up.prototype.handleUpdateTool=function(e){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY){var t=e,i=UITools.getToolVO(t);if(!i||i&&(i.updating||!i.hasOwnProperty("id")))return;var r=BFN.ArtsyToolIDs.hasOwnProperty(t)&&BFN.ArtsyToolParams.hasOwnProperty(t),a=BFN.ArtsyAdjustAndPaintToolObjects.hasOwnProperty(t);this.currentToolID!=t&&(r||a)&&(this.currentToolID=t,UITools.setToolValue("artsy_generic","amount",100),UITools.applyTool("artsy_generic"),UITools.updateToolControls("artsy_generic"));var n=i.id,o={},s=!1,l=null;if(r){for(var h=BFN.ArtsyToolParams[t],c=0;c<h.length;c++){var u=h[c];if(i.hasOwnProperty(u)){var d=BFN.ArtsyToolColorParams.hasOwnProperty(t)&&BFN.ArtsyToolColorParams[t].length&&-1!=BFN.ArtsyToolColorParams[t].indexOf(u);o[u]=(d?"#":"")+i[u]}}var m=BFN.ArtsyPresetObjects[t];s=!m.hasOwnProperty("isArtsy")||m.isArtsy,l=m.hasOwnProperty("maxPixels")?m.maxPixels:null}else{if(!a)return;for(var p in i.defaultValues)if(!["id","maxPixels"].includes(p)){var g=UITools.getParamObject(t+"_"+p),f=!!(g&&g.type&&g.type.includes("color"));o[p]=(f?"#":"")+i[p]}l=i.hasOwnProperty("maxPixels")?i.maxPixels:null}BFN.ArtsyService.currentArtsyID=n,BFN.ArtsyService.isArtsy=s,BFN.ArtsyService.maxPixels=l,BFN.ArtsyManager.parameters=o}},Up.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.renderTexture&&(this.renderTexture.destroyGC(!0),this.renderTexture=null,this.renderSprite.texture=PIXI.Texture.EMPTY),this.currentToolID=null,this.sourceTransparency=!1,null!=e?(this.sourceTexture=e,this.renderTexture=e.renderClone(),this.sourceTexture.baseTexture.hasOwnProperty("isTransparent"),this.sourceTransparency=this.sourceTexture.determineTransparency(),BFN.ArtsyManager.setSourceTexture(this.sourceTexture),BFN.ArtsyManager.setRenderTexture(this.renderTexture),this.sourceTransparency?(this.sourceSprite.texture=this.sourceTexture,this.sourceSprite.visible=!1,this.renderSprite.visible=!1,this.maskBlendSprite.visible=!0,this.maskBlendSprite.inputTexture=this.sourceTexture,this.maskBlendSprite.blendTexture=this.renderTexture):(this.maskBlendSprite.visible=!1,this.sourceSprite.visible=!0,this.renderSprite.visible=!0,this.sourceSprite.texture=this.sourceTexture,this.renderSprite.texture=this.renderTexture),this.maskSprite.width=this.sourceTexture.width,this.maskSprite.height=this.sourceTexture.height,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.inverse=!1,this.updateMaskDisplay(),UITools.setToolValue("artsy_brush","show_mask",!1),UITools.setToolValue("artsy_brush","select_action","subtract"),UITools.updateToolControls("artsy_brush"),this.updateArtsyBrushParameters()):(this.renderSprite.mask=null,this.maskBlendSprite.reset(),this.painter.reset(),BFN.ArtsyManager.reset())},Up.prototype.updateArtsyBrushParameters=function(){var e=UITools.getToolVO("artsy_brush");if(e){if("isolate_subject"===e.updating_id&&!e.updating)return this.sourceTexture.altTexture=this.renderTexture,this.sourceTexture.altTextureInverse=!0,void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,!this.inverse,()=>{delete this.sourceTexture.altTexture,delete this.sourceTexture.altTextureInverse});e.clear&&(this.painter.clear(!0),UITools.setToolValue("artsy_brush","erase",!1),UITools.updateToolControl("artsy_brush_erase"),this.sourceTransparency&&this.maskBlendSprite.updateDisplay(),this.inverse&&(this.inverse=!1,this.updateMaskDisplay())),this.showMask!==e.show_mask&&(this.showMask=e.show_mask,this.updateMaskDisplay()),"invert"===e.updating_id&&(this.inverse=!this.inverse,this.updateMaskDisplay());var t="subtract"===e.select_action?this.inverse:!this.inverse;this.painter.eraseMode!=t&&(this.painter.eraseMode=t),e.updating&&"size"==e.updating_id&&this.painter.brushSizeFactor!=e.size/100&&(this.painter.brushSizeFactor=e.size/100);var i=!1;e.updating||"size"!=e.updating_id&&this.painter.brushSizeFactor==e.size/100||(this.painter.brushSizeFactor=e.size/100,i=!0),e.updating||"hardness"!=e.updating_id&&this.painter.brushHardnessFactor==e.hardness/100||(this.painter.brushHardnessFactor=e.hardness/100,i=!0),e.updating||"strength"!=e.updating_id&&this.painter.brushStrengthFactor==e.strength/100||(this.painter.brushStrengthFactor=e.strength/100,i=!0),i&&this.painter.updateBrush()}},Up.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=!!(null===e?this.showMask:e),this.sourceSprite.visible=e&&this.sourceTransparency||!this.sourceTransparency,this.renderSprite.visible=!(e||this.inverse&&!this.painter.paintApplied||this.sourceTransparency),this.maskBlendSprite.visible=!e&&this.sourceTransparency,this.maskSprite.visible=e&&!(this.inverse&&!this.painter.paintApplied);var t=this.painter.isSetup&&this.painter.paintApplied?this.painter:null;this.renderSprite.mask!==t&&(this.renderSprite.mask=this.sourceTransparency?null:t),this.maskSprite.mask!==t&&(this.maskSprite.mask=t),this.painter.renderable=!1,BFN.MainUI.requestRender()},Up.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.renderSprite.currentScale=e,this.maskBlendSprite.currentScale=e,this.painter.currentScale=e},Up.prototype.handleArtsyComplete=function(){this.updateMaskDisplay(),this.sourceTransparency&&this.maskBlendSprite.updateDisplay()},Up.prototype.handlePainterUpdated=function(e){BFN.ImagePainterUndoManager.currentImagePainter===this.painter&&this.painter.isSetup&&this.sourceTransparency&&(this.maskBlendSprite.maskTexture!==this.painter.texture&&(this.maskBlendSprite.maskTexture=this.painter.texture),this.maskBlendSprite.updateDisplay())},Up.prototype.handlePainterPaintAppliedUpdated=function(e){this.updateMaskDisplay()},Up.prototype.handlePainterPaintingEnabledUpdated=function(){this.painter.isSetup&&!this.painter.paintingEnabled&&this.showMask&&(UITools.setToolValue("artsy_brush","show_mask",!1),UITools.updateToolControl("artsy_brush_show_mask"),this.showMask=UITools.getToolValue("artsy_brush","show_mask"),this.updateMaskDisplay())},Object.defineProperty(Up.prototype,"showMask",{set:function(e){this._showMask=e,this.sourceTransparency&&(this.maskBlendSprite.autoRender=!this.showMask)},get:function(){return this._showMask}}),Object.defineProperty(Up.prototype,"inverse",{set:function(e){this._inverse=e,this.maskBlendSprite.inverse=this._inverse,this.painter.inverseMask=!this._inverse,BFN.MainUI.requestRender()},get:function(){return this._inverse}}),Object.defineProperty(Up.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Up.prototype,"modifiedTexture",{get:function(){this.sourceTransparency&&this.maskBlendSprite.displayUpdatePending&&this.maskBlendSprite.renderDisplay();var e=PIXI.RenderTexture.create(this.sourceSprite.width,this.sourceSprite.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.updateMaskDisplay(),e}}),Object.defineProperty(BFN,"ImageArtsy",{get:function(){return!BFN._ImageArtsy&&(BFN._ImageArtsy=new Up),BFN._ImageArtsy}}),Gp.prototype=Object.create(PIXI.Sprite.prototype),Gp.prototype.init=function(){BeFunky.log("ImageBorder Init"),this.initDefaultValues(),this.initImageContainer(),this.initMatteSprite(),this.initSourceSprite(),this.initFrameSprite(),this.initCaptionGraphic()},Gp.prototype.initDefaultValues=function(){this.baseTextureSize=32,this.sourceTexture=null,this._scale=1,this.imageContainerWidth=0,this.imageContainerHeight=0},Gp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Gp.prototype.initMatteSprite=function(){this.matteSpriteTexture=PIXI.RenderTexture.create(this.baseTextureSize,this.baseTextureSize),this.matteSprite=new PIXI.Sprite(this.matteSpriteTexture),this.matteSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.matteSprite)},Gp.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite),this.sourceSpriteMaskTexture=PIXI.RenderTexture.create(this.baseTextureSize,this.baseTextureSize),this.sourceSpriteMask=new PIXI.Sprite(this.sourceSpriteMaskTexture),this.imageContainer.addChild(this.sourceSpriteMask),this.sourceSprite.mask=this.sourceSpriteMask},Gp.prototype.initFrameSprite=function(){this.frameSpriteTexture=PIXI.RenderTexture.create(this.baseTextureSize,this.baseTextureSize),this.frameSprite=new PIXI.Sprite(this.frameSpriteTexture),this.frameSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.frameSprite),this.frameSpriteMaskTexture=PIXI.RenderTexture.create(this.baseTextureSize,this.baseTextureSize),this.frameSpriteMask=new PIXI.Sprite(this.frameSpriteMaskTexture),this.frameSpriteMask.inverseMask=!0,this.imageContainer.addChild(this.frameSpriteMask),this.frameSprite.mask=this.frameSpriteMask},Gp.prototype.initCaptionGraphic=function(){this.captionGraphic=new PIXI.Graphics,this.imageContainer.addChild(this.captionGraphic)},Gp.prototype.handleBorder=function(){BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER&&this.sourceTexture&&(this.updateDisplay(),this.scale.x=this.scale.y=this.sourceTexture.height/this.imageContainerHeight,this.updateSmoothing(),this.itemWidth=Math.round(this.imageContainerWidth*this.scale.x)-2,this.itemHeight=Math.round(this.imageContainerHeight*this.scale.y)-2,BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED))},Gp.prototype.setSourceTexture=function(e){if(this.sourceTexture&&!e&&(this.resetTexture(this.matteSpriteTexture),this.resetTexture(this.sourceSpriteMaskTexture),this.resetTexture(this.frameSpriteTexture),this.resetTexture(this.frameSpriteMaskTexture)),null!==this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),e){this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2);var t=BFN.Util.getThumbTexture(this.sourceTexture,64),i=BFN.Util.isTransparent(t);t.destroyGC(!0),UITools.toggleControlItem("frame_border_matte_color",i),UITools.setToolValue("frame_border","outer_color","000000"),UITools.setToolValue("frame_border","inner_color","FFFFFF"),UITools.setToolValue("frame_border","matte_color",-1),UITools.setToolValue("frame_border","outer_thickness",50),UITools.setToolValue("frame_border","inner_thickness",50),UITools.setToolValue("frame_border","corner_radius",0),UITools.setToolValue("frame_border","caption_space",0),UITools.updateToolControls("frame_border"),UITools.applyTool("frame_border")}},Gp.prototype.updateDisplay=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER&&this.sourceTexture){var e=UITools.getToolVO("frame_border"),t=-1===e.outer_color?-1:parseInt("0x"+e.outer_color),i=-1===e.inner_color?0:parseInt("0xFF"+e.inner_color),r=-1===e.matte_color?0:parseInt("0xFF"+e.matte_color),a=e.outer_thickness/100,n=e.inner_thickness/100,o=e.corner_radius/100,s=e.caption_space/100,l=this.sourceTexture.width,h=this.sourceTexture.height,c=Math.min(l,h),u=Math.round(a*c/8),d=Math.round(n*c/8),m=Math.round(l+2*(u+d)),p=Math.round(h+2*(u+d)),g=Math.round(s*c),f=(c/2+d)*o,v=c/2*o,y=Math.min(1,BFN.maxImageSize/Math.max(m,p)),x=Math.min(BFN.maxImageSize,Math.round(m*y)),_=Math.min(BFN.maxImageSize,Math.round(p*y)),I=x/m,T=_/p;this.imageContainerWidth=m,this.imageContainerHeight=p+g,this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageContainer.scale.x=1,this.imageContainer.scale.y=1,this.sourceSprite.x=this.sourceSprite.y=u+d,this.setTextureSize(this.matteSpriteTexture,x,_),this.setSpriteScale(this.matteSprite,1/I,1/T),BFN.graphics.drawShape("roundedRect",this.matteSpriteTexture,{fillColor:r,cornerRadius:Math.max(1,v*y),edgePadding:0,padding:(u+d)*y}),this.setTextureSize(this.sourceSpriteMaskTexture,x,_),this.setSpriteScale(this.sourceSpriteMask,1/I,1/T),BFN.graphics.drawShape("roundedRect",this.sourceSpriteMaskTexture,{fillColor:4294967295,cornerRadius:Math.max(1,v*y),edgePadding:0,padding:(u+d)*y}),this.setTextureSize(this.frameSpriteTexture,x,_),this.setSpriteScale(this.frameSprite,1/I,1/T),BFN.graphics.drawShape("roundedRect",this.frameSpriteTexture,{fillColor:d>0?i:0,cornerRadius:Math.max(1,f*y),edgePadding:0,padding:u*y,backgroundColor:t}),this.setTextureSize(this.frameSpriteMaskTexture,x,_),this.setSpriteScale(this.frameSpriteMask,1/I,1/T),BFN.graphics.drawShape("roundedRect",this.frameSpriteMaskTexture,{fillColor:4294967295,cornerRadius:Math.max(1,(-1!==e.inner_color?v:f)*y),edgePadding:0,padding:u*y+(-1!==e.inner_color?d*y+(u+d>0?1:0):u+o>0?1:0)}),this.captionGraphic.clear(),g>0&&-1!==t&&(this.captionGraphic.beginFill(t,1),this.captionGraphic.drawRect(0,p,m,g),this.captionGraphic.endFill())}},Gp.prototype.updateSmoothing=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER&&this.sourceTexture&&(this.setSpriteSmoothing(this.matteSprite,e),this.setSpriteSmoothing(this.sourceSprite,e),this.setSpriteSmoothing(this.frameSprite,e))},Gp.prototype.resetTexture=function(e){e.width===this.baseTextureSize&&e.height===this.baseTextureSize||(e.resize(this.baseTextureSize,this.baseTextureSize),e.clear())},Gp.prototype.setTextureSize=function(e,t,i){e.width===t&&e.height===i||e.resize(t,i)},Gp.prototype.setSpriteScale=function(e,t,i){e.scale.x=t,e.scale.y=i},Gp.prototype.setSpriteSmoothing=function(e,t){e.currentScale=e.scale.x*this.imageContainer.scale.x*(t?1:this._scale*this.scale.x),e.currentScaleY=e.scale.y*this.imageContainer.scale.y*(t?1:this._scale*this.scale.y)},Object.defineProperty(Gp.prototype,"toolScale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(Gp.prototype,"modifiedTexture",{get:function(){var e=Math.min(1,BFN.maxImageSize/Math.max(this.imageContainerWidth,this.imageContainerHeight)),t=Math.min(BFN.maxImageSize,Math.round(this.imageContainerWidth*e)),i=Math.min(BFN.maxImageSize,Math.round(this.imageContainerHeight*e));this.imageContainer.x=this.imageContainer.y=0,this.imageContainer.scale.x=t/this.imageContainerWidth,this.imageContainer.scale.y=i/this.imageContainerHeight,this.updateSmoothing(!0);var r=PIXI.RenderTexture.create(t,i);return BFN.Stage.render(this.imageContainer,r),this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageContainer.scale.x=this.imageContainer.scale.y=1,this.updateSmoothing(),r}}),Object.defineProperty(BFN,"ImageBorder",{get:function(){return!BFN._ImageBorder&&(BFN._ImageBorder=new Gp),BFN._ImageBorder}}),Hp.prototype=Object.create(PIXI.Sprite.prototype),Hp.prototype.init=function(){BeFunky.log("ImageDropShadow Init"),this.initDefaultValues(),this.initImageContainer(),this.initBackground(),this.initBlurSprite(),this.initShadowSprite(),this.initSourceSprite(),this.initMaskSprite()},Hp.prototype.initDefaultValues=function(){this._scale=1,this.shadowMapSize=1024,this.imageContainerWidth=0,this.imageContainerHeight=0,this.renderPending=!1,this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},Hp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Hp.prototype.initBackground=function(){this.background=new PIXI.Graphics,this.imageContainer.addChild(this.background)},Hp.prototype.initBlurSprite=function(){this.invertChannelFilter=new BFN.filters.InvertChannelFilter,this.directionalBlurFilter=new BFN.filters.DirectionalBlurFilter,this.directionalBlurFilter.blendAlpha=!0,this.directionalBlurFilter.iterations=4,this.directionalBlurFilter.biDirectional=!0,this.blurredTexture=null,this.blurTexture=null,this.blurSprite=new PIXI.Sprite},Hp.prototype.initShadowSprite=function(){this.shadowTexture=null,this.shadowSprite=new PIXI.Sprite,this.shadowSprite.pluginName="blend_picture",this.imageContainer.addChild(this.shadowSprite)},Hp.prototype.initSourceSprite=function(){this.sourceTexture=null,this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="blend_picture",this.imageContainer.addChild(this.sourceSprite)},Hp.prototype.initMaskSprite=function(){this.maskTexture=null,this.maskSprite=new PIXI.Sprite,this.imageContainer.addChild(this.maskSprite)},Hp.prototype.handleDropShadow=function(){BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW&&this.sourceTexture&&(this.renderPending||(this.renderPending=!0,BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)),BFN.MainUI.requestRender())},Hp.prototype.setSourceTexture=function(e){if(null!==this.blurredTexture&&(this.blurredTexture.destroyGC(!0),this.blurredTexture=null),null!==this.blurTexture&&(this.blurTexture.destroyGC(!0),this.blurTexture=null,this.blurSprite.texture=PIXI.Texture.EMPTY),null!==this.shadowTexture&&(this.shadowTexture.destroyGC(!0),this.shadowTexture=null,this.shadowSprite.texture=PIXI.Texture.EMPTY,this.shadowSprite.mask=null),null!==this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!==this.maskTexture&&(this.maskTexture.destroyGC(!0),this.maskTexture=null,this.maskSprite.texture=PIXI.Texture.EMPTY),e){this.sourceTexture=e,this.sourceSprite.texture=e,this.sourceW=this.sourceTexture.width,this.sourceH=this.sourceTexture.height,this.maxBlurRadius=Math.ceil(Math.sqrt(Math.pow(this.sourceW,2)+Math.pow(this.sourceH,2))/8);var t=Math.max(this.sourceW,this.sourceH);this.filterScaleFactor=this.shadowMapSize/(t+2*this.maxBlurRadius),this.filterMaxBlurRadius=Math.ceil(this.maxBlurRadius*this.filterScaleFactor);var i=this.shadowMapSize-2*this.filterMaxBlurRadius;this.filterScaleFactor=i/t,this.scaledSourceW=Math.round(this.sourceW*this.filterScaleFactor),this.scaledSourceH=Math.round(this.sourceH*this.filterScaleFactor),this.shadowMapW=Math.min(this.shadowMapSize,Math.round(this.scaledSourceW+2*this.filterMaxBlurRadius)),this.shadowMapH=Math.min(this.shadowMapSize,Math.round(this.scaledSourceH+2*this.filterMaxBlurRadius)),this.directionalBlurFilter.setDimensions(this.shadowMapW,this.shadowMapH,this.filterMaxBlurRadius),this.blurredTexture=PIXI.RenderTexture.create(this.shadowMapW,this.shadowMapH),this.blurTexture=PIXI.RenderTexture.create(this.shadowMapW,this.shadowMapH),this.blurTexture.copyPixels(this.sourceTexture,{x:this.filterMaxBlurRadius,y:this.filterMaxBlurRadius},!1,1,{x:this.scaledSourceW/this.sourceW,y:this.scaledSourceH/this.sourceH}),this.blurSprite.texture=this.blurTexture,this.blurSprite.filters=[this.directionalBlurFilter],this.maskTexture=this.sourceTexture.renderClone(),this.maskTexture.convertAlphaToLuma(),this.maskSprite.texture=this.maskTexture,this.maskSprite.visible=!1,this.imageContainer.x=-this.sourceW/2,this.imageContainer.y=-this.sourceH/2,this.shadowTexture=PIXI.RenderTexture.create(this.scaledSourceW,this.scaledSourceH),this.shadowSprite.texture=this.shadowTexture,this.shadowSprite.scale.x=this.shadowSprite.scale.y=1/this.filterScaleFactor,this.imageContainer.addChildAt(this.shadowSprite,1),this.sourceSprite.texture=this.sourceTexture;var r=UITools.getToolVO("frame_drop_shadow");for(var a in r.defaultValues)UITools.setToolValue("frame_drop_shadow",a,r.defaultValues[a]);UITools.updateToolControls("frame_drop_shadow"),UITools.applyTool("frame_drop_shadow"),this.updateDisplay(!0)}},Hp.prototype.updateDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW&&this.sourceTexture){var t=UITools.getToolVO("frame_drop_shadow"),i=t.size/100,r=t.density/100,a=t.distance/100,n=t.angle*(Math.PI/180),o=Math.round(i*this.filterMaxBlurRadius),s="inner"===t.type,l=Math.round(o/this.filterScaleFactor),h=this.sourceW+2*l,c=this.sourceH+2*l,u=this.filterMaxBlurRadius/this.filterScaleFactor*a,d=Math.round(Math.cos(n)*u),m=Math.round(Math.sin(n)*u);if(this.imageContainerWidth=s?this.sourceW:h+Math.abs(Math.min(0,l-Math.abs(d))),this.imageContainerHeight=s?this.sourceH:c+Math.abs(Math.min(0,l-Math.abs(m))),this.itemWidth=this.imageContainerWidth,this.itemHeight=this.imageContainerHeight,e)return;if(s&&this.shadowSprite.mask!==this.maskSprite?(this.maskSprite.visible=!0,this.shadowSprite.mask=this.maskSprite,this.imageContainer.addChildAt(this.sourceSprite,1)):!s&&this.shadowSprite.mask&&(this.maskSprite.visible=!1,this.shadowSprite.mask=null,this.imageContainer.addChildAt(this.shadowSprite,1)),this.imageContainer.x=-this.imageContainerWidth/2,this.imageContainer.y=-this.imageContainerHeight/2,this.sourceSprite.x=s?0:Math.max(0,(h-this.sourceW)/2-d),this.sourceSprite.y=s?0:Math.max(0,(c-this.sourceH)/2-m),this.shadowSprite.x=s?0:this.sourceSprite.x+d-l,this.shadowSprite.y=s?0:this.sourceSprite.y+m-l,this.shadowSprite.alpha=t.opacity/100,this.shadowSprite.fillColor=parseInt("0x"+t.shadow_color),this.shadowSprite.intensity=1,this.maskSprite.x=this.sourceSprite.x,this.maskSprite.y=this.sourceSprite.y,this.background.clear(),-1!==t.background_color&&(this.background.beginFill("0x"+t.background_color,1),this.background.drawRect(0,0,this.imageContainerWidth,this.imageContainerHeight),this.background.endFill()),this.directionalBlurFilter.amount=i,this.directionalBlurFilter.alphaChoke=r,this.blurSprite.filters=s?[this.invertChannelFilter,this.directionalBlurFilter]:[this.directionalBlurFilter],BFN.Stage.render(this.blurSprite,this.blurredTexture),s)this.shadowTexture.width===this.scaledSourceW&&this.shadowTexture.height===this.scaledSourceH||this.shadowTexture.resize(this.scaledSourceW,this.scaledSourceH),this.shadowTexture.copyPixels(this.blurredTexture,{x:Math.round(d*this.filterScaleFactor)-this.filterMaxBlurRadius,y:Math.round(m*this.filterScaleFactor)-this.filterMaxBlurRadius});else{var p=this.scaledSourceW+2*o,g=this.scaledSourceH+2*o;this.shadowTexture.width===p&&this.shadowTexture.height===g||this.shadowTexture.resize(p,g),this.shadowTexture.copyPixels(this.blurredTexture,{x:o-this.filterMaxBlurRadius,y:o-this.filterMaxBlurRadius})}this.setSmoothingScale(this._scale),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED)}},Hp.prototype.setSmoothingScale=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.sourceSprite.currentScale=e*this.sourceSprite.scale.y*(t?this.scale.y:1),this.shadowSprite.currentScale=e*this.shadowSprite.scale.y*(t?this.scale.y:1)},Hp.prototype.handleMainUIPreRender=function(e){this.renderPending=!1,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.updateDisplay()},Object.defineProperty(Hp.prototype,"toolScale",{set:function(e){this._scale=e,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Hp.prototype,"modifiedTexture",{get:function(){var e=Math.min(1,BFN.maxImageSize/this.imageContainerWidth,BFN.maxImageSize/this.imageContainerHeight),t=Math.min(BFN.maxImageSize,Math.floor(this.imageContainerWidth*e)),i=Math.min(BFN.maxImageSize,Math.floor(this.imageContainerHeight*e)),r=PIXI.RenderTexture.create(t,i),a=this.imageContainer.x,n=this.imageContainer.y;return this.imageContainer.x=0,this.imageContainer.y=0,this.imageContainer.scale.x=t/this.imageContainerWidth,this.imageContainer.scale.y=i/this.imageContainerHeight,this.setSmoothingScale(e,!1),BFN.Stage.render(this.imageContainer,r),this.imageContainer.x=a,this.imageContainer.y=n,this.imageContainer.scale.x=1,this.imageContainer.scale.y=1,this.setSmoothingScale(this._scale),r}}),Object.defineProperty(BFN,"ImageDropShadow",{get:function(){return!BFN._ImageDropShadow&&(BFN._ImageDropShadow=new Hp),BFN._ImageDropShadow}}),zp.prototype=Object.create(PIXI.Sprite.prototype),zp.prototype.init=function(){BeFunky.log("ImageFrame Init"),this.initDefaultValues(),this.initDisplay()},zp.prototype.initDefaultValues=function(){this.sourceTexture=null,this.currentFrameID=null,this.currentFrameName=null,this._scale=1,this.adjustScale=1,this.itemWidth=this.imageContainerWidth=0,this.itemHeight=this.imageContainerHeight=0,this.tiltAngle=0,this.backgroundColor=-1,this.handleFrameDisplayFrameLoadedBind=this.handleFrameDisplayFrameLoaded.bind(this),this.handleFrameDisplayFrameUpdatedBind=this.handleFrameDisplayFrameUpdated.bind(this)},zp.prototype.initDisplay=function(){this.canvas=new PIXI.Container,this.addChild(this.canvas),this.imageContainer=new PIXI.Container,this.canvas.addChild(this.imageContainer),this.imageBackground=new PIXI.Graphics,this.imageContainer.addChild(this.imageBackground),this.imageCenterContainer=new PIXI.Container,this.imageContainer.addChild(this.imageCenterContainer),this.frameDisplay=new BFN.FrameDisplay,this.frameDisplay.addEventListener(BFN.FrameDisplayEvents.FRAME_UPDATED.type,this.handleFrameDisplayFrameUpdatedBind),this.imageCenterContainer.addChild(this.frameDisplay)},zp.prototype.handleFrameCropRotateGeneric=function(){var e=UITools.getToolVO("frame_crop_rotate_generic");switch(e.updating_id){case"rotate_counter_clockwise":this.frameDisplay.rotateCounterClockwise();break;case"rotate_clockwise":this.frameDisplay.rotateClockwise();break;case"flip_horizontal":this.frameDisplay.flipHorizontal();break;case"flip_vertical":this.frameDisplay.flipVertical();break;case"background_color":this.backgroundColor=-1==e.background_color?-1:parseInt("0x"+e.background_color),this.tiltFrame(this.tiltAngle);break;case"tilt":this.tiltFrame(e.tilt)}this.frameDisplay.setPosition(e.position/100)},zp.prototype.handleFrameCropGeneric=function(){var e=UITools.getToolVO("frame_crop_generic");switch(e.updating_id){case"rotate_counter_clockwise":this.frameDisplay.rotateCounterClockwise();break;case"rotate_clockwise":this.frameDisplay.rotateClockwise();break;case"flip_horizontal":this.frameDisplay.flipHorizontal();break;case"flip_vertical":this.frameDisplay.flipVertical()}this.frameDisplay.setPosition(e.position/100)},zp.prototype.handleFrameFullGeneric=function(){var e=UITools.getToolVO("frame_full_generic");switch(e.updating_id){case"rotate_counter_clockwise":this.frameDisplay.rotateCounterClockwise();break;case"rotate_clockwise":this.frameDisplay.rotateClockwise();break;case"flip_horizontal":this.frameDisplay.flipHorizontal();break;case"flip_vertical":this.frameDisplay.flipVertical();break;case"blend_mode":requestAnimationFrame(function(){BFN.MainUI.requestRender()})}this.frameDisplay.setColor(-1==e.color_overlay?-1:parseInt("0x"+e.color_overlay),e.color_overlay_intensity),this.frameDisplay.setBlendMode(e.blend_mode),this.frameDisplay.setPosition(e.position/100),this.frameDisplay.setOpacity(e.opacity/100)},zp.prototype.handleUpdateTool=function(e){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME&&this.currentFrameID!=e){var t=UITools.getToolVO(e);this.currentFrameID=e,this.currentFrameName=t.hasOwnProperty("frameName")?t.frameName:"Frame";var i=BFN.imagesURL+"app/frames/"+t.texture_category+"/png/images/"+t.texture+".png";this.frameDisplay.addEventListener(BFN.FrameDisplayEvents.FRAME_LOADED.type,this.handleFrameDisplayFrameLoadedBind),this.frameDisplay.setupFrame(this.sourceTexture,i,t.texture_data,100,100,BFN.maxImageSize,BFN.maxImageSize),this.resetFrameDisplay(),UIToggler.toggleLoadScreen(!0),this.itemWidth=this.frameDisplay.itemWidth,this.itemHeight=this.frameDisplay.itemHeight,this.imageContainer.x=-Math.round(this.itemWidth/2),this.imageContainer.y=-Math.round(this.itemHeight/2),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED);var r=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),a=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME,BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME,BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME);r.dispatchEvent(a);var n=t.hasOwnProperty("blendMode")?t.blendMode:BFN.CONST.BLEND_MODES.NORMAL;switch(t.frame_type){case"crop_rotate":UITools.setToolValue("frame_crop_rotate_generic","blend_mode",n),UITools.updateToolControls("frame_crop_rotate_generic"),this.handleFrameCropRotateGeneric();break;case"crop":UITools.setToolValue("frame_crop_generic","blend_mode",n),UITools.updateToolControls("frame_crop_generic"),this.handleFrameCropGeneric();break;case"full":UITools.setToolValue("frame_full_generic","blend_mode",n),UITools.updateToolControls("frame_full_generic"),this.handleFrameFullGeneric()}this.canvas.scale.x=this.canvas.scale.y=this.adjustScale=Math.min(1,this.frameDisplay.itemHeight/this.imageContainerHeight),this.itemWidth=Math.max(0,Math.round(this.imageContainerWidth*this.canvas.scale.x)-2),this.itemHeight=Math.max(0,Math.round(this.imageContainerHeight*this.canvas.scale.y)-2),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()}},zp.prototype.tiltFrame=function(e){this.tiltAngle=e;var t=Math.abs(e*(Math.PI/180)),i=this.frameDisplay.itemWidth,r=this.frameDisplay.itemHeight;this.imageContainerWidth=Math.max(0,Math.cos(t)*i+Math.sin(t)*r),this.imageContainerHeight=Math.max(0,Math.cos(t)*r+Math.sin(t)*i),this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageCenterContainer.x=-this.imageContainer.x,this.imageCenterContainer.y=-this.imageContainer.y,this.imageCenterContainer.rotation=e*(Math.PI/180),this.frameDisplay.x=-this.frameDisplay.itemWidth/2,this.frameDisplay.y=-this.frameDisplay.itemHeight/2,this.imageBackground.clear(),-1!=this.backgroundColor?this.imageBackground.beginFill(this.backgroundColor):this.imageBackground.beginFill(0,0),this.imageBackground.drawRect(0,0,this.imageContainerWidth,this.imageContainerHeight),this.imageBackground.endFill(),this.canvas.scale.x=this.canvas.scale.y=this.adjustScale=Math.min(1,this.frameDisplay.itemHeight/this.imageContainerHeight),this.itemWidth=Math.max(0,Math.round(this.imageContainerWidth*this.canvas.scale.x)-2),this.itemHeight=Math.max(0,Math.round(this.imageContainerHeight*this.canvas.scale.y)-2),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()},zp.prototype.resetFrameDisplay=function(){UITools.setToolValue("frame_crop_rotate_generic","background_color",-1),UITools.setToolValue("frame_crop_rotate_generic","position",0),UITools.setToolValue("frame_crop_rotate_generic","tilt",0),UITools.updateToolControls("frame_crop_rotate_generic"),UITools.setToolValue("frame_crop_generic","position",0),UITools.updateToolControls("frame_crop_generic"),UITools.setToolValue("frame_full_generic","color_overlay",-1),UITools.setToolValue("frame_full_generic","color_overlay_intensity",1),UITools.setToolValue("frame_full_generic","blend_mode",BFN.CONST.BLEND_MODES.NORMAL),UITools.setToolValue("frame_full_generic","position",0),UITools.setToolValue("frame_full_generic","opacity",100),UITools.updateToolControls("frame_full_generic"),this.frameDisplay.resetFrame(),this.tiltAngle=0,this.backgroundColor=-1,this.tiltFrame(this.tiltAngle)},zp.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null),e?this.sourceTexture=e:this.currentFrameID=null},zp.prototype.handleFrameDisplayFrameLoaded=function(e){this.frameDisplay.removeEventListener(BFN.FrameDisplayEvents.FRAME_LOADED.type,this.handleFrameDisplayFrameLoadedBind),UIToggler.toggleLoadScreen(!1)},zp.prototype.handleFrameDisplayFrameUpdated=function(e){this.imageContainer.x=-Math.round(this.itemWidth/2),this.imageContainer.y=-Math.round(this.itemHeight/2),this.tiltFrame(this.tiltAngle)},Object.defineProperty(zp.prototype,"toolScale",{set:function(e){this._scale=e,this.frameDisplay.canvasScale=e},get:function(){return this._scale}}),Object.defineProperty(zp.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.floor(this.imageContainerWidth),Math.floor(this.imageContainerHeight));return this.canvas.x=Math.floor(e.width/2),this.canvas.y=Math.floor(e.height/2),this.canvas.scale.x=this.canvas.scale.y=this.adjustScale=1,this.frameDisplay.canvasScale=1,this.removeChild(this.canvas),BFN.Stage.render(this.canvas,e),this.addChild(this.canvas),this.canvas.x=this.canvas.y=0,this.canvas.scale.x=this.canvas.scale.y=this.adjustScale=Math.min(1,this.frameDisplay.itemHeight/this.imageContainerHeight),this.frameDisplay.canvasScale=this._scale,e}}),Object.defineProperty(BFN,"ImageFrame",{get:function(){return!BFN._ImageFrame&&(BFN._ImageFrame=new zp),BFN._ImageFrame}}),Xp.prototype=Object.create(PIXI.Sprite.prototype),Xp.prototype.init=function(){BeFunky.log("ImageTexture Init"),this.initDefaultValues(),this.initTexture(),this.initImageContainer(),this.initSourceSprite(),this.initBlendModeSprite(),this.initMaskSprite(),this.initPainter()},Xp.prototype.initDefaultValues=function(){this.sourceTexture=null,this.textureTexture=null,this.currentTextureID=null,this.currentTextureName=null,this._scale=1},Xp.prototype.initTexture=function(){this.textureContainer=new PIXI.Container,this.textureCenterContainer=new PIXI.Container,this.textureContainer.addChild(this.textureCenterContainer),this.textureSprite=new PIXI.Sprite,this.textureCenterContainer.addChild(this.textureSprite)},Xp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Xp.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Xp.prototype.initBlendModeSprite=function(){this.blendModeSprite=new BFN.BlendModeSprite(!1),this.blendModeSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.blendModeSprite)},Xp.prototype.initMaskSprite=function(){this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.maskSprite.interactive=!1,this.imageContainer.addChild(this.maskSprite)},Xp.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.paintingEnabled=!1,this.painter.delaySetupTillPaintingEnabled=!0,this.painter.renderable=!1,this.imageContainer.addChild(this.painter),this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED.type,this.handlePainterPaintAppliedUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED.type,this.handlePainterPaintingEnabledUpdated.bind(this))},Xp.prototype.handleTextureGeneric=function(){var e=UITools.getToolVO("texture_generic");switch(this.blendModeSprite.setBlendMode(e.blend_mode),this.blendModeSprite.setBlendIntensity(e.opacity),e.updating_id){case"rotate_counter_clockwise":e.rotate_counter_clockwise&&(this.textureCenterContainer.rotation-=Math.PI/2,this.updateTextureTransform());break;case"rotate_clockwise":e.rotate_clockwise&&(this.textureCenterContainer.rotation+=Math.PI/2,this.updateTextureTransform());break;case"flip_horizontal":e.flip_horizontal&&(Math.abs(this.textureCenterContainer.rotation%Math.PI)?(this.textureSprite.y*=-1,this.textureSprite.scale.y*=-1):(this.textureSprite.x*=-1,this.textureSprite.scale.x*=-1),this.updateTextureTransform());break;case"flip_vertical":e.flip_vertical&&(Math.abs(this.textureCenterContainer.rotation%Math.PI)?(this.textureSprite.x*=-1,this.textureSprite.scale.x*=-1):(this.textureSprite.y*=-1,this.textureSprite.scale.y*=-1),this.updateTextureTransform())}},Xp.prototype.handleTextureBrush=function(){this.updateTextureBrushParameters()},Xp.prototype.handleUpdateTool=function(e){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE){var t=UITools.getToolVO(e);if(UITools.setToolValue("texture_generic","opacity",t.alpha),UITools.setToolValue("texture_generic","blend_mode",t.blendMode),UITools.updateToolControls("texture_generic"),this.currentTextureID!=e){this.currentTextureID=e,this.currentTextureName=t.hasOwnProperty("textureName")?t.textureName:"Texture";var i=new Image;i.setAttribute("crossOrigin","Anonymous"),i.onload=function(){BFN.ImageTexture.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this))),UIToggler.toggleLoadScreen(!1)},i.src=BFN.remoteImagesURL+"app/texturemodel/original/"+t.texture,UIToggler.toggleLoadScreen(!0)}}},Xp.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.textureTexture&&(this.textureTexture.destroyGC(!0),this.textureTexture=null),this.blendModeSprite.autoRender=!1,e?(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.maskSprite.width=this.sourceTexture.width,this.maskSprite.height=this.sourceTexture.height,this.textureTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),BFN.Stage.render(new PIXI.Container,this.textureTexture),this.textureCenterContainer.x=this.textureTexture.width/2,this.textureCenterContainer.y=this.textureTexture.height/2,this.blendModeSprite.autoRender=!0,this.blendModeSprite.setBlendMode(null),this.blendModeSprite.setBaseTexture(this.sourceTexture),this.blendModeSprite.setBlendTexture(this.textureTexture),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.inverse=!1,this.updateMaskDisplay(),UITools.setToolValue("texture_brush","show_mask",!1),UITools.setToolValue("texture_brush","select_action","subtract"),UITools.updateToolControls("texture_brush"),this.updateTextureBrushParameters()):(this.currentTextureID=null,this.sourceSprite.mask=null,this.blendModeSprite.mask=null,this.painter.reset(),BFN.FilterHelper.emptyPoolForFilter())},Xp.prototype.setTexture=function(e){try{this.textureSprite.texture.destroyGC(!0),this.textureSprite.texture=null}catch(e){}e&&(this.textureSprite.rotation=0,this.textureSprite.scale.x=this.textureSprite.scale.y=1,this.textureSprite.texture=e,this.textureSprite.x=-this.textureSprite.texture.width/2,this.textureSprite.y=-this.textureSprite.texture.height/2,this.updateTextureTransform(),this.handleTextureGeneric())},Xp.prototype.updateTextureTransform=function(){if(this.textureTexture&&this.textureSprite.texture){var e=this.textureTexture.width,t=this.textureTexture.height,i=Math.abs(this.textureCenterContainer.rotation%Math.PI)?this.textureSprite.texture.height:this.textureSprite.texture.width,r=Math.abs(this.textureCenterContainer.rotation%Math.PI)?this.textureSprite.texture.width:this.textureSprite.texture.height,a=Math.max(e/i,t/r);this.textureCenterContainer.scale.x=this.textureCenterContainer.scale.y=a,BFN.Stage.render(this.textureContainer,this.textureTexture),this.blendModeSprite.updateDisplay()}},Xp.prototype.updateTextureBrushParameters=function(){var e=UITools.getToolVO("texture_brush");if(e){if("isolate_subject"===e.updating_id&&!e.updating)return this.sourceTexture.altTexture=this.blendModeSprite.texture,this.sourceTexture.altTextureInverse=!1,void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,this.inverse,()=>{delete this.sourceTexture.altTexture,delete this.sourceTexture.altTextureInverse});e.clear&&(this.painter.clear(!0),UITools.setToolValue("texture_brush","erase",!1),UITools.updateToolControl("texture_brush_erase"),this.inverse&&(this.inverse=!1,this.updateMaskDisplay())),this.showMask!==e.show_mask&&(this.showMask=e.show_mask,this.updateMaskDisplay()),"invert"===e.updating_id&&(this.inverse=!this.inverse,this.updateMaskDisplay());var t="subtract"===e.select_action?this.inverse:!this.inverse;this.painter.eraseMode!=t&&(this.painter.eraseMode=t),e.updating&&"size"==e.updating_id&&this.painter.brushSizeFactor!=e.size/100&&(this.painter.brushSizeFactor=e.size/100);var i=!1;e.updating||"size"!=e.updating_id&&this.painter.brushSizeFactor==e.size/100||(this.painter.brushSizeFactor=e.size/100,i=!0),e.updating||"hardness"!=e.updating_id&&this.painter.brushHardnessFactor==e.hardness/100||(this.painter.brushHardnessFactor=e.hardness/100,this.painter.updateBrush()),e.updating||"strength"!=e.updating_id&&this.painter.brushStrengthFactor==e.strength/100||(this.painter.brushStrengthFactor=e.strength/100,this.painter.updateBrush()),i&&this.painter.updateBrush()}},Xp.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=!!(null===e?this.showMask:e),this.blendModeSprite.visible=!(e||this.inverse&&!this.painter.paintApplied),this.maskSprite.visible=e&&!(this.inverse&&!this.painter.paintApplied);var t=this.painter.isSetup&&this.painter.paintApplied?this.painter:null;this.blendModeSprite.mask!==t&&(this.blendModeSprite.mask=t),this.maskSprite.mask!==t&&(this.maskSprite.mask=t),this.painter.renderable=!1,BFN.MainUI.requestRender()},Xp.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.blendModeSprite.currentScale=e,this.painter.currentScale=e},Xp.prototype.handlePainterPaintAppliedUpdated=function(e){this.updateMaskDisplay()},Xp.prototype.handlePainterPaintingEnabledUpdated=function(){this.painter.isSetup&&!this.painter.paintingEnabled&&this.showMask&&(UITools.setToolValue("texture_brush","show_mask",!1),UITools.updateToolControl("texture_brush_show_mask"),this.showMask=UITools.getToolValue("texture_brush","show_mask"),this.updateMaskDisplay())},Object.defineProperty(Xp.prototype,"inverse",{set:function(e){this._inverse=e,this.painter.inverseMask=!this._inverse,BFN.MainUI.requestRender()},get:function(){return this._inverse}}),Object.defineProperty(Xp.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Xp.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=0,this.imageContainer.y=0,this.setSmoothingScale(1),this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.updateMaskDisplay(),e}}),Object.defineProperty(BFN,"ImageTexture",{get:function(){return!BFN._ImageTexture&&(BFN._ImageTexture=new Xp),BFN._ImageTexture}}),jp.prototype=Object.create(PIXI.Sprite.prototype),jp.prototype.init=function(){BeFunky.log("ImageOverlay Init"),this.initDefaultValues(),this.initImageContainer(),this.initBackgroundSprite(),this.initWhiteVeil(),this.initOverlaySprite(),this.initOverlayMask(),this.initOverlayPattern(),this.initOverlayPatternMask(),this.initShadowContainer(),this.initShadowSprite(),this.initShadowMask(),this.initShadowPattern(),this.initBlurDisplay(),this.initMaskDragger()},jp.prototype.initDefaultValues=function(){this.currentOverlayID=null,this.currentOverlayName=null,this.sourceTexture=null,this.overlayTextureSource=null,this.overlayTexture=null,this.blurTexture=null,this.shadowTexture=null,this.shadowSourceTexture=null,this.overlayTextureSourceSprite=new PIXI.Sprite,this.overlayTextureSourceSprite.pluginName="smooth_picture",this._scale=1,this.baseScale=1,this.patternMode=!1,this.patternStartOffset=new PIXI.Point,this.blurAmount=0,this.blurUpdating=!1,this.blurPending=!1,this.blurIntervalActive=!1,this.shadowAmount=0,this.shadowUpdating=!1,this.shadowPending=!1,this.shadowIntervalActive=!1,this.eraseFilter=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.ERASE),this.shadowBlurFilter=new BFN.filters.GaussianBlurFilter},jp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.imageContainer.interactive=!0,this.addChild(this.imageContainer)},jp.prototype.initBackgroundSprite=function(){this.backgroundSprite=new PIXI.Sprite,this.backgroundSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.backgroundSprite)},jp.prototype.initWhiteVeil=function(){this.whiteVeil=new PIXI.Graphics,this.imageContainer.addChild(this.whiteVeil)},jp.prototype.initOverlaySprite=function(){this.overlaySprite=new PIXI.Sprite,this.overlaySprite.pluginName="smooth_picture",this.imageContainer.addChild(this.overlaySprite)},jp.prototype.initOverlayMask=function(){this.overlayMask=new PIXI.Sprite,this.overlayMask.anchor.x=this.overlayMask.anchor.y=.5,this.imageContainer.addChild(this.overlayMask)},jp.prototype.initOverlayPattern=function(){this.overlayPatternTexture=PIXI.RenderTexture.create(32,32),this.overlayPatternTexture.clear(),this.overlayPattern=new BFN.TileContainer(this.overlayPatternTexture,32,32)},jp.prototype.initOverlayPatternMask=function(){this.overlayPatternMaskTexture=null,this.overlayPatternMask=new PIXI.Sprite},jp.prototype.initShadowContainer=function(){this.shadowContainer=new PIXI.Container},jp.prototype.initShadowSprite=function(){this.shadowSprite=new PIXI.Sprite,this.shadowSprite.anchor.x=this.shadowSprite.anchor.y=.5,this.shadowSprite.pluginName="blend_picture",this.shadowSprite.currentScale=1,this.shadowContainer.addChild(this.shadowSprite),this.shadowSourceSprite=new PIXI.Sprite},jp.prototype.initShadowMask=function(){this.shadowMask=new PIXI.Sprite,this.shadowMask.anchor.x=this.shadowMask.anchor.y=.5,this.shadowContainer.addChild(this.shadowMask),this.shadowSprite.mask=this.shadowMask},jp.prototype.initShadowPattern=function(){this.shadowPatternTexture=PIXI.RenderTexture.create(32,32),this.shadowPatternTexture.clear(),this.shadowPattern=new BFN.TileContainer(this.shadowPatternTexture,32,32)},jp.prototype.initBlurDisplay=function(){this.blurFilter=new BFN.filters.FastBlurWrapper,this.blurTexture=null,this.blurAmount=1,this.blurSprite=new PIXI.Sprite},jp.prototype.initMaskDragger=function(){this.maskDragger=new BFN.Dragger,this.maskDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleMaskDraggerDraggingStarted.bind(this)),this.maskDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleMaskDraggerDragging.bind(this)),this.imageContainer.on("pointerdown",function(e){this.maskDragger.drag(this.overlayMask),e.stopPropagation()}.bind(this))},jp.prototype.handleOverlayGeneric=function(){var e=UITools.getToolVO("overlay_generic");"reset"==e.updating_id&&(this.overlayMask.x=this.shadowContainer.x=this.maskDragger.bounds.minX+(this.maskDragger.bounds.maxX-this.maskDragger.bounds.minX)/2,this.overlayMask.y=this.shadowContainer.y=this.maskDragger.bounds.minY+(this.maskDragger.bounds.maxY-this.maskDragger.bounds.minY)/2,UITools.setToolValue("overlay_generic","color","FFFFFF"),UITools.setToolValue("overlay_generic","opacity",.9),UITools.setToolValue("overlay_generic","size",1),UITools.setToolValue("overlay_generic","rotation",0),UITools.setToolValue("overlay_generic","blur_amount",0),UITools.setToolValue("overlay_generic","shadow_amount",0),UITools.updateToolControls("overlay_generic"),e=UITools.getToolVO("overlay_generic")),this.whiteVeil.alpha=e.opacity,this.whiteVeil.tint=parseInt("0x"+e.color);var t=(.8*e.size+.2)*this.baseScale,i=e.rotation*(Math.PI/180);this.overlayMask.scale.x=this.overlayMask.scale.y=t,this.overlayMask.rotation=this.patternMode?0:i,this.shadowContainer.scale.x=this.shadowContainer.scale.y=t,this.shadowContainer.rotation=this.patternMode?0:i,this.patternMode&&(this.overlayPattern.rotate(i),this.shadowPattern.rotate(i),"rotation"==e.updating_id&&this.updateOverlayPatternMaskTexture(),"size"==e.updating_id&&this.updatePatternSource()),this.updateOverlaySmoothing(t),this.blurAmount!=e.blur_amount&&(this.blurAmount=e.blur_amount,this.blurPending=!0),this.blurUpdating=!1,"blur_amount"==e.updating_id&&e.updating&&(this.blurUpdating=!0),this.blurUpdating?this.blurIntervalActive||(this.blurIntervalActive=!0,this.applyBlurInterval()):(this.blurIntervalActive=!1,this.blurPending&&this.applyBlur()),this.shadowAmount!=e.shadow_amount&&(this.shadowAmount=e.shadow_amount,this.shadowPending=!0),this.shadowUpdating=!1,"shadow_amount"==e.updating_id&&e.updating&&(this.shadowUpdating=!0),this.shadowUpdating?this.shadowIntervalActive||(this.shadowIntervalActive=!0,this.applyShadowInterval()):(this.shadowIntervalActive=!1,this.shadowPending&&this.applyShadow()),BFN.MainUI.requestRender()},jp.prototype.handleUpdateTool=function(e){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY){var t=UITools.getToolVO(e);this.overlayMask.x=this.shadowContainer.x=this.maskDragger.bounds.minX+(this.maskDragger.bounds.maxX-this.maskDragger.bounds.minX)/2,this.overlayMask.y=this.shadowContainer.y=this.maskDragger.bounds.minY+(this.maskDragger.bounds.maxY-this.maskDragger.bounds.minY)/2,UITools.setToolValue("overlay_generic","color","FFFFFF"),UITools.setToolValue("overlay_generic","opacity",.9),UITools.setToolValue("overlay_generic","size",1),UITools.setToolValue("overlay_generic","rotation",0),UITools.setToolValue("overlay_generic","blur_amount",0),UITools.setToolValue("overlay_generic","shadow_amount",0),UITools.updateToolControls("overlay_generic"),UITools.applyTool("overlay_generic"),this.currentOverlayID!=e&&(this.patternMode=-1!=e.indexOf("patterns_patterns"),this.currentOverlayID=e,this.currentOverlayName=t.overlayName,UIToggler.toggleLoadScreen(!0),BFN.OverlaysItemLoader.load(t.categoryName,t.overlayID,this.handleOverlayLoaded.bind(this),!1))}},jp.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null),null!=this.backgroundTexture&&(this.backgroundTexture.destroyGC(!0),this.backgroundTexture=null,this.backgroundSprite.texture=PIXI.Texture.EMPTY),null!=this.overlayTexture&&(this.overlayTexture.destroyGC(!0),this.overlayTexture=null,this.overlaySprite.texture=PIXI.Texture.EMPTY,this.overlayMask.texture=PIXI.Texture.EMPTY,this.shadowMask.texture=PIXI.Texture.EMPTY),null!=this.blurTexture&&(this.blurTexture.destroyGC(!0),this.blurFilter.dispose(),this.blurTexture=null),null!=this.overlayPatternMaskTexture&&(this.overlayPatternMaskTexture.destroyGC(!0),this.overlayPatternMaskTexture=null,this.overlayPatternMask.texture=PIXI.Texture.EMPTY),null!=this.shadowTexture&&(this.shadowTexture.destroyGC(!0),this.shadowTexture=null,this.shadowSprite.texture=PIXI.Texture.EMPTY),null!=this.shadowSourceTexture&&(this.shadowSourceTexture.destroyGC(!0),this.shadowSourceTexture=null),e?(this.sourceTexture=e,this.overlayPattern.width=this.sourceTexture.width,this.overlayPattern.height=this.sourceTexture.height,this.shadowPattern.width=this.sourceTexture.width,this.shadowPattern.height=this.sourceTexture.height,this.backgroundTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.backgroundSprite.texture=this.backgroundTexture,this.applyBlur(),this.overlaySprite.texture=this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.whiteVeil.clear(),this.whiteVeil.beginFill(16777215,1),this.whiteVeil.drawRect(0,0,this.sourceTexture.width,this.sourceTexture.height),this.whiteVeil.endFill(),this.maskDragger.setBounds(0,0,this.sourceTexture.width,this.sourceTexture.height)):(this.blurFilter.dispose(),this.currentOverlayID=null)},jp.prototype.applyBlurInterval=function(){this.blurPending&&this.applyBlur(),this.blurIntervalActive&&setTimeout(this.applyBlurInterval.bind(this),100)},jp.prototype.applyBlur=function(){var e=this.blurFilter.render(this.blurAmount,this.sourceTexture);this.backgroundTexture.copyPixels(e),this.blurPending=!1,BFN.MainUI.requestRender()},jp.prototype.applyShadowInterval=function(){this.shadowPending&&this.applyShadow(),this.shadowIntervalActive&&setTimeout(this.applyShadowInterval.bind(this),100)},jp.prototype.applyShadow=function(){this.shadowSourceTexture&&this.shadowSourceTexture.width&&this.shadowSourceTexture.height&&this.shadowBlurFilter.setInputDimensions(this.shadowSourceTexture.width,this.shadowSourceTexture.height),this.shadowBlurFilter.blur=this.shadowAmount,this.shadowSourceSprite.filters=[this.shadowBlurFilter],BFN.Stage.render(this.shadowSourceSprite,this.shadowTexture),BFN.Stage.render(this.shadowSourceSprite,this.shadowTexture,!1),this.shadowSprite.visible=this.shadowAmount>0,this.shadowPending=!1,this.patternMode&&BFN.Stage.render(this.shadowContainer,this.shadowPatternTexture),BFN.MainUI.requestRender()},jp.prototype.updatePatternSource=function(){if(this.patternMode){var e=Math.round(this.overlayMask.texture.width*this.overlayMask.scale.x),t=Math.round(this.overlayMask.texture.height*this.overlayMask.scale.y);this.overlayMask.x=e/2,this.overlayMask.y=t/2,this.shadowContainer.x=this.overlayMask.x,this.shadowContainer.y=this.overlayMask.y,this.overlayPatternTexture.resize(e,t),BFN.Stage.render(this.overlayMask,this.overlayPatternTexture),this.overlayPattern.updateDisplay(),this.updateOverlayPatternMaskTexture(),this.shadowPatternTexture.resize(e,t),BFN.Stage.render(this.shadowContainer,this.shadowPatternTexture),this.shadowPattern.updateDisplay()}},jp.prototype.updateOverlayPatternMaskTexture=function(){BFN.Stage.render(this.overlayPattern,this.overlayPatternMaskTexture)},jp.prototype.updateOverlaySmoothing=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.shadowSprite.currentScale=this.baseScale,this.overlayTextureSource&&this.overlayTexture&&(this.overlayTextureSourceSprite.currentScale=e,BFN.Stage.render(this.overlayTextureSourceSprite,this.overlayTexture))},jp.prototype.setSmoothingScale=function(e){this.backgroundSprite.currentScale=e,this.overlaySprite.currentScale=e},jp.prototype.handleOverlayLoaded=function(e){if(UIToggler.toggleLoadScreen(!1),null!=this.overlayPatternMaskTexture&&(this.overlayPatternMaskTexture.destroyGC(!0),this.overlayPatternMaskTexture=null,this.overlayPatternMask.texture=PIXI.Texture.EMPTY),e){if(this.patternMode){try{this.imageContainer.removeChild(this.overlayMask)}catch(e){}try{this.imageContainer.removeChild(this.shadowContainer)}catch(e){}this.overlayPattern.offset(0,0),this.shadowPattern.offset(0,0),this.overlayPatternMaskTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.overlayPatternMaskTexture.clear(),this.overlayPatternMask.texture=this.overlayPatternMaskTexture,this.imageContainer.addChild(this.overlayPatternMask),this.imageContainer.addChild(this.shadowPattern),this.overlaySprite.mask=this.overlayPatternMask}else{try{this.imageContainer.removeChild(this.overlayPatternMask)}catch(e){}try{this.imageContainer.removeChild(this.shadowPattern)}catch(e){}this.imageContainer.addChild(this.overlayMask),this.imageContainer.addChild(this.shadowContainer),this.overlaySprite.mask=this.overlayMask}this.maskDragger.autoDrag=!this.patternMode,this.maskDragger.useBounds=!this.patternMode,null!=this.overlayTextureSource&&(this.overlayTextureSource.destroyGC(!0),this.overlayTextureSource=null),null!=this.overlayTexture&&(this.overlayTexture.destroyGC(!0),this.overlayTexture=null),null!=this.shadowTexture&&(this.shadowTexture.destroyGC(!0),this.shadowTexture=null),null!=this.shadowSourceTexture&&(this.shadowSourceTexture.destroyGC(!0),this.shadowSourceTexture=null),this.overlayTextureSource=e,this.overlayTextureSourceSprite.texture=this.overlayTextureSource,this.overlayTexture=this.overlayTextureSource.renderClone(),this.overlayMask.texture=this.overlayTexture,this.shadowMask.texture=this.overlayTexture;var t=this.overlayTexture.width+32,i=this.overlayTexture.height+32,r=PIXI.RenderTexture.create(t,i);r.fillRect(0,0,t,i,0,1);var a=r.renderClone();a.copyPixels(this.overlayTexture,{x:16,y:16},!0,1,1),this.eraseFilter.iChannel1=a,this.shadowSourceSprite.texture=r,this.shadowSourceSprite.filters=[this.eraseFilter],this.shadowSourceTexture=r.renderClone(),BFN.Stage.render(this.shadowSourceSprite,this.shadowSourceTexture),r.destroyGC(!0),this.eraseFilter.iChannel1=null,a.destroyGC(!0),this.shadowSourceSprite.texture=this.shadowSourceTexture,this.shadowTexture=this.shadowSourceTexture.renderClone(),this.shadowSprite.texture=this.shadowTexture,this.applyShadow(),this.sourceTexture&&(this.baseScale=.9*Math.min(this.sourceTexture.width/this.overlayTexture.width,this.sourceTexture.height/this.overlayTexture.height),this.overlayMask.scale.x=this.overlayMask.scale.y=this.baseScale,this.shadowContainer.scale.x=this.shadowContainer.scale.y=this.baseScale,this.patternMode?this.updatePatternSource():(this.overlayMask.x=this.sourceTexture.width/2,this.overlayMask.y=this.sourceTexture.height/2,this.shadowContainer.x=this.sourceTexture.width/2,this.shadowContainer.y=this.sourceTexture.height/2),this.updateOverlaySmoothing(this.baseScale)),BFN.MainUI.requestRender()}else console.log("OVERLAY TEXTURE NOT FOUND")},jp.prototype.handleMaskDraggerDraggingStarted=function(e){this.patternMode&&(this.patternStartOffset.x=this.overlayPattern.globalOffsetPoint.x,this.patternStartOffset.y=this.overlayPattern.globalOffsetPoint.y)},jp.prototype.handleMaskDraggerDragging=function(e){if(this.patternMode){var t=this.patternStartOffset.x+this.maskDragger.mouseDeltaX,i=this.patternStartOffset.y+this.maskDragger.mouseDeltaY;this.overlayPattern.offset(t,i),this.shadowPattern.offset(t,i),this.updateOverlayPatternMaskTexture()}else this.shadowContainer.x=this.overlayMask.x,this.shadowContainer.y=this.overlayMask.y},Object.defineProperty(jp.prototype,"toolScale",{set:function(e){this._scale=e,this.maskDragger.scale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(jp.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=0,this.imageContainer.y=0,this.setSmoothingScale(1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),e}}),Object.defineProperty(BFN,"ImageOverlay",{get:function(){return!BFN._ImageOverlay&&(BFN._ImageOverlay=new jp),BFN._ImageOverlay}}),Wp.prototype=Object.create(PIXI.Sprite.prototype),Wp.prototype.init=function(){BeFunky.log("LensFlareDisplayElement Init"),this.initDefaultValues(),this.initStaticMask(),this.updateProperties()},Wp.prototype.initDefaultValues=function(){this.PId2=Math.PI/2,this.radsPerDeg=Math.PI/180,this.elementBaseDimensions=new PIXI.Point,this.elementBeta=0,this._ignoreActiveProperty=!1,this._intensityFactor=0,this.lensTintFilter=new BFN.filters.LensTintFilter,this.usesColorOverlay=!1,this.staticElement=!1,this.textureSource=null,this.elementSprite=new PIXI.Sprite,this.handleAssetUpdatedBind=this.handleAssetUpdated.bind(this),this.handlePropertyUpdatedBind=this.handlePropertyUpdated.bind(this),this.handlePositionUpdatedBind=this.handlePositionUpdated.bind(this),this._elementVO.addEventListener(BFN.LensFlareElementVOEvents.ASSET_UPDATED.type,this.handleAssetUpdatedBind),this._elementVO.addEventListener(BFN.LensFlareElementVOEvents.PROPERTY_UPDATED.type,this.handlePropertyUpdatedBind),this._elementVO.addEventListener(BFN.LensFlareElementVOEvents.POSITION_UPDATED.type,this.handlePositionUpdatedBind),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},Wp.prototype.initStaticMask=function(){if(!BFN.hasOwnProperty("LensFlareDisplayElementStaticMaskTexture")){var e=new PIXI.Graphics;e.beginFill(16777215),e.drawRect(0,0,1024,1024),e.endFill();var t=PIXI.RenderTexture.create(1024,1024);BFN.Stage.render(e,t);var i=BFN.ShaderPool.BrushFilter;i.radius=512,i.hardness=.1;var r=new PIXI.Sprite;r.pluginName="filter_renderer",r.texture=t,r.bfn_shaders=[i];var a=PIXI.RenderTexture.create(1024,1024);BFN.Stage.render(r,a),e.clear(),t.destroyGC(!0),r.filters=[],r.destroy(!0),BFN.LensFlareDisplayElementStaticMaskTexture=a}this.staticContainer=new PIXI.Container,this.staticSprite=new PIXI.Sprite,this.staticContainer.addChild(this.staticSprite),this.staticMask=new PIXI.Sprite(BFN.LensFlareDisplayElementStaticMaskTexture),this.staticMask.anchor.x=this.staticMask.anchor.y=.5,this.staticContainer.addChild(this.staticMask),this.staticSprite.mask=this.staticMask},Wp.prototype.updateAsset=function(){if(BFN.LensFlareData.assets.hasOwnProperty(this._elementVO.getProperty("assetID"))){var e=BFN.LensFlareData.assets[this._elementVO.getProperty("assetID")];try{this.texture.destroyGC(!0)}catch(e){}this.texture=PIXI.Texture.EMPTY;try{this.staticSprite.texture.destroyGC(!0)}catch(e){}if(this.staticSprite.texture=PIXI.Texture.EMPTY,this.staticElement=e.static,this.textureSource=this.useThumb?e.thumbTexture:e.imageTexture,this.textureSource){this.elementSprite.texture=this.textureSource;var t=BFN.Util.cloneTexture(this.textureSource);this.staticElement?(this.texture=PIXI.RenderTexture.create(this._displayDimensions.x,this._displayDimensions.y),this.staticSprite.texture=t,this.staticSprite.scale.x=this.staticSprite.scale.y=Math.max(this._displayDimensions.x,this._displayDimensions.y)/Math.min(this.staticSprite.texture.width,this.staticSprite.texture.height),this.staticSprite.x=(this._displayDimensions.x-this.staticSprite.texture.width*this.staticSprite.scale.x)/2,this.staticSprite.y=(this._displayDimensions.y-this.staticSprite.texture.height*this.staticSprite.scale.y)/2,this.elementBaseDimensions.x=this.staticMask.texture.width,this.elementBaseDimensions.y=this.staticMask.texture.height,BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)):(this.texture=t,this.elementBaseDimensions.x=this.texture.width,this.elementBaseDimensions.y=this.texture.height,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)),this.updatePosition(),this.updateScale(),this.updateProperties()}}},Wp.prototype.updatePosition=function(){var e=this._sourcePoint.x-this._centerPoint.x,t=this._sourcePoint.y-this._centerPoint.y,i=Math.sqrt(e*e+t*t);this.elementBeta=Math.atan2(t,e);var r=this._sourcePoint.x-Math.cos(this.elementBeta)*i*2*this._elementVO.getProperty("sourceDistanceFactor")+Math.cos(this.elementBeta+this.PId2)*i*2*this._elementVO.getProperty("centerDistanceFactor")+this._displayDimensions.x/2,a=this._sourcePoint.y-Math.sin(this.elementBeta)*i*2*this._elementVO.getProperty("sourceDistanceFactor")+Math.sin(this.elementBeta+this.PId2)*i*2*this._elementVO.getProperty("centerDistanceFactor")+this._displayDimensions.y/2;this.staticElement?(this.x=this.y=0,this.anchor.x=this.anchor.y=0,this.staticMask.x=r,this.staticMask.y=a,this.renderPending=!0):(this.x=r,this.y=a,this.anchor.x=this.anchor.y=.5),this.updateRotation()},Wp.prototype.updateRotation=function(){var e=(this._elementVO.getProperty("rotationLock")?this.elementBeta:0)+this._elementVO.getProperty("rotationOffset")*this.radsPerDeg;this.staticElement?(this.rotation=0,this.staticMask.rotation=e):this.rotation=e},Wp.prototype.updateScale=function(){if(this.elementBaseDimensions.x>0&&this.elementBaseDimensions.y>0){var e=Math.max(this._displayDimensions.x,this._displayDimensions.y)/Math.max(this.elementBaseDimensions.x,this.elementBaseDimensions.y)*this._elementVO.getProperty("sizeFactor");e=Math.max(0,e+e*this._intensityFactor*this._elementVO.getProperty("sizeFactorGlobal")),this.staticElement?(this.scale.x=this.scale.y=1,this.staticMask.scale.x=e*this._elementVO.getProperty("stretchXFactor"),this.staticMask.scale.y=e*this._elementVO.getProperty("stretchYFactor"),this.renderPending=!0):(this.scale.x=e*this._elementVO.getProperty("stretchXFactor"),this.scale.y=e*this._elementVO.getProperty("stretchYFactor"))}},Wp.prototype.updateIntensity=function(){this._ignoreActiveProperty?this.alpha=1:this.alpha=this._elementVO.getProperty("intensityFactor")+this._elementVO.getProperty("intensityFactor")*this._intensityFactor*this._elementVO.getProperty("intensityFactorGlobal")},Wp.prototype.updateProperties=function(){this.visible=!!this._ignoreActiveProperty||this._elementVO.getProperty("active"),this.updateColor(),this.updateIntensity(),this.updateScale(),this.updateRotation()},Wp.prototype.updateColor=function(){var e=-1,t=this._elementVO.getProperty("colorGlobal"),i=this._elementVO.getProperty("color");if(t>=0?e=t:i>=0&&(e=i),e>=0){this.usesColorOverlay=!0;var r="0x"+e.toString(16);this.lensTintFilter.color=r}else this.usesColorOverlay=!1;this.updateBlendMode()},Wp.prototype.updateBlendMode=function(){if(this.blendMode=PIXI.BLEND_MODES.NORMAL,!this._ignoreActiveProperty)switch(this._elementVO.getProperty("blendMode")){case"screen":this.blendMode=PIXI.BLEND_MODES.SCREEN;break;case"add":this.blendMode=PIXI.BLEND_MODES.ADD}try{this.staticElement?(this.usesColorOverlay?this.staticSprite.filters=[this.lensTintFilter]:this.staticSprite.filters=[],BFN.Stage.render(this.staticContainer,this.texture)):(this.usesColorOverlay?this.elementSprite.filters=[this.lensTintFilter]:this.elementSprite.filters=[],BFN.Stage.render(this.elementSprite,this.texture))}catch(e){}},Wp.prototype.destroyElement=function(){try{this.texture.destroyGC(!0)}catch(e){}this.texture=PIXI.Texture.EMPTY,this.staticSprite.mask=null,this.staticContainer.removeChild(this.staticMask),this.staticMask.destroy(!1),this.staticMask.texture=null,this.staticMask=null,this.staticContainer.removeChild(this.staticSprite),this.staticSprite.filters=[],this.staticSprite.destroy(!1),this.staticSprite.texture=null,this.staticSprite=null,this.staticContainer=null,this.elementSprite.filters=[],this.elementSprite.destroy(!1),this.elementSprite=null,this.textureSource=null,this._elementVO.removeEventListener(BFN.LensFlareElementVOEvents.ASSET_UPDATED.type,this.handleAssetUpdatedBind),this._elementVO.removeEventListener(BFN.LensFlareElementVOEvents.PROPERTY_UPDATED.type,this.handlePropertyUpdatedBind),this._elementVO.removeEventListener(BFN.LensFlareElementVOEvents.POSITION_UPDATED.type,this.handlePositionUpdatedBind),this._elementVO=null,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.destroy(!0)},Wp.prototype.applyColorOverlay=function(e,t,i){},Wp.prototype.handleAssetUpdated=function(e){this.updateAsset()},Wp.prototype.handlePropertyUpdated=function(e){this.updateProperties()},Wp.prototype.handlePositionUpdated=function(e){this.updatePosition()},Wp.prototype.handleMainUIPreRender=function(e){this.staticMask&&this.renderPending&&(this.renderPending=!1,BFN.Stage.render(this.staticContainer,this.texture))},Object.defineProperty(Wp.prototype,"elementVO",{get:function(){return this._elementVO}}),Object.defineProperty(Wp.prototype,"ignoreActiveProperty",{set:function(e){this._ignoreActiveProperty=e,this.updateProperties()},get:function(){return this._ignoreActiveProperty}}),Object.defineProperty(Wp.prototype,"intensityFactor",{set:function(e){this._intensityFactor=e,this.updateScale(),this.updateIntensity()},get:function(){return this._intensityFactor}}),BFN.LensFlareDisplayElement=Wp,BFN.LensFlareDisplayEvents={ELEMENTS_ADDED:new Event("ELEMENTS_ADDED")},Yp.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),Yp.prototype.init=function(){BeFunky.log("LensFlareDisplay Init"),this.initDefaultValues(),this.initDisplay()},Yp.prototype.initDefaultValues=function(){this.elements=[],this._sourcePoint=new PIXI.Point,this._centerPoint=new PIXI.Point,this._displayDimensions=new PIXI.Point,this.displayTexture=null,this.anchor.x=this.anchor.y=.5,this._intenseMode=!0,this._intensityFactor=0,this._itemWidth=this._displayDimensions.x,this._itemHeight=this._displayDimensions.y,this.maxSize=1200,this.scaleFactor=1,this.handleLensFlareManagerThumbsLoadedBind=this.handleLensFlareManagerThumbsLoaded.bind(this),this.handleLensFlareManagerAssetsLoadedBind=this.handleLensFlareManagerAssetsLoaded.bind(this),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},Yp.prototype.initDisplay=function(){this.displayContainer=new PIXI.Container,this.addChild(this.displayContainer),this.blackBackground=new PIXI.Graphics,this.blackBackground.visible=!0,this.displayContainer.addChild(this.blackBackground),this.elementContainer=new PIXI.Container,this.displayContainer.addChild(this.elementContainer),this.elementContainerMask=new PIXI.Graphics,this.displayContainer.addChild(this.elementContainerMask),this.elementContainer.mask=this.elementContainerMask},Yp.prototype.setDisplayDimensions=function(e,t){this.scaleFactor=1,(e>this.maxSize||t>this.maxSize)&&(this.scaleFactor=Math.min(this.maxSize/e,this.maxSize/t),e=Math.round(e*this.scaleFactor),t=Math.round(t*this.scaleFactor)),this.scale.x=this.scale.y=1/this.scaleFactor,this._itemWidth=this._displayDimensions.x=e,this._itemHeight=this._displayDimensions.y=t,this.texture=PIXI.Texture.EMPTY;try{this.displayTexture.destroyGC(!0),this.displayTexture=null}catch(e){}e>0&&t>0&&(this.displayTexture=PIXI.RenderTexture.create(e,t),this._intenseMode||(BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.texture=this.displayTexture)),this.displayContainer.x=this._intenseMode?-Math.round(this._itemWidth/2):0,this.displayContainer.y=this._intenseMode?-Math.round(this._itemHeight/2):0,this.blackBackground.clear(),this.blackBackground.beginFill(0),this.blackBackground.drawRect(0,0,this._itemWidth,this._itemHeight),this.blackBackground.endFill(),this.elementContainerMask.clear(),this.elementContainerMask.beginFill(16777215),this.elementContainerMask.drawRect(0,0,this._itemWidth,this._itemHeight),this.elementContainerMask.endFill()},Yp.prototype.clearElements=function(){for(var e=0;e<this.elements.length;e++){var t=this.elements[e];t.destroyElement(),this.elementContainer.removeChild(t)}this.elements.splice(0)},Yp.prototype.addElements=function(e){this.clearElements();for(var t=[],i=0;i<e.length;i++){var r=e[i],a=r.getProperty("assetID");if(a){var n=new BFN.LensFlareDisplayElement(r,this._sourcePoint,this._centerPoint,this._displayDimensions,this.useThumbs);this.elementContainer.addChild(n),this.elements.push(n),t.push(a)}}this.updateElementPositions(),this.useThumbs?(BFN.LensFlareManager.addEventListener(BFN.LensFlareManagerEvents.THUMBS_LOADED.type,this.handleLensFlareManagerThumbsLoadedBind),BFN.LensFlareManager.loadAssetThumbs(t)):(BFN.LensFlareManager.addEventListener(BFN.LensFlareManagerEvents.ASSETS_LOADED.type,this.handleLensFlareManagerAssetsLoadedBind),BFN.LensFlareManager.loadAssets(t))},Yp.prototype.addElementsComplete=function(){for(var e=0;e<this.elements.length;e++){var t=this.elements[e];t.updateAsset(),t.intensityFactor=this._intensityFactor}this.renderPending=!0,BFN.MainUI.requestRender(),this.dispatchEvent(BFN.LensFlareDisplayEvents.ELEMENTS_ADDED)},Yp.prototype.setSourcePoint=function(e,t){this._sourcePoint.x=e*this.scaleFactor,this._sourcePoint.y=t*this.scaleFactor,this.updateElementPositions()},Yp.prototype.setCenterPoint=function(e,t){this._centerPoint.x=e*this.scaleFactor,this._centerPoint.y=t*this.scaleFactor,this.updateElementPositions()},Yp.prototype.updateElementPositions=function(){for(var e=0;e<this.elements.length;e++){this.elements[e].elementVO.dispatchEvent(BFN.LensFlareElementVOEvents.POSITION_UPDATED)}this.renderPending=!0,BFN.MainUI.requestRender()},Yp.prototype.setGlobalColors=function(e){for(var t=0;t<this.elements.length;t++){var i=this.elements[t],r=i.elementVO.getProperty("colorGlobalGroup");if(e.hasOwnProperty(r)){var a=parseInt("0x"+e[r]);i.elementVO.getProperty("colorGlobal")!=a&&i.elementVO.setProperty("colorGlobal",a)}}this.renderPending=!0,BFN.MainUI.requestRender()},Yp.prototype.getElementVOClones=function(){return[]},Yp.prototype.handleLensFlareManagerThumbsLoaded=function(){BFN.LensFlareManager.removeEventListener(BFN.LensFlareManagerEvents.THUMBS_LOADED.type,this.handleLensFlareManagerThumbsLoadedBind),this.addElementsComplete()},Yp.prototype.handleLensFlareManagerAssetsLoaded=function(){BFN.LensFlareManager.removeEventListener(BFN.LensFlareManagerEvents.ASSETS_LOADED.type,this.handleLensFlareManagerAssetsLoadedBind),this.addElementsComplete()},Yp.prototype.handleMainUIPreRender=function(e){this.renderPending&&(this.renderPending=!1,this._intenseMode||BFN.Stage.render(this.displayContainer,this.displayTexture))},Object.defineProperty(Yp.prototype,"sourcePoint",{get:function(){return this._sourcePoint}}),Object.defineProperty(Yp.prototype,"centerPoint",{get:function(){return this._centerPoint}}),Object.defineProperty(Yp.prototype,"displayDimensions",{get:function(){return this._displayDimensions}}),Object.defineProperty(Yp.prototype,"intenseMode",{set:function(e){this._intenseMode!=e&&(this._intenseMode=e,this.blackBackground.visible=!this._intenseMode,this.blendMode=this._intenseMode?PIXI.BLEND_MODES.NORMAL:PIXI.BLEND_MODES.SCREEN,this._intenseMode?(this.displayContainer.x=-Math.round(this._itemWidth/2),this.displayContainer.y=-Math.round(this._itemHeight/2),this.addChild(this.displayContainer),BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.texture=PIXI.Texture.EMPTY):(this.displayContainer.x=this.displayContainer.y=0,this.removeChild(this.displayContainer),this.displayTexture&&(BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.texture=this.displayTexture,this.renderPending=!0)),BFN.MainUI.requestRender())},get:function(){return this._intenseMode}}),Object.defineProperty(Yp.prototype,"intensityFactor",{set:function(e){this._intensityFactor=e;for(var t=0;t<this.elements.length;t++){this.elements[t].intensityFactor=this._intensityFactor}this.renderPending=!0,BFN.MainUI.requestRender()},get:function(){return this._intensityFactor}}),Object.defineProperty(Yp.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(Yp.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.LensFlareDisplay=Yp,qp.prototype=Object.create(PIXI.Sprite.prototype),qp.prototype.init=function(){BeFunky.log("ImageLensFlare Init"),this.initDefaultValues(),this.initImageContainer(),this.initBlackBackground(),this.initSourceSprite(),this.initLensFlareDisplay(),this.initControls(),this.initControlDragger()},qp.prototype.initDefaultValues=function(){this.interactive=!0,this.sourceTexture=null,this.currentPresetID=null,this.currentPresetName=null,this.hovering=!1,this._scale=1,this.newSession=!1,this.keepGuidesOn=!1,this.on("pointerover",this.handleToolMouseOver.bind(this)),this.on("pointerout",this.handleToolMouseOut.bind(this)),this.on("pointerdown",this.handleToolMouseDown.bind(this))},qp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},qp.prototype.initBlackBackground=function(){this.blackBackground=new PIXI.Sprite,this.imageContainer.addChild(this.blackBackground)},qp.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.imageContainer.addChild(this.sourceSprite)},qp.prototype.initLensFlareDisplay=function(){this.lensFlareDisplay=new BFN.LensFlareDisplay,this.imageContainer.addChild(this.lensFlareDisplay)},qp.prototype.initControls=function(){this.controls=new PIXI.Container,this.addChild(this.controls),this.flareSourceControl=this.getFlareControl(15),this.controls.addChild(this.flareSourceControl),this.flareCenterControl=this.getFlareControl(10),this.controls.addChild(this.flareCenterControl)},qp.prototype.initControlDragger=function(){this.controlDragger=new BFN.Dragger,this.controlDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleControlDraggerDragging.bind(this)),this.controlDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleControlDraggerDraggingStarted.bind(this)),this.controlDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleControlDraggerDraggingComplete.bind(this))},qp.prototype.handleLensFlareGeneric=function(){var e=UITools.getToolVO("lens_flare_generic");this.lensFlareDisplay.intenseMode="intense"==e.intense_mode,this.lensFlareDisplay.intensityFactor=e.intensity/100,BFN.StageModel.setRefreshFactor(e.updating?.5:1)},qp.prototype.handleUpdateTool=function(e){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE){var t=UITools.getToolVO(e);if(this.newSession){this.newSession=!1;for(var i=1;i<=5;i++){var r="color_value_"+i;t.hasOwnProperty(r)&&UITools.setToolValue(e,r,t.defaultValues[r])}UITools.updateToolControls(e),UITools.setToolValue("lens_flare_generic","intense_mode","normal"),UITools.setToolValue("lens_flare_generic","intensity",0),UITools.updateToolControls("lens_flare_generic"),this.handleLensFlareGeneric()}if(t=UITools.getToolVO(e),this.currentPresetID!=t.presetID){this.currentPresetID=t.presetID,this.currentPresetName=BFN.LensFlareData.presets[this.currentPresetID].presetName;for(var a=BFN.LensFlareData.presets[this.currentPresetID].elementVOs,n=[],o=0;o<a.length;o++){var s=a[o];n.push(s.clone()),s.properties.blendMode}this.lensFlareDisplay.addElements(n)}for(var l=null,h=1;h<=5;h++)t.hasOwnProperty("color_value_"+h)&&(l||(l={}),l[h]=t["color_value_"+h]);l&&this.lensFlareDisplay.setGlobalColors(l)}},qp.prototype.setSourceTexture=function(e){var t=e&&!this.sourceTexture;null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),e&&(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.newSession=!0),this.resetControls(t),this.updateDisplay(),this.sourceTexture||(this.currentPresetID=null,this.lensFlareDisplay.clearElements())},qp.prototype.resetControls=function(e){if(this.keepGuidesOn=!1,this.controls.visible=!0,this.lensFlareDisplay.intenseMode=!1,this.lensFlareDisplay.intensityFactor=0,this.sourceTexture&&e){var t=Math.min(this.sourceTexture.width,this.sourceTexture.height)/4;this.setSourcePoint(t,-t),this.setCenterPoint(0,0)}BFN.MainUI.requestRender()},qp.prototype.setSourcePoint=function(e,t){this.flareSourceControl.x=e,this.flareSourceControl.y=t,this.lensFlareDisplay.setSourcePoint(e,t),BFN.MainUI.requestRender()},qp.prototype.setCenterPoint=function(e,t){this.flareCenterControl.x=e,this.flareCenterControl.y=t,this.lensFlareDisplay.setCenterPoint(e,t),BFN.MainUI.requestRender()},qp.prototype.updateDisplay=function(){this.hitArea=new PIXI.Rectangle,this.blackBackgroundTexture||(this.blackBackgroundTexture=PIXI.RenderTexture.create(32,32),this.blackBackgroundTexture.fillColor(0),this.blackBackground.texture=this.blackBackgroundTexture),this.lensFlareDisplay.setDisplayDimensions(0,0),this.sourceTexture&&(this.hitArea=new PIXI.Rectangle(-this.sourceTexture.width,-this.sourceTexture.height,2*this.sourceTexture.width,2*this.sourceTexture.height),this.blackBackground.width=this.sourceTexture.width,this.blackBackground.height=this.sourceTexture.height,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.lensFlareDisplay.x=Math.round(this.sourceTexture.width/2),this.lensFlareDisplay.y=Math.round(this.sourceTexture.height/2),this.lensFlareDisplay.setDisplayDimensions(this.sourceTexture.width,this.sourceTexture.height),this.lensFlareDisplay.setSourcePoint(this.flareSourceControl.x,this.flareSourceControl.y),this.lensFlareDisplay.setCenterPoint(this.flareCenterControl.x,this.flareCenterControl.y))},qp.prototype.getFlareControl=function(e){var t,i,r=Math.round(2*(e+1+.5)),a=PIXI.RenderTexture.create(r,r);t=3,i=r/2-1-.5-1,BFN.graphics.drawShape("roundedRect",a,{fillColor:2147483648,paddingX:t,paddingY:i,quality:.5,clear:!0}),BFN.graphics.drawShape("roundedRect",a,{fillColor:2147483648,paddingX:i,paddingY:t,quality:.5,clear:!1}),BFN.graphics.drawShape("ellipse",a,{strokeWidth:3,strokeColor:2147483648,quality:.5,clear:!1}),t=2.5,i=r/2-1-1,BFN.graphics.drawShape("roundedRect",a,{fillColor:4294967295,paddingX:t,paddingY:i,quality:.5,clear:!1}),BFN.graphics.drawShape("roundedRect",a,{fillColor:4294967295,paddingX:i,paddingY:t,quality:.5,clear:!1}),BFN.graphics.drawShape("ellipse",a,{strokeWidth:2,strokeColor:4294967295,paddingX:.5,paddingY:.5,quality:.5,clear:!1});var n=new PIXI.Sprite(a);return n.interactive=!0,n.buttonMode=!0,n.anchor.x=n.anchor.y=.5,n.on("pointerdown",this.handleFlareControlPressed.bind(this)),n},qp.prototype.handleToolMouseOver=function(e){this.hovering=!0,this.controls.visible=!0,BFN.MainUI.requestRender()},qp.prototype.handleToolMouseOut=function(e){this.hovering=!1,this.controlDragger.dragging||(this.controls.visible=this.keepGuidesOn,BFN.MainUI.requestRender())},qp.prototype.handleToolMouseDown=function(e){this.hovering||(this.keepGuidesOn=!0,this.handleToolMouseOver())},qp.prototype.handleFlareControlPressed=function(e){this.sourceTexture&&(this.controlDragger.setBounds(-this.sourceTexture.width,-this.sourceTexture.height,this.sourceTexture.width,this.sourceTexture.height),this.controlDragger.drag(e.currentTarget),e.stopPropagation())},qp.prototype.handleControlDraggerDragging=function(e){switch(this.controlDragger.item){case this.flareSourceControl:this.lensFlareDisplay.setSourcePoint(this.controlDragger.draggedX,this.controlDragger.draggedY);break;case this.flareCenterControl:this.lensFlareDisplay.setCenterPoint(this.controlDragger.draggedX,this.controlDragger.draggedY)}},qp.prototype.handleControlDraggerDraggingStarted=function(e){this.hovering||(this.keepGuidesOn=!0,this.handleToolMouseOver())},qp.prototype.handleControlDraggerDraggingComplete=function(e){this.hovering||this.handleToolMouseOut(null)},Object.defineProperty(qp.prototype,"toolScale",{set:function(e){this._scale=e,this.controlDragger.scale=this._scale,this.flareSourceControl.scale.x=this.flareSourceControl.scale.y=1/this._scale,this.flareCenterControl.scale.x=this.flareCenterControl.scale.y=1/this._scale},get:function(){return this._scale}}),Object.defineProperty(qp.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=0,this.imageContainer.y=0,BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),e}}),Object.defineProperty(BFN,"ImageLensFlare",{get:function(){return!BFN._ImageLensFlare&&(BFN._ImageLensFlare=new qp),BFN._ImageLensFlare}}),Kp.prototype=Object.create(PIXI.Sprite.prototype),Kp.prototype.init=function(){BeFunky.log("ImageCrop Init"),this.initDefaultValues(),this.initImageContainer(),this.initSprites(),this.initCropFrame(),this.initCropGrid(),this.initCropHandles(),this.initDragger()},Kp.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this.cropRatioLocked=!1,this.cropRatio=1,this.cropWidth=0,this.cropWidth=0,this.minCropSize=20,this.handleSize=20,this.imageBounds={minX:0,minY:0,maxX:0,maxY:0},this.currentCropHandle=null,this.cropRatios=BFN.CropRatioMap,this.handleCropFrameDraggingBind=this.handleCropFrameDragging.bind(this),this.handleCropFrameDraggingCompleteBind=this.handleCropFrameDraggingComplete.bind(this),this.handleCropHandleDraggingBind=this.handleCropHandleDragging.bind(this),this.handleCropHandleDraggingCompleteBind=this.handleCropHandleDraggingComplete.bind(this)},Kp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer)},Kp.prototype.initSprites=function(){this.uncroppedSprite=new PIXI.Sprite,this.uncroppedSprite.pluginName="blend_picture",this.uncroppedSprite.alpha=.5,this.imageContainer.addChild(this.uncroppedSprite),this.croppedSprite=new PIXI.Sprite,this.croppedSprite.pluginName="blend_picture",this.imageContainer.addChild(this.croppedSprite)},Kp.prototype.initCropFrame=function(){this.cropFrameContainer=new PIXI.Container,this.imageContainer.addChild(this.cropFrameContainer),this.cropFrameMask=new PIXI.Graphics,this.cropFrameMask.beginFill(16777215,1),this.cropFrameMask.drawRect(-50,-50,100,100),this.cropFrameMask.endFill(),this.cropFrameMask.interactive=!0,this.cropFrameMask.on("pointerdown",this.handleCropFramePress.bind(this)),this.cropFrame=new PIXI.Sprite,this.cropFrame.interactive=!0,this.cropFrame.addChild(this.cropFrameMask),this.cropFrameContainer.addChild(this.cropFrame),this.croppedSprite.mask=this.cropFrameMask},Kp.prototype.initCropGrid=function(){this.cropGrid=new BFN.CropGrid,this.cropFrame.addChild(this.cropGrid)},Kp.prototype.initCropHandles=function(){this.cropHandles={},this.cropHandleContainer=new PIXI.Container,this.cropFrameContainer.addChild(this.cropHandleContainer),this.cornerHandleIDs=["tl","tr","br","bl"];for(var e=0;e<this.cornerHandleIDs.length;e++){var t=this.cornerHandleIDs[e],i=new BFN.CropHandle(BFN.CropHandleTypes.TYPE_CORNER,e*Math.PI/2,this.handleSize);i.id=t,i.type="corner",i.on("pointerdown",this.handleCropHandlePress.bind(this)),this.cropHandles[t]=i,this.cropHandleContainer.addChild(i)}this.sideHandleIDs=["t","r","b","l"];for(var r=0;r<this.sideHandleIDs.length;r++){var a=this.sideHandleIDs[r],n=new BFN.CropHandle(BFN.CropHandleTypes.TYPE_EDGE,r*Math.PI/2,this.handleSize);n.id=a,n.type="side",n.on("pointerdown",this.handleCropHandlePress.bind(this)),this.cropHandles[a]=n,this.cropHandleContainer.addChild(n)}for(var o in this.cropHandles){var s=this.cropHandles[o];switch(o){case"tl":s.anchorHandle=this.cropHandles.br;break;case"tr":s.anchorHandle=this.cropHandles.bl;break;case"br":s.anchorHandle=this.cropHandles.tl;break;case"bl":s.anchorHandle=this.cropHandles.tr;break;case"t":s.anchorHandle=this.cropHandles.b;break;case"r":s.anchorHandle=this.cropHandles.l;break;case"b":s.anchorHandle=this.cropHandles.t;break;case"l":s.anchorHandle=this.cropHandles.r}}},Kp.prototype.initDragger=function(){this.dragger=new BFN.Dragger,this.dragger.stickyDrag=!1},Kp.prototype.handleCrop=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CROP&&this.sourceTexture&&!this.dragger.dragging){var e=UITools.getToolVO("crop"),t=e.updating_id;if("aspect_ratio"==t&&this.cropRatios.hasOwnProperty(e.aspect_ratio)){var i=e.aspect_ratio,r=this.cropRatios[i];if("freeform"==i)e.lock_aspect_ratio=!1;else{switch(e.lock_aspect_ratio=!0,"original_ratio"==i&&(r=this.sourceTexture.height/this.sourceTexture.width),e.orientation){case"landscape":this.cropRatio=r<1?r:1/r,this.cropWidth=Math.min(Math.round(.9*this.sourceTexture.width),Math.round(this.sourceTexture.height/this.cropRatio*.9)),this.cropHeight=Math.round(this.cropWidth*this.cropRatio);break;case"portrait":this.cropRatio=r>1?r:1/r,this.cropHeight=Math.min(Math.round(.9*this.sourceTexture.height),Math.round(this.sourceTexture.width*this.cropRatio*.9)),this.cropWidth=Math.round(this.cropHeight/this.cropRatio)}this.cropFrame.x=this.cropFrame.y=0,this.updateCropHandlePositions()}UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop")}if(this.cropRatioLocked=e.lock_aspect_ratio,this.cropRatioLocked)switch("lock_aspect_ratio"==t&&(this.cropRatio=this.cropHeight/this.cropWidth),t){case"crop_width":this.cropWidth=Math.max(this.minCropSize,this.minCropSize/this.cropRatio,Math.min(this.sourceTexture.width,e.crop_width)),this.cropHeight=Math.min(this.sourceTexture.height,this.cropWidth*this.cropRatio),this.cropWidth=this.cropHeight/this.cropRatio,this.cropWidth=Math.round(this.cropWidth),this.cropHeight=Math.round(this.cropHeight),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop");break;case"crop_height":this.cropHeight=Math.max(this.minCropSize,this.minCropSize*this.cropRatio,Math.min(this.sourceTexture.height,e.crop_height)),this.cropWidth=Math.min(this.sourceTexture.width,this.cropHeight/this.cropRatio),this.cropHeight=this.cropWidth*this.cropRatio,this.cropWidth=Math.round(this.cropWidth),this.cropHeight=Math.round(this.cropHeight),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop")}else if("lock_aspect_ratio"==t)e.aspect_ratio="freeform",UITools.updateToolControl("crop_aspect_ratio");else switch(this.cropWidth=Math.round(Math.max(this.minCropSize,Math.min(this.sourceTexture.width,e.crop_width))),this.cropHeight=Math.round(Math.max(this.minCropSize,Math.min(this.sourceTexture.height,e.crop_height))),t){case"crop_width":case"crop_height":this.updateOrientation(),UITools.setToolValue("crop","orientation",this.orientation),UITools.updateToolControl("crop_orientation")}if("orientation"==t){var a=this.cropHeight/this.cropWidth;switch(e.orientation){case"landscape":this.cropRatio=a<1?a:1/a,this.cropWidth=Math.min(Math.round(.9*this.sourceTexture.width),Math.round(this.sourceTexture.height/this.cropRatio*.9)),this.cropHeight=Math.round(this.cropWidth*this.cropRatio);break;case"portrait":this.cropRatio=a>1?a:1/a,this.cropHeight=Math.min(Math.round(.9*this.sourceTexture.height),Math.round(this.sourceTexture.width*this.cropRatio*.9)),this.cropWidth=Math.round(this.cropHeight/this.cropRatio)}this.cropFrame.x=this.cropFrame.y=0,this.updateCropHandlePositions(),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop")}this.updateCropFrameCenter(),BFN.MainUI.requestRender()}},Kp.prototype.setSourceTexture=function(e){if(this.reset(),e){this.imageContainer.x=Math.floor(-e.width/2),this.imageContainer.y=Math.floor(-e.height/2),this.cropFrameContainer.x=Math.abs(this.imageContainer.x),this.cropFrameContainer.y=Math.abs(this.imageContainer.y),this.sourceTexture=e,this.uncroppedSprite.texture=this.sourceTexture,this.croppedSprite.texture=this.sourceTexture,this.imageBounds.minX=-e.width/2,this.imageBounds.minY=-e.height/2,this.imageBounds.maxX=e.width/2,this.imageBounds.maxY=e.height/2,this.cropWidth=Math.round(.9*this.sourceTexture.width),this.cropHeight=Math.round(.9*this.sourceTexture.height),this.updateCropHandlePositions(),this.updateDraggerBounds();var t=UITools.getParamObject("crop_crop_width");t.min=this.minCropSize,t.max=this.sourceTexture.width;var i=UITools.getParamObject("crop_crop_height");i.min=this.minCropSize,i.max=this.sourceTexture.height,UITools.setToolValue("crop","aspect_ratio","freeform"),this.updateOrientation(),UITools.setToolValue("crop","orientation",this.orientation),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.setToolValue("crop","lock_aspect_ratio",!1),UITools.updateToolControls("crop")}},Kp.prototype.updateCropFrameDisplay=function(){this.cropFrameMask.width=this.cropWidth,this.cropFrameMask.height=this.cropHeight,this.cropGrid.setDimensions(this.cropWidth,this.cropHeight)},Kp.prototype.updateCropFrameCenter=function(){if(this.currentCropHandle){var e=this.currentCropHandle,t=this.currentCropHandle.anchorHandle;switch(e.id){case"tl":case"l":case"bl":this.cropFrame.x=t.x-this.cropWidth/2;break;case"tr":case"r":case"br":this.cropFrame.x=t.x+this.cropWidth/2}switch(e.id){case"tl":case"t":case"tr":this.cropFrame.y=t.y-this.cropHeight/2;break;case"bl":case"b":case"br":this.cropFrame.y=t.y+this.cropHeight/2}}else this.cropFrame.x=Math.max(-this.sourceTexture.width/2+this.cropWidth/2,Math.min(this.sourceTexture.width/2-this.cropWidth/2,this.cropFrame.x)),this.cropFrame.y=Math.max(-this.sourceTexture.height/2+this.cropHeight/2,Math.min(this.sourceTexture.height/2-this.cropHeight/2,this.cropFrame.y));this.updateCropHandlePositions()},Kp.prototype.updateCropHandlePositions=function(){for(var e in this.cropHandles){var t=this.cropHandles[e];switch(e){case"tl":case"bl":case"l":t.x=this.cropFrame.x-this.cropWidth/2,"side"==t.type&&(t.y=this.cropFrame.y);break;case"tr":case"br":case"r":t.x=this.cropFrame.x+this.cropWidth/2,"side"==t.type&&(t.y=this.cropFrame.y)}switch(e){case"tl":case"tr":case"t":t.y=this.cropFrame.y-this.cropHeight/2,"side"==t.type&&(t.x=this.cropFrame.x);break;case"bl":case"br":case"b":t.y=this.cropFrame.y+this.cropHeight/2,"side"==t.type&&(t.x=this.cropFrame.x)}t.x=Math.floor(t.x),t.y=Math.floor(t.y)}this.updateCropHandleVisibility(),this.updateCropFrameDisplay()},Kp.prototype.updateCropHandleVisibility=function(){var e=this.cropWidth*this._scale<4*this.handleSize||this.cropHeight*this._scale<4*this.handleSize;for(var t in this.cropHandles){var i=this.cropHandles[t],r=!0;switch(t){case"tl":case"tr":case"br":case"bl":break;case"l":case"r":r=this.cropHeight*this._scale>2*this.handleSize;break;case"t":case"b":r=this.cropWidth*this._scale>2*this.handleSize}if(i.visible=r,r){switch(t){case"tl":case"bl":case"l":i.handle.x=e?-this.handleSize:0;break;case"tr":case"br":case"r":i.handle.x=e?this.handleSize:0}switch(t){case"tl":case"tr":case"t":i.handle.y=e?-this.handleSize:0;break;case"bl":case"br":case"b":i.handle.y=e?this.handleSize:0}}}},Kp.prototype.updateCropHandleScales=function(){var e=1/this._scale;for(var t in this.cropHandles){var i=this.cropHandles[t];i.scale.x=i.scale.y=e}},Kp.prototype.updateDraggerBounds=function(){var e=this.sourceTexture.width/2-this.cropWidth/2,t=this.sourceTexture.height/2-this.cropHeight/2;this.dragger.setBounds(-e,-t,e,t)},Kp.prototype.updateOrientation=function(){this.orientation=this.cropHeight/this.cropWidth<1?"landscape":"portrait"},Kp.prototype.setSmoothingScale=function(e){this.uncroppedSprite.currentScale=e,this.croppedSprite.currentScale=e},Kp.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null,this.uncroppedSprite.texture=PIXI.Texture.EMPTY,this.croppedSprite.texture=PIXI.Texture.EMPTY),this.cropFrame.x=this.cropFrame.y=0},Kp.prototype.handleCropFramePress=function(e){BFN.ImageCrop.sourceTexture&&(this.updateDraggerBounds(),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCropFrameDraggingBind),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCropFrameDraggingCompleteBind),this.dragger.drag(this.cropFrame))},Kp.prototype.handleCropFrameDragging=function(e){this.updateCropHandlePositions()},Kp.prototype.handleCropFrameDraggingComplete=function(e){this.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCropFrameDraggingBind),this.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCropFrameDraggingCompleteBind)},Kp.prototype.handleCropHandlePress=function(e){if(this.sourceTexture){this.currentCropHandle=this.cropHandles[e.target.id],this.dragger.setBounds(this.imageBounds.minX,this.imageBounds.minY,this.imageBounds.maxX,this.imageBounds.maxY),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCropHandleDraggingBind),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCropHandleDraggingCompleteBind);var t=this.currentCropHandle,i=this.currentCropHandle.anchorHandle;this.cropRatio=this.cropHeight/this.cropWidth;var r=Math.max(this.minCropSize,this.minCropSize/(this.cropRatioLocked?this.cropRatio:1)),a=Math.max(this.minCropSize,this.minCropSize*(this.cropRatioLocked?this.cropRatio:1));switch(t.id){case"tl":case"l":case"bl":this.dragger.bounds.maxX=i.x-r;break;case"tr":case"r":case"br":this.dragger.bounds.minX=i.x+r}switch(t.id){case"tl":case"t":case"tr":this.dragger.bounds.maxY=i.y-a;break;case"bl":case"b":case"br":this.dragger.bounds.minY=i.y+a}switch(t.id){case"l":case"r":this.dragger.bounds.minY=this.dragger.bounds.maxY=t.y;break;case"t":case"b":this.dragger.bounds.minX=this.dragger.bounds.maxX=t.x}this.dragger.drag(this.currentCropHandle),BFN.TooltipScreen.show("W: "+this.cropWidth+", H: "+this.cropHeight,!0,!0),BFN.TooltipScreen.setPosition(BeFunky.globalPointerCoords.x,BeFunky.globalPointerCoords.y)}},Kp.prototype.handleCropHandleDragging=function(e){var t=this.currentCropHandle,i=this.currentCropHandle.anchorHandle,r=Math.abs(i.x-t.x)||this.cropWidth,a=Math.abs(i.y-t.y)||this.cropHeight;if(this.cropRatioLocked)if("corner"==t.type){switch(r*(r*this.cropRatio)<a*(a/this.cropRatio)?r=a/this.cropRatio:a=r*this.cropRatio,t.id){case"tl":case"bl":i.x-r<this.dragger.bounds.minX&&(a=(r=i.x-this.dragger.bounds.minX)*this.cropRatio);break;case"tr":case"br":i.x+r>this.dragger.bounds.maxX&&(a=(r=this.dragger.bounds.maxX-i.x)*this.cropRatio)}switch(t.id){case"tl":case"tr":i.y-a<this.dragger.bounds.minY&&(r=(a=i.y-this.dragger.bounds.minY)/this.cropRatio);break;case"bl":case"br":i.y+a>this.dragger.bounds.maxY&&(r=(a=this.dragger.bounds.maxY-i.y)/this.cropRatio)}}else switch(t.id){case"l":case"r":a=r*this.cropRatio,this.cropFrame.y-a/2<this.imageBounds.minY&&(a=2*(this.cropFrame.y-this.imageBounds.minY)),this.cropFrame.y+a/2>this.imageBounds.maxY&&(a=2*(this.imageBounds.maxY-this.cropFrame.y)),r=a/this.cropRatio;break;case"t":case"b":r=a/this.cropRatio,this.cropFrame.x-r/2<this.imageBounds.minX&&(r=2*(this.cropFrame.x-this.imageBounds.minX)),this.cropFrame.x+r/2>this.imageBounds.maxX&&(r=2*(this.imageBounds.maxX-this.cropFrame.x)),a=r*this.cropRatio}this.cropWidth=Math.floor(r),this.cropHeight=Math.floor(a),this.updateCropFrameCenter(),this.updateOrientation(),UITools.setToolValue("crop","orientation",this.orientation),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop"),BFN.TooltipScreen.setMessage("W: "+this.cropWidth+", H: "+this.cropHeight)},Kp.prototype.handleCropHandleDraggingComplete=function(e){this.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCropHandleDraggingBind),this.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCropHandleDraggingCompleteBind),this.currentCropHandle=null,BFN.TooltipScreen.hide()},Object.defineProperty(Kp.prototype,"toolScale",{set:function(e){this._scale=e,this.dragger.scale=this._scale,this.cropGrid.scale=this._scale,this.updateCropHandleVisibility(),this.updateCropHandleScales(),this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Kp.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.round(this.cropWidth),Math.round(this.cropHeight)),t=Math.max(-(this.sourceTexture.width-e.width),Math.min(0,-(this.cropHandles.tl.x+this.cropFrameContainer.x))),i=Math.max(-(this.sourceTexture.height-e.height),Math.min(0,-(this.cropHandles.tl.y+this.cropFrameContainer.y)));return e.copyPixels(this.sourceTexture,new PIXI.Point(t,i)),e}}),Object.defineProperty(Kp.prototype,"cropOffsetLeft",{get:function(){return-(this.cropHandles.l.x+this.cropHandles.r.x)/2}}),Object.defineProperty(Kp.prototype,"cropOffsetTop",{get:function(){return-(this.cropHandles.t.y+this.cropHandles.b.y)/2}}),Object.defineProperty(Kp.prototype,"cropRect",{get:function(){return new BFN.Rectangle(Math.round(this.cropHandles.l.x-this.imageBounds.minX),Math.round(this.cropHandles.t.y-this.imageBounds.minY),Math.round(this.cropWidth),Math.round(this.cropHeight))}}),Object.defineProperty(BFN,"ImageCrop",{get:function(){return!BFN._ImageCrop&&(BFN._ImageCrop=new Kp),BFN._ImageCrop}}),Qp.prototype=Object.create(PIXI.Sprite.prototype),Qp.prototype.init=function(){BeFunky.log("ImagePaintBrush Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initPainter()},Qp.prototype.initDefaultValues=function(){this._scale=1,this.sourceTexture=null},Qp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Qp.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Qp.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="blend_picture",this.painter.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.painter.lowerResolutionForLargeImages=!1,this.imageContainer.addChild(this.painter)},Qp.prototype.handlePaintBrush=function(){BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_PAINT_BRUSH&&this.updatePaintBrushParameters()},Qp.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=e?(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),UITools.setToolValue("paint_brush","erase",!1),UITools.setToolValue("paint_brush","blend_mode",BFN.CONST.BLEND_MODES.NORMAL),UITools.setToolValue("paint_brush","opacity",1),UITools.updateToolControls("paint_brush"),this.updatePaintBrushParameters()):this.painter.reset()},Qp.prototype.updatePaintBrushParameters=function(){var e=UITools.getToolVO("paint_brush");if(e){this.painter.blendMode!=e.blend_mode&&(this.painter.blendMode=e.blend_mode),this.painter.alpha!=e.opacity&&(this.painter.alpha=e.opacity),e.clear&&(this.painter.clear(!0),UITools.setToolValue("paint_brush","erase",!1),UITools.updateToolControl("paint_brush_erase")),this.painter.eraseMode!=e.erase&&(this.painter.eraseMode=e.erase),e.updating&&"size"==e.updating_id&&this.painter.brushSizeFactor!=e.size/100&&(this.painter.brushSizeFactor=e.size/100);var t=!1;e.updating||"size"!=e.updating_id&&this.painter.brushSizeFactor==e.size/100||(this.painter.brushSizeFactor=e.size/100,t=!0),e.updating||"hardness"!=e.updating_id&&this.painter.brushHardnessFactor==e.hardness/100||(this.painter.brushHardnessFactor=e.hardness/100,t=!0),e.updating||"strength"!=e.updating_id&&this.painter.brushStrengthFactor==e.strength/100||(this.painter.brushStrengthFactor=e.strength/100,t=!0),e.updating||"color"!=e.updating_id&&this.painter.brushColor=="0x"+e.color||(this.painter.brushColor="0x"+e.color,t=!0),t&&this.painter.updateBrush()}},Qp.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.painter.currentScale=e},Object.defineProperty(Qp.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Qp.prototype,"modifiedTexture",{get:function(){if(this.sourceTexture){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),this.removeChild(this.imageContainer),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.addChild(this.imageContainer),e}return null}}),Object.defineProperty(BFN,"ImagePaintBrush",{get:function(){return!BFN._ImagePaintBrush&&(BFN._ImagePaintBrush=new Qp),BFN._ImagePaintBrush}}),Zp.prototype=Object.create(PIXI.Sprite.prototype),Zp.prototype.init=function(){BeFunky.log("ImageClone Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initCloneSprite(),this.initPainter(),this.initTargetSprite(),this.initDestinationSprite()},Zp.prototype.initDefaultValues=function(){this._scale=1,this.originalTexture=null,this.sourceTexture=null,this.mouseDown=!1,this.waiting=!1,this.targetSet=!1,this.cloneOffsetPoint=null,this.erasing=!1,this.ctrlKeyCodes=[17,91,93],this.ctrlKeyCode=null,this.ctrlKeyDown=!1,this.handlePainterMouseDownBind=this.handlePainterMouseDown.bind(this),this.handlePainterMouseMoveBind=this.handlePainterMouseMove.bind(this),this.handlePainterMouseOverBind=this.handlePainterMouseOver.bind(this),this.handlePainterMouseOutBind=this.handlePainterMouseOut.bind(this),this.handlePainterKeyDownBind=this.handlePainterKeyDown.bind(this),this.handlePainterKeyUpBind=this.handlePainterKeyUp.bind(this),this.handleBrushCircleAnimatorUpdateBind=this.handleBrushCircleAnimatorUpdate.bind(this)},Zp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Zp.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Zp.prototype.initCloneSprite=function(){this.cloneContainer=new PIXI.Container,this.imageContainer.addChild(this.cloneContainer),this.cloneSprite=new PIXI.Sprite,this.cloneSprite.pluginName="smooth_picture",this.cloneContainer.addChild(this.cloneSprite)},Zp.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.allowBrushCircle=!0,this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_UPDATED_PRE_HISTORY.type,this.handlePaintUpdatedPreHistory.bind(this)),this.cloneContainer.addChild(this.painter),this.cloneSprite.mask=this.painter},Zp.prototype.initTargetSprite=function(){var e,t,i=Math.round(23);this.targetTexture=PIXI.RenderTexture.create(i,i),e=3,t=i/2-1-.5-1,BFN.graphics.drawShape("roundedRect",this.targetTexture,{fillColor:2147483648,paddingX:e,paddingY:t,clear:!0}),BFN.graphics.drawShape("roundedRect",this.targetTexture,{fillColor:2147483648,paddingX:t,paddingY:e,clear:!1}),BFN.graphics.drawShape("ellipse",this.targetTexture,{strokeWidth:3,strokeColor:2147483648,clear:!1}),e=2.5,t=i/2-1-1,BFN.graphics.drawShape("roundedRect",this.targetTexture,{fillColor:4294967295,paddingX:e,paddingY:t,clear:!1}),BFN.graphics.drawShape("roundedRect",this.targetTexture,{fillColor:4294967295,paddingX:t,paddingY:e,clear:!1}),BFN.graphics.drawShape("ellipse",this.targetTexture,{strokeWidth:2,strokeColor:4294967295,paddingX:.5,paddingY:.5,clear:!1}),this.target=new PIXI.Container,this.target.interactive=!1,this.addChild(this.target),this.targetSprite=new PIXI.Sprite(this.targetTexture),this.targetSprite.interactive=!1,this.targetSprite.hitArea=new PIXI.Rectangle(0,0,0,0),this.targetSprite.anchor.x=this.targetSprite.anchor.y=.5,this.target.addChild(this.targetSprite)},Zp.prototype.initDestinationSprite=function(){var e,t,i=Math.round(23);this.destinationTexture=PIXI.RenderTexture.create(i,i),e=0,t=i/2-1-.5-1,BFN.graphics.drawShape("roundedRect",this.destinationTexture,{fillColor:2147483648,paddingX:e,paddingY:t,clear:!0}),BFN.graphics.drawShape("roundedRect",this.destinationTexture,{fillColor:2147483648,paddingX:t,paddingY:e,clear:!1}),e=0,t=i/2-1-1,BFN.graphics.drawShape("roundedRect",this.destinationTexture,{fillColor:4294967295,paddingX:e,paddingY:t,clear:!1}),BFN.graphics.drawShape("roundedRect",this.destinationTexture,{fillColor:4294967295,paddingX:t,paddingY:e,clear:!1}),this.destination=new PIXI.Container,this.destination.interactive=!1,this.addChild(this.destination),this.destinationSprite=new PIXI.Sprite(this.destinationTexture),this.destinationSprite.interactive=!1,this.destinationSprite.hitArea=new PIXI.Rectangle(0,0,0,0),this.destinationSprite.anchor.x=this.destinationSprite.anchor.y=.5,this.destination.addChild(this.destinationSprite)},Zp.prototype.handleClone=function(){BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CLONE&&this.updateCloneParameters()},Zp.prototype.setSourceTexture=function(e){this.originalTexture=null,null!=this.sourceTexture&&(this.sourceTexture.destroyGC(!0),this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=e?(this.originalTexture=e,this.sourceTexture=PIXI.RenderTexture.create(e.width,e.height),this.sourceTexture.copyPixels(e),this.sourceSprite.texture=this.sourceTexture,this.cloneSprite.texture=this.sourceTexture,this.painter.altTexture=this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.updateCloneParameters(),this.resetTarget(),this.painter.on("pointerdown",this.handlePainterMouseDownBind),BFN.MainUI.on("pointermove",this.handlePainterMouseMoveBind),this.painter.on("pointerover",this.handlePainterMouseOverBind),this.painter.on("pointerout",this.handlePainterMouseOutBind),BFN.BrushCircle.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleBrushCircleAnimatorUpdateBind)):(this.painter.reset(),BFN.BrushCircle.targetEnabled=!1,UITools.setToolValue("clone","brush_erase",!1),UITools.updateToolControl("clone_brush_erase"),this.painter.off("pointerdown",this.handlePainterMouseDownBind),BFN.MainUI.off("pointermove",this.handlePainterMouseMoveBind),this.painter.off("pointerover",this.handlePainterMouseOverBind),this.painter.off("pointerout",this.handlePainterMouseOutBind),this.handlePainterMouseOutBind(),BFN.BrushCircle.animator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleBrushCircleAnimatorUpdateBind))},Zp.prototype.resetTarget=function(){this.targetSet=!1,this.targetSprite.visible=!1,this.destinationSprite.visible=!1,this.cloneOffsetPoint=null,this.cloneSprite.x=this.cloneSprite.y=0,BFN.BrushCircle.targetEnabled=!0,this.painter.paintingEnabled=!1,BFN.MainUI.requestRender()},Zp.prototype.updateCloneParameters=function(){var e=UITools.getToolVO("clone");if(e){e.target_reset&&this.resetTarget(),e.brush_clear&&(this.painter.clear(!0),this.sourceTexture.copyPixels(this.originalTexture),UITools.setToolValue("clone","brush_erase",!1),UITools.updateToolControl("clone_brush_erase")),this.erasing!=e.brush_erase&&(this.erasing=e.brush_erase,BFN.BrushCircle.targetEnabled=!this.targetSet&&!this.erasing,this.cloneSprite.x=this.cloneSprite.y=0,this.erasing?this.cloneSprite.texture=this.originalTexture:(this.cloneSprite.texture=this.sourceTexture,this.cloneOffsetPoint&&(this.cloneSprite.x=-Math.round(this.cloneOffsetPoint.x),this.cloneSprite.y=-Math.round(this.cloneOffsetPoint.y)))),e.updating&&"brush_size"==e.updating_id&&this.painter.brushSizeFactor!=e.brush_size/100&&(this.painter.brushSizeFactor=e.brush_size/100);var t=!1;e.updating||"brush_size"!=e.updating_id&&this.painter.brushSizeFactor==e.brush_size/100||(this.painter.brushSizeFactor=e.brush_size/100,t=!0),e.updating||"brush_hardness"!=e.updating_id&&this.painter.brushSizeFactor==e.brush_hardness/100||(this.painter.brushHardnessFactor=e.brush_hardness/100,t=!0),e.updating||"brush_strength"!=e.updating_id&&this.painter.brushOpacityFactor==e.brush_strength/100||(this.painter.brushOpacityFactor=e.brush_strength/100,t=!0),t&&this.painter.updateBrush()}},Zp.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.cloneSprite.currentScale=e,this.painter.currentScale=e},Zp.prototype.handlePainterMouseDown=function(e){if(!this.erasing){var t=this.painter.getPointerPosition(e);!this.targetSet||this.ctrlKeyDown?(this.ctrlKeyDown&&this.resetTarget(),this.targetSet=!0,this.targetSprite.visible=!0,this.destinationSprite.visible=!0,this.target.x=t.x+this.imageContainer.x,this.target.y=t.y+this.imageContainer.y,this.target.alpha=1,this.target.visible=!0,BFN.BrushCircle.targetEnabled=!1,this.painter.paintingEnabled=!0,e.data.originalEvent.stopImmediatePropagation()):this.cloneOffsetPoint||(this.cloneOffsetPoint=new PIXI.Point(this.target.x-this.imageContainer.x-t.x,this.target.y-this.imageContainer.y-t.y),this.cloneSprite.x=-Math.round(this.cloneOffsetPoint.x),this.cloneSprite.y=-Math.round(this.cloneOffsetPoint.y)),this.cloneOffsetPoint&&(this.target.x=t.x+this.imageContainer.x+this.cloneOffsetPoint.x,this.target.y=t.y+this.imageContainer.y+this.cloneOffsetPoint.y,this.destination.x=t.x+this.imageContainer.x,this.destination.y=t.y+this.imageContainer.y),BFN.MainUI.requestRender()}},Zp.prototype.handlePainterMouseMove=function(e){if(this.mouseDown&&!this.painter.mouseDown&&!this.waiting)return this.mouseDown=!1,this.waiting=!0,void setTimeout(function(){this.waiting=!1}.bind(this),50);if(!this.waiting){this.mouseDown=this.painter.mouseDown;var t=this.painter.getPointerPosition(e);this.cloneOffsetPoint&&(this.target.x=t.x+this.imageContainer.x+this.cloneOffsetPoint.x,this.target.y=t.y+this.imageContainer.y+this.cloneOffsetPoint.y),this.destination.x=t.x+this.imageContainer.x,this.destination.y=t.y+this.imageContainer.y}},Zp.prototype.handlePainterMouseOver=function(e){document.addEventListener("keydown",this.handlePainterKeyDownBind,!1)},Zp.prototype.handlePainterMouseOut=function(e){document.removeEventListener("keydown",this.handlePainterKeyDownBind)},Zp.prototype.handlePainterKeyDown=function(e){!this.targetSet||this.erasing||this.ctrlKeyDown||-1==this.ctrlKeyCodes.indexOf(e.keyCode)||(this.targetSprite.visible=!1,this.destinationSprite.visible=!1,BFN.MainUI.requestRender(),BFN.BrushCircle.targetEnabled=!0,this.ctrlKeyDown=!0,this.ctrlKeyCode=e.keyCode,document.addEventListener("keyup",this.handlePainterKeyUpBind,!1))},Zp.prototype.handlePainterKeyUp=function(e){this.ctrlKeyDown&&this.ctrlKeyCode==e.keyCode&&(this.targetSet&&(this.targetSprite.visible=!0,this.destinationSprite.visible=!0,BFN.MainUI.requestRender()),BFN.BrushCircle.targetEnabled=!1,this.ctrlKeyDown=!1,this.ctrlKeyCode=null,document.removeEventListener("keyup",this.handlePainterKeyUpBind))},Zp.prototype.handleBrushCircleAnimatorUpdate=function(e){this.target.alpha=this.destination.alpha=BFN.BrushCircle.animator.animationFactor,this.target.visible=this.destination.visible=this.target.alpha>0&&!this.erasing,this.targetSet&&!this.cloneOffsetPoint&&(this.target.alpha=1,this.target.visible=!0)},Zp.prototype.handlePaintUpdatedPreHistory=function(e){this.setSmoothingScale(1),BFN.Stage.render(this.cloneContainer,this.sourceTexture,!1),this.setSmoothingScale(this._scale),this.painter.clear(!1)},Object.defineProperty(Zp.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.target.scale.x=this.target.scale.y=1/this._scale,this.destination.scale.x=this.destination.scale.y=1/this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Zp.prototype,"modifiedTexture",{get:function(){if(this.sourceTexture){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),e}return null}}),Object.defineProperty(BFN,"ImageClone",{get:function(){return!BFN._ImageClone&&(BFN._ImageClone=new Zp),BFN._ImageClone}}),Jp.prototype=Object.create(PIXI.Sprite.prototype),Jp.prototype.init=function(){BeFunky.log("ImageBlemish Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initResultSprite(),this.initPainter()},Jp.prototype.initDefaultValues=function(){this._scale=1,this.sourceTexture=null,this.resultTexture=null,this.erasing=!1,this.replaceFilter=new BFN.filters.ReplaceFilter,this.alphaFilter=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.ALPHA),this.blendModeSprite=new BFN.BlendModeSprite(!1),this.eraseSprite=new PIXI.Sprite,this.handleAltBitmapDataUpdatedBind=this.handleAltBitmapDataUpdated.bind(this)},Jp.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Jp.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite},Jp.prototype.initResultSprite=function(){this.resultSprite=new PIXI.Sprite,this.imageContainer.addChild(this.resultSprite)},Jp.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.brushEnabled=!1,this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handleBrushApplied.bind(this)),this.imageContainer.addChild(this.painter)},Jp.prototype.handleBlemish=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_BLEMISH_FIX){var e=UITools.getToolVO("blemish_fix");if(e){e.brush_clear&&(this.painter.clear(!0),this.resultTexture.copyPixels(this.sourceTexture),UITools.setToolValue("blemish_fix","brush_erase",!1),UITools.updateToolControl("blemish_fix_brush_erase")),this.erasing=e.brush_erase,this.painter.singleClick==this.erasing&&(this.painter.singleClick=!this.erasing);var t=e.brush_size/100*.2+.1,i=e.brush_size/100*.08+.02;e.updating&&"brush_size"==e.updating_id&&this.painter.brushSizeFactor!=t&&(this.painter.brushSizeFactor=t);var r=!1;e.updating||"brush_size"!=e.updating_id&&this.painter.brushSizeFactor==t||(this.painter.brushSizeFactor=t,r=!0),e.updating||"brush_hardness"!=e.updating_id&&this.painter.brushHardnessFactor==i||(this.painter.brushHardnessFactor=e.brush_hardness/100,r=!0),r&&this.painter.updateBrush()}}},Jp.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.sourceSprite.texture=PIXI.Texture.EMPTY;try{this.resultTexture.destroyGC(!0)}catch(e){}this.resultTexture=null,this.resultSprite.texture=PIXI.Texture.EMPTY,this.painter.altTexture=null,BFN.ImagePainterUndoManager.removeEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltBitmapDataUpdatedBind)},Jp.prototype.setSourceTexture=function(e){this.reset(),e?(this.imageContainer.x=-Math.round(e.width/2),this.imageContainer.y=-Math.round(e.height/2),this.sourceTexture=e,this.resultTexture=e.renderClone(),this.sourceSprite.texture=this.sourceTexture,this.resultSprite.texture=this.resultTexture,this.painter.altTexture=this.resultTexture,BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltBitmapDataUpdatedBind),UITools.setToolValue("blemish_fix","brush_erase",!1),UITools.setToolValue("blemish_fix","brush_size",50),UITools.setToolValue("blemish_fix","brush_hardness",40),UITools.updateToolControls("blemish_fix")):(this.imageContainer.x=0,this.imageContainer.y=0),this.updatePainter()},Jp.prototype.updatePainter=function(){this.sourceTexture?this.painter.painterWidth==this.sourceTexture.width&&this.painter.painterHeight==this.sourceTexture.height||this.painter.setup(this.sourceTexture.width,this.sourceTexture.height):this.painter.reset()},Jp.prototype.removeBlemish=function(){if(this.resultTexture){var e=new PIXI.Rectangle(this.painter.brushRect.x,this.painter.brushRect.y,this.painter.brushRect.width,this.painter.brushRect.height),t=PIXI.RenderTexture.create(e.width,e.height);t.copyPixels(this.resultTexture,new PIXI.Point(-e.x,-e.y)),this.replaceDarksWithAverage(t);for(var i=BFN.Util.getTextureAverageColor(t,!0),r=this.getColorBrightness(i),a=[],n=PIXI.RenderTexture.create(e.width,e.height),o=[],s=0;s<8;s++){var l=0,h=0;switch(s){case 0:case 1:case 7:l=-Math.floor(e.width/2);break;case 3:case 4:case 5:l=Math.floor(e.width/2)}switch(s){case 1:case 2:case 3:h=-Math.floor(e.height/2);break;case 5:case 6:case 7:l=Math.floor(e.height/2)}var c=new PIXI.Rectangle(e.x+l,e.y+h,e.width,e.height);n.copyPixels(this.resultTexture,new PIXI.Point(-c.x,-c.y));var u=this.getColorBrightness(BFN.Util.getTextureAverageColor(n,!0));a.push(c),o.push(u)}for(var d=0,m=1,p=0;p<o.length;p++){var g=o[p],f=Math.abs(r-g);f<m&&(d=p,m=f)}var v=a[d];n.copyPixels(this.resultTexture,new PIXI.Point(-v.x,-v.y)),a.splice(0),o.splice(0);var y=t.renderClone();this.blendModeSprite.setBaseTexture(y),this.blendModeSprite.setBlendTexture(n),this.blendModeSprite.setBlendMode(BFN.CONST.BLEND_MODES.LIGHTEN),this.blendModeSprite.renderDisplay(),this.alphaFilter.intensity=1,this.alphaFilter.iChannel1=this.painter.brush.texture,this.blendModeSprite.filters=[this.alphaFilter],BFN.Stage.render(this.blendModeSprite,t),y.destroyGC(!0),this.resultTexture.copyPixels(t,new PIXI.Point(e.x,e.y),!1),t.destroyGC(!0),n.destroyGC(!0)}BFN.MainUI.requestRender()},Jp.prototype.erase=function(){if(this.sourceTexture&&this.resultTexture){var e=new PIXI.Rectangle(this.painter.brushRect.x,this.painter.brushRect.y,this.painter.brushRect.width,this.painter.brushRect.height),t=PIXI.RenderTexture.create(e.width,e.height);t.copyPixels(this.sourceTexture,new PIXI.Point(-e.x,-e.y));var i=t.renderClone();this.eraseSprite.texture=i,this.alphaFilter.intensity=1,this.alphaFilter.iChannel1=this.painter.brush.texture,this.eraseSprite.filters=[this.alphaFilter],BFN.Stage.render(this.eraseSprite,t),i.destroyGC(!0),this.resultTexture.copyPixels(t,new PIXI.Point(e.x,e.y),!1),t.destroyGC(!0),this.eraseSprite.texture=PIXI.Texture.EMPTY}BFN.MainUI.requestRender()},Jp.prototype.replaceDarksWithAverage=function(e){this.replaceFilter.mode="darks";var t=BFN.Util.getTextureAverageColor(e,!0);this.replaceFilter.color=t;var i=e.renderClone(),r=new PIXI.Sprite(i);r.filters=[this.replaceFilter],BFN.Stage.render(r,e),i.destroyGC(!0),r.filters=[],r.destroy(!0)},Jp.prototype.getColorBrightness=function(e){var t=this.hexToRGB(e);return Math.sqrt(t[0]*t[0]*.241+t[1]*t[1]*.691+t[2]*t[2]*.068)/255},Jp.prototype.hexToRGB=function(e){return[e>>16&255,e>>8&255,255&e]},Jp.prototype.handleBrushApplied=function(e){this.erasing?this.erase():this.removeBlemish()},Jp.prototype.handleAltBitmapDataUpdated=function(e){},Object.defineProperty(Jp.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale},get:function(){return this._scale}}),Object.defineProperty(Jp.prototype,"modifiedTexture",{get:function(){if(this.sourceTexture){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=this.imageContainer.y=0,BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),e}return null}}),Object.defineProperty(BFN,"ImageBlemish",{get:function(){return!BFN._ImageBlemish&&(BFN._ImageBlemish=new Jp),BFN._ImageBlemish}}),$p.prototype=Object.create(PIXI.Sprite.prototype),$p.prototype.init=function(){BeFunky.log("ImageBackground Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initMaskBlendSprite(),this.initMaskSprite(),this.initPainter()},$p.prototype.initDefaultValues=function(){this._scale=1,this.sourceTexture=null,this.transparent=!0},$p.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},$p.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},$p.prototype.initMaskBlendSprite=function(){this.maskBlendSprite=new BFN.MaskBlendSprite,this.maskBlendSprite.pluginName="smooth_picture",this.maskBlendSprite.useInputAlpha=!0,this.imageContainer.addChild(this.maskBlendSprite)},$p.prototype.initMaskSprite=function(){this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.maskSprite.interactive=!1,this.imageContainer.addChild(this.maskSprite)},$p.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.imageContainer.addChild(this.painter),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handlePainterUpdated.bind(this)),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED.type,this.handlePainterPaintAppliedUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED.type,this.handlePainterPaintingEnabledUpdated.bind(this))},$p.prototype.handleBackground=function(){if(BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_BACKGROUND){var e=UITools.getToolVO("background");this.transparent!==e.transparent&&(this.transparent=e.transparent,requestAnimationFrame(()=>{UITools.disableControlItem("background_fill_color",this.transparent),UITools.disableControlItem("background_fill_amount",this.transparent),UITools.disableControlItem("background_opacity",this.transparent)}));var t=this.transparent?0:e.opacity/100,i=this.transparent?-1:e.fill_color,r=this.transparent?1:e.fill_amount/100;this.maskBlendSprite.unmaskedAlpha!=t&&(this.maskBlendSprite.unmaskedAlpha=t),this.maskBlendSprite.blendColor!=i&&(this.maskBlendSprite.blendColor=i),this.maskBlendSprite.blendIntensity!=r&&(this.maskBlendSprite.blendIntensity=r)}},$p.prototype.handleBackgroundBrush=function(){this.updateBackgroundBrushParameters()},$p.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),e?(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.maskBlendSprite.inputTexture=this.sourceTexture,this.maskSprite.width=this.sourceTexture.width,this.maskSprite.height=this.sourceTexture.height,this.imageContainer.x=-Math.round(e.width/2),this.imageContainer.y=-Math.round(e.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.transparent=!1,this.inverse=!1,this.updateMaskDisplay(),UITools.setToolValue("background","transparent",!0),UITools.setToolValue("background","fill_color","FFFFFF"),UITools.setToolValue("background","fill_amount",100),UITools.setToolValue("background","opacity",100),UITools.updateToolControls("background"),UITools.setToolValue("background_brush","show_mask",!1),UITools.setToolValue("background_brush","select_action","subtract"),UITools.updateToolControls("background_brush"),this.updateBackgroundBrushParameters()):(this.maskBlendSprite.reset(),this.painter.reset())},$p.prototype.updateBackgroundBrushParameters=function(){var e=UITools.getToolVO("background_brush");if(e){if("isolate_subject"===e.updating_id&&!e.updating)return void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,this.inverse,()=>{UITools.setToolValue("background_brush","select_action","add"),UITools.updateToolControl("background_brush_select_action");var t="subtract"===e.select_action?this.inverse:!this.inverse;this.painter.eraseMode!=t&&(this.painter.eraseMode=t)});e.clear&&(this.painter.clear(!0),UITools.setToolValue("background_brush","erase",!1),UITools.updateToolControl("background_brush_erase"),this.maskBlendSprite.updateDisplay(),this.inverse&&(this.inverse=!1,this.updateMaskDisplay())),this.showMask!==e.show_mask&&(this.showMask=e.show_mask,this.updateMaskDisplay()),"invert"==e.updating_id&&(this.inverse=!this.inverse,this.updateMaskDisplay());var t="subtract"===e.select_action?this.inverse:!this.inverse;this.painter.eraseMode!=t&&(this.painter.eraseMode=t),e.updating&&"size"==e.updating_id&&this.painter.brushSizeFactor!=e.size/100&&(this.painter.brushSizeFactor=e.size/100);var i=!1;e.updating||"size"!=e.updating_id&&this.painter.brushSizeFactor==e.size/100||(this.painter.brushSizeFactor=e.size/100,i=!0),e.updating||"hardness"!=e.updating_id&&this.painter.brushHardnessFactor==e.hardness/100||(this.painter.brushHardnessFactor=e.hardness/100,i=!0),e.updating||"strength"!=e.updating_id&&this.painter.brushStrengthFactor==e.strength/100||(this.painter.brushStrengthFactor=e.strength/100,i=!0),i&&this.painter.updateBrush()}},$p.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=!!(null===e?this.showMask:e),this.sourceSprite.visible=e,this.maskBlendSprite.visible=!e,this.maskSprite.visible=e&&(this.painter.paintApplied||this.inverse);var t=this.painter.isSetup&&this.painter.paintApplied?this.painter:null;this.maskSprite.mask!==t&&(this.maskSprite.mask=t),this.painter.renderable=!1,BFN.MainUI.requestRender()},$p.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.maskBlendSprite.currentScale=e,this.painter.currentScale=e},$p.prototype.handlePainterUpdated=function(e){BFN.ImagePainterUndoManager.currentImagePainter===this.painter&&this.painter.isSetup&&(this.maskBlendSprite.maskTexture!==this.painter.texture&&(this.maskBlendSprite.maskTexture=this.painter.texture),this.maskBlendSprite.updateDisplay())},$p.prototype.handlePainterPaintAppliedUpdated=function(e){this.updateMaskDisplay()},$p.prototype.handlePainterPaintingEnabledUpdated=function(){this.painter.isSetup&&!this.painter.paintingEnabled&&this.showMask&&(UITools.setToolValue("background_brush","show_mask",!1),UITools.updateToolControl("background_brush_show_mask"),this.showMask=UITools.getToolValue("background_brush","show_mask"),this.updateMaskDisplay())},Object.defineProperty($p.prototype,"showMask",{set:function(e){this._showMask=e,this.maskBlendSprite.autoRender=!this.showMask},get:function(){return this._showMask}}),Object.defineProperty($p.prototype,"inverse",{set:function(e){this._inverse=e,this.maskBlendSprite.inverse=this._inverse,this.painter.inverseMask=this._inverse},get:function(){return this._inverse}}),Object.defineProperty($p.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty($p.prototype,"modifiedTexture",{get:function(){if(this.sourceTexture){this.maskBlendSprite.displayUpdatePending&&this.maskBlendSprite.renderDisplay();var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.updateMaskDisplay(),e}return null}}),Object.defineProperty(BFN,"ImageBackground",{get:function(){return!BFN._ImageBackground&&(BFN._ImageBackground=new $p),BFN._ImageBackground}}),eg.prototype=Object.create(PIXI.Sprite.prototype),eg.prototype.init=function(){BeFunky.log("ImageCutout Init"),this.initDefaultValues(),this.initImageContainer(),this.initDisplay(),this.initCutoutOptionsModal()},eg.prototype.initDefaultValues=function(){this._scale=1,this._backgroundColor=-1,this.cutoutActive=!1,this.PIx2=2*Math.PI,this.PId4=Math.PI/4,this.sourceTexture=null,this.itemWidth=0,this.itemHeight=0,this.shapePoints=[],this.selectionPoints=[],this.shapeStartPoint=null,this.selectionStartPoint=null,this.selectionMode=null,this.inverse=!1,this.erase=!1,this.invertSelection=!1,this.trimTransparency=!0,this.tolerance=.5,this.shiftKey=!1,this.spaceKey=!1,this.pressedKeyCodes=[],this.alphaBoundsMaxSize=1024,this.alphaBoundsAdjustScale=1,this.initialLumaColor=0,this.isNewCanvas=!1,this.cutoutRect=null,this.shapeBounds={minX:0,minY:0,maxX:0,maxY:0},this.featherBase=1024,this.featherAmount=1,this.featherAmountMax=1,this.featherAmountMin=0,this.featherFilter=new BFN.filters.GaussianBlurFilter,this.inverseFilter=new BFN.filters.LevelsFilter,this.inverseFilter.minOutputValue=1,this.inverseFilter.maxOutputValue=0,this.selectionStrength=1,this.readyCallback=null,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.handleMouseDownBind=this.handleMouseDown.bind(this),this.handleMouseMoveBind=this.handleMouseMove.bind(this),this.handleMouseUpBind=this.handleMouseUp.bind(this),this.handleKeyDownBind=this.handleKeyDown.bind(this),this.handleKeyUpBind=this.handleKeyUp.bind(this),this.handlePaintingCompleteBind=this.handlePaintingComplete.bind(this),this.handleCanvasScalingUpdatedBind=this.handleCanvasScalingUpdated.bind(this),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltTextureUpdated.bind(this))},eg.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.imageContainer.interactive=!0,this.imageContainer.on("pointerover",this.handleMouseOverBind),this.imageContainer.on("pointerout",this.handleMouseOutBind),this.imageContainer.on("pointerdown",this.handleMouseDownBind),this.addChild(this.imageContainer)},eg.prototype.initDisplay=function(){this.lumaTexture=null,this.alphaTexture=null,this.alphaBoundsTexture=null,this.selectionShape=new PIXI.Graphics,this.selectionSprite=new PIXI.Sprite,this.selectionSprite.pluginName="smooth_picture",this.touchSurface=new PIXI.Graphics,this.addChild(this.touchSurface),this.backgroundGraphic=new PIXI.Graphics,this.imageContainer.addChild(this.backgroundGraphic),this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite),this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.imageContainer.addChild(this.maskSprite),this.lumaSprite=new PIXI.Sprite,this.alphaSprite=new PIXI.Sprite,this.imageContainer.addChild(this.alphaSprite),this.quickSelectTextureMaxSize=2048,this.quickSelectTextureScaleFactor={xy:1,x:1,y:1},this.quickSelectRadius=0,this.quickSelectRadiusMin=0,this.quickSelectRadiusMax=0,this.quickSelectRegionSize=0,this.quickSelectPoints=[],this.quickSelectSprite=new PIXI.Sprite,this.quickSelectSprite.alpha=.5,this.quickSelectSprite.pluginName="blend_picture",this.quickSelectSprite.currentScale=.75,this.imageContainer.addChild(this.quickSelectSprite),this.magicBrushFilter=new BFN.filters.MagicBrushFilter,this.quickSelectRegionSprite=new PIXI.Sprite,this.quickSelectRegionSprite.filters=[this.magicBrushFilter],this.painter=new BFN.ImagePainter,this.painter.alpha=.5,this.painter.tint=16711680,this.painter.dispatchEventsAfterUpdate=!1,this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_COMPLETE.type,this.handlePaintingCompleteBind),this.painter.preRedoCallback=(()=>{this.lumaTexture&&(-1===BFN.ImagePainterUndoManager.regionIndex||0===BFN.ImagePainterUndoManager.regionIndex&&"undo"===BFN.ImagePainterUndoManager.direction)&&this.lumaTexture.fillColor(this.initialLumaColor)}),this.imageContainer.addChild(this.painter),this.inverseSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.inverseSprite.texture.fillColor(16777215,1),this.inverseSprite.blendMode=21,this.imageContainer.addChild(this.inverseSprite),this.selectionCanvas=new PIXI.Graphics,this.addChild(this.selectionCanvas),this.inverseSprite.mask=this.selectionCanvas},eg.prototype.initCutoutOptionsModal=function(){this.cutoutOptionsModal=document.getElementById("cutout_options_modal"),BFN.UI.cutoutOptionsModal(this.cutoutOptionsModal)},eg.prototype.handleCutout=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT){var e=UITools.getToolVO("cutout");if("remove_background"===e.updating_id&&!e.updating)return void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,this.inverse,()=>{this.updateAlphaTexture()});var t=!1;e.updating||"clear"!=e.updating_id||(this.painter.clear(),this.resetLumaTexture(),t=!0),this.selectionMode!=e.mode&&(this.selectionMode=e.mode,this.inverseSprite.visible=this.selectionCanvas.visible="brush"!=this.selectionMode,UITools.toggleControlItem("cutout_brush_size",["brush","magic_brush"].includes(this.selectionMode)),UITools.toggleControlItem("cutout_strength","magic_brush"!=this.selectionMode),UITools.toggleControlItem("cutout_hardness","magic_brush"!=this.selectionMode),UITools.toggleControlItem("cutout_tolerance","magic_brush"==this.selectionMode),this.painter.paintingEnabled="brush"==this.selectionMode),this.backgroundColor!==e.background_color&&(this.backgroundColor=e.background_color);var i=e.brush_size/100;if(e.updating&&"brush_size"==e.updating_id&&this.painter.brushSizeFactor!=i&&(this.painter.brushSizeFactor=i),e.updating||"brush_size"!=e.updating_id&&this.painter.brushSizeFactor==i||(this.painter.brushSizeFactor=i,this.painter.updateBrush()),!e.updating){this.cutoutOptionsModal.trimTransparency!=e.trim_transparency&&(this.cutoutOptionsModal.trimTransparency=e.trim_transparency),this.tolerance=e.tolerance/100,this.magicBrushFilter.tolerance=this.tolerance,this.selectionStrength=e.strength/100,this.featherAmount=(this.featherAmountMax-this.featherAmountMin)*(1-e.hardness/100)+this.featherAmountMin;var r=e.hardness/100;if(this.painter.brushStrengthFactor==this.selectionStrength&&this.painter.brushHardnessFactor==r||(this.painter.brushStrengthFactor=this.selectionStrength,this.painter.brushHardnessFactor=r,this.painter.updateBrush()),this.featherFilter.blur!=this.featherAmount&&(this.featherFilter.blur=this.featherAmount),this.showMask!=e.show_mask&&(this.showMask=e.show_mask,this.updateMaskDisplay()),"invert"==e.updating_id&&(this.inverse=!this.inverse,t=!0),this.erase="subtract"==e.select_action,"options_modal_cancel"==e.updating_id)this.cutoutOptionsModal.close();else if("options_modal_apply"==e.updating_id){if(this.trimTransparency=e.trim_transparency,e.export_as_layer){var a=this.trimTransparency?this.cutoutOptionsModal.trimTexture.renderClone():this.cutoutOptionsModal.fullTexture.renderClone(),n=BFN.ImageLibraryManager.createMenuImageVOFromTexture(a),o=this.cutoutRect.clone(),s={type:"frame_texture",texture:n.imageTexture,projectItemAssetID:n.id};BFN.TransformModel.layerItem||(s.initialPosition=this.trimTransparency?new PIXI.Point(o.x,o.y):new PIXI.Point,s.initialScale=new PIXI.Point(1,1)),this.cutoutOptionsModal.close(),UITools.setToolValue("editor_apply_cancel","cancel",!0,!1),UITools.applyTool("editor_apply_cancel"),UITools.setToolValue("editor_apply_cancel","cancel",!1,!1),BFN.TransformModel.layerItem&&BFN.TransformItemIsolator.active?(this.exportedItemObject=s,BFN.TransformItemIsolator.reselectOnReleaseComplete=!1):BFN.PhotoEditorCanvasModel.addedItem=s,UITools.setToolValue("editor_main","image_manager",!0),UITools.applyTool("editor_main"),UITools.setToolValue("editor_main","image_manager",!1)}else this.cutoutOptionsModal.close(),BFN.applyCancelMenu.alternateApply=!1,UITools.setToolValue("editor_apply_cancel","apply",!0,!1),UITools.applyTool("editor_apply_cancel"),UITools.setToolValue("editor_apply_cancel","apply",!1,!1);return}}t&&!this.isNewCanvas&&this.updateAlphaTexture(),this.isNewCanvas=!1}},eg.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.sourceSprite.texture=PIXI.Texture.EMPTY;try{this.lumaTexture.destroyGC(!0)}catch(e){}this.lumaTexture=null,this.lumaSprite.texture=PIXI.Texture.EMPTY;try{this.alphaTexture.destroyGC(!0)}catch(e){}this.alphaTexture=null,this.alphaSprite.texture=PIXI.Texture.EMPTY;try{this.alphaBoundsTexture.destroyGC(!0)}catch(e){}this.alphaBoundsTexture=null;try{this.quickSelectSourceTexture.destroyGC(!0)}catch(e){}this.quickSelectSourceTexture=null;try{this.quickSelectTexture.destroyGC(!0)}catch(e){}this.quickSelectTexture=null,this.quickSelectSprite.texture=PIXI.Texture.EMPTY;try{this.quickSelectRegionTexture.destroyGC(!0)}catch(e){}this.quickSelectRegionTexture=null,this.quickSelectRegionSprite.texture=PIXI.Texture.EMPTY;try{this.quickSelectRegionResultTexture.destroyGC(!0)}catch(e){}this.quickSelectRegionResultTexture=null;try{this.quickSelectRegionUnionTexture.destroyGC(!0)}catch(e){}this.quickSelectRegionUnionTexture=null,this.magicBrushFilter.unionTexture=PIXI.Texture.EMPTY,this.painter.altTexture=null,this.touchSurface.clear(),BFN.BrushCircle.showing&&BFN.BrushCircle.hide(!0),BFN.PhotoEditorCanvasModel.removeEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),BFN.CollageMakerCanvasModel.removeEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),BFN.DesignerCanvasModel.removeEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind)},eg.prototype.setSourceTexture=function(e){if(this.reset(),e){BFN.applyCancelMenu.alternateApply=!BFN.TransformItemIsolator.active||BFN.TransformItemIsolator.active&&BFN.TransformItemIsolator.usingAlternateMenu,this.trimTransparency=!0,this.itemWidth=e.width,this.itemHeight=e.height,this.imageContainer.x=-Math.round(e.width/2),this.imageContainer.y=-Math.round(e.height/2),this.sourceTexture=e,this.lumaTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.lumaTexture.fillColor(0),this.alphaTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.alphaTexture.fillColor(0);var t=this.quickSelectTextureMaxSize/Math.max(this.sourceTexture.width,this.sourceTexture.height),i=Math.round(this.sourceTexture.width*t),r=Math.round(this.sourceTexture.height*t);this.quickSelectTextureScaleFactor.xy=t,this.quickSelectTextureScaleFactor.x=i/this.sourceTexture.width,this.quickSelectTextureScaleFactor.y=r/this.sourceTexture.height,this.quickSelectSourceTexture=PIXI.RenderTexture.create(i,r),this.quickSelectSourceTexture.copyPixels(this.sourceTexture,null,!0,null,this.quickSelectTextureScaleFactor),this.quickSelectTexture=PIXI.RenderTexture.create(i,r),this.quickSelectTexture.clear(),this.quickSelectRegionTexture=PIXI.RenderTexture.create(32,32),this.quickSelectRegionTexture.clear(),this.quickSelectRegionResultTexture=PIXI.RenderTexture.create(32,32),this.quickSelectRegionResultTexture.clear(),this.quickSelectRegionUnionTexture=PIXI.RenderTexture.create(32,32),this.quickSelectRegionUnionTexture.clear(),this.alphaBoundsAdjustScale=Math.min(1,this.alphaBoundsMaxSize/this.sourceTexture.width,this.alphaBoundsMaxSize/this.sourceTexture.height),this.alphaBoundsTexture=PIXI.RenderTexture.create(Math.round(this.sourceTexture.width*this.alphaBoundsAdjustScale),Math.round(this.sourceTexture.height*this.alphaBoundsAdjustScale)),this.alphaBoundsTexture.fillColor(0),this.sourceSprite.texture=this.sourceTexture,this.lumaSprite.texture=this.lumaTexture,this.alphaSprite.texture=this.alphaTexture,this.quickSelectSprite.texture=this.quickSelectTexture,this.quickSelectSprite.scale.x=1/this.quickSelectTextureScaleFactor.x,this.quickSelectSprite.scale.y=1/this.quickSelectTextureScaleFactor.y,this.quickSelectRegionSprite.texture=this.quickSelectRegionTexture,this.magicBrushFilter.unionTexture=this.quickSelectRegionUnionTexture,this.maskSprite.width=this.itemWidth,this.maskSprite.height=this.itemHeight,this.touchSurface.beginFill(16777215,0),this.touchSurface.drawRect(-2*this.sourceTexture.width,-2*this.sourceTexture.height,5*this.sourceTexture.width,5*this.sourceTexture.height),this.touchSurface.endFill(),this.inverseSprite.x=-2*this.sourceTexture.width,this.inverseSprite.y=-2*this.sourceTexture.height,this.inverseSprite.scale.x=this.sourceTexture.width/this.inverseSprite.texture.baseTexture.width*5,this.inverseSprite.scale.y=this.sourceTexture.height/this.inverseSprite.texture.baseTexture.height*5,this.painter.altTexture=this.lumaTexture,this.updateCutoutRect(!0),this.isNewCanvas=!0,this.featherAmountMax=1,this.featherAmountMin=0,this.inverse=!1,this.showMask=!1,UITools.setToolValue("cutout","show_mask",!1),UITools.setToolValue("cutout","select_action","subtract"),UITools.updateToolControls("cutout");var a=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents,BFN.CollageMakerCanvasModelEvents,BFN.DesignerCanvasModelEvents);a.addEventListener(n.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),requestAnimationFrame(()=>{this.readyCallback&&(this.readyCallback(),this.readyCallback=null)})}else this.imageContainer.x=0,this.imageContainer.y=0;this.updatePainter(),this.resetLumaTexture(),this.updateAlphaTexture(),this.backgroundColor=this.backgroundColor},eg.prototype.updateQuickSelectRegionTextures=function(){this.quickSelectRadius=Math.round(this.painter.brushRadius*this.quickSelectTextureScaleFactor.xy),this.quickSelectRegionSize=2*this.quickSelectRadius,this.quickSelectRegionTexture.width==this.quickSelectRegionSize&&this.quickSelectRegionTexture.height==this.quickSelectRegionSize||(this.quickSelectRegionTexture.resize(this.quickSelectRegionSize,this.quickSelectRegionSize),this.quickSelectRegionResultTexture.resize(this.quickSelectRegionSize,this.quickSelectRegionSize),this.quickSelectRegionUnionTexture.resize(this.quickSelectRegionSize,this.quickSelectRegionSize))},eg.prototype.updatePainter=function(){this.sourceTexture?this.painter.painterWidth==this.sourceTexture.width&&this.painter.painterHeight==this.sourceTexture.height||this.painter.setup(this.sourceTexture.width,this.sourceTexture.height):this.painter.reset()},eg.prototype.resetLumaTexture=function(){this.lumaTexture&&this.lumaTexture.fillColor(0)},eg.prototype.updateAlphaTexture=function(){if(this.lumaTexture&&this.alphaTexture){var e=this.inverse||BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction;this.lumaSprite.filters=e?[this.inverseFilter]:[],BFN.Stage.render(this.lumaSprite,this.alphaTexture),this.lumaSprite.filters=[]}this.updateCutoutRect(!0),this.updateMaskDisplay()},eg.prototype.updateCutoutRect=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.cutoutRect=null,this.alphaTexture&&this.alphaBoundsTexture)if(e)this.cutoutRect=new BFN.Rectangle(0,0,this.alphaTexture.width,this.alphaTexture.height);else{this.alphaBoundsTexture.copyPixels(this.alphaTexture,new PIXI.Point,!0,1,this.alphaBoundsAdjustScale);var i=t?this.alphaBoundsTexture:BFN.Util.getThumbTexture(this.alphaBoundsTexture,128),r=t?1/this.alphaBoundsAdjustScale:this.sourceTexture.width/i.width,a=BFN.Util.getAlphaBounds(i,null,r,!0);i!==this.alphaBoundsTexture&&i.destroyGC(!0),a.width&&a.height&&(this.cutoutRect=new BFN.Rectangle(a.minX,a.minY,a.width,a.height))}},eg.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(e=!!(null===e?this.showMask:e))?(this.sourceSprite.mask=null,this.alphaSprite.visible=!0,this.maskSprite.mask=this.alphaSprite,this.maskSprite.visible=!0):(this.maskSprite.mask=null,this.maskSprite.visible=!1,!(BFN.ImagePainterUndoManager.regionIndex<0||0===BFN.ImagePainterUndoManager.regionIndex&&"undo"===BFN.ImagePainterUndoManager.direction)?(this.alphaSprite.visible=!0,this.sourceSprite.mask=this.alphaSprite):(this.alphaSprite.visible=!1,this.sourceSprite.mask=null))},eg.prototype.processFeather=function(e){if(this.featherAmount){var t=Math.max(e.width,e.height),i=this.featherBase/t,r=Math.round(e.width*i),a=Math.round(e.height*i),n=PIXI.RenderTexture.create(r,a);n.copyPixels(e,null,null,null,{x:n.width/e.width,y:n.height/e.height});var o=new PIXI.Sprite(n);this.featherFilter.setInputDimensions(n.width,n.height),o.filters=[this.featherFilter];var s=PIXI.RenderTexture.create(n.width,n.height);BFN.Stage.render(o,s),e.copyPixels(s,null,null,null,{x:e.width/n.width,y:e.height/n.height}),n.destroyGC(!0),o.filters=[],o.destroy(!1),s.destroyGC(!0)}},eg.prototype.showCutoutOptionsModal=function(){var e=this.getCutoutTexture(!1),t=this.getCutoutTexture(!0);if(e&&t)this.cutoutOptionsModal.open(e,t);else{try{e.destroyGC(!0)}catch(e){}try{t.destroyGC(!0)}catch(e){}}},eg.prototype.startQuickSelect=function(){this.updateQuickSelectRegionTextures();var e=this.imageContainer.getPointerPosition(this.pointerEvent),t=e.x>=0&&e.x<this.sourceTexture.width&&e.y>=0&&e.y<this.sourceTexture.height;e.x=Math.max(0,Math.min(this.sourceTexture.width,e.x)),e.y=Math.max(0,Math.min(this.sourceTexture.height,e.y)),this.shapeBounds.minX=this.shapeBounds.maxX=e.x,this.shapeBounds.minY=this.shapeBounds.maxY=e.x,this.mousePosition=e;var i=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.moveTo(i.x,i.y),this.cutoutActive=!0,this.quickSelectBounds=null,t&&this.quickSelect(e)},eg.prototype.moveQuickSelect=function(){var e=this.imageContainer.getPointerPosition(this.pointerEvent);this.mousePosition||(this.mousePosition=e);var t=e.x-this.mousePosition.x,i=e.y-this.mousePosition.y;if(Math.sqrt(Math.pow(t,2)+Math.pow(i,2))>1/this._scale){var r=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(r.x,r.y),this.dragQuickSelectTo(e),this.mousePosition=e}};function Sg(){PIXI.Container.call(this),this.init()}function Cg(){PIXI.Container.call(this),this.init()}function Bg(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function Fg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;PIXI.Container.call(this),this.side=e,this.gridChild=t,this.init()}function Eg(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function Pg(){PIXI.Container.call(this),this.init()}function Ng(){PIXI.Container.call(this),this.init()}function Mg(){PIXI.Container.call(this),this.init()}function Dg(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function wg(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function kg(){PIXI.Sprite.call(this),this.init()}function Lg(){PIXI.Sprite.call(this),this.init()}function Og(){PIXI.Container.call(this),this.init()}function Rg(){PIXI.Sprite.call(this),this.init()}function Ag(){PIXI.Sprite.call(this),this.init()}function Vg(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function Ug(){var t=e(['\n            <div class="gallery__author gallery__item-content">\n                <a href="','" target="_blank" rel="noopener">',"</a> | ","\n            </div>"]);return Ug=function(){return t},t}eg.prototype.stopQuickSelect=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.quickSelectBounds){var t=Math.round((this.quickSelectBounds.maxX-this.quickSelectBounds.minX)/this.quickSelectTextureScaleFactor.x),i=Math.round((this.quickSelectBounds.maxY-this.quickSelectBounds.minY)/this.quickSelectTextureScaleFactor.y);if(t>0&&i>0){this.selectionSprite.texture=PIXI.RenderTexture.create(t,i),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1,this.quickSelectSprite.fillColor=this.invertSelection?0:16777215,this.quickSelectSprite.intensity=1,this.quickSelectSprite.x=-this.quickSelectBounds.minX/this.quickSelectTextureScaleFactor.x,this.quickSelectSprite.y=-this.quickSelectBounds.minY/this.quickSelectTextureScaleFactor.y,this.quickSelectSprite.alpha=1,BFN.Stage.render(this.quickSelectSprite,this.selectionSprite.texture),delete this.quickSelectSprite.fillColor,delete this.quickSelectSprite.intensity,this.quickSelectSprite.x=0,this.quickSelectSprite.y=0,this.quickSelectSprite.alpha=.5,this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.quickSelectBounds.minX/this.quickSelectTextureScaleFactor.x,this.selectionSprite.y=this.quickSelectBounds.minY/this.quickSelectTextureScaleFactor.y;var r=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,r,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.lumaTexture.copyPixels(r,null,!1),r.destroyGC(!0),this.painter.paintBounds=new PIXI.Rectangle(Math.floor(this.selectionSprite.x),Math.floor(this.selectionSprite.y),t+1,i+1),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.quickSelectTexture.clear(),this.selectionCanvas.clear(),e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},eg.prototype.dragQuickSelectTo=function(e){if(this.sourceTexture){for(var t=Math.floor(e.x)-this.mousePosition.x,i=Math.floor(e.y)-this.mousePosition.y,r=Math.sqrt(t*t+i*i),a=Math.atan2(i,t),n=this.quickSelectRadius/4,o=Math.max(1,Math.ceil(r/Math.max(1,n))),s=this.mousePosition.x,l=this.mousePosition.y,h=1;h<=o;h++){var c=Math.max(0,Math.min(this.sourceTexture.width,Math.floor(s+Math.cos(a)*r*(h/o)))),u=Math.max(0,Math.min(this.sourceTexture.height,Math.floor(l+Math.sin(a)*r*(h/o))));(h<=4||h==o)&&this.quickSelectPoints.push({x:c,y:u})}for(;this.quickSelectPoints.length;){var d=this.quickSelectPoints.shift();this.quickSelect(d)}}},eg.prototype.quickSelect=function(e){if(this.sourceTexture){var t=Math.round(e.x*this.quickSelectTextureScaleFactor.x),i=Math.round(e.y*this.quickSelectTextureScaleFactor.y),r=Math.round(t-this.quickSelectRadius),a=Math.round(i-this.quickSelectRadius);this.quickSelectBounds||(this.quickSelectBounds={minX:Math.round(t),minY:Math.round(i),maxX:Math.round(t),maxY:Math.round(i)}),this.quickSelectBounds.minX=Math.max(0,Math.min(this.quickSelectBounds.minX,r,this.quickSelectTexture.width)),this.quickSelectBounds.minY=Math.max(0,Math.min(this.quickSelectBounds.minY,a,this.quickSelectTexture.height)),this.quickSelectBounds.maxX=Math.min(this.quickSelectTexture.width,Math.max(this.quickSelectBounds.maxX,r+this.quickSelectRegionSize,0)),this.quickSelectBounds.maxY=Math.min(this.quickSelectTexture.height,Math.max(this.quickSelectBounds.maxY,a+this.quickSelectRegionSize,0)),this.quickSelectRegionTexture.copyPixels(this.quickSelectSourceTexture,{x:-r,y:-a}),this.quickSelectRegionUnionTexture.copyPixels(this.quickSelectTexture,{x:-r,y:-a}),this.quickSelectTexture.clearRect(r,a,this.quickSelectRegionSize,this.quickSelectRegionSize),BFN.Stage.render(this.quickSelectRegionSprite,this.quickSelectRegionResultTexture,!1),this.quickSelectTexture.copyPixels(this.quickSelectRegionResultTexture,{x:r,y:a},!1),BFN.MainUI.requestRender()}},eg.prototype.startLasso=function(){var e=this.imageContainer.getPointerPosition(this.pointerEvent);e.x=Math.max(0,Math.min(this.sourceTexture.width,e.x)),e.y=Math.max(0,Math.min(this.sourceTexture.height,e.y)),this.shapePoints.push(new PIXI.Point(e.x,e.y)),this.shapeBounds.minX=this.shapeBounds.maxX=e.x,this.shapeBounds.minY=this.shapeBounds.maxY=e.x,this.mousePosition=e;var t=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.moveTo(t.x,t.y),this.cutoutActive=!0},eg.prototype.moveLasso=function(){var e=this.imageContainer.getPointerPosition(this.pointerEvent);e.x=Math.max(0,Math.min(this.sourceTexture.width,e.x)),e.y=Math.max(0,Math.min(this.sourceTexture.height,e.y)),this.mousePosition||(this.mousePosition=e);var t=e.x-this.mousePosition.x,i=e.y-this.mousePosition.y;if(Math.sqrt(Math.pow(t,2)+Math.pow(i,2))>1){this.shapePoints.push(new PIXI.Point(e.x,e.y)),this.shapeBounds.minX=Math.min(this.shapeBounds.minX,e.x),this.shapeBounds.minY=Math.min(this.shapeBounds.minY,e.y),this.shapeBounds.maxX=Math.max(this.shapeBounds.maxX,e.x),this.shapeBounds.maxY=Math.max(this.shapeBounds.maxY,e.y),this.mousePosition=e;var r=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(r.x,r.y)}},eg.prototype.stopLasso=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.shapePoints.length){var t=this.shapeBounds.maxX-this.shapeBounds.minX,i=this.shapeBounds.maxY-this.shapeBounds.minY;if(t>0&&i>0){var r=1/Math.max(1,Math.max(t,i)/BFN.maxImageSize)*2;this.selectionShape.clear(),this.selectionShape.moveTo(this.shapePoints[0].x*r,this.shapePoints[0].y*r),this.selectionShape.beginFill(this.invertSelection?0:16777215);for(var a=1;a<this.shapePoints.length;a++)this.selectionShape.lineTo(this.shapePoints[a].x*r,this.shapePoints[a].y*r);this.selectionShape.endFill(),this.selectionShape.x=-this.shapeBounds.minX*r,this.selectionShape.y=-this.shapeBounds.minY*r,this.selectionSprite.texture=PIXI.RenderTexture.create(Math.round(t*r),Math.round(i*r)),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1/r,BFN.Stage.render(this.selectionShape,this.selectionSprite.texture),this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.shapeBounds.minX,this.selectionSprite.y=this.shapeBounds.minY;var n=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,n,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.processFeather(n),this.lumaTexture.copyPixels(n,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05))),n.destroyGC(!0);var o={minX:this.shapeBounds.minX,minY:this.shapeBounds.minY,maxX:this.shapeBounds.maxX,maxY:this.shapeBounds.maxY};if(this.featherAmount){var s=Math.ceil(.26*this.featherBase*this.featherAmount);o.minX=Math.max(0,o.minX-s),o.minY=Math.max(0,o.minY-s),o.maxX=Math.min(this.lumaTexture.width,o.maxX+s),o.maxY=Math.min(this.lumaTexture.height,o.maxY+s)}this.painter.paintBounds=new PIXI.Rectangle(o.minX,o.minY,o.maxX-o.minX,o.maxY-o.minY),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.selectionCanvas.clear(),this.shapePoints.splice(0),e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},eg.prototype.startPolygon=function(){if((this.thisTapTime=performance.now(),this.lastTapTime)&&this.thisTapTime-this.lastTapTime<200)return void this.stopPolygon();this.lastTapTime=this.thisTapTime,BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind);var e=this.shiftKey&&this.snapShapePoint?this.snapShapePoint:this.imageContainer.getPointerPosition(this.pointerEvent),t=this.shiftKey&&this.snapShapePoint?this.snapSelectionPoint:this.selectionCanvas.getPointerPosition(this.pointerEvent);if(this.shapeStartPoint||(this.shapeBounds.minX=this.shapeBounds.maxX=e.x,this.shapeBounds.minY=this.shapeBounds.maxY=e.y,this.shapeStartPoint=e,this.selectionStartPoint=t),this.shapePoints.length){this.shapeBounds.minX=Math.min(this.shapeBounds.minX,e.x),this.shapeBounds.minY=Math.min(this.shapeBounds.minY,e.y),this.shapeBounds.maxX=Math.max(this.shapeBounds.maxX,e.x),this.shapeBounds.maxY=Math.max(this.shapeBounds.maxY,e.y);var i=e.x-this.shapeStartPoint.x,r=e.y-this.shapeStartPoint.y,a=Math.sqrt(Math.pow(i,2)+Math.pow(r,2)),n=this.shapePoints[this.shapePoints.length-1],o=e.x-n.x,s=e.y-n.y,l=Math.sqrt(Math.pow(o,2)+Math.pow(s,2));if(a<5/this._scale||l<1/this._scale)return void this.stopPolygon()}this.shapePoints.push(e),this.selectionPoints.push(t),this.movePolygon(),BFN.MainUI.requestRender(),BFN.TransformModel.layerItem?UIToggler.toggleAlternateMenuInteractivity(!1):(UIToggler.toggleNavBar(!1),UIToggler.toggleMainMenu(!1),UIToggler.toggleZoomMenu(!1)),this.cutoutActive=!0},eg.prototype.movePolygon=function(){if(this.selectionPoints.length){var e=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.clear(),this.selectionCanvas.moveTo(this.selectionStartPoint.x,this.selectionStartPoint.y);for(var t=0;t<this.selectionPoints.length;t++)this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(this.selectionPoints[t].x,this.selectionPoints[t].y);if(this.shiftKey){var i=this.shapePoints[this.selectionPoints.length-1],r=this.selectionPoints[this.selectionPoints.length-1],a=e.x-r.x,n=e.y-r.y,o=Math.sqrt(Math.pow(a,2)+Math.pow(n,2)),s=e.x-r.x,l=e.y-r.y,h=Math.sqrt(Math.pow(s,2)+Math.pow(l,2)),c=(Math.atan2(l,s)+this.PIx2)%this.PIx2,u=Math.round(c/this.PId4);this.snapShapePoint=new PIXI.Point,this.snapShapePoint.x=i.x+Math.cos(u*this.PId4)*o,this.snapShapePoint.y=i.y+Math.sin(u*this.PId4)*o,this.snapSelectionPoint=new PIXI.Point,this.snapSelectionPoint.x=r.x+Math.cos(u*this.PId4)*h,this.snapSelectionPoint.y=r.y+Math.sin(u*this.PId4)*h,this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(this.snapSelectionPoint.x,this.snapSelectionPoint.y)}else this.snapShapePoint=null,this.snapSelectionPoint=null,this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(e.x,e.y)}},eg.prototype.stopPolygon=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.shapePoints.length>2){var t=this.shapeBounds.maxX-this.shapeBounds.minX,i=this.shapeBounds.maxY-this.shapeBounds.minY;if(t>0&&i>0){var r=1/Math.max(1,Math.max(t,i)/BFN.maxImageSize)*2;this.selectionShape.clear(),this.selectionShape.moveTo(this.shapePoints[0].x*r,this.shapePoints[0].y*r),this.selectionShape.beginFill(this.invertSelection?0:16777215);for(var a=1;a<this.shapePoints.length;a++)this.selectionShape.lineTo(this.shapePoints[a].x*r,this.shapePoints[a].y*r);this.selectionShape.endFill(),this.selectionShape.x=-this.shapeBounds.minX*r,this.selectionShape.y=-this.shapeBounds.minY*r,this.selectionSprite.texture=PIXI.RenderTexture.create(Math.round(t*r),Math.round(i*r)),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1/r,BFN.Stage.render(this.selectionShape,this.selectionSprite.texture),this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.shapeBounds.minX,this.selectionSprite.y=this.shapeBounds.minY;var n=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,n,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.processFeather(n),this.lumaTexture.copyPixels(n,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05))),n.destroyGC(!0);var o={minX:this.shapeBounds.minX,minY:this.shapeBounds.minY,maxX:this.shapeBounds.maxX,maxY:this.shapeBounds.maxY};if(this.featherAmount){var s=Math.ceil(.26*this.featherBase*this.featherAmount);o.minX=Math.max(0,o.minX-s),o.minY=Math.max(0,o.minY-s),o.maxX=Math.min(this.lumaTexture.width,o.maxX+s),o.maxY=Math.min(this.lumaTexture.height,o.maxY+s)}this.painter.paintBounds=new PIXI.Rectangle(o.minX,o.minY,o.maxX-o.minX,o.maxY-o.minY),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.selectionCanvas.clear(),this.shapePoints.splice(0),this.selectionPoints.splice(0),this.shapeStartPoint=null,this.selectionStartPoint=null,this.snapPoint=null,BFN.TransformModel.layerItem?UIToggler.toggleAlternateMenuInteractivity(!0):(UIToggler.toggleNavBar(!0),UIToggler.toggleMainMenu(!0),UIToggler.toggleZoomMenu(!0)),e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},eg.prototype.startCircle=function(){this.shapeStartPoint=this.imageContainer.getPointerPosition(this.pointerEvent),this.selectionStartPoint=this.selectionCanvas.getPointerPosition(this.pointerEvent),this.cutoutActive=!0},eg.prototype.moveCircle=function(){if(this.selectionStartPoint){var e=this.selectionCanvas.getPointerPosition(this.pointerEvent),t=Math.min(this.selectionStartPoint.x,e.x),i=Math.min(this.selectionStartPoint.y,e.y),r=Math.abs(this.selectionStartPoint.x-e.x),a=Math.abs(this.selectionStartPoint.y-e.y);this.shiftKey&&(r=a=Math.min(r,a),t=Math.max(t,this.selectionStartPoint.x-r),i=Math.max(i,this.selectionStartPoint.y-a)),this.selectionCanvas.clear(),this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.drawEllipse(t+r/2,i+a/2,r/2,a/2)}},eg.prototype.stopCircle=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.shapeStartPoint){var t=this.imageContainer.getPointerPosition(this.pointerEvent),i=Math.min(this.shapeStartPoint.x,t.x),r=Math.min(this.shapeStartPoint.y,t.y),a=Math.abs(this.shapeStartPoint.x-t.x),n=Math.abs(this.shapeStartPoint.y-t.y);if(this.shiftKey&&(a=n=Math.min(a,n),i=Math.max(i,this.shapeStartPoint.x-a),r=Math.max(r,this.shapeStartPoint.y-n)),this.shapeBounds.minX=i,this.shapeBounds.minY=r,this.shapeBounds.maxX=i+a,this.shapeBounds.maxY=r+n,a>0&&n>0){var o=1/Math.max(1,Math.max(a,n)/BFN.maxImageSize)*2;this.selectionShape.clear(),this.selectionShape.beginFill(this.invertSelection?0:16777215),this.selectionShape.drawEllipse((i+a/2)*o,(r+n/2)*o,a/2*o,n/2*o),this.selectionShape.endFill(),this.selectionShape.x=-this.shapeBounds.minX*o,this.selectionShape.y=-this.shapeBounds.minY*o,this.selectionSprite.texture=PIXI.RenderTexture.create(Math.round(a*o),Math.round(n*o)),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1/o,BFN.Stage.render(this.selectionShape,this.selectionSprite.texture),this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.shapeBounds.minX,this.selectionSprite.y=this.shapeBounds.minY;var s=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,s,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.processFeather(s),this.lumaTexture.copyPixels(s,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05))),s.destroyGC(!0);var l={minX:this.shapeBounds.minX,minY:this.shapeBounds.minY,maxX:this.shapeBounds.maxX,maxY:this.shapeBounds.maxY};if(this.featherAmount){var h=Math.ceil(.26*this.featherBase*this.featherAmount);l.minX=Math.max(0,l.minX-h),l.minY=Math.max(0,l.minY-h),l.maxX=Math.min(this.lumaTexture.width,l.maxX+h),l.maxY=Math.min(this.lumaTexture.height,l.maxY+h)}this.painter.paintBounds=new PIXI.Rectangle(l.minX,l.minY,l.maxX-l.minX,l.maxY-l.minY),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.selectionCanvas.clear(),this.shapeStartPoint=null,this.selectionStartPoint=null,e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},eg.prototype.startRectangle=function(){this.shapeStartPoint=this.imageContainer.getPointerPosition(this.pointerEvent),this.selectionStartPoint=this.selectionCanvas.getPointerPosition(this.pointerEvent),this.cutoutActive=!0},eg.prototype.moveRectangle=function(){if(this.selectionStartPoint){var e=this.selectionCanvas.getPointerPosition(this.pointerEvent),t=Math.min(this.selectionStartPoint.x,e.x),i=Math.min(this.selectionStartPoint.y,e.y),r=Math.abs(this.selectionStartPoint.x-e.x),a=Math.abs(this.selectionStartPoint.y-e.y);this.shiftKey&&(r=a=Math.min(r,a),t=Math.max(t,this.selectionStartPoint.x-r),i=Math.max(i,this.selectionStartPoint.y-a)),this.selectionCanvas.clear(),this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.drawRect(t,i,r,a)}},eg.prototype.stopRectangle=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.shapeStartPoint){var t=this.imageContainer.getPointerPosition(this.pointerEvent),i=Math.min(this.shapeStartPoint.x,t.x),r=Math.min(this.shapeStartPoint.y,t.y),a=Math.abs(this.shapeStartPoint.x-t.x),n=Math.abs(this.shapeStartPoint.y-t.y);if(this.shiftKey&&(a=n=Math.min(a,n),i=Math.max(i,this.shapeStartPoint.x-a),r=Math.max(r,this.shapeStartPoint.y-n)),this.shapeBounds.minX=i,this.shapeBounds.minY=r,this.shapeBounds.maxX=i+a,this.shapeBounds.maxY=r+n,a>0&&n>0){var o=1/Math.max(1,Math.max(a,n)/BFN.maxImageSize)*2;this.selectionShape.clear(),this.selectionShape.beginFill(this.invertSelection?0:16777215),this.selectionShape.drawRect(i*o,r*o,a*o,n*o),this.selectionShape.endFill(),this.selectionShape.x=-this.shapeBounds.minX*o,this.selectionShape.y=-this.shapeBounds.minY*o,this.selectionSprite.texture=PIXI.RenderTexture.create(Math.round(a*o),Math.round(n*o)),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1/o,BFN.Stage.render(this.selectionShape,this.selectionSprite.texture),this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.shapeBounds.minX,this.selectionSprite.y=this.shapeBounds.minY;var s=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,s,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.processFeather(s),this.lumaTexture.copyPixels(s,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05))),s.destroyGC(!0);var l={minX:this.shapeBounds.minX,minY:this.shapeBounds.minY,maxX:this.shapeBounds.maxX,maxY:this.shapeBounds.maxY};if(this.featherAmount){var h=Math.ceil(.26*this.featherBase*this.featherAmount);l.minX=Math.max(0,l.minX-h),l.minY=Math.max(0,l.minY-h),l.maxX=Math.min(this.lumaTexture.width,l.maxX+h),l.maxY=Math.min(this.lumaTexture.height,l.maxY+h)}this.painter.paintBounds=new PIXI.Rectangle(l.minX,l.minY,l.maxX-l.minX,l.maxY-l.minY),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.selectionCanvas.clear(),this.shapeStartPoint=null,this.selectionStartPoint=null,e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},eg.prototype.applyBrush=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.lumaTexture.copyPixels(this.painter.paintTexture,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05)),null,this.invertSelection?0:16777215),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)):this.painter.cancelPaintStroke(),this.painter.clear(!1),e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender()},eg.prototype.resetPressedKeys=function(){for(var e=this.pressedKeyCodes.length;--e>-1;){var t=this.pressedKeyCodes[e];this.handleKeyUpBind({keyCode:t})}},eg.prototype.getCutoutTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.updateCutoutRect(!1,!0),this.cutoutRect){var t=e?PIXI.RenderTexture.create(Math.min(this.sourceTexture.width,Math.ceil(this.cutoutRect.width)),Math.min(this.sourceTexture.height,Math.ceil(this.cutoutRect.height))):PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.sourceSprite.currentScale=1,this.imageContainer.x=e?-this.cutoutRect.x:0,this.imageContainer.y=e?-this.cutoutRect.y:0,this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,t),this.sourceSprite.currentScale=this._scale,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.updateMaskDisplay(),t}if(this.sourceTexture){var i=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return i.clear(),i}return null},eg.prototype.handleMouseOver=function(e){switch(this.selectionMode){case"magic_brush":BFN.CursorScreen.cursor="select_cross",BFN.BrushCircle.show(this.painter.brushRadius*this._scale,e,!0);break;case"lasso":BFN.CursorScreen.cursor="select_lasso";break;case"polygon":BFN.CursorScreen.cursor="select_poly";break;case"circle":case"rectangle":BFN.CursorScreen.cursor="select_cross"}},eg.prototype.handleMouseOut=function(e){switch(this.selectionMode){case"magic_brush":BFN.BrushCircle.hide(!0)}BFN.CursorScreen.cursor=null},eg.prototype.handleMouseDown=function(e){if(e)this.pointerEvent=e;else{if(!this.pointerEvent)return;e=this.pointerEvent}switch(this.invertSelection=e.data.originalEvent.altKey||this.erase,this.invertSelection=(!e.data.originalEvent.altKey||!this.erase)&&this.invertSelection,this.invertSelection=this.inverse?!this.invertSelection:this.invertSelection,this.shiftKey=e.data.originalEvent.shiftKey,this.selectionMode){case"magic_brush":this.startQuickSelect(e);break;case"lasso":this.startLasso(e);break;case"polygon":break;case"circle":this.startCircle(e);break;case"rectangle":this.startRectangle(e)}BFN.MainUI.on("pointermove",this.handleMouseMoveBind),BFN.MainUI.on("pointerup",this.handleMouseUpBind),BFN.MainUI.on("pointerupoutside",this.handleMouseUpBind),document.addEventListener("keydown",this.handleKeyDownBind),document.addEventListener("keyup",this.handleKeyUpBind),BFN.MainUI.requestRender()},eg.prototype.handleMouseMove=function(e){if(e)this.pointerEvent=e;else{if(!this.pointerEvent)return;e=this.pointerEvent}if(!this.spaceKey){switch(this.selectionMode){case"magic_brush":this.moveQuickSelect(e);break;case"lasso":this.moveLasso(e);break;case"polygon":this.movePolygon();break;case"circle":this.moveCircle(e);break;case"rectangle":this.moveRectangle(e)}BFN.MainUI.requestRender()}},eg.prototype.handleMouseUp=function(e){if(e)this.pointerEvent=e;else{if(!this.pointerEvent)return;e=this.pointerEvent}switch(this.shiftKey=e.data.originalEvent.shiftKey,this.selectionMode){case"magic_brush":this.stopQuickSelect();break;case"lasso":this.stopLasso();break;case"polygon":this.startPolygon();break;case"circle":this.stopCircle();break;case"rectangle":this.stopRectangle()}},eg.prototype.handlePaintingComplete=function(e){this.applyBrush()},eg.prototype.alternateHistoryAction=function(){return!!this.cutoutActive&&(this.handleKeyDown({keyCode:27}),!0)},eg.prototype.handleKeyDown=function(e){if(-1==this.pressedKeyCodes.indexOf(e.keyCode)){switch(this.pressedKeyCodes.push(e.keyCode),e.keyCode){case 16:this.shiftKey=!0,this.handleMouseMoveBind();break;case 32:this.spaceKey=!0,BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.START_CANVAS_DRAG);break;case 27:switch(this.pressedKeyCodes.splice(this.pressedKeyCodes.indexOf(27),1),this.selectionMode){case"magic_brush":this.stopQuickSelect(!1);break;case"lasso":this.stopLasso(!1);break;case"polygon":this.stopPolygon(!1);break;case"circle":this.stopCircle(!1);break;case"rectangle":this.stopRectangle(!1);break;case"brush":this.applyBrush(!1)}}this.painter.ignoreMouseMove=this.spaceKey}},eg.prototype.handleKeyUp=function(e){var t=this.pressedKeyCodes.indexOf(e.keyCode);if(t>=0){switch(this.pressedKeyCodes.splice(t,1),e.keyCode){case 16:this.shiftKey=!1,this.handleMouseMoveBind();break;case 32:this.spaceKey=!1,BFN.PhotoEditorCanvas.canvasDragger.stopDrag()}this.painter.ignoreMouseMove=this.spaceKey}},eg.prototype.handleAltTextureUpdated=function(e){BFN.ImagePainterUndoManager.undoExists||BFN.ImagePainterUndoManager.memoryFreed||this.resetLumaTexture(),this.updateAlphaTexture()},eg.prototype.handleCanvasScalingUpdated=function(e){"magic_brush"==this.selectionMode&&BFN.BrushCircle.showing&&!BFN.PhotoEditorCanvasModel.canvasScaling&&BFN.BrushCircle.show(this.painter.brushRadius*this._scale,this.pointerEvent,!0)},Object.defineProperty(eg.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.selectionCanvas.scale.x=this.selectionCanvas.scale.y=1/this._scale,this.sourceSprite.currentScale=this._scale},get:function(){return this._scale}}),Object.defineProperty(eg.prototype,"backgroundColor",{set:function(e){this._backgroundColor=e,this.backgroundGraphic.clear(),this.sourceTexture&&-1!==e&&(this.backgroundGraphic.beginFill(parseInt("0x"+this._backgroundColor)),this.backgroundGraphic.drawRect(0,0,this.itemWidth,this.itemHeight),this.backgroundGraphic.endFill())},get:function(){return this._backgroundColor}}),Object.defineProperty(eg.prototype,"modifiedTexture",{get:function(){return this.getCutoutTexture(this.trimTransparency)}}),Object.defineProperty(BFN,"ImageCutout",{get:function(){return!BFN._ImageCutout&&(BFN._ImageCutout=new eg),BFN._ImageCutout}}),tg.prototype=Object.create(PIXI.Sprite.prototype),tg.prototype.init=function(){BeFunky.log("ImageRotator Init"),this.initDefaultValues(),this.initCanvas(),this.initImage(),this.initGrid(),this.initRotatorMask(),this.initGridAnimator(),this.updateGridDisplay()},tg.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this.straightening=!1,this.straightenAngle=0,this.imageWidth=0,this.imageHeight=0,this.itemWidth=0,this.itemHeight=0,this.gridSegmentSize=40,this.rightAngleIndex=0,this.adjustedImageWidth=0,this.adjustedImageHeight=0,this.adjustedImageCenterBeta=0,this.imageCenterBeta=0,this.imageRadius=0,this.imageBetaOffset=0,this.cropScale=0,this.cropWidth=0,this.cropHeight=0},tg.prototype.initCanvas=function(){this.canvas=new PIXI.Container,this.addChild(this.canvas)},tg.prototype.initImage=function(){this.imageContainer=new PIXI.Container,this.canvas.addChild(this.imageContainer),this.image=new PIXI.Sprite,this.imageContainer.addChild(this.image)},tg.prototype.initGrid=function(){this.grid=new PIXI.Graphics,this.addChild(this.grid)},tg.prototype.initRotatorMask=function(){this.rotatorMask=new PIXI.Graphics,this.addChild(this.rotatorMask),this.mask=this.rotatorMask},tg.prototype.initGridAnimator=function(){this.gridAnimator=new BFN.Animator,this.gridAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleGridAnimatorUpdate.bind(this))},tg.prototype.handleRotate=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE){var e=UITools.getToolVO("rotate");switch(e.updating_id){case"rotate_clockwise":case"rotate_counter_clockwise":case"flip_horizontal":case"flip_vertical":this.performRotateAction(e.updating_id);break;case"straighten":this.straightenAngle=e.straighten*(Math.PI/180),this.updateStraightening(),!this.straightening&&e.updating?(this.straightening=!0,this.gridAnimator.increase()):this.straightening&&!e.updating&&(this.straightening=!1,this.gridAnimator.decrease())}}},tg.prototype.setSourceTexture=function(e){this.reset(),e&&(this.sourceTexture=e,this.image.texture=this.sourceTexture,this.setupRotator())},tg.prototype.setupRotator=function(){UITools.setToolValue("rotate","straighten",0),UITools.updateToolControl("rotate_straighten"),this.imageWidth=this.adjustedImageWidth=this.sourceTexture?this.sourceTexture.width:0,this.imageHeight=this.adjustedImageHeight=this.sourceTexture?this.sourceTexture.height:0,this.image.x=-this.imageWidth/2,this.image.y=-this.imageHeight/2,this.image.scale.x=1,this.image.scale.y=1,this.image.rotation=0,this.straightenAngle=0,this.rightAngleIndex=0,this.imageCenterBeta=this.adjustedImageCenterBeta=Math.atan2(this.imageHeight,this.imageWidth),this.imageRadius=Math.sqrt(Math.pow(this.imageWidth/2,2)+Math.pow(this.imageHeight/2,2)),this.updateStraightening(),this.drawRotatorMask(),this.drawGrid()},tg.prototype.performRotateAction=function(e){switch(e){case"rotate_clockwise":this.rightAngleIndex=(this.rightAngleIndex+1)%4;break;case"rotate_counter_clockwise":this.rightAngleIndex=(this.rightAngleIndex+4-1)%4;break;case"flip_horizontal":this.image.scale.x*=this.rightAngleIndex%2?1:-1,this.image.scale.y*=this.rightAngleIndex%2?-1:1;break;case"flip_vertical":this.image.scale.x*=this.rightAngleIndex%2?-1:1,this.image.scale.y*=this.rightAngleIndex%2?1:-1}this.image.rotation=this.rightAngleIndex*(Math.PI/2),this.imageBetaOffset=0,-1==this.image.scale.x&&-1==this.image.scale.y?this.imageBetaOffset=Math.PI:-1==this.image.scale.x?this.imageBetaOffset=Math.PI-2*this.imageCenterBeta:-1==this.image.scale.y&&(this.imageBetaOffset=-2*this.imageCenterBeta),this.image.x=-Math.cos(this.imageCenterBeta+this.image.rotation+this.imageBetaOffset)*this.imageRadius,this.image.y=-Math.sin(this.imageCenterBeta+this.image.rotation+this.imageBetaOffset)*this.imageRadius,this.updateStraightening(),this.drawRotatorMask(),BFN.MainUI.requestRender()},tg.prototype.updateStraightening=function(){this.adjustedImageWidth=this.rightAngleIndex%2?this.imageHeight:this.imageWidth,this.adjustedImageHeight=this.rightAngleIndex%2?this.imageWidth:this.imageHeight,this.adjustedImageCenterBeta=Math.atan2(this.adjustedImageHeight,this.adjustedImageWidth),this.imageContainer.rotation=this.straightenAngle;var e=this.imageContainer.rotation,t=Math.abs(e),i=this.adjustedImageWidth>this.adjustedImageHeight?this.adjustedImageCenterBeta:Math.PI/2-this.adjustedImageCenterBeta,r=Math.PI-i-t,a=Math.sin(r)?Math.sin(i)*this.imageRadius/Math.sin(r):this.imageRadius;this.cropScale=a/this.imageRadius,this.cropWidth=Math.round(this.adjustedImageWidth*this.cropScale),this.cropHeight=Math.round(this.adjustedImageHeight*this.cropScale),this.rotatorMask.scale.x=this.rotatorMask.scale.y=this.cropScale,this.itemWidth=this.cropWidth,this.itemHeight=this.cropHeight,BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()},tg.prototype.drawRotatorMask=function(){this.rotatorMask.clear(),this.rotatorMask.beginFill(16777215),this.rotatorMask.drawRect(-this.adjustedImageWidth/2,-this.adjustedImageHeight/2,this.adjustedImageWidth,this.adjustedImageHeight),this.rotatorMask.endFill()},tg.prototype.drawGrid=function(){if(this.sourceTexture){this.grid.scale.x=this.grid.scale.y=1/this._scale,this.gridSegmentSize=Math.round(Math.max(40,Math.round(Math.max(this.imageWidth,this.imageHeight)/20))*this._scale);var e=Math.ceil(Math.max(this.imageWidth,this.imageHeight)/this.gridSegmentSize)+2;e+=e%2?0:1,this.grid.clear();for(var t=0;t<e;t++){var i=Math.floor((e-1)/2*this.gridSegmentSize),r=Math.floor(t*this.gridSegmentSize-i);this.grid.lineStyle(3,0,.5),this.grid.moveTo(-i,r),this.grid.lineTo(i,r),this.grid.moveTo(r,-i),this.grid.lineTo(r,i)}for(var a=0;a<e;a++){var n=Math.floor((e-1)/2*this.gridSegmentSize),o=Math.floor(a*this.gridSegmentSize-n);this.grid.lineStyle(1,16777215,.5),this.grid.moveTo(-n,o),this.grid.lineTo(n,o),this.grid.moveTo(o,-n),this.grid.lineTo(o,n)}}},tg.prototype.updateGridDisplay=function(){this.grid.alpha=this.gridAnimator.animationFactor,this.grid.visible=this.grid.alpha>0},tg.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.image.texture=PIXI.Texture.EMPTY},tg.prototype.handleGridAnimatorUpdate=function(e){this.updateGridDisplay()},Object.defineProperty(tg.prototype,"toolScale",{set:function(e){this._scale=e,this.drawGrid()},get:function(){return this._scale}}),Object.defineProperty(tg.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.round(this.cropWidth),Math.round(this.cropHeight));return this.canvas.x=e.width/2,this.canvas.y=e.height/2,BFN.Stage.render(this.canvas,e),this.canvas.x=this.canvas.y=0,e}}),Object.defineProperty(BFN,"ImageRotator",{get:function(){return!BFN._ImageRotator&&(BFN._ImageRotator=new tg),BFN._ImageRotator}}),ig.prototype=Object.create(PIXI.Sprite.prototype),ig.prototype.init=function(){BeFunky.log("ImageResize Init"),this.initDefaultValues(),this.initDisplay()},ig.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this._scaling=!1,this.resizeWidth=0,this.resizeHeight=0,this.imageWidth=0,this.imageHeight=0,this.itemWidth=0,this.itemHeight=0,this.lockAspectRatio=!0,this.aspectRatio=1},ig.prototype.initDisplay=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer),this.image=new PIXI.Sprite,this.image.pluginName="smooth_picture",this.imageContainer.addChild(this.image)},ig.prototype.handleResize=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE){var e=UITools.getToolVO("resize");if(this.lockAspectRatio!=e.lock_aspect_ratio&&(this.lockAspectRatio=e.lock_aspect_ratio,this.lockAspectRatio&&(this.aspectRatio=this.resizeHeight/this.resizeWidth)),this.lockAspectRatio)switch(e.updating_id){case"resize_width":this.resizeHeight=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_width*this.aspectRatio)),this.resizeWidth=this.resizeHeight/this.aspectRatio;break;case"resize_height":this.resizeWidth=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_height/this.aspectRatio)),this.resizeHeight=this.resizeWidth*this.aspectRatio;break;case"resize_xscale":this.resizeHeight=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_xscale/100*this.imageWidth*this.aspectRatio)),this.resizeWidth=this.resizeHeight/this.aspectRatio;break;case"resize_yscale":this.resizeWidth=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_yscale/100*this.imageHeight/this.aspectRatio)),this.resizeHeight=this.resizeWidth*this.aspectRatio}else switch(e.updating_id){case"resize_width":case"resize_height":this.resizeWidth=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_width)),this.resizeHeight=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_height));break;case"resize_xscale":case"resize_yscale":this.resizeWidth=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_xscale/100*this.imageWidth)),this.resizeHeight=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_yscale/100*this.imageHeight))}this.image.isResize=!e.updating,this.resizeWidth=Math.round(this.resizeWidth),this.resizeHeight=Math.round(this.resizeHeight),UITools.setToolValue("resize","resize_width",this.resizeWidth),UITools.setToolValue("resize","resize_height",this.resizeHeight),UITools.setToolValue("resize","resize_xscale",Math.round(this.resizeWidth/this.imageWidth*100)),UITools.setToolValue("resize","resize_yscale",Math.round(this.resizeHeight/this.imageHeight*100)),UITools.updateToolControls("resize"),this.updateSize()}},ig.prototype.setSourceTexture=function(e){this.reset(),e&&(this.sourceTexture=e,this.image.texture=this.sourceTexture,this.image.isResize=!0,this.setupResizer(),UITools.setToolValue("resize","resize_width",this.imageWidth),UITools.setToolValue("resize","resize_height",this.imageHeight),UITools.setToolValue("resize","resize_xscale",100),UITools.setToolValue("resize","resize_yscale",100),UITools.setToolValue("resize","lock_aspect_ratio",!0),UITools.updateToolControls("resize"))},ig.prototype.setupResizer=function(){this.imageWidth=this.resizeWidth=this.sourceTexture?this.sourceTexture.width:0,this.imageHeight=this.resizeHeight=this.sourceTexture?this.sourceTexture.height:0,this.lockAspectRatio=!1,this.updateSize(),this.updateScaleBounds()},ig.prototype.updateSize=function(){this.imageContainer.x=-Math.round(this.imageWidth/2)+(this.imageWidth-this.resizeWidth)/2,this.imageContainer.y=-Math.round(this.imageHeight/2)+(this.imageHeight-this.resizeHeight)/2,this.image.scale.x=this.resizeWidth/this.imageWidth,this.image.scale.y=this.resizeHeight/this.imageHeight,this.itemWidth=this.resizeWidth,this.itemHeight=this.resizeHeight,this.updateSmoothing(),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()},ig.prototype.updateScaleBounds=function(){var e=UITools.getParamObject("resize_resize_xscale");e.min=Math.floor(BFN.minImageSize/this.imageWidth*100),e.max=Math.ceil(BFN.maxImageSize/this.imageWidth*100);var t=UITools.getParamObject("resize_resize_yscale");t.min=Math.floor(BFN.minImageSize/this.imageHeight*100),t.max=Math.ceil(BFN.maxImageSize/this.imageHeight*100)},ig.prototype.updateSmoothing=function(e){null==e&&(e=!0),this.image.currentScale=e?this.image.scale.x*this._scale:this.image.scale.x,this.image.currentScaleY=e?this.image.scale.y*this._scale:this.image.scale.y},ig.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.image.texture=PIXI.Texture.EMPTY},Object.defineProperty(ig.prototype,"toolScale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(ig.prototype,"toolScaling",{set:function(e){this._scaling=e,this.image.isResize=!this._scaling},get:function(){return this._scaling}}),Object.defineProperty(ig.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.round(this.resizeWidth),Math.round(this.resizeHeight));return this.updateSmoothing(!1),this.imageContainer.x=0,this.imageContainer.y=0,this.image.isResize=!0,BFN.Stage.render(this.imageContainer,e),this.updateSize(),e}}),Object.defineProperty(BFN,"ImageResize",{get:function(){return!BFN._ImageResize&&(BFN._ImageResize=new ig),BFN._ImageResize}}),rg.prototype=Object.create(PIXI.Sprite.prototype),rg.prototype.init=function(){BeFunky.log("ImageSlimming Init"),this.initDefaultValues(),this.initDisplay()},rg.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this.slimmingWidth=0,this.imageWidth=0,this.itemWidth=0,this.itemHeight=0,this.slimmingAmount=1,this.slimmingFactor=1},rg.prototype.initDisplay=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer),this.image=new PIXI.Sprite,this.image.pluginName="blend_picture",this.imageContainer.addChild(this.image)},rg.prototype.handleSlimming=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING){var e=UITools.getToolVO("slimming");this.slimmingAmount=e.amount/100,this.updateSize()}},rg.prototype.setSourceTexture=function(e){this.reset(),e&&(this.sourceTexture=e,this.image.texture=this.sourceTexture,this.setupSlimming(),UITools.setToolValue("slimming","amount",Math.round(100*this.slimmingAmount)),UITools.updateToolControls("slimming"))},rg.prototype.setupSlimming=function(){this.imageWidth=this.slimmingWidth=this.sourceTexture?this.sourceTexture.width:0,this.imageHeight=this.sourceTexture?this.sourceTexture.height:0,this.slimmingAmount=.3,this.updateSize()},rg.prototype.updateSize=function(){this.slimmingFactor=1-.05*this.slimmingAmount,this.slimmingWidth=Math.round(this.slimmingFactor*this.imageWidth),this.imageContainer.x=-Math.round(this.imageWidth/2)+(this.imageWidth-this.slimmingWidth)/2,this.imageContainer.y=-Math.round(this.imageHeight/2),this.image.scale.x=this.slimmingWidth/this.imageWidth,this.itemWidth=this.slimmingWidth,this.itemHeight=this.imageHeight,this.updateSmoothing(),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED)},rg.prototype.updateSmoothing=function(e){null==e&&(e=!0),this.image.currentScale=e?this.image.scale.x*this._scale:this.image.scale.x,this.image.currentScaleY=e?this._scale:1},rg.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.image.texture=PIXI.Texture.EMPTY},Object.defineProperty(rg.prototype,"toolScale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(rg.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.round(this.slimmingWidth),Math.round(this.imageHeight));return this.updateSmoothing(!1),this.imageContainer.x=0,this.imageContainer.y=0,BFN.Stage.render(this.imageContainer,e),this.updateSize(),e}}),Object.defineProperty(BFN,"ImageSlimming",{get:function(){return!BFN._ImageSlimming&&(BFN._ImageSlimming=new rg),BFN._ImageSlimming}}),ag.prototype=Object.create(PIXI.Sprite.prototype),ag.prototype.init=function(){BeFunky.log("ImageReshape Init"),this.initDefaultValues(),this.initImageContainer(),this.initDisplay()},ag.prototype.initDefaultValues=function(){this.sourceTexture=null,this.sourceTextureLoRes=null,this.resultTexture=null,this._scale=1,this.blurAmount=.4,this.draftResolution=1,this.draftActive=!1,this.renderPending=!1,this.workingTextureMaxSide=1024,this.displacementResizeFactor=1,this.liquifyBrushFilter=new BFN.filters.LiquifyBrushFilter,this.blurFilter=new BFN.filters.FastBlurWrapper,this.displacementFilter=new BFN.filters.DisplacementFilter,this.handleAltBitmapDataUpdatedBind=this.handleAltBitmapDataUpdated.bind(this),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},ag.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer)},ag.prototype.initDisplay=function(){this.brushPixelSourceTexture=null,this.brushPixelSourceSprite=new PIXI.Sprite,this.brushPixelSourceRendereredTexture=null,this.brushPixelSourceRendereredSprite=new PIXI.Sprite,this.sourceSprite=new PIXI.Sprite,this.resultSprite=new PIXI.Sprite,this.resultSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.resultSprite),this.displacementTexture=null,this.displacementSprite=new PIXI.Sprite,this.displacementBlurredTexture=null,this.displacementBlurredSprite=new PIXI.Sprite,this.painter=new BFN.ImagePainter,this.painter.brushEnabled=!1,this.painter.brushHardnessFactor=0,this.painter.staggerInterval=25,this.painter.scaleAffectsBrushRadius=!1,this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handleBrushApplied.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_STARTED.type,this.handlePaintingStarted.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_COMPLETE.type,this.handlePaintingComplete.bind(this)),this.imageContainer.addChild(this.painter)},ag.prototype.handleReshape=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESHAPE){var e=UITools.getToolVO("reshape"),t=!1;if("reset"==e.updating_id)this.painter.clear(),this.displacementTexture.fillRect(0,0,this.displacementTexture.width,this.displacementTexture.height,32896,1),this.displacementBlurredTexture.copyPixels(this.displacementTexture),t=!0,"erase"==e.mode&&(UITools.setToolValue("reshape","mode","smudge"),UITools.updateToolControl("reshape_mode"),this.liquifyBrushFilter.mode=e.mode);else{var i=e.brush_size/100*.6+.15;e.updating&&"brush_size"==e.updating_id&&this.painter.brushSizeFactor!=i&&(this.painter.brushSizeFactor=i),e.updating||"brush_size"!=e.updating_id&&this.painter.brushSizeFactor==i&&!this.painter.brushSizeChanged||(this.painter.brushSizeFactor=i,this.painter.updateBrush(),this.updateBrushPixelSource()),this.liquifyBrushFilter.pressure=e.pressure/100,this.liquifyBrushFilter.mode=e.mode,this.painter.ignoreInitialPress="smudge"==e.mode,this.painter.staggerEnabled="smudge"!=e.mode;var r=e.strength/100;r!=this.displacementFilter.strength&&(t=!0),this.displacementFilter.strength=r}"strength"==e.updating_id&&this.draftActive!=e.updating&&(t=!1,this.toggleDraft(e.updating)),t&&(this.renderPending=!0,BFN.MainUI.requestRender())}},ag.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null);try{this.sourceTextureLoRes.destroyGC(!0)}catch(e){}this.sourceTextureLoRes=null,this.sourceSprite.texture=PIXI.Texture.EMPTY;try{this.resultTexture.destroyGC(!0)}catch(e){}this.resultTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY;try{this.displacementTexture.destroyGC(!0)}catch(e){}this.displacementTexture=null,this.displacementSprite.texture=PIXI.Texture.EMPTY;try{this.displacementBlurredTexture.destroyGC(!0)}catch(e){}this.displacementBlurredTexture=null,this.displacementBlurredSprite.texture=PIXI.Texture.EMPTY,this.painter.altTexture=null,BFN.ImagePainterUndoManager.removeEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltBitmapDataUpdatedBind),BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)},ag.prototype.setSourceTexture=function(e){if(this.reset(),e){this.sourceTexture=e;var t=this.sourceTexture.width*this.sourceTexture.height;t>Math.pow(3072,2)?this.draftResolution=.25:t>Math.pow(2048,2)?this.draftResolution=.5:this.draftResolution=1,this.sourceTextureLoRes=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height,void 0,this.draftResolution),this.sourceTextureLoRes.copyPixels(this.sourceTexture),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.displacementResizeFactor=Math.min(1,this.workingTextureMaxSide/Math.max(this.sourceTexture.width,this.sourceTexture.height)),this.resultTexture=this.sourceTexture.renderClone(),this.resultTexture.clear(),this.displacementTexture=PIXI.RenderTexture.create(Math.floor(this.sourceTexture.width*this.displacementResizeFactor),Math.floor(this.sourceTexture.height*this.displacementResizeFactor)),this.displacementTexture.fillColor(32896),this.displacementBlurredTexture=this.displacementTexture.renderClone(),this.sourceSprite.texture=this.sourceTexture,this.resultSprite.texture=this.resultTexture,this.displacementSprite.texture=this.displacementTexture,this.displacementBlurredSprite.texture=this.displacementBlurredTexture,this.displacementFilter.inputSprite=this.sourceSprite,this.displacementFilter.iChannel1=this.displacementBlurredTexture,this.sourceSprite.filters=[this.displacementFilter],this.painter.altTexture=this.displacementTexture,BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltBitmapDataUpdatedBind),BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),UITools.setToolValue("reshape","pressure",50),UITools.setToolValue("reshape","brush_size",50),UITools.setToolValue("reshape","strength",100),UITools.setToolValue("reshape","mode","smudge"),UITools.updateToolControls("reshape"),BFN.Stage.render(this.sourceSprite,this.resultTexture),this.renderPending=!0,BFN.MainUI.requestRender()}else this.imageContainer.x=0,this.imageContainer.y=0,this.blurFilter.dispose();this.updatePainter()},ag.prototype.toggleDraft=function(e){this.draftActive!==e&&(this.draftActive=e,BFN.StageModel.setRefreshFactor(e?.5:1),this.sourceSprite.texture=e?this.sourceTextureLoRes:this.sourceTexture,this.renderPending=!0,BFN.MainUI.requestRender())},ag.prototype.updateSmoothing=function(){this.resultSprite.currentScale=this._scale},ag.prototype.updateItemDimensions=function(){this.sourceTexture&&(this.itemWidth=Math.floor(this.sourceTexture.width-2/this._scale),this.itemHeight=Math.floor(this.sourceTexture.height-2/this._scale))},ag.prototype.updateBrushPixelSource=function(){try{this.brushPixelSourceTexture.destroyGC(!0)}catch(e){}this.brushPixelSourceTexture=PIXI.RenderTexture.create(Math.round(this.painter.brush.texture.width),this.painter.brush.texture.height),this.brushPixelSourceTexture.fillRect(0,0,this.brushPixelSourceTexture.width,this.brushPixelSourceTexture.height,16777215,1),this.brushPixelSourceSprite.texture=this.brushPixelSourceTexture;try{this.brushPixelSourceRendereredTexture.destroyGC(!0)}catch(e){}this.brushPixelSourceRendereredTexture=PIXI.RenderTexture.create(this.brushPixelSourceTexture.width,this.brushPixelSourceTexture.height),this.brushPixelSourceRendereredTexture.fillRect(0,0,this.brushPixelSourceRendereredTexture.width,this.brushPixelSourceRendereredTexture.height,16777215,1),this.brushPixelSourceRendereredSprite.texture=this.brushPixelSourceRendereredTexture,this.liquifyBrushFilter.vTextureCoordMax=this.brushPixelSourceTexture.width/BFN.FilterHelper.getNextPowerOfTwo(this.brushPixelSourceTexture.width),this.brushPixelSourceSprite.filters=[this.liquifyBrushFilter]},ag.prototype.applyBrush=function(){if(this.displacementTexture){var e=this.painter.brushRect;this.brushPixelSourceTexture.copyPixels(this.displacementTexture,new PIXI.Point(-e.x,-e.y),!0),this.brushPixelSourceRendereredSprite.x=e.x,this.brushPixelSourceRendereredSprite.y=e.y,this.liquifyBrushFilter.beta=this.painter.brushBeta,BFN.Stage.render(this.brushPixelSourceSprite,this.brushPixelSourceRendereredTexture,!0),this.displacementTexture.fillRect(e.x,e.y,this.brushPixelSourceTexture.width,this.brushPixelSourceTexture.height,16711680,.5),BFN.Stage.render(this.brushPixelSourceRendereredSprite,this.displacementTexture,!1);var t=this.blurFilter.render(this.blurAmount,this.displacementTexture);this.displacementBlurredTexture.copyPixels(t),this.renderPending=!0,BFN.MainUI.requestRender()}},ag.prototype.updatePainter=function(){this.sourceTexture?(this.painter.painterWidth==this.displacementTexture.width&&this.painter.painterHeight==this.displacementTexture.height||this.painter.setup(this.displacementTexture.width,this.displacementTexture.height),this.painter.scale.x=this.painter.scale.y=1/this.displacementResizeFactor,this.updatePainterToolScale()):this.painter.reset()},ag.prototype.updatePainterToolScale=function(){this.painter.toolScale=this._scale/this.displacementResizeFactor},ag.prototype.handleBrushApplied=function(){this.applyBrush()},ag.prototype.handleAltBitmapDataUpdated=function(e){BFN.Stage.render(this.displacementSprite,this.displacementBlurredTexture,!0);var t=this.blurFilter.render(this.blurAmount,this.displacementTexture);this.displacementBlurredTexture.copyPixels(t),this.renderPending=!0,BFN.MainUI.requestRender()},ag.prototype.handleMainUIPreRender=function(e){this.renderPending&&(this.renderPending=!1,BFN.Stage.render(this.sourceSprite,this.resultTexture))},ag.prototype.handlePaintingStarted=function(e){this.toggleDraft(!0)},ag.prototype.handlePaintingComplete=function(e){this.toggleDraft(!1)},Object.defineProperty(ag.prototype,"toolScale",{set:function(e){this._scale=e,this.updatePainterToolScale(),this.updateSmoothing(),this.updateItemDimensions()},get:function(){return this._scale}}),Object.defineProperty(ag.prototype,"modifiedTexture",{get:function(){return this.resultTexture.renderClone()}}),Object.defineProperty(BFN,"ImageReshape",{get:function(){return!BFN._ImageReshape&&(BFN._ImageReshape=new ag),BFN._ImageReshape}}),ng.prototype=Object.create(PIXI.Sprite.prototype),ng.prototype.init=function(){BeFunky.log("ImageTilter Init"),this.initDefaultValues(),this.initDisplay()},ng.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this.itemWidth=this.imageContainerWidth=0,this.itemHeight=this.imageContainerHeight=0},ng.prototype.initDisplay=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer),this.imageBackground=new PIXI.Graphics,this.imageContainer.addChild(this.imageBackground),this.imageCenterContainer=new PIXI.Container,this.imageContainer.addChild(this.imageCenterContainer),this.image=new PIXI.Sprite,this.image.pluginName="smooth_picture",this.imageCenterContainer.addChild(this.image)},ng.prototype.handleTilt=function(){if(this.sourceTexture&&BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT){var e=UITools.getToolVO("tilt"),t=e.tilt_amount,i=Math.abs(t*(Math.PI/180)),r=this.sourceTexture.width,a=this.sourceTexture.height;this.imageContainerWidth=Math.cos(i)*r+Math.sin(i)*a,this.imageContainerHeight=Math.cos(i)*a+Math.sin(i)*r,this.imageBackground.clear(),-1!=e.background_color?this.imageBackground.beginFill("0x"+e.background_color):this.imageBackground.beginFill(0,0),this.imageBackground.drawRect(0,0,this.imageContainerWidth,this.imageContainerHeight),this.imageBackground.endFill(),this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageCenterContainer.x=-this.imageContainer.x,this.imageCenterContainer.y=-this.imageContainer.y,this.imageCenterContainer.rotation=t*(Math.PI/180);var n=Math.min(1,this.image.texture.height/this.imageContainerHeight);this.scale.x=this.scale.y=n,this.itemWidth=Math.round(this.imageContainerWidth*n),this.itemHeight=Math.round(this.imageContainerHeight*n),this.image.currentScale=this._scale*n,BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()}else this.imageContainer.x=0,this.imageContainer.y=0,this.imageCenterContainer.x=0,this.imageCenterContainer.y=0,this.imageCenterContainer.rotation=0},ng.prototype.setSourceTexture=function(e){this.reset(),e&&(this.sourceTexture=e,this.image.texture=this.sourceTexture,this.image.x=-this.image.texture.width/2,this.image.y=-this.image.texture.height/2,this.scale.x=this.scale.y=1,this.itemWidth=this.sourceTexture.width,this.itemHeight=this.sourceTexture.height,UITools.setToolValue("tilt","tilt_amount",0),UITools.setToolValue("tilt","background_color",-1),UITools.updateToolControls("tilt"))},ng.prototype.reset=function(){this.sourceTexture=null,this.image.texture=PIXI.Texture.EMPTY,this.image.x=0,this.image.y=0},Object.defineProperty(ng.prototype,"toolScale",{set:function(e){this._scale=e,this.image.currentScale=this._scale*this.scale.x},get:function(){return this._scale}}),Object.defineProperty(ng.prototype,"modifiedTexture",{get:function(){var e=Math.min(1,BFN.maxImageSize/this.imageContainerWidth,BFN.maxImageSize/this.imageContainerHeight),t=Math.min(BFN.maxImageSize,Math.floor(this.imageContainerWidth*e)),i=Math.min(BFN.maxImageSize,Math.floor(this.imageContainerHeight*e)),r=PIXI.RenderTexture.create(t,i);return this.imageContainer.x=this.imageContainer.y=0,this.imageContainer.scale.x=this.imageContainer.scale.y=this.image.currentScale=e,BFN.Stage.render(this.imageContainer,r),this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageContainer.scale.x=this.imageContainer.scale.y=1,this.image.currentScale=this._scale*this.scale.x,r}}),Object.defineProperty(BFN,"ImageTilter",{get:function(){return!BFN._ImageTilter&&(BFN._ImageTilter=new ng),BFN._ImageTilter}}),og.prototype=Object.create(PIXI.Container.prototype),og.prototype.init=function(){BeFunky.log("FunkyMask Init"),this.initDefaultValues(),this.initMask(),this.initMaskGuide(),this.initMaskGuideShape(),this.initMaskGuideHandles(),this.initDraggers(),BFN.AppModel.appReady?BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)):BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,function(e){BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this))}.bind(this))},og.prototype.initDefaultValues=function(){this._scale=1,this._hardness=.5,this._maskTarget=null,this.interactive=!0,this.renderPending=!1,this.hovered=!1,this.dragging=!1,this.keepGuidesOn=!1,this.showOuterHandles=!0,this.showRatioHandles=!1,this.strokeWidth=2,this.strokeShadowWidth=1,this.on("pointerover",this.handleToolMouseOver.bind(this)),this.on("pointerout",this.handleToolMouseOut.bind(this)),this.on("pointerdown",this.handleToolMouseDown.bind(this)),this.handleKeyDownBind=this.handleKeyDown.bind(this),this.handleKeyUpBind=this.handleKeyUp.bind(this)},og.prototype.initMask=function(){this.maskSourceSize=512,this.maskSourceScale=1,this.maskSourceFill=new PIXI.Graphics,this.maskSourceFill.beginFill(16777215),this.maskSourceFill.drawRect(0,0,this.maskSourceSize,this.maskSourceSize),this.maskSourceFill.endFill(),this.maskSourceTexture=PIXI.RenderTexture.create(this.maskSourceSize,this.maskSourceSize),BFN.Stage.render(this.maskSourceFill,this.maskSourceTexture),this.maskSourceSprite=new PIXI.Sprite(this.maskSourceTexture),this.maskSourceFilter=BFN.ShaderPool.BrushFilter,this.maskSourceFilter.radius=this.maskSourceSize/2,this.maskContainer=new PIXI.Container,this.addChild(this.maskContainer),this.maskTexture=PIXI.RenderTexture.create(this.maskSourceSize,this.maskSourceSize),this.maskSprite=new PIXI.Sprite(this.maskTexture),this.maskSprite.anchor.x=this.maskSprite.anchor.y=.5,this.maskContainer.addChild(this.maskSprite)},og.prototype.initMaskGuide=function(){this.maskGuide=new PIXI.Graphics,this.maskGuide.interactive=!0,this.addChild(this.maskGuide)},og.prototype.initMaskGuideShape=function(){this.maskGuideShape=new PIXI.Graphics,this.maskGuideShape.interactive=!0,this.maskGuide.addChild(this.maskGuideShape),this.maskGuideShape.on("pointerdown",function(){this.positionDragger.drag(this.maskGuide)}.bind(this)),this.resolutionFilter=new BFN.filters.PlainFilter,this.resolutionFilter.resolution=2,this.maskGuideShape.filters=[this.resolutionFilter]},og.prototype.initMaskGuideHandles=function(){this.handleTextureSquare=PIXI.RenderTexture.create(20,20),BFN.graphics.drawShape("roundedRect",this.handleTextureSquare,{fillColor:1073741824,cornerRadius:4}),BFN.graphics.drawShape("roundedRect",this.handleTextureSquare,{strokeWidth:1.5,strokeColor:4294967295,fillColor:4282154954,cornerRadius:3,paddingX:1,paddingY:1,clear:!1}),this.handleTextureCircle=PIXI.RenderTexture.create(20,20),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{fillColor:1073741824}),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{strokeWidth:1.5,strokeColor:4294967295,fillColor:4282154954,paddingX:1,paddingY:1,clear:!1}),this.handleData=["left","top","right","bottom"],this.outerHandles={},this.innerHandles={},this.ratioHandles={};for(var e=0;e<this.handleData.length;e++){var t=new BFN.HoverButton;t.id=this.handleData[e],t.texture=this.handleTextureSquare,this.outerHandles[t.id]=t,this.maskGuide.addChild(t),t.on("pointerdown",function(e){this.outerHandleDragger.drag(e.currentTarget)}.bind(this)),t.on("pointerover",function(e){this.maskGuide.addChild(e.currentTarget)}.bind(this)),t.addChildAt(this.getHandleTouchSurface(),0);var i=new BFN.HoverButton;i.id=this.handleData[e],i.texture=this.handleTextureCircle,this.innerHandles[i.id]=i,this.maskGuide.addChild(i),i.on("pointerdown",function(e){this.innerHandleDragger.drag(e.currentTarget)}.bind(this)),i.on("pointerover",function(e){this.maskGuide.addChild(e.currentTarget)}.bind(this)),i.addChildAt(this.getHandleTouchSurface(),0);var r=new BFN.HoverButton;r.id=this.handleData[e],r.texture=this.handleTextureSquare,this.ratioHandles[r.id]=r,this.maskGuide.addChildAt(r,1),r.on("pointerdown",function(e){this.ratioHandleDragger.drag(e.currentTarget)}.bind(this)),r.addChildAt(this.getHandleTouchSurface(),0);var a=new PIXI.Graphics;a.rotation=e*(Math.PI/2),a.filters=[this.resolutionFilter],r.addChildAt(a,0),r.line=a}},og.prototype.initDraggers=function(){this.positionDragger=new BFN.Dragger,this.positionDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handlePositionDraggerDragging.bind(this)),this.positionDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStarted.bind(this)),this.positionDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this)),this.outerHandleDragger=new BFN.Dragger,this.outerHandleDragger.autoDrag=!1,this.outerHandleDragger.useBounds=!1,this.outerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleOuterHandleDraggerDragging.bind(this)),this.outerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStarted.bind(this)),this.outerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this)),this.innerHandleDragger=new BFN.Dragger,this.innerHandleDragger.autoDrag=!1,this.innerHandleDragger.useBounds=!1,this.innerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleInnerHandleDraggerDragging.bind(this)),this.innerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStarted.bind(this)),this.innerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this)),this.ratioHandleDragger=new BFN.Dragger,this.ratioHandleDragger.autoDrag=!1,this.ratioHandleDragger.useBounds=!1,this.ratioHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleRatioHandleDraggerDragging.bind(this)),this.ratioHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStarted.bind(this)),this.ratioHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this))},og.prototype.setup=function(e,t,i){if(null==i&&(i=1),e>0&&t>0){this.imageDiagonal=2*(Math.sqrt(Math.pow(e,2)+Math.pow(t,2))+10),this.longestSide=Math.max(e,t),this.hitArea=new PIXI.Rectangle(0-this.longestSide-100,0-this.longestSide-100,e+2*(this.longestSide+100),t+2*(this.longestSide+100)),this.maxSize=2*this.longestSide,this.minSize=this.maxSize/20,this.maskSourceScale=this.maskSourceSize/this.longestSide,this.maskContainer.scale.x=this.maskContainer.scale.y=1/this.maskSourceScale,this.ratioHandleDistance=Math.round(Math.max(e,t)/20);for(var r=0;r<this.handleData.length;r++){var a=this.handleData[r],n=this.ratioHandles[a];n.line.clear(),n.line.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),n.line.moveTo(0,0),n.line.lineTo(this.ratioHandleDistance,0),n.line.lineStyle(this.strokeWidth,16777215),n.line.moveTo(0,0),n.line.lineTo(this.ratioHandleDistance,0)}this.maskGuide.x=e/2,this.maskGuide.y=t/2,this.focusR=0,this.focusW=e*i,this.focusH=t*i,this.positionDragger.setBounds(0,0,e,t),this.toggleGuide(!0),this.updateMaskGuide(),this.updateMaskTransform(),this.updateMaskDisplay(),document.addEventListener("keydown",this.handleKeyDownBind,!1),document.addEventListener("keyup",this.handleKeyUpBind,!1)}},og.prototype.reset=function(){this.keepGuidesOn=!1,document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind)},og.prototype.toggleGuide=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=!!e,this.maskGuide.visible=this.guideVisible=t?e:e||this.keepGuidesOn,BFN.MainUI.requestRender()},og.prototype.updateMaskGuide=function(){this.maskGuide.scale.x=this.maskGuide.scale.y=1/this._scale,this.maskGuideShape.rotation=this.focusR,this.maskGuideShape.clear(),this.showOuterHandles&&this.maskGuideShape.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),this.maskGuideShape.beginFill(16777215,0),"linear"==this.maskMode?(this.maskGuideShape.drawRect(-this.imageDiagonal/2*this._scale,-this.focusH/2*this._scale,this.imageDiagonal*this._scale,this.focusH*this._scale),this.maskGuideShape.endFill(),this.maskGuideShape.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),this.maskGuideShape.drawRect(-this.imageDiagonal/2*this._scale,-this.focusH/2*this._scale*this._hardness,this.imageDiagonal*this._scale,this.focusH*this._scale*this._hardness),this.maskGuideShape.lineStyle(this.strokeWidth,16777215),this.showOuterHandles&&this.maskGuideShape.drawRect(-this.imageDiagonal/2*this._scale,-this.focusH/2*this._scale,this.imageDiagonal*this._scale,this.focusH*this._scale),this.maskGuideShape.drawRect(-this.imageDiagonal/2*this._scale,-this.focusH/2*this._scale*this._hardness,this.imageDiagonal*this._scale,this.focusH*this._scale*this._hardness)):"square"==this.maskMode?(this.maskGuideShape.drawRect(-this.focusW/2*this._scale,-this.focusH/2*this._scale,this.focusW*this._scale,this.focusH*this._scale),this.maskGuideShape.endFill(),this.maskGuideShape.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),this.maskGuideShape.drawRect(-this.focusW/2*this._scale*this._hardness,-this.focusH/2*this._scale*this._hardness,this.focusW*this._scale*this._hardness,this.focusH*this._scale*this._hardness),this.maskGuideShape.lineStyle(this.strokeWidth,16777215),this.showOuterHandles&&this.maskGuideShape.drawRect(-this.focusW/2*this._scale,-this.focusH/2*this._scale,this.focusW*this._scale,this.focusH*this._scale),this.maskGuideShape.drawRect(-this.focusW/2*this._scale*this._hardness,-this.focusH/2*this._scale*this._hardness,this.focusW*this._scale*this._hardness,this.focusH*this._scale*this._hardness)):(this.maskGuideShape.drawEllipse(0,0,this.focusW/2*this._scale,this.focusH/2*this._scale),this.maskGuideShape.endFill(),this.maskGuideShape.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),this.maskGuideShape.drawEllipse(0,0,this.focusW/2*this._scale*this._hardness,this.focusH/2*this._scale*this._hardness),this.maskGuideShape.lineStyle(this.strokeWidth,16777215),this.showOuterHandles&&this.maskGuideShape.drawEllipse(0,0,this.focusW/2*this._scale,this.focusH/2*this._scale),this.maskGuideShape.drawEllipse(0,0,this.focusW/2*this._scale*this._hardness,this.focusH/2*this._scale*this._hardness));for(var e=0;e<this.handleData.length;e++){var t=this.handleData[e],i=this.outerHandles[t],r=this.innerHandles[t],a=this.ratioHandles[t];switch(t){case"left":this.betaOffset=Math.PI,this.handleDistance=this.focusW/2,i.visible=r.visible=a.visible="linear"!=this.maskMode;break;case"top":this.betaOffset=-Math.PI/2,this.handleDistance=this.focusH/2;break;case"right":this.betaOffset=0,this.handleDistance=this.focusW/2,i.visible=r.visible=a.visible="linear"!=this.maskMode;break;case"bottom":this.betaOffset=Math.PI/2,this.handleDistance=this.focusH/2}this.showOuterHandles||(i.visible=!1),this.showRatioHandles||(a.visible=!1),i.rotation=this.focusR,i.x=Math.cos(this.focusR+this.betaOffset)*this.handleDistance*this._scale,i.y=Math.sin(this.focusR+this.betaOffset)*this.handleDistance*this._scale,r.rotation=this.focusR,r.x=Math.cos(this.focusR+this.betaOffset)*this.handleDistance*this._scale*this._hardness,r.y=Math.sin(this.focusR+this.betaOffset)*this.handleDistance*this._scale*this._hardness,a.rotation=this.focusR,a.x=r.x+Math.cos(this.focusR+this.betaOffset)*this.ratioHandleDistance*this._scale,a.y=r.y+Math.sin(this.focusR+this.betaOffset)*this.ratioHandleDistance*this._scale,a.line.scale.x=this._scale}},og.prototype.updateMaskTransform=function(){this.maskSprite.rotation=this.focusR,this.maskSprite.x=this.maskGuide.x*this.maskSourceScale,this.maskSprite.y=this.maskGuide.y*this.maskSourceScale,this.maskSprite.scale.x="linear"==this.maskMode?this.imageDiagonal*this.maskSourceScale/this.maskSourceSize:this.focusW*this.maskSourceScale/this.maskSourceSize,this.maskSprite.scale.y=this.focusH*this.maskSourceScale/this.maskSourceSize},og.prototype.updateMaskDisplay=function(){this.maskSourceFilter.strength=1,this.maskSourceFilter.radius=this.maskSourceSize/2,this.maskSourceFilter.hardness=this._hardness,this.maskSourceFilter.mode=this._maskMode,this.maskSourceSprite.bfn_shaders=[this.maskSourceFilter],this.maskSourceSprite.pluginName="filter_renderer",this.renderPending=!0},og.prototype.setOpacity=function(e){this.maskContainer.alpha=e},og.prototype.getHandleTouchSurface=function(){var e=new PIXI.Graphics;return e.interactive=!0,e.beginFill(16777215,0),e.drawCircle(0,0,20),e.endFill(),e},og.prototype.handleMainUIPreRender=function(e){this.renderPending&&(this.renderPending=!1,BFN.Stage.render(this.maskSourceSprite,this.maskTexture))},og.prototype.handleToolMouseOver=function(e){this.hovered=!0,this.toggleGuide(!0)},og.prototype.handleToolMouseOut=function(e){this.hovered=!1,this.dragging||this.toggleGuide(!1)},og.prototype.handleToolMouseDown=function(e){this.hovered||(this.keepGuidesOn=!0,this.handleToolMouseOver())},og.prototype.handlePositionDraggerDragging=function(e){this.updateMaskTransform()},og.prototype.handleOuterHandleDraggerDragging=function(e){var t,i=this.outerHandleDragger.item,r=this.maskGuide.getPointerPosition(BFN.MainUI.pointerEvent),a=r.x/this._scale,n=r.y/this._scale,o=Math.max(this.minSize/2,Math.min(this.maxSize/2,Math.sqrt(Math.pow(a,2)+Math.pow(n,2)))),s=this.outerHandleDragger.shiftKey;switch(s&&(t=this.focusH/this.focusW),i.id){case"left":this.focusR=Math.atan2(n,a)-Math.PI,this.focusW=2*o,this.focusH=s?this.focusW*t:this.focusH;break;case"top":this.focusR=Math.atan2(n,a)+Math.PI/2,this.focusH=2*o,this.focusW=s?this.focusH/t:this.focusW;break;case"right":this.focusR=Math.atan2(n,a),this.focusW=2*o,this.focusH=s?this.focusW*t:this.focusH;break;case"bottom":this.focusR=Math.atan2(n,a)-Math.PI/2,this.focusH=2*o,this.focusW=s?this.focusH/t:this.focusW}this.updateMaskGuide(),this.updateMaskTransform()},og.prototype.handleInnerHandleDraggerDragging=function(e){var t=this.innerHandleDragger.item,i=this.maskGuide.getPointerPosition(BFN.MainUI.pointerEvent),r=i.x/this._scale,a=i.y/this._scale,n=Math.sqrt(Math.pow(r,2)+Math.pow(a,2));switch(t.id){case"left":case"right":this._hardness=Math.max(.1,Math.min(.9,n/(this.focusW/2)));break;case"top":case"bottom":this._hardness=Math.max(.1,Math.min(.9,n/(this.focusH/2)))}this.updateMaskGuide(),this.updateMaskDisplay()},og.prototype.handleRatioHandleDraggerDragging=function(e){var t=this.ratioHandleDragger.item,i=this.maskGuide.getPointerPosition(BFN.MainUI.pointerEvent),r=i.x/this._scale/this._hardness,a=i.y/this._scale/this._hardness,n=Math.sqrt(Math.pow(r,2)+Math.pow(a,2));n=Math.max(this.minSize/2,Math.min(this.maxSize/2,n-this.ratioHandleDistance/this._hardness));var o,s=this.ratioHandleDragger.shiftKey;switch(s&&(o=this.focusH/this.focusW),t.id){case"left":this.focusR=Math.atan2(a,r)-Math.PI,this.focusW=2*n,this.focusH=s?this.focusW*o:this.focusH;break;case"top":this.focusR=Math.atan2(a,r)+Math.PI/2,this.focusH=2*n,this.focusW=s?this.focusH/o:this.focusW;break;case"right":this.focusR=Math.atan2(a,r),this.focusW=2*n,this.focusH=s?this.focusW*o:this.focusH;break;case"bottom":this.focusR=Math.atan2(a,r)-Math.PI/2,this.focusH=2*n,this.focusW=s?this.focusH/o:this.focusW}this.updateMaskGuide(),this.updateMaskTransform()},og.prototype.handleDraggingStarted=function(e){this.dragging=!0,this.hovered||(this.keepGuidesOn=!0,this.handleToolMouseOver())},og.prototype.handleDraggingComplete=function(e){this.dragging=!1,this.hovered||this.toggleGuide(!1)},og.prototype.handleKeyDown=function(e){if(32==e.keyCode&&this.hovered&&this.guideVisible){var t=this.keepGuidesOn;this.keepGuidesOn=!1,this.toggleGuide(!1),this.keepGuidesOn=t}},og.prototype.handleKeyUp=function(e){32==e.keyCode&&this.hovered&&!this.guideVisible&&this.toggleGuide(!0)},Object.defineProperty(og.prototype,"scale",{set:function(e){this._scale=e,this.positionDragger.scale=this._scale,this.updateMaskGuide()},get:function(){return this._scale}}),Object.defineProperty(og.prototype,"maskMode",{set:function(e){"radial"!=e&&"square"!=e&&"linear"!=e||e==this._maskMode||(this._maskMode=e,this.updateMaskGuide(),this.updateMaskTransform(),this.updateMaskDisplay())},get:function(){return this._maskMode}}),Object.defineProperty(og.prototype,"maskTarget",{set:function(e){this._maskTarget&&(this._maskTarget.mask=null,this._maskTarget=null),this._maskTarget=e,this._maskTarget.mask=this.maskSprite},get:function(){return this._maskTarget}}),BFN.FunkyMask=og,sg.prototype=Object.create(PIXI.Sprite.prototype),sg.prototype.init=function(){BeFunky.log("ImageFocus Init"),this.initDefaultValues(),this.initImageContainer(),this.initFilterSprite(),this.initRenderSprite(),this.initOpacitySprite(),this.initSourceSprite(),this.initFunkyMask(),BFN.AppModel.appReady?BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)):BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,function(e){BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this))}.bind(this))},sg.prototype.initDefaultValues=function(){this.sourceTexture=null,this.renderTexture=null,this._inverse=!1,this._scale=1,this.mosaicSegments={minX:0,maxX:0,minY:0,maxY:0},this.renderPending=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!1),this.pixelateFilter=new BFN.filters.PixelateFilter,this.grayFilter=new BFN.filters.GrayFilter},sg.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},sg.prototype.initFilterSprite=function(){this.filterMinBlur=0,this.filterMaxBlur=0,this.filterMaxSize=1024,this.filterSprite=new PIXI.Sprite},sg.prototype.initRenderSprite=function(){this.renderSprite=new PIXI.Sprite,this.renderSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.renderSprite)},sg.prototype.initOpacitySprite=function(){this.opacitySprite=new PIXI.Sprite,this.opacitySprite.pluginName="smooth_picture",this.opacitySprite.alpha=0,this.imageContainer.addChild(this.opacitySprite)},sg.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},sg.prototype.initFunkyMask=function(){this.funkyMask=new BFN.FunkyMask,this.funkyMask.maskTarget=this.sourceSprite,this.imageContainer.addChild(this.funkyMask)},sg.prototype.handleFocus=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS){var e=UITools.getToolVO("funky_focus"),t=[];if(this.funkyMask.maskMode!=e.mode&&(this.funkyMask.maskMode=e.mode),e.grayscale&&t.push(this.grayFilter),e.mosaic){var i=1-Math.max(0,Math.min(1,e.blur_amount/100));this.pixelateFilter.segmentsX=Math.round((this.mosaicSegments.maxX-this.mosaicSegments.minX)*i+this.mosaicSegments.minX),this.pixelateFilter.segmentsY=Math.round((this.mosaicSegments.maxY-this.mosaicSegments.minY)*i+this.mosaicSegments.minY),t.push(this.pixelateFilter)}else{"blur_amount"==e.updating_id&&e.updating?BFN.StageModel.setRefreshFactor(.25):BFN.StageModel.setRefreshFactor(1);var r=this.blurFilter.apply(e.blur_amount/100);r.length&&t.push(r[0])}this._inverse!=e.inverse&&(this._inverse=e.inverse,this.imageContainer.addChildAt(this.opacitySprite,0),this._inverse?(this.imageContainer.addChildAt(this.sourceSprite,0),this.funkyMask.maskTarget=this.renderSprite,this.opacitySprite.texture=this.renderSprite.texture):(this.imageContainer.addChildAt(this.renderSprite,0),this.funkyMask.maskTarget=this.sourceSprite,this.opacitySprite.texture=this.sourceSprite.texture)),this.opacitySprite.alpha=this._inverse?0:Math.max(0,Math.min(1,1-e.opacity/100)),this.funkyMask.setOpacity(this._inverse?e.opacity/100:1),this.filterSprite.filters=t,this.renderPending=!0,BFN.MainUI.requestRender()}},sg.prototype.setSourceTexture=function(e){(null!=this.filterTexture&&(this.filterTexture.destroyGC(!0),this.filterTexture=null),null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.renderTexture&&(this.renderTexture.destroyGC(!0),this.renderTexture=null),this.opacitySprite.texture=null,e)?(this.sourceTexture=e,this.renderTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.renderTexture.copyPixels(this.sourceTexture),this.filterScale=Math.min(1,this.filterMaxSize/this.sourceTexture.width,this.filterMaxSize/this.sourceTexture.height),this.filterMinBlur=Math.min(Math.floor(this.sourceTexture.width*this.filterScale)/this.filterMaxSize,Math.floor(this.sourceTexture.height*this.filterScale)/this.filterMaxSize)/4,this.filterMaxBlur=1*Math.min(Math.floor(this.sourceTexture.width*this.filterScale)/this.filterMaxSize,Math.floor(this.sourceTexture.height*this.filterScale)/this.filterMaxSize),this.renderSprite.texture=this.renderTexture,this.sourceSprite.texture=this.sourceTexture,this.filterSprite.texture=this.sourceTexture,this.opacitySprite.texture=this._inverse?this.renderTexture:this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.pixelateFilter.textureW=this.sourceTexture.width,this.pixelateFilter.textureH=this.sourceTexture.height,Math.min(this.sourceTexture.width,this.sourceTexture.height)==this.sourceTexture.width?(this.mosaicSegments.minX=Math.min(8,this.sourceTexture.width),this.mosaicSegments.maxX=Math.min(64,this.sourceTexture.width),this.segmentRange=this.mosaicSegments.maxX-this.mosaicSegments.minX,this.ratio=this.sourceTexture.height/this.sourceTexture.width,this.mosaicSegments.minY=Math.max(1,Math.round(this.mosaicSegments.minX*this.ratio)),this.mosaicSegments.maxY=this.mosaicSegments.minY+Math.round(this.segmentRange*this.ratio)):(this.mosaicSegments.minY=Math.min(8,this.sourceTexture.height),this.mosaicSegments.maxY=Math.min(64,this.sourceTexture.height),this.segmentRange=this.mosaicSegments.maxY-this.mosaicSegments.minY,this.ratio=this.sourceTexture.width/this.sourceTexture.height,this.mosaicSegments.minX=Math.max(1,Math.round(this.mosaicSegments.minY*this.ratio)),this.mosaicSegments.maxX=this.mosaicSegments.minX+Math.round(this.segmentRange*this.ratio)),this.funkyMask.setup(this.sourceTexture.width,this.sourceTexture.height,.8),this.resetControls()):this.funkyMask.reset()},sg.prototype.resetControls=function(){var e=UITools.getToolVO("funky_focus").defaultValues;for(var t in e)UITools.setToolValue("funky_focus",t,e[t]);UITools.updateToolControls("funky_focus")},sg.prototype.setSmoothingScale=function(e){this.renderSprite.currentScale=e,this.opacitySprite.currentScale=e,this.sourceSprite.currentScale=e},sg.prototype.handleMainUIPreRender=function(e){this.renderPending&&BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS&&(this.renderPending=!1,BFN.Stage.render(this.filterSprite,this.renderTexture))},Object.defineProperty(sg.prototype,"toolScale",{set:function(e){this._scale=e,this.funkyMask.scale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(sg.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);this.imageContainer.x=0,this.imageContainer.y=0,this.setSmoothingScale(1);var t=this.funkyMask.guideVisible;return this.funkyMask.toggleGuide(!1,!0),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.funkyMask.toggleGuide(t,!0),e}}),Object.defineProperty(BFN,"ImageFocus",{get:function(){return!BFN._ImageFocus&&(BFN._ImageFocus=new sg),BFN._ImageFocus}}),lg.prototype=Object.create(PIXI.Sprite.prototype),lg.prototype.init=function(){BeFunky.log("ImageVignette Init"),this.initDefaultValues(),this.initImageContainer(),this.initBlendModeSprite(),this.initSourceSprite(),this.initColorSurface(),this.initFunkyMask()},lg.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this._vignetteColor=-1,this.forceDisplayUpdate=!1},lg.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},lg.prototype.initBlendModeSprite=function(){this.blendModeSprite=new BFN.BlendModeSprite(!1),this.blendModeSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.blendModeSprite)},lg.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},lg.prototype.initColorSurface=function(){this.colorSurfaceTexture=null},lg.prototype.initFunkyMask=function(){this.funkyMask=new BFN.FunkyMask,this.funkyMask.maskTarget=this.sourceSprite,this.funkyMask.showOuterHandles=!1,this.funkyMask.showRatioHandles=!0,this.imageContainer.addChild(this.funkyMask)},lg.prototype.handleVignette=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_VIGNETTE){var e=UITools.getToolVO("funky_vignette");"clear"==e.updating_id&&(this.resetControls(),e=UITools.getToolVO("funky_vignette")),this.funkyMask.maskMode!=e.mode&&(this.funkyMask.maskMode=e.mode),this.blendModeSprite.setBlendMode(parseInt(e.blend_mode)),this.blendModeSprite.setBlendIntensity(e.opacity),this.colorSurfaceTexture&&this._vignetteColor!="0x"+e.color&&(this._vignetteColor="0x"+e.color,this._vignetteColor,this.colorSurfaceTexture.fillColor(this._vignetteColor)),this.forceDisplayUpdate?(this.forceDisplayUpdate=!1,this.blendModeSprite.renderDisplay()):this.blendModeSprite.updateDisplay()}},lg.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.colorSurfaceTexture&&(this.colorSurfaceTexture.destroyGC(!0),this.colorSurfaceTexture=null),this._vignetteColor=-1,this.blendModeSprite.autoRender=!1,this.blendModeSprite.setBlendMode(null),this.blendModeSprite.setBaseTexture(null),this.blendModeSprite.setBlendTexture(null),e?(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.colorSurfaceTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.blendModeSprite.autoRender=!0,this.blendModeSprite.setBaseTexture(this.sourceTexture),this.blendModeSprite.setBlendTexture(this.colorSurfaceTexture),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.resetControls()):this.funkyMask.reset()},lg.prototype.resetControls=function(){this.sourceTexture&&(this.imageDiagonal=Math.sqrt(Math.pow(this.sourceTexture.width,2)+Math.pow(this.sourceTexture.height,2)),this.funkyMask.setup(this.sourceTexture.width,this.sourceTexture.height,1),this.funkyMask._hardness=.2,this.funkyMask.focusW=this.funkyMask.focusH=this.imageDiagonal,this.funkyMask.updateMaskGuide(),this.funkyMask.updateMaskTransform(),this.funkyMask.updateMaskDisplay(),this.forceDisplayUpdate=!0);var e=UITools.getToolVO("funky_vignette").defaultValues;for(var t in e)"mode"!=t&&UITools.setToolValue("funky_vignette",t,e[t]);UITools.setToolValue("funky_vignette","blend_mode",BFN.CONST.BLEND_MODES.NORMAL),UITools.updateToolControls("funky_vignette")},lg.prototype.setSmoothingScale=function(e){this.blendModeSprite.currentScale=e,this.sourceSprite.currentScale=e},Object.defineProperty(lg.prototype,"toolScale",{set:function(e){this._scale=e,this.funkyMask.scale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(lg.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);this.imageContainer.x=0,this.imageContainer.y=0,this.setSmoothingScale(1);var t=this.funkyMask.guideVisible;return this.funkyMask.toggleGuide(!1,!0),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.funkyMask.toggleGuide(t),e}}),Object.defineProperty(BFN,"ImageVignette",{get:function(){return!BFN._ImageVignette&&(BFN._ImageVignette=new lg),BFN._ImageVignette}}),hg.prototype=Object.create(PIXI.Container.prototype),hg.prototype.init=function(){BeFunky.log("TransformFrame Init"),this.initDefaultValues(),this.initImageSprite(),this.initFrameSprite()},hg.prototype.initDefaultValues=function(){this.texture=null,this.baseTexture=null},hg.prototype.initImageSprite=function(){this.imageSprite=new PIXI.Sprite,this.imageSprite.tint=8421504},hg.prototype.initFrameSprite=function(){this.frameSprite=new BFN.FrameSprite,this.frameSprite.updateDisplayCallback=this.updateDisplayCallback.bind(this),this.addChild(this.frameSprite)},hg.prototype.setTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.texture=e,this.baseTexture=null,e&&e.baseTexture&&(this.baseTexture=e.baseTexture,this.imageSprite.texture=new PIXI.Texture(this.baseTexture),this.frameSprite.setTexture(e))},hg.prototype.updateDisplay=function(){this.frameSprite.updateDisplay()},hg.prototype.updateDisplayCallback=function(){this.baseTexture&&(this.imageSprite.scale.x=this.frameSprite.width/this.frameSprite.textureFrame.width,this.imageSprite.scale.y=this.frameSprite.height/this.frameSprite.textureFrame.height,this.imageSprite.x=-(this.imageSprite.width-this.frameSprite.width)*this.frameSprite.offsetFactorX,this.imageSprite.y=-(this.imageSprite.height-this.frameSprite.height)*this.frameSprite.offsetFactorY)},hg.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.baseTexture=null,this.removeChild(this.frameSprite),this.frameSprite.destroy(e),this.removeChild(this.imageSprite),this.imageSprite.destroy(!1)},Object.defineProperty(hg.prototype,"frameWidth",{set:function(e){this.frameSprite.frameWidth=e},get:function(){return this.frameSprite.frameWidth}}),Object.defineProperty(hg.prototype,"frameHeight",{set:function(e){this.frameSprite.frameHeight=e},get:function(){return this.frameSprite.frameHeight}}),Object.defineProperty(hg.prototype,"offsetFactorX",{set:function(e){this.frameSprite.offsetFactorX=e},get:function(){return this.frameSprite.offsetFactorX}}),Object.defineProperty(hg.prototype,"offsetFactorY",{set:function(e){this.frameSprite.offsetFactorY=e},get:function(){return this.frameSprite.offsetFactorY}}),Object.defineProperty(hg.prototype,"textureScale",{set:function(e){this.frameSprite.textureScale=e},get:function(){return this.frameSprite.textureScale}}),Object.defineProperty(hg.prototype,"textureScaleX",{set:function(e){this.frameSprite.textureScaleX=e},get:function(){return this.frameSprite.textureScaleX}}),Object.defineProperty(hg.prototype,"textureScaleY",{set:function(e){this.frameSprite.textureScaleY=e},get:function(){return this.frameSprite.textureScaleY}}),Object.defineProperty(hg.prototype,"adjustScale",{get:function(){return this.frameSprite.adjustScale}}),Object.defineProperty(hg.prototype,"excessX",{get:function(){return this.frameSprite.excessX}}),Object.defineProperty(hg.prototype,"excessY",{get:function(){return this.frameSprite.excessY}}),Object.defineProperty(hg.prototype,"width",{get:function(){return this.frameSprite.width*this.scale.x}}),Object.defineProperty(hg.prototype,"height",{get:function(){return this.frameSprite.height*this.scale.y}}),Object.defineProperty(hg.prototype,"pluginName",{set:function(e){this.imageSprite.pluginName=e,this.frameSprite.pluginName=e},get:function(){return this.frameSprite.pluginName}}),Object.defineProperty(hg.prototype,"currentScale",{set:function(e){this.imageSprite.currentScale=e,this.frameSprite.currentScale=e},get:function(){return this.frameSprite.currentScale}}),Object.defineProperty(hg.prototype,"currentScaleY",{set:function(e){this.imageSprite.currentScaleY=e,this.frameSprite.currentScaleY=e},get:function(){return this.frameSprite.currentScaleY}}),Object.defineProperty(hg.prototype,"blendMode",{set:function(e){this.frameSprite.blendMode=e},get:function(){return this.frameSprite.blendMode}}),Object.defineProperty(hg.prototype,"smoothEdges",{set:function(e){this.imageSprite.smoothEdges=e,this.frameSprite.smoothEdges=e},get:function(){return this.frameSprite.smoothEdges}}),Object.defineProperty(hg.prototype,"fillColor",{set:function(e){this.frameSprite.fillColor=e},get:function(){return this.frameSprite.fillColor}}),Object.defineProperty(hg.prototype,"intensity",{set:function(e){this.frameSprite.intensity=e},get:function(){return this.frameSprite.intensity}}),Object.defineProperty(hg.prototype,"tint",{set:function(e){this.frameSprite.tint=e},get:function(){return this.frameSprite.tint}}),BFN.TransformFrame=hg,BFN.TransformItemEvents={ITEM_DISPLAY_UPDATED:new Event("ITEM_DISPLAY_UPDATED"),GET_SNAP_COORDINATES:new Event("GET_SNAP_COORDINATES"),PRESS_ITEM:new Event("PRESS_ITEM"),SELECT_ITEM:new Event("SELECT_ITEM"),DESELECT_ITEM:new Event("DESELECT_ITEM"),DUPLICATE_ITEM:new Event("DUPLICATE_ITEM"),REMOVE_ITEM:new Event("REMOVE_ITEM"),DESTROY_ITEM:new Event("DESTROY_ITEM"),REGISTER_TRANSITION:new Event("REGISTER_TRANSITION"),TRANSITION_APPLIED:new Event("TRANSITION_APPLIED"),TEXT_DISPLAY_UPDATED:new Event("TEXT_DISPLAY_UPDATED"),ACCURATE_BOUNDS_UPDATED:new Event("ACCURATE_BOUNDS_UPDATED"),THUMB_UPDATED:new Event("THUMB_UPDATED")},BFN.TransformItemTextBaseFontSize=20,BFN.TransformItemTextBaseLineHeight=1.05,BFN.TransformItemTextStrokePercentMin=.005,BFN.TransformItemTextStrokePercentMax=.15,BFN.TransformItemTextStrokePercentDefault=.07676767677,cg.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),cg.prototype.init=function(){BeFunky.log("TransformItem Init"),this.initDefaultValues(),this.initItemContent(),this.initLongPressValues(),this.updateSmoothingScale(),this.initialized=!0},cg.prototype.initDefaultValues=function(){switch(this.interactive=!0,this.buttonMode=!0,this.textMaskMaxSize=2048,this.mouseChildren=!1,this.updateProjectItemVO=BeFunky.debounce(this.updateProjectItemVO.bind(this),10),this.isTemplateItem=BFN.ProjectManager.sourceTemplateLoading,this.isGoodie=!!this.itemObject.hasOwnProperty("isGoodie")&&this.itemObject.isGoodie,this.graphicStyle=this.itemObject.graphicStyle,this.isShape=!1,this.fabricShape=null,this.selectedByMouse=!1,this.flippedHorizontal=!1,this.flippedVertical=!1,this.transforming=!1,this.accurateBounds=null,this.snapCoordinates=[],this.otherItemAccurateBoundsList=[],this.snapGapRects={},this.destroyed=!1,this.zIndexUpdating=!1,this.zIndexStart=null,this.bounds=new PIXI.Rectangle,this.itemBoundsData=null,this.itemGroupData={},this.transitionVO=null,this.lastTransitionVO=null,this.currentTransformItemStateVO=null,this._align=null,this._overlayColor=-1,this._overlayColorIntensity=0,this._tintColor=-1,this._locked=!1,this._isTransparent=void 0,this.shapeUpdatePending=!1,this.textUpdatePending=!1,this.textPadding=BFN.TransformItemTextBaseFontSize,this.fontSizeNormalizeFactor=1,this.textBackgroundColor=-1,this.textBackgroundIntensity=1,this.textBackgroundPadding=20,this.thumbTexture=null,this.thumbImage=null,this.presetItemThumbTextures=[],this.itemMoved=!1,this.preventEditText=!1,this.preventBaseTextureDestroy=!1,this.debugAccurateBounds=!1,this.ignoreAccurateBounds=this.itemObject.hasOwnProperty("projectItemVO"),this.accurateBoundsTimer=0,this.accurateBoundsRequested=!1,this.accurateBoundsIndervalID=null,this.transformTool=null,this.model=null,this.canvasModel=null,this.canvasModelEvents=null,this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:this.transformTool=BFN.PhotoEditorCanvas.transformTool,this.model=BFN.PhotoEditorModel,this.canvasModel=BFN.PhotoEditorCanvasModel,this.canvasModelEvents=BFN.PhotoEditorCanvasModelEvents;break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:this.transformTool=BFN.CollageMakerCanvas.transformTool,this.model=BFN.CollageMakerModel,this.canvasModel=BFN.CollageMakerCanvasModel,this.canvasModelEvents=BFN.CollageMakerCanvasModelEvents;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:this.transformTool=BFN.DesignerCanvas.transformTool,this.model=BFN.DesignerModel,this.canvasModel=BFN.DesignerCanvasModel,this.canvasModelEvents=BFN.DesignerCanvasModelEvents}if(this.projectVO=this.itemObject.hasOwnProperty("projectVO")?this.itemObject.projectVO:this.model.projectVO,this.basicShapeVO=this.itemObject.hasOwnProperty("basicShapeVO")?this.itemObject.basicShapeVO:null,this.itemID="item_".concat(BeFunky.randomString(10)),this.projectItemVOMutable=!0,this.itemObject.hasOwnProperty("projectItemVO"))this.projectItemVO=this.itemObject.projectItemVO,!this.itemObject.isDuplicate&&this.projectItemVO.itemID||(this.projectItemVO.itemID="item_".concat(BeFunky.randomString(10))),this.projectItemVO.itemID&&(this.itemID=this.projectItemVO.itemID);else{switch(this.projectItemVO=new BFN.ProjectItemVO,this.projectItemVO.itemID="item_".concat(BeFunky.randomString(10)),this.itemID="item_".concat(BeFunky.randomString(10)),this.projectItemVO.itemID=this.itemID,this.itemObject.type){case"text":this.projectItemVO.type="label",this.projectItemVO.labelWordBreaksEnabled=!0;break;case"texture":this.itemObject.texture?this.projectItemVO.type=this.itemObject.texture.baseTexture.hasOwnProperty("fabricShape")?"graphic":"image":this.projectItemVO.type=this.basicShapeVO?"graphic":"image";break;case"frame_texture":this.projectItemVO.type="mask_image"}if(this.itemObject.hasOwnProperty("projectItemAssetID"))switch(this.projectItemVO.type){case"graphic":this.projectItemVO.graphicID=this.itemObject.projectItemAssetID;break;case"image":this.projectItemVO.imageID=this.itemObject.projectItemAssetID;break;case"mask_image":this.projectItemVO.maskImageID=this.itemObject.projectItemAssetID}}this.graphicStyle&&(this.projectItemVO.graphicStyle=this.graphicStyle),this.maskFlippedHorizontal=this.projectItemVO.maskImageMaskFlippedHorizontal,this.maskFlippedVertical=this.projectItemVO.maskImageMaskFlippedVertical,this.itemObject.hasOwnProperty("readyCollback")&&(this.readyCallback=this.itemObject.readyCollback,delete this.itemObject.readyCallback),this.handleCanvasScalingUpdatedBind=this.handleCanvasScalingUpdated.bind(this),this.canvasModel.addEventListener(this.canvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),this.queueShapeUpdate=BeFunky.debounce(this.queueShapeUpdate.bind(this),0),this.queueTextUpdate=BeFunky.debounce(this.queueTextUpdate.bind(this),0)},cg.prototype.initItemContent=function(){switch(this.layerType=null,this.layerName=null,this.layerNum=-1,this.type=this.itemObject.type,this.type){case"texture":case"frame_texture":if(this.itemObject.texture&&this.itemObject.texture.baseTexture&&this.addPresetItemThumbTexture(this.itemObject.texture.baseTexture),this.layerType=this.isGoodie?this.basicShapeVO?"shape":"graphic":"image","frame_texture"===this.type){if(this.handleFrameDraggerDraggingBind=this.handleFrameDraggerDragging.bind(this),this.handleFrameDraggerDraggingCompleteBind=this.handleFrameDraggerDraggingComplete.bind(this),this.itemContent=new BFN.FrameSprite,this.itemContent.updateDisplayCallback=(()=>{this.resetTransparency()}),this.itemObject.texture.baseTexture.isTemplateAsset=this.isTemplateItem,this.itemContent.setTexture(new PIXI.Texture(this.itemObject.texture.baseTexture)),this.itemObject.hasOwnProperty("projectItemVO")?(this.itemContent.frameWidth=this.projectItemVO.maskImageFrameWidth,this.itemContent.frameHeight=this.projectItemVO.maskImageFrameHeight,this.itemContent.textureScale=1,this.itemContent.offsetFactorX=this.projectItemVO.maskImageOffsetFactorX,this.itemContent.offsetFactorY=this.projectItemVO.maskImageOffsetFactorY,this.scale.x=this.projectItemVO.transformScaleX,this.scale.y=this.projectItemVO.transformScaleY,this.itemContent.scale.x=1/this.projectItemVO.transformScaleX,this.itemContent.scale.y=1/this.projectItemVO.transformScaleY):(this.itemContent.frameWidth=this.itemContent.texture.baseTexture.width,this.itemContent.frameHeight=this.itemContent.texture.baseTexture.height),this.itemContent.updateDisplay(),this.itemObject.hasOwnProperty("maskTexture")&&this.itemObject.maskTexture){var e=this.itemObject.maskTexture.baseTexture.hasOwnProperty("fabricShape");if(this.isShape=!!this.basicShapeVO||e,this.fabricShape=e?this.itemObject.maskTexture.baseTexture.fabricShape:null,this.isShape)if(this.fabricShape){var t=null;(this.itemObject.isDuplicate||this.itemObject.newShape)&&(t=(()=>{if(this.readyCallback){try{this.readyCallback(this)}catch(e){}delete this.readyCallback}this.itemObject.newShape&&delete this.itemObject.newShape,this.updateShapeTexture(),BFN.MainUI.requestRender()})),this.itemContentMask=new PIXI.Sprite(BFN.SVGManager.getTexture(this.fabricShape,t)),this.itemContentMask.maskAlphaOnly=!0}else this.itemContentMask=new PIXI.Sprite(this.itemObject.maskTexture),this.itemContentMask.pluginName="smooth_picture",this.itemContentMask.maskAlphaOnly=!0,this.updateShapeTexture();else this.itemContentMask=new PIXI.Sprite(this.itemObject.maskTexture),this.itemContentMask.pluginName="smooth_picture",this.updateShapeTexture()}}else if(this.isShape=!1,this.itemObject.texture?(this.isShape=this.itemObject.texture.baseTexture.hasOwnProperty("fabricShape"),this.fabricShape=this.isShape?this.itemObject.texture.baseTexture.fabricShape:null):this.isShape=!!this.basicShapeVO,this.isShape){this.layerType=this.basicShapeVO?"shape":"graphic";var i=null,r=()=>{i.baseTexture.isTemplateAsset=this.isTemplateItem,(!this.isGoodie||this.isGoodie&&!BFN.SVGManager.textureHasModifiedShapeColors(this.itemContent.texture))&&this.updateShapeTexture(!0,!0);var e=BFN.TransformStateModel.getThumb(this),t=BFN.Util.getHTMLImage(e,null,!0);e.destroyGC(!0),this.thumbTexture&&(this.thumbTexture.destroyGC(!0),this.thumbTexture=null),this.thumbImage?this.thumbImage.src=t.src:(this.thumbImage=new Image,this.thumbImage.src=t.src),this.updateContentDimensions()};this.basicShapeVO?((i=PIXI.RenderTexture.create(this.basicShapeVO.shapeW,this.basicShapeVO.shapeH)).fillColor(0,0),setTimeout(r,0)):i=BFN.SVGManager.getTexture(this.fabricShape,r),this.itemContent=new PIXI.Sprite(i)}else this.itemObject.texture.baseTexture.isTemplateAsset=this.isTemplateItem,this.itemContent=new PIXI.Sprite(new PIXI.Texture(this.itemObject.texture.baseTexture));if(this.updateContentDimensions(),this.itemObject.hasOwnProperty("projectItemVO"))"frame_texture"===this.type&&(this.scale.x=this.projectItemVO.transformScaleX,this.scale.y=this.projectItemVO.transformScaleY);else if(this.itemObject.hasOwnProperty("initialDimensions")&&this.itemObject.initialDimensions)this.scale.x=this.itemObject.initialDimensions.x/this.itemContent.texture.baseTexture.width,this.scale.y=this.itemObject.initialDimensions.y/this.itemContent.texture.baseTexture.height;else if(this.itemObject.hasOwnProperty("initialScale")&&this.itemObject.initialScale)this.scale.x=this.itemObject.initialScale.x,this.scale.y=this.itemObject.initialScale.y;else{var a=Math.min(.5*this.itemObject.initialFrameWidth/this.itemContentW,.5*this.itemObject.initialFrameHeight/this.itemContentH);if(this.scale.x=this.scale.y=this.isShape?a:Math.min(1,a),!this.itemObject.projectItemVO&&"graphic"===this.projectItemVO.type&&this.basicShapeVO)switch(this.basicShapeVO.type){case"line":this.scale.y*=.2;break;case"arrow":this.scale.y*=.5}}this.updateFrameTextureDisplay(),this.resetFrameTextureScale();break;case"text":this.layerType="text";var n=this.itemObject.isDuplicate?"":BeFunky.LanguageManager.getString("click_when_selected");this.iText=new fabric.TextboxPad(n,{left:0,top:0,textAlign:"left",fontFamily:BFN.FabricManager.defaultFontFamily,fontSize:BFN.TransformItemTextBaseFontSize,padding:10,lineHeight:BFN.TransformItemTextBaseLineHeight,wordBreaksEnabled:this.projectItemVO.labelWordBreaksEnabled}),this.iText.strokeWidth=0,this.iText.objectCaching=!1,this.iText.paintFirst="stroke",this.iText._styleProperties.push("strokePercent"),this.conformTextWidthToContent(this.iText),this.iText.selectable=!1,this.iText.hasBorders=!1,this.iText.hasControls=!1,this.defaultTextStyles={fontFamily:BFN.FabricManager.defaultFontFamily,fontSize:BFN.TransformItemTextBaseFontSize,fill:"rgb(0,0,0,1)",textBackgroundColor:"",stroke:"",strokeWidth:1,strokePercent:BFN.TransformItemTextStrokePercentDefault};for(var o=0;o<this.iText.text.length;o++)this.iText._extendStyles(o,this.defaultTextStyles);if(this.itemsAffectedByTextHeight=[],this.preChangeTextHeight=0,this.handleTextHeightChangedBind=this.handleTextHeightChanged.bind(this),this.iText.on("height:changed",this.handleTextHeightChangedBind),this.itemObject.hasOwnProperty("isDuplicate")&&this.itemObject.isDuplicate&&this.itemObject.hasOwnProperty("sourceTransformItem")&&this.itemObject.sourceTransformItem){var s=this.itemObject.sourceTransformItem;this.textScale=s.textScale,this.iText.width=s.iText.width,this.iText.scaleX=this.iText.scaleY=this.textScale,this.iTexture=s.iTexture.renderClone()}else{var l={backgroundColor:"textBackgroundColor",backgroundIntensity:"textBackgroundIntensity",backgroundPadding:"textBackgroundPadding"};for(var h in BFN.FabricManager.userStyle.itemStyles)l.hasOwnProperty(h)&&this.hasOwnProperty(l[h])&&(this[l[h]]=BFN.FabricManager.userStyle.itemStyles[h]);for(var c in BFN.FabricManager.userStyle.globalStyles)this.iText[c]=BFN.FabricManager.userStyle.globalStyles[c];for(var u=0;u<this.iText.text.length;u++)this.iText._extendStyles(u,BFN.FabricManager.userStyle.charStyles),this.iText._extendStyles(u,{fontSize:BFN.TransformItemTextBaseFontSize});this.conformTextWidthToContent(this.iText),this.textScale=.5*this.itemObject.initialFrameWidth/this.iText.width,this.iText.scaleX=this.iText.scaleY=this.textScale;var d=this.iText.width*this.textScale,m=this.iText.height*this.textScale,p=Math.round(d+2*this.textPadding*this.textScale),g=Math.round(m+2*this.textPadding*this.textScale);this.iTexture=PIXI.RenderTexture.create(p,g)}this.itemContent=new PIXI.Sprite(this.iTexture),this.updateContentDimensions(),this.scale.x=this.scale.y=1}if(this.addChild(this.itemContent),this.itemContent.pluginName="blend_picture",this.itemContent.currentScale=1,this.itemContent.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.itemContent.smoothEdges=!0,this.itemBlendMode=BFN.CONST.BLEND_MODES.NORMAL,this.itemContentMask&&(this.addChild(this.itemContentMask),this.itemContent.mask=this.itemContentMask),"text"===this.type&&(this.hiResTextReady=!1,this.hiResTextRect=new BFN.Rectangle,this.hiResTextTexture=PIXI.RenderTexture.create(16,16,PIXI.SCALE_MODES.LINEAR,BFN.HiResTextManager.enableRetinaScaling?2:1),this.hiResTextSprite=new PIXI.Sprite(this.hiResTextTexture),this.hiResTextSprite.interactive=!1,this.hiResTextSprite.visible=!1,this.hiResTextSprite.pluginName="blend_picture",this.hiResTextSprite.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.addChild(this.hiResTextSprite),BFN.HiResTextManager.showHiResTextHelpers&&(this.hiResTextHelper=new PIXI.Graphics,this.addChild(this.hiResTextHelper))),"text"!==this.type||this.itemObject.hasOwnProperty("isDuplicate")&&this.itemObject.isDuplicate||this.itemObject.hasOwnProperty("projectItemVO")||this.setTextWidth(this.itemContentW),this.shapeColorGroupsNum=0,this.shapeColorMap=null,this.shapeObjectFills=!1,this.isGoodie&&this.isShape&&"graphic"===this.layerType&&this.itemContent.texture&&this.itemContent.texture.baseTexture){var f=this.itemContent.texture.baseTexture;if(f.fabricShapeColorMap)for(var v in this.shapeColorMap=this.itemContent.texture.baseTexture.fabricShapeColorMap,this.itemContent.texture.baseTexture.fabricShapeColorMap)this.shapeColorGroupsNum=Math.max(this.shapeColorGroupsNum,parseInt(v)+1);f.fabricShape&&(this.shapeObjectFills=!!f.fabricShape.containsObjectFills)}if(this.shapeColorMap&&this.itemObject.isDuplicate&&this.itemObject.sourceTransformItem){var y=this.itemObject.sourceTransformItem.itemContent.texture.baseTexture.fabricShapeColorMap;for(var x in y){var _=y[x];if(this.shapeColorMap.hasOwnProperty(x)){var I=this.shapeColorMap[x];I.colorHash=_.colorHash,I.colorOpacity=_.colorOpacity}}}this.itemObject.hasOwnProperty("isDuplicate")&&delete this.itemObject.isDuplicate,this.hoverDropFilter=new BFN.filters.ColorOverlayFilter,this.hoverDropFilter.roundingDisabled=!0,this.hoverDropFilter.color=2154751,this.handleHoverDropAnimatorUpdateBind=this.handleHoverDropAnimatorUpdate.bind(this),this.hoverDropAnimator=new BFN.Animator,this.hoverDropAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleHoverDropAnimatorUpdateBind)},cg.prototype.conformTextWidthToContent=function(e){e.width=Math.pow(2,14),e.initDimensions();for(var t=e._splitTextIntoLines(e.text).lines,i=0,r=0;r<t.length;r++)i=Math.ceil(Math.max(i,e.measureLine(r).width+1));e.width=i},cg.prototype.pressItem=function(e){BFN.TransformItemEvents.PRESS_ITEM.targetItem=this,BFN.TransformItemEvents.PRESS_ITEM.externalPress=!0,BFN.TransformItemEvents.PRESS_ITEM.data={},BFN.TransformItemEvents.PRESS_ITEM.data.originalEvent=e,this.dispatchEvent(BFN.TransformItemEvents.PRESS_ITEM)},cg.prototype.refreshItemThumb=function(){UILayers.handleItemsUpdated()},cg.prototype.refreshItemName=function(){UILayers.handleItemsUpdated()},cg.prototype.initLongPressValues=function(){this.longPressOccurred=!1,this.handlePointerDownBind=this.handlePointerDown.bind(this),this.on("pointerdown",this.handlePointerDownBind)},cg.prototype.handlePointerDown=function(e){this.initiateLongPress()},cg.prototype.initiateLongPress=function(){this.longPressOccurred=!1;BFN.LongPressManager.initiateLongPress(e=>{this.longPressOccurred=!0,setTimeout(()=>{this.longPressOccurred=!1},0),document.dispatchEvent(new MouseEvent(BeFunky.pointerup)),this.transformLayer.transformTool.gizmoDragger.dragging&&this.transformLayer.transformTool.gizmoDragger.stopDrag(),this.pressItem(e)})},cg.prototype.selectItem=function(){this.dispatchEvent(BFN.TransformItemEvents.SELECT_ITEM)},cg.prototype.deselectItem=function(){this.dispatchEvent(BFN.TransformItemEvents.DESELECT_ITEM)},cg.prototype.duplicateItem=function(){this.dispatchEvent(BFN.TransformItemEvents.DUPLICATE_ITEM)},cg.prototype.removeItem=function(){this.dispatchEvent(BFN.TransformItemEvents.REMOVE_ITEM)},cg.prototype.destroyItem=function(){this.destroyed||(this.off("pointerdown",this.handlePointerDownBind),"text"===this.type&&this.iText&&this.iText.off("height:changed",this.handleTextHeightChangedBind),this.dispatchEvent(BFN.TransformItemEvents.DESTROY_ITEM))},cg.prototype.updateAccurateBounds=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.debugAccurateBounds;if(this.currentTransformItemStateVO){var i=this.currentTransformItemStateVO;if(i.accurateBounds){if(this.accurateBounds=i.accurateBounds,!e)return t&&(console.log(this.layerName,"- State has Accurate Bounds, Skipping Recalculation"),console.log("")),this.updateHiResTextBounds(),void this.dispatchEvent(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED);t&&console.log(this.layerName,"- State has Accurate Bounds, But Recalculating ( Alpha Bounds Forced )")}else this.accurateBounds=BFN.Util.getTransformItemBounds(this,!0),this.accurateBounds.minX=this.accurateBounds.minY=0,this.accurateBounds.maxX=this.accurateBounds.width,this.accurateBounds.maxY=this.accurateBounds.height,this.accurateBounds.centerX=this.accurateBounds.width/2,this.accurateBounds.centerY=this.accurateBounds.height/2;if(this.ignoreAccurateBounds)t&&(console.log(this.layerName,"- Accurate Bounds Ignored, Using Approximation from",i.accurateBounds?"state":"polygon"),console.log(""));else if(this.accurateBoundsTimer=10,this.projectItemVO.hasOwnProperty("labelBounds")&&(this.accurateBoundsTimer=0),this.accurateBoundsRequested)t&&(console.log(this.layerName,"- Accurate Bounds Already Requested, Ignoring Call..."),console.log(""));else{t&&console.log(this.layerName,"Countdown Starting"),this.accurateBoundsRequested=!0,BFN.accurateBoundsQueue.push(this);var r=()=>{if(BFN.accurateBoundsQueue.length&&BFN.accurateBoundsQueue[0]!==this)BFN.accurateBoundsQueue.includes(this)?setTimeout(r,0):this.accurateBoundsRequested=!1;else if(--this.accurateBoundsTimer>0)BFN.accurateBoundsQueue.includes(this)?setTimeout(r,0):this.accurateBoundsRequested=!1;else if(t&&console.log(this.layerName,"Countdown Complete"),BFN.accurateBoundsQueue.shift(),this.accurateBoundsRequested=!1,this.parent){if(this.currentTransformItemStateVO){var i=this.currentTransformItemStateVO;if(i.accurateBounds){if(this.accurateBounds=i.accurateBounds,!e)return t&&(console.log(this.layerName,"- State has Accurate Bounds, Skipping Recalculation"),console.log("")),this.updateHiResTextBounds(),void this.dispatchEvent(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED);t&&console.log(this.layerName,"- State has Accurate Bounds, But Recalculating ( Alpha Bounds Forced )")}else t&&console.log(this.layerName,"- State has No Accurate Bounds, Calculating...");var a=BFN.Util.getTransformItemBounds(this),n=BFN.Util.getTransformItemTexture(this,a);if(n){t&&(console.log(this.layerName,"- Calculating Accurate Alpha Bounds Now..."),console.log(""));var o=1/Math.max(n.width/a.width,n.height/a.height);if(this.accurateBounds=BFN.Util.getAlphaBounds(n,null,o,!1,!1),n.clear(),n.resize(256,256),this.accurateBounds.noBounds){var s=BFN.Util.getTransformItemBounds(this,!0);this.accurateBounds.minX=this.accurateBounds.minY=0,this.accurateBounds.maxX=this.accurateBounds.width=s.width,this.accurateBounds.maxY=this.accurateBounds.height=s.height,this.accurateBounds.centerX=s.width/2,this.accurateBounds.centerY=s.height/2}if(i.accurateBounds=Object.assign({},this.accurateBounds),this.projectItemVO.hasOwnProperty("labelBounds")){var l=a.minX+this.accurateBounds.minX,h=a.minY+this.accurateBounds.minY,c=this.projectItemVO.labelBounds.x-l,u=this.projectItemVO.labelBounds.y-h;this.x+=c,this.y+=u,this.projectItemVO.transformX=this.x,this.projectItemVO.transformY=this.y,this.projectItemVO.labelBounds=null,delete this.projectItemVO.labelBounds,this.setTransitionStartState(),this.setTransitionEndState(),BFN.ProjectManager.requestLocalSave()}else if(this.projectItemVO.hasOwnProperty("positionOffsetVectors")){for(var d=0;d<this.projectItemVO.positionOffsetVectors.length;d++){var m=this.projectItemVO.positionOffsetVectors[d];this.x+=Math.cos(m.direction)*m.distance,this.y+=Math.sin(m.direction)*m.distance}this.projectItemVO.transformX=this.x,this.projectItemVO.transformY=this.y,this.projectItemVO.positionOffsetVectors.splice(0),this.projectItemVO.positionOffsetVectors=null,delete this.projectItemVO.positionOffsetVectors,this.setTransitionStartState(),this.setTransitionEndState(),BFN.ProjectManager.requestLocalSave()}this.updateHiResTextBounds(),this.dispatchEvent(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED)}BFN.MainUI.requestRender()}}else t&&console.log(this.layerName,"No Parent, Aborting...")};r()}}},cg.prototype.updateSmoothingScale=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i="frame_texture"!==this.type||this.canvasScaling?1:this.itemContent.adjustScale*this.itemContent.textureScaleX,r="frame_texture"!==this.type||this.canvasScaling?1:this.itemContent.adjustScale*this.itemContent.textureScaleY;this.itemContent.currentScale=(e?this.scale.x*Math.abs(this.itemContent.scale.x)*e:this.canvasScaling?1:this.scale.x*Math.abs(this.itemContent.scale.x)*this.canvasScale)*i,this.itemContent.currentScaleY=(e?this.scale.y*Math.abs(this.itemContent.scale.y)*e:this.canvasScaling?1:this.scale.y*Math.abs(this.itemContent.scale.y)*this.canvasScale)*r,t&&BFN.MainUI.requestRender()},cg.prototype.updateContentDimensions=function(){this.itemContentW==this.itemContent.width&&this.itemContentH==this.itemContent.height||("text"===this.type?(this.itemContent.scale.x=Math.abs(this.itemContent.scale.x)*(this.flippedHorizontal?-1:1),this.itemContent.scale.y=Math.abs(this.itemContent.scale.y)*(this.flippedVertical?-1:1),this.itemContentW=this.itemContent.width-Math.round(2*this.textPadding*this.textScale),this.itemContentH=this.itemContent.height-Math.round(2*this.textPadding*this.textScale)):(this.itemContentW=this.itemContent.width,this.itemContentH=this.itemContent.height,this.basicShapeVO&&(this.itemContentW="frame_texture"===this.type?Math.round(this.basicShapeVO.shapeW/this.basicShapeVO.fitScale):100,this.itemContentH="frame_texture"===this.type?Math.round(this.basicShapeVO.shapeH/this.basicShapeVO.fitScale):100)),this.itemContentW=Math.abs(this.itemContentW),this.itemContentH=Math.abs(this.itemContentH),this.updateBounds())},cg.prototype.updateBounds=function(){if(this.bounds=new PIXI.Rectangle(0,0,this.itemContentW,this.itemContentH),this.polygon=[new PIXI.Point(0,0),new PIXI.Point(this.itemContentW,0),new PIXI.Point(this.itemContentW,this.itemContentH),new PIXI.Point(0,this.itemContentH)],"text"===this.type){var e=this.textPadding*this.textScale;this.textPolygon=[new PIXI.Point(-e,-e),new PIXI.Point(this.itemContentW+e,-e),new PIXI.Point(this.itemContentW+e,this.itemContentH+e),new PIXI.Point(-e,this.itemContentH+e)]}this.updateHitArea()},cg.prototype.updateHitArea=function(){var e=10/this.canvasScale,t=(this.itemContentW*this.scale.x<e?(e-this.itemContentW*this.scale.x)/2:0)/this.scale.x,i=(this.itemContentH*this.scale.y<e?(e-this.itemContentH*this.scale.y)/2:0)/this.scale.y,r=-t,a=-i,n=this.itemContentW+2*t,o=this.itemContentH+2*i;this.hitArea=new PIXI.Rectangle(r,a,n,o)},cg.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.destroyed){if(this.destroyPresetItemThumbTextures(),"frame_texture"===this.type&&(this.hoverDropAnimator.setAnimatorFactor(0),this.hoverDropAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleHoverDropAnimatorUpdateBind),this.hoverDropAnimator=null,this.hoverDropFilter=null),this.canvasModel.removeEventListener(this.canvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),!this.itemContent.texture.baseTexture.isPattern)try{this.itemContent.texture.destroyGC(!e.includes(this.itemContent.texture.baseTexture)&&!this.preventBaseTextureDestroy)}catch(e){}this.itemContent.destroy(!1),this.itemContentMask&&(this.itemContent.mask=null,this.itemContentMask.texture.destroyGC(!e.includes(this.itemContentMask.texture.baseTexture)),this.itemContentMask.destroy(!1),this.removeChild(this.itemContentMask));try{"text"!==this.type&&(this.thumbTexture.destroyGC(!0),this.thumbImage.src=""),this.thumbTexture=null,this.thumbImage=null}catch(e){}this.removeChild(this.itemContent),this.itemContent=null,this.hiResTextTexture&&(this.hiResTextTexture.destroy(!0),this.hiResTextTexture=null),this.hiResTextSprite&&this.children.includes(this.hiResTextSprite)&&(this.hiResTextSprite.destroy(!1),this.removeChild(this.hiResTextSprite),this.hiResTextSprite=null),this.hiResTextHelper&&this.children.includes(this.hiResTextHelper)&&(this.removeChild(this.hiResTextHelper),this.hiResTextHelper=null),this.destroyed=!0}},cg.prototype.updateHiResTextBounds=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(BFN.HiResTextManager.useHiResText)if("text"!==this.type||BFN.FabricManager.showingTransformItemIText||BFN.FabricManager.currentTextTransformItem===this&&!i)t&&t();else{t&&(this.updateHiResTextBoundsCallback=t),this.hiResTextReady=!1,this.toggleHiResText(!1);var r=BFN.HiResTextManager.hiResTextViewportBounds,a=this.globalTextPolygon,n=Math.max(r.left,Math.min(a[0].x,a[1].x,a[2].x,a[3].x)),o=Math.max(r.top,Math.min(a[0].y,a[1].y,a[2].y,a[3].y)),s=Math.min(r.right,Math.max(a[0].x,a[1].x,a[2].x,a[3].x)),l=Math.min(r.bottom,Math.max(a[0].y,a[1].y,a[2].y,a[3].y)),h=new BFN.Rectangle(n,o,s-n,l-o),c=this.toLocal(new PIXI.Point(Math.round(h.x),Math.round(h.y)),BFN.MainUI);this.hiResTextRect.globalX=Math.round(h.x),this.hiResTextRect.globalY=Math.round(h.y),this.hiResTextRect.x=c.x,this.hiResTextRect.y=c.y,this.hiResTextRect.width=Math.max(0,Math.ceil(h.width)),this.hiResTextRect.height=Math.max(0,Math.ceil(h.height)),BFN.HiResTextManager.showHiResTextHelpers&&(this.hiResTextHelper.x=this.hiResTextRect.x,this.hiResTextHelper.y=this.hiResTextRect.y,this.hiResTextHelper.rotation=-this.rotation,this.hiResTextHelper.scale.x=this.hiResTextHelper.scale.y=1/this.canvasScale/this.scale.x,this.hiResTextHelper.clear(),this.hiResTextRect.width&&this.hiResTextRect.height&&(this.hiResTextHelper.lineStyle(2,65280),this.hiResTextHelper.drawRect(0,0,this.hiResTextRect.width,this.hiResTextRect.height),this.hiResTextRect.width>10&&this.hiResTextRect.height>10&&(this.hiResTextHelper.lineStyle(1,65280),this.hiResTextHelper.drawRect(5,5,this.hiResTextRect.width-10,this.hiResTextRect.height-10)))),this.handleMainUIPostPreRenderBind||(this.handleMainUIPostPreRenderBind=this.handleMainUIPostPreRender.bind(this)),e&&!this.awaitingPreRender&&(this.awaitingPreRender=!0,BFN.MainUI.addEventListener(BFN.MainUIEvents.POST_PRE_RENDER.type,this.handleMainUIPostPreRenderBind))}else t&&t()},cg.prototype.handleMainUIPostPreRender=function(){BFN.MainUI.removeEventListener(BFN.MainUIEvents.POST_PRE_RENDER.type,this.handleMainUIPostPreRenderBind),this.awaitingPreRender=!1,BFN.HiResTextManager.conformHiResTextCanvas(),this.renderHiResText(this.updateHiResTextBoundsCallback?this.updateHiResTextBoundsCallback:void 0),delete this.updateHiResTextBoundsCallback},cg.prototype.updateHiResText=function(){},cg.prototype.renderHiResText=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;BFN.HiResTextManager.useHiResText&&"text"===this.type&&this.hiResTextRect.width&&this.hiResTextRect.height&&!this.hiResTextReady&&(this.hiResTextTexture.resize(Math.ceil(this.hiResTextRect.width),Math.ceil(this.hiResTextRect.height)),BFN.HiResTextManager.showHiResTextHelpers&&this.hiResTextTexture.fillColor(128,.5),this.hiResTextSprite.x=this.hiResTextRect.x,this.hiResTextSprite.y=this.hiResTextRect.y,this.hiResTextSprite.rotation=-this.rotation,this.hiResTextSprite.scale.x=this.hiResTextSprite.scale.y=1/this.canvasScale/this.scale.x,BFN.HiResTextManager.conformITextToTransformItem(this),BFN.HiResTextManager.drawHiResTextToTransformItem(this),this.hiResTextReady=!0,this.toggleHiResText(!0),BFN.MainUI.requestRender()),e&&e()},cg.prototype.toggleHiResText=function(e){if("text"===this.type){var t=!!(BFN.HiResTextManager.useHiResText&&this.hiResTextReady&&e),i=!([BFN.TransformModel.selectedTransformItem,BFN.TransformModel.selectedTransformItemText].includes(this)&&BFN.FabricManager.showingTransformItemIText);this.hiResTextSprite.visible=t&&i,this.itemContent.visible=!t&&i}},cg.prototype.createTransition=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.transitionVO&&(this.transitionVO.id!=e||!this.transitionVO.isGroupTransition&&this.isGroupTransition)&&(this.lastTransitionVO=null),this.transitionVO=new BFN.TransformItemTransitionVO,this.transitionVO.id=e,this.transitionVO.transformItem=this,this.transitionVO.isCreateTransition=t,this.transitionVO.isGroupTransition=!!this.isGroupTransition,this.transitionVO.useGroupIcon=i,this.setTransitionStartState(),this.accurateBounds&&(this.transitionVO.startState.accurateBounds=Object.assign({},this.accurateBounds)),"text"===this.type&&this.iText&&this.updateItemsAffectedByTextHeight()},cg.prototype.registerTransition=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.transitionVO&&(this.setTransitionEndState(),this.currentTransformItemStateVO=this.transitionVO.endState,e?(this.lastTransitionVO?(this.currentTransformItemStateVO=this.lastTransitionVO.endState,this.updateStateVO(this.currentTransformItemStateVO)):(this.ignoreTextHeight||(this.transitionVO.batchIDPlaceholder=this.registerItemsAffectedByTextHeight()),this.lastTransitionVO=this.transitionVO,this.dispatchEvent(BFN.TransformItemEvents.REGISTER_TRANSITION)),t&&(this.currentTransformItemStateVO&&(this.currentTransformItemStateVO.accurateBounds=null),this.updateAccurateBounds())):(this.ignoreTextHeight||(this.transitionVO.batchIDPlaceholder=this.registerItemsAffectedByTextHeight()),this.lastTransitionVO=null,this.dispatchEvent(BFN.TransformItemEvents.REGISTER_TRANSITION),t?(this.currentTransformItemStateVO&&(this.currentTransformItemStateVO.accurateBounds=null),this.updateAccurateBounds()):this.currentTransformItemStateVO&&!this.currentTransformItemStateVO.accurateBounds&&this.transitionVO.startState.accurateBounds&&(this.debugAccurateBounds&&console.log(this.layerName,"- Applying startState Bounds to endState Bounds"),this.currentTransformItemStateVO.accurateBounds=Object.assign({},this.transitionVO.startState.accurateBounds)))),this.updateProjectItemVO()},cg.prototype.setTransition=function(e){this.transitionVO=e,this.lastTransitionVO=null},cg.prototype.setTransitionStartState=function(){this.transitionVO&&this.updateStateVO(this.transitionVO.startState)},cg.prototype.setTransitionEndState=function(){this.transitionVO&&this.updateStateVO(this.transitionVO.endState)},cg.prototype.updateStateVO=function(e){this.parent&&(e.parent=this.parent,e.zIndex=this.parent.getChildIndex(this)),e.locked=this._locked,e.x=this.x,e.y=this.y,e.scaleX=this.scale.x,e.scaleY=this.scale.y,e.rotation=this.rotation,e.opacity=100*this.alpha,e.blendMode=this.itemBlendMode,e.tint=this.tintColor,e.overlayColor=this.overlayColor,e.overlayColorIntensity=this.overlayColorIntensity,e.flippedHorizontal=this.flippedHorizontal,e.flippedVertical=this.flippedVertical,this.basicShapeVO&&(e.basicShapeValues=Object.assign({},this.basicShapeVO.getValues())),e.shapeColorMap=this.getShapeColorMap(),"text"===this.type&&(e.text=this.iText.text,e.textStyle=this.getTextStyle(),e.textWidth=this.iText.width,e.textScale=this.textScale,e.textItemScale=this.scale.x,e.textBackgroundColor=this.textBackgroundColor,e.textBackgroundIntensity=this.textBackgroundIntensity,e.textBackgroundPadding=this.textBackgroundPadding),"frame_texture"===this.type&&(e.imageID=this.projectItemVO.maskImageID,e.imageTexture=this.itemContent.texture,e.maskImageFrameWidth=this.itemContent.frameWidth,e.maskImageFrameHeight=this.itemContent.frameHeight,e.maskImageOffsetFactorX=this.itemContent.offsetFactorX,e.maskImageOffsetFactorY=this.itemContent.offsetFactorY,e.maskImageTextureScale={x:this.itemContent.textureScaleX,y:this.itemContent.textureScaleY}),"texture"===this.type&&(e.imageID=this.projectItemVO.imageID,e.imageTexture=this.itemContent.texture)},cg.prototype.getTransition=function(){return this.transitionVO},cg.prototype.clearTransition=function(){this.lastTransitionVO=null},cg.prototype.applyTransformItemState=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.currentTransformItemStateVO=e;try{e.parent&&-1!==e.parent.children.indexOf(this)&&e.parent.getChildIndex(this)!=e.zIndex?e.parent.setChildIndex(this,Math.min(this.parent.children.length-1,e.zIndex)):e.parent&&-1===e.parent.children.indexOf(this)?(e.parent.addChild(this),e.parent.setChildIndex(this,Math.min(this.parent.children.length-1,e.zIndex))):this.parent&&!e.parent&&this.parent.removeChild(this)}catch(e){BeFunky.log("LAYER ORDER ERROR")}this.locked=e.locked,this.updateValue(this,"x",e,"x"),this.updateValue(this,"y",e,"y"),this.updateValue(this.scale,"x",e,"scaleX"),this.updateValue(this.scale,"y",e,"scaleY"),this.updateValue(this,"rotation",e,"rotation"),this.alpha=e.opacity/100,this.tintColor=e.tint,this.overlayColor=e.overlayColor,this.overlayColorIntensity=e.overlayColorIntensity,this.setBlendMode(e.blendMode),this.basicShapeVO&&e.basicShapeValues&&this.basicShapeVO.setValues(e.basicShapeValues),this.setShapeColorMap(e.shapeColorMap,!1),["text","frame_texture"].includes(this.type)||this.shapeUpdatePending||(this.shapeUpdatePending=!0,this.queueShapeUpdate()),"text"===this.type&&(this.pendingTransformItemState=e,this.textUpdatePending||(this.textUpdatePending=!0,BFN.MainUI.rendering=!1,this.renderable=!1,this.queueTextUpdate())),"frame_texture"===this.type?(e.imageID&&this.projectItemVO.maskImageID!==e.imageID&&(this.projectItemVO.maskImageID=e.imageID),e.imageTexture&&this.itemContent.texture!==e.imageTexture&&(this.itemObject.texture=e.imageTexture,this.itemContent.setTexture(e.imageTexture),this.updateThumb()),this.itemContent.frameWidth=e.maskImageFrameWidth,this.itemContent.frameHeight=e.maskImageFrameHeight,this.itemContent.textureScaleX=e.maskImageTextureScale.x,this.itemContent.textureScaleY=e.maskImageTextureScale.y,this.itemContent.offsetFactorX=e.maskImageOffsetFactorX,this.itemContent.offsetFactorY=e.maskImageOffsetFactorY,this.itemContent.updateDisplay(),this.itemContentW=this.itemContent.frameWidth,this.itemContentH=this.itemContent.frameHeight,this.updateBounds(),this.updateSmoothingScale()):this.updateHitArea(),"texture"!==this.type||this.isGoodie||(e.imageID&&this.projectItemVO.imageID!==e.imageID&&(this.projectItemVO.imageID=e.imageID),e.imageTexture&&this.itemContent.texture!==e.imageTexture&&(this.itemObject.texture=e.imageTexture,this.itemContent.texture=e.imageTexture,this.updateThumb(),this.updateContentDimensions())),e.flippedHorizontal!=this.flippedHorizontal&&this.flipHorizontal(),e.flippedVertical!=this.flippedVertical&&this.flipVertical(),this.updateFrameTextureDisplay(),this.resetFrameTextureScale(),t&&(this.transitionVO=this.lastTransitionVO=null),this.dispatchEvent(BFN.TransformItemEvents.TRANSITION_APPLIED),this.updateSmoothingScale(),this.updateAccurateBounds(),this.updateProjectItemVO(),this.model.updateProjectVO(),BFN.MainUI.requestRender()},cg.prototype.updateValue=function(e,t,i,r){try{e[t]=i[r]}catch(e){}},cg.prototype.updateProjectItemVO=function(){if(this.projectItemVO&&!BFN.ProjectManager.transformItemsPending){switch(this.projectItemVO.type){case"graphic":this.basicShapeVO&&(this.projectItemVO.basicShapeValues=this.basicShapeVO.getValues()),this.graphicStyle&&(this.projectItemVO.graphicStyle=this.graphicStyle),this.projectItemVO.shapeColorMap=this.getShapeColorMap();break;case"image":this.graphicStyle&&(this.projectItemVO.graphicStyle=this.graphicStyle);break;case"mask_image":"frame_texture"===this.type&&(this.projectItemVO.maskImageFrameWidth=this.itemContent.frameWidth,this.projectItemVO.maskImageFrameHeight=this.itemContent.frameHeight,this.projectItemVO.maskImageOffsetFactorX=this.itemContent.offsetFactorX,this.projectItemVO.maskImageOffsetFactorY=this.itemContent.offsetFactorY,this.projectItemVO.maskImageTextureScale={x:this.itemContent.textureScaleX,y:this.itemContent.textureScaleY},this.basicShapeVO&&(this.projectItemVO.basicShapeValues=this.basicShapeVO.getValues()));break;case"label":"text"===this.type&&(this.projectItemVO.labelText=this.iText.text,this.projectItemVO.labelTextStyles=this.getTextStyle(),this.projectItemVO.labelWidth=this.iText.width,this.projectItemVO.labelTextScale=this.textScale,this.projectItemVO.labelTextItemScale=this.scale.x,this.projectItemVO.labelTextBackgroundColor=this.textBackgroundColor,this.projectItemVO.labelTextBackgroundIntensity=this.textBackgroundIntensity,this.projectItemVO.labelTextBackgroundPadding=this.textBackgroundPadding,this.projectItemVO.labelWordBreaksEnabled=this.iText.wordBreaksEnabled);break;default:return}this.projectItemVO.layerName=this.layerName,this.projectItemVO.layerNum=this.layerNum,this.parent&&(this.projectItemVO.transformZIndex=this.parent.getChildIndex(this)),this.projectItemVO.isGoodie=this.isGoodie,this.projectItemVO.transformLocked=this._locked,this.projectItemVO.transformX=this.x,this.projectItemVO.transformY=this.y,this.projectItemVO.transformRotation=this.rotation,this.projectItemVO.transformScaleX=this.scale.x,this.projectItemVO.transformScaleY=this.scale.y,this.projectItemVO.transformWidth=this.itemContentW*this.scale.x,this.projectItemVO.transformHeight=this.itemContentH*this.scale.y,this.projectItemVO.transformFlippedHorizontal=this.flippedHorizontal,this.projectItemVO.transformFlippedVertical=this.flippedVertical,this.projectItemVO.transformOpacity=100*this.alpha,this.projectItemVO.transformBlendMode=this.itemBlendMode,this.projectItemVO.transformOverlayColor=this.overlayColor,this.projectItemVO.transformOverlayColorIntensity=this.overlayColorIntensity,this.projectItemVO.transformTintColor=this.tintColor,BFN.ProjectManager.requestLocalSave()}},cg.prototype.updateFrameTextureDisplay=function(){"frame_texture"===this.type&&(this.itemContent.frameWidth=this.itemContentW*this.scale.x,this.itemContent.frameHeight=this.itemContentH*this.scale.y,this.itemContent.scale.x=1/this.scale.x*(this.flippedHorizontal?-1:1),this.itemContent.scale.y=1/this.scale.y*(this.flippedVertical?-1:1),this.itemContent.updateDisplay())},cg.prototype.resetFrameTextureScale=function(){"frame_texture"===this.type&&(this.itemContent.frameWidth=Math.abs(this.itemContent.width/this.itemContent.scale.x),this.itemContent.frameHeight=Math.abs(this.itemContent.height/this.itemContent.scale.y),this.itemContent.x=this.flippedHorizontal?this.itemContent.frameWidth:0,this.itemContent.y=this.flippedVertical?this.itemContent.frameHeight:0,this.itemContent.scale.x=this.flippedHorizontal?-1:1,this.itemContent.scale.y=this.flippedVertical?-1:1,this.itemContent.updateDisplay(),this.scale.x=this.scale.y=1,this.updateContentDimensions(),this.shapeUpdatePending||(this.shapeUpdatePending=!0,this.queueShapeUpdate()))},cg.prototype.resetFrameTexture=function(){"frame_texture"===this.type&&(this.createTransition("history_image_region"),this.itemContent.textureScaleX=this.itemContent.textureScaleY=1,this.itemContent.offsetFactorX=this.itemContent.offsetFactorY=.5,this.itemContent.updateDisplay(),this.updateContentDimensions(),this.updateAccurateBounds(),this.updateSmoothingScale(),this.registerTransition(!1,!1),BFN.TransformModel.transformToolFrame&&BFN.TransformModel.transformToolFrame.transformItem===this&&BFN.TransformModel.transformToolFrame.setup(this))},cg.prototype.fitFrameToImage=function(){if("frame_texture"===this.type){this.createTransition("history_image_region");var e=this.itemContent.imageRect.x,t=this.itemContent.imageRect.y,i=Math.sqrt(Math.pow(e,2)+Math.pow(t,2)),r=Math.atan2(t,e)+this.rotation;this.x+=Math.cos(r)*i,this.y+=Math.sin(r)*i,this.itemContent.frameWidth=this.itemContent.imageRect.width,this.itemContent.frameHeight=this.itemContent.imageRect.height,this.itemContent.textureScaleX=this.itemContent.textureScaleY=1,this.itemContent.offsetFactorX=this.itemContent.offsetFactorY=.5,this.itemContent.updateDisplay(),this.resetFrameTextureScale(),this.updateContentDimensions(),this.updateAccurateBounds(),this.updateSmoothingScale(),this.transformTool.updateDisplay(),this.registerTransition(!1,!1),BFN.TransformModel.transformToolFrame&&BFN.TransformModel.transformToolFrame.transformItem===this&&BFN.TransformModel.transformToolFrame.setup(this)}},cg.prototype.dragFrame=function(e){"frame_texture"===this.type&&(BFN.hasOwnProperty("FrameDragger")||(BFN.FrameDragger=new BFN.Dragger,BFN.FrameDragger.useBounds=!1,BFN.FrameDragger.autoDrag=!1),this.frameDraggerStartMousePosition=this.getPointerPosition(e),this.frameStartOffsetFactors=new PIXI.Point(this.itemContent.offsetFactorX,this.itemContent.offsetFactorY),this.frameOffsetFactorPixelSteps=new PIXI.Point(this.itemContent.excessX?1/(this.itemContent.excessX*this.itemContent.adjustScale*this.itemContent.textureScaleX):0,this.itemContent.excessY?1/(this.itemContent.excessY*this.itemContent.adjustScale*this.itemContent.textureScaleY):0),this.createTransition("history_image_region"),BFN.FrameDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleFrameDraggerDraggingBind),BFN.FrameDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleFrameDraggerDraggingCompleteBind),BFN.FrameDragger.drag(this))},cg.prototype.handleFrameDraggerDragging=function(){if("frame_texture"===this.type){var e=this.getPointerPosition(BFN.MainUI.pointerEvent),t=(this.frameDraggerStartMousePosition.x-e.x)*(this.flippedHorizontal?-1:1),i=(this.frameDraggerStartMousePosition.y-e.y)*(this.flippedVertical?-1:1),r=this.frameStartOffsetFactors.x+t*this.frameOffsetFactorPixelSteps.x,a=this.frameStartOffsetFactors.y+i*this.frameOffsetFactorPixelSteps.y;r<0?(this.frameStartOffsetFactors.x+=Math.abs(r),r=0):r>1&&(this.frameStartOffsetFactors.x-=r-1,r=1),a<0?(this.frameStartOffsetFactors.y+=Math.abs(a),a=0):a>1&&(this.frameStartOffsetFactors.y-=a-1,a=1),this.itemContent.offsetFactorX=r,this.itemContent.offsetFactorY=a,this.itemContent.updateDisplay()}},cg.prototype.handleFrameDraggerDraggingComplete=function(){"frame_texture"===this.type&&(BFN.FrameDragger.removeEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleFrameDraggerDraggingBind),BFN.FrameDragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleFrameDraggerDraggingCompleteBind),BFN.FrameDragger.wasDragged&&this.registerTransition())},cg.prototype.showImageDropState=function(){this.hoverDropAnimator&&BFN.TransformModel.awaitingDrop&&(this.hasDropOptions="frame_texture"===this.type&&!this.itemContentMask&&this.isTransparent,this.hoverDropAnimator.increase())},cg.prototype.hideImageDropState=function(){this.hoverDropAnimator&&this.hoverDropAnimator.decrease()},cg.prototype.handleHoverDropAnimatorUpdate=function(e){var t=this.projectItemVO.transformOpacity/100;this.alpha=t+this.hoverDropAnimator.animationFactor*(1-t),this.hoverDropFilter.intensity=.4*this.hoverDropAnimator.animationFactor,this.itemContent.blendMode=this.hoverDropAnimator.animationFactor>0?BFN.CONST.BLEND_MODES.NORMAL:this.itemBlendMode,this.filters=this.hoverDropAnimator.animationFactor>0?[this.hoverDropFilter]:[]},cg.prototype.resetTransparency=function(){void 0!==this._isTransparent&&(this._isTransparent=void 0)},cg.prototype.updateThumb=function(){var e=BFN.TransformStateModel.getThumb(this),t=BFN.Util.getHTMLImage(e,null,!0);e.destroyGC(!0),this.thumbImage=t,this.dispatchEvent(BFN.TransformItemEvents.THUMB_UPDATED)},cg.prototype.replaceImage=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace_image",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if("frame_texture"===this.type){this.createTransition(i),this.itemObject.texture=t,this.projectItemVO.maskImageID=e;var l={};n&&(l.textureScaleX=this.itemContent.textureScaleX,l.textureScaleY=this.itemContent.textureScaleY,l.offsetFactorX=this.itemContent.offsetFactorX,l.offsetFactorY=this.itemContent.offsetFactorY),o&&(o.hasOwnProperty("frameWidth")&&(l.frameWidth=o.frameWidth),o.hasOwnProperty("frameHeight")&&(l.frameHeight=o.frameHeight),o.hasOwnProperty("textureScaleX")&&(l.textureScaleX=o.textureScaleX),o.hasOwnProperty("textureScaleY")&&(l.textureScaleY=o.textureScaleY),o.hasOwnProperty("offsetFactorX")&&(l.offsetFactorX=o.offsetFactorX),o.hasOwnProperty("offsetFactorY")&&(l.offsetFactorY=o.offsetFactorY)),this.itemContent.setTexture(new PIXI.Texture(t.baseTexture)),this.itemContent.frameWidth=l.frameWidth||this.itemContent.frameWidth,this.itemContent.frameHeight=l.frameHeight||this.itemContent.frameHeight,this.itemContent.textureScaleX=l.textureScaleX||1,this.itemContent.textureScaleY=l.textureScaleY||1,this.itemContent.offsetFactorX=l.offsetFactorX||.5,this.itemContent.offsetFactorY=l.offsetFactorY||.5,this.itemContent.updateDisplay(),this.x+=r,this.y+=a,this.updateShapeTexture(),this.updateContentDimensions(),this.flippedHorizontal&&(this.flipHorizontal(),s&&this.flipHorizontal()),this.flippedVertical&&(this.flipVertical(),s&&this.flipVertical()),this.updateSmoothingScale(),this.updateThumb(),this.registerTransition(),"replace_image"===i&&this.addPresetItemThumbTexture(t.baseTexture,this.transitionVO.endState.creationTime)}else"texture"!==this.type||this.isGoodie||(this.createTransition(i),this.itemObject.texture=t,this.projectItemVO.imageID=e,this.itemContent.texture=t,this.x+=r,this.y+=a,this.updateContentDimensions(),this.flippedHorizontal&&(this.flipHorizontal(),s&&this.flipHorizontal()),this.flippedVertical&&(this.flipVertical(),s&&this.flipVertical()),this.updateSmoothingScale(),this.updateThumb(),this.registerTransition(),"replace_image"===i&&this.addPresetItemThumbTexture(t.baseTexture,this.transitionVO.endState.creationTime));this.resetTransparency()},cg.prototype.getShapeColorGroupColor=function(e){var t={color:-1,opacity:1};return this.shapeColorMap&&this.shapeColorMap.hasOwnProperty(e)&&(t.color=this.shapeColorMap[e].colorHash,t.opacity=this.shapeColorMap[e].colorOpacity),t},cg.prototype.setShapeColorGroupColor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.shapeColorMap&&this.shapeColorMap.hasOwnProperty(e)){var n=this.shapeColorMap[e];if((-1===t&&-1!==n.colorHash||a)&&(t=n.colorHashOriginal,i=n.colorOpacityOriginal),n.colorHash=t,n.colorOpacity=i,this.hasOwnProperty("updateShapeTextureTimeout")&&(clearTimeout(this.updateShapeTextureTimeout),delete this.updateShapeTextureTimeout),r)this.updateShapeTexture(!0);else try{this.itemContent.texture.baseTexture.drawPeriod,this.updateShapeTextureTimeout=setTimeout(()=>{clearTimeout(this.updateShapeTextureTimeout),delete this.updateShapeTextureTimeout,this.updateShapeTexture(!1)},this.itemContent.texture.baseTexture.drawPeriod)}catch(e){}}},cg.prototype.getShapeColorMap=function(){if(!this.shapeColorMap)return null;var e={};for(var t in this.shapeColorMap){var i=this.shapeColorMap[t];e[t]={colorHash:i.colorHash,colorOpacity:i.colorOpacity}}return e},cg.prototype.setShapeColorMap=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&this.shapeColorMap){for(var i in e){var r=e[i];for(var a in this.shapeColorMap[i]=this.shapeColorMap[i]||{},r)this.shapeColorMap[i][a]=r[a]}t&&this.updateShapeTexture()}},cg.prototype.queueShapeUpdate=function(){-1===BFN.updatingShapeQueue.indexOf(this)&&BFN.updatingShapeQueue.push(this),BFN.UndoManager.updating||BFN.updatingShapeTransformItem?this.queueShapeUpdate():(this.shapeUpdatePending=!1,BFN.updatingShapeTransformItem=this,this.updateShapeTexture(),BFN.updatingShapeTransformItem=null,-1!==BFN.updatingShapeQueue.indexOf(this)&&BFN.updatingShapeQueue.splice(BFN.updatingShapeQueue.indexOf(this),1))},cg.prototype.updateShapeTexture=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isShape){var i=this.itemContentMask?this.itemContentMask:this.itemContent,r=null;if("frame_texture"===this.type){this.basicShapeVO?this.basicShapeVO.updateTexture(i.texture,this.itemContent.frameWidth,this.itemContent.frameHeight,e):BFN.SVGManager.updateTexture(i.texture,null,null,this.itemContent.frameWidth,this.itemContent.frameHeight);var a=this.maskFlippedHorizontal?!this.flippedHorizontal:this.flippedHorizontal,n=this.maskFlippedVertical?!this.flippedVertical:this.flippedVertical;i.x=a?this.itemContent.frameWidth:0,i.y=n?this.itemContent.frameHeight:0,i.scale.x=a?-1:1,i.scale.y=n?-1:1,e||(i.x/=this.scale.x,i.y/=this.scale.y,i.scale.x/=this.scale.x,i.scale.y/=this.scale.y),this.basicShapeVO&&(i.x/=this.basicShapeVO.fitScale,i.y/=this.basicShapeVO.fitScale,i.scale.x/=this.basicShapeVO.fitScale,i.scale.y/=this.basicShapeVO.fitScale)}else this.basicShapeVO?(this.basicShapeVO.updateTexture(i.texture,Math.round(100*this.scale.x),Math.round(100*this.scale.y),e),r={x:this.scale.x*this.basicShapeVO.fitScale,y:this.scale.y*this.basicShapeVO.fitScale}):r=BFN.SVGManager.updateTexture(i.texture,this.scale.x,this.scale.y,null,null,e,t),i.scale.x=1/r.x*(this.flippedHorizontal?-1:1),i.scale.y=1/r.y*(this.flippedVertical?-1:1)}else if(this.itemContentMask&&"frame_texture"===this.type){this.itemContentMaskTexture||(this.itemContentMaskTexture=this.itemContentMask.texture,this.itemContentMask.texture=PIXI.RenderTexture.create(32,32));var o=Math.min(1,this.itemContent.frameWidth/this.itemContentMaskTexture.baseTexture.width),s=Math.min(1,this.itemContent.frameHeight/this.itemContentMaskTexture.baseTexture.height),l=Math.round(this.itemContentMaskTexture.width*o),h=Math.round(this.itemContentMaskTexture.height*s);if(this.itemContentMask.texture.width!=l||this.itemContentMask.texture.height!=h){var c=BFN.Util.resizeTexture(this.itemContentMaskTexture,l,h,!1,!0);this.itemContentMask.texture.resize(c.width,c.height),this.itemContentMask.texture.copyPixels(c),c.destroyGC(!0)}this.itemContentMask.x=this.maskFlippedHorizontal?Math.abs(this.itemContent.x-this.itemContentW):this.itemContent.x,this.itemContentMask.y=this.maskFlippedVertical?Math.abs(this.itemContent.y-this.itemContentH):this.itemContent.y,this.itemContentMask.scale.x=this.itemContent.frameWidth/this.itemContentMask.texture.width*(this.itemContentMask.x?-1:1),this.itemContentMask.scale.y=this.itemContent.frameHeight/this.itemContentMask.texture.height*(this.itemContentMask.y?-1:1)}BFN.MainUI.requestRender()},cg.prototype.setTextWidth=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.iText){this.textScale=e/this.iText.width;var r=Math.round((this.iText.width+2*this.textPadding)*this.textScale),a=Math.round((this.iText.height+2*this.textPadding)*this.textScale),n=1;if((r>BFN.maxImageSize||a>BFN.maxImageSize)&&(n=Math.min(BFN.maxImageSize/r,BFN.maxImageSize/a),this.textScale*=n,r=Math.min(BFN.maxImageSize,Math.round((this.iText.width+2*this.textPadding)*this.textScale)),a=Math.min(BFN.maxImageSize,Math.round((this.iText.height+2*this.textPadding)*this.textScale))),this.scale.x=this.scale.y=1/n,this.iTexture.resize(r,a,!1),i){var o=t?this.iTexture.renderClone():null;o&&(this.iTexture.copyPixels(o,null,!0,1,{x:this.iTexture.width/o.width,y:this.iTexture.height/o.height}),o.destroyGC(!0),o=null),this.itemContent.texture=this.iTexture,this.updateTextDisplay()}this.itemContent.visible=i,this.updateContentDimensions(),this.initialized&&this.updateHiResTextBounds(),this.itemContent.x=this.flippedHorizontal?this.itemContentW:0,this.itemContent.y=this.flippedVertical?this.itemContentH:0,this.itemContent.anchor.x=this.textPadding/r*this.textScale,this.itemContent.anchor.y=this.textPadding/a*this.textScale}},cg.prototype.generateFabricCanvas=function(){if(!BFN.hasOwnProperty("fabricCanvas")){BFN.fabricCanvasElement=document.createElement("canvas"),BFN.appContainer.appendChild(BFN.fabricCanvasElement),BFN.fabricCanvas=new fabric.StaticCanvas(BFN.fabricCanvasElement,{enableRetinaScaling:!1}),BFN.fabricCanvasContext=BFN.fabricCanvas.getContext(),BFN.fabricCanvasElement.setStyles({display:"none"})}},cg.prototype.generateITextClone=function(){BFN.hasOwnProperty("iTextClone")||(BFN.iTextClone=new fabric.TextboxPad("iTextClone",{left:0,top:0,textAlign:"left",fontFamily:BFN.FabricManager.defaultFontFamily,fontSize:BFN.TransformItemTextBaseFontSize,fill:"rgb(0,0,0)",padding:10}),BFN.iTextClone.objectCaching=!1,BFN.iTextClone.paintFirst="stroke",BFN.iTextClone.noScaleCache=!1,BFN.iTextClone.strokeWidth=0,BFN.iTextClone.objectCaching=!1,BFN.fabricCanvas.add(BFN.iTextClone))},cg.prototype.generateFabricCanvasTexture=function(){BFN.hasOwnProperty("fabricCanvasTexture")?BFN.fabricCanvasTexture.update():(BFN.fabricCanvasTexture=new PIXI.Texture(new PIXI.BaseTexture.fromCanvas(BFN.fabricCanvasElement)),BFN.fabricCanvasTexture.baseTexture.mipmap=!1)},cg.prototype.updateTextDisplay=function(){for(var e in this.iText.styles){var t=this.iText.styles[e];for(var i in t){var r=t[i];r&&(r.hasOwnProperty("fontSize")&&r.hasOwnProperty("strokePercent")&&(r.strokeWidth=r.fontSize*r.strokePercent),r.hasOwnProperty("strokeWidth")&&(r.strokeWidth=Math.max(r.strokeWidth,1/this.textScale)))}}this.generateFabricCanvas(),this.generateITextClone();var a=this.iText.styles,n={};for(var o in a)for(var s in n[o]={},a[o])for(var l in n[o][s]={},a[o][s])n[o][s][l]=a[o][s][l];BFN.iTextClone.text=this.iText.text,BFN.iTextClone.width=this.iText.width,BFN.iTextClone.styles=n,BFN.iTextClone.textAlign=this.iText.textAlign,BFN.iTextClone.charSpacing=this.iText.charSpacing,BFN.iTextClone.lineHeight=this.iText.lineHeight,this.updateITextBackgroundDisplay(),BFN.iTextClone.backgroundOverrideColor=this.iText.backgroundOverrideColor,BFN.iTextClone.backgroundOverridePadding=this.iText.backgroundOverridePadding,BFN.iTextClone.wordBreaksEnabled=this.iText.wordBreaksEnabled,BFN.iTextClone.initDimensions(),BFN.iTextClone.left=this.textPadding*this.textScale,BFN.iTextClone.top=this.textPadding*this.textScale,BFN.iTextClone.scaleX=BFN.iTextClone.scaleY=this.textScale,BFN.fabricCanvasElement.width=(BFN.iTextClone.width+2*this.textPadding)*BFN.iTextClone.scaleX,BFN.fabricCanvasElement.height=(BFN.iTextClone.height+2*this.textPadding)*BFN.iTextClone.scaleY,BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")}),BFN.fabricCanvasContext.lineJoin="round",BFN.fabricCanvas.renderAll(),this.generateFabricCanvasTexture(),this.iTexture.copyPixels(BFN.fabricCanvasTexture),requestAnimationFrame(()=>{BFN.fabricCanvasElement.width=16,BFN.fabricCanvasElement.height=16,BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")}),this.updateSmoothingScale(),this.updateAccurateBounds(!0),BFN.MainUI.requestRender(),this.dispatchEvent(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED),BFN.updatingTextTransformItem=null,-1!==BFN.updatingTextQueue.indexOf(this)&&BFN.updatingTextQueue.splice(BFN.updatingTextQueue.indexOf(this),1)})},cg.prototype.getITextMask=function(e){var t=this;if("text"===this.type&&this.iText&&e){this.generateFabricCanvas(),this.generateITextClone();var i=this.iText.styles,r={};for(var a in i)for(var n in r[a]={},i[a])for(var o in r[a][n]={},i[a][n]){var s=i[a][n][o];if(s)switch(o){case"stroke":case"fill":s="white";break;case"textBackgroundColor":s=""}r[a][n][o]=s}BFN.iTextClone.text=this.iText.text,BFN.iTextClone.width=this.iText.width,BFN.iTextClone.styles=r,BFN.iTextClone.textAlign=this.iText.textAlign,BFN.iTextClone.charSpacing=this.iText.charSpacing,BFN.iTextClone.lineHeight=this.iText.lineHeight,BFN.iTextClone.backgroundColor="",BFN.iTextClone.backgroundOverrideColor="",BFN.iTextClone.backgroundOverridePadding=0,BFN.iTextClone.initDimensions();var l=this.textMaskMaxSize/Math.max(BFN.iTextClone.width+2*this.textPadding,BFN.iTextClone.height+2*this.textPadding);BFN.iTextClone.left=this.textPadding*l,BFN.iTextClone.top=this.textPadding*l,BFN.iTextClone.scaleX=BFN.iTextClone.scaleY=l,BFN.fabricCanvasElement.width=(BFN.iTextClone.width+2*this.textPadding)*l,BFN.fabricCanvasElement.height=(BFN.iTextClone.height+2*this.textPadding)*l,BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")}),BFN.fabricCanvasContext.lineJoin="round",BFN.fabricCanvas.renderAll(),this.generateFabricCanvasTexture();var h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=BFN.Util.getAlphaBounds(BFN.fabricCanvasTexture),r=new BFN.Rectangle(i.left-e,i.top-e,i.width+2*e,i.height+2*e),a=t.textMaskMaxSize/Math.max(r.width,r.height);return BFN.iTextClone.left=BFN.iTextClone.left*a-r.left*a,BFN.iTextClone.top=BFN.iTextClone.top*a-r.top*a,BFN.iTextClone.scaleX=BFN.iTextClone.scaleX*a,BFN.iTextClone.scaleY=BFN.iTextClone.scaleY*a,BFN.fabricCanvasElement.width=Math.round(r.width*a),BFN.fabricCanvasElement.height=Math.round(r.height*a),BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")}),BFN.fabricCanvasContext.lineJoin="round",BFN.fabricCanvas.renderAll(),BFN.fabricCanvasTexture.update(),i},c=this.iText.scaleX*this.iText.width/(BFN.iTextClone.scaleX*BFN.iTextClone.width)*(this.textScale/this.iText.scaleX),u=this.iText.scaleY*this.iText.height/(BFN.iTextClone.scaleY*BFN.iTextClone.height)*(this.textScale/this.iText.scaleY),d=h(10);requestAnimationFrame(()=>{h(),requestAnimationFrame(()=>{BFN.fabricCanvasElement.width=16,BFN.fabricCanvasElement.height=16,BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")});var t=PIXI.RenderTexture.create(BFN.fabricCanvasTexture.width,BFN.fabricCanvasTexture.height);t.fillColor(0),t.copyPixels(BFN.fabricCanvasTexture,null,!1);var i=this.iText.scaleX*this.iText.width/(BFN.iTextClone.scaleX*BFN.iTextClone.width)*(this.textScale/this.iText.scaleX)*this.scale.x,r=this.iText.scaleY*this.iText.height/(BFN.iTextClone.scaleY*BFN.iTextClone.height)*(this.textScale/this.iText.scaleY)*this.scale.y,a=new BFN.Rectangle(d.left*c*this.scale.x,d.top*u*this.scale.y,t.width*i,t.height*r);e({boundsRect:a,maskTexture:t})})})}},cg.prototype.updateITextBackgroundDisplay=function(){this.iText.backgroundOverrideColor=-1==this.textBackgroundColor?"":BFN.ColorUtil.hexStringObjectToRGBAString({hex:this.textBackgroundColor,alpha:this.textBackgroundIntensity}),this.iText.backgroundOverridePadding=this.textBackgroundPadding/100*this.textPadding},cg.prototype.queueTextUpdate=function(){if(this.pendingTransformItemState)if(-1===BFN.updatingTextQueue.indexOf(this)&&BFN.updatingTextQueue.push(this),BFN.UndoManager.updating||BFN.updatingTextTransformItem)this.queueTextUpdate();else{this.textUpdatePending=!1,BFN.updatingTextTransformItem=this,this.iText._forceClearCache=!0,this.iText._clearCache(),this.iText.text=this.pendingTransformItemState.text,this.iText.textAlign=this.pendingTransformItemState.textStyle.textAlign,this.iText.charSpacing=this.pendingTransformItemState.textStyle.charSpacing,this.iText.lineHeight=this.pendingTransformItemState.textStyle.lineHeight,this.iText.width=this.pendingTransformItemState.textWidth,this.iText.scaleX=this.iText.scaleY=this.pendingTransformItemState.textScale,this.textBackgroundColor=this.pendingTransformItemState.textBackgroundColor,this.textBackgroundIntensity=this.pendingTransformItemState.textBackgroundIntensity,this.textBackgroundPadding=this.pendingTransformItemState.textBackgroundPadding,this.updateITextBackgroundDisplay();var e=this.pendingTransformItemState.textStyle.styles,t={};for(var i in e){var r=t[i]={};for(var a in e[i]){var n=r[a]=Object.assign({},e[i][a]);n.fontSize&&n.stroke&&!n.strokeWidth&&(n.strokePercent=n.strokePercent||BFN.TransformItemTextStrokePercentDefault,n.strokeWidth=n.strokePercent*n.fontSize)}}this.iText.styles=t,this.conformITextToSmallestFontSize(),this.iText.__skipDimension=!1,this.iText.initDimensions(),setTimeout(()=>{this.setTextWidth(this.pendingTransformItemState.textWidth*this.pendingTransformItemState.textScale*this.pendingTransformItemState.textItemScale),this.pendingTransformItemState=null,this.renderable=!0,BFN.MainUI.rendering=!0,this.updateProjectItemVO()},1)}else BFN.updatingTextTransformItem===this&&(BFN.updatingTextTransformItem=null),-1!==BFN.updatingTextQueue.indexOf(this)&&BFN.updatingTextQueue.splice(BFN.updatingTextQueue.indexOf(this),1),this.pendingTransformItemState=null,this.textUpdatePending=!1,this.renderable=!0,BFN.MainUI.rendering=!0,this.updateProjectItemVO()},cg.prototype.setITextStyle=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("text"===this.type&&this.currentTransformItemStateVO){this.pendingTransformItemState=Object.assign(new BFN.TransformItemStateVO,this.currentTransformItemStateVO),this.pendingTransformItemState.textStyle=JSON.parse(JSON.stringify(this.currentTransformItemStateVO.textStyle));var t=!1,i=!1;for(var r in e){var a=e[r];if(BFN.FabricManager.itemStyles.includes(r))switch(r){case"backgroundColor":this.textBackgroundColor=a,this.pendingTransformItemState.textBackgroundColor=a,t=!0,i=!0;break;case"backgroundIntensity":this.textBackgroundIntensity=a,this.pendingTransformItemState.textBackgroundIntensity=a,t=!0,i=!0;break;case"backgroundPadding":this.textBackgroundPadding=a,this.pendingTransformItemState.textBackgroundPadding=a,t=!0,i=!0}else if(BFN.FabricManager.globalStyles.includes(r))this.pendingTransformItemState.textStyle[r]=a,this.iText[r]=a,i=!0;else{for(var n in this.pendingTransformItemState.textStyle.styles){var o=this.pendingTransformItemState.textStyle.styles[n];for(var s in o){o[s][r]=a}}this.iText.styles=this.pendingTransformItemState.textStyle.styles,i=!0}}t&&this.updateITextBackgroundDisplay(),i&&!this.textUpdatePending&&(this.textUpdatePending=!0,BFN.MainUI.rendering=!1,this.renderable=!1,this.queueTextUpdate())}},cg.prototype.conformITextToSmallestFontSize=function(){if(this.iText){var e=null,t=this.iText.styles;for(var i in t){var r=t[i];for(var a in r){var n=r[a];n.hasOwnProperty("fontSize")||(n.fontSize=BFN.TransformItemTextBaseFontSize);var o=n.fontSize;e=null===e?o:Math.min(e,o)}}var s=null===e?1:BFN.TransformItemTextBaseFontSize/e;for(var l in t){var h=t[l];for(var c in h){h[c].fontSize*=s}}this.textBackgroundPadding*=s,this.iText.charSpacing*=s,this.iText.width*=s,this.iText.scaleX/=s,this.iText.scaleY/=s,this.fontSizeNormalizeFactor=s}},cg.prototype.exitTextEditing=function(){this.ignoreTextHeight=!0,requestAnimationFrame(()=>{delete this.ignoreTextHeight}),this.resetTextIfEmpty(),this.conformITextToSmallestFontSize(),this.iText.exitEditing()},cg.prototype.resetTextIfEmpty=function(){if(""===this.iText.text.trim()){this.iText.text=BeFunky.LanguageManager.getString("click_when_selected"),this.iText.styles={},this.iText.styles[0]={};for(var e=0;e<this.iText.text.length;e++){var t={};Object.assign(t,this.defaultTextStyles),this.iText.backupStyle&&Object.assign(t,this.iText.backupStyle),t.fontSize=BFN.TransformItemTextBaseFontSize,this.iText.styles[0][e]=t}}},cg.prototype.getTextStyle=function(){if("text"===this.type&&this.iText){var e={};for(var t in e.textAlign=this.iText.textAlign,e.charSpacing=this.iText.charSpacing,e.lineHeight=this.iText.lineHeight,e.styles={},this.iText.styles)for(var i in e.styles[t]={},this.iText.styles[t])for(var r in e.styles[t][i]={},this.iText.styles[t][i])e.styles[t][i][r]=this.iText.styles[t][i][r];return e}return null},cg.prototype.getTextStyleData=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("text"==this.type){var i=(e,t,i)=>{e.hasOwnProperty(t)||(e[t]=i)},r=(e,i)=>{t.hasOwnProperty(e)?t[e]!=i&&(t[e]="mixed"):t[e]=i};if(r("backgroundColor",this.textBackgroundColor),r("backgroundIntensity",this.textBackgroundIntensity),r("backgroundPadding",this.textBackgroundPadding),BFN.FabricManager.globalStyles.forEach(e=>{r(e,this.iText[e])}),this.iText.getSelectionStyles&&this.iText.isEditing){var a=this.iText.selectionStart||0,n=a+1;this.iText.text.length&&this.iText.selectionStart>0&&(a===this.iText.text.length||this.iText.selectionStart===this.iText.selectionEnd)&&(a--,n--);var o=this.iText.text.length?this.iText.getSelectionStyles(a,n,!0):this.iText.backupStyle?[this.iText.backupStyle]:null;o&&o.length&&(Object.assign(t,o[0]),t.hasOwnProperty("fontSize")&&(t.fontSize=t.fontSizeMin=t.fontSizeStart=Math.round(this.scale.x*this.textScale*t.fontSize)))}else for(var s in this.iText.styles){var l=this.iText.styles[s];for(var h in l){var c=l[h];for(var u in i(e=c,"fontSize",BFN.TransformItemTextBaseFontSize),i(e,"fontWeight",""),i(e,"fontStyle",""),i(e,"underline",!1),i(e,"textBackgroundColor",""),i(e,"strokePercent",BFN.TransformItemTextStrokePercentDefault),c)if("fontSize"===u){var d=Math.round(this.scale.x*this.textScale*c[u]);r("fontSize",d),t.fontSizeMin=t.hasOwnProperty("fontSizeMin")?Math.min(t.fontSizeMin,d):d}else r(u,c[u]);0===parseInt(s)&&0===parseInt(h)&&r("fontSizeStart",t.fontSize)}}}return t},cg.prototype.getAvailableGroupItems=function(){var e=BFN.GroupManager.getGroupVOsFromItemIDs([this.itemID]),t=[];e.forEach(e=>{e.itemIDs.forEach(e=>{t.includes(e)||e===this.itemID||t.push(e)})});var i=[];return this.transformLayer.children.forEach(e=>{e instanceof BFN.TransformItem&&e.projectItemVO&&e!==this&&!i.includes(e)&&t.includes(e.itemID)&&i.push(e)}),i},cg.prototype.updateItemsAffectedByTextHeight=function(){if("text"===this.type&&this.iText&&[BFN.TransformModel.selectedTransformItem,BFN.TransformModel.selectedTransformItemText].includes(this)){this.preChangeTextHeight=Math.round(this.iText.height*this.textScale*this.scale.y);var e=this.getAvailableGroupItems(),t=(e,t,i)=>{t.x-=e.x,t.y-=e.y;var r=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),a=Math.atan2(t.y,t.x)+i;return new PIXI.Point(Math.cos(a)*r+e.x,Math.sin(a)*r+e.y)},i=this.localPolygon,r=new PIXI.Point((i[0].x+i[2].x)/2,(i[0].y+i[2].y)/2),a=new PIXI.Point(i[2].x,i[2].y),n=t(r,a,-this.rotation).y,o=e=>{for(var i=!0,a=0;a<e.length;a++)if(i){var o=e[a];t(r,o,-this.rotation).y<n&&(i=!1)}return i};this.itemsAffectedByTextHeight.splice(0),e.forEach(e=>{var t=o(e.localPolygon);if(!t&&e.accurateBounds){var i=BFN.Util.getTransformItemBounds(e),r=i.minX+e.accurateBounds.left,a=i.maxX-e.accurateBounds.right,n=i.minY+e.accurateBounds.top,s=i.maxY-e.accurateBounds.bottom;t=o([new PIXI.Point(r,n),new PIXI.Point(a,n),new PIXI.Point(a,s),new PIXI.Point(r,s)])}t&&this.itemsAffectedByTextHeight.push({item:e,startPoint:new PIXI.Point(e.x,e.y)})})}},cg.prototype.handleTextHeightChanged=function(e){if("text"===this.type&&this.iText&&[BFN.TransformModel.selectedTransformItem,BFN.TransformModel.selectedTransformItemText].includes(this)&&this.itemsAffectedByTextHeight.length&&!this.ignoreTextHeight){var t=Math.round(this.iText.height*this.textScale*this.scale.y)-this.preChangeTextHeight,i=this.rotation+Math.PI/2;this.itemsAffectedByTextHeight.forEach(e=>{e.item.toggleHiResText(!(Math.abs(t)>0)),e.item.x=e.startPoint.x+Math.cos(i)*t,e.item.y=e.startPoint.y+Math.sin(i)*t}),BFN.TransformItemBoundingBoxes.updateItems(),BFN.MainUI.requestRender()}},cg.prototype.registerItemsAffectedByTextHeight=function(){if("text"!==this.type||!this.iText||![BFN.TransformModel.selectedTransformItem,BFN.TransformModel.selectedTransformItemText].includes(this))return null;if(!this.itemsAffectedByTextHeight.length)return null;var e=Math.round(this.iText.height*this.textScale*this.scale.y)-this.preChangeTextHeight;if(Math.abs(e)<1)return this.itemsAffectedByTextHeight.forEach(e=>{"text"===e.item.type&&e.item.iText&&e.item.toggleHiResText(!0)}),BFN.MainUI.requestRender(),null;this.itemsAffectedByTextHeight.forEach(e=>{e.item.x=e.startPoint.x,e.item.y=e.startPoint.y});var t="offset_items_".concat(BeFunky.randomString(10));BFN.TransformStateModel.startBulkTransition(t);var i=this.rotation+Math.PI/2;return this.itemsAffectedByTextHeight.forEach(t=>{t.item.createTransition("offset_item"),t.item.x=t.startPoint.x+Math.cos(i)*e,t.item.y=t.startPoint.y+Math.sin(i)*e,t.item.registerTransition()}),BFN.TransformStateModel.stopBulkTransition(),this.itemsAffectedByTextHeight.splice(0),t},cg.prototype.setBlendMode=function(e){this.itemBlendMode=e,this.itemContent.blendMode=e,"text"===this.type&&(this.hiResTextSprite.blendMode=e),BFN.MainUI.requestRender()},cg.prototype.flipHorizontal=function(){this.flippedHorizontal=!this.flippedHorizontal,this.itemContent.scale.x=Math.abs(this.itemContent.scale.x)*(this.flippedHorizontal?-1:1),this.itemContent.x=this.flippedHorizontal?this.itemContentW:0,this.itemContentMask&&(this.itemContentMask.x=this.maskFlippedHorizontal?Math.abs(this.itemContent.x-this.itemContentW):this.itemContent.x,this.isShape?this.itemContentMask.scale.x=this.itemContent.scale.x*(this.maskFlippedHorizontal?-1:1):this.itemContentMask.scale.x=Math.abs(this.itemContentMask.scale.x)*(this.itemContentMask.x?-1:1)),this.updateHiResTextBounds(),this.updateHiResText()},cg.prototype.flipVertical=function(){this.flippedVertical=!this.flippedVertical,this.itemContent.scale.y=Math.abs(this.itemContent.scale.y)*(this.flippedVertical?-1:1),this.itemContent.y=this.flippedVertical?this.itemContentH:0,this.itemContentMask&&(this.itemContentMask.y=this.maskFlippedVertical?Math.abs(this.itemContent.y-this.itemContentH):this.itemContent.y,this.isShape?this.itemContentMask.scale.y=this.itemContent.scale.y*(this.maskFlippedVertical?-1:1):this.itemContentMask.scale.y=Math.abs(this.itemContentMask.scale.y)*(this.itemContentMask.y?-1:1)),this.updateHiResTextBounds(),this.updateHiResText()},cg.prototype.setItemZIndex=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent){e=Math.max(0,Math.min(this.parent.children.length-1,e));var i=this.parent.getChildIndex(this);e!=i&&(this.zIndexUpdating||(this.zIndexUpdating=!0,this.zIndexStart=i,this.createTransition("history_layer_order")),this.parent.setChildIndex(this,e),i=this.parent.getChildIndex(this),BFN.MainUI.requestRender()),this.zIndexUpdating&&!t&&(this.zIndexUpdating=!1,this.zIndexStart!=i&&(this.parent&&this.parent.children.forEach(e=>{"group"!==e.type&&e.projectItemVO&&(e.projectItemVO.transformZIndex=this.parent.getChildIndex(e))}),this.registerTransition(),BFN.TransformLayerManager.updateTransformItemsImmediately(!1)),UILayers.handleItemsUpdated())}},cg.prototype.changeItemIndex=function(e){if(this.parent){for(var t=this.globalPolygon,i=this.parent.getChildIndex(this),r=-1,a=[],n=0;n<this.parent.children.length;n++){var o=this.parent.children[n],s=this.parent.getChildIndex(o);(this===o||this!==o&&BFN.Util.polygonHitTest(t,o.globalPolygon))&&a.push({index:s})}a.sort((e,t)=>e.index-t.index);for(var l=0;l<a.length;l++)if(i==a[l].index){switch(e){case"backwards":l>0&&(r=a[l-1].index,this.parent.setChildIndex(this,r));break;case"forwards":l<a.length-1&&(r=a[l+1].index,this.parent.setChildIndex(this,r))}break}var h=i!=r&&-1!=r;return h&&(this.parent.children.forEach(e=>{"group"!==e.type&&e.projectItemVO&&(e.projectItemVO.transformZIndex=this.parent.getChildIndex(e))}),this.parent.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)),h}return!1},cg.prototype.moveBackwards=function(){return this.changeItemIndex("backwards")},cg.prototype.moveForwards=function(){return this.changeItemIndex("forwards")},cg.prototype.updateItemBoundsData=function(){if(this.accurateBounds&&this.parent){var e=BFN.Util.getTransformItemBounds(this,!!this.accurateBounds.noBounds),t=new BFN.Rectangle;t.left=e.minX+this.accurateBounds.minX,t.right=e.minX+this.accurateBounds.minX+this.accurateBounds.width,t.top=e.minY+this.accurateBounds.minY,t.bottom=e.minY+this.accurateBounds.minY+ +this.accurateBounds.height;var i=this.globalPolygon,r=Math.sqrt(Math.pow(i[0].x-i[1].x,2)+Math.pow(i[0].y-i[1].y,2)),a=Math.sqrt(Math.pow(i[1].x-i[2].x,2)+Math.pow(i[1].y-i[2].y,2));this.itemBoundsData={item:this,bounds:t,globalPolygon:i,globalPolygonW:r,globalPolygonH:a}}else this.itemBoundsData=null},cg.prototype.updateItemGroupData=function(){if(this.parent){var e=BFN.TransformItemGroup;this.itemGroupData.dx=this.x-e.x,this.itemGroupData.dy=this.y-e.y,this.itemGroupData.rr=this.rotation,this.itemGroupData.sx=this.scale.x,this.itemGroupData.sy=this.scale.y,this.itemGroupData.bw=this.bounds.width,this.itemGroupData.bh=this.bounds.height,this.itemGroupData.dz=this.parent.getChildIndex(this),this.itemGroupData.bm=this.itemBlendMode,this.itemGroupData.dd=Math.sqrt(Math.pow(this.itemGroupData.dx,2)+Math.pow(this.itemGroupData.dy,2)),this.itemGroupData.bt=Math.atan2(this.itemGroupData.dy,this.itemGroupData.dx)}},cg.prototype.preloadThumbnail=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.thumbImage||"text"===this.type||setTimeout(()=>{if(!this.thumbImage){var e=BFN.TransformStateModel.getThumb(this),t=BFN.Util.getHTMLImage(e,null,!0);e.destroyGC(!0),this.thumbImage=t}},e)},cg.prototype.addPresetItemThumbTexture=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:performance.now();if(!(!e||e&&e.hasOwnProperty("fabricShape"))){var i=new PIXI.Texture(e),r=BFN.PhotoEditorMenuModel.getPresetItemThumbTexture(i);i.destroy(!1),r&&(r.creationTime=t,this.presetItemThumbTextures.push(r),this.presetItemThumbTextures.sort((e,t)=>e.timestamp-t.timestamp))}},cg.prototype.getPresetItemThumbTexture=function(){var e=null;if(this.presetItemThumbTextures.length&&this.currentTransformItemStateVO)for(var t=0;t<this.presetItemThumbTextures.length;t++){var i=this.presetItemThumbTextures[t];i.creationTime<=this.currentTransformItemStateVO.creationTime&&(e=i)}return e},cg.prototype.destroyPresetItemThumbTextures=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=this.presetItemThumbTextures.length;--t>-1;){var i=this.presetItemThumbTextures[t];i.creationTime>=e&&(i.destroy(!0),this.presetItemThumbTextures.splice(t,1))}this.presetItemThumbTextures.sort((e,t)=>e.timestamp-t.timestamp)},cg.prototype.handleCanvasScalingUpdated=function(e){this.canvasScaling||this.updateHitArea(),this.updateSmoothingScale()},Object.defineProperty(cg.prototype,"itemWidth",{get(){return this.itemContent.width}}),Object.defineProperty(cg.prototype,"itemHeight",{get(){return this.itemContent.height}}),Object.defineProperty(cg.prototype,"globalPolygon",{get(){for(var e=[],t=0;t<this.polygon.length;t++){var i=this.polygon[t],r=BFN.MainUI.toLocal(i,this);e.push(r)}return e}}),Object.defineProperty(cg.prototype,"globalTextPolygon",{get(){if("text"===this.type){for(var e=[],t=0;t<this.textPolygon.length;t++){var i=this.textPolygon[t],r=BFN.MainUI.toLocal(i,this);e.push(r)}return e}return null}}),Object.defineProperty(cg.prototype,"localPolygon",{get(){for(var e=[],t=0;t<this.polygon.length;t++){var i=this.polygon[t],r=this.transformLayer.toLocal(i,this);e.push(r)}return e}}),Object.defineProperty(cg.prototype,"localTextPolygon",{get(){if("text"===this.type){for(var e=[],t=0;t<this.textPolygon.length;t++){var i=this.textPolygon[t],r=this.transformLayer.toLocal(i,this);e.push(r)}return e}return null}}),Object.defineProperty(cg.prototype,"align",{set(e){this._align=e,this.dispatchEvent(BFN.TransformItemEvents.ITEM_DISPLAY_UPDATED),this._align=null},get(){return this._align}}),Object.defineProperty(cg.prototype,"overlayColor",{set(e){this._overlayColor=e,this.itemContent.fillColor=-1==this._overlayColor?0:parseInt("0x".concat(this._overlayColor)),BFN.MainUI.requestRender()},get(){return this._overlayColor}}),Object.defineProperty(cg.prototype,"overlayColorIntensity",{set(e){this._overlayColorIntensity=e,this.itemContent.intensity=-1==this._overlayColor?0:this._overlayColorIntensity,BFN.MainUI.requestRender()},get(){return this._overlayColorIntensity}}),Object.defineProperty(cg.prototype,"tintColor",{set(e){this._tintColor=e,this.itemContent.tint=-1===this._tintColor?16777215:parseInt("0x".concat(this._tintColor)),BFN.MainUI.requestRender()},get(){return this._tintColor}}),Object.defineProperty(cg.prototype,"locked",{set(e){this._locked=e,this.updateBounds()},get(){return this._locked}}),Object.defineProperty(cg.prototype,"isTransparent",{get(){return void 0===this._isTransparent&&(this._isTransparent=!1,"text"===this.type||this.isShape?this._isTransparent=!0:"texture"!==this.type&&"frame_texture"!==this.type||(this._isTransparent=this.itemContent.texture.determineTransparency())),this._isTransparent}}),Object.defineProperty(cg.prototype,"canvasScale",{get(){switch(this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:return BFN.PhotoEditorCanvasModel.canvasScale;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:return BFN.CollageMakerCanvasModel.canvasScale;case BFN.AppModelViewStates.VIEWING_DESIGNER:return BFN.DesignerCanvasModel.canvasScale;default:return 1}}}),Object.defineProperty(cg.prototype,"canvasScaling",{get(){switch(this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:return BFN.PhotoEditorCanvasModel.canvasScaling;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:return BFN.CollageMakerCanvasModel.canvasScaling;case BFN.AppModelViewStates.VIEWING_DESIGNER:return BFN.DesignerCanvasModel.canvasScaling;default:return!1}}}),Object.defineProperty(cg.prototype,"itemName",{set(e){this.layerName=e||null,this.refreshItemName(),this.updateProjectItemVO()},get(){if(this.layerName)return this.layerName;if("text"===this.type&&!BFN.FabricManager.isDefaultText(this.iText.text)){var e=this.iText.text.substring(0,Math.min(15,this.iText.text.length));return e+=e.length<this.iText.text.length?"...":""}return BeFunky.LanguageManager.getStringReplacements("layer_".concat(this.layerType),{number:this.layerNum.toString()})}}),Object.defineProperty(cg.prototype,"thumbImage",{set(e){this.handleThumbImageLoadedBind||(this.handleThumbImageLoadedBind=function(){this._thumbImage&&this._thumbImage.src&&this.refreshItemThumb()}.bind(this)),this._thumbImage&&this._thumbImage.removeEventListener("load",this.handleThumbImageLoadedBind),this._thumbImage=e,this._thumbImage&&(this._thumbImage.addEventListener("load",this.handleThumbImageLoadedBind),this.handleThumbImageLoadedBind())},get(){return this._thumbImage}}),Object.defineProperty(cg.prototype,"assetOrigin",{get(){try{var e=this.projectItemVO.graphicID||this.projectItemVO.imageID||this.projectItemVO.maskImageID||null;if(e){var t=this.itemContent.texture.baseTexture.isTemplateAsset?"Template":BFN.UserActionManager.getAssetOrigin(e);if(t)return t}else if("texture"===this.type&&this.isGoodie&&this.isShape&&this.basicShapeVO)return"Basic Shape"}catch(e){}return""}}),BFN.TransformItem=cg,BFN.TransformItemGroupEvents={},ug.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),ug.prototype.init=function(){BeFunky.log("TransformItemGroup Init"),this.initDefaultValues(),this.initItemContent(),this.initStrokeRectanglePool(),this.initFadeAnimator(),this.initContextMenu(),this.initLongPressValues()},ug.prototype.initDefaultValues=function(){this.interactive=!0,this.buttonMode=!0,this.type="group",this._canvasScale=1,this._selectedItems=[],this.subSelectedItem=null,this.pendingTextItems=[],this.allowedKeys=[17,18,91,93],this.pressedKeys=[],this.selectedByMouse=!1,this.groupBounds=null,this.accurateBounds=null,this.accurateBoundsQueue=[],this.snapCoordinates=[],this.otherItemAccurateBoundsList=[],this.snapGapRects={},this.transitionID=null,this.transitionBatchID=null,this.accurateBoundsUpdating=!1,this.duplicatingGroup=!1,this.handleItemAccurateBoundsUpdatedBind=this.handleItemAccurateBoundsUpdated.bind(this),this.handleItemTextDisplayUpdatedBind=this.handleItemTextDisplayUpdated.bind(this),this.handleDocumentMouseDownBind=this.handleDocumentMouseDown.bind(this),this.handleDocumentMouseMoveBind=this.handleDocumentMouseMove.bind(this),this.handleDocumentMouseUpBind=this.handleDocumentMouseUp.bind(this),this.handleDocumentKeyDownBind=this.handleDocumentKeyDown.bind(this),this.handleDocumentKeyUpBind=this.handleDocumentKeyUp.bind(this),document.addEventListener(BeFunky.pointerdown,this.handleDocumentMouseDownBind,!0),document.addEventListener("keydown",this.handleDocumentKeyDownBind,!0)},ug.prototype.initItemContent=function(){this.itemContent=new PIXI.Sprite,this.addChild(this.itemContent),this.itemContent.texture=PIXI.RenderTexture.create(128,128),this.itemContent.texture.clear(),this.updateContentDimensions()},ug.prototype.initStrokeRectanglePool=function(){this.strokeRectanglePool=new BFN.StrokeRectanglePool(!0,!0,2,!0,4293783021,4282154954,"dashed_selection_line"),this.addChild(this.strokeRectanglePool)},ug.prototype.initFadeAnimator=function(){this.fadeAnimator=new BFN.Animator,this.fadeAnimator.setAnimatorFactor(1),this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdate.bind(this))},ug.prototype.initContextMenu=function(){function e(e){UITools.setControlValue(e,!0),UITools.applyToolControl(e),UITools.setControlValue(e,!1)}this.contextMenu=document.getElementById("context_menu_transform_group"),BeFunky.contextMenu(this.contextMenu,{delete_selection:{onClick:()=>{e("transform_delete"),this.contextMenu.hide()},shortcutText:"Del"},duplicate_selection:{onClick:()=>e("transform_duplicate"),hasDivider:!0,shortcutText:BFN.KeyboardManager.shortcutText("D")},align:{onClick:()=>{},hasDivider:!0,children:{align_left:{onClick:()=>e("transform_align_left")},align_center:{onClick:()=>e("transform_align_center")},align_right:{onClick:()=>e("transform_align_right")},align_top:{onClick:()=>e("transform_align_top")},align_middle:{onClick:()=>e("transform_align_middle")},align_bottom:{onClick:()=>e("transform_align_bottom")}}},flip:{onClick:()=>{},hasDivider:!0,children:{horizontal:{onClick:()=>e("transform_flip_horizontal")},vertical:{onClick:()=>e("transform_flip_vertical")}}},layer_order:{onClick:()=>{},hasDivider:!0,children:{move_backwards:{onClick:()=>e("transform_move_backwards")},move_forwards:{onClick:()=>e("transform_move_forwards")}}},create_group:{onClick:()=>{this.contextMenu.hide(),e("transform_create_group")}},add_to_group:{children:{}},remove_from_group:{children:{}}},{hideOnClick:!1}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},ug.prototype.updateSelectedItems=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!1,r=this._selectedItems.length;--r>-1;){var a=this._selectedItems[r];e.includes(a)||(i=!0,this._selectedItems.splice(r,1))}e.forEach(e=>{this._selectedItems.includes(e)||(i=!0,this._selectedItems.push(e))}),i&&(this.lastTransitionVO=null,this.updateGroupDisplay(t?0:1),BFN.TransformLayerManager.updateSelectedItems())},ug.prototype.updateGroupDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.fadeAnimator.animationFactor;this.updateItemBoundsData(),this.strokeRectanglePool.clear(),this.strokeRectanglePool.poolScale=this._canvasScale;var t=null;if(this._selectedItems.forEach(e=>{var i=e.itemBoundsData;i&&(t?(t.left=Math.min(t.left,i.bounds.left),t.top=Math.min(t.top,i.bounds.top),t.right=Math.max(t.right,i.bounds.right),t.bottom=Math.max(t.bottom,i.bounds.bottom)):t=new BFN.Rectangle(i.bounds.x,i.bounds.y,i.bounds.width,i.bounds.height))}),t){if(this.selectedByMouse=!1,this.x=t.x,this.y=t.y,this.rotation=0,this.scale.x=1,this.scale.y=1,this.itemContent.width=t.width,this.itemContent.height=t.height,this.updateItemGroupData(),this.updateContentDimensions(),this.transformLayer){var i=this.transformLayer.canvas.transformIndicatorContainer;i.children.includes(this.strokeRectanglePool)||i.addChildAt(this.strokeRectanglePool,0);var r=i.toLocal(new PIXI.Point,this);this.strokeRectanglePool.x=r.x,this.strokeRectanglePool.y=r.y,this.strokeRectanglePool.rotation=this.rotation,this.strokeRectanglePool.scale.x=this.scale.x,this.strokeRectanglePool.scale.y=this.scale.y,this.strokeRectanglePool.poolScale=this._canvasScale*this.scale.x}this._selectedItems.forEach(e=>{var t=e.itemBoundsData;t&&this.strokeRectanglePool.add(t.item.x-this.x,t.item.y-this.y,t.globalPolygonW/this._canvasScale,t.globalPolygonH/this._canvasScale,t.item.rotation)})}else this.strokeRectanglePool.parent&&this.strokeRectanglePool.parent.removeChild(this.strokeRectanglePool);this.fadeAnimator.animationFactor!==e&&this.fadeAnimator.setAnimatorFactor(Math.max(0,Math.min(1,e))),BFN.MainUI.requestRender()},ug.prototype.updateItemBoundsData=function(){this._selectedItems.forEach(e=>{e.updateItemBoundsData()})},ug.prototype.updateItemGroupData=function(){this._selectedItems.forEach(e=>{e.updateItemGroupData()})},ug.prototype.toggleGroupItem=function(e){return this._selectedItems.includes(e)?(this.removeGroupItem(e),!1):(this.addGroupItem(e),!0)},ug.prototype.addGroupItems=function(e){if(e&&e.length){var t=[...this._selectedItems];e.forEach(e=>{e&&e.parent&&!t.includes(e)&&t.push(e)}),this.updateSelectedItems(t),this.updateAccurateBounds()}},ug.prototype.addGroupItem=function(e){if(e&&e.parent&&!this._selectedItems.includes(e)){var t=[...this._selectedItems];t.push(e),this.updateSelectedItems(t),this.updateAccurateBounds()}},ug.prototype.removeGroupItem=function(e){var t=[...this._selectedItems],i=t.indexOf(e);if(-1!=i)if(t.splice(i,1),t.length<=1){if(this.transformLayer&&this.transformLayer.resetTransformItemGroup(),t.length){var r=t[0];r.selectedByMouse=!1,r.selectItem()}}else this.updateSelectedItems(t),this.updateAccurateBounds()},ug.prototype.clearItems=function(){this.updateSelectedItems()},ug.prototype.updateGroupTransform=function(){this._selectedItems.forEach(e=>{var t=e.itemGroupData;e.x=this.x+Math.cos(t.bt+this.rotation)*t.dd*this.scale.x,e.y=this.y+Math.sin(t.bt+this.rotation)*t.dd*this.scale.y,e.rotation=t.rr+this.rotation,e.scale.x=t.sx*this.scale.x,e.scale.y=t.sy*this.scale.y,e.updateFrameTextureDisplay()});var e=()=>{if(BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,e),this.transformLayer){var t=this.transformLayer.canvas.transformIndicatorContainer.toLocal(new PIXI.Point,this);this.strokeRectanglePool.x=t.x,this.strokeRectanglePool.y=t.y,this.strokeRectanglePool.rotation=this.rotation,this.strokeRectanglePool.scale.x=this.scale.x,this.strokeRectanglePool.scale.y=this.scale.y,this.strokeRectanglePool.poolScale=this._canvasScale*this.scale.x}};BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,e),BFN.MainUI.requestRender()},ug.prototype.createGroup=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&this._selectedItems.length>1&&BFN.GroupManager.createGroup(e,this._selectedItems)},ug.prototype.duplicateGroup=function(){if(!(this.selectedItems.length<=1||!this.transformLayer||this.duplicatingGroup)){var e=this.transformLayer,t=[...this.selectedItems].sort((t,i)=>e.children.indexOf(t)-e.children.indexOf(i));e.deselectItem(),this.duplicatingGroup=!0,this.transitionID="duplicate_selection",this.transitionBatchID=this.transitionID+BeFunky.randomString(10),BFN.TransformStateModel.startBulkTransition(this.transitionBatchID);var i=null,r=[],a=e=>{e.duplicatedItem&&r.push(e.duplicatedItem),requestAnimationFrame(i)};e.addEventListener(BFN.TransformLayerEvents.ITEM_DUPLICATED.type,a),(i=(()=>{if(t.length){t.shift().duplicateItem()}else{e.removeEventListener(BFN.TransformLayerEvents.ITEM_DUPLICATED.type,a),this.duplicatingGroup=!1,BFN.TransformStateModel.stopBulkTransition();var i=new BFN.TransformItemTransitionVO;i.id=this.transitionID,i.batchIDPlaceholder=this.transitionBatchID,BFN.TransformStateModel.addTransition(i),this.transitionID=null,this.transitionBatchID=null,r.length>1&&BFN.GroupManager.selectItems(r)}}))();var n=!1,o=10,s=()=>{this.duplicatingGroup?(o>0?o--:n||(n=!0,UIToggler.toggleLoadScreen(!0,{isCancellable:!1})),requestAnimationFrame(s)):n&&(n=!1,UIToggler.toggleLoadScreen(!1))};s()}},ug.prototype.pressItem=function(e){BFN.TransformItemEvents.PRESS_ITEM.targetItem=this,BFN.TransformItemEvents.PRESS_ITEM.externalPress=!0,BFN.TransformItemEvents.PRESS_ITEM.data={},BFN.TransformItemEvents.PRESS_ITEM.data.originalEvent=e,this.dispatchEvent(BFN.TransformItemEvents.PRESS_ITEM)},ug.prototype.initLongPressValues=function(){this.longPressOccurred=!1,this.handlePointerDownBind=this.handlePointerDown.bind(this),this.on("pointerdown",this.handlePointerDownBind)},ug.prototype.handlePointerDown=function(e){this.initiateLongPress()},ug.prototype.initiateLongPress=function(){this.longPressOccurred=!1;BFN.LongPressManager.initiateLongPress(e=>{this.longPressOccurred=!0,setTimeout(()=>{this.longPressOccurred=!1},0),document.dispatchEvent(new MouseEvent(BeFunky.pointerup)),this.transformLayer.transformTool.gizmoDragger.dragging&&this.transformLayer.transformTool.gizmoDragger.stopDrag(),this.pressItem(e)})},ug.prototype.updateAccurateBounds=function(){this.groupBounds=BFN.Util.getTransformItemBounds(this),this.accurateBounds=BFN.Util.getTransformItemBounds(this),this.accurateBounds.minX=0,this.accurateBounds.maxX=this.accurateBounds.width,this.accurateBounds.centerX=this.accurateBounds.width/2,this.accurateBounds.centerOffsetX=0,this.accurateBounds.minY=0,this.accurateBounds.maxY=this.accurateBounds.height,this.accurateBounds.centerY=this.accurateBounds.height/2,this.accurateBounds.centerOffsetY=0,this._selectedItems.length?(this.accurateBoundsUpdating=!0,this._selectedItems.forEach(e=>{e.removeEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,this.handleItemAccurateBoundsUpdatedBind),e.addEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,this.handleItemAccurateBoundsUpdatedBind),this.accurateBoundsQueue.includes(e)||this.accurateBoundsQueue.push(e)}),this._selectedItems.forEach(e=>{this.pendingTextItems.includes(e)||e.updateAccurateBounds()})):(this.accurateBoundsUpdatedCallback=null,this.isTextStyleTransition=!1)},ug.prototype.handleItemAccurateBoundsUpdated=function(e){var t=e.dispatcher,i=this.accurateBoundsQueue.indexOf(t);if(t.removeEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,this.handleItemAccurateBoundsUpdatedBind),-1!=i&&this.accurateBoundsQueue.splice(i,1),!this.accurateBoundsQueue.length&&this._selectedItems.length){this.isTextStyleTransition&&(this.isTextStyleTransition=!1,this.updateGroupDisplay(),this.groupBounds=BFN.Util.getTransformItemBounds(this));var r=null;this._selectedItems.forEach(e=>{var t=BFN.Util.getTransformItemBounds(e,!!e.accurateBounds.noBounds);r?(r.left=Math.min(r.left,t.minX+e.accurateBounds.minX),r.top=Math.min(r.top,t.minY+e.accurateBounds.minY),r.right=Math.max(r.right,t.minX+e.accurateBounds.minX+e.accurateBounds.width),r.bottom=Math.max(r.bottom,t.minY+e.accurateBounds.minY+e.accurateBounds.height)):r=new BFN.Rectangle(t.minX+e.accurateBounds.minX,t.minY+e.accurateBounds.minY,e.accurateBounds.width,e.accurateBounds.height)}),r&&(this.accurateBounds.minX=r.x-this.groupBounds.minX,this.accurateBounds.minY=r.y-this.groupBounds.minY,this.accurateBounds.maxX=this.accurateBounds.minX+r.width,this.accurateBounds.maxY=this.accurateBounds.minY+r.height,this.accurateBounds.width=this.accurateBounds.maxX-this.accurateBounds.minX,this.accurateBounds.height=this.accurateBounds.maxY-this.accurateBounds.minY,this.accurateBounds.left=this.accurateBounds.minX,this.accurateBounds.top=this.accurateBounds.minY,this.accurateBounds.right=this.groupBounds.maxX-r.right,this.accurateBounds.bottom=this.groupBounds.maxY-r.bottom,this.accurateBounds.centerX=this.accurateBounds.minX+this.accurateBounds.width/2,this.accurateBounds.centerY=this.accurateBounds.minY+this.accurateBounds.height/2,this.accurateBounds.centerOffsetX=this.accurateBounds.centerX-(this.groupBounds.centerX-this.groupBounds.minX),this.accurateBounds.centerOffsetY=this.accurateBounds.centerY-(this.groupBounds.centerY-this.groupBounds.minY)),this.accurateBoundsUpdatedCallback&&(this.accurateBoundsUpdatedCallback(),this.accurateBoundsUpdatedCallback=null),this.accurateBoundsUpdating=!1}},ug.prototype.updateSmoothingScale=function(){this._selectedItems.forEach(e=>{e.updateSmoothingScale()})},ug.prototype.updateContentDimensions=function(){this.itemContentW==this.itemContent.width&&this.itemContentH==this.itemContent.height||(this.itemContentW=this.itemContent.width,this.itemContentH=this.itemContent.height,this.updateBounds())},ug.prototype.updateBounds=function(){this.bounds=new PIXI.Rectangle(0,0,this.itemContentW,this.itemContentH),this.polygon=[new PIXI.Point(0,0),new PIXI.Point(this.itemContentW,0),new PIXI.Point(this.itemContentW,this.itemContentH),new PIXI.Point(0,this.itemContentH)],this.updateHitArea()},ug.prototype.updateHitArea=function(){this.hitArea=new PIXI.Rectangle(0,0,this.itemContentW,this.itemContentH),this._selectedItems.forEach(e=>{e.updateHitArea()})},ug.prototype.toggleTransform=function(e){if(this.parent&&this._selectedItems.length){var t=[];this._selectedItems.forEach(e=>{e.parent==this.parent&&t.push({item:e,dz:e.itemGroupData.dz,bm:e.itemGroupData.bm})}),t.sort(function(e,t){return e.dz-t.dz});for(var i=0;i<t.length;i++){var r=t[i].item,a=t[i].dz,n=t[i].bm;r.parent.setChildIndex(r,e?r.parent.children.length-2:a),r.itemContent.blendMode=e?BFN.CONST.BLEND_MODES.NORMAL:n}}},ug.prototype.updateHiResTextBounds=function(){this._selectedItems.forEach(e=>{e.updateHiResTextBounds(!1)})},ug.prototype.updateHiResText=function(){this._selectedItems.forEach(e=>{BFN.HiResTextManager.processHiResTextItem(e)})},ug.prototype.renderHiResText=function(){},ug.prototype.removeItem=function(){this.transformLayer&&this.transformLayer.selectedItem==this&&this.transformLayer.removeItem(this)},ug.prototype.alignItems=function(e){if(this._align&&this.transformLayer&&this._selectedItems.length){var t=this.transformLayer.getItemSelectionBounds(this._selectedItems);if(!e){var i={left:-this.transformLayer.frameWidth/2,center:0,right:this.transformLayer.frameWidth/2,top:-this.transformLayer.frameHeight/2,middle:0,bottom:this.transformLayer.frameHeight/2};Math.abs(t[this._align]-i[this._align])<=1&&(e=!0,t[this._align]=i[this._align])}e?this._selectedItems.forEach(e=>{e._align=this._align,this.transformLayer.alignItem(e,t[this._align]),e._align=null}):(this.transformLayer.alignItem(this),this.updateGroupTransform()),this.updateGroupDisplay(),this.updateAccurateBounds(),this.transformLayer.transformTool.updateDisplay()}},ug.prototype.setOverlayColor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._selectedItems.forEach(i=>{i.overlayColor=e,i.overlayColorIntensity=t})},ug.prototype.setTintColor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._selectedItems.forEach(t=>{t.tintColor=e})},ug.prototype.setBlendMode=function(e){this._selectedItems.forEach(t=>{t.setBlendMode(e)})},ug.prototype.setOpacity=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this._selectedItems.forEach(t=>{t.alpha=e/100}),BFN.MainUI.requestRender()},ug.prototype.flipHorizontal=function(){this._selectedItems.forEach(e=>{e.flipHorizontal()}),BFN.MainUI.requestRender()},ug.prototype.flipVertical=function(){this._selectedItems.forEach(e=>{e.flipVertical()}),BFN.MainUI.requestRender()},ug.prototype.moveBackwards=function(){return this.changeItemIndex("backwards")},ug.prototype.moveForwards=function(){return this.changeItemIndex("forwards")},ug.prototype.changeItemIndex=function(e){if(!this.parent||!this._selectedItems.length)return!1;var t=this.globalPolygon,i=[];if(this.parent.children.forEach(e=>{if(e!=this&&!this._selectedItems.includes(e)&&BFN.Util.polygonHitTest(t,e.globalPolygon)){var r=e.parent.getChildIndex(e);i.push({item:e,zIndex:r})}}),!i.length)return!1;i.sort(function(e,t){return e.zIndex-t.zIndex});var r=i[0].zIndex,a=i[i.length-1].zIndex,n=[];if(this._selectedItems.forEach(e=>{if(e.parent&&e.parent==this.parent){var t=e.parent.getChildIndex(e);n.push({item:e,zIndex:t})}}),!n.length)return!1;n.sort(function(e,t){return e.zIndex-t.zIndex});var o=n[0].zIndex,s=n[n.length-1].zIndex,l=null,h=-1;switch(e){case"backwards":if(s<r)return!1;for(var c=0;c<i.length;c++){i[c].zIndex<s&&(l=i[c].item,h=s)}break;case"forwards":if(o>a)return!1;for(var u=i.length;--u>-1;){i[u].zIndex>o&&(l=i[u].item,h=o)}}return!(!l||-1==h)&&(l.createTransition("history_layer_order",!1,!0),l.parent.setChildIndex(l,h),l.registerTransition(!1,!1),i.forEach(e=>{e.item.updateItemGroupData()}),n.forEach(e=>{e.item.updateItemGroupData()}),l.parent.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED),!0)},ug.prototype.updateHitAreaOrTextWidths=function(){this._selectedItems.forEach(e=>{"text"==e.type?this.pendingTextItems.push(e):e.basicShapeVO?e.updateContentDimensions():e.updateHitArea()}),this.processPendingTextItems()},ug.prototype.processPendingTextItems=function(){if(this.pendingTextItems.length){var e=this.pendingTextItems[0];e.addEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,this.handleItemTextDisplayUpdatedBind),e.setTextWidth(e.itemGroupData.bw*this.scale.x,!0),e.itemGroupData.sx=e.scale.x/this.scale.x,e.itemGroupData.sy=e.scale.y/this.scale.y}},ug.prototype.handleItemTextDisplayUpdated=function(e){this.pendingTextItems[0].removeEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,this.handleItemTextDisplayUpdatedBind),this.pendingTextItems.shift(),requestAnimationFrame(this.processPendingTextItems.bind(this))},ug.prototype.updateFrameTextureDisplay=function(){},ug.prototype.resetFrameTextureScale=function(){this._selectedItems.forEach(e=>{e.resetFrameTextureScale(),e.itemGroupData.sx=e.scale.x/this.scale.x,e.itemGroupData.sy=e.scale.y/this.scale.y})},ug.prototype.updateShapeTexture=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._selectedItems.forEach(t=>{t.updateShapeTexture(e)})},ug.prototype.createTransition=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.transitionID&&this.transitionID!=e&&(this.lastTransitionVO=null),this.lastTransitionVO&&this.lastTransitionVO.id!=e&&(this.lastTransitionVO=null),this.transitionID=e,this.transitionBatchID=this.transitionID+BeFunky.randomString(10),BFN.TransformStateModel.startBulkTransition(this.transitionBatchID),t&&this._selectedItems.forEach(e=>{e.isGroupTransition=!0,e.createTransition(this.transitionID),delete e.isGroupTransition})},ug.prototype.registerTransition=function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.accurateBoundsUpdatedCallback=t?r:null,this.isTextStyleTransition=a,i&&this._selectedItems.forEach(i=>{i.registerTransition(e,t)}),BFN.TransformStateModel.stopBulkTransition();var n=function(){var e=new BFN.TransformItemTransitionVO;return e.id=this.transitionID,e.batchIDPlaceholder=this.transitionBatchID,BFN.TransformStateModel.addTransition(e),e}.bind(this);e?(this.lastTransitionVO||(this.lastTransitionVO=n()),t&&this.updateAccurateBounds()):(this.lastTransitionVO=null,n(),t&&this.updateAccurateBounds()),this.transitionID=null,this.transitionBatchID=null},ug.prototype.getGroupItemData=function(){var e={},t=(t,i)=>{if(e.hasOwnProperty(t)){if(e[t]!=i)switch(t){case"shapeStrokeWidth":e[t]=Math.max(e[t],i);break;case"shapeHideFill":case"shapeHideStroke":e[t]=!(!e[t]&&!i);break;default:e[t]="mixed"}}else e[t]=i};return this.selectedItems.forEach(e=>{t("opacity",Math.round(100*e.alpha)),t("blendMode",e.itemBlendMode),t("overlayColor",e.overlayColor),t("overlayColorIntensity",e.overlayColorIntensity),t("tintColor",e.tintColor),e.basicShapeVO&&(t("shapeFill",e.basicShapeVO.fill),t("shapeFillAlpha",e.basicShapeVO.fillAlpha),t("shapeStroke",e.basicShapeVO.stroke),t("shapeStrokeAlpha",e.basicShapeVO.strokeAlpha),t("shapeStrokeWidth",e.basicShapeVO.strokeWidth),t("shapeHideFill",["line"].includes(e.basicShapeVO.type)),t("shapeHideStroke",["star","arrow"].includes(e.basicShapeVO.type)))}),e},ug.prototype.getTextGroupStyleData=function(){var e={};return"text"==this.groupType&&this.selectedItems.forEach(t=>{t.getTextStyleData(e)}),e},ug.prototype.handleDocumentMouseDown=function(e){if(e.target instanceof HTMLCanvasElement&&2!=e.button){if(BFN.AppModel.viewingEditor&&BFN.PhotoEditorCanvasModel.viewState!=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)return;if(BFN.PhotoEditorCanvasModel.viewState!=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)return;if(BFN.TransformItemIsolator.active)return;if(BFN.TransformModel.transformToolFrame&&BFN.TransformModel.transformToolFrame.active)return;this.documentMouseDownPoint={x:e.pageX,y:e.pageY},this.documentMouseMoved=!1,this.allowSelectionDrag=!1,this.eraseSelection=!1,document.addEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handleDocumentMouseUpBind,!0)}},ug.prototype.handleDocumentMouseMove=function(e){var t=!1,i=!0;if(BFN.ActiveDraggers.forEach(e=>{t=e.preventSelectionDrag||t,i=e.deselectItemGroup&&i}),t=!(!t&&!BFN.preventSelectionDrag),BFN.preventSelectionDrag=!1,t)return document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveBind,!0),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUpBind,!0),void(i&&this.transformLayer&&this.transformLayer.children.includes(this)&&this.transformLayer.resetTransformItemGroup());if(!this.documentMouseMoved){this.documentMouseMoved=!0;var r=e.ctrlKey||e.metaKey||e.altKey;this.allowSelectionDrag=!BFN.ActiveDraggers.length,BFN.AppModel.viewingEditor&&BFN.ActiveDraggers.includes(BFN.PhotoEditorCanvas.canvasDragger)&&(!BFN.PhotoEditorCanvas.canvasDragger.validDrag||r)&&(BFN.PhotoEditorCanvas.canvasDragger.stopDrag(),this.allowSelectionDrag=!0),r&&(BFN.ActiveDraggers.forEach(e=>{e.stopDrag()}),this.allowSelectionDrag=!0),this.allowSelectionDrag&&e.altKey&&(this.eraseSelection=!0)}var a=e.pageX-this.documentMouseDownPoint.x,n=e.pageY-this.documentMouseDownPoint.y;if(Math.sqrt(Math.pow(a,2)+Math.pow(n,2))>5&&(document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveBind,!0),this.allowSelectionDrag&&!BFN.FabricManager.currentTextTransformItem)){var o=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer);o.textTransformItem=null;var s=[];o.lastDeselectedItem&&"group"!=o.lastDeselectedItem.type&&(e.metaKey||e.ctrlKey)&&s.push(o.lastDeselectedItem),o.selectedItem&&"group"!=o.selectedItem.type&&!s.includes(o.selectedItem)&&s.push(o.selectedItem),o.deselectItem(!(e.ctrlKey||e.metaKey)),o.startGroupSelection(e.ctrlKey||e.metaKey||this.eraseSelection,this.eraseSelection,s),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUpBind,!0)}},ug.prototype.handleDocumentMouseUp=function(e){document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveBind,!0),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUpBind,!0),this.transformLayer&&(this.transformLayer.updateTransformItemGroup(),delete this.transformLayer.lastDeselectedItem)},ug.prototype.handleDocumentKeyDown=function(e){this.allowedKeys.includes(e.keyCode)&&!this.pressedKeys.includes(e.keyCode)&&(this.pressedKeys.push(e.keyCode),this.interactive&&(this.interactive=!1,document.addEventListener("keyup",this.handleDocumentKeyUpBind,!0)))},ug.prototype.handleDocumentKeyUp=function(e){this.interactive||(this.allowedKeys.includes(e.keyCode)&&this.pressedKeys.includes(e.keyCode)&&this.pressedKeys.splice(this.pressedKeys.indexOf(e.keyCode),1),this.pressedKeys.length||(this.interactive=!0,document.removeEventListener("keyup",this.handleDocumentKeyUpBind,!0)))},ug.prototype.handleFadeAnimatorUpdate=function(e){this.strokeRectanglePool.alpha=this.fadeAnimator.animationFactor,this.strokeRectanglePool.visible=this.fadeAnimator.animationFactor>0},Object.defineProperty(ug.prototype,"itemWidth",{get:function(){return this.itemContent.width}}),Object.defineProperty(ug.prototype,"itemHeight",{get:function(){return this.itemContent.height}}),Object.defineProperty(ug.prototype,"groupType",{get:function(){var e=null,t=!0;return this.selectedItems.forEach(i=>{var r=i.type;"texture"==r||"frame_texture"==r?r=i.isGoodie?i.basicShapeVO?"shape":"graphic":"image":t=!1,e?e!=r&&(e="mixed","shape"==r&&(t=!1)):e=r}),"mixed"==e&&t&&(e="graphic_image_mix"),e}}),Object.defineProperty(ug.prototype,"basicShapeVO",{get:function(){return"shape"===this.groupType?(this._basicShapeVO||(this._basicShapeVO=new BFN.BasicShapeVO("group")),this._basicShapeVO):null}}),Object.defineProperty(ug.prototype,"globalPolygon",{get:function(){for(var e=[],t=0;t<this.polygon.length;t++){var i=this.polygon[t],r=BFN.MainUI.toLocal(i,this);e.push(r)}return e}}),Object.defineProperty(ug.prototype,"selectedItems",{get:function(){return this._selectedItems}}),Object.defineProperty(ug.prototype,"canvasScale",{set:function(e){"number"!=typeof e&&console.trace("set scale",e),this._canvasScale=e,this.strokeRectanglePool.poolScale=this._canvasScale*this.scale.x,this.transformLayer&&this.updateGroupTransform()},get:function(){return this._canvasScale}}),Object.defineProperty(ug.prototype,"align",{set:function(e){this._align=e,this.alignItems(BeFunky.globalPointerEvent.ctrlKey||BeFunky.globalPointerEvent.metaKey),this._align=null},get:function(){return this._align}}),BFN.SingletonQueue.add(function(){BFN.TransformItemGroup=new ug}),dg.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),dg.prototype.init=function(){BeFunky.log("TransformItemIsolator Init"),this.initDefaultValues(),this.initBackground(),this.initItem(),this.initAnimators()},dg.prototype.initDefaultValues=function(){this.interactive=!1,this.canvasModel=null,this.canvas=null,this.transformParamsStart={},this.transformParamsEnd={},this.itemTextureFrame=new BFN.Rectangle,this.reselectOnReleaseComplete=!0,this.backgroundContainerActive=!0,this.shiftParamsStart={x:0,y:0,w:0,h:0},this.shiftParamsEnd={x:0,y:0,w:0,h:0},this.usingAlternateMenu=!1,this.imageLayerEdited=!1,this._itemWidth=0,this._itemHeight=0,this.handleIsolatedItemThumbUpdatedBind=BeFunky.debounce(this.handleIsolatedItemThumbUpdated.bind(this),"raf"),this.handleCanvasScaleUpdatedBind=this.handleCanvasScaleUpdated.bind(this),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handlePhotoEditorCanvasViewstateUpdated.bind(this))},dg.prototype.initBackground=function(){this.backgroundContainer=new PIXI.Container,this.addChild(this.backgroundContainer),this.backgroundTexture=PIXI.RenderTexture.create(32,32),this.backgroundSprite=new PIXI.Sprite(this.backgroundTexture),this.backgroundSprite.pluginName="smooth_picture",this.backgroundContainer.addChild(this.backgroundSprite)},dg.prototype.initItem=function(){this.itemTexture=PIXI.RenderTexture.create(32,32),this.itemSprite=new PIXI.Sprite(this.itemTexture),this.itemSprite.visible=!1,this.itemSprite.pluginName="smooth_picture",this.itemSprite.anchor.x=this.itemSprite.anchor.y=.5,this.addChild(this.itemSprite)},dg.prototype.initAnimators=function(){this.isolationAnimator=new BFN.Animator,this.isolationAnimator.linearSteps=32,this.isolationAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleIsolationAnimatorUpdate.bind(this)),this.isolationAnimator.addEventListener(BFN.AnimatorEvents.INCREASE_COMPLETE.type,this.handleIsolationAnimatorIncreaseComplete.bind(this)),this.isolationAnimator.addEventListener(BFN.AnimatorEvents.DECREASE_COMPLETE.type,this.handleIsolationAnimatorDecreaseComplete.bind(this)),this.shiftAnimator=new BFN.Animator,this.shiftAnimator.linearSteps=8,this.shiftAnimator.setAnimatorFactor(1),this.shiftAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleShiftAnimatorUpdate.bind(this)),this.shiftAnimator.addEventListener(BFN.AnimatorEvents.INCREASE_COMPLETE.type,this.handleShiftAnimatorIncreaseComplete.bind(this))},dg.prototype.isolateTransformItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!!e!=!!this.isolatedTransformItem){e&&(this.isolatedCallback=t,this.releasedCallback=i,this.usingAlternateMenu=r),this.canvasModel=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),this.canvas=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);var a=this.canvas.transformItemIsolatorContainer,n=this.canvas.transformLayer;if(!e||e.isGoodie||"texture"!==e.type&&"frame_texture"!==e.type||(this.isolatedTransformItem=e,this.isolatedTransformItem.deselectItem(),a.addChild(this),BFN.CollageMakerCanvas.canvasScaleBars.active=!1,BFN.GlobalHistoryModel.updateGlobalHistoryButtons()),!e&&this.isolatedTransformItem){var o=0,s=0,l=0,h=0;switch(this.canvasModel){case BFN.PhotoEditorCanvasModel:o=2*this.canvasModel.imageFitPaddingX,s=2*this.canvasModel.imageFitPaddingY,l=BFN.PhotoEditorCanvas.canvasImage.width,h=BFN.PhotoEditorCanvas.canvasImage.height;break;case BFN.CollageMakerCanvasModel:o=2*this.canvasModel.collageFitPaddingX,s=2*this.canvasModel.collageFitPaddingY,l=BFN.CollageMakerCanvas.canvasPhotoGrid.gridWidth,h=BFN.CollageMakerCanvas.canvasPhotoGrid.gridHeight;break;case BFN.DesignerCanvasModel:o=2*this.canvasModel.designerFitPaddingX,s=2*this.canvasModel.designerFitPaddingY,l=BFN.DesignerCanvas.canvasWidth,h=BFN.DesignerCanvas.canvasHeight}return this.transformParamsStart.canvasScale=l&&h?Math.min(1,(BFN.StageModel.stageW-o)/l,(BFN.StageModel.stageH-s)/h):1,UITools.setControlValue("transform_isolator_display_canvas",!0),UITools.updateToolControl("transform_isolator_display_canvas"),UITools.applyTool("transform"),this.canvasModel.disregardScaleRange=!0,this.canvasModel.canvasScaling=!0,this.transformParamsEnd.canvasScale=this.canvasModel.canvasScale,this.itemSprite.visible=!0,UIToggler.toggleMainMenu(!1),this.isolationAnimator.decrease(),this.isolatedTransformItem.removeEventListener(BFN.TransformItemEvents.THUMB_UPDATED.type,this.handleIsolatedItemThumbUpdatedBind),void(this.imageLayerEdited&&(this.trackImageLayerEdited(),this.imageLayerEdited=!1))}if(this.imageLayerEdited=!1,BFN.TransformGuides.updateVisibility(),this.isolatedTransformItem){this.isolatedTransformItem.renderable=!1;var c=n.layerBounds;c||(c=new BFN.Rectangle);var u=(e,t)=>{c.left=Math.min(c.left,-e/2),c.right=Math.max(c.right,e/2),c.top=Math.min(c.top,-t/2),c.bottom=Math.max(c.bottom,t/2)};switch(this.canvas){case BFN.PhotoEditorCanvas:u(BFN.PhotoEditorCanvas.canvasImage.imageWidth,BFN.PhotoEditorCanvas.canvasImage.imageHeight);break;case BFN.CollageMakerCanvas:u(BFN.CollageMakerCanvas.canvasPhotoGrid.gridWidth,BFN.CollageMakerCanvas.canvasPhotoGrid.gridHeight);break;case BFN.DesignerCanvas:u(BFN.DesignerCanvas.canvasWidth,BFN.DesignerCanvas.canvasHeight)}if(c.width&&c.height){var d=Math.min(1,BFN.maxImageSize/c.width,BFN.maxImageSize/c.height),m=Math.round(c.width*d),p=Math.round(c.height*d);switch(this.backgroundTexture.resize(m,p),this.canvas){case BFN.PhotoEditorCanvas:var g=this.canvas.canvasImage.currentScale;this.canvas.canvasImage.currentScale=d,this.canvas.canvasImage.x=(-c.x-this.canvas.canvasImage.imageWidth/2)*d,this.canvas.canvasImage.y=(-c.y-this.canvas.canvasImage.imageHeight/2)*d,this.canvas.canvasImage.scale.x=this.canvas.canvasImage.scale.y=d,BFN.Stage.render(this.canvas.canvasImage,this.backgroundTexture,!0),this.canvas.canvasImage.currentScale=g,this.canvas.canvasImage.x=0,this.canvas.canvasImage.y=0,this.canvas.canvasImage.scale.x=this.canvas.canvasImage.scale.y=1;break;case BFN.CollageMakerCanvas:var f={backgroundX:this.canvas.background.x,backgroundY:this.canvas.background.y,gridScale:this.canvas.canvasPhotoGrid.canvasScale,gridX:this.canvas.canvasPhotoGrid.x,gridY:this.canvas.canvasPhotoGrid.y};this.canvas.background.x=-(this.canvas.canvasPhotoGrid.gridWidth/2+c.x*d),this.canvas.background.y=-(this.canvas.canvasPhotoGrid.gridHeight/2+c.y*d),this.canvas.background.scale.x=this.canvas.canvasPhotoGrid.gridWidth/this.canvas.background.itemWidth,this.canvas.background.scale.y=this.canvas.canvasPhotoGrid.gridHeight/this.canvas.background.itemHeight,BFN.Stage.render(this.canvas.background,this.backgroundTexture,!0),this.canvas.background.x=f.backgroundX,this.canvas.background.y=f.backgroundY,this.canvas.background.scale.x=this.canvas.background.scale.y=1,this.canvas.canvasPhotoGrid.canvasScale=d,this.canvas.canvasPhotoGrid.x=-c.x*d,this.canvas.canvasPhotoGrid.y=-c.y*d,this.canvas.canvasPhotoGrid.scale.x=this.canvas.canvasPhotoGrid.scale.y=d,BFN.Stage.render(this.canvas.canvasPhotoGrid,this.backgroundTexture,!1),this.canvas.canvasPhotoGrid.canvasScale=f.gridScale,this.canvas.canvasPhotoGrid.x=f.gridX,this.canvas.canvasPhotoGrid.y=f.gridY,this.canvas.canvasPhotoGrid.scale.x=this.canvas.canvasPhotoGrid.scale.y=1;break;case BFN.DesignerCanvas:var v={backgroundX:this.canvas.background.x,backgroundY:this.canvas.background.y};this.canvas.background.x=-(this.canvas.canvasWidth/2+c.x*d),this.canvas.background.y=-(this.canvas.canvasHeight/2+c.y*d),this.canvas.background.scale.x=this.canvas.canvasWidth/this.canvas.background.itemWidth,this.canvas.background.scale.y=this.canvas.canvasHeight/this.canvas.background.itemHeight,BFN.Stage.render(this.canvas.background,this.backgroundTexture,!0),this.canvas.background.x=v.backgroundX,this.canvas.background.y=v.backgroundY,this.canvas.background.scale.x=this.canvas.background.scale.y=1}var y=new PIXI.Point(n.x,n.y);n.x=-c.x*d,n.y=-c.y*d,n.scale.x=n.scale.y=d,n.toggleHiResTextDisplay(!1),n.transformItems.forEach(e=>{e.updateSmoothingScale(d,!1)});var x=n.parent,_=n.parent.children.indexOf(n);n.parent.removeChild(n),BFN.Stage.render(n,this.backgroundTexture,!1),x.addChildAt(n,_),n.x=y.x,n.y=y.y,n.scale.x=n.scale.y=1,n.toggleHiResTextDisplay(!0),n.transformItems.forEach(e=>{e.updateSmoothingScale(null,!1)}),this.isolatedTransformItem.renderable=!0;var I=[0,12,8,4][this.isolatedTransformItem.flippedHorizontal+2*this.isolatedTransformItem.flippedVertical],T=null;switch(this.isolatedTransformItem.type){case"texture":T=this.isolatedTransformItem.itemContent.texture.baseTexture,this.itemTexture.resize(Math.floor(T.width),Math.floor(T.height));var b=new PIXI.Texture(T);b.rotate=I,this.itemTexture.copyPixels(b),b.destroyGC(!1);break;case"frame_texture":var S=this.isolatedTransformItem.itemContent;T=S.baseTexture,this.itemTexture.resize(Math.floor(S.textureFrame.width),Math.floor(S.textureFrame.height));var C=new PIXI.Texture(T);C.rotate=I,this.itemTextureFrame.x=Math.min(S.textureFrame.x,T.width-this.itemTexture.width),this.itemTextureFrame.y=Math.min(S.textureFrame.y,T.height-this.itemTexture.height),this.itemTextureFrame.width=this.itemTexture.width,this.itemTextureFrame.height=this.itemTexture.height;var B=this.isolatedTransformItem.flippedHorizontal?-Math.min(T.width-(this.itemTextureFrame.x+this.itemTexture.width),T.width-this.itemTexture.width):-this.itemTextureFrame.x,F=this.isolatedTransformItem.flippedVertical?-Math.min(T.height-(this.itemTextureFrame.y+this.itemTexture.height),T.height-this.itemTexture.height):-this.itemTextureFrame.y;this.itemTexture.copyPixels(C,{x:B,y:F}),C.destroyGC(!1)}var E=this.isolatedTransformItem.itemContentW*this.isolatedTransformItem.scale.x,P=this.isolatedTransformItem.itemContentH*this.isolatedTransformItem.scale.y,N=Math.sqrt(Math.pow(E,2)+Math.pow(P,2)),M=Math.atan2(P,E),D=this.isolatedTransformItem.x+Math.cos(this.isolatedTransformItem.rotation+M)*(N/2),w=this.isolatedTransformItem.y+Math.sin(this.isolatedTransformItem.rotation+M)*(N/2),k=0,L=0;switch(this.canvasModel){case BFN.PhotoEditorCanvasModel:k=2*this.canvasModel.imageFitPaddingX,L=2*this.canvasModel.imageFitPaddingY;break;case BFN.CollageMakerCanvasModel:k=2*this.canvasModel.collageFitPaddingX,L=2*this.canvasModel.collageFitPaddingY;break;case BFN.DesignerCanvasModel:k=2*this.canvasModel.designerFitPaddingX,L=2*this.canvasModel.designerFitPaddingY}this.transformParamsStart.canvasScale=this.canvasModel.canvasScale,this.transformParamsEnd.canvasScale=Math.min(1,(BFN.StageModel.stageW-k)/this.itemTexture.width,(BFN.StageModel.stageH-L)/this.itemTexture.height),this.transformParamsStart.x=D,this.transformParamsStart.y=w,this.transformParamsStart.width=E,this.transformParamsStart.height=P,this.transformParamsStart.rotation=(this.isolatedTransformItem.rotation+4*Math.PI)%(2*Math.PI),this.transformParamsStart.rotation>Math.PI&&(this.transformParamsStart.rotation-=2*Math.PI),this.transformParamsStart.alpha=this.isolatedTransformItem.alpha,this.transformParamsEnd.x=0,this.transformParamsEnd.y=0,this.transformParamsEnd.width=this.itemTexture.width,this.transformParamsEnd.height=this.itemTexture.height,this.transformParamsEnd.rotation=0,this.transformParamsEnd.alpha=1,this.backgroundContainer.x=this.transformParamsStart.x,this.backgroundContainer.y=this.transformParamsStart.y,this.backgroundContainer.rotation=this.transformParamsStart.rotation,this.backgroundContainer.scale.x=this.backgroundContainer.scale.y=1;var O=this.backgroundContainer.toLocal(this.toGlobal(new PIXI.Point(c.x,c.y)));this.backgroundSprite.x=O.x,this.backgroundSprite.y=O.y,this.backgroundSprite.rotation=-this.backgroundContainer.rotation,this.backgroundSprite.scale.x=this.backgroundSprite.scale.y=this.backgroundSprite.currentScale=1/d,T&&(T.backgroundSpritePosition={x:O.x,y:O.y}),this._itemWidth=this.itemTexture.width,this._itemHeight=this.itemTexture.height,this.itemSprite.visible=!0,this.canvas.canvas.visible=!1,UIToggler.toggleMainMenu(!1),UIToggler.toggleNavBar(!1),UITools.setControlValue("transform_isolator_display_canvas",!0),UITools.updateToolControl("transform_isolator_display_canvas"),UITools.applyTool("transform"),this.isolatedTransformItem.addEventListener(BFN.TransformItemEvents.THUMB_UPDATED.type,this.handleIsolatedItemThumbUpdatedBind),this.canvasModel.addEventListener("CANVAS_SCALE_UPDATED",this.handleCanvasScaleUpdatedBind),this.canvasModel.disregardScaleRange=!0,this.canvasModel.canvasScaling=!0,this.isolationAnimator.setAnimatorFactor(0),this.isolationAnimator.increase(),UIHistory.updateHistoryAvailable(),UIHistory.resetButton.disabled=!0,BFN.MainUI.requestRender()}}}},dg.prototype.releaseTransformItem=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.waitingToRelease=e,this.waitingToRelease||this.isolateTransformItem()},dg.prototype.toggleBackground=function(e){this.backgroundContainerActive=!!e,this.updateBackgroundContainerAlpha()},dg.prototype.updateBackgroundContainerAlpha=function(){this.backgroundContainer.alpha=this.backgroundContainerActive?1:1-this.isolationAnimator.animationFactor,BFN.MainUI.requestRender()},dg.prototype.shiftCanvasTo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.shiftParamsStart={x:this.backgroundSprite.x,y:this.backgroundSprite.y,w:this._itemWidth,h:this._itemHeight},this.shiftParamsEnd={x:e,y:t,w:i,h:r};var a=!1;for(var n in this.shiftParamsStart)this.shiftParamsEnd.hasOwnProperty(n)&&Math.round(this.shiftParamsStart[n])!==Math.round(this.shiftParamsEnd[n])&&(a=!0);return a&&(this.shiftAnimator.setAnimatorFactor(0),this.shiftAnimator.increase()),a},dg.prototype.trackImageLayerEdited=function(){var e=new BFN.UserActionVO;e.eventID="image_layer_edited",e.register()},dg.prototype.handleIsolatedItemThumbUpdated=function(e){if(this.active&&!this.animating){var t=this.isolatedTransformItem,i=[0,12,8,4][t.flippedHorizontal+2*t.flippedVertical],r=null;switch(t.type){case"texture":r=t.itemContent.texture.baseTexture,this.itemTexture.resize(Math.floor(r.width),Math.floor(r.height));var a=new PIXI.Texture(r);a.rotate=i,this.itemTexture.copyPixels(a),a.destroyGC(!1);break;case"frame_texture":var n=t.itemContent;r=n.baseTexture,this.itemTexture.resize(Math.floor(n.textureFrame.width),Math.floor(n.textureFrame.height));var o=new PIXI.Texture(r);o.rotate=i,this.itemTextureFrame.x=Math.min(n.textureFrame.x,r.width-this.itemTexture.width),this.itemTextureFrame.y=Math.min(n.textureFrame.y,r.height-this.itemTexture.height),this.itemTextureFrame.width=this.itemTexture.width,this.itemTextureFrame.height=this.itemTexture.height;var s=t.flippedHorizontal?-Math.min(r.width-(this.itemTextureFrame.x+this.itemTexture.width),r.width-this.itemTexture.width):-this.itemTextureFrame.x,l=t.flippedVertical?-Math.min(r.height-(this.itemTextureFrame.y+this.itemTexture.height),r.height-this.itemTexture.height):-this.itemTextureFrame.y;this.itemTexture.copyPixels(o,{x:s,y:l}),o.destroyGC(!1)}var h=!1;r&&(!r.backgroundSpritePosition&&r.imageOffset&&(r.backgroundSpritePosition={x:this.backgroundSprite.x+r.imageOffset.x/this.backgroundContainer.scale.x,y:this.backgroundSprite.y+r.imageOffset.y/this.backgroundContainer.scale.y},delete r.imageOffset),r.backgroundSpritePosition&&(h=this.shiftCanvasTo(r.backgroundSpritePosition.x,r.backgroundSpritePosition.y,this.itemTexture.width,this.itemTexture.height)));var c=this.isolatedTransformItem.itemContentW*this.isolatedTransformItem.scale.x,u=this.isolatedTransformItem.itemContentH*this.isolatedTransformItem.scale.y,d=Math.sqrt(Math.pow(c,2)+Math.pow(u,2)),m=Math.atan2(u,c),p=this.isolatedTransformItem.x+Math.cos(this.isolatedTransformItem.rotation+m)*(d/2),g=this.isolatedTransformItem.y+Math.sin(this.isolatedTransformItem.rotation+m)*(d/2);this.transformParamsStart.x=p,this.transformParamsStart.y=g,this.transformParamsStart.width=c,this.transformParamsStart.height=u,this.transformParamsEnd.width=this.itemTexture.width,this.transformParamsEnd.height=this.itemTexture.height,this._itemWidth=this.itemTexture.width,this._itemHeight=this.itemTexture.height,this.itemTexture.determineTransparency();try{this.altSourceTexture.destroyGC(!0)}catch(e){}this.altSourceTexture=this.itemTexture.renderClone(),BFN.GlobalHistoryModel.updateGlobalHistoryButtons();var f=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);f.updateCheckerPanel(),f.updateTransformLayerVeil(),h||requestAnimationFrame(()=>{this.handleShiftAnimatorIncreaseComplete()}),BFN.MainUI.requestRender()}},dg.prototype.handlePhotoEditorCanvasViewstateUpdated=function(e){this.active&&(this.itemSprite.visible=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)},dg.prototype.handleCanvasScaleUpdated=function(e){this.backgroundSprite.currentScale=this.backgroundContainer.scale.x*this.canvasModel.canvasScale,this.backgroundSprite.currentScaleY=this.backgroundContainer.scale.y*this.canvasModel.canvasScale,this.itemSprite.currentScale=this.itemSprite.scale.x*this.canvasModel.canvasScale,this.itemSprite.currentScaleY=this.itemSprite.scale.y*this.canvasModel.canvasScale},dg.prototype.handleIsolationAnimatorUpdate=function(e){var t=(this.transformParamsStart.x-this.transformParamsEnd.x)*(1-this.isolationAnimator.animationSinFactor),i=(this.transformParamsStart.y-this.transformParamsEnd.y)*(1-this.isolationAnimator.animationSinFactor),r=(this.transformParamsStart.width-this.transformParamsEnd.width)*(1-this.isolationAnimator.animationSinFactor),a=(this.transformParamsStart.height-this.transformParamsEnd.height)*(1-this.isolationAnimator.animationSinFactor),n=(this.transformParamsStart.rotation-this.transformParamsEnd.rotation)*(1-this.isolationAnimator.animationSinFactor),o=(this.transformParamsStart.alpha-this.transformParamsEnd.alpha)*(1-this.isolationAnimator.animationSinFactor);this.itemSprite.x=this.transformParamsEnd.x+t,this.itemSprite.y=this.transformParamsEnd.y+i,this.itemSprite.width=this.transformParamsEnd.width+r,this.itemSprite.height=this.transformParamsEnd.height+a,this.itemSprite.rotation=this.transformParamsEnd.rotation+n,this.itemSprite.alpha=this.transformParamsEnd.alpha+o,this.backgroundContainer.x=this.itemSprite.x,this.backgroundContainer.y=this.itemSprite.y,this.backgroundContainer.scale.x=this.itemSprite.width/this.transformParamsStart.width,this.backgroundContainer.scale.y=this.itemSprite.height/this.transformParamsStart.height,this.backgroundContainer.rotation=this.itemSprite.rotation,this.canvasModel.canvasScale=(this.transformParamsEnd.canvasScale-this.transformParamsStart.canvasScale)*this.isolationAnimator.animationSinFactor+this.transformParamsStart.canvasScale,this.canvas.transformLayerVeil.opacity=this.canvas.transformLayerVeil.baseOpacity*(1-this.isolationAnimator.animationFactor),this.updateBackgroundContainerAlpha()},dg.prototype.handleIsolationAnimatorIncreaseComplete=function(e){this.canvasModel.disregardScaleRange=!1,this.canvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange(),BFN.ZoomRegion.updatePreview(),this.canvas.layerToolContainer.addChild(BFN.PhotoEditorCanvas.canvasTools),this.itemTexture.determineTransparency(),this.altSourceTexture=this.itemTexture.renderClone(),document.getElementById("layer_edit_menu").setStyles({display:"flex"}),this.isolatedCallback&&setTimeout(()=>{requestAnimationFrame(()=>{this.itemSprite.visible=!1,this.isolatedCallback(),this.canvasModel.canvasScaling=!0,this.canvasModel.canvasScale=this.canvasModel.canvasScale,this.canvasModel.canvasScaling=!1})},50)},dg.prototype.handleIsolationAnimatorDecreaseComplete=function(e){this.usingAlternateMenu=!1,this.canvasModel.disregardScaleRange=!1,BFN.CollageMakerCanvas.canvasScaleBars.active=!0,this.itemSprite.visible=!1,BFN.PhotoEditorCanvas.canvasToolsContainer.addChild(BFN.PhotoEditorCanvas.canvasTools),this.canvasModel.removeEventListener("CANVAS_SCALE_UPDATED",this.handleCanvasScaleUpdatedBind),this.canvasModel.canvasScaling=!1,this.canvasModel=null,this.canvas.canvas.visible=!0,this.canvas=null,this._itemWidth=0,this._itemHeight=0,this.backgroundTexture.resize(32,32),this.backgroundTexture.clear(),this.itemTexture.resize(32,32),this.itemTexture.clear(),this.isolatedTransformItem&&(this.reselectOnReleaseComplete&&this.isolatedTransformItem.selectItem(),this.isolatedTransformItem=null,BFN.TransformGuides.updateVisibility(),this.parent&&this.parent.removeChild(this)),this.reselectOnReleaseComplete=!0,BFN.ZoomManager.updateZoomRange(),BFN.ZoomRegion.updatePreview();try{this.altSourceTexture.destroyGC(!0)}catch(e){}UIToggler.toggleNavBar(!0);var t=()=>{UIToggler.toggleMainMenu(!BFN.TransformModel.selectedTransformItem)};if(document.getElementById("layer_edit_menu").setStyles({display:"none"}),this.releasedCallback){var i=this.releasedCallback;setTimeout(()=>{requestAnimationFrame(()=>{i(),t()})},50)}else t();this.isolatedCallback=null,this.releasedCallback=null,BFN.GlobalHistoryModel.updateGlobalHistoryButtons(),UIHistory.updateHistoryAvailable(),UIHistory.resetButton.disabled=!1,BFN.HiResTextManager.updateHighResText()},dg.prototype.handleShiftAnimatorUpdate=function(e){var t=this.shiftParamsEnd.x-this.shiftParamsStart.x,i=this.shiftParamsEnd.y-this.shiftParamsStart.y;this.backgroundSprite.x=this.shiftParamsStart.x+t*this.shiftAnimator.animationSinFactor,this.backgroundSprite.y=this.shiftParamsStart.y+i*this.shiftAnimator.animationSinFactor,this.itemSprite.x=-t*(1-this.shiftAnimator.animationSinFactor)*this.backgroundContainer.scale.x,this.itemSprite.y=-i*(1-this.shiftAnimator.animationSinFactor)*this.backgroundContainer.scale.y,BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).updateCheckerPanel()},dg.prototype.handleShiftAnimatorIncreaseComplete=function(e){this.usingAlternateMenu&&this.waitingToRelease&&this.releaseTransformItem()},Object.defineProperty(dg.prototype,"active",{get:function(){return!!this.isolatedTransformItem}}),Object.defineProperty(dg.prototype,"activeFactor",{get:function(){return this.isolationAnimator.animationSinFactor}}),Object.defineProperty(dg.prototype,"animating",{get:function(){return!(!this.isolationAnimator.animating&&!this.shiftAnimator.animating)}}),Object.defineProperty(dg.prototype,"itemWidth",{get:function(){var e=this._itemWidth;if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS){var t=BFN.PhotoEditorCanvasTools.currentTool;t&&t.hasOwnProperty("itemWidth")&&(e=t.itemWidth)}return e}}),Object.defineProperty(dg.prototype,"itemHeight",{get:function(){var e=this._itemHeight;if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS){var t=BFN.PhotoEditorCanvasTools.currentTool;t&&t.hasOwnProperty("itemHeight")&&(e=t.itemHeight)}return e}}),BFN.SingletonQueue.add(function(){BFN.TransformItemIsolator=new dg}),mg.prototype=Object.create(PIXI.Container.prototype),mg.prototype.init=function(){BeFunky.log("TransformItemBoundingBoxes Init"),this.initDefaultValues(),this.initStrokeRectanglePool()},mg.prototype.initDefaultValues=function(){this.interactive=!1,this.itemData=[],this._scale=1},mg.prototype.initStrokeRectanglePool=function(){this.strokeRectanglePool=new BFN.StrokeRectanglePool(!0,!0,2,!0,3018714605,3011608961,"dashed_selection_line_gray"),this.addChild(this.strokeRectanglePool)},mg.prototype.selectItems=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e){var t=this.parent,i=null,r=1;try{i=e.length?e[0].transformLayer.canvas.transformItemBoundingBoxesContainer:null}catch(e){}try{r=e.length?e[0].transformLayer.canvas.model.canvasScale:1}catch(e){}t!==i&&(i?i.addChild(this):t&&t.removeChild(this)),this.strokeRectanglePool.clear(),this.itemData.splice(0),e.forEach(e=>{this.itemData.push({item:e,strokeRectangle:this.strokeRectanglePool.add(e.x,e.y,e.itemContentW*e.scale.x,e.itemContentH*e.scale.y,e.rotation)})}),this.lineScale=r,BFN.MainUI.requestRender()}},mg.prototype.updateItems=function(){this.itemData.forEach(e=>{var t=e.item,i=e.strokeRectangle;this.strokeRectanglePool.setTransform(i,t.x,t.y,t.itemContentW*t.scale.x,t.itemContentH*t.scale.y,t.rotation)})},mg.prototype.clear=function(){this.selectItems()},Object.defineProperty(mg.prototype,"lineScale",{set:function(e){this.strokeRectanglePool.poolScale=e},get:function(){return this.strokeRectanglePool.poolScale}}),BFN.SingletonQueue.add(()=>{BFN.TransformItemBoundingBoxes=new mg}),BFN.TransformLayerEvents={ITEM_SELECTED:new Event("ITEM_SELECTED"),ITEMS_UPDATED:new Event("ITEMS_UPDATED"),ITEM_DISPLAY_UPDATED:new Event("ITEMS_UPDATED"),ITEM_DUPLICATED:new Event("ITEM_DUPLICATED")},pg.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),pg.prototype.init=function(){BeFunky.log("TransformLayer Init"),this.initDefaultValues(),this.initSelectionRect()},pg.prototype.initDefaultValues=function(){this.interactive=!0,this._scale=1,this.selectedItem=null,this.transformItems=[],this.frameWidth=0,this.frameHeight=0,this.nudgeDistance=1,this.altPressed=!1,this.dPressed=!1,this.usedBaseTextures=[],this.lastPressedItem=null,this.lastSelectedItem=null,this.lastClickedItem=null,this.handleGroupMouseMoveBind=this.handleGroupMouseMove.bind(this),this.handleGroupMouseUpBind=this.handleGroupMouseUp.bind(this),this.handleItemMouseOverBind=this.handleItemMouseOver.bind(this),this.handleItemMouseOutBind=this.handleItemMouseOut.bind(this),this.handleItemPressedBind=this.handleItemPressed.bind(this),this.handleItemReleasedBind=this.handleItemReleased.bind(this),this.handleItemDisplayUpdatedBind=this.handleItemDisplayUpdated.bind(this),this.handleGetSnapCoordinatesBind=this.handleGetSnapCoordinates.bind(this),this.handleSelectItemBind=this.handleSelectItem.bind(this),this.handleDeselectItemBind=this.handleDeselectItem.bind(this),this.handleRemoveItemBind=this.handleRemoveItem.bind(this),this.handleDestroyItemBind=this.handleDestroyItem.bind(this),this.handleDuplicateItemBind=this.handleDuplicateItem.bind(this),this.handleRegisterTransitionBind=this.handleRegisterTransition.bind(this),this.handleTransitionAppliedBind=this.handleTransitionApplied.bind(this),this.handleKeyDownBind=this.handleKeyDown.bind(this),this.handleAltKeyUpBind=this.handleAltKeyUp.bind(this)},pg.prototype.initSelectionRect=function(){this.selectionRect=new BFN.Rectangle,this.selectionOrigin=new PIXI.Point,this.canvasSelectionOrigin=new PIXI.Point,this.transformItemBounds=[],this.groupedTransformItems=[],this.retainedTransformItems=[],this.handleTransformItemGroupPressedBind=this.handleTransformItemGroupPressed.bind(this),this.selectionShape=new PIXI.Graphics,this.selectionShape.beginFill(11184895,.4),this.selectionShape.drawRect(0,0,100,100),this.selectionShape.endFill()},pg.prototype.addItem=function(e){e.initialFrameWidth=this.frameWidth,e.initialFrameHeight=this.frameHeight;var t=!!e.isDuplicate,i=null;e.hasOwnProperty("accurateBounds")&&(i=e.accurateBounds,delete e.accurateBounds);var r=new BFN.TransformItem(e,this.appViewState);if(e.projectItemVO&&-1!=e.projectItemVO.layerNum&&!t)r.layerName=e.projectItemVO.layerName,r.layerNum=e.projectItemVO.layerNum;else{r.layerName=null;var a=0;this.children.forEach(e=>{e.layerType==r.layerType&&(a=Math.max(a,e.layerNum))}),r.layerNum=a+1}if(e.projectItemVO&&e.projectItemVO.layerName&&t){var n=e=>{var t=e.split(" (");if(t.length>1){var i=t.pop().split(")");if(2===i.length){var r=parseInt(i.shift());if(!isNaN(r))return r}}return NaN},o=e.projectItemVO.layerName;if(!isNaN(n(o))){var s=o.split(" (");s.pop(),o=s.join(" (")}r.layerName=o;var l=[];this.children.forEach(e=>{if(e instanceof BFN.TransformItem&&e.projectItemVO&&e.projectItemVO.layerName&&e.projectItemVO.layerName.includes(o)){var t=n(e.projectItemVO.layerName);!isNaN(t)&&t>0&&!l.includes(t)&&l.push(t)}});for(var h=0;++h;)if(!l.includes(h)){r.layerName+=" ("+h+")";break}}e.hasOwnProperty("initialPosition")&&e.initialPosition?(r.x=e.initialPosition.x-this.frameWidth/2,r.y=e.initialPosition.y-this.frameHeight/2):e.hasOwnProperty("initialCenterPosition")&&e.initialCenterPosition?(r.x=e.initialCenterPosition.x-r.itemContentW*r.scale.x/2,r.y=e.initialCenterPosition.y-r.itemContentH*r.scale.y/2):(r.x=-r.hitArea.width/2*r.scale.x,r.y=-r.hitArea.height/2*r.scale.y),r.updateFrameTextureDisplay(),r.on("pointerover",this.handleItemMouseOverBind),r.on("pointerout",this.handleItemMouseOutBind),r.on("pointerdown",this.handleItemPressedBind),r.on("pointerup",this.handleItemReleasedBind),r.addEventListener(BFN.TransformItemEvents.ITEM_DISPLAY_UPDATED.type,this.handleItemDisplayUpdatedBind),r.addEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),r.addEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleItemPressedBind),r.addEventListener(BFN.TransformItemEvents.SELECT_ITEM.type,this.handleSelectItemBind),r.addEventListener(BFN.TransformItemEvents.DESELECT_ITEM.type,this.handleDeselectItemBind),r.addEventListener(BFN.TransformItemEvents.REMOVE_ITEM.type,this.handleRemoveItemBind),r.addEventListener(BFN.TransformItemEvents.DESTROY_ITEM.type,this.handleDestroyItemBind),r.addEventListener(BFN.TransformItemEvents.DUPLICATE_ITEM.type,this.handleDuplicateItemBind),r.addEventListener(BFN.TransformItemEvents.REGISTER_TRANSITION.type,this.handleRegisterTransitionBind),r.addEventListener(BFN.TransformItemEvents.TRANSITION_APPLIED.type,this.handleTransitionAppliedBind),this.transformItems.push(r),BFN.TransformItemGroup.duplicatingGroup&&(r.isGroupTransition=!0);var c="history_"+(t?"duplicate_":"new_");return"text"==r.type?c+="text":r.isGoodie?c+=r.basicShapeVO?"shape":"graphic":c+="image",r.createTransition(c,!0),r.isGroupTransition&&delete r.isGroupTransition,this.addChild(r),r.registerTransition(!1,!i),i&&(r.currentTransformItemStateVO.accurateBounds=i,r.transitionVO&&(r.transitionVO.startState.accurateBounds=i,r.transitionVO.endState.accurateBounds=i)),this.model.updateProjectVO(),r.updateAccurateBounds(),BFN.ProjectManager.transformItemsPending||this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED),BFN.TransformModel.addedTransformItem=r,BFN.TransformModel.selectItemOnAdd&&this.selectItem(r),r},pg.prototype.selectItem=function(e){this.debouncingHideMeasurements=!1,this.altPressed&&this.handleAltKeyUpBind(null,!0),this.clickItem(e)||(BFN.TransformModel.transformToolFrame&&BFN.TransformModel.transformToolFrame.active&&BFN.TransformModel.transformToolFrame.setup(null),e&&(this.transformItems.includes(e)||"group"==e.type)&&(this.handleSelectedItemTransition(e),this.selectedItem=e,window.addEventListener("keydown",this.handleKeyDownBind),this.dispatchEvent(BFN.TransformLayerEvents.ITEM_SELECTED)))},pg.prototype.deselectItem=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.textTransformItem=null,this.selectedItem){if((BFN.CursorScreen.cursorLock||BFN.CursorScreen.cursor)&&(BFN.CursorScreen.cursorLock=!1,BFN.CursorScreen.cursor=null),t&&"frame_texture"==this.selectedItem.type)return;if(this.selectedItem&&"frame_texture"==this.selectedItem.type){var i=this.selectedItem.transformTool.transformToolFrame;if(i.transformItem===this.selectedItem)return void i.setup(null)}this.lastDeselectedItem=this.selectedItem,this.selectedItem=null,window.removeEventListener("keydown",this.handleKeyDownBind),e&&this.resetTransformItemGroup(),this.lastPressedItem=null,this.lastSelectedItem=null,this.lastClickedItem=null,this.dispatchEvent(BFN.TransformLayerEvents.ITEM_SELECTED)}},pg.prototype.clickItem=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&"frame_texture"===e.type&&(t||e.selectedByMouse))if(this.awaitingDoubleClick&&this.awaitingDoubleClickTimeoutID){if(clearTimeout(this.awaitingDoubleClickTimeoutID),this.awaitingDoubleClick=!1,this.awaitingDoubleClickTimeoutID=null,e==this.lastPressedItem)return BFN.TransformModel.transformToolFrame.transformItem!==BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.transformToolFrame.setup(BFN.TransformModel.selectedTransformItem),!0}else this.awaitingDoubleClick||this.awaitingDoubleClickTimeoutID||(this.awaitingDoubleClick=!0,this.awaitingDoubleClickTimeoutID=setTimeout(()=>{this.awaitingDoubleClick=!1,this.awaitingDoubleClickTimeoutID=null},250));return!1},pg.prototype.handleSelectedItemTransition=function(e){var t=[...UIToggler.alternateMenu.querySelectorAll(".popover.active")];if(this.selectedItem&&this.selectedItem.type===e.type){var i=BFN.ColorPickerPanel.colorButton;i&&(BFN.ColorPickerPanel.strong=!0),t.forEach(e=>{e.originalStrongValue=e.strong,e.strong=!0}),setTimeout(()=>{i&&(BFN.ColorPickerPanel.strong=!1,BFN.ColorPickerPanel.setStyles({opacity:1,visibility:"visible"}),BFN.ColorPickerPanel.colorButton=null,requestAnimationFrame(()=>{i.click(),BFN.ColorPickerPanel.setStyles({opacity:"",visibility:""})})),t.forEach(e=>{e.strong=!!e.originalStrongValue,delete e.originalStrongValue})},20)}else t.forEach(e=>e.setStyles({display:"none"})),requestAnimationFrame(()=>{t.forEach(e=>e.setStyles({display:"block"}))})},pg.prototype.enableChildren=function(){this.interactiveChildren=!0},pg.prototype.disableChildren=function(){this.interactiveChildren=!1},pg.prototype.toggleHiResTextDisplay=function(e){for(var t=0;t<this.transformItems.length;t++){var i=this.transformItems[t];"text"===i.type&&i.toggleHiResText(!!e)}BFN.MainUI.requestRender()},pg.prototype.toggleItemScaleSmoothing=function(e){for(var t=0;t<this.transformItems.length;t++){this.transformItems[t].updateSmoothingScale(e?0:1)}},pg.prototype.setItemScaleMode=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=0;i<this.transformItems.length;i++){var r=this.transformItems[i];if(!t||-1!=t.indexOf(r.type))try{r.itemContent.texture.setScaleMode(0==r.rotation?e:PIXI.SCALE_MODES.LINEAR)}catch(e){}}BFN.MainUI.requestRender()},pg.prototype.removeItem=function(e){e&&(e==this.selectedItem&&"group"!=e.type&&this.deselectItem(),e==BFN.TransformModel.focusedTransformItem&&(BFN.TransformModel.focusedTransformItem=null),"group"==e.type&&e.selectedItems.length?(e.createTransition("history_remove_selection",!1),e._selectedItems.forEach(e=>{-1!=this.children.indexOf(e)&&-1!=this.transformItems.indexOf(e)&&(e.createTransition("history_remove_selection"),this.removeChild(e),e.registerTransition(!1,!1))}),e.registerTransition(!1,!1,!1),this.deselectItem(),this.model.updateProjectVO(),this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)):-1!=this.children.indexOf(e)&&-1!=this.transformItems.indexOf(e)&&(e.createTransition("text"==e.type?"history_delete_text":e.isGoodie?"history_delete_graphic":"history_delete_image"),this.removeChild(e),e.registerTransition(),this.model.updateProjectVO(),this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)))},pg.prototype.destroyItem=function(e){e&&(e==this.selectedItem&&this.deselectItem(),-1!=this.transformItems.indexOf(e)&&(-1!=this.children.indexOf(e)&&this.removeChild(e),this.transformItems.splice(this.transformItems.indexOf(e),1),e.off("pointerover",this.handleItemMouseOverBind),e.off("pointerout",this.handleItemMouseOutBind),e.off("pointerdown",this.handleItemPressedBind),e.off("pointerup",this.handleItemPressedBind),e.removeEventListener(BFN.TransformItemEvents.ITEM_DISPLAY_UPDATED.type,this.handleItemDisplayUpdatedBind),e.removeEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),e.removeEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleItemPressedBind),e.removeEventListener(BFN.TransformItemEvents.SELECT_ITEM.type,this.handleSelectItemBind),e.removeEventListener(BFN.TransformItemEvents.DESELECT_ITEM.type,this.handleDeselectItemBind),e.removeEventListener(BFN.TransformItemEvents.REMOVE_ITEM.type,this.handleRemoveItemBind),e.removeEventListener(BFN.TransformItemEvents.DESTROY_ITEM.type,this.handleDestroyItemBind),e.removeEventListener(BFN.TransformItemEvents.DUPLICATE_ITEM.type,this.handleDuplicateItemBind),e.destroy(this.usedBaseTextures),e=null,this.model.updateProjectVO(),this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)))},pg.prototype.removeAllItems=function(){var e=this.transformItems.length;for(BFN.TransformStateModel.startBulkTransition("removeall");--e>-1;)this.removeItem(this.transformItems[e]);BFN.TransformStateModel.stopBulkTransition()},pg.prototype.destroyAllItems=function(){this.usedBaseTextures=BFN.GlobalHistoryModel.getUsedBaseTextures(this.appViewState);for(var e=this.transformItems.length;--e>-1;)this.destroyItem(this.transformItems[e]);this.usedBaseTextures.splice(0)},pg.prototype.alignItem=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e.accurateBounds){var i=BFN.Util.getTransformItemBounds(e),r={x:0,y:0},a=null===t;switch(e.align){case"left":r.x=(a?-this.frameWidth/2:t)-(i.minX+e.accurateBounds.left);break;case"center":r.x=(a?0:t)-(i.centerX+e.accurateBounds.centerOffsetX);break;case"right":r.x=(a?this.frameWidth/2:t)-(i.maxX-e.accurateBounds.right);break;case"top":r.y=(a?-this.frameHeight/2:t)-(i.minY+e.accurateBounds.top);break;case"middle":r.y=(a?0:t)-(i.centerY+e.accurateBounds.centerOffsetY);break;case"bottom":r.y=(a?this.frameHeight/2:t)-(i.maxY-e.accurateBounds.bottom)}e.x+=r.x,e.y+=r.y,e.updateHiResTextBounds(),BFN.MainUI.requestRender()}},pg.prototype.getAveragePosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=0;return e.length&&(e.forEach(e=>{var r=BFN.Util.getTransformItemBounds(e);switch(t){case"left":i+=r.minX+e.accurateBounds.left;break;case"center":i+=r.centerX+e.accurateBounds.centerOffsetX;break;case"right":i+=r.maxX-e.accurateBounds.right;break;case"top":i+=r.minY+e.accurateBounds.top;break;case"middle":i+=r.centerY+e.accurateBounds.centerOffsetY;break;case"bottom":i+=r.maxY-e.accurateBounds.bottom}}),i/=e.length),i},pg.prototype.getItemSelectionBounds=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=null;return e&&e.length&&e.forEach(e=>{var i=BFN.Util.getTransformItemBounds(e);t||(t={}),t.left=t.hasOwnProperty("left")?Math.min(t.left,i.minX+e.accurateBounds.left):i.minX+e.accurateBounds.left,t.right=t.hasOwnProperty("right")?Math.max(t.right,i.maxX-e.accurateBounds.right):i.maxX-e.accurateBounds.right,t.top=t.hasOwnProperty("top")?Math.min(t.top,i.minY+e.accurateBounds.top):i.minY+e.accurateBounds.top,t.bottom=t.hasOwnProperty("bottom")?Math.max(t.bottom,i.maxY-e.accurateBounds.bottom):i.maxY-e.accurateBounds.bottom}),t?(t.center=(t.left+t.right)/2,t.middle=(t.top+t.bottom)/2):t={left:0,center:0,right:0,top:0,middle:0,bottom:0},t},pg.prototype.offsetAllItems=function(e,t){BeFunky.log("OFFSET ITEMS",e,t);var i=[];this.children.forEach(e=>{e instanceof BFN.TransformItem&&i.push(e)}),i.length&&(BFN.UndoManager.isBatchHistoryAction&&BFN.TransformStateModel.startBulkTransition("offset_items_".concat(BeFunky.randomString(10))),i.forEach(i=>{BFN.UndoManager.isBatchHistoryAction&&i.createTransition("offset_item"),i.x+=Math.round(e),i.y+=Math.round(t),BFN.UndoManager.isBatchHistoryAction&&i.registerTransition()}),BFN.TransformStateModel.stopBulkTransition(),BFN.MainUI.requestRender())},pg.prototype.hasText=function(){return this.children.some(e=>e instanceof BFN.TransformItem&&"text"===e.type)},pg.prototype.startGroupSelection=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];document.removeEventListener(BeFunky.pointerup,this.handleGroupMouseUpBind,!0),document.removeEventListener(BeFunky.pointermove,this.handleGroupMouseMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handleGroupMouseUpBind,!0),document.addEventListener(BeFunky.pointermove,this.handleGroupMouseMoveBind,!0),this.eraseSelection=t,this.retainedTransformItems.splice(0),e&&(BFN.TransformItemGroup.selectedItems.forEach(e=>{this.retainedTransformItems.push(e)}),i.forEach(e=>{this.retainedTransformItems.includes(e)||this.retainedTransformItems.push(e)})),this.transformItemBounds.splice(0);for(var r=0;r<this.transformItems.length;r++){var a=this.transformItems[r];this.children.includes(a)&&a.accurateBounds&&(a.updateItemBoundsData(),a.itemBoundsData&&this.transformItemBounds.push(a.itemBoundsData))}this.updateGroupSelection()},pg.prototype.updateGroupSelection=function(){var e=this.getPointerPosition(BFN.MainUI.pointerEvent),t=this.canvas.getPointerPosition(BFN.MainUI.pointerEvent);this.canvas.transformIndicatorContainer.children.includes(this.selectionShape)||(this.selectionOrigin.x=e.x,this.selectionOrigin.y=e.y,this.canvasSelectionOrigin.x=t.x,this.canvasSelectionOrigin.y=t.y,this.canvas.transformIndicatorContainer.addChild(this.selectionShape)),this.selectionRect.left=Math.floor(Math.min(this.selectionOrigin.x,e.x)),this.selectionRect.top=Math.floor(Math.min(this.selectionOrigin.y,e.y)),this.selectionRect.right=Math.ceil(Math.max(this.selectionOrigin.x,e.x)),this.selectionRect.bottom=Math.ceil(Math.max(this.selectionOrigin.y,e.y)),this.selectionShape.x=Math.floor(Math.min(this.canvasSelectionOrigin.x,t.x)),this.selectionShape.y=Math.floor(Math.min(this.canvasSelectionOrigin.y,t.y)),this.selectionShape.scale.x=(Math.ceil(Math.max(this.canvasSelectionOrigin.x,t.x))-this.selectionShape.x)/100,this.selectionShape.scale.y=(Math.ceil(Math.max(this.canvasSelectionOrigin.y,t.y))-this.selectionShape.y)/100;var i=[BFN.MainUI.toLocal(new PIXI.Point(this.selectionRect.left,this.selectionRect.top),this),BFN.MainUI.toLocal(new PIXI.Point(this.selectionRect.right,this.selectionRect.top),this),BFN.MainUI.toLocal(new PIXI.Point(this.selectionRect.right,this.selectionRect.bottom),this),BFN.MainUI.toLocal(new PIXI.Point(this.selectionRect.left,this.selectionRect.bottom),this)];if(this.groupedTransformItems.splice(0),this.retainedTransformItems.forEach(e=>{this.groupedTransformItems.push(e)}),this.eraseSelection){if(this.groupedTransformItems.length)for(var r=this.transformItemBounds.length;--r>-1;){var a=this.transformItemBounds[r],n=this.groupedTransformItems.indexOf(a.item);-1!=n&&BFN.Util.polygonHitTest(i,a.globalPolygon)&&this.groupedTransformItems.splice(n,1)}}else this.transformItemBounds.forEach(e=>{!this.retainedTransformItems.includes(e.item)&&BFN.Util.polygonHitTest(i,e.globalPolygon)&&this.groupedTransformItems.push(e.item)});this.groupedTransformItems.length?(this.children.includes(BFN.TransformItemGroup)||(BFN.TransformItemGroup.transformLayer=this,this.addChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.canvasScale=this._scale):this.children.includes(BFN.TransformItemGroup)&&this.removeChild(BFN.TransformItemGroup),BFN.TransformItemGroup.updateSelectedItems(this.groupedTransformItems),BFN.MainUI.requestRender()},pg.prototype.stopGroupSelection=function(){document.removeEventListener(BeFunky.pointerup,this.handleGroupMouseUpBind,!0),document.removeEventListener(BeFunky.pointermove,this.handleGroupMouseMoveBind,!0),this.canvas.transformIndicatorContainer.children.includes(this.selectionShape)&&this.canvas.transformIndicatorContainer.removeChild(this.selectionShape),this.groupedTransformItems.length&&(1==this.groupedTransformItems.length?(this.groupedTransformItems[0].selectItem(),this.resetTransformItemGroup()):this.updateTransformItemGroup()),BFN.MainUI.requestRender()},pg.prototype.updateTransformItemGroup=function(){if(BFN.TransformItemGroup.selectedItems.length){1==BFN.TransformItemGroup.scale.x&&0==BFN.TransformItemGroup.rotation&&BFN.TransformItemGroup.updateItemGroupData();BFN.TransformModel.selectedTransformItem,BFN.TransformItemGroup;BFN.TransformItemGroup.updateContentDimensions(),BFN.TransformItemGroup.updateAccurateBounds(),BFN.TransformItemGroup.removeEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),BFN.TransformItemGroup.addEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),BFN.TransformItemGroup.remainingItem=null,BFN.TransformItemGroup.selectedByMouse=!1,this.selectItem(BFN.TransformItemGroup),this.transformTool.updateDisplay(),BFN.TransformModel.selectedGroupType!=BFN.TransformItemGroup.groupType&&(BFN.TransformModel.selectedTransformItem=BFN.TransformItemGroup),BFN.TransformModel.updateGroupMenu(),"text"==BFN.TransformItemGroup.groupType&&BFN.FabricManager.updateTextMenu(BFN.TransformItemGroup.getTextGroupStyleData()),BFN.TransformItemGroup.off("pointerdown",this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.on("pointerdown",this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.removeEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.addEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleTransformItemGroupPressedBind)}this.textTransformItem=null},pg.prototype.resetTransformItemGroup=function(){this.groupedTransformItems.splice(0),BFN.TransformItemGroup.off("pointerdown",this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.removeEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.clearItems(),this.selectedItem==BFN.TransformItemGroup&&this.deselectItem(),this.children.includes(BFN.TransformItemGroup)&&(BFN.TransformItemGroup.removeEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),this.removeChild(BFN.TransformItemGroup))},pg.prototype.handleGroupMouseMove=function(e){this.updateGroupSelection()},pg.prototype.handleGroupMouseUp=function(e){this.stopGroupSelection()},pg.prototype.handleTransformItemGroupPressed=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];BFN.ZoomRegion.hide();var i,r,a=e.data.originalEvent;if(2===a.button||BFN.TransformItemGroup.longPressOccurred)return i=(()=>{for(var e=BFN.GroupManager.getCommonGroupVOsFromItemIDs(BFN.TransformLayerManager.selectedItemIDs),t=BFN.GroupManager.getSectionGroupVOs(),a=t.length;--a>-1;){var n=t[a];e.includes(n)&&t.splice(a,1)}if(t.length){BFN.TransformItemGroup.contextMenu.showButton("add_to_group");var o={};t.forEach(e=>{o[e.name]={onClick:()=>{BFN.GroupManager.addItemsToGroup(e.id,BFN.TransformLayerManager.selectedItemIDs),i(),r()},translate:!1}}),BFN.TransformItemGroup.contextMenu.updateChildren("add_to_group",o)}else BFN.TransformItemGroup.contextMenu.hideButton("add_to_group")}),r=(()=>{var e=BFN.GroupManager.getGroupVOsFromItemIDs(BFN.TransformLayerManager.selectedItemIDs);if(e.length){BFN.TransformItemGroup.contextMenu.showButton("remove_from_group");var t={};e.forEach(e=>{t[e.name]={onClick:()=>{BFN.GroupManager.removeItemsFromGroup(e.id,BFN.TransformLayerManager.selectedItemIDs),i(),r()},translate:!1}}),BFN.TransformItemGroup.contextMenu.updateChildren("remove_from_group",t)}else BFN.TransformItemGroup.contextMenu.hideButton("remove_from_group")}),i(),r(),BFN.TransformItemGroup.contextMenu.show(a.pageX-16,a.pageY-16),BFN.TransformItemGroup.selectedByMouse=!1,this.selectItem(BFN.TransformItemGroup),void e.stopPropagation();if(this.selectedItem===BFN.TransformItemGroup&&!t){for(var n=BFN.MainUI.getPointerPosition(BFN.MainUI.pointerEvent),o=null,s=0;s<BFN.TransformItemGroup.selectedItems.length;s++){var l=BFN.TransformItemGroup.selectedItems[s],h=l.globalPolygon;l.parent&&BFN.Util.polygonHitTest([n],h)&&(!o||o&&l.parent.children.indexOf(l)>o.parent.children.indexOf(o))&&(o=l)}BFN.TransformItemGroup.subSelectedItem=o}BFN.TransformItemGroup.selectedByMouse=!0,e.externalPress&&(BFN.TransformItemGroup.selectedByMouse=!1),this.selectItem(BFN.TransformItemGroup),e.stopPropagation()},pg.prototype.handleItemMouseOver=function(e){var t=e.currentTarget;setTimeout(()=>{BFN.TransformModel.awaitingDrop&&("text"===t.type&&BFN.FabricManager.isDefaultText(t.iText.text)||(BFN.TransformModel.focusedTransformItem=t))},0)},pg.prototype.handleItemMouseOut=function(e){BFN.TransformModel.focusedTransformItem=null},pg.prototype.handleItemPressed=function(e){BFN.ZoomRegion.hide();var t,i,r,a=e.target||e.targetItem,n=e.data.originalEvent,o=e=>{this.lastPressedItem=e,this.lastSelectedItem=e},s=2===n.button||a.longPressOccurred,l=n.ctrlKey||n.metaKey,h=n.altKey;if(l||h){if(this.selectedItem==BFN.TransformItemGroup){if(h)BFN.TransformItemGroup.removeGroupItem(a);else BFN.TransformItemGroup.toggleGroupItem(a)&&o(a);return this.transformTool.updateDisplay(),void e.stopPropagation()}return this.selectedItem?(this.selectedItem==a?(this.deselectItem(),this.textTransformItem=null):h||(this.children.includes(BFN.TransformItemGroup)||(BFN.TransformItemGroup.transformLayer=this,this.addChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.canvasScale=this._scale,BFN.TransformItemGroup.addGroupItems([this.selectedItem,a]),o(a),this.updateTransformItemGroup()),void e.stopPropagation()):(a.selectedByMouse=!1,this.selectItem(a),o(a),void e.stopPropagation())}if(this.resetTransformItemGroup(),!(s||l||h||a===this.selectedItem||e.externalPress)){var c=[];this.children.forEach(e=>{e instanceof BFN.TransformItem&&e.projectItemVO&&!c.includes(e.projectItemVO.itemID)&&c.push(e.projectItemVO.itemID)});var u=BFN.GroupManager.getGroupVOsFromItemIDs([a.itemID]),d=[];if(u.forEach(e=>{e.itemIDs.forEach(e=>{!d.includes(e)&&c.includes(e)&&d.push(e)})}),d.length>1)return BFN.GroupManager.selectGroups(u.map(e=>e.id),!0),void this.handleTransformItemGroupPressed(e,!0)}if(s)return i=(()=>{for(var e=BFN.GroupManager.getGroupVOsFromItemIDs([a.itemID]),n=BFN.GroupManager.getSectionGroupVOs(),o=n.length;--o>-1;){var s=n[o];e.includes(s)&&n.splice(o,1)}if(n.length){BFN.TransformModel.contextMenu.showButton("add_to_group");var l={};n.forEach(e=>{l[e.name]={onClick:()=>{BFN.GroupManager.addItemsToGroup(e.id,[a.itemID]),t(),i(),r()},translate:!1}}),BFN.TransformModel.contextMenu.updateChildren("add_to_group",l)}else BFN.TransformModel.contextMenu.hideButton("add_to_group")}),r=(()=>{var e=BFN.GroupManager.getGroupVOsFromItemIDs([a.itemID]);if(e.length){BFN.TransformModel.contextMenu.showButton("remove_from_group");var n={};e.forEach(e=>{n[e.name]={onClick:()=>{BFN.GroupManager.removeItemsFromGroup(e.id,[a.itemID]),t(),i(),r()},translate:!1}}),BFN.TransformModel.contextMenu.updateChildren("remove_from_group",n)}else BFN.TransformModel.contextMenu.hideButton("remove_from_group")}),(t=(()=>{var e=BFN.GroupManager.getGroupVOsFromItemIDs([a.itemID]);if(e.length){BFN.TransformModel.contextMenu.showButton("select_group");var t={};e.forEach(e=>{t[e.name]={onClick:t=>{var i=!(!t.metaKey&&!t.ctrlKey);BFN.GroupManager.selectGroups([e.id],!1,i)},translate:!1}}),BFN.TransformModel.contextMenu.updateChildren("select_group",t)}else BFN.TransformModel.contextMenu.hideButton("select_group")}))(),i(),r(),BFN.TransformModel.contextMenu.toggleButton("canvas","frame_texture"===a.type),BFN.TransformModel.contextMenu.show(n.pageX-16,n.pageY-16),a.selectedByMouse=!1,this.selectItem(a),o(a),void e.stopPropagation();if("frame_texture"===a.type&&n.shiftKey)a.dragFrame(e);else{a.selectedByMouse=!0;var m=!1;a===this.selectedItem&&(m=!0),e.externalPress&&(a.selectedByMouse=!1),this.selectItem(a),o(a),a.itemMoved=!1,"text"===a.type&&m?this.textTransformItem=a:this.textTransformItem=null,e.stopPropagation()}},pg.prototype.handleItemReleased=function(e){if(this.textTransformItem&&"text"==this.textTransformItem.type&&!this.textTransformItem.itemMoved&&!this.textTransformItem.preventEditText&&![BFN.TransformModel.focusedTransformItem,BFN.TransformModel.targetTransformItem].includes(this.textTransformItem)){var t=this.textTransformItem?this.textTransformItem:null;this.deselectItem(),t&&(BFN.FabricManager.editText(t,e.data.global.x,e.data.global.y),BFN.TransformModel.selectedTransformItemText=t)}},pg.prototype.handleItemDisplayUpdated=function(e){var t=e.dispatcher;t.align&&this.alignItem(t),this.dispatchEvent(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED)},pg.prototype.handleGetSnapCoordinates=function(e){var t=e.dispatcher;if(t.snapCoordinates.splice(0),BFN.TransformModel.snappingEnabled){var i=new BFN.Rectangle(-this.frameWidth/2,-this.frameHeight/2,this.frameWidth,this.frameHeight);t.snapCoordinates.push({id:"canvas",bounds:i,position:"horizontal",value:i.left}),t.snapCoordinates.push({id:"canvas",bounds:i,position:"horizontal",value:i.center}),t.snapCoordinates.push({id:"canvas",bounds:i,position:"horizontal",value:i.right}),t.snapCoordinates.push({id:"canvas",bounds:i,position:"vertical",value:i.top}),t.snapCoordinates.push({id:"canvas",bounds:i,position:"vertical",value:i.middle}),t.snapCoordinates.push({id:"canvas",bounds:i,position:"vertical",value:i.bottom}),BFN.TransformGuides&&BFN.TransformGuides.visible&&BFN.TransformGuides.transformGuideData&&BFN.TransformGuides.transformGuideData.length&&BFN.TransformGuides.transformGuideData.forEach(e=>{t.snapCoordinates.push({id:"guide",bounds:i,position:"x"===e.axis?"horizontal":"vertical",value:e.value})});var r=[],a=this.children,n="group"==t.type?t.selectedItems:[];this.transformItems.forEach(e=>{if(e&&t!=e&&a.includes(e)&&e.accurateBounds&&!n.includes(e)){var i=BFN.Util.getTransformItemBounds(e),o=new BFN.Rectangle(i.minX+e.accurateBounds.minX,i.minY+e.accurateBounds.minY,e.accurateBounds.width,e.accurateBounds.height);t.snapCoordinates.push({bounds:o,position:"horizontal",value:o.left}),t.snapCoordinates.push({bounds:o,position:"horizontal",value:o.center}),t.snapCoordinates.push({bounds:o,position:"horizontal",value:o.right}),t.snapCoordinates.push({bounds:o,position:"vertical",value:o.top}),t.snapCoordinates.push({bounds:o,position:"vertical",value:o.middle}),t.snapCoordinates.push({bounds:o,position:"vertical",value:o.bottom}),r.push(o)}}),t.otherItemAccurateBoundsList.splice(0),t.otherItemAccurateBoundsList.push(...r);for(var o=t.snapGapRects={},s=0;s<r.length;s++)for(var l=r[s],h=0;h<r.length;h++){var c=r[h];if(c!=l){var u=c.neighbors(l);if(u&&["right","bottom"].includes(u.side)){for(var d=!0,m=r.length;--m>-1&&d;){var p=r[m];if(![l,c].includes(p)&&p.intersects(u.intersectRect,1)&&!p.containsRect(u.intersectRect))switch(u.direction){case"horizontal":d=p.left<u.intersectRect.left&&p.right>u.intersectRect.right;break;case"vertical":d=p.top<u.intersectRect.top&&p.bottom>u.intersectRect.bottom}}if(d){var g=Math.round(u.distance);o.hasOwnProperty(u.direction)||(o[u.direction]={}),o[u.direction].hasOwnProperty(g)||(o[u.direction][g]=[]),o[u.direction][g].push(u.gapRect)}}}}for(var f in o)for(var v in o[f])for(var y=o[f][v],x=y.length;--x>-1;)for(var _=y[x],I=x;--I>-1;){var T=y[I];if(_.intersects(T))switch(f){case"horizontal":Math.abs(_.left-T.left)<1&&Math.abs(_.right-T.right)<1&&(T.top=Math.min(T.top,_.top),T.bottom=Math.max(T.bottom,_.bottom),y.splice(x,1));break;case"vertical":Math.abs(_.top-T.top)<1&&Math.abs(_.bottom-T.bottom)<1&&(T.left=Math.min(T.left,_.left),T.right=Math.max(T.right,_.right),y.splice(x,1))}}}},pg.prototype.handleSelectItem=function(e){var t=e.dispatcher;t.selectedByMouse=!1,this.selectItem(t)},pg.prototype.handleDeselectItem=function(e){this.deselectItem()},pg.prototype.handleRemoveItem=function(e){this.removeItem(e.dispatcher)},pg.prototype.handleDestroyItem=function(e){this.destroyItem(e.dispatcher)},pg.prototype.handleDuplicateItem=function(e){var t=e.dispatcher,i=new BFN.TransformItemStateVO,r={isDuplicate:!0,sourceTransformItem:t,projectItemVO:t.projectItemVO};for(var a in t.itemObject)r[a]=t.itemObject[a];if(r.hasOwnProperty("projectItemVO")){var n=new BFN.ProjectItemVO;Object.assign(n,r.projectItemVO),"text"==t.type&&(n.labelTextStyles=JSON.parse(JSON.stringify(r.projectItemVO.labelTextStyles))),r.projectItemVO=n}r.hasOwnProperty("basicShapeVO")&&(r.basicShapeVO=r.basicShapeVO.clone(),r.hasOwnProperty("maskTexture")&&(r.maskTexture=PIXI.RenderTexture.create(32,32))),t.thumbImage&&t.thumbImage.src&&(r.thumbImage=new Image,r.thumbImage.src=t.thumbImage.src),t.accurateBounds&&(r.accurateBounds=Object.assign({},t.accurateBounds));var o=this.addItem(r),s=o.getTransition();r.thumbImage&&(o.thumbImage=r.thumbImage,delete r.thumbImage),BFN.TransformItemGroup.duplicatingGroup||(o.deselectItem(),t.selectItem()),t.updateStateVO(i),i.x+=10,i.y+=10,i.zIndex+=1,i.imageTexture=null,t.accurateBounds&&(i.accurateBounds=Object.assign({},t.accurateBounds)),o.ignoreAccurateBounds=!1;var l=()=>{o.removeEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,l),o.updateStateVO(s.endState),o.updateProjectItemVO(),o.ignoreAccurateBounds=!1,BFN.TransformItemGroup.duplicatingGroup||(o.deselectItem(),o.selectItem()),BFN.TransformLayerEvents.ITEM_DUPLICATED.duplicatedItem=o,this.dispatchEvent(BFN.TransformLayerEvents.ITEM_DUPLICATED),delete BFN.TransformLayerEvents.ITEM_DUPLICATED.duplicatedItem};"text"==o.type?(o.addEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,l),BFN.MainUI.renderCanvas(),o.applyTransformItemState(i),BFN.MainUI.renderCanvas()):(o.applyTransformItemState(i),l())},pg.prototype.handleRegisterTransition=function(e){BFN.TransformStateModel.addTransition(e.dispatcher.getTransition()),this.model.updateProjectVO()},pg.prototype.handleTransitionApplied=function(e){-1!=this.children.indexOf(e.dispatcher)&&this.dispatchEvent(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED),this.deselectItem(),BFN.ProjectManager.transformItemsPending||this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)},pg.prototype.handleKeyDown=function(e){if(this.debounceHideMeasurements||(this.debounceHideMeasurements=BeFunky.debounce(()=>{this.debouncingHideMeasurements&&(this.debouncingHideMeasurements=!1,this.transformTool.item&&!this.altPressed&&this.transformTool.fadeAnimator.increase())},500)),!BeFunky.isModalOpen()&&(!BFN.TransformModel.transformToolFrame||!BFN.TransformModel.transformToolFrame.active||27==e.keyCode)&&this.appViewState==BFN.AppModel.viewState&&this.selectedItem&&!this.selectedItem.transforming&&!BFN.FabricManager.styleUpdating&&!BFN.FabricManager.styleChangeRequested&&!BFN.isSortableListDragActive&&!BeFunky.isTextBoxFocused()){var t=t=>{var i="group"==this.selectedItem.type;this.selectedItem.createTransition(i?"history_nudge_selection":"history_nudge"),t(),this.transformTool.showItemMeasurements(),this.transformTool.fadeAnimator.decrease(),this.debouncingHideMeasurements=!0,this.debounceHideMeasurements(),i&&this.selectedItem.updateGroupTransform(),this.selectedItem.registerTransition(!0,!1),this.dispatchEvent(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED),e.preventDefault()};switch(e.keyCode){case 18:!this.altPressed&&BFN.TransformModel.showMeasurements&&(this.altPressed=!0,window.addEventListener("keyup",this.handleAltKeyUpBind),this.transformTool.showItemMeasurements(),this.transformTool.fadeAnimator.decrease());break;case 37:t(()=>{this.selectedItem.x-=this.nudgeDistance/this._scale});break;case 38:t(()=>{this.selectedItem.y-=this.nudgeDistance/this._scale});break;case 39:t(()=>{this.selectedItem.x+=this.nudgeDistance/this._scale});break;case 40:t(()=>{this.selectedItem.y+=this.nudgeDistance/this._scale});break;case 8:case 46:"group"==this.selectedItem.type?this.removeItem(this.selectedItem):this.selectedItem.removeItem(),e.preventDefault();break;case 68:this.dPressed||(this.dPressed=!0,setTimeout(()=>{this.dPressed=!1},200),"group"!=this.selectedItem.type||this.selectedItem.duplicatingGroup?this.selectedItem.duplicateItem():this.selectedItem.duplicateGroup()),(e.metaKey||e.ctrlKey)&&e.preventDefault();break;case 27:this.deselectItem()}}},pg.prototype.handleAltKeyUp=function(e){(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||18===e.keyCode)&&(this.altPressed=!1,window.removeEventListener("keyup",this.handleAltKeyUpBind),this.transformTool.item&&!this.debouncingHideMeasurements&&this.transformTool.fadeAnimator.increase())},Object.defineProperty(pg.prototype,"itemsExist",{get(){for(var e=0;e<this.transformItems.length;e++)if(this.children.includes(this.transformItems[e]))return!0;return!1}}),Object.defineProperty(pg.prototype,"canvasScale",{set(e){this._scale=e,this.children.includes(BFN.TransformItemGroup)&&(BFN.TransformItemGroup.canvasScale=e),(this.altPressed||this.debouncingHideMeasurements)&&(this.altPressed&&this.handleAltKeyUpBind(null,!0),this.transformTool.transformSnapGuides.hideLines())},get(){return this._scale}}),Object.defineProperty(pg.prototype,"layerBounds",{get(){var e=null;return this.transformItems.forEach(t=>{this.children.includes(t)&&t.visible&&t.renderable&&("text"===t.type?t.localTextPolygon:t.localPolygon).forEach(t=>{e?(e.left=Math.min(e.left,t.x),e.right=Math.max(e.right,t.x),e.top=Math.min(e.top,t.y),e.bottom=Math.max(e.bottom,t.y)):e=new BFN.Rectangle(t.x,t.y)})}),e}}),BFN.TransformLayer=pg,gg.prototype=Object.create(PIXI.Container.prototype),gg.prototype.init=function(){BeFunky.log("TransformToolSnapGuides Init"),this.initDefaultValues(),this.initStrokeLines(),this.initGraphics(),this.initRulerLabels(),this.hideLines()},gg.prototype.initDefaultValues=function(){this._centerX=0,this._centerY=0,this._width=100,this._height=100,this._scale=1,this.bgFillFilter=new BFN.filters.BackgroundFillFilter,this.bgFillFilter.resolution=BFN.Stage.resolution},gg.prototype.initStrokeLines=function(){this.strokeLinesH=["top","middle","bottom"],this.strokeLinesV=["left","center","right"],this.strokeLineSides=[...this.strokeLinesH,...this.strokeLinesV],this.strokeLines={},this.strokeLineSides.forEach(e=>{this.strokeLines[e]=this.createStrokeLine(e)})},gg.prototype.initGraphics=function(){this.graphics=new PIXI.Graphics,this.addChild(this.graphics)},gg.prototype.initRulerLabels=function(){this.allRulerLabels=[],this.availableRulerLabels=[],this.usedRulerLabels=[],this.rulerLabelData=[],this.rulerLabelContainer=new PIXI.Container,this.addChild(this.rulerLabelContainer)},gg.prototype.setCenter=function(e,t){this._centerX=e,this._centerY=t,this.updateDisplay()},gg.prototype.setDimensions=function(e,t){this._width=Math.abs(e),this._height=Math.abs(t),this.updateDisplay()},gg.prototype.updateDisplay=function(){this.strokeLines.top.y=this._centerY-this._height/2,this.strokeLines.middle.y=this._centerY,this.strokeLines.bottom.y=this._centerY+this._height/2,this.strokeLines.left.x=this._centerX-this._width/2,this.strokeLines.center.x=this._centerX,this.strokeLines.right.x=this._centerX+this._width/2,BFN.MainUI&&BFN.MainUI.requestRender()},gg.prototype.showLine=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.strokeLines.hasOwnProperty(e)){if(this.mainUIItemBounds=null,r){var a=BFN.MainUI.toLocal(new PIXI.Point(r.x,r.y)),n=BFN.MainUI.toLocal(new PIXI.Point(r.x+r.width,r.y+r.height));this.mainUIItemBounds=new BFN.Rectangle(a.x,a.y,n.x-a.x,n.y-a.y)}var o=[];t&&t.forEach(t=>{if(t&&t.startPoint&&t.endPoint){var i=this.strokeLines[e],r={};this.strokeLinesH.includes(e)?(r.start=Math.round(i.toLocal(t.startPoint).x*this._scale),r.end=Math.round(i.toLocal(t.endPoint).x*this._scale)):this.strokeLinesV.includes(e)&&(r.start=Math.round(i.toLocal(t.startPoint).x*this._scale),r.end=Math.round(i.toLocal(t.endPoint).x*this._scale)),o.push(r)}});var s=[];i&&i.forEach(t=>{if(t&&t.startPoint&&t.endPoint){var i=this.strokeLines[e],r={};this.strokeLinesH.includes(e)?(r.start=Math.round(i.toLocal(t.startPoint).x*this._scale),r.end=Math.round(i.toLocal(t.endPoint).x*this._scale),t.endPoint.x-t.startPoint.x>0&&this.rulerLabelData.push({line:e,value:Math.round((t.endPoint.x-t.startPoint.x)/this._scale),x:(t.startPoint.x+t.endPoint.x)/2})):this.strokeLinesV.includes(e)&&(r.start=Math.round(i.toLocal(t.startPoint).x*this._scale),r.end=Math.round(i.toLocal(t.endPoint).x*this._scale),r.end-r.start>0&&this.rulerLabelData.push({line:e,value:Math.round((t.endPoint.y-t.startPoint.y)/this._scale),y:(t.startPoint.y+t.endPoint.y)/2})),s.push(r)}});var l=this.strokeLines[e];l.showMaskedLines(o),l.showRulers(s),l.visible=!0,BFN.MainUI&&BFN.MainUI.requestRender()}},gg.prototype.hideLines=function(){this.strokeLineSides.forEach(e=>{this.strokeLines[e].visible=!1}),this.graphics.clear(),this.hideRulerLabels(),BFN.MainUI&&BFN.MainUI.requestRender()},gg.prototype.showRulerLabel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null;this.availableRulerLabels.length?((a=this.availableRulerLabels.shift()).text=e,a.visible=!0):((a=new PIXI.Text(e,{fontFamily:"Times New Roman",fontSize:13,fill:16777215,align:"center",padding:3})).filters=[this.bgFillFilter],a.texture.setScaleMode(PIXI.SCALE_MODES.NEAREST),this.allRulerLabels.push(a),this.rulerLabelContainer.addChild(a));switch(a.x=t,a.y=i,a.anchor.x=a.anchor.y=.5,r){case"vertical":if(this.mainUIItemBounds){var n=BFN.MainUI.toLocal(new PIXI.Point(a.x,a.y),this.rulerLabelContainer);n.y<=this.mainUIItemBounds.middle?(n.y=Math.max(a.texture.height*a.scale.y/2+0,n.y),n.y=Math.min(this.mainUIItemBounds.top-a.texture.height*a.scale.y/2-0,n.y)):n.y>=this.mainUIItemBounds.middle&&(n.y=Math.min(BFN.StageModel.stageH-a.texture.height*a.scale.y/2-0,n.y),n.y=Math.max(this.mainUIItemBounds.bottom+a.texture.height*a.scale.y/2+0,n.y));var o=this.rulerLabelContainer.toLocal(n,BFN.MainUI);a.y=o.y}break;case"horizontal":if(this.mainUIItemBounds){var s=BFN.MainUI.toLocal(new PIXI.Point(a.x,a.y),this.rulerLabelContainer);s.x<=this.mainUIItemBounds.center?(s.x=Math.max(a.texture.width*a.scale.x/2+0,s.x),s.x=Math.min(this.mainUIItemBounds.left-a.texture.width*a.scale.x/2-0,s.x)):s.x>=this.mainUIItemBounds.center&&(s.x=Math.min(BFN.StageModel.stageW-a.texture.width*a.scale.x/2-0,s.x),s.x=Math.max(this.mainUIItemBounds.right+a.texture.width*a.scale.x/2+0,s.x));var l=this.rulerLabelContainer.toLocal(s,BFN.MainUI);a.x=l.x}}this.usedRulerLabels.push(a)},gg.prototype.showRulerLabels=function(){this.rulerLabelData.forEach(e=>{var t=this.strokeLines[e.line];e.hasOwnProperty("x")||(e.x=this.rulerLabelContainer.toLocal(new PIXI.Point(t.x,0),this).x,e.y=this.rulerLabelContainer.toLocal(new PIXI.Point(0,e.y)).y,e.lineDirection="vertical"),e.hasOwnProperty("y")||(e.x=this.rulerLabelContainer.toLocal(new PIXI.Point(e.x)).x,e.y=this.rulerLabelContainer.toLocal(new PIXI.Point(0,t.y),this).y,e.lineDirection="horizontal"),this.showRulerLabel(e.value,e.x,e.y,e.lineDirection)})},gg.prototype.hideRulerLabels=function(){this.availableRulerLabels.splice(0),this.availableRulerLabels.push(...this.allRulerLabels),this.usedRulerLabels.forEach(e=>{e.visible=!1}),this.usedRulerLabels.splice(0),this.rulerLabelData.splice(0)},gg.prototype.createStrokeLine=function(e){if(this.strokeLineSides.includes(e)){var t=4*BFN.maxImageSize,i=new BFN.StrokeLine(!1,!0,1,!1,4280344831,4278190080,"transform_tool_snap_guide");return this.strokeLinesH.includes(e)&&(i.x=-t/2),this.strokeLinesV.includes(e)&&(i.y=-t/2),i.length=t,i.rotation=this.strokeLinesV.includes(e)?Math.PI/2:0,i.convertToMasked(),i.convertToRuler(),this.addChild(i),i}},Object.defineProperty(gg.prototype,"scale",{set:function(e){this._scale=e,this.strokeLineSides.forEach(e=>{this.strokeLines[e].scale=this._scale}),this.graphics.scale.x=this.graphics.scale.y=1/this._scale,this.rulerLabelContainer.scale.x=this.rulerLabelContainer.scale.y=1/this._scale,BFN.MainUI.requestRender()},get:function(){return this._scale}}),BFN.TransformToolSnapGuides=gg,fg.prototype=Object.create(PIXI.Sprite.prototype),fg.prototype.init=function(){BeFunky.log("TransformTool Init"),this.initDefaultValues(),this.initTransformSnapGuides(),this.initTransformTool(),this.initTransformToolGizmo(),this.initHandleTextures(),this.initTextHandles(),this.initScaleHandles(),this.initRotationHandle(),this.initDraggers(),this.initFadeAnimator(),this.initTransformToolFrame()},fg.prototype.initDefaultValues=function(){this.PIx2=2*Math.PI,this.PId2=Math.PI/2,this.rotationHandleOffset=25,this.snapSections=24,this.snapDistance=2,this.snapSectionBeta=this.PIx2/this.snapSections,this.screenPixelSnapThreshold=6,this.itemWidth=0,this.itemHeight=0,this._scale=1,this.frameWidth=0,this.frameHeight=0,this.minSize=1,this.minSizeText=10,this.minSizeFrame=10,this.currentTextHandle=null,this.currentScaleHandle=null,this.textAnchor=new PIXI.Point,this.textControl=new PIXI.Point,this.scaleAnchor=new PIXI.Point,this.scaleControl=new PIXI.Point,this.deltaPoint=new PIXI.Point,this.anchorCenter=!1,this.hBeta=0,this.snapDistanceTransform=0,this.snapGuidesCleared=!0,this.otherItemAccurateBounds=[],this.gizmoPadding=10,this.gizmoPaddingDiagonal=Math.sqrt(2*Math.pow(this.gizmoPadding,2)),this.itemZIndex=0,this.itemBlendMode=BFN.CONST.BLEND_MODES.NORMAL,this.iTextData=null,this.itemData=null,this.drawSnapHelpers=!1,this.handleItemAccurateBoundsUpdatedBind=this.handleItemAccurateBoundsUpdated.bind(this)},fg.prototype.initTransformSnapGuides=function(){this.transformSnapGuidesContainer=new PIXI.Container,this.addChild(this.transformSnapGuidesContainer)},fg.prototype.initTransformTool=function(){this.transformTool=new PIXI.Container,this.transformTool.interactive=!0,this.addChild(this.transformTool)},fg.prototype.initTransformToolGizmo=function(){this.transformGizmo=new PIXI.Container,this.transformGizmo.interactive=!1,this.transformGizmo.interactiveChildren=!1,this.transformTool.addChild(this.transformGizmo),this.transformGizmoOutline=new BFN.StrokeRectangle(!0,!0,2,!0,4293783021,4282154954,"dashed_transform_line"),this.transformGizmoOutline.setDimensions(this.itemWidth,this.itemHeight),this.transformGizmo.addChild(this.transformGizmoOutline),this.transformGizmoHandle=new BFN.StrokeLine(!0,!0,2,!0,4293783021,4282154954,"dashed_transform_line"),this.transformGizmoHandle.rotation=-this.PId2,this.transformGizmo.addChild(this.transformGizmoHandle)},fg.prototype.initHandleTextures=function(){this.handleTextureSquare=PIXI.RenderTexture.create(20,20),BFN.graphics.drawShape("roundedRect",this.handleTextureSquare,{fillColor:1073741824,cornerRadius:4,paddingY:5}),BFN.graphics.drawShape("roundedRect",this.handleTextureSquare,{strokeWidth:1,strokeColor:4282154954,fillColor:4294967295,cornerRadius:1,paddingX:1,paddingY:6,clear:!1}),this.handleTextureCircle=PIXI.RenderTexture.create(20,20),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{fillColor:1073741824}),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{strokeWidth:1.5,strokeColor:4294967295,fillColor:4282154954,paddingX:1,paddingY:1,clear:!1})},fg.prototype.initTextHandles=function(){this.textHandles={},this.textHandleIDs=["l","r"];for(var e=0;e<this.textHandleIDs.length;e++){var t=this.textHandleIDs[e],i=new BFN.HoverButton;i.buttonMode=!1,i.id=t,i.texture=this.handleTextureSquare,i.on("pointerover",this.handleTextHandleOver.bind(this)),i.on("pointerout",this.handleTextHandleOut.bind(this)),i.on("pointerdown",this.handleTextHandlePress.bind(this)),this.textHandles[t]=i,this.transformTool.addChild(i)}},fg.prototype.initScaleHandles=function(){this.scaleHandles={},this.scaleHandleIDs=["l","tl","t","tr","r","br","b","bl"],this.sideHandleIDs=["l","t","r","b"];for(var e=0;e<this.scaleHandleIDs.length;e++){var t=this.scaleHandleIDs[e],i=new BFN.HoverButton;i.buttonMode=!1,i.id=t,i.texture=e%2?this.handleTextureCircle:this.handleTextureSquare,i.on("pointerover",this.handleScaleHandleOver.bind(this)),i.on("pointerout",this.handleScaleHandleOut.bind(this)),i.on("pointerdown",this.handleScaleHandlePress.bind(this)),this.scaleHandles[t]=i,this.transformTool.addChild(i)}},fg.prototype.initRotationHandle=function(){this.rotationHandle=new BFN.HoverButton,this.rotationHandle.buttonMode=!1,this.rotationHandle.texture=this.handleTextureCircle,this.rotationHandle.on("pointerover",this.handleRotationHandleOver.bind(this)),this.rotationHandle.on("pointerout",this.handleRotationHandleOut.bind(this)),this.rotationHandle.on("pointerdown",this.handleRotationHandlePress.bind(this)),this.rotationHandle.selectAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleRotationHandleSelectAnimatorUpdate.bind(this)),this.transformTool.addChild(this.rotationHandle)},fg.prototype.initDraggers=function(){this.toolDraggers=[],this.gizmoDragger=new BFN.Dragger,this.gizmoDragger.useBounds=!0,this.gizmoDragger.stickyDrag=!1,this.gizmoDragger.pixelDragThreshold=5,this.gizmoDragger.preventSelectionDrag=!0,this.gizmoDragger.deselectItemGroup=!1,this.gizmoDragger.preRenderDragOnly=!0,this.gizmoDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleTransformGizmoDraggingStarted.bind(this)),this.gizmoDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleTransformGizmoDragging.bind(this)),this.gizmoDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleTransformGizmoDraggingComplete.bind(this)),this.toolDraggers.push(this.gizmoDragger),this.textHandleDragger=new BFN.Dragger,this.textHandleDragger.useBounds=!1,this.textHandleDragger.autoDrag=!1,this.textHandleDragger.preventSelectionDrag=!0,this.textHandleDragger.deselectItemGroup=!1,this.textHandleDragger.preRenderDragOnly=!0,this.textHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleTextHandleDraggingStarted.bind(this)),this.textHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleTextHandleDragging.bind(this)),this.textHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleTextHandleDraggingComplete.bind(this)),this.toolDraggers.push(this.textHandleDragger),this.scaleHandleDragger=new BFN.Dragger,this.scaleHandleDragger.useBounds=!1,this.scaleHandleDragger.autoDrag=!1,this.scaleHandleDragger.preventSelectionDrag=!0,this.scaleHandleDragger.deselectItemGroup=!1,this.scaleHandleDragger.preRenderDragOnly=!0,this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleScaleHandleDraggingStarted.bind(this)),this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleScaleHandleDragging.bind(this)),this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleScaleHandleDraggingComplete.bind(this)),this.toolDraggers.push(this.scaleHandleDragger),this.rotationHandleDragger=new BFN.Dragger,this.rotationHandleDragger.useBounds=!1,this.rotationHandleDragger.autoDrag=!1,this.rotationHandleDragger.preventSelectionDrag=!0,this.rotationHandleDragger.deselectItemGroup=!1,this.rotationHandleDragger.preRenderDragOnly=!0,this.rotationHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleRotationHandleDraggingStarted.bind(this)),this.rotationHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleRotationHandleDragging.bind(this)),this.rotationHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleRotationHandleDraggingComplete.bind(this)),this.toolDraggers.push(this.rotationHandleDragger)},fg.prototype.initFadeAnimator=function(){this.fadeAnimator=new BFN.Animator,this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdate.bind(this)),this.fadeAnimator.addEventListener(BFN.AnimatorEvents.INCREASE_COMPLETE.type,this.handleFadeAnimatorUpdateComplete.bind(this)),this.fadeAnimator.setAnimatorFactor(0)},fg.prototype.updateOtherItemAccurateBounds=function(){if(this.item&&this.item.accurateBounds){var e=this.transformLayer.children,t="group"==this.item.type?this.item.selectedItems:[];this.otherItemAccurateBounds.splice(0),this.transformLayer.transformItems.forEach(i=>{if(i&&this.item!=i&&e.includes(i)&&i.accurateBounds&&!t.includes(i)){var r=BFN.Util.getTransformItemBounds(i),a=new BFN.Rectangle(r.minX+i.accurateBounds.minX,r.minY+i.accurateBounds.minY,i.accurateBounds.width,i.accurateBounds.height);this.otherItemAccurateBounds.push(a)}})}},fg.prototype.showItemMeasurements=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.transformSnapGuides.hideLines(),this.item&&this.item.accurateBounds&&BFN.TransformModel.showMeasurements){e&&this.updateOtherItemAccurateBounds();var t=BFN.Util.getTransformItemBounds(this.item),i=new BFN.Rectangle(t.minX+this.item.accurateBounds.minX,t.minY+this.item.accurateBounds.minY,this.item.accurateBounds.width,this.item.accurateBounds.height),r={},a=["left","center","right"],n=["top","middle","bottom"],o=[...a,...n];for(var s in o.forEach(e=>{var t=r[e]={};t.rulerSegmentA={startPoint:new PIXI.Point,endPoint:new PIXI.Point},t.rulerSegmentB={startPoint:new PIXI.Point,endPoint:new PIXI.Point},a.includes(e)&&(t.axis="y",t.rulerSegmentA.side="top",t.rulerSegmentB.side="bottom",t.rulerSegmentA.startPoint.x=t.rulerSegmentA.endPoint.x=i[e],t.rulerSegmentB.startPoint.x=t.rulerSegmentB.endPoint.x=i[e],t.rulerSegmentA.startPoint.y=Math.min(i.top,-this.frameHeight/2),t.rulerSegmentA.endPoint.y=i.top,t.rulerSegmentB.startPoint.y=i.bottom,t.rulerSegmentB.endPoint.y=Math.max(i.bottom,this.frameHeight/2)),n.includes(e)&&(t.axis="x",t.rulerSegmentA.side="left",t.rulerSegmentB.side="right",t.rulerSegmentA.startPoint.y=t.rulerSegmentA.endPoint.y=i[e],t.rulerSegmentB.startPoint.y=t.rulerSegmentB.endPoint.y=i[e],t.rulerSegmentA.startPoint.x=Math.min(i.left,-this.frameWidth/2),t.rulerSegmentA.endPoint.x=i.left,t.rulerSegmentB.startPoint.x=i.right,t.rulerSegmentB.endPoint.x=Math.max(i.right,this.frameWidth/2))}),this.itemNeighbors||(this.itemNeighbors={left:[],top:[],right:[],bottom:[]}),this.itemNeighbors)this.itemNeighbors[s].splice(0);this.otherItemAccurateBounds.forEach(e=>{var t=i.neighbors(e);t&&this.itemNeighbors[t.side].push(t)});var l=(e,t,i)=>i>=e&&i<=t,h={};o.forEach(e=>{var t=r[e];this.itemNeighbors[t.rulerSegmentA.side].forEach(r=>{var a=r.intersectRect,n=!1;switch(t.rulerSegmentA.side){case"left":l(a.top,a.bottom,i[e])&&a.left>t.rulerSegmentA.startPoint.x&&(t.rulerSegmentA.startPoint.x=a.left,n=!0);break;case"top":l(a.left,a.right,i[e])&&a.top>t.rulerSegmentA.startPoint.y&&(t.rulerSegmentA.startPoint.y=a.top,n=!0)}n&&(h[e]||(h[e]={}),h[e][t.rulerSegmentA.side]||(h[e][t.rulerSegmentA.side]=r.rect))}),this.itemNeighbors[t.rulerSegmentB.side].forEach(r=>{var a=r.intersectRect,n=!1;switch(t.rulerSegmentB.side){case"right":l(a.top,a.bottom,i[e])&&a.right<t.rulerSegmentB.endPoint.x&&(t.rulerSegmentB.endPoint.x=a.right,n=!0);break;case"bottom":l(a.left,a.right,i[e])&&a.bottom<t.rulerSegmentB.endPoint.y&&(t.rulerSegmentB.endPoint.y=a.bottom,n=!0)}n&&(h[e]||(h[e]={}),h[e][t.rulerSegmentB.side]||(h[e][t.rulerSegmentB.side]=r.rect))})});var c={left:[],top:[],right:[],bottom:[]};o.forEach(e=>{var t=r[e];t.rulerSegmentA.startPoint=this.toGlobal(t.rulerSegmentA.startPoint),t.rulerSegmentA.endPoint=this.toGlobal(t.rulerSegmentA.endPoint),t.rulerSegmentB.startPoint=this.toGlobal(t.rulerSegmentB.startPoint),t.rulerSegmentB.endPoint=this.toGlobal(t.rulerSegmentB.endPoint);var i=Math.round(t.rulerSegmentA.endPoint[t.axis]-t.rulerSegmentA.startPoint[t.axis]),a=Math.round(t.rulerSegmentB.endPoint[t.axis]-t.rulerSegmentB.startPoint[t.axis]),n=c[t.rulerSegmentA.side],o=c[t.rulerSegmentB.side];n.push(i),o.push(a),n.length>1&&n[n.length-1]===n[n.length-2]&&(t.rulerSegmentA=null),o.length>1&&o[o.length-1]===o[o.length-2]&&(t.rulerSegmentB=null)});var u=this.transformLayer.toGlobal(new PIXI.Point(i.x,i.y)),d=this.transformLayer.toGlobal(new PIXI.Point(i.x+i.width,i.y+i.height)),m=new BFN.Rectangle(u.x,u.y,d.x-u.x,d.y-u.y);for(var p in r){var g=r[p];this.showSnapGuideLine(p,[g.rulerSegmentA,g.rulerSegmentB],[g.rulerSegmentA,g.rulerSegmentB],m)}this.snapGuidesCleared||this.transformSnapGuides.hideLines(),this.transformSnapGuides.setCenter(i.center,i.middle),this.transformSnapGuides.setDimensions(i.width,i.height),this.transformSnapGuides.showRulerLabels();var f=this.transformSnapGuides.graphics.toLocal(new PIXI.Point(u.x,u.y)),v=this.transformSnapGuides.graphics.toLocal(new PIXI.Point(d.x,d.y)),y=new BFN.Rectangle(f.x,f.y,v.x-f.x,v.y-f.y);this.transformSnapGuides.graphics.clear(),this.transformSnapGuides.graphics.lineStyle(1,2154751),this.transformSnapGuides.graphics.drawRect(y.x,y.y,y.width,y.height);var x=new PIXI.Point,_=new PIXI.Point;for(var I in h)for(var T in h[I]){var b=h[I][T];switch(T){case"left":x.x=_.x=b.right,x.y=b.top,_.y=b.bottom;break;case"right":x.x=_.x=b.left,x.y=b.top,_.y=b.bottom;break;case"top":x.y=_.y=b.bottom,x.x=b.left,_.x=b.right;break;case"bottom":x.y=_.y=b.top,x.x=b.left,_.x=b.right}var S=this.transformSnapGuides.graphics.toLocal(x,this.transformLayer),C=this.transformSnapGuides.graphics.toLocal(_,this.transformLayer);this.transformSnapGuides.graphics.moveTo(S.x,S.y),this.transformSnapGuides.graphics.lineTo(C.x,C.y)}}},fg.prototype.selectItem=function(e,t){if(e){e!=this.item&&(this.fadeAnimator.setAnimatorFactor(0),this.deselectItem(),this.item=e,this.updateDisplay());for(var i=0;i<this.textHandleIDs.length;i++){var r=this.textHandleIDs[i];this.textHandles[r].visible="text"===this.item.type}for(var a=0;a<this.sideHandleIDs.length;a++){var n=this.sideHandleIDs[a];this.scaleHandles[n].visible=!["text","group"].includes(this.item.type)}this.itemCenterOffsetX=0,this.itemCenterOffsetY=0,this.item.selectedByMouse&&this.item.accurateBounds?(this.item.transforming=!0,this.gizmoDragger.scale=this._scale,this.gizmoDragger.drag(this.transformTool),this.fadeAnimator.decrease(),"group"==this.item.type&&this.item.fadeAnimator.decrease()):(this.fadeAnimator.increase(),"group"==this.item.type&&this.item.fadeAnimator.increase())}},fg.prototype.deselectItem=function(){this.toolDraggers.forEach(e=>{e.dragging&&e.stopDrag(),e.active&&e.completeStopDrag()}),this.item&&(this.item.transforming=!1,this.item=null),this.fadeAnimator.decrease(),this.transformSnapGuides.hideLines(),BFN.MainUI.tooltip=null},fg.prototype.disableHandles=function(e){for(var t in this.textHandles){var i=this.textHandles[t];i!=e&&(i.interactive=!1)}for(var r in this.scaleHandles){var a=this.scaleHandles[r];a!=e&&(a.interactive=!1)}this.rotationHandle!=e&&(this.rotationHandle.interactive=!1)},fg.prototype.enableHandles=function(){for(var e in this.textHandles){this.textHandles[e].interactive=!0}for(var t in this.scaleHandles){this.scaleHandles[t].interactive=!0}this.rotationHandle.interactive=!0},fg.prototype.updateHandleScales=function(){for(var e in this.textHandles){var t=this.textHandles[e];t.scale.x=t.scale.y=1/this._scale}for(var i in this.scaleHandles){var r=this.scaleHandles[i];r.scale.x=r.scale.y=1/this._scale}this.rotationHandle.scale.x=this.rotationHandle.scale.y=1/this._scale},fg.prototype.drawGizmo=function(){this.transformGizmoOutline.setDimensions(this.itemWidth+this.gizmoPadding/this._scale*2,this.itemHeight+this.gizmoPadding/this._scale*2),this.transformGizmoHandle.y=-(this.itemHeight/2+this.gizmoPadding/this._scale),this.transformGizmoHandle.length=this.rotationHandleOffset*(1/this._scale)},fg.prototype.updateDisplay=function(){this.item&&!BFN.UndoManager.updating&&(this.updateTransformValues(),this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.drawGizmo())},fg.prototype.updateTransformValues=function(){if(this.item){var e=this.item.bounds;this.itemBaseWidth=e.width,this.itemBaseHeight=e.height,this.itemWidth=this.itemBaseWidth*this.item.scale.x,this.itemHeight=this.itemBaseHeight*this.item.scale.y,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.itemCenterBeta=Math.atan2(this.itemHeight/2,this.itemWidth/2),this.itemCenterX=this.item.x+Math.cos(this.itemCenterBeta+this.item.rotation)*this.itemRadius,this.itemCenterY=this.item.y+Math.sin(this.itemCenterBeta+this.item.rotation)*this.itemRadius,this.itemAspectRatio=this.item.scale.x/this.item.scale.y,this.transformGizmo.x=this.transformGizmo.y=0,this.transformGizmo.rotation=this.item.rotation,this.hBeta=this.item.rotation,this.vBeta=this.hBeta-this.PId2,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY}},fg.prototype.updateTextHandlePosition=function(){var e=(this.itemHeight+this.gizmoPadding/this._scale*2)*this._scale;for(var t in this.textHandles){var i=this.textHandles[t];i.rotation=this.hBeta;var r=null,a=null;switch(i.id){case"l":r=this.hBeta-Math.PI,a=this.hBeta+Math.PI;break;case"r":r=this.hBeta,a=this.hBeta}null!==r&&(i.betaPadding=a,i.noPaddingX=this.transformGizmo.x+Math.cos(r)*(this.itemWidth/2),i.noPaddingY=this.transformGizmo.y+Math.sin(r)*(this.itemWidth/2),i.x=i.noPaddingX+Math.cos(i.betaPadding)*(this.gizmoPadding/this._scale),i.y=i.noPaddingY+Math.sin(i.betaPadding)*(this.gizmoPadding/this._scale),i.rotation=this.hBeta+this.PId2,i.active=e>this.handleTextureCircle.width+this.handleTextureSquare.width-8)}},fg.prototype.updateScaleHandlePosition=function(){var e=(this.itemWidth+this.gizmoPadding/this._scale*2)*this._scale,t=(this.itemHeight+this.gizmoPadding/this._scale*2)*this._scale;for(var i in this.scaleHandles){var r=this.sideHandleIDs.includes(i)?"side":"corner",a=null,n=null,o=null;switch(i){case"tl":a=this.itemCenterBeta+this.hBeta-Math.PI,n=-.75*Math.PI+this.hBeta;break;case"tr":a=-this.itemCenterBeta+this.hBeta,n=-.25*Math.PI+this.hBeta;break;case"bl":a=Math.PI-this.itemCenterBeta+this.hBeta,n=.75*Math.PI+this.hBeta;break;case"br":a=this.itemCenterBeta+this.hBeta,n=.25*Math.PI+this.hBeta;break;case"l":a=this.hBeta-Math.PI,o=this.hBeta+Math.PI;break;case"r":a=this.hBeta,o=this.hBeta;break;case"t":a=this.hBeta-Math.PI/2,o=this.hBeta-Math.PI/2;break;case"b":a=this.hBeta+Math.PI/2,o=this.hBeta+Math.PI/2}if(null!==a){var s=this.scaleHandles[i];switch(r){case"corner":s.betaDiagonal=n,s.noPaddingX=this.transformGizmo.x+Math.cos(a)*this.itemRadius,s.noPaddingY=this.transformGizmo.y+Math.sin(a)*this.itemRadius,s.x=s.noPaddingX+Math.cos(n)*(this.gizmoPaddingDiagonal/this._scale),s.y=s.noPaddingY+Math.sin(n)*(this.gizmoPaddingDiagonal/this._scale);break;case"side":var l=["l","r"].includes(s.id);s.betaPadding=o,s.noPaddingX=this.transformGizmo.x+Math.cos(a)*((l?this.itemWidth:this.itemHeight)/2),s.noPaddingY=this.transformGizmo.y+Math.sin(a)*((l?this.itemWidth:this.itemHeight)/2),s.x=s.noPaddingX+Math.cos(s.betaPadding)*(this.gizmoPadding/this._scale),s.y=s.noPaddingY+Math.sin(s.betaPadding)*(this.gizmoPadding/this._scale),s.rotation=this.hBeta+(l?this.PId2:0),s.active=(l?t:e)>this.handleTextureCircle.width+this.handleTextureSquare.width-8}}}},fg.prototype.updateRotationHandlePosition=function(){this.rotationHandle.x=this.transformGizmo.x-Math.cos(this.vBeta)*(-Math.abs(this.itemHeight/2)-this.rotationHandleOffset*(1/this._scale)-this.gizmoPadding/this._scale),this.rotationHandle.y=this.transformGizmo.y-Math.sin(this.vBeta)*(-Math.abs(this.itemHeight/2)-this.rotationHandleOffset*(1/this._scale)-this.gizmoPadding/this._scale)},fg.prototype.initTransformToolFrame=function(){this.transformToolFrame=new BFN.TransformToolFrame(this),this.addChild(this.transformToolFrame)},fg.prototype.resizeText=function(){var e=BFN.MainUI.getPointerPosition(BFN.MainUI.pointerEvent),t=new PIXI.Point(e.x+BFN.MainUI.x-this.textAnchor.x,e.y+BFN.MainUI.y-this.textAnchor.y),i=Math.cos(Math.atan2(t.y,t.x)+this.textControl.beta-this.hBeta)<=0?0:Math.ceil((this.getPointToLineDistance(t,Math.tan(this.vBeta))-2*this.gizmoPadding)/this._scale),r=this.item,a=r.iText,n=r.textScale*r.scale.x;this.item.iText.width=i/n,this.item.iText.initDimensions(),i=a.width*n,a.width=i/n,a.initDimensions();var o=Math.ceil(a.height*n);this.textControl.beta<Math.PI/2?(a.left=this.iTextData.topLeft.x,a.top=this.iTextData.topLeft.y,this.item.x=this.itemData.topLeft.x,this.item.y=this.itemData.topLeft.y):(a.left=this.iTextData.topRight.x-Math.cos(this.hBeta)*i*this._scale,a.top=this.iTextData.topRight.y-Math.sin(this.hBeta)*i*this._scale,this.item.x=this.itemData.topRight.x-Math.cos(this.hBeta)*i,this.item.y=this.itemData.topRight.y-Math.sin(this.hBeta)*i),BFN.FabricManager.fabricCanvas.renderAll(),this.itemWidth=i,this.itemHeight=o,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.itemCenterBeta=Math.atan2(this.itemHeight/2,this.itemWidth/2),this.updateDisplayForTextResize()},fg.prototype.updateDisplayForTextResize=function(){this.item&&(this.itemCenterX=this.item.x+Math.cos(this.itemCenterBeta+this.item.rotation)*this.itemRadius,this.itemCenterY=this.item.y+Math.sin(this.itemCenterBeta+this.item.rotation)*this.itemRadius,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.drawGizmo())},fg.prototype.freeformScale=function(){var e=this.sideHandleIDs.includes(this.currentScaleHandle.id)?"side":"corner",t=["l","r"].includes(this.currentScaleHandle.id);if("side"===e)switch(this.item.type){case"text":case"group":return}var i=null,r=()=>{switch(i=this.transformTool.getPointerPosition(BFN.MainUI.pointerEvent),e){case"corner":this.scaleControl.x=i.x-Math.cos(this.currentScaleHandle.betaDiagonal)*(this.gizmoPaddingDiagonal/this._scale),this.scaleControl.y=i.y-Math.sin(this.currentScaleHandle.betaDiagonal)*(this.gizmoPaddingDiagonal/this._scale);break;case"side":this.scaleControl.x=i.x-Math.cos(this.currentScaleHandle.betaPadding)*(this.gizmoPadding/this._scale),this.scaleControl.y=i.y-Math.sin(this.currentScaleHandle.betaPadding)*(this.gizmoPadding/this._scale)}},a=()=>{var i=!0,r=null;"side"===e&&(i=(this.item.rotation+this.PIx2)%this.PId2<Math.PI/180,r=!!((this.item.rotation+this.PIx2)%this.PIx2/this.PId2%2)?t?"vertical":"horizontal":t?"horizontal":"vertical");if(BFN.TransformModel.snappingEnabled&&this.scaleHandleDragger.wasDragged&&i){for(var a=!1,n=!1,o={},s=0;s<this.item.snapCoordinates.length;s++){var l=this.item.snapCoordinates[s],h=this.transformLayer.toLocal(this.scaleControl,this.transformTool);switch(l.position){case"horizontal":var c=h.x-l.value;if(Math.abs(c)<(a?this.snapDistanceTransformSnapped:this.snapDistanceTransform)){a||(h.x=l.value);var u=this.transformTool.toLocal(h,this.transformLayer);this.scaleControl.x=u.x,this.scaleControl.y=u.y,a=!0,o.hasOwnProperty("center")||(o.center={maskedSegment:null,values:[],axis:"y"}),o.center.values.includes(l.bounds.top)||o.center.values.push(l.bounds.top),o.center.values.includes(l.bounds.bottom)||o.center.values.push(l.bounds.bottom)}break;case"vertical":var d=h.y-l.value;if(Math.abs(d)<(n?this.snapDistanceTransformSnapped:this.snapDistanceTransform)){n||(h.y=l.value);var m=this.transformTool.toLocal(h,this.transformLayer);this.scaleControl.x=m.x,this.scaleControl.y=m.y,n=!0,o.hasOwnProperty("middle")||(o.middle={maskedSegment:null,values:[],axis:"x"}),o.middle.values.includes(l.bounds.left)||o.middle.values.push(l.bounds.left),o.middle.values.includes(l.bounds.right)||o.middle.values.push(l.bounds.right)}}}var p=BFN.Util.getTransformItemBounds(this.item,!0);for(var g in p.x={a:p.minX,b:p.maxX},p.y={a:p.minY,b:p.maxY},o)if("corner"===e||"horizontal"===r&&"center"===g&&a||"vertical"===r&&"middle"===g&&n){var f=o[g];f.maskedSegment={startPoint:new PIXI.Point,endPoint:new PIXI.Point},f.maskedSegment.startPoint[f.axis]=p[f.axis].a,f.maskedSegment.endPoint[f.axis]=p[f.axis].b,f.values.sort((e,t)=>e-t);for(var v=0;v<f.values.length;v++)f.maskedSegment.startPoint[f.axis]=Math.min(f.maskedSegment.startPoint[f.axis],f.values[v]),f.maskedSegment.endPoint[f.axis]=Math.max(f.maskedSegment.endPoint[f.axis],f.values[v]);f.maskedSegment.startPoint=this.transformLayer.toGlobal(f.maskedSegment.startPoint),f.maskedSegment.endPoint=this.transformLayer.toGlobal(f.maskedSegment.endPoint),this.showSnapGuideLine(g,[f.maskedSegment])}var y=this.transformLayer.toLocal(this.scaleControl,this.transformTool);this.transformSnapGuides.setCenter(y.x,y.y),this.transformSnapGuides.setDimensions(3,3)}};r(),a();var n=new PIXI.Point(this.scaleAnchor.x,this.scaleAnchor.y);n=this.transformGizmo.toLocal(n,this.transformTool);var o=new PIXI.Point(this.scaleControl.x,this.scaleControl.y);o=this.transformGizmo.toLocal(o,this.transformTool);var s=new PIXI.Point(this.currentScaleHandle.noPaddingX,this.currentScaleHandle.noPaddingY);s=this.transformGizmo.toLocal(s,this.transformTool);var l=!("side"===e&&!t)&&(n.x-s.x)*(n.x-o.x)<0,h=("side"!==e||!t)&&(n.y-s.y)*(n.y-o.y)<0,c=this.minSize,u=this.minSize;switch(this.item.type){case"text":c=u=this.minSizeText;break;case"frame_texture":c=u=this.minSizeFrame;var d=this.item.itemContent.frameSprite;d.frameScaling&&(c=Math.max(c,d.initialRealDimensions.x/d.baseWidth*this.minSizeFrame),u=Math.max(u,d.initialRealDimensions.y/d.baseHeight*this.minSizeFrame));break;case"texture":this.item.isShape||(c=u=this.minSizeFrame)}if(this.scaleHandleDragger.altKey){switch(this.anchorCenter||(this.anchorCenter=!0,this.transformGizmo.x=this.transformGizmo.y=0,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.updateDisplay(),BFN.MainUI.renderCanvas(),i=this.transformTool.getPointerPosition(BFN.MainUI.pointerEvent)),r(),a(),e){case"corner":this.newItemWidth=2*this.getPointToLineDistance(this.scaleControl,Math.tan(this.vBeta)),this.newItemHeight=2*this.getPointToLineDistance(this.scaleControl,Math.tan(this.hBeta));break;case"side":t?(this.newItemWidth=2*this.getPointToLineDistance(this.scaleControl,Math.tan(this.vBeta)),this.newItemHeight=this.itemHeight):(this.newItemWidth=this.itemWidth,this.newItemHeight=2*this.getPointToLineDistance(this.scaleControl,Math.tan(this.hBeta)))}this.newItemWidth=l?c:Math.max(c,this.newItemWidth),this.newItemHeight=h?u:Math.max(u,this.newItemHeight)}else{this.anchorCenter=!1;var m=new PIXI.Point(this.scaleControl.x,this.scaleControl.y);m=this.transformGizmo.toLocal(m,this.transformTool);var p=new PIXI.Point(this.scaleAnchor.x,this.scaleAnchor.y);switch(p=this.transformGizmo.toLocal(p,this.transformTool),e){case"corner":var g=Math.sqrt(Math.pow(this.scaleControl.x-this.scaleAnchor.x,2)+Math.pow(this.scaleControl.y-this.scaleAnchor.y,2)),f=Math.abs(Math.atan2(m.y-p.y,m.x-p.x));f=f>this.PId2?Math.PI-f:f,this.newItemWidth=Math.cos(f)*g,this.newItemHeight=Math.sin(f)*g;break;case"side":t?(this.newItemWidth=Math.abs(p.x-m.x),this.newItemHeight=this.itemHeight):(this.newItemWidth=this.itemWidth,this.newItemHeight=Math.abs(p.y-m.y))}this.newItemWidth=l?c:Math.max(c,this.newItemWidth),this.newItemHeight=h?u:Math.max(u,this.newItemHeight);var v=new PIXI.Point(p.x,p.y);switch(this.currentScaleHandle.id){case"tl":v.x-=this.newItemWidth/2,v.y-=this.newItemHeight/2;break;case"tr":v.x+=this.newItemWidth/2,v.y-=this.newItemHeight/2;break;case"bl":v.x-=this.newItemWidth/2,v.y+=this.newItemHeight/2;break;case"br":v.x+=this.newItemWidth/2,v.y+=this.newItemHeight/2;break;case"l":v.x-=this.newItemWidth/2;break;case"r":v.x+=this.newItemWidth/2;break;case"t":v.y-=this.newItemHeight/2;break;case"b":v.y+=this.newItemHeight/2}v=this.transformTool.toLocal(v,this.transformGizmo),this.transformGizmo.x=v.x,this.transformGizmo.y=v.y,v=this.toLocal(v,this.transformTool),this.itemCenterX=v.x,this.itemCenterY=v.y}switch(this.item.scale.x=this.newItemWidth/this.itemBaseWidth,this.item.scale.y=this.newItemHeight/this.itemBaseHeight,this.itemAspectRatio=this.item.scale.x/this.item.scale.y,this.itemWidth=this.itemBaseWidth*this.item.scale.x,this.itemHeight=this.itemBaseHeight*this.item.scale.y,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.itemCenterBeta=Math.atan2(this.itemHeight/2,this.itemWidth/2),this.item.updateFrameTextureDisplay(),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.currentScaleHandle.id){case"tl":case"br":BFN.CursorScreen.cursorRotation=this.hBeta+this.itemCenterBeta;break;case"tr":case"bl":BFN.CursorScreen.cursorRotation=this.hBeta-this.itemCenterBeta;break;case"l":case"r":BFN.CursorScreen.cursorRotation=this.hBeta;break;case"tr":case"bl":BFN.CursorScreen.cursorRotation=this.vBeta}if(this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.anchorCenter){var y=this.getInverseScaleHandle(this.currentScaleHandle);this.scaleAnchor.x=y.noPaddingX,this.scaleAnchor.y=y.noPaddingY}},fg.prototype.constrainedScale=function(){var e=this.sideHandleIDs.includes(this.currentScaleHandle.id)?"side":"corner",t=["l","r"].includes(this.currentScaleHandle.id);if("side"===e)switch(this.item.type){case"text":case"group":return}this.scaleHandleDragger.altKey?this.anchorCenter||(this.anchorCenter=!0,this.transformGizmo.x=this.transformGizmo.y=0,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY):this.anchorCenter=!1;var i=this.transformTool.getPointerPosition(BFN.MainUI.pointerEvent);switch(e){case"corner":this.scaleControl.x=i.x-Math.cos(this.currentScaleHandle.betaDiagonal)*(this.gizmoPaddingDiagonal/this._scale),this.scaleControl.y=i.y-Math.sin(this.currentScaleHandle.betaDiagonal)*(this.gizmoPaddingDiagonal/this._scale);break;case"side":this.scaleControl.x=i.x-Math.cos(this.currentScaleHandle.betaPadding)*(this.gizmoPadding/this._scale),this.scaleControl.y=i.y-Math.sin(this.currentScaleHandle.betaPadding)*(this.gizmoPadding/this._scale)}var r=this.itemBaseHeight/this.itemBaseWidth/this.itemAspectRatio,a=this.minSize;switch(this.item.type){case"text":a=this.minSizeText;break;case"frame_texture":a=this.minSizeFrame;break;case"texture":this.item.isShape||(a=this.minSizeFrame)}var n=Math.max(a,a/r),o=Math.max(a,a*r),s=a,l=s*r,h=Math.sqrt(Math.pow(s,2)+Math.pow(l,2)),c=a,u=c/r,d=Math.sqrt(Math.pow(u,2)+Math.pow(c,2)),m=Math.max(h,d)/2,p=[];if(BFN.TransformModel.snappingEnabled&&this.scaleHandleDragger.wasDragged&&"corner"===e){var g=null;switch(this.currentScaleHandle.id){case"tl":case"br":g=this.item.rotation+this.itemCenterBeta;break;case"bl":case"tr":g=this.item.rotation-this.itemCenterBeta}if(null!==g){var f=Math.sin(g),v=Math.cos(g),y=f?v?f/v:1/0:0;this.drawSnapHelpers&&(this.itemGuidesGraphic.clear(),this.itemGuidesGraphic.lineStyle(1,16711935),this.itemGuidesGraphic.moveTo(this.itemCenterX-2e3*v,this.itemCenterY-2e3*f),this.itemGuidesGraphic.lineTo(this.itemCenterX+2e3*v,this.itemCenterY+2e3*f),this.itemGuidesGraphic.lineStyle(null));var x=this.transformLayer.toLocal(new PIXI.Point(this.currentScaleHandle.noPaddingX,this.currentScaleHandle.noPaddingY),this.transformTool),_=this.transformLayer.toLocal(this.scaleAnchor,this.transformTool),I=Math.atan2(x.y-_.y,x.x-_.x);this.item.snapCoordinates.forEach(e=>{var t=new PIXI.Point(e.value,e.value);switch(e.position){case"horizontal":t.y=0===y?this.itemCenterY:y===1/0?NaN:y*(t.x-this.itemCenterX)+this.itemCenterY;break;case"vertical":t.x=0===y?NaN:y===1/0?this.itemCenterX:(t.y-this.itemCenterY)/y+this.itemCenterX}if(!isNaN(t.x)&&!isNaN(t.y)){var i=Math.atan2(t.y-_.y,t.x-_.x),r=Math.sqrt(Math.pow(t.x-_.x,2)+Math.pow(t.y-_.y,2));Math.abs(i-I)<this.PId2&&r>m&&(t.snapCoordinate=e,p.push(t),this.drawSnapHelpers&&(this.itemGuidesGraphic.beginFill(65280),this.itemGuidesGraphic.drawCircle(t.x,t.y,3),this.itemGuidesGraphic.endFill()))}})}}var T=null,b=null,S=null;switch(this.currentScaleHandle.id){case"tl":case"br":T=(this.hBeta-this.PId2+this.itemCenterBeta+this.PIx2)%this.PIx2;break;case"tr":case"bl":T=(this.hBeta+this.PId2-this.itemCenterBeta+this.PIx2)%this.PIx2;break;case"l":case"r":T=(this.hBeta-this.PId2+this.PIx2)%this.PIx2;break;case"t":case"b":T=(this.hBeta+this.PIx2)%this.PIx2}this.deltaPoint.x=this.scaleControl.x-this.scaleAnchor.x,this.deltaPoint.y=this.scaleControl.y-this.scaleAnchor.y;var C=0,B=0;switch(e){case"corner":T%Math.PI==0?(b=1/0,this.newItemRadius=Math.max(m,Math.abs(this.deltaPoint.y)/2)):T%Math.PI===this.PId2?(b=0,this.newItemRadius=Math.max(m,Math.abs(this.deltaPoint.x)/2)):(b=Math.tan(T),this.newItemRadius=Math.max(m,this.getPointToLineDistance(this.deltaPoint,b)/2));break;case"side":if(T%Math.PI==0)b=1/0,t?(C=Math.max(n,Math.abs(this.deltaPoint.x))/2,this.newItemRadius=C/Math.cos(this.itemCenterBeta)):(B=Math.max(o,Math.abs(this.deltaPoint.y))/2,this.newItemRadius=B/Math.sin(this.itemCenterBeta));else if(T%Math.PI===this.PId2)b=0,t?(C=Math.max(n,Math.abs(this.deltaPoint.x))/2,this.newItemRadius=C/Math.cos(this.itemCenterBeta)):(B=Math.max(o,Math.abs(this.deltaPoint.y))/2,this.newItemRadius=B/Math.sin(this.itemCenterBeta));else{b=Math.tan(T);var F=this.getPointToLineDistance(this.deltaPoint,b);t?(C=Math.max(n,F)/2,this.newItemRadius=C/Math.cos(this.itemCenterBeta)):(B=Math.max(o,F)/2,this.newItemRadius=B/Math.sin(this.itemCenterBeta))}}switch(this.deltaPoint.x=this.currentScaleHandle.noPaddingX-this.scaleControl.x,this.deltaPoint.y=this.currentScaleHandle.noPaddingY-this.scaleControl.y,e){case"corner":S=b===1/0?Math.abs(this.deltaPoint.y)/2>this.newItemRadius:0===b?Math.abs(this.deltaPoint.x)/2>this.newItemRadius:this.getPointToLineDistance(this.deltaPoint,b)/2>this.newItemRadius;break;case"side":S=b===1/0?t?Math.abs(this.deltaPoint.x)/2>C:Math.abs(this.deltaPoint.y)/2>B:0===b?t?Math.abs(this.deltaPoint.x)/2>C:Math.abs(this.deltaPoint.y)/2>B:t?this.getPointToLineDistance(this.deltaPoint,b)/2>C:this.getPointToLineDistance(this.deltaPoint,b)/2>B}if(this.newItemRadius=S?m:Math.max(m,this.newItemRadius),BFN.TransformModel.snappingEnabled&&"corner"===e){var E=this.transformLayer.toLocal(this.scaleAnchor,this.transformTool);this.drawSnapHelpers&&(this.itemGuidesGraphic.beginFill(11184895,.5),this.itemGuidesGraphic.drawCircle(E.x,E.y,6),this.itemGuidesGraphic.endFill());for(var P=null,N=p.length;--N>-1;){var M=p[N],D=Math.sqrt(Math.pow(M.x-E.x,2)+Math.pow(M.y-E.y,2))/2,w=Math.sqrt(Math.pow(M.x-this.itemCenterX,2)+Math.pow(M.y-this.itemCenterY,2)),k=this.anchorCenter?w:D;Math.abs(this.newItemRadius-k)<this.screenPixelSnapThreshold/this._scale&&(P=M,this.newItemRadius=k)}if(P){this.drawSnapHelpers&&(this.itemGuidesGraphic.beginFill(16776960),this.itemGuidesGraphic.drawCircle(P.x,P.y,6),this.itemGuidesGraphic.endFill());for(var L={},O=0;O<this.item.snapCoordinates.length;O++){var R=this.item.snapCoordinates[O];switch(R.position){case"horizontal":Math.abs(P.x-R.value)<1&&(L.hasOwnProperty("center")||(L.center={maskedSegment:null,values:[],axis:"y"}),L.center.values.includes(R.bounds.top)||L.center.values.push(R.bounds.top),L.center.values.includes(R.bounds.bottom)||L.center.values.push(R.bounds.bottom));break;case"vertical":Math.abs(P.y-R.value)<1&&(L.hasOwnProperty("middle")||(L.middle={maskedSegment:null,values:[],axis:"x"}),L.middle.values.includes(R.bounds.left)||L.middle.values.push(R.bounds.left),L.middle.values.includes(R.bounds.right)||L.middle.values.push(R.bounds.right))}}var A=BFN.Util.getTransformItemBounds(this.item,!0);for(var V in A.x={a:A.minX,b:A.maxX},A.y={a:A.minY,b:A.maxY},L){var U=L[V];U.maskedSegment={startPoint:new PIXI.Point,endPoint:new PIXI.Point},U.maskedSegment.startPoint[U.axis]=A[U.axis].a,U.maskedSegment.endPoint[U.axis]=A[U.axis].b,U.values.sort((e,t)=>e-t);for(var G=0;G<U.values.length;G++)U.maskedSegment.startPoint[U.axis]=Math.min(U.maskedSegment.startPoint[U.axis],U.values[G]),U.maskedSegment.endPoint[U.axis]=Math.max(U.maskedSegment.endPoint[U.axis],U.values[G]);U.maskedSegment.startPoint=this.transformLayer.toGlobal(U.maskedSegment.startPoint),U.maskedSegment.endPoint=this.transformLayer.toGlobal(U.maskedSegment.endPoint),this.showSnapGuideLine(V,[U.maskedSegment])}this.transformSnapGuides.setCenter(P.x,P.y),this.transformSnapGuides.setDimensions(3,3)}}if(this.newItemWidth=Math.cos(this.itemCenterBeta)*this.newItemRadius*2,this.newItemHeight=Math.sin(this.itemCenterBeta)*this.newItemRadius*2,C=this.newItemWidth/2,B=this.newItemHeight/2,!this.anchorCenter){var H=new PIXI.Point(this.scaleAnchor.x,this.scaleAnchor.y),z=null;switch(this.currentScaleHandle.id){case"tl":case"br":z=this.hBeta+this.itemCenterBeta;break;case"tr":case"bl":z=this.hBeta-this.itemCenterBeta;break;case"l":case"r":z=this.hBeta;break;case"t":case"b":z=this.hBeta+this.PId2}var X=Math.cos(z)*("corner"===e?this.newItemRadius:t?C:B),j=Math.sin(z)*("corner"===e?this.newItemRadius:t?C:B);switch(this.currentScaleHandle.id){case"tl":case"bl":case"l":case"t":H.x-=X,H.y-=j;break;case"tr":case"br":case"r":case"b":H.x+=X,H.y+=j}this.transformGizmo.x=H.x,this.transformGizmo.y=H.y,H=this.toLocal(H,this.transformTool),this.itemCenterX=H.x,this.itemCenterY=H.y}if(this.item.scale.x=this.newItemWidth/this.itemBaseWidth,this.item.scale.y=this.item.scale.x/this.itemAspectRatio,this.itemWidth=this.itemBaseWidth*this.item.scale.x,this.itemHeight=this.itemBaseHeight*this.item.scale.y,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.item.updateFrameTextureDisplay(),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.newItemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.newItemRadius,this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.anchorCenter){var W=this.getInverseScaleHandle(this.currentScaleHandle);this.scaleAnchor.x=W.noPaddingX,this.scaleAnchor.y=W.noPaddingY}if("text"==this.item.type&&this.item==BFN.TransformModel.selectedTransformItem){var Y=this.item.iText;for(var q in Y.styles){var K=Y.styles[q];for(var Q in K){var Z=K[Q];Z.hasOwnProperty("strokePercent")&&Z.hasOwnProperty("fontSize")&&(Z.strokeWidth=Math.max(1/(this.item.textScale*this.item.scale.x),Z.fontSize*Z.strokePercent))}}BFN.FabricManager.updateTextMenu(this.item.getTextStyleData())}else"group"==this.item.type&&"text"===this.item.groupType&&this.item==BFN.TransformModel.selectedTransformItem&&BFN.FabricManager.updateTextMenu(this.item.getTextGroupStyleData());"group"==this.item.type&&this.item.updateGroupTransform()},fg.prototype.constrainedRotate=function(){if(this.rotationHandleDraggerBeta=(Math.atan2(this.rotationHandleDragger.draggedY,this.rotationHandleDragger.draggedX)+this.PIx2)%this.PIx2,this.rotationHandle.x=Math.cos(Math.atan2(this.rotationHandleDragger.draggedY,this.rotationHandleDragger.draggedX))*this.rotationRadius,this.rotationHandle.y=Math.sin(Math.atan2(this.rotationHandleDragger.draggedY,this.rotationHandleDragger.draggedX))*this.rotationRadius,this.rotationHandleDragger.shiftKey||this.rotationHandleDragger.dragVelocity<3){var e=Math.round(this.rotationHandleDraggerBeta/this.snapSectionBeta),t=Math.sqrt(Math.pow(this.rotationHandleDragger.draggedX,2)+Math.pow(this.rotationHandleDragger.draggedY,2)),i=Math.min(Math.PI/180,this.snapDistance*(1/this._scale)/t);(Math.abs(this.rotationHandleDraggerBeta-e*this.snapSectionBeta)<i||this.rotationHandleDragger.shiftKey)&&(this.rotationHandle.x=Math.cos(e*this.snapSectionBeta)*this.rotationRadius,this.rotationHandle.y=Math.sin(e*this.snapSectionBeta)*this.rotationRadius)}this.item.rotation=this.transformGizmo.rotation=Math.atan2(this.rotationHandle.y,this.rotationHandle.x)+this.PId2,BFN.CursorScreen.cursorRotation=this.item.rotation,this.hBeta=this.item.rotation,this.vBeta=this.hBeta-this.PId2,this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.updateTextHandlePosition(),this.updateScaleHandlePosition(),"group"==this.item.type&&this.item.updateGroupTransform()},fg.prototype.setItemScale=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.item&&"text"==this.item.type&&(this.item.scale.x=this.item.scale.y=Math.max(.01,e)/this.item.textScale,this.itemWidth=this.item.scale.x*this.itemBaseWidth,this.itemHeight=this.item.scale.y*this.itemBaseHeight,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.itemCenterBeta=Math.atan2(this.itemHeight/2,this.itemWidth/2),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,t&&this.conformItemToBounds(),this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.drawGizmo(),t&&this.updateDisplay())},fg.prototype.conformItemToBounds=function(){if(this.item){var e=BFN.Util.getTransformItemBounds(this.item,!0),t=this.frameWidth/2+(e.width/2+10),i=this.frameHeight/2+(e.height/2+10);this.itemCenterX=Math.max(-t,Math.min(t,this.itemCenterX)),this.itemCenterY=Math.max(-i,Math.min(i,this.itemCenterY)),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,"group"==this.item.type&&this.item.updateGroupTransform()}},fg.prototype.fitItemToCanvas=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.item&&"frame_texture"===this.item.type){this.item.createTransition(e?"transform_fill_canvas":"transform_fit_to_canvas");var t=this.frameWidth+this.frameWidth%2,i=this.frameHeight+this.frameHeight%2,r=Math.min(t/this.item.itemContentW,i/this.item.itemContentH),a=Math.round(this.item.itemContentW*r),n=Math.round(this.item.itemContentH*r);if(a+=a%2,n+=n%2,this.item.rotation=0,this.item.x=-a/2,this.item.y=-n/2,this.item.scale.x=a/this.item.itemContentW,this.item.scale.y=n/this.item.itemContentH,this.item.updateFrameTextureDisplay(),this.item.resetFrameTextureScale(),e){this.updateTransformValues();var o=this.item.itemContent;a<t?o.startFrameScaling("l",!0):n<i&&o.startFrameScaling("t",!0),this.item.x=-t/2,this.item.y=-i/2,this.item.scale.x=t/this.itemBaseWidth,this.item.scale.y=i/this.itemBaseHeight,this.item.updateFrameTextureDisplay(),o.stopFrameScaling(),this.item.resetFrameTextureScale()}this.item.registerTransition(),this.updateDisplay(),BFN.MainUI.requestRender()}},fg.prototype.getPointToLineDistance=function(e,t){if(0==t)return Math.abs(e.y);var i=(e.y+1/t*e.x)/(t- -1/t),r=t*i;return Math.sqrt(Math.pow(i-e.x,2)+Math.pow(r-e.y,2))},fg.prototype.getInverseTextHandle=function(e){return this.textHandles[this.textHandleIDs[(this.textHandleIDs.indexOf(e.id)+1)%this.textHandleIDs.length]]},fg.prototype.getInverseScaleHandle=function(e){return this.scaleHandles[this.scaleHandleIDs[(this.scaleHandleIDs.indexOf(e.id)+4)%this.scaleHandleIDs.length]]},fg.prototype.getInverseFrameAnchorSide=function(){var e=null;this.item&&"frame_texture"==this.item.type&&this.currentScaleHandle&&(e=this.getInverseScaleHandle(this.currentScaleHandle).id,this.item.flippedHorizontal&&(e.includes("l")?e=e.replace("l","r"):e.includes("r")&&(e=e.replace("r","l"))),this.item.flippedVertical&&(e.includes("t")?e=e.replace("t","b"):e.includes("b")&&(e=e.replace("b","t"))));return e},fg.prototype.showSnapGuideLine=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;this.snapGuidesCleared||(this.snapGuidesCleared=!0,this.transformSnapGuides.hideLines()),this.transformSnapGuides.showLine(e,t,i,r)},fg.prototype.toggleItemTransform=function(e){this.item&&this.item.parent&&("group"==this.item.type?this.item.toggleTransform(e):e?(this.itemZIndex=this.item.parent.getChildIndex(this.item),this.itemBlendMode=this.item.itemBlendMode,this.item.parent.setChildIndex(this.item,this.item.parent.children.length-1),this.item.itemContent.blendMode=BFN.CONST.BLEND_MODES.NORMAL):(this.item.parent.setChildIndex(this.item,this.itemZIndex),this.item.itemContent.blendMode=this.itemBlendMode,this.itemZIndex=0,this.itemBlendMode=BFN.CONST.BLEND_MODES.NORMAL))},fg.prototype.handleTextHandleOver=function(e){setTimeout(()=>{this.item&&(BFN.CursorScreen.cursor="arrow",BFN.CursorScreen.cursorRotation=this.item.rotation)},0)},fg.prototype.handleTextHandleOut=function(e){this.textHandleDragger.dragging||(BFN.CursorScreen.cursor=null)},fg.prototype.handleTextHandlePress=function(e){if(this.item){BFN.CursorScreen.cursorLock=!0,this.item.transforming=!0,this.currentTextHandle=this.textHandles[e.target.id],this.currentTextHandle.selected=!0,this.disableHandles(this.currentTextHandle),this.item.transformLayer.disableChildren(),this.textControl.x=this.currentTextHandle.transform.worldTransform.tx,this.textControl.y=this.currentTextHandle.transform.worldTransform.ty,this.textControl.beta=this.currentTextHandle.betaPadding-this.hBeta;var t=this.getInverseTextHandle(this.currentTextHandle);this.textAnchor.x=t.transform.worldTransform.tx,this.textAnchor.y=t.transform.worldTransform.ty,this.textAnchor.beta=t.betaPadding-this.hBeta,this.textHandleDragger.scale=this._scale,this.textHandleDragger.drag(this.currentTextHandle),e.stopPropagation()}},fg.prototype.handleScaleHandleOver=function(e){var t=e.target;setTimeout(()=>{if(this.item&&t){switch(BFN.CursorScreen.cursor="arrow",this.hoveredScaleHandle=t,this.hoveredScaleHandle.id){case"tl":case"br":BFN.CursorScreen.cursorRotation=this.hBeta+this.itemCenterBeta;break;case"tr":case"bl":BFN.CursorScreen.cursorRotation=this.hBeta-this.itemCenterBeta;break;case"l":case"r":BFN.CursorScreen.cursorRotation=this.hBeta;break;case"t":case"b":BFN.CursorScreen.cursorRotation=this.vBeta}!this.hoveredScaleHandle||["text","group"].includes(this.item.type)||this.sideHandleIDs.includes(this.hoveredScaleHandle.id)||this.scaleHandleDragger.dragging||(BFN.MainUI.tooltip="scaling_tooltip")}},0)},fg.prototype.handleScaleHandleOut=function(e){this.scaleHandleDragger.dragging||(BFN.CursorScreen.cursor=null,BFN.MainUI.tooltip=null)},fg.prototype.handleScaleHandlePress=function(e){if(this.item){BFN.CursorScreen.cursorLock=!0,BFN.MainUI.tooltip=null,this.item.transforming=!0,this.currentScaleHandle=this.scaleHandles[e.target.id],this.currentScaleHandle.selected=!0,this.transformSnapGuides.hideLines(),this.snapGuidesCleared=!0,this.disableHandles(this.currentScaleHandle),this.item.transformLayer.disableChildren();var t=this.getInverseScaleHandle(this.currentScaleHandle);if(this.scaleAnchor.x=t.noPaddingX,this.scaleAnchor.y=t.noPaddingY,this.scaleHandleDragger.scale=this._scale,this.scaleHandleDragger.drag(this.currentScaleHandle),e.stopPropagation(),!["text","group"].includes(this.item.type)){var i=Math.round(this.item.itemContentW*this.item.scale.x),r=Math.round(this.item.itemContentH*this.item.scale.y);BFN.TooltipScreen.show(i+" x "+r,!0,!0),BFN.TooltipScreen.setPosition(e.data.originalEvent.pageX,e.data.originalEvent.pageY)}}},fg.prototype.handleRotationHandleOver=function(e){setTimeout(()=>{this.item&&(BFN.CursorScreen.cursor="rotate",BFN.CursorScreen.cursorRotation=this.item.rotation)},0)},fg.prototype.handleRotationHandleOut=function(e){this.rotationHandleDragger.dragging||(BFN.CursorScreen.cursor=null)},fg.prototype.handleRotationHandlePress=function(e){if(this.rotationRadius=Math.sqrt(Math.pow(this.rotationHandle.x,2)+Math.pow(this.rotationHandle.y,2)),this.item){BFN.CursorScreen.cursorLock=!0,this.item.transforming=!0,this.rotationHandle.selected=!0,this.disableHandles(this.rotationHandle),this.item.transformLayer.disableChildren(),this.rotationHandleDragger.scale=this._scale,this.rotationHandleDragger.drag(this.rotationHandle),e.stopPropagation();var t=(Math.round((this.item.rotation+2*Math.PI)%(2*Math.PI)*(180/Math.PI)*2)/2).toFixed(1);BFN.TooltipScreen.show(t+"°",!0,!0),BFN.TooltipScreen.setPosition(e.data.originalEvent.pageX,e.data.originalEvent.pageY)}},fg.prototype.handleRotationHandleSelectAnimatorUpdate=function(e){},fg.prototype.handleTransformGizmoDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.item){BFN.TransformToolSnapGaps.show(),this.prepareItemForDragging(),this.item.accurateBoundsRequested&&this.item.addEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,this.handleItemAccurateBoundsUpdatedBind);var t=this.item.isGoodie?"history_move_graphic":"history_move_image";switch(this.item.type){case"text":t="history_move_text";break;case"group":t="history_move_selection"}this.item.createTransition(t)}this.handleTransformGizmoDragging(e)},fg.prototype.prepareItemForDragging=function(){if(this.item){this.item.dispatchEvent(BFN.TransformItemEvents.GET_SNAP_COORDINATES);var e=BFN.Util.getTransformItemBounds(this.item);this.itemCenterOffsetX=this.transformTool.x-(e.minX+this.item.accurateBounds.minX+this.item.accurateBounds.width/2),this.itemCenterOffsetY=this.transformTool.y-(e.minY+this.item.accurateBounds.minY+this.item.accurateBounds.height/2);var t=this.frameWidth/2+(e.width/2+10),i=this.frameHeight/2+(e.height/2+10);this.gizmoDragger.setBounds(-t,-i,t,i)}},fg.prototype.handleItemAccurateBoundsUpdated=function(e){e.dispatcher.removeEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,this.handleItemAccurateBoundsUpdatedBind),this.item&&this.item.transforming&&this.gizmoDragger.dragging&&this.prepareItemForDragging()},fg.prototype.handleTransformGizmoDragging=function(e){var t=this;this.snapDistanceTransform=this.screenPixelSnapThreshold*(1/this._scale),this.snapDistanceTransformSnapped=1/this._scale,this.snapGuidesCleared=!1,this.item&&(this.gizmoDragger.wasDragged&&!this.item.itemMoved&&(this.item.itemMoved=!0,this.toggleItemTransform(!0)),this.itemCenterX=this.transformTool.x,this.itemCenterY=this.transformTool.y,BFN.TransformModel.snappingEnabled&&this.gizmoDragger.wasDragged&&this.item.accurateBounds&&function(){for(var e=!1,i=!1,r={},a=0;a<t.item.snapCoordinates.length;a++){var n=t.item.snapCoordinates[a],o={},s=null;switch(n.position){case"horizontal":o.left=t.itemCenterX-t.item.accurateBounds.width/2-n.value-t.itemCenterOffsetX,o.center=t.itemCenterX-n.value-t.itemCenterOffsetX,o.right=t.itemCenterX+t.item.accurateBounds.width/2-n.value-t.itemCenterOffsetX,Math.abs(o.left)<(e?t.snapDistanceTransformSnapped:t.snapDistanceTransform)?(t.itemCenterX=e?t.itemCenterX:n.value+t.item.accurateBounds.width/2+t.itemCenterOffsetX,s="left",e=!0):Math.abs(o.center)<(e?t.snapDistanceTransformSnapped:t.snapDistanceTransform)?(t.itemCenterX=e?t.itemCenterX:n.value+t.itemCenterOffsetX,s="center",e=!0):Math.abs(o.right)<(e?t.snapDistanceTransformSnapped:t.snapDistanceTransform)&&(t.itemCenterX=e?t.itemCenterX:n.value-t.item.accurateBounds.width/2+t.itemCenterOffsetX,s="right",e=!0),s&&(r.hasOwnProperty(s)||(r[s]={maskedSegment:null,rulerSegmentA:null,rulerSegmentB:null,values:[],axis:"y"}),r[s].values.push(n.bounds.top,n.bounds.bottom));break;case"vertical":o.top=t.itemCenterY-t.item.accurateBounds.height/2-n.value-t.itemCenterOffsetY,o.middle=t.itemCenterY-n.value-t.itemCenterOffsetY,o.bottom=t.itemCenterY+t.item.accurateBounds.height/2-n.value-t.itemCenterOffsetY,Math.abs(o.top)<(i?t.snapDistanceTransformSnapped:t.snapDistanceTransform)?(t.itemCenterY=i?t.itemCenterY:n.value+t.item.accurateBounds.height/2+t.itemCenterOffsetY,s="top",i=!0):Math.abs(o.middle)<(i?t.snapDistanceTransformSnapped:t.snapDistanceTransform)?(t.itemCenterY=i?t.itemCenterY:n.value+t.itemCenterOffsetY,s="middle",i=!0):Math.abs(o.bottom)<(i?t.snapDistanceTransformSnapped:t.snapDistanceTransform)&&(t.itemCenterY=i?t.itemCenterY:n.value-t.item.accurateBounds.height/2+t.itemCenterOffsetY,s="bottom",i=!0),s&&(r.hasOwnProperty(s)||(r[s]={maskedSegment:null,rulerSegmentA:null,rulerSegmentB:null,values:[],axis:"x"}),r[s].values.push(n.bounds.left,n.bounds.right))}}BFN.TransformToolSnapGaps.clearSnapGaps();var l={left:null,top:null,right:null,bottom:null},h=new BFN.Rectangle(t.itemCenterX-t.item.accurateBounds.width/2-t.itemCenterOffsetX,t.itemCenterY-t.item.accurateBounds.height/2-t.itemCenterOffsetY,t.item.accurateBounds.width,t.item.accurateBounds.height),c=()=>{var e={left:null,top:null,right:null,bottom:null};return t.item.otherItemAccurateBoundsList.forEach(t=>{var i=h.neighbors(t);i&&(!e[i.side]||e[i.side].distance>i.distance)&&(e[i.side]=i)}),e},u=c(),d={horizontal:null,vertical:null},m=t.item.snapGapRects,p=function(e){var i=u[e];i&&function(){var r=i.direction,a=function(a){m[r][a].forEach(n=>{var o=i.intersectRect.neighbors(n);if(o&&o.direction===r&&!h.intersects(o.gapRect)){var s=a-i.distance;Math.abs(s)<t.snapDistanceTransform&&(["right","bottom"].includes(e)&&(s*=-1),null===d[r]&&(d[r]=s),Math.abs(s)<Math.abs(d[r])&&(d[r]=s))}})};for(var n in m[r])a(n)}()};for(var g in u)p(g);for(var f in d){var v="horizontal"===f?u.left:u.top,y="horizontal"===f?u.right:u.bottom;if(v&&y){var x=(v.distance+y.distance)/2-v.distance;Math.abs(x)<t.snapDistanceTransform&&(null===d[f]||null!==d[f]&&Math.abs(x)<Math.abs(d[f]))&&(d[f]=x,"horizontal"===f?l.left=l.right=!0:"vertical"===f&&(l.top=l.bottom=!0))}}for(var _ in d)if(d[_])switch(_){case"horizontal":t.itemCenterX+=d[_];break;case"vertical":t.itemCenterY+=d[_]}h.x=t.itemCenterX-t.item.accurateBounds.width/2-t.itemCenterOffsetX,h.y=t.itemCenterY-t.item.accurateBounds.height/2-t.itemCenterOffsetY,u=c();var I={horizontal:[],vertical:[]},T=function(e){var t=u[e];t&&function(){var i=t.direction;for(var r in m[i]){if(parseInt(r)===Math.round(t.distance))m[i][r].forEach(r=>{var a=t.gapRect.neighbors(r);a&&a.direction===i&&null!==d[i]&&(I[i].includes(r)||I[i].push(r),l[e]=!0)})}}()};for(var b in u)T(b);for(var S in u){var C=u[S];C&&l[S]&&I[C.direction].push(C.gapRect)}var B=function(e){I[e].forEach(i=>{var r=BFN.TransformToolSnapGaps.toLocal(new PIXI.Point(i.left,i.top),t),a=BFN.TransformToolSnapGaps.toLocal(new PIXI.Point(i.right,i.bottom),t),n=new BFN.Rectangle(r.x,r.y,a.x-r.x,a.y-r.y),o="";switch(e){case"horizontal":o+=Math.round(i.width);break;case"vertical":o+=Math.round(i.height)}BFN.TransformToolSnapGaps.drawSnapGap(n,e,o)})};for(var F in I)B(F);var E={x:{a:t.itemCenterX-t.item.accurateBounds.width/2-t.itemCenterOffsetX,b:t.itemCenterX+t.item.accurateBounds.width/2-t.itemCenterOffsetX},y:{a:t.itemCenterY-t.item.accurateBounds.height/2-t.itemCenterOffsetY,b:t.itemCenterY+t.item.accurateBounds.height/2-t.itemCenterOffsetY}},P={x:{a:[],b:[]},y:{a:[],b:[]}};["left","center","right","top","middle","bottom"].forEach(e=>{if(r.hasOwnProperty(e)){var i=r[e];i.maskedSegment={startPoint:new PIXI.Point,endPoint:new PIXI.Point},i.rulerSegmentA={startPoint:new PIXI.Point,endPoint:new PIXI.Point},i.rulerSegmentB={startPoint:new PIXI.Point,endPoint:new PIXI.Point},i.maskedSegment.startPoint[i.axis]=E[i.axis].a,i.maskedSegment.endPoint[i.axis]=E[i.axis].b,i.rulerSegmentA.startPoint[i.axis]=i.rulerSegmentA.endPoint[i.axis]=E[i.axis].a,i.rulerSegmentB.startPoint[i.axis]=i.rulerSegmentB.endPoint[i.axis]=E[i.axis].b,i.values.sort((e,t)=>e-t);for(var a=0;a<i.values.length;a++){var n=i.values[a],o=i.values[i.values.length-1-a];i.maskedSegment.startPoint[i.axis]=Math.min(i.maskedSegment.startPoint[i.axis],n,E[i.axis].a),i.maskedSegment.endPoint[i.axis]=Math.max(i.maskedSegment.startPoint[i.axis],n,E[i.axis].b),n<i.rulerSegmentA.endPoint[i.axis]-1&&(i.rulerSegmentA.startPoint[i.axis]=n),o>i.rulerSegmentB.startPoint[i.axis]+1&&(i.rulerSegmentB.endPoint[i.axis]=o)}i.maskedSegment.startPoint=t.toGlobal(i.maskedSegment.startPoint),i.maskedSegment.endPoint=t.toGlobal(i.maskedSegment.endPoint),i.rulerSegmentA.startPoint=t.toGlobal(i.rulerSegmentA.startPoint),i.rulerSegmentA.endPoint=t.toGlobal(i.rulerSegmentA.endPoint),i.rulerSegmentB.startPoint=t.toGlobal(i.rulerSegmentB.startPoint),i.rulerSegmentB.endPoint=t.toGlobal(i.rulerSegmentB.endPoint);var s=Math.round(i.rulerSegmentA.endPoint[i.axis]-i.rulerSegmentA.startPoint[i.axis]),c=Math.round(i.rulerSegmentB.endPoint[i.axis]-i.rulerSegmentB.startPoint[i.axis]);switch(P[i.axis].a.includes(s)?i.rulerSegmentA=null:P[i.axis].a.push(s),P[i.axis].b.includes(c)?i.rulerSegmentB=null:P[i.axis].b.push(c),e){case"top":case"middle":case"bottom":l.left&&(i.rulerSegmentA={startPoint:new PIXI.Point,endPoint:new PIXI.Point}),l.right&&(i.rulerSegmentB={startPoint:new PIXI.Point,endPoint:new PIXI.Point});break;case"left":case"center":case"right":l.top&&(i.rulerSegmentA={startPoint:new PIXI.Point,endPoint:new PIXI.Point}),l.bottom&&(i.rulerSegmentB={startPoint:new PIXI.Point,endPoint:new PIXI.Point})}var u=t.transformLayer.toGlobal(new PIXI.Point(h.x,h.y)),d=t.transformLayer.toGlobal(new PIXI.Point(h.x+h.width,h.y+h.height)),m=new BFN.Rectangle(u.x,u.y,d.x-u.x,d.y-u.y);t.showSnapGuideLine(e,[i.maskedSegment],BFN.TransformModel.showMeasurements?[i.rulerSegmentA,i.rulerSegmentB]:null,m)}})}(),this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.snapGuidesCleared||this.transformSnapGuides.hideLines(),this.transformSnapGuides.setCenter(this.itemCenterX-this.itemCenterOffsetX,this.itemCenterY-this.itemCenterOffsetY),this.transformSnapGuides.setDimensions(this.item.accurateBounds.width,this.item.accurateBounds.height),this.transformSnapGuides.showRulerLabels(),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,"group"==this.item.type&&this.item.updateGroupTransform()),this.item&&this.gizmoDragger.wasDragged&&this.item.updateHiResTextBounds()},fg.prototype.handleTransformGizmoDraggingComplete=function(e){this.item,BFN.smoothPictureDisabled=!1;var t=null;this.item&&(this.item.transforming=!1,this.item.itemMoved&&(this.item.itemMoved=!1,"group"===this.item.type&&this.item.subSelectedItem&&(this.item.subSelectedItem=null),this.conformItemToBounds(),this.updateDisplay(),this.toggleItemTransform(!1),this.item.registerTransition(!1,!1)),this.item.subSelectedItem&&(t=this.item.subSelectedItem,this.item.subSelectedItem=null),t||(this.fadeAnimator.increase(),"group"==this.item.type&&this.item.fadeAnimator.increase()),BFN.TransformToolSnapGaps.clearSnapGaps(),BFN.TransformToolSnapGaps.hide(),this.item.updateHiResText()),BFN.TransformStateModel.stopBulkTransition(),t&&(t.selectedByMouse=!1,t.transformLayer.deselectItem(),t.transformLayer.lastPressedItem=t,t.transformLayer.clickItem(t,!0),t.transformLayer.selectItem(t))},fg.prototype.handleTextHandleDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.item&&"text"==this.item.type){this.item.buttonMode=!1,this.item.createTransition("history_resize_text"),BFN.FabricManager.showTransformItemIText(this.item);var t=this.item.iText;this.iTextData={topLeft:{x:t.left,y:t.top},topRight:{x:t.left+Math.cos(this.hBeta)*(t.width*t.scaleX),y:t.top+Math.sin(this.hBeta)*(t.width*t.scaleX)}};var i=this.item;this.itemData={topLeft:{x:i.x,y:i.y},topRight:{x:i.x+Math.cos(this.hBeta)*this.itemWidth,y:i.y+Math.sin(this.hBeta)*this.itemWidth}},this.handleTextHandleDragging(e)}},fg.prototype.handleTextHandleDragging=function(e){this.item&&"text"==this.item.type&&(this.resizeText(),this.item.toggleHiResText(!1))},fg.prototype.handleTextHandleDraggingComplete=function(e){this.item||BeFunky.throwError("Item was deselected before handleTextHandleDraggingComplete"),BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.item&&(this.item.buttonMode=!0,this.item.transforming=!1,this.textHandleDragger.wasDragged?(this.item.setTextWidth(this.itemWidth),this.conformItemToBounds(),this.updateDisplayForTextResize(),this.item.registerTransition(),BFN.FabricManager.hideTransformItemIText(this.item)):BFN.FabricManager.hideTransformItemIText(this.item),(!this.currentTextHandle||this.currentTextHandle&&!this.currentTextHandle.hovered)&&(BFN.CursorScreen.cursor=null)),this.currentTextHandle&&(this.currentTextHandle.selected=!1,this.currentTextHandle=null),this.enableHandles(),this.item.transformLayer.enableChildren(),this.transformGizmo.x=this.transformGizmo.y=0,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.updateDisplay(),this.item&&this.item.updateHiResTextBounds()},fg.prototype.handleScaleHandleDraggingStarted=function(e){if(this.transformSnapGuidesContainer.alpha=1,this.transformSnapGuidesContainer.visible=!0,BFN.smoothPictureDisabled=!0,this.item){if(BFN.TransformModel.snappingEnabled)if(this.item.dispatchEvent(BFN.TransformItemEvents.GET_SNAP_COORDINATES),this.drawSnapHelpers)BFN.PhotoEditorCanvas.transformLayerVeil.opacity=0,this.snapLinesGraphic||(this.snapLinesGraphic=new PIXI.Graphics,BFN.PhotoEditorCanvas.canvas.addChild(this.snapLinesGraphic)),this.snapLinesGraphic.x=this.transformLayer.x,this.snapLinesGraphic.y=this.transformLayer.y,this.snapLinesGraphic.clear(),this.snapLinesGraphic.lineStyle(1,16711680),this.item.snapCoordinates.forEach(e=>{switch(e.position){case"horizontal":this.snapLinesGraphic.moveTo(e.value,-2e3),this.snapLinesGraphic.lineTo(e.value,2e3);break;case"vertical":this.snapLinesGraphic.moveTo(-2e3,e.value),this.snapLinesGraphic.lineTo(2e3,e.value)}}),this.itemGuidesGraphic||(this.itemGuidesGraphic=new PIXI.Graphics,BFN.PhotoEditorCanvas.canvas.addChild(this.itemGuidesGraphic)),this.itemGuidesGraphic.x=this.transformLayer.x,this.itemGuidesGraphic.y=this.transformLayer.y,this.itemGuidesGraphic.clear();this.item.buttonMode=!1;var t=this.item.isGoodie?"history_scale_graphic":"history_scale_image";switch(this.item.type){case"text":t="history_font_size";break;case"group":t="history_scale_selection"}this.item.createTransition(t),this.toggleItemTransform(!0),this.transformToolVO=UITools.getToolVO("transform")}},fg.prototype.handleScaleHandleDragging=function(e){if(this.snapDistanceTransform=this.screenPixelSnapThreshold*(1/this._scale),this.snapDistanceTransformSnapped=1/this._scale,this.snapGuidesCleared=!1,this.item&&this.currentScaleHandle){var t=this.scaleHandleDragger.ctrlKey,i=this.scaleHandleDragger.shiftKey,r=this.scaleHandleDragger.altKey,a="frame_texture"===this.item.type,n=a&&this.item.itemContent.frameSprite.frameScaling,o=a&&this.item.itemContent.frameSprite.frameStretching,s=a&&this.item.itemContent.frameSprite.frameScalingCentered,l="text"!==this.item.type&&"group"!==this.item.type,h=this.sideHandleIDs.includes(this.currentScaleHandle.id);if(a){var c=this.item.itemContent.frameSprite;t||h?(o&&(c.stopFrameStretching(),c.updateDisplay()),n&&r==s||c.startFrameScaling(this.getInverseFrameAnchorSide(),r)):(n&&c.stopFrameScaling(),i?o||c.startFrameStretching():o&&(c.stopFrameStretching(),c.updateDisplay()))}(i||h)&&l?this.freeformScale():this.constrainedScale(),this.item.updateSmoothingScale(),this.item.basicShapeVO&&this.item.updateShapeTexture(!1),this.snapGuidesCleared||this.transformSnapGuides.hideLines()}if(this.drawGizmo(),this.item&&BFN.TooltipScreen.active){var u=Math.round(this.item.itemContentW*this.item.scale.x),d=Math.round(this.item.itemContentH*this.item.scale.y);BFN.TooltipScreen.setMessage(u+" x "+d)}this.item&&this.item.updateHiResTextBounds()},fg.prototype.handleScaleHandleDraggingComplete=function(e){(this.transformSnapGuidesContainer.alpha=0,this.transformSnapGuidesContainer.visible=!1,this.item||BeFunky.throwError("Item was deselected before handleScaleHandleDraggingComplete"),BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.item&&"frame_texture"===this.item.type&&(this.item.itemContent.frameSprite.stopFrameScaling(),this.item.itemContent.frameSprite.stopFrameStretching()),this.conformItemToBounds(),this.toggleItemTransform(!1),this.item&&(this.item.buttonMode=!0,this.item.transforming=!1,this.scaleHandleDragger.wasDragged&&(this.item.resetFrameTextureScale(),this.item.updateShapeTexture(),"group"==this.item.type?this.item.updateHitAreaOrTextWidths():"text"==this.item.type?this.item.setTextWidth(this.itemWidth,!0):this.item.updateHitArea(),this.item.ignoreTextHeight=!0,this.item.registerTransition(!1,"text"!=this.item.type),delete this.item.ignoreTextHeight),this.item.updateSmoothingScale(),this.currentScaleHandle&&!this.currentScaleHandle.hovered&&(BFN.CursorScreen.cursor=null)),this.currentScaleHandle&&(this.currentScaleHandle.selected=!1),this.currentScaleHandle=null,this.enableHandles(),this.item)?this.item.transformLayer.enableChildren():BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).enableChildren();this.transformGizmo.x=this.transformGizmo.y=0,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.updateDisplay(),BFN.TooltipScreen.active&&BFN.TooltipScreen.hide()},fg.prototype.handleRotationHandleDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.item){this.item.buttonMode=!1;var t=this.item.isGoodie?"history_rotate_graphic":"history_rotate_image";switch(this.item.type){case"text":t="history_rotate_text";break;case"group":t="history_rotate_selection"}this.item.createTransition(t),this.toggleItemTransform(!0)}},fg.prototype.handleRotationHandleDragging=function(e){this.item&&this.constrainedRotate(),this.drawGizmo();var t=(Math.round((this.item.rotation+2*Math.PI)%(2*Math.PI)*(180/Math.PI)*2)/2).toFixed(1);BFN.TooltipScreen.setMessage(t+"°"),this.item&&this.item.updateHiResTextBounds()},fg.prototype.handleRotationHandleDraggingComplete=function(e){this.item||BeFunky.throwError("Item was deselected before handleRotationHandleDraggingComplete"),BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.conformItemToBounds(),this.toggleItemTransform(!1),this.item&&(this.item.buttonMode=!0,this.item.transforming=!1,this.rotationHandleDragger.wasDragged&&this.item.registerTransition(!1,!0),this.item.updateSmoothingScale(),this.rotationHandle.hovered||(BFN.CursorScreen.cursor=null)),this.rotationHandle.selected=!1,this.enableHandles(),this.item.transformLayer.enableChildren(),this.updateDisplay(),BFN.TooltipScreen.hide()},fg.prototype.handleFadeAnimatorUpdate=function(e){this.transformTool.alpha=this.fadeAnimator.animationFactor,this.transformTool.visible=this.transformTool.alpha>0,this.transformSnapGuidesContainer.alpha=1-this.fadeAnimator.animationFactor,this.transformSnapGuidesContainer.visible=this.transformSnapGuidesContainer.alpha>0},fg.prototype.handleFadeAnimatorUpdateComplete=function(e){this.transformSnapGuides.hideLines()},Object.defineProperty(fg.prototype,"scale",{set:function(e){this._scale=e;try{this.transformGizmoOutline.scale=this.transformGizmoHandle.scale=this._scale,this.transformSnapGuides.scale=this._scale,this.transformToolFrame.scale=this._scale,this.updateHandleScales(),this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.drawGizmo()}catch(e){}},get:function(){return this._scale}}),Object.defineProperty(fg.prototype,"transformSnapGuides",{get:function(){return this._transformSnapGuides||(this._transformSnapGuides=new BFN.TransformToolSnapGuides,this.transformSnapGuidesContainer.addChild(this._transformSnapGuides)),this._transformSnapGuides}}),BFN.TransformTool=fg,vg.prototype=Object.create(PIXI.Container.prototype),vg.prototype.init=function(){BeFunky.log("TransformToolFrame Init"),this.initDefaultValues(),this.initScaleHandleTextures(),this.initControlContainer(),this.initImageSprite(),this.initImageSpriteVeil(),this.initTouchSurfaces(),this.initFadeContainer(),this.initSpriteOutlines(),this.initScaleHandles(),this.initDraggers(),this.initFadeAnimator()},vg.prototype.initDefaultValues=function(){this.active=!1,this.focusedFrameSprite=null,this.transformItem=null,this.currentScaleHandle=null,this.scaleControlBounds=null,this.scaleMode=null,this.scaleHandleIDs=["l","tl","t","tr","r","br","b","bl"],this.cornerHandleIDs=["tl","tr","br","bl"],this.sideHandleIDs=["l","t","r","b"],this.PId2=Math.PI/2,this.imageOutlinePadding=10,this.scaleAnchor=new PIXI.Point,this.scaleControl=new PIXI.Point,this._scale=1},vg.prototype.initScaleHandleTextures=function(){this.handleTextureCorner=PIXI.RenderTexture.create(20,20),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:1073741824,cornerRadius:2,paddingX:1,paddingT:1.5,paddingB:9.5}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:1073741824,cornerRadius:2,paddingY:1,paddingL:1.5,paddingR:9.5,clear:!1}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:4282154954,cornerRadius:1,paddingX:2,paddingT:2.5,paddingB:10.5,clear:!1}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:4282154954,cornerRadius:1,paddingY:2,paddingL:2.5,paddingR:10.5,clear:!1}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:4294967295,cornerRadius:1,paddingX:3,paddingT:3.5,paddingB:11.5,clear:!1}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:4294967295,cornerRadius:1,paddingY:3,paddingL:3.5,paddingR:11.5,clear:!1}),this.handleTextureSide=PIXI.RenderTexture.create(20,20),BFN.graphics.drawShape("roundedRect",this.handleTextureSide,{fillColor:1073741824,cornerRadius:2,paddingY:5}),BFN.graphics.drawShape("roundedRect",this.handleTextureSide,{strokeWidth:1,strokeColor:4282154954,fillColor:4294967295,cornerRadius:1,paddingX:1,paddingY:6,clear:!1}),this.handleTextureCircle=PIXI.RenderTexture.create(20,20),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{fillColor:1073741824}),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{strokeWidth:1.5,strokeColor:4294967295,fillColor:4282154954,paddingX:1,paddingY:1,clear:!1})},vg.prototype.initControlContainer=function(){this.controlContainer=new PIXI.Container,this.addChild(this.controlContainer)},vg.prototype.initImageSprite=function(){this.imageSprite=new PIXI.Sprite,this.imageSprite.pluginName="smooth_picture",this.controlContainer.addChild(this.imageSprite)},vg.prototype.initImageSpriteVeil=function(){this.imageSpriteVeil=new BFN.WindowedVeil(BFN.AppBackgroundColor,.6),this.controlContainer.addChild(this.imageSpriteVeil)},vg.prototype.initTouchSurfaces=function(){this.imageTouchSurface=new PIXI.Graphics,this.imageTouchSurface.interactive=!0,this.imageTouchSurface.beginFill(0,0),this.imageTouchSurface.drawRect(0,0,100,100),this.imageTouchSurface.endFill(),this.imageTouchSurface.on("pointerover",this.handleTouchSurfaceOver.bind(this)),this.imageTouchSurface.on("pointerout",this.handleTouchSurfaceOut.bind(this)),this.imageTouchSurface.on("pointerdown",this.handleTouchSurfacePress.bind(this)),this.controlContainer.addChild(this.imageTouchSurface),this.frameTouchSurface=new PIXI.Graphics,this.frameTouchSurface.interactive=!0,this.frameTouchSurface.beginFill(0,0),this.frameTouchSurface.drawRect(0,0,100,100),this.frameTouchSurface.endFill(),this.frameTouchSurface.on("pointerover",this.handleTouchSurfaceOver.bind(this)),this.frameTouchSurface.on("pointerout",this.handleTouchSurfaceOut.bind(this)),this.frameTouchSurface.on("pointerdown",this.handleTouchSurfacePress.bind(this)),this.controlContainer.addChild(this.frameTouchSurface)},vg.prototype.initFadeContainer=function(){this.fadeContainer=new PIXI.Container,this.controlContainer.addChild(this.fadeContainer)},vg.prototype.initSpriteOutlines=function(){this.imageSpriteOutline=new BFN.StrokeRectangle(!0,!0,2,!0,4293783021,4282154954,"transform_tool_image_outline"),this.imageSpriteOutline.setDimensions(200,200),this.fadeContainer.addChild(this.imageSpriteOutline),this.frameSpriteOutline=new BFN.StrokeRectangle(!1,!0,1,!0,4293783021,4282154954,"transform_tool_frame_outline"),this.frameSpriteOutline.setDimensions(100,100),this.fadeContainer.addChild(this.frameSpriteOutline)},vg.prototype.initScaleHandles=function(){this.scaleHandleContainer=new PIXI.Container,this.fadeContainer.addChild(this.scaleHandleContainer),this.imageScaleHandles={};for(var e=0;e<this.cornerHandleIDs.length;e++)this.imageScaleHandles[this.cornerHandleIDs[e]]=this.createScaleHandle(this.cornerHandleIDs[e],"image");this.frameScaleHandles={};for(var t=0;t<this.scaleHandleIDs.length;t++)this.frameScaleHandles[this.scaleHandleIDs[t]]=this.createScaleHandle(this.scaleHandleIDs[t],"frame")},vg.prototype.initDraggers=function(){this.touchSurfaceDragger=new BFN.Dragger,this.touchSurfaceDragger.useBounds=!1,this.touchSurfaceDragger.autoDrag=!1,this.touchSurfaceDragger.preventSelectionDrag=!0,this.touchSurfaceDragger.deselectItemGroup=!1,this.touchSurfaceDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleTouchSurfaceDraggingStarted.bind(this)),this.touchSurfaceDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleTouchSurfaceDragging.bind(this)),this.touchSurfaceDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleTouchSurfaceDraggingComplete.bind(this)),this.scaleHandleDragger=new BFN.Dragger,this.scaleHandleDragger.useBounds=!1,this.scaleHandleDragger.autoDrag=!1,this.scaleHandleDragger.preventSelectionDrag=!0,this.scaleHandleDragger.deselectItemGroup=!1,this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleScaleHandleDraggingStarted.bind(this)),this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleScaleHandleDragging.bind(this)),this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleScaleHandleDraggingComplete.bind(this))},vg.prototype.initFadeAnimator=function(){this.fadeAnimator=new BFN.Animator,this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdate.bind(this)),this.fadeAnimator.setAnimatorFactor(0)},vg.prototype.setup=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{this.imageSprite.texture.destroy(!1)}catch(e){}if(this.imageSprite.texture=PIXI.Texture.EMPTY,e&&"frame_texture"==e.type){this.transformItem=e,this.focusedFrameSprite=this.transformItem.itemContent.frameSprite,this.imageSprite.renderable=!0,this.imageSprite.texture=new PIXI.Texture(this.focusedFrameSprite.baseTexture),this.imageSprite.texture.rotate=this.transformItem.flippedHorizontal?this.transformItem.flippedVertical?4:12:this.transformItem.flippedVertical?8:0,this.controlContainer.x=this.transformItem.x,this.controlContainer.y=this.transformItem.y,this.controlContainer.rotation=this.transformItem.rotation,this.updateImageTouchSurfaceDisplay(),this.updateFrameTouchSurfaceDisplay(),this.updateOutlineDisplays(),this.updateScaleHandlePositions(),this.updateImageSpriteDisplay(),this.fadeAnimator.increase(),this.active=!0,this.transformTool.fadeAnimator.decrease(),BFN.TransformModel.selectedTransformItem===this.transformItem&&(BFN.TransformModel.selectedTransformItem=this.transformItem),this.setScaleControlRange(),this.updateScaleControl(),setTimeout(()=>{this.transformItem&&(this.transformItem.renderable=!1,BFN.MainUI.renderCanvas())},50);var t=null;if(this.transformItem.itemContentMask&&!this.transformItem.isShape){var i=this.transformItem.itemContentMask.texture,r=new PIXI.Sprite(i),a=PIXI.RenderTexture.create(i.width,i.height);a.fillColor(16777215);var n=new PIXI.Sprite(a);n.mask=r,t=PIXI.RenderTexture.create(i.width,i.height),BFN.Stage.render(n,t),a.destroyGC(!0),n.mask=null,n.destroy(!0),r.destroy(!1)}var o=this.transformItem.maskFlippedHorizontal?!this.transformItem.flippedHorizontal:this.transformItem.flippedHorizontal,s=this.transformItem.maskFlippedVertical?!this.transformItem.flippedVertical:this.transformItem.flippedVertical;this.imageSpriteVeil.setMaskTexture(t||(this.transformItem.itemContentMask?this.transformItem.itemContentMask.texture:null),o,s),t&&t.destroyGC(!0)}else this.imageSprite.renderable=!1,this.fadeAnimator.decrease(),this.active=!1,this.transformTool.fadeAnimator.increase(),this.transformItem&&(BFN.TransformModel.selectedTransformItem===this.transformItem&&(BFN.TransformModel.selectedTransformItem=this.transformItem),this.transformItem.renderable=!0,this.transformItem=null,this.focusedFrameSprite=null);this.scale=this.scale,BFN.PIXITicker.nudge(),BFN.MainUI.tooltip=null,BFN.MainUI.requestRender()},vg.prototype.setImageScale=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.transformItem){if(e=Math.max(1,e),this.imageScaleObject||(this.imageScaleObject={}),this.imageScaleObject.scaling||(this.imageScaleObject.scaling=!0,this.imageScaleObject.scale=-1,this.imageScaleObject.imageBaseScale=1/Math.max(this.frameTouchSurface.width/this.imageTouchSurface.width,this.frameTouchSurface.height/this.imageTouchSurface.height),this.imageScaleObject.imageBaseWidth=this.imageTouchSurface.width,this.imageScaleObject.imageBaseHeight=this.imageTouchSurface.height,this.imageScaleObject.imageBaseOriginX=this.frameTouchSurface.x+this.frameTouchSurface.width/2-this.imageTouchSurface.x,this.imageScaleObject.imageBaseOriginY=this.frameTouchSurface.y+this.frameTouchSurface.height/2-this.imageTouchSurface.y,this.imageScaleObject.imageBaseOriginFactorX=this.imageScaleObject.imageBaseOriginX/this.imageScaleObject.imageBaseWidth,this.imageScaleObject.imageBaseOriginFactorY=this.imageScaleObject.imageBaseOriginY/this.imageScaleObject.imageBaseHeight,this.transformItem.createTransition("history_image_region")),this.imageScaleObject.scale!=e){this.imageScaleObject.scale=e;var i=e/this.imageScaleObject.imageBaseScale;this.imageTouchSurface.width=Math.max(this.frameTouchSurface.width,this.imageScaleObject.imageBaseWidth*i),this.imageTouchSurface.height=Math.max(this.frameTouchSurface.height,this.imageScaleObject.imageBaseHeight*i),this.imageTouchSurface.x=this.frameTouchSurface.x+this.frameTouchSurface.width/2-this.imageTouchSurface.width*this.imageScaleObject.imageBaseOriginFactorX,this.imageTouchSurface.y=this.frameTouchSurface.y+this.frameTouchSurface.height/2-this.imageTouchSurface.height*this.imageScaleObject.imageBaseOriginFactorY,this.imageTouchSurface.x=Math.min(this.frameTouchSurface.x,Math.max(this.frameTouchSurface.x+this.frameTouchSurface.width-this.imageTouchSurface.width,this.imageTouchSurface.x)),this.imageTouchSurface.y=Math.min(this.frameTouchSurface.y,Math.max(this.frameTouchSurface.y+this.frameTouchSurface.height-this.imageTouchSurface.height,this.imageTouchSurface.y)),this.updateImageOutlineDisplay(),this.updateImageScaleHandlePositions(),this.updateImageSpriteDisplay(),this.updateTransformItem(),this.updateImageSpriteVeilDisplay()}this.imageScaleObject.scaling&&!t&&(delete this.imageScaleObject,this.transformItem.updateContentDimensions(),this.transformItem.updateAccurateBounds(),this.transformItem.updateSmoothingScale(),this.transformItem.registerTransition(!1,!1),this.setup(this.transformItem))}else this.imageScaleObject&&delete this.imageScaleObject},vg.prototype.setScaleControlRange=function(){if(this.transformItem){var e=this.focusedFrameSprite,t=Math.max(this.frameTouchSurface.width/this.imageTouchSurface.width,this.frameTouchSurface.height/this.imageTouchSurface.height),i=this.imageTouchSurface.width*t,r=this.imageTouchSurface.height*t,a=this.transformTool.minSizeFrame,n=this.frameTouchSurface.width/a*e.baseWidth,o=this.frameTouchSurface.height/a*e.baseHeight,s=Math.min(n/i,o/r);UITools.getParamObject("layer_mask_image_crop_size").max=Math.max(100,Math.floor(100*s)),UITools.updateToolControl("layer_mask_image_crop_size")}},vg.prototype.updateScaleControl=function(){if(this.transformItem){var e=1/Math.max(this.frameTouchSurface.width/this.imageTouchSurface.width,this.frameTouchSurface.height/this.imageTouchSurface.height),t=Math.floor(100*e),i=UITools.getParamObject("layer_mask_image_crop_size");i.max=Math.max(100,t,i.max),UITools.setControlValue("layer_mask_image_crop_size",t),UITools.updateToolControl("layer_mask_image_crop_size")}},vg.prototype.updateTransformItem=function(){if(this.transformItem){var e=this.focusedFrameSprite,t=this.frameTouchSurface.width,i=this.frameTouchSurface.height,r=e.baseWidth,a=e.baseHeight,n=Math.max(t/r,i/a),o=r*n,s=a*n,l=this.imageTouchSurface.width,h=this.imageTouchSurface.height,c=this.imageTouchSurface.width-this.frameTouchSurface.width,u=this.imageTouchSurface.height-this.frameTouchSurface.height;e.frameWidth=t,e.frameHeight=i,e.textureScaleX=l/o,e.textureScaleY=h/s,e.offsetFactorX=c?Math.max(0,Math.min(1,(this.frameTouchSurface.x-this.imageTouchSurface.x)/c)):.5,e.offsetFactorY=u?Math.max(0,Math.min(1,(this.frameTouchSurface.y-this.imageTouchSurface.y)/u)):.5,this.transformItem.flippedHorizontal&&(e.offsetFactorX=1-e.offsetFactorX),this.transformItem.flippedVertical&&(e.offsetFactorY=1-e.offsetFactorY),e.updateDisplay();var d=this.frameTouchSurface.x,m=this.frameTouchSurface.y,p=Math.sqrt(Math.pow(d,2)+Math.pow(m,2)),g=Math.atan2(m,d)+this.transformItem.rotation;this.transformItem.x=this.controlContainer.x+Math.cos(g)*p,this.transformItem.y=this.controlContainer.y+Math.sin(g)*p,this.transformItem.itemContent.x=this.transformItem.flippedHorizontal?this.frameTouchSurface.width:0,this.transformItem.itemContent.y=this.transformItem.flippedVertical?this.frameTouchSurface.height:0}},vg.prototype.updateImageSpriteDisplay=function(){this.updateImageSpriteDimensions(),this.updateImageSpritePosition()},vg.prototype.updateImageSpriteDimensions=function(){this.imageSprite.width=this.imageTouchSurface.width,this.imageSprite.height=this.imageTouchSurface.height,this.updateImageSpriteSmoothing()},vg.prototype.updateImageSpritePosition=function(){this.imageSprite.x=this.imageTouchSurface.x,this.imageSprite.y=this.imageTouchSurface.y},vg.prototype.updateImageSpriteSmoothing=function(){this.imageSprite.currentScale=this.imageSprite.scale.x*this._scale,this.imageSprite.currentScaleY=this.imageSprite.scale.y*this._scale},vg.prototype.updateImageSpriteVeilDisplay=function(){this.imageSpriteVeil.x=this.imageTouchSurface.x,this.imageSpriteVeil.y=this.imageTouchSurface.y,this.imageSpriteVeil.update(this.imageTouchSurface.width,this.imageTouchSurface.height,this.frameTouchSurface.x-this.imageTouchSurface.x,this.frameTouchSurface.y-this.imageTouchSurface.y,this.frameTouchSurface.width,this.frameTouchSurface.height)},vg.prototype.updateImageTouchSurfaceDisplay=function(){this.updateImageTouchSurfaceDimensions(),this.updateImageTouchSurfacePosition()},vg.prototype.updateImageTouchSurfaceDimensions=function(){this.transformItem&&(this.imageTouchSurface.width=this.focusedFrameSprite.imageRect.width,this.imageTouchSurface.height=this.focusedFrameSprite.imageRect.height,this.updateImageSpriteDimensions(),this.updateImageSpriteVeilDisplay())},vg.prototype.updateImageTouchSurfacePosition=function(){this.transformItem&&(this.imageTouchSurface.x=this.transformItem.flippedHorizontal?Math.abs(this.focusedFrameSprite.imageRect.x)+this.focusedFrameSprite.width-this.focusedFrameSprite.imageRect.width:this.focusedFrameSprite.imageRect.x,this.imageTouchSurface.y=this.transformItem.flippedVertical?Math.abs(this.focusedFrameSprite.imageRect.y)+this.focusedFrameSprite.height-this.focusedFrameSprite.imageRect.height:this.focusedFrameSprite.imageRect.y,this.updateImageSpriteVeilDisplay())},vg.prototype.updateImageTouchSurfaceHitArea=function(){var e=this.imageOutlinePadding/(this._scale*this.imageTouchSurface.scale.x),t=this.imageOutlinePadding/(this._scale*this.imageTouchSurface.scale.y);this.imageTouchSurface.hitArea=new PIXI.Rectangle(-e,-t,this.imageTouchSurface.width/this.imageTouchSurface.scale.x+2*e,this.imageTouchSurface.height/this.imageTouchSurface.scale.y+2*t)},vg.prototype.updateFrameTouchSurfaceDisplay=function(){this.updateFrameTouchSurfaceDimensions(),this.updateFrameTouchSurfacePosition()},vg.prototype.updateFrameTouchSurfaceDimensions=function(){this.transformItem&&(this.frameTouchSurface.width=this.focusedFrameSprite.width,this.frameTouchSurface.height=this.focusedFrameSprite.height,this.updateImageSpriteVeilDisplay())},vg.prototype.updateFrameTouchSurfacePosition=function(){this.transformItem&&(this.frameTouchSurface.x=0,this.frameTouchSurface.y=0,this.updateImageSpriteVeilDisplay())},vg.prototype.updateOutlineDisplays=function(){this.updateFrameOutlineDisplay(),this.updateImageOutlineDisplay()},vg.prototype.updateImageOutlineDisplay=function(){this.updateImageOutlineDimensions(),this.updateImageOutlinePosition()},vg.prototype.updateImageOutlineDimensions=function(){this.imageSpriteOutline.setDimensions(this.imageTouchSurface.width+this.imageOutlinePadding/this._scale*2,this.imageTouchSurface.height+this.imageOutlinePadding/this._scale*2)},vg.prototype.updateImageOutlinePosition=function(){this.imageSpriteOutline.x=this.imageTouchSurface.x+this.imageTouchSurface.width/2,this.imageSpriteOutline.y=this.imageTouchSurface.y+this.imageTouchSurface.height/2},vg.prototype.updateFrameOutlineDisplay=function(){this.updateFrameOutlineDimensions(),this.updateFrameOutlinePosition()},vg.prototype.updateFrameOutlineDimensions=function(){this.frameSpriteOutline.setDimensions(this.frameTouchSurface.width,this.frameTouchSurface.height)},vg.prototype.updateFrameOutlinePosition=function(){this.frameSpriteOutline.x=this.frameTouchSurface.x+this.frameTouchSurface.width/2,this.frameSpriteOutline.y=this.frameTouchSurface.y+this.frameTouchSurface.height/2},vg.prototype.updateScaleHandlePositions=function(){this.updateFrameScaleHandlePositions(),this.updateImageScaleHandlePositions()},vg.prototype.updateImageScaleHandlePositions=function(){for(var e in this.imageScaleHandles){var t=this.imageScaleHandles[e];t.noPaddingX=this.imageSpriteOutline.x,t.noPaddingY=this.imageSpriteOutline.y,t.id.includes("l")&&(t.noPaddingX-=this.imageTouchSurface.width/2),t.id.includes("r")&&(t.noPaddingX+=this.imageTouchSurface.width/2),t.id.includes("t")&&(t.noPaddingY-=this.imageTouchSurface.height/2),t.id.includes("b")&&(t.noPaddingY+=this.imageTouchSurface.height/2),t.id.includes("l")&&(t.x=t.noPaddingX-this.imageOutlinePadding/this._scale),t.id.includes("r")&&(t.x=t.noPaddingX+this.imageOutlinePadding/this._scale),t.id.includes("t")&&(t.y=t.noPaddingY-this.imageOutlinePadding/this._scale),t.id.includes("b")&&(t.y=t.noPaddingY+this.imageOutlinePadding/this._scale)}},vg.prototype.updateFrameScaleHandlePositions=function(){for(var e in this.frameScaleHandles){var t=this.frameScaleHandles[e];t.noPaddingX=this.frameSpriteOutline.x,t.noPaddingY=this.frameSpriteOutline.y,t.id.includes("l")&&(t.noPaddingX-=this.frameTouchSurface.width/2),t.id.includes("r")&&(t.noPaddingX+=this.frameTouchSurface.width/2),t.id.includes("t")&&(t.noPaddingY-=this.frameTouchSurface.height/2),t.id.includes("b")&&(t.noPaddingY+=this.frameTouchSurface.height/2),t.x=t.noPaddingX,t.y=t.noPaddingY}},vg.prototype.updateFrameScaleHandleDisplay=function(){var e=this.frameSpriteOutline.width*this._scale,t=this.frameSpriteOutline.height*this._scale,i=this.handleTextureCorner.width+this.handleTextureSide.width-2;for(var r in this.frameScaleHandles){var a=this.frameScaleHandles[r];switch(a.type){case"corner":break;case"side":a.active=a.horizontal?t>i:e>i}}},vg.prototype.updateOutlineScales=function(){this.frameSpriteOutline.scale=this._scale,this.imageSpriteOutline.scale=this._scale},vg.prototype.updateScaleHandleScales=function(){for(var e in this.frameScaleHandles){var t=this.frameScaleHandles[e];t.scale.x=t.scale.y=1/this._scale}for(var i in this.imageScaleHandles){var r=this.imageScaleHandles[i];r.scale.x=r.scale.y=1/this._scale}},vg.prototype.toggleInteraction=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;for(var i in e=!!e,this.imageTouchSurface.interactive=e||!e&&this.imageTouchSurface==t,this.frameTouchSurface.interactive=e||!e&&this.frameTouchSurface==t,this.imageScaleHandles){var r=this.imageScaleHandles[i];(e||r!=t)&&(r.interactive=e)}for(var a in this.frameScaleHandles){var n=this.frameScaleHandles[a];(e||n!=t)&&(n.interactive=e)}this.transformTool.transformLayer.interactiveChildren=e},vg.prototype.updateCursorOrientation=function(e){if(e){var t=e.group+"SpriteOutline",i=this.hasOwnProperty(t)?this[t]:null;if(i){var r=this.controlContainer.toGlobal(new PIXI.Point(e.noPaddingX,e.noPaddingY)),a=this.controlContainer.toGlobal(new PIXI.Point(i.x,i.y));BFN.CursorScreen.cursorRotation=Math.atan2(a.y-r.y,a.x-r.x)}}},vg.prototype.dragImage=function(){var e=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent),t=e.x-this.containerMouseDownPoint.x,i=e.y-this.containerMouseDownPoint.y,r=this.imageTouchSurface.width-this.frameTouchSurface.width,a=this.imageTouchSurface.height-this.frameTouchSurface.height,n=this.frameTouchSurface.x-r,o=this.frameTouchSurface.x,s=this.frameTouchSurface.y-a,l=this.frameTouchSurface.y,h=this.containerItemStartPoint.x+t,c=this.containerItemStartPoint.y+i;this.containerMouseDownPoint.x+=Math.min(0,h-n)+Math.max(0,h-o),this.containerMouseDownPoint.y+=Math.min(0,c-s)+Math.max(0,c-l),this.imageTouchSurface.x=Math.max(n,Math.min(o,h)),this.imageTouchSurface.y=Math.max(s,Math.min(l,c)),this.updateImageOutlinePosition(),this.updateImageScaleHandlePositions(),this.updateTransformItem(),this.updateImageSpritePosition(),this.updateImageSpriteVeilDisplay()},vg.prototype.dragFrame=function(){var e=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent),t=e.x-this.containerMouseDownPoint.x,i=e.y-this.containerMouseDownPoint.y,r=this.imageTouchSurface.width-this.frameTouchSurface.width,a=this.imageTouchSurface.height-this.frameTouchSurface.height,n=this.imageTouchSurface.x,o=this.imageTouchSurface.x+r,s=this.imageTouchSurface.y,l=this.imageTouchSurface.y+a,h=this.containerItemStartPoint.x+t,c=this.containerItemStartPoint.y+i;this.containerMouseDownPoint.x+=Math.min(0,h-n)+Math.max(0,h-o),this.containerMouseDownPoint.y+=Math.min(0,c-s)+Math.max(0,c-l),this.frameTouchSurface.x=Math.max(n,Math.min(o,h)),this.frameTouchSurface.y=Math.max(s,Math.min(l,c)),this.updateFrameOutlinePosition(),this.updateFrameScaleHandlePositions(),this.updateTransformItem(),this.updateImageSpriteVeilDisplay()},vg.prototype.updateScaleControlBounds=function(){if(this.scaleControlBounds={},this.currentScaleHandle&&this.transformItem&&this.scaleMode){var e=this.getInverseScaleHandle(this.currentScaleHandle);this.scaleAnchor.x=e.noPaddingX,this.scaleAnchor.y=e.noPaddingY;var t=this.currentScaleHandle,i=this.focusedFrameSprite,r=this.scaleHandleDragger.altKey,a=new BFN.Rectangle(this.imageTouchSurface.x,this.imageTouchSurface.y,this.imageTouchSurface.width,this.imageTouchSurface.height),n=new BFN.Rectangle(this.frameTouchSurface.x,this.frameTouchSurface.y,this.frameTouchSurface.width,this.frameTouchSurface.height),o=this.transformTool.minSizeFrame,s=Math.max(o,a.width/i.baseWidth*o),l=Math.max(o,a.height/i.baseHeight*o),h=n.width/o*i.baseWidth,c=n.height/o*i.baseHeight;switch(t.type){case"corner":var u=t.id.includes("l")?t:e,d=t.id.includes("r")?t:e,m=d.noPaddingX-u.noPaddingX,p=d.noPaddingY-u.noPaddingY,g=Math.atan2(p,m),f=g+Math.PI/2;this.scaleControlBounds.slope=Math.sin(f)/Math.cos(f),this.scaleControlBounds.beta=g,this.scaleControlBounds.sign=t.noPaddingY-this.scaleAnchor.y<this.scaleControlBounds.slope*(t.noPaddingX-this.scaleAnchor.x)?-1:1}switch(t.group){case"image":if(this.scaleControlBounds.center=a.centerX,this.scaleControlBounds.middle=a.centerY,this.scaleControlBounds.ratio=a.height/a.width,this.scaleControlBounds.maxDiagonal=Math.min(Math.sqrt(Math.pow(h,2)+Math.pow(h*this.scaleControlBounds.ratio,2)),Math.sqrt(Math.pow(c,2)+Math.pow(c/this.scaleControlBounds.ratio,2)))/(r?2:1),this.scaleMode&&this.scaleMode.includes("freeform"))t.id.includes("l")&&(this.scaleControlBounds.right=r?Math.min(n.left,a.left+(a.right-n.right)):n.left,this.scaleControlBounds.left=r?a.centerX-h/2:a.right-h),t.id.includes("t")&&(this.scaleControlBounds.bottom=r?Math.min(n.top,a.top+(a.bottom-n.bottom)):n.top,this.scaleControlBounds.top=r?a.centerY-c/2:a.bottom-c),t.id.includes("r")&&(this.scaleControlBounds.left=r?Math.max(n.right,a.right-(n.left-a.left)):n.right,this.scaleControlBounds.right=r?a.centerX+h/2:a.left+h),t.id.includes("b")&&(this.scaleControlBounds.top=r?Math.max(n.bottom,a.bottom-(n.top-a.top)):n.bottom,this.scaleControlBounds.bottom=r?a.centerY+c/2:a.top+c),"side"===t.type&&(t.horizontal?this.scaleControlBounds.top=this.scaleControlBounds.bottom=a.centerY:this.scaleControlBounds.left=this.scaleControlBounds.right=a.centerX);else if(this.scaleMode.includes("constrained"))switch(this.scaleControlBounds.minDiagonal=0,t.type){case"corner":var v,y;r?(v=Math.max(n.right-a.centerX,a.centerX-n.left),y=Math.max(n.bottom-a.centerY,a.centerY-n.top)):(t.id.includes("l")&&(v=a.right-n.left),t.id.includes("t")&&(y=a.bottom-n.top),t.id.includes("r")&&(v=n.right-a.left),t.id.includes("b")&&(y=n.bottom-a.top));var x=v*this.scaleControlBounds.ratio,_=y/this.scaleControlBounds.ratio,I=Math.sqrt(Math.pow(v,2)+Math.pow(x,2)),T=Math.sqrt(Math.pow(y,2)+Math.pow(_,2));this.scaleControlBounds.minDiagonal=Math.max(I,T)}break;case"frame":if(this.scaleControlBounds.center=n.centerX,this.scaleControlBounds.middle=n.centerY,this.scaleControlBounds.ratio=n.height/n.width,this.scaleControlBounds.minDiagonal=Math.max(Math.sqrt(Math.pow(s,2)+Math.pow(s*this.scaleControlBounds.ratio,2)),Math.sqrt(Math.pow(l,2)+Math.pow(l/this.scaleControlBounds.ratio,2)))/(r?2:1),this.scaleMode.includes("freeform"))t.id.includes("l")&&(this.scaleControlBounds.left=r?Math.max(a.left,n.left-(a.right-n.right)):a.left,this.scaleControlBounds.right=r?n.centerX-s/2:n.right-s),t.id.includes("t")&&(this.scaleControlBounds.top=r?Math.max(a.top,n.top-(a.bottom-n.bottom)):a.top,this.scaleControlBounds.bottom=r?n.centerY-l/2:n.bottom-l),t.id.includes("r")&&(this.scaleControlBounds.right=r?Math.min(a.right,n.right+(n.left-a.left)):a.right,this.scaleControlBounds.left=r?n.centerX+s/2:n.left+s),t.id.includes("b")&&(this.scaleControlBounds.bottom=r?Math.min(a.bottom,n.bottom+(n.top-a.top)):a.bottom,this.scaleControlBounds.top=r?n.centerY+l/2:n.top+l),"side"===t.type&&(t.horizontal?this.scaleControlBounds.top=this.scaleControlBounds.bottom=n.centerY:this.scaleControlBounds.left=this.scaleControlBounds.right=n.centerX);else if(this.scaleMode.includes("constrained"))switch(this.scaleControlBounds.maxDiagonal=0,t.type){case"corner":var b,S;r?(b=Math.min(a.right-n.centerX,n.centerX-a.left),S=Math.min(a.bottom-n.centerY,n.centerY-a.top)):(t.id.includes("l")&&(b=n.right-a.left),t.id.includes("t")&&(S=n.bottom-a.top),t.id.includes("r")&&(b=a.right-n.left),t.id.includes("b")&&(S=a.bottom-n.top));var C=b*this.scaleControlBounds.ratio,B=S/this.scaleControlBounds.ratio,F=Math.sqrt(Math.pow(b,2)+Math.pow(C,2)),E=Math.sqrt(Math.pow(S,2)+Math.pow(B,2));this.scaleControlBounds.maxDiagonal=Math.min(F,E)}}}},vg.prototype.freeformScale=function(){var e=this.currentScaleHandle,t=this.scaleHandleDragger.altKey,i=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent);this.scaleControl.x=i.x,this.scaleControl.y=i.y,"image"===e.group&&(e.id.includes("l")&&(this.scaleControl.x+=this.imageOutlinePadding/this._scale),e.id.includes("r")&&(this.scaleControl.x-=this.imageOutlinePadding/this._scale),e.id.includes("t")&&(this.scaleControl.y+=this.imageOutlinePadding/this._scale),e.id.includes("b")&&(this.scaleControl.y-=this.imageOutlinePadding/this._scale)),this.scaleControlBounds&&(this.scaleControlBounds.hasOwnProperty("left")&&(this.scaleControl.x=Math.max(this.scaleControlBounds.left,this.scaleControl.x)),this.scaleControlBounds.hasOwnProperty("right")&&(this.scaleControl.x=Math.min(this.scaleControlBounds.right,this.scaleControl.x)),this.scaleControlBounds.hasOwnProperty("top")&&(this.scaleControl.y=Math.max(this.scaleControlBounds.top,this.scaleControl.y)),this.scaleControlBounds.hasOwnProperty("bottom")&&(this.scaleControl.y=Math.min(this.scaleControlBounds.bottom,this.scaleControl.y)));var r="image"===e.group?this.imageTouchSurface:this.frameTouchSurface,a=()=>{r.width=Math.abs(t?2*(this.scaleControlBounds.center-this.scaleControl.x):this.scaleAnchor.x-this.scaleControl.x),r.x=t?this.scaleControlBounds.center-r.width/2:e.id.includes("l")?this.scaleControl.x:this.scaleAnchor.x},n=()=>{r.height=Math.abs(t?2*(this.scaleControlBounds.middle-this.scaleControl.y):this.scaleAnchor.y-this.scaleControl.y),r.y=t?this.scaleControlBounds.middle-r.height/2:e.id.includes("t")?this.scaleControl.y:this.scaleAnchor.y};switch(e.type){case"corner":a(),n();break;case"side":e.horizontal?a():n()}},vg.prototype.constrainedScale=function(){var e=this.currentScaleHandle,t=this.scaleHandleDragger.altKey,i=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent);this.scaleControl.x=i.x,this.scaleControl.y=i.y,"image"===e.group&&(e.id.includes("l")&&(this.scaleControl.x+=this.imageOutlinePadding/this._scale),e.id.includes("r")&&(this.scaleControl.x-=this.imageOutlinePadding/this._scale),e.id.includes("t")&&(this.scaleControl.y+=this.imageOutlinePadding/this._scale),e.id.includes("b")&&(this.scaleControl.y-=this.imageOutlinePadding/this._scale));var r=new PIXI.Point(this.scaleControl.x-(t?this.scaleControlBounds.center:this.scaleAnchor.x),this.scaleControl.y-(t?this.scaleControlBounds.middle:this.scaleAnchor.y)),a=this.getPointToLineDistance(r,this.scaleControlBounds.slope);(r.y<this.scaleControlBounds.slope*r.x?-1:1)!=this.scaleControlBounds.sign&&(a=this.scaleControlBounds.minDiagonal),"corner"===e.type&&(a=Math.min(this.scaleControlBounds.maxDiagonal,Math.max(this.scaleControlBounds.minDiagonal,a)));var n="image"===e.group?this.imageTouchSurface:this.frameTouchSurface;switch(e.type){case"corner":n.width=Math.abs(Math.cos(this.scaleControlBounds.beta)*a*(t?2:1)),n.height=Math.abs(Math.sin(this.scaleControlBounds.beta)*a*(t?2:1))}if(t)n.x=this.scaleControlBounds.center-n.width/2,n.y=this.scaleControlBounds.middle-n.height/2;else switch(e.type){case"corner":switch(e.id){case"tl":n.x=this.scaleAnchor.x-n.width,n.y=this.scaleAnchor.y-n.height;break;case"tr":n.x=this.scaleAnchor.x,n.y=this.scaleAnchor.y-n.height;break;case"br":n.x=this.scaleAnchor.x,n.y=this.scaleAnchor.y;break;case"bl":n.x=this.scaleAnchor.x-n.width,n.y=this.scaleAnchor.y}}},vg.prototype.createScaleHandle=function(e,t){var i=new BFN.HoverButton;return i.buttonMode=!1,i.id=e,i.group=t,i.type=this.sideHandleIDs.includes(e)?"side":"corner",i.horizontal=["l","r"].includes(e),i.texture="image"==t?this.handleTextureCircle:"side"==i.type?this.handleTextureSide:this.handleTextureCorner,i.rotation=i.horizontal?Math.PI/2:"corner"==i.type?this.cornerHandleIDs.indexOf(e)*(Math.PI/2):0,i.on("pointerover",this.handleScaleHandleOver.bind(this)),i.on("pointerout",this.handleScaleHandleOut.bind(this)),i.on("pointerdown",this.handleScaleHandlePress.bind(this)),this.scaleHandleContainer.addChild(i),"frame"==t&&this.cornerHandleIDs.includes(e)&&(i.buttonSprite.anchor.x=i.buttonSprite.anchor.y=.3),i},vg.prototype.getInverseScaleHandle=function(e){var t,i=null;if(e&&e.group&&e.id)switch(e.group){case"image":(t=this.cornerHandleIDs.indexOf(e.id))>=0&&(i=this.imageScaleHandles[this.cornerHandleIDs[(t+2)%this.cornerHandleIDs.length]]);break;case"frame":(t=this.scaleHandleIDs.indexOf(e.id))>=0&&(i=this.frameScaleHandles[this.scaleHandleIDs[(t+4)%this.scaleHandleIDs.length]])}return i},vg.prototype.getPointToLineDistance=function(e,t){if(0==t)return Math.abs(e.y);if(t==1/0)return Math.abs(e.x);var i=(e.y+1/t*e.x)/(t- -1/t),r=t*i;return Math.sqrt(Math.pow(i-e.x,2)+Math.pow(r-e.y,2))},vg.prototype.handleTouchSurfaceOver=function(e){var t=e.target;setTimeout(()=>{if(this.transformTool.item&&e.target)switch(BFN.CursorScreen.cursor="move",t){case this.imageTouchSurface:this.imageSpriteOutline.hovered=!0,this.imageSpriteOutline.highlight=!0;break;case this.frameTouchSurface:this.frameSpriteOutline.hovered=!0,this.frameSpriteOutline.highlight=!0}},0)},vg.prototype.handleTouchSurfaceOut=function(e){this.imageSpriteOutline.hovered=!1,this.frameSpriteOutline.hovered=!1,this.touchSurfaceDragger.dragging||(BFN.CursorScreen.cursor=null,this.imageSpriteOutline.highlight=!1,this.frameSpriteOutline.highlight=!1)},vg.prototype.handleTouchSurfacePress=function(e){if(this.transformItem){BFN.CursorScreen.cursorLock=!0,this.transformItem.transforming=!0;var t=e.target;this.toggleInteraction(!1,t),this.containerMouseDownPoint=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent),this.containerItemStartPoint=new PIXI.Point(t.x,t.y),this.touchSurfaceDragger.drag(t),e.stopPropagation()}},vg.prototype.handleScaleHandleOver=function(e){var t=e.target;setTimeout(function(){this.transformItem&&e.target&&(BFN.CursorScreen.cursor="arrow",t.parent.setChildIndex(t,t.parent.children.length-1),this.updateCursorOrientation(t),this.sideHandleIDs.includes(t.id)||(BFN.MainUI.tooltip="scaling_tooltip"))}.bind(this),0)},vg.prototype.handleScaleHandleOut=function(e){this.scaleHandleDragger.dragging||(BFN.CursorScreen.cursor=null),BFN.MainUI.tooltip=null},vg.prototype.handleScaleHandlePress=function(e){if(this.transformItem){BFN.CursorScreen.cursorLock=!0,this.transformItem.transforming=!0,this.currentScaleHandle=e.target,this.currentScaleHandle.selected=!0,this.toggleInteraction(!1,this.currentScaleHandle),this.scaleHandleDragger.drag(this.currentScaleHandle);var t=Math.round("frame"===this.currentScaleHandle.group?this.frameTouchSurface.width:this.imageTouchSurface.width),i=Math.round("frame"===this.currentScaleHandle.group?this.frameTouchSurface.height:this.imageTouchSurface.height);BFN.TooltipScreen.show(t+" x "+i,!0,!0),BFN.TooltipScreen.setPosition(e.data.originalEvent.pageX,e.data.originalEvent.pageY),e.stopPropagation()}},vg.prototype.handleTouchSurfaceDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.transformItem){var t="invalid_frame_transform_move",i=this.touchSurfaceDragger.item;if(i)switch(i){case this.imageTouchSurface:t="history_image_region";break;case this.frameTouchSurface:t="history_move_image"}this.transformItem.createTransition(t)}},vg.prototype.handleTouchSurfaceDragging=function(e){switch(this.touchSurfaceDragger.item){case this.imageTouchSurface:this.dragImage();break;case this.frameTouchSurface:this.dragFrame()}},vg.prototype.handleTouchSurfaceDraggingComplete=function(e){this.imageSpriteOutline.highlight=this.imageSpriteOutline.hovered,this.frameSpriteOutline.highlight=this.frameSpriteOutline.hovered,BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.toggleInteraction(!0),this.transformItem&&(this.transformItem.transforming=!1,this.touchSurfaceDragger.draggedItem===this.frameTouchSurface&&(this.transformItem.transformTool.updateTransformValues(),this.transformItem.transformTool.conformItemToBounds()),this.transformItem.updateContentDimensions(),this.transformItem.updateSmoothingScale(),this.setup(this.transformItem),this.transformTool.updateDisplay(),this.transformItem.registerTransition(!1))},vg.prototype.handleScaleHandleDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.transformItem){var t="invalid_frame_transform_scale",i=this.scaleHandleDragger.item;if(i)switch(i.group){case"image":t="history_image_region";break;case"frame":t="history_scale_image"}this.transformItem.createTransition(t),this.transformToolVO=UITools.getToolVO("transform")}},vg.prototype.handleScaleHandleDragging=function(e){if(this.transformItem&&this.currentScaleHandle){var t=this.scaleHandleDragger.shiftKey,i=this.scaleHandleDragger.altKey,r=(t||"side"==this.currentScaleHandle.type?"freeform":"constrained")+"_"+(i?"center":"opposite");switch(this.scaleMode!=r&&(this.scaleMode=r,this.updateScaleControlBounds()),this.scaleMode.includes("freeform")?this.freeformScale():this.constrainedScale(),this.currentScaleHandle.group){case"image":this.updateImageOutlineDisplay(),this.updateImageScaleHandlePositions(),this.updateImageSpriteDisplay();break;case"frame":this.updateFrameOutlineDisplay(),this.updateFrameScaleHandlePositions(),this.updateFrameScaleHandleDisplay()}if(this.updateTransformItem(),this.transformItem.basicShapeVO){this.transformItem.updateShapeTexture(!1);var a=this.transformItem.maskFlippedHorizontal?!this.transformItem.flippedHorizontal:this.transformItem.flippedHorizontal,n=this.transformItem.maskFlippedVertical?!this.transformItem.flippedVertical:this.transformItem.flippedVertical;this.imageSpriteVeil.setMaskTexture(this.transformItem.itemContentMask?this.transformItem.itemContentMask.texture:null,a,n)}if(this.updateImageSpriteVeilDisplay(),this.updateCursorOrientation(this.currentScaleHandle),this.updateScaleControl(),BFN.TooltipScreen.active){var o=Math.round("frame"===this.currentScaleHandle.group?this.frameTouchSurface.width:this.imageTouchSurface.width),s=Math.round("frame"===this.currentScaleHandle.group?this.frameTouchSurface.height:this.imageTouchSurface.height);BFN.TooltipScreen.setMessage(o+" x "+s)}}},vg.prototype.handleScaleHandleDraggingComplete=function(e){(BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.currentScaleHandle&&(this.currentScaleHandle.selected=!1),this.currentScaleHandle=null,this.scaleControlBounds=null,this.scaleMode=null,this.toggleInteraction(!0),this.transformItem)&&(this.transformItem.transforming=!1,this.scaleHandleDragger.wasDragged&&("frame"===this.scaleHandleDragger.draggedItem.group&&(this.transformItem.transformTool.updateTransformValues(),this.transformItem.transformTool.conformItemToBounds()),this.transformItem.updateShapeTexture(),this.transformItem.updateContentDimensions(),this.transformItem.updateSmoothingScale(),this.setup(this.transformItem),this.transformTool.updateDisplay(),this.transformItem.registerTransition(!1)));BFN.TooltipScreen.active&&BFN.TooltipScreen.hide()},vg.prototype.handleFadeAnimatorUpdate=function(e){this.fadeContainer.alpha=this.fadeAnimator.animationFactor,this.visible=!!this.fadeContainer.alpha},Object.defineProperty(vg.prototype,"scale",{set:function(e){this._scale=Math.max(0,e),this.transformItem&&(this.updateImageOutlineDimensions(),this.updateImageScaleHandlePositions(),this.updateImageTouchSurfaceHitArea(),this.updateFrameScaleHandleDisplay(),this.updateScaleHandleScales(),this.updateOutlineScales(),this.updateImageSpriteSmoothing())},get:function(){return this._scale}}),BFN.TransformToolFrame=vg,yg.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),yg.prototype.init=function(){BeFunky.log("TransformToolSnapGaps Init"),this.initDefaultValues(),this.initDisplay()},yg.prototype.initDefaultValues=function(){this.interactive=!1,this.interactiveChildren=!1,this._scale=1,this.bgFillFilter=new BFN.filters.BackgroundFillFilter,this.bgFillFilter.resolution=BFN.Stage.resolution,this.graphic=new PIXI.Graphics,this.addChild(this.graphic)},yg.prototype.initDisplay=function(){this.snapGapGraphic=new PIXI.Graphics,this.addChild(this.snapGapGraphic),this.allSnapGapLabels=[],this.availableSnapGapLabels=[],this.usedSnapGapLabels=[],this.labelContainer=new PIXI.Container,this.addChild(this.labelContainer)},yg.prototype.show=function(){this.canvasModel=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),this.canvas=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);var e=this.canvas.transformToolSnapGapsContainer;e.children.includes(BFN.TransformToolSnapGaps)||(BFN.TransformToolSnapGaps.canvasScale=this.canvasModel.canvasScale,e.addChild(BFN.TransformToolSnapGaps))},yg.prototype.hide=function(){this.canvas=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);var e=this.canvas.transformToolSnapGapsContainer;e.children.includes(BFN.TransformToolSnapGaps)&&e.removeChild(BFN.TransformToolSnapGaps)},yg.prototype.drawRect=function(e,t){e&&t&&(this.graphic.beginFill(65280,.2),this.graphic.drawRect(e.x,e.y,t.x-e.x,t.y-e.y),this.graphic.endFill())},yg.prototype.clearSnapGaps=function(){this.snapGapGraphic.clear(),this.availableSnapGapLabels.splice(0),this.availableSnapGapLabels.push(...this.allSnapGapLabels),this.usedSnapGapLabels.forEach(e=>{e.visible=!1}),this.usedSnapGapLabels.splice(0)},yg.prototype.drawSnapGap=function(e,t,i){if(e&&["horizontal","vertical"].includes(t)&&i){this.snapGapGraphic.beginFill(16711935,.25),this.snapGapGraphic.drawRect(e.x,e.y,e.width,e.height),this.snapGapGraphic.endFill();var r=BFN.TransformModel.showMeasurements?16711935:2154751,a=new PIXI.Point;switch(t){case"horizontal":this.snapGapGraphic.lineStyle(1,r),this.snapGapGraphic.moveTo(e.x,e.y),this.snapGapGraphic.lineTo(e.x+e.width,e.y),this.snapGapGraphic.moveTo(e.x,e.y+e.height),this.snapGapGraphic.lineTo(e.x+e.width,e.y+e.height),a.x=e.x+e.width/2,a.y=e.y+e.height/2;break;case"vertical":this.snapGapGraphic.lineStyle(1,r),this.snapGapGraphic.moveTo(e.x,e.y),this.snapGapGraphic.lineTo(e.x,e.y+e.height),this.snapGapGraphic.moveTo(e.x+e.width,e.y),this.snapGapGraphic.lineTo(e.x+e.width,e.y+e.height),a.x=e.x+e.width/2,a.y=e.y+e.height/2}if(this.snapGapGraphic.lineStyle(null),BFN.TransformModel.showMeasurements){var n=null;this.availableSnapGapLabels.length?((n=this.availableSnapGapLabels.shift()).text=i,n.visible=!0):((n=new PIXI.Text(i,{fontFamily:"Times New Roman",fontSize:13,fill:16777215,align:"center",padding:3})).filters=[this.bgFillFilter],n.anchor.x=n.anchor.y=.5,n.texture.setScaleMode(PIXI.SCALE_MODES.NEAREST),this.allSnapGapLabels.push(n),this.labelContainer.addChild(n)),n.x=a.x,n.y=a.y,this.usedSnapGapLabels.push(n)}}},Object.defineProperty(yg.prototype,"canvasScale",{set:function(e){this._scale=e,this.scale.x=this.scale.y=1/this._scale},get:function(){return this._scale}}),BFN.SingletonQueue.add(function(){BFN.TransformToolSnapGaps=new yg}),BFN.TransformGuidesEvents={},xg.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),xg.prototype.init=function(){BeFunky.log("TransformGuides Init"),this.initDefaultValues(),this.initGuideBars(),this.initGuideRulerMarks(),this.initGuideMarkers(),this.initGuideLines(),this.initGuideLock(),this.initGuideClear(),this.initGuideDragger(),this.initContextMenu(),this.updateGuideBarDisplay(),this.updateVisibility()},xg.prototype.initDefaultValues=function(){this.interactive=!0,this.interactiveChildren=!0,this.transformGuideData=[],this.guides={},this.activeGuide=null,this.guidesLocked=!1,this.pressedID=null,this.pressedAxis=null,this.pressedValue=null,this.snapData=[],this.snappedItems=[],this.snapValue=null,this.snapDistance=5,this.guideBarAvailable=!0,this.handleGuideMarkerPressBind=this.handleGuideMarkerPress.bind(this),this.handleGuideMarkerOverBind=this.handleGuideMarkerOver.bind(this),this.handleGuideMarkerOutBind=this.handleGuideMarkerOut.bind(this),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppViewstateUpdated.bind(this)),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handlePhotoEditorCanvasViewstateUpdated.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.updateVisibility.bind(this)),this.on("pointerdown",()=>BFN.preventSelectionDrag=!0)},xg.prototype.initGuideBars=function(){this.guideBarThickness=24,this.guideBarColor=4145484,this.guideBarTexture=PIXI.RenderTexture.create(this.guideBarThickness,this.guideBarThickness),this.guideBarTexture.fillColor(this.guideBarColor),this.guideBarCornerLeft=new PIXI.Sprite(this.guideBarTexture),this.guideBarCornerLeft.interactive=!0,this.addChild(this.guideBarCornerLeft),this.guideBarCornerRight=new PIXI.Sprite(this.guideBarTexture),this.guideBarCornerRight.interactive=!0,this.addChild(this.guideBarCornerRight),this.guideBarLeft=this.createGuideBar("y",0,this.guideBarThickness),this.addChild(this.guideBarLeft),this.guideBarTop=this.createGuideBar("x",this.guideBarThickness,0),this.addChild(this.guideBarTop)},xg.prototype.initGuideRulerMarks=function(){this.guideRulerMarks=new PIXI.Graphics,this.addChild(this.guideRulerMarks)},xg.prototype.initGuideMarkers=function(){this.guideMarkerTexture=null,this.guideMarkersContainer=new PIXI.Container,this.addChild(this.guideMarkersContainer),this.guideMarkersMask=new PIXI.Graphics,this.addChild(this.guideMarkersMask),this.guideMarkersContainer.mask=this.guideMarkersMask},xg.prototype.initGuideLines=function(){this.guideLineTexture=null,this.guideLinesContainer=new PIXI.Container,this.guideLinesContainer.interactive=this.guideLinesContainer.interactiveChildren=!1,this.addChild(this.guideLinesContainer)},xg.prototype.initGuideLock=function(){var e=this,t=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=t?0:.1,r=new PIXI.Graphics;r.beginFill(8290959),r.drawRect(4,20*(.5+i),12,8),r.endFill(),r.beginFill(8290959),r.moveTo(5,20*(.5-i)),r.arcTo(5,20*(.25-i),10,20*(.25-i),5),r.arcTo(15,20*(.25-i),15,20*(.5-i),5),t?r.lineTo(13,20*(.5-i)):(r.lineTo(15,20*(.5+i)),r.lineTo(13,20*(.5+i)),r.lineTo(13,20*(.5-i))),r.arcTo(13,20*(.35-i),10,20*(.35-i),3),r.arcTo(7,20*(.35-i),7,20*(.5-i),3),t||(r.lineTo(7,10),r.lineTo(5,10)),r.endFill(),r.beginFill(e.guideBarColor),r.drawCircle(10,20*(.5+i)+3,1.5),r.moveTo(10,20*(.5+i)+3),r.lineTo(12,20*(.5+i)+6),r.lineTo(8,20*(.5+i)+6),r.endFill();var a=r.generateCanvasTexture();r.clear();var n=PIXI.RenderTexture.create(20,20);return n.copyPixels(a,{x:(20-a.width)/2,y:(20-a.height)/2}),a.destroy(!0),n};this.guideLockTextureLocked=t(!0),this.guideLockTextureUnlocked=t(!1),this.guideLockButton=new PIXI.Sprite,this.guideLockButton.interactive=!0,this.guideLockButton.buttonMode=!0,this.guideLockButton.anchor.x=this.guideLockButton.anchor.y=.5,this.guideLockButton.x=this.guideLockButton.y=this.guideBarThickness/2,this.addChild(this.guideLockButton),this.guideLockButton.on("pointerover",()=>{BFN.MainUI.tooltip=this.guidesLocked?"unlock_guides":"lock_guides",this.guideLockButton.alpha=.7,BFN.MainUI.requestRender()}),this.guideLockButton.on("pointerout",()=>{BFN.MainUI.tooltip=null,this.guideLockButton.alpha=1,BFN.MainUI.requestRender()}),this.guideLockButton.on("pointerdown",()=>{this.guidesLocked=!this.guidesLocked,BFN.MainUI.tooltip=this.guidesLocked?"unlock_guides":"lock_guides",this.saveGuides(),this.updateGuideLockDisplay()}),this.updateGuideLockDisplay()},xg.prototype.initGuideClear=function(){this.guideClearTexture=(()=>{var e=new PIXI.Graphics;e.lineStyle(2,8290959),e.moveTo(3.6,3.6),e.lineTo(14.4,14.4),e.moveTo(3.6,14.4),e.lineTo(14.4,3.6);var t=PIXI.RenderTexture.create(18,18);return BFN.Stage.render(e,t),t})(),this.guideClearButton=new PIXI.Sprite(this.guideClearTexture),this.guideClearButton.interactive=!0,this.guideClearButton.buttonMode=!0,this.guideClearButton.anchor.x=this.guideClearButton.anchor.y=.5,this.guideClearButton.x=1.5*this.guideBarThickness,this.guideClearButton.y=this.guideBarThickness/2,this.addChild(this.guideClearButton),this.guideClearButton.on("pointerover",()=>{BFN.MainUI.tooltip="clear_guides",this.guideClearButton.alpha=.7,BFN.MainUI.requestRender()}),this.guideClearButton.on("pointerout",()=>{BFN.MainUI.tooltip=null,this.guideClearButton.alpha=1,BFN.MainUI.requestRender()}),this.guideClearButton.on("pointerdown",()=>{this.transformGuideData.splice(0),this.updateDisplay(!0),this.saveGuides(),this.contextMenu.hide()})},xg.prototype.initGuideDragger=function(){this.guideDragger=new BFN.Dragger,this.guideDragger.useBounds=!1,this.guideDragger.autoDrag=!1,this.guideDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleGuideDraggerDragging.bind(this)),this.guideDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleGuideDraggerDraggingComplete.bind(this))},xg.prototype.initContextMenu=function(){this.contextMenu=document.getElementById("context_menu_transform_guides"),BeFunky.contextMenu(this.contextMenu,{add_guide:{onClick:()=>{this.addGuide(this.pressedAxis,this.pressedValue,!0),this.contextMenu.hide()}},remove_guide:{onClick:()=>{this.removeGuide(this.pressedID)}},clear_guides:{onClick:()=>{this.transformGuideData.splice(0),this.updateDisplay(!0),this.saveGuides(),this.contextMenu.hide()}},lock_guides:{onClick:()=>{this.guidesLocked=!0,this.saveGuides(),this.updateGuideLockDisplay(),this.contextMenu.hide()}},unlock_guides:{onClick:()=>{this.guidesLocked=!1,this.saveGuides(),this.updateGuideLockDisplay(),this.contextMenu.hide()}}}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},xg.prototype.addGuide=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(["x","y"].includes(e)&&"number"==typeof t){var r={id:e+"_"+BeFunky.randomString(10),axis:e,value:t};return this.transformGuideData.push(r),this.updateDisplay(!0),i&&this.saveGuides(),r}},xg.prototype.removeGuide=function(e){for(var t=this.transformGuideData.length;--t>-1;){if(this.transformGuideData[t].id===e){this.transformGuideData.splice(t,1);break}}this.updateDisplay(!0),this.saveGuides()},xg.prototype.setTransformGuideData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.transformGuideData.splice(0);try{this.transformGuideData.push(...e)}catch(e){}this.guidesLocked=t,setTimeout(()=>{this.updateDisplay(!0),this.updateGuideLockDisplay()},0)},xg.prototype.updateGuideBarDisplay=function(){this.visible&&(this.guideBarTop.width=Math.max(10,BFN.StageModel.stageW-2*this.guideBarThickness),this.guideBarLeft.height=Math.max(10,BFN.StageModel.stageH-this.guideBarThickness),this.guideBarCornerRight.x=BFN.StageModel.stageW-this.guideBarThickness,this.guideClearButton.x=BFN.StageModel.stageW-this.guideBarThickness/2,this.guideMarkersMask.clear(),this.guideMarkersMask.beginFill(16777215),this.guideMarkersMask.drawRect(this.guideBarTop.x,this.guideBarTop.y,this.guideBarTop.width,Math.max(10,BFN.StageModel.stageH-this.guideBarTop.y)),this.guideMarkersMask.endFill(),this.guideMarkersMask.beginFill(16777215),this.guideMarkersMask.drawRect(this.guideBarLeft.x,this.guideBarLeft.y,Math.max(10,BFN.StageModel.stageW-this.guideBarLeft.x),this.guideBarLeft.height),this.guideMarkersMask.endFill(),this.guideMarkersMask.hitArea=new PIXI.Rectangle(0,0,0,0))},xg.prototype.updateDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(BFN.AppModel.viewState&&this.visible){if(e){var t=this.transformGuideData.map(e=>e.id);for(var i in this.guides)t.includes(i)||this.destroyGuide(i);this.transformGuideData.forEach(e=>{this.createGuide(e)})}for(var r in this.guides)this.updateGuidePosition(r);this.drawGuideRulerMarks(),BFN.MainUI.requestRender()}},xg.prototype.updateGuidePosition=function(e){if(this.guides.hasOwnProperty(e)){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),i=t.transformLayer,r=this.guides[e],a=t.toGlobal(new PIXI.Point),n=i.toGlobal(new PIXI.Point(r.value,r.value));r.marker[r.axis]=n[r.axis]-BFN.MainUI[r.axis];var o=r.line,s=n[r.axis]-BFN.MainUI[r.axis];s%1||(s-=.001),o[r.axis]=s,o[r.perpendicularAxis]=a[r.perpendicularAxis]-BFN.MainUI[r.perpendicularAxis]}},xg.prototype.drawGuideRulerMarks=function(){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,t=e.toGlobal(new PIXI.Point(-Math.round(e.frameWidth/2),-Math.round(e.frameHeight/2)));t.x-=BFN.MainUI.x,t.y-=BFN.MainUI.y;var i,r,a,n,o,s,l=e.canvasScale,h=2*l,c=10*l,u=20*l,d=100*l,m=h<4?c<4?u<4?d:u:c:h;this.guideRulerMarks.clear();var p=e=>{switch(o=1,m){case h:.3===(n=r%50?r%5?.3:.5:.7)&&(o=Math.min(1,2*(m-4)));break;case c:.5===(n=r%10?.5:.7)&&r%2&&(o=Math.min(1,2*(m-4)));break;case u:.5===(n=r%5?.5:.7)&&(o=Math.min(1,2*(m-4)));break;case d:n=.7}switch(a=n*this.guideBarThickness,this.guideRulerMarks.lineStyle(1,8290959,o),e){case"x":this.guideRulerMarks.moveTo(i,this.guideBarThickness-a),this.guideRulerMarks.lineTo(i,this.guideBarThickness);break;case"y":this.guideRulerMarks.moveTo(this.guideBarThickness-a,i),this.guideRulerMarks.lineTo(this.guideBarThickness,i)}},g=e=>{for(this.guideRulerMarks.lineStyle(1,8290959,1),"x"===e?(this.guideRulerMarks.moveTo(0,this.guideBarThickness-.001),this.guideRulerMarks.lineTo(BFN.StageModel.stageW,this.guideBarThickness-.001),this.guideRulerMarks.moveTo(BFN.StageModel.stageW-this.guideBarThickness-.001,0),this.guideRulerMarks.lineTo(BFN.StageModel.stageW-this.guideBarThickness-.001,this.guideBarThickness)):(this.guideRulerMarks.moveTo(this.guideBarThickness-.001,0),this.guideRulerMarks.lineTo(this.guideBarThickness-.001,BFN.StageModel.stageH)),s="x"===e?this.guideBarTop:this.guideBarLeft,(i=t[e])%1||(i-=.001),r=0;i>s[e];)p(e),i-=m,r++;for((i=t[e])%1||(i-=.001),r=0;i<s[e]+("x"===e?s.width:s.height);)i>s[e]&&p(e),i+=m,r++};g("x"),g("y")},xg.prototype.saveGuides=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel);t.projectVO.transformGuides=[...this.transformGuideData],t.projectVO.transformGuidesLocked=this.guidesLocked;var i=e;BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage&&(i=!1),i&&BFN.ProjectManager.requestLocalSave()},xg.prototype.updateVisibility=function(){var e="enabled"===UITools.getToolValue("alignment","guides"),t=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&!BFN.TransformItemIsolator.isolatedTransformItem&&(!BFN.AppModel.viewingEditor||BFN.AppModel.viewingEditor&&BFN.PhotoEditorModel.currentTexture);this.visible=this.guideLinesContainer.visible=e&&t,BFN.MainUI&&(this.updateGuideBarDisplay(),this.updateDisplay(!0),BFN.MainUI.requestRender())},xg.prototype.updateGuideLockDisplay=function(){this.guideLockButton.texture=this.guidesLocked?this.guideLockTextureLocked:this.guideLockTextureUnlocked,this.guideMarkersContainer.visible=!this.guidesLocked,this.guideMarkersContainer.interactiveChildren=!this.guidesLocked,this.guideBarLeft.buttonMode=this.guideBarTop.buttonMode=!this.guidesLocked,BFN.MainUI&&BFN.MainUI.requestRender()},xg.prototype.updateTooltip=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.getTooltipString(this.activeGuide);this.guideDragger.dragging?BFN.TooltipScreen.active?BFN.TooltipScreen.setMessage(i):(BFN.TooltipScreen.show(i,!0,!0),BFN.TooltipScreen.setPosition(e,t)):this.guideDragger.dragging||BFN.TooltipScreen.hide()},xg.prototype.getTooltipString=function(e){var t="n/a";if(e){var i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,r=0,a=0;switch(e.axis){case"x":r=e.value+Math.round(i.frameWidth/2),a=i.frameWidth-r,t="◄ "+(Math.round(10*r)/10).toFixed(1)+"px | "+(Math.round(10*a)/10).toFixed(1)+"px ►";break;case"y":r=e.value+Math.round(i.frameHeight/2),a=i.frameHeight-r,t="▲ "+(Math.round(10*r)/10).toFixed(1)+"px | "+(Math.round(10*a)/10).toFixed(1)+" px ▼"}}return t},xg.prototype.generateSnapData=function(){this.snapData.splice(0),BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer.children.forEach(e=>{if("group"!==e.type){var t=BFN.Util.getTransformItemBounds(e),i=new BFN.Rectangle(t.minX+e.accurateBounds.minX,t.minY+e.accurateBounds.minY,e.accurateBounds.width,e.accurateBounds.height);switch(this.activeGuide.axis){case"x":this.snapData.push({item:e,value:i.left},{item:e,value:i.right});break;case"y":this.snapData.push({item:e,value:i.top},{item:e,value:i.bottom})}}})},xg.prototype.processSnapData=function(){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,t=Math.round(e.toLocal(new PIXI.Point(this.guideDragger.draggedX,this.guideDragger.draggedY),this)[this.activeGuide.axis]);this.snapValue=null;var i=[];if(BFN.TransformModel.snappingEnabled&&this.snapData.length){var r=this.snapDistance/e.canvasScale,a=r,n=null;this.snapData.forEach(e=>{var i=e.value,o=Math.abs(i-t);o<r&&o<=a&&(a=o,n=i)}),null!==n&&(this.snapValue=t=n,this.snapData.forEach(e=>{if(!i.includes(e.item)){var t=e.value;Math.abs(t-n)<=.5&&i.push(e.item)}}))}if(i){for(var o=this.snappedItems.length;--o>-1;){var s=this.snappedItems[o];i.includes(s)||(s.hoverDropAnimator.decrease(),this.snappedItems.splice(o,1))}i.forEach(e=>{!this.snappedItems.includes(e)&&e.hoverDropAnimator&&(e.hoverDropAnimator.increase(),this.snappedItems.push(e))})}else this.snappedItems.forEach(e=>{e.hoverDropAnimator.decrease()}),this.snappedItems.splice(0);return t},xg.prototype.createGuideBar=function(e,t,i){var r=new PIXI.Sprite(this.guideBarTexture);return r.interactive=!0,r.buttonMode=!0,r.axis=e,r.x=t,r.y=i,r.on("pointerdown",this.handleGuideBarPress.bind(this)),r.on("pointerout",this.handleGuideMarkerOutBind),r},xg.prototype.getGuideMarkerTexture=function(){if(!this.guideMarkerTexture){var e=this.guideBarThickness,t=Math.round(.5*this.guideBarThickness);t+=t%2?0:1,this.guideMarkerTexture=PIXI.RenderTexture.create(e,t);var i=new PIXI.Graphics,r=Math.floor(t/4)+1;i.lineStyle(1.5,2434605,.7,0),i.beginFill(8290959),i.moveTo(0,0),i.lineTo(Math.round(.8*this.guideBarThickness)-1,0),i.lineTo(this.guideBarThickness-1,r),i.lineTo(Math.round(.8*this.guideBarThickness)-1,Math.round(t/2)),i.lineTo(0,Math.round(t/2)),i.lineTo(0,0),i.endFill();var a=i.generateCanvasTexture();this.guideMarkerTexture.copyPixels(a,{x:(this.guideMarkerTexture.width-a.width)/2,y:(this.guideMarkerTexture.height-a.height)/2}),i.clear(),a.destroyGC(!0)}return this.guideMarkerTexture},xg.prototype.getGuideLineTexture=function(){if(!this.guideLineTexture){var e=new PIXI.Graphics;e.moveTo(0,0);for(var t=0;t<=4096;t+=4){var i=t%8?15592941:4145484;e.lineStyle(3,i,.8,0),e.lineTo(t,0)}this.guideLineTexture=PIXI.RenderTexture.create(4096,1),BFN.Stage.render(e,this.guideLineTexture),e.clear()}return this.guideLineTexture},xg.prototype.createGuide=function(e){if(!this.guides.hasOwnProperty(e.id)){var t={id:e.id,axis:e.axis,perpendicularAxis:"x"===e.axis?"y":"x",value:e.value};this.guides[e.id]=t,t.marker=new PIXI.Sprite(this.getGuideMarkerTexture()),t.marker.interactive=!0,t.marker.buttonMode=!0,t.marker.anchor.x=t.marker.anchor.y=.5,t.marker.x=t.marker.y=Math.round(this.guideBarThickness/2+2),t.marker.rotation="x"===e.axis?Math.PI/2:0,t.marker.guide=t,t.marker.on("pointerdown",this.handleGuideMarkerPressBind),t.marker.on("pointerover",this.handleGuideMarkerOverBind),t.marker.on("pointerout",this.handleGuideMarkerOutBind),this.guideMarkersContainer.addChild(t.marker),t.line=new PIXI.Sprite(this.getGuideLineTexture()),t.line.interactive=!1,t.line.anchor.x=t.line.anchor.y=.5,t.line.rotation="x"===e.axis?Math.PI/2:0,t.line.guide=e,this.guideLinesContainer.addChild(t.line)}},xg.prototype.destroyGuide=function(e){if(this.guides.hasOwnProperty(e)){var t=this.guides[e];for(var i in this.guideMarkersContainer.children.includes(t.marker)&&this.guideMarkersContainer.removeChild(t.marker),t.marker.off("pointerdown",this.handleGuideMarkerPressBind),t.marker.off("pointerover",this.handleGuideMarkerOverBind),t.marker.off("pointerout",this.handleGuideMarkerOutBind),t.marker.destroy(!1),this.guideLinesContainer.children.includes(t.line)&&this.guideLinesContainer.removeChild(t.line),t.line.destroy(!1),t)delete t[i];delete this.guides[e]}},xg.prototype.handleAppViewstateUpdated=function(e){BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformGuidesContainer.addChild(this.guideLinesContainer);var t=!0;BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage&&(t=!1);var i=BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel);t?this.setTransformGuideData(i.projectVO.transformGuides,i.projectVO.transformGuidesLocked):this.setTransformGuideData()},xg.prototype.handleStageDimensionsUpdated=function(e){setTimeout(()=>{this.updateGuideBarDisplay(),this.updateDisplay()},0)},xg.prototype.handlePhotoEditorCanvasViewstateUpdated=function(e){this.updateVisibility()},xg.prototype.handleGuideBarPress=function(e){if(this.guideBarAvailable){var t=e.target,i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,r=t.axis,a=Math.round(i.getPointerPosition(e)[t.axis]);if(2===e.data.originalEvent.button)return this.guidesLocked?(this.contextMenu.hideButton("add_guide"),this.contextMenu.showButton("unlock_guides"),this.contextMenu.hideButton("lock_guides")):(this.contextMenu.showButton("add_guide"),this.contextMenu.showButton("lock_guides"),this.contextMenu.hideButton("unlock_guides")),this.contextMenu.hideButton("remove_guide"),this.transformGuideData.length?this.contextMenu.showButton("clear_guides"):this.contextMenu.hideButton("clear_guides"),this.contextMenu.show(e.data.originalEvent.pageX-16,e.data.originalEvent.pageY-16),this.pressedAxis=r,this.pressedValue=a,void e.stopPropagation();if(this.guidesLocked)e.stopPropagation();else{var n=this.addGuide(r,a);this.guides.hasOwnProperty(n.id)&&(this.activeGuide=this.guides[n.id],this.guideBarAvailable=!1,this.guideDragger.drag(this.activeGuide.marker),this.generateSnapData(),this.activeGuide.value=this.processSnapData(),this.updateGuidePosition(this.activeGuide.id),this.updateTooltip(e.data.originalEvent.pageX,e.data.originalEvent.pageY))}}},xg.prototype.handleGuideMarkerPress=function(e){if(this.guideBarAvailable){var t=e.target;if(2===e.data.originalEvent.button)return this.contextMenu.showButton("remove_guide"),this.contextMenu.hideButton("add_guide"),this.contextMenu.hideButton("clear_guides"),this.contextMenu.hideButton("lock_guides"),this.contextMenu.hideButton("unlock_guides"),this.contextMenu.show(e.data.originalEvent.pageX-16,e.data.originalEvent.pageY-16),e.stopPropagation(),void(this.pressedID=t.guide.id);this.activeGuide=t.guide,this.guideBarAvailable=!1,this.guideDragger.drag(this.activeGuide.marker),this.generateSnapData(),this.activeGuide.value=this.processSnapData(),this.processSnapData(),this.updateGuidePosition(this.activeGuide.id),this.updateTooltip(e.data.originalEvent.pageX,e.data.originalEvent.pageY),e.stopPropagation(),BFN.MainUIEvents.MOUSE_DOWN.data={canvasPressed:!0,originalEvent:e.data.originalEvent},BFN.MainUI.dispatchEvent(BFN.MainUIEvents.MOUSE_DOWN)}},xg.prototype.handleGuideMarkerOver=function(e){if(!this.guideDragger.dragging&&this.guideMarkersContainer.children.includes(e.target)){var t=e.target;this.guideMarkersContainer.addChild(t),BFN.MainUI.requestRender(),setTimeout(()=>{var i=this.getTooltipString(t.guide);BFN.TooltipScreen.show(i,!0,!0),BFN.TooltipScreen.setPosition(e.data.originalEvent.pageX,e.data.originalEvent.pageY),BFN.MainUI.requestRender()},0)}},xg.prototype.handleGuideMarkerOut=function(e){this.guideDragger.dragging||BFN.TooltipScreen.hide()},xg.prototype.handleGuideDraggerDragging=function(e){if(this.activeGuide){var t=this.processSnapData(),i=this.transformGuideData.find(e=>e.id===this.activeGuide.id);i&&(i.value=t),this.activeGuide.value=t,this.updateGuidePosition(this.activeGuide.id),this.updateTooltip()}},xg.prototype.handleGuideDraggerDraggingComplete=function(e){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,i=this.activeGuide?this.snapValue||Math.round(t.toLocal(new PIXI.Point(this.guideDragger.draggedX,this.guideDragger.draggedY),this)[this.activeGuide.axis]):null,r=this.activeGuide?this.transformGuideData.find(e=>e.id===this.activeGuide.id):null;r&&(r.value=i),this.activeGuide&&null!==i&&(this.activeGuide.value=i,this.activeGuide=null);var a=r?this.transformGuideData.find(e=>e.axis===r.axis&&e.value===r.value&&r.id!==e.id):null;a?(this.transformGuideData.splice(this.transformGuideData.indexOf(a),1),this.updateDisplay(!0)):this.updateDisplay(),this.snapData.splice(0),this.snapValue=null,this.snappedItems.length&&(this.snappedItems.forEach(e=>{e.hoverDropAnimator.decrease()}),this.snappedItems.splice(0)),this.saveGuides(),this.updateTooltip(),setTimeout(()=>{this.guideBarAvailable=!0},200)},BFN.SingletonQueue.add(function(){BFN.TransformGuides=new xg}),_g.prototype=Object.create(PIXI.Sprite.prototype),_g.prototype.init=function(){BeFunky.log("PhotoEditorCanvasImage Init"),this.initDefaultValues()},_g.prototype.initDefaultValues=function(){this.interactive=!0},Object.defineProperty(_g.prototype,"imageWidth",{get:function(){try{return this.texture.width}catch(e){return 0}}}),Object.defineProperty(_g.prototype,"imageHeight",{get:function(){try{return this.texture.height}catch(e){return 0}}}),BFN.SingletonQueue.add(function(){BFN.PhotoEditorCanvasImage=new _g}),BFN.PhotoEditorCanvasToolsEvents={TOOL_OVER:new Event("TOOL_OVER"),TOOL_OUT:new Event("TOOL_OUT"),START_CANVAS_DRAG:new Event("START_CANVAS_DRAG"),TOOL_DIMENSIONS_UPDATED:new Event("TOOL_DIMENSIONS_UPDATED")},Ig.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Ig.prototype.init=function(){BeFunky.log("PhotoEditorCanvasTools Init"),this.initDefaultValues(),this.initToolMap(),this.initToolContainer(),this.initPremiumWatermark()},Ig.prototype.initDefaultValues=function(){this._scale=1,this._scaling=!1,this.tools=[],this.currentTool=null,this.altSourceTexture=null,this.fitAfterApply=!1,this.toolPressed=!1,this.handleToolOverBind=this.handleToolOver.bind(this),this.handleToolOutBind=this.handleToolOut.bind(this),this.handleToolPressedBind=this.handleToolPressed.bind(this),this.handleToolReleasedBind=this.handleToolReleased.bind(this),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handleCanvasViewStateUpdated.bind(this)),this.addEventListener(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED.type,this.handleToolDimensionsUpdated.bind(this))},Ig.prototype.initToolMap=function(){this.toolMap={},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP]={id:"touchup",init:this.initTouchUp.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT]={id:"effect",init:this.initEffect.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY]={id:"artsy",init:this.initArtsy.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER]={id:"border",init:this.initBorder.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW]={id:"dropShadow",init:this.initDropShadow.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME]={id:"frame",init:this.initFrame.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE]={id:"texture",init:this.initTexture.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY]={id:"overlay",init:this.initOverlay.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE]={id:"flare",init:this.initLensFlare.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_CROP]={id:"crop",init:this.initCrop.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE]={id:"rotator",init:this.initRotator.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE]={id:"resizer",init:this.initResizer.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING]={id:"slimming",init:this.initSlimming.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESHAPE]={id:"reshape",init:this.initReshape.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT]={id:"tilter",init:this.initTilter.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS]={id:"focus",init:this.initFocus.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_VIGNETTE]={id:"vignette",init:this.initVignette.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_PAINT_BRUSH]={id:"paintBrush",init:this.initPaintBrush.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_CLONE]={id:"clone",init:this.initClone.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_BLEMISH_FIX]={id:"blemish",init:this.initBlemish.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_BACKGROUND]={id:"background",init:this.initBackground.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT]={id:"cutout",init:this.initCutout.bind(this)},BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING&&(this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING]={id:"matting",init:this.initMatting.bind(this)})},Ig.prototype.initToolContainer=function(){this.toolContainer=new PIXI.Container,this.addChild(this.toolContainer)},Ig.prototype.initTouchUp=function(){this.touchup=BFN.ImageTouchUp,this.touchup.interactive=!0,this.tools.push(this.touchup),this.toolContainer.addChild(this.touchup)},Ig.prototype.initEffect=function(){this.effect=BFN.ImageEffect,this.effect.interactive=!0,this.effect.toolScale=this._scale,this.tools.push(this.effect),this.toolContainer.addChild(this.effect)},Ig.prototype.initArtsy=function(){this.artsy=BFN.ImageArtsy,this.artsy.interactive=!0,this.tools.push(this.artsy),this.toolContainer.addChild(this.artsy)},Ig.prototype.initBorder=function(){this.border=BFN.ImageBorder,this.border.interactive=!0,this.tools.push(this.border),this.toolContainer.addChild(this.border)},Ig.prototype.initDropShadow=function(){this.dropShadow=BFN.ImageDropShadow,this.dropShadow.interactive=!0,this.tools.push(this.dropShadow),this.toolContainer.addChild(this.dropShadow)},Ig.prototype.initFrame=function(){this.frame=BFN.ImageFrame,this.frame.interactive=!0,this.tools.push(this.frame),this.toolContainer.addChild(this.frame)},Ig.prototype.initTexture=function(){this.texture=BFN.ImageTexture,this.texture.interactive=!0,this.tools.push(this.texture),this.toolContainer.addChild(this.texture)},Ig.prototype.initOverlay=function(){this.overlay=BFN.ImageOverlay,this.tools.push(this.overlay),this.toolContainer.addChild(this.overlay)},Ig.prototype.initLensFlare=function(){this.flare=BFN.ImageLensFlare,this.tools.push(this.flare),this.toolContainer.addChild(this.flare)},Ig.prototype.initCrop=function(){this.crop=BFN.ImageCrop,this.tools.push(this.crop),this.toolContainer.addChild(this.crop)},Ig.prototype.initRotator=function(){this.rotator=BFN.ImageRotator,this.rotator.interactive=!0,this.tools.push(this.rotator),this.toolContainer.addChild(this.rotator)},Ig.prototype.initResizer=function(){this.resizer=BFN.ImageResize,this.resizer.interactive=!0,this.tools.push(this.resizer),this.toolContainer.addChild(this.resizer)},Ig.prototype.initSlimming=function(){this.slimming=BFN.ImageSlimming,this.slimming.interactive=!0,this.tools.push(this.slimming),this.toolContainer.addChild(this.slimming)},Ig.prototype.initReshape=function(){this.reshape=BFN.ImageReshape,this.reshape.interactive=!0,this.tools.push(this.reshape),this.toolContainer.addChild(this.reshape)},Ig.prototype.initTilter=function(){this.tilter=BFN.ImageTilter,this.tilter.interactive=!0,this.tools.push(this.tilter),this.toolContainer.addChild(this.tilter)},Ig.prototype.initFocus=function(){this.focus=BFN.ImageFocus,this.tools.push(this.focus),this.toolContainer.addChild(this.focus)},Ig.prototype.initVignette=function(){this.vignette=BFN.ImageVignette,this.tools.push(this.vignette),this.toolContainer.addChild(this.vignette)},Ig.prototype.initPaintBrush=function(){this.paintBrush=BFN.ImagePaintBrush,this.tools.push(this.paintBrush),this.toolContainer.addChild(this.paintBrush)},Ig.prototype.initClone=function(){this.clone=BFN.ImageClone,this.tools.push(this.clone),this.toolContainer.addChild(this.clone)},Ig.prototype.initBlemish=function(){this.blemish=BFN.ImageBlemish,this.tools.push(this.blemish),this.toolContainer.addChild(this.blemish)},Ig.prototype.initBackground=function(){this.background=BFN.ImageBackground,this.tools.push(this.background),this.toolContainer.addChild(this.background)},Ig.prototype.initMatting=function(){this.matting=BFN.ImageMatting,this.tools.push(this.matting),this.toolContainer.addChild(this.matting)},Ig.prototype.initCutout=function(){this.cutout=BFN.ImageCutout,this.tools.push(this.cutout),this.toolContainer.addChild(this.cutout)},Ig.prototype.initPremiumWatermark=function(){this.premiumWatermark=BFN.PremiumWatermark,this.addChild(this.premiumWatermark)},Ig.prototype.handleEditorApplyCancel=function(){if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS){var e=!BFN.applyCancelMenu.alternateApply&&!BFN.PhotoEditorCanvas.canvasToolsContainer.children.includes(BFN.PhotoEditorCanvas.canvasTools)&&!BFN.TransformItemIsolator.active,t=BFN.TransformItemIsolator.active||BFN.TransformModel.layerItem,i=this.currentTool?this.currentTool.hasOwnProperty("adjustScale")?this.currentTool.adjustScale:this.currentTool.scale.x:1,r=!1;if("apply"===UITools.getToolValue("editor_apply_cancel","updating_id")){if(!BFN.applyCancelMenu.upgradeMode&&BFN.applyCancelMenu.alternateApply){switch(BFN.PhotoEditorCanvasModel.viewState){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT:BFN.ImageCutout.showCutoutOptionsModal()}return}r=this.applyCurrentTool()}else this.fitAfterApply=!1;if(BFN.ColorPickerPanel.colorButton&&(BFN.ColorPickerPanel.colorButton=null),t||(BFN.PhotoEditorCanvasModel.viewState=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,BFN.PhotoEditorCanvas.updateCanvasImage()),this.fitAfterApply){var a=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME_ANIMATED,BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME_ANIMATED,BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME_ANIMATED);1!=i&&(a.canvasScaling=!0,a.canvasScale*=i,a.canvasScaling=!1),a.dispatchEvent(n)}t?requestAnimationFrame(()=>{if(BFN.TransformItemIsolator.usingAlternateMenu){var t=document.getElementById("layer_isolator_tool_menu").querySelector(".tabbed-layout");t&&t.activeTab===t.tabNames[1]&&(t.activeTab="")}e&&BFN.PhotoEditorCanvas.canvasToolsContainer.addChild(BFN.PhotoEditorCanvas.canvasTools),BFN.PhotoEditorCanvasModel.viewState=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,BFN.TransformItemIsolator.usingAlternateMenu&&(UIToggler.toggleAlternateMenuImmediately(!1),BFN.TransformModel.layerItem=null,BFN.TransformItemIsolator.releaseTransformItem(r))}):e&&BFN.PhotoEditorCanvas.canvasToolsContainer.addChild(BFN.PhotoEditorCanvas.canvasTools)}},Ig.prototype.applyCurrentTool=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_UPGRADE",i=this.premiumWatermark.showing&&!BFN.ImageEditManager.editingImage;if(this.fitAfterApply=!1,this.currentTool){BFN.TransformModel.layerItem||BFN.TransformItemIsolator.active||i||BFN.PhotoEditorModel.updateCurrentTexture(this.currentTool.modifiedTexture);var r="image_updated",a=null,n=null,o=Date.now(),s={};switch(this.currentTool){case this.touchup:r=null!=BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("toolID")?BFN.EffectManager.parameters.toolID:BFN.EffectManager.effectID,s.hasParameters=!!BFN.EffectManager.parameters,s.hasParameters&&(s.toolID=BFN.EffectManager.parameters.toolID),s.effectID=BFN.EffectManager.effectID,"perfectskin"===r&&(r="skin_heal");var l="TOUCHUP";switch(r){case"fix_redeye":l="REDEYE";break;case"flashspot":l="FLASHSPOT_FIXER";break;case"blemish_fix":l="BLEMISH";break;case"clone":l="CLONE";break;case"eye_color":l="EYECOLOR";break;case"lipstick":l="LIPSTICK";break;case"bronzer":l="BRONZER";break;case"blush":l="BLUSH";break;case"wrinkles":l="WRINKLE_REMOVER";break;case"teeth_whiten":l="TEETH_WHITEN";break;case"eye_brighten":l="EYE_BRIGHTEN";break;case"eyebrow_pencil":l="EYEBROW_PENCIL";break;case"mascara":l="MASCARA";break;case"hair_color":l="HAIR_COLOR";break;case"perfectskin":case"skin_heal":l="PERFECT_SKIN"}i?BFN.BfnService.upgrade(e||"TOUCHUP",l+t,"touchup"):BFN.BfnService.track("CREATE","BASIC",l);break;case this.effect:if(r=BFN.EffectManager.effectID&&BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("effectName")?BFN.EffectManager.parameters.effectName:BFN.EffectManager.effectID,s.hasParameters=!!BFN.EffectManager.parameters,s.hasParameters&&(s.effectName=BFN.EffectManager.parameters.effectName),s.effectID=BFN.EffectManager.effectID,null!=BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("toolID"))try{var h="",c=BFN.effectPresetMap[BFN.EffectManager.parameters.toolID]?"photo_effects":BFN.EffectManager.parameters.toolID;BFN.UIToolData.hasOwnProperty(BFN.EffectManager.parameters.toolID)?(h=BFN.EffectManager.parameters.toolID.toUpperCase(),n=BFN.EffectManager.parameters.toolID):(h=BFN.EffectManager.parameters.toolID.split("_").slice(1).join("_").toUpperCase(),n=BFN.EffectManager.parameters.toolID),i?BFN.BfnService.upgrade(e||"BASIC_EFFECTS",h+t,c):BFN.BfnService.track("CREATE","BASIC_EFFECTS",h)}catch(e){}break;case this.artsy:if(r="artsy",n=BFN.ImageArtsy.currentToolID?BFN.ImageArtsy.currentToolID:null,BFN.ImageArtsy.currentToolID)if(BFN.ArtsyPresetObjects.hasOwnProperty(BFN.ImageArtsy.currentToolID)&&BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID]&&BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].name)r=BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].name;else if(BFN.ArtsyAdjustAndPaintToolObjects.hasOwnProperty(BFN.ImageArtsy.currentToolID)){var u=BFN.ImageArtsy.currentToolID;r=BFN.ArtsyAdjustAndPaintToolObjects[u].name||u,n=u}if(void 0!==BFN.ImageArtsy.currentToolID&&null!=BFN.ImageArtsy.currentToolID){var d=BFN.ArtsyPresetObjects.hasOwnProperty(BFN.ImageArtsy.currentToolID)?BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].isArtsy?"artsy":"enhance_dlx":void 0;i?BFN.BfnService.upgrade(e||"EFFECTS",BFN.ImageArtsy.currentToolID.toUpperCase()+t,d):BFN.BfnService.track("CREATE","EFFECTS",BFN.ImageArtsy.currentToolID.toUpperCase())}break;case this.border:r="border",this.fitAfterApply=!0,BFN.BfnService.track("CREATE","FRAMES","BORDER");break;case this.dropShadow:r="drop_shadow",this.fitAfterApply=!0,BFN.BfnService.track("CREATE","FRAMES","DROP_SHADOW");break;case this.frame:r=BFN.ImageFrame.currentFrameName,n=BFN.ImageFrame.currentFrameID?BFN.ImageFrame.currentFrameID:null,this.fitAfterApply=!0;try{var m=BFN.ImageFrame.currentFrameID.split("_").slice(2).join("_").toUpperCase();i?BFN.BfnService.upgrade(e||"FRAMES",m+t,"frames"):BFN.BfnService.track("CREATE","FRAMES","FRAMES_"+m)}catch(e){}break;case this.texture:r=BFN.ImageTexture.currentTextureName,n=BFN.ImageTexture.currentTextureID?BFN.ImageTexture.currentTextureID:null;try{var p=BFN.ImageTexture.currentTextureID.split("_").slice(1).join("_").toUpperCase();i?BFN.BfnService.upgrade(e||"TEXTURE",p+t,"texture"):BFN.BfnService.track("CREATE","TEXTURE",p)}catch(e){}break;case this.overlay:r=BFN.ImageOverlay.currentOverlayName,n=BFN.ImageOverlay.currentOverlayID?BFN.ImageOverlay.currentOverlayID:null;try{var g=BFN.ImageOverlay.currentOverlayID.split("_").slice(1).join("_").toUpperCase();i?BFN.BfnService.upgrade(e||"OVERLAY",g+t,"template"):BFN.BfnService.track("CREATE","OVERLAY",g)}catch(e){}break;case this.flare:r=BFN.ImageLensFlare.currentPresetName,n=BFN.ImageLensFlare.currentPresetID?BFN.ImageLensFlare.currentPresetID:null;try{var f=BFN.ImageLensFlare.currentPresetID.replace(" ","_").toUpperCase();i?BFN.BfnService.upgrade(e||"LENS_FLARE",f+t,"lens_flares"):BFN.BfnService.track("CREATE","LENS_FLARE",f)}catch(e){}break;case this.crop:BFN.BfnService.track("CREATE","BASIC","CROP"),r="crop",a=new PIXI.Point(this.crop.cropOffsetLeft,this.crop.cropOffsetTop),this.fitAfterApply=!0;break;case this.rotator:BFN.BfnService.track("CREATE","BASIC","ROTATE"),r="rotate",this.fitAfterApply=!0;break;case this.resizer:BFN.BfnService.track("CREATE","BASIC","RESIZE"),r="resize",this.fitAfterApply=!0;break;case this.slimming:i?BFN.BfnService.upgrade(e||"TOUCHUP","SLIMMING"+t,"touchup"):BFN.BfnService.track("CREATE","BASIC","WEIGHT_LOSS"),r="slimming";break;case this.reshape:i?BFN.BfnService.upgrade(e||"RESHAPE","RESHAPE"+t,"reshape"):BFN.BfnService.track("CREATE","BASIC","RESHAPE"),r="reshape";break;case this.tilter:BFN.BfnService.track("CREATE","BASIC","TILT"),r="tilt",this.fitAfterApply=!0;break;case this.focus:i?BFN.BfnService.upgrade(e||"EDIT","FUNKY_FOCUS"+t,"funky_focus"):BFN.BfnService.track("CREATE","BASIC","FUNKYFOCUS"),r="funky_focus";break;case this.vignette:i?BFN.BfnService.upgrade(e||"EDIT","VIGNETTE"+t,"vignette"):BFN.BfnService.track("CREATE","BASIC","VIGNETTE"),r="vignette";break;case this.paintBrush:BFN.BfnService.track("CREATE","BASIC","PAINT_BRUSH"),r="paint_brush";break;case this.clone:i?BFN.BfnService.upgrade(e||"TOUCHUP","CLONE"+t,"clone"):BFN.BfnService.track("CREATE","BASIC","CLONE"),r="clone";break;case this.blemish:BFN.BfnService.track("CREATE","BASIC","BLEMISH"),r="blemish_fix";break;case this.background:i?BFN.BfnService.upgrade(e||"EDIT","BACKGROUND"+t,"background"):BFN.BfnService.track("CREATE","BASIC","BACKGROUND"),r="background";break;case this.matting:i?BFN.BfnService.upgrade(e||"EDIT","MATTING"+t,"matting"):BFN.BfnService.track("CREATE","BASIC","MATTING"),r="matting";break;case this.cutout:i?BFN.BfnService.upgrade(e||"EDIT","CUTOUT"+t,"cutout"):BFN.BfnService.track("CREATE","BASIC","CUTOUT"),r="cutout"}r||(BeFunky.throwError("Missing historyTag",BFN.PhotoEditorCanvasModel.viewState,JSON.stringify(s)),r="image_updated"),n||(n=r);var v=BFN.UserActionManager.getEditorToolObject(n);if(v.imageLayer=!1,i){var y=[v.toolType,v.toolName];return v.toolSearchID&&y.push(v.toolSearchID),BFN.UserActionManager.addUpgradeAction(y),!1}if(BFN.TransformModel.layerItem&&BFN.TransformItemIsolator.active){if(!["texture","frame_texture"].includes(BFN.TransformModel.layerItem.type))return!1;var x=BFN.TransformItemIsolator.isolatedTransformItem,_=BFN.TransformItemIsolator.itemTexture,I=this.currentTool.sourceTexture,T=this.currentTool.modifiedTexture,b=new BFN.Rectangle((I.width-T.width)/2,(I.height-T.height)/2,T.width,T.height);switch(this.currentTool){case this.crop:b=this.crop.cropRect;break;case this.cutout:this.cutout.trimTransparency&&(b=this.cutout.cutoutRect)}if(!b)return!1;T.rotate="texture"===x.type?0:[0,12,8,4][x.flippedHorizontal+2*x.flippedVertical];var S=T.renderClone();T.copyPixels(S),S.destroyGC(!0),BFN.TransformItemIsolator.usingAlternateMenu&&(this.fitAfterApply=!1,T.width>_.width||T.height>_.height?(_.resize(T.width,T.height),_.copyPixels(T)):_.copyPixels(T,{x:b.x,y:b.y}));var C=BFN.ImageLibraryManager.createMenuImageVOFromTexture(T,null,!1).id;switch(x.type){case"texture":var B=x.itemContentW*x.scale.x,F=x.itemContentH*x.scale.y,E=B*(b.x/I.width),P=F*(b.y/I.height),N=Math.sqrt(Math.pow(E,2)+Math.pow(P,2)),M=Math.atan2(P,E)+x.rotation,D={x:Math.cos(M)*N,y:Math.sin(M)*N};x.replaceImage(C,T,r,D.x,D.y);break;case"frame_texture":var w=x.itemContent,k=w.frameWidth*(b.x/I.width),L=w.frameHeight*(b.y/I.height),O=Math.sqrt(Math.pow(k,2)+Math.pow(L,2)),R=Math.atan2(L,k)+x.rotation,A={x:Math.cos(R)*O,y:Math.sin(R)*O},V={frameWidth:w.frameWidth*(T.width/I.width),frameHeight:w.frameHeight*(T.height/I.height)},U=Math.max(V.frameWidth/T.width,V.frameHeight/T.height),G=T.width*U,H=T.height*U;V.textureScaleX=V.frameWidth/G,V.textureScaleY=V.frameHeight/H,x.replaceImage(C,T,r,A.x,A.y,!1,V,!0)}T.baseTexture.imageOffset={x:-T.width/2-(b.x-I.width/2),y:-T.height/2-(b.y-I.height/2)},x.transitionVO&&(o=x.transitionVO.timestamp),v.imageLayer=!0,BFN.TransformItemIsolator.imageLayerEdited=!0}else BFN.AppModel.viewingEditor&&(o=BFN.PhotoEditorHistoryModel.addTextureToHistory(r,BFN.PhotoEditorModel.currentTexture),a&&(BFN.PhotoEditorCanvasModel.itemOffsetPoint=a));UIMessages.display(BeFunky.LanguageManager.getString(r)+" "+BeFunky.LanguageManager.getString("applied"));var z=new BFN.UserActionVO;return z.eventID="editing_applied",z.eventObject=v,z.actionSection=BFN.AppModel.sectionValue("editor","collage","designer"),z.actionTimestamp=o,z.register(),!0}},Ig.prototype.updateToolView=function(){var e=!1;!this.altSourceTexture&&BFN.TransformItemIsolator.active&&BFN.TransformItemIsolator.altSourceTexture&&(this.altSourceTexture=BFN.TransformItemIsolator.altSourceTexture,e=!0);var t=this.altSourceTexture?this.altSourceTexture:BFN.PhotoEditorModel.currentTexture;if(e&&(this.altSourceTexture=null),this.toolMap.hasOwnProperty(BFN.PhotoEditorCanvasModel.viewState)){var i=this.toolMap[BFN.PhotoEditorCanvasModel.viewState];this.hasOwnProperty(i.id)||i.init()}for(var r in BFN.applyCancelMenu.alternateApply=!1,this.toolMap){var a=this.toolMap[r];if(this.hasOwnProperty(a.id)){var n=this[a.id];n.visible=BFN.PhotoEditorCanvasModel.viewState==r,n.setSourceTexture(n.visible&&null!=t?t:null)}}this.updateToolScales(),this.currentTool&&(this.currentTool.off("pointerover",this.handleToolOverBind),this.currentTool.off("pointerout",this.handleToolOutBind),this.currentTool.off("pointerdown",this.handleToolPressedBind)),this.currentTool=null;for(var o=0;o<this.tools.length;o++){var s=this.tools[o];s.visible&&(this.currentTool=s)}if(this.currentTool)this.currentTool.interactive&&(this.currentTool.on("pointerover",this.handleToolOverBind),this.currentTool.on("pointerout",this.handleToolOutBind),this.currentTool.on("pointerdown",this.handleToolPressedBind)),this.updatePremiumWatermarkDimensions();else{this.premiumWatermark.currentToolID=null,this.premiumWatermark.updateDisplay(),BFN.ImagePainterUndoManager.reset();try{BFN.FilterHelper.emptyPoolForFilter()}catch(e){}}var l=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),h=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME_ANIMATED,BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME_ANIMATED,BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME_ANIMATED);switch(this.currentTool){case this.border:case this.dropShadow:case this.frame:case this.overlay:case this.flare:case this.crop:case this.rotator:case this.resizer:case this.slimming:case this.tilter:case this.focus:case this.vignette:l.dispatchEvent(h);break;default:this.altSourceTexture&&l.dispatchEvent(h)}BFN.GlobalHistoryModel.updateGlobalHistoryMenuState(),this.currentTool||setTimeout(()=>{BFN.MainUI.renderCanvas(),setTimeout(()=>{BFN.MainUI.renderCanvas()},BFN.frameInterval)},BFN.frameInterval)},Ig.prototype.updateToolScales=function(){switch(this.premiumWatermark.canvasScale=this._scale,this.effect&&(this.effect.toolScale=this._scale),BFN.PhotoEditorCanvasModel.viewState){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP:this.touchup.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:this.effect.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY:this.artsy.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER:this.border.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW:this.dropShadow.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME:this.frame.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE:this.texture.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY:this.overlay.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE:this.flare.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CROP:this.crop.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE:this.rotator.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE:this.resizer.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING:this.slimming.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESHAPE:this.reshape.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT:this.tilter.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS:this.focus.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_VIGNETTE:this.vignette.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_PAINT_BRUSH:this.paintBrush.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CLONE:this.clone.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_BLEMISH_FIX:this.blemish.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_BACKGROUND:this.background.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING:this.matting.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT:this.cutout.toolScale=this._scale}},Ig.prototype.updatePremiumWatermarkDimensions=function(){if(this.currentTool){var e=0,t=0;this.currentTool.hasOwnProperty("itemWidth")&&this.currentTool.hasOwnProperty("itemHeight")?(e=this.currentTool.itemWidth,t=this.currentTool.itemHeight):BFN.TransformItemIsolator.active?(e=BFN.TransformItemIsolator.itemWidth,t=BFN.TransformItemIsolator.itemHeight):BFN.AppModel.viewingEditor&&BFN.PhotoEditorModel.currentTexture&&(e=BFN.PhotoEditorModel.currentTexture.width,t=BFN.PhotoEditorModel.currentTexture.height),this.premiumWatermark.setDimensions(e,t)}},Ig.prototype.handleCanvasViewStateUpdated=function(e){this.updateToolView(),BFN.PhotoEditorCanvas.updateCheckerPanel(),BFN.PhotoEditorCanvas.updateToolPosition()},Ig.prototype.handleToolDimensionsUpdated=function(e){this.updatePremiumWatermarkDimensions()},Ig.prototype.handleToolOver=function(e){(!BFN.ImagePainterUndoManager.currentImagePainter||BFN.ImagePainterUndoManager.currentImagePainter&&!BFN.ImagePainterUndoManager.currentImagePainter.paintingEnabled)&&this.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_OVER)},Ig.prototype.handleToolOut=function(e){this.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_OUT)},Ig.prototype.handleToolPressed=function(e){(!BFN.ImagePainterUndoManager.currentImagePainter||BFN.ImagePainterUndoManager.currentImagePainter&&!BFN.ImagePainterUndoManager.currentImagePainter.paintingEnabled)&&this.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.START_CANVAS_DRAG),this.toolPressed=!0,document.addEventListener(BeFunky.pointerup,this.handleToolReleasedBind)},Ig.prototype.handleToolReleased=function(e){this.toolPressed=!1,document.removeEventListener(BeFunky.pointerup,this.handleToolReleasedBind)},Object.defineProperty(Ig.prototype,"scale",{set:function(e){this._scale=e,this.updateToolScales()},get:function(){return this._scale}}),Object.defineProperty(Ig.prototype,"scaling",{set:function(e){this._scaling=e,this.premiumWatermark.canvasScaling=this._scaling,this.currentTool&&(this.currentTool.toolScaling=this._scaling)},get:function(){return this._scaling}}),BFN.SingletonQueue.add(function(){BFN.PhotoEditorCanvasTools=new Ig}),Tg.prototype=Object.create(PIXI.Sprite.prototype),Tg.prototype.init=function(){BeFunky.log("PhotoEditorCanvas Init"),this.initDefaultValues(),this.initCheckerPanel(),this.initCanvas(),this.initCanvasImageOriginal(),this.initCanvasImage(),this.initCanvasTools(),this.initTransformCanvas(),this.initTransformLayer(),this.initCanvasPixelGrid(),this.initTransformLayerVeil(),this.initTransformIndicatorContainer(),this.initTransformGuidesContainer(),this.initTransformItemBoundingBoxesContainer(),this.initTransformTool(),this.initTransformToolSnapGaps(),this.initTransformItemIsolator(),this.initLayerToolContainer(),this.initMoveTouchSurface(),this.initCanvasDragger(),this.initAnimators(),BFN.AppModel.viewingEditor&&this.updateCanvasView()},Tg.prototype.initDefaultValues=function(){this.interactive=!0,this.mouseOver=!1,this.hoverSurfaceOver=!1,this.model=BFN.PhotoEditorCanvasModel,BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.handleSourceImageUpdated.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED.type,this.handleCurrentImageUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handleCanvasViewStateUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME.type,this.handleFitImageToFrame.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME_ANIMATED.type,this.handleFitImageToFrameAnimated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.ITEM_ADDED.type,this.handleItemAdded.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.OFFSET_ITEMS.type,this.handleOffsetItems.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.FLATTEN_ITEMS.type,this.handleFlattenItems.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS.type,this.handleClearItems.bind(this)),this.on("pointerover",this.handleCanvasMouseOver.bind(this)),this.on("pointerout",this.handleCanvasMouseOut.bind(this)),this.handleCanvasKeyDownBind=this.handleCanvasKeyDown.bind(this),this.handleCanvasSpaceKeyUpBind=this.handleCanvasSpaceKeyUp.bind(this),this.handleCanvasOKeyUpBind=this.handleCanvasOKeyUp.bind(this),document.addEventListener("keydown",this.handleCanvasKeyDownBind,!0)},Tg.prototype.initCheckerPanel=function(){this.checkerPanel=new BFN.CheckerPanel,this.checkerPanel.setDimensions(0,0),this.addChild(this.checkerPanel)},Tg.prototype.initCanvas=function(){this.canvasContainer=new PIXI.Sprite,this.canvasContainer.interactive=!0,this.addChild(this.canvasContainer),this.canvas=new PIXI.Sprite,this.canvasContainer.addChild(this.canvas)},Tg.prototype.initCanvasImageOriginal=function(){this.canvasImageOriginal=new PIXI.Sprite,this.canvasImageOriginal.interactive=!0,this.canvasImageOriginal.visible=!1,this.canvasImageOriginal.pluginName="smooth_picture",this.canvasImageOriginal.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.canvasImageOriginal.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.canvasImageOriginal.on("pointerdown",this.handleCanvasImagePressed.bind(this)),this.canvas.addChild(this.canvasImageOriginal)},Tg.prototype.initCanvasImage=function(){this.canvasImage=BFN.PhotoEditorCanvasImage,this.canvasImage.pluginName="smooth_picture",this.canvasImage.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.canvasImage.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.canvasImage.on("pointerdown",this.handleCanvasImagePressed.bind(this)),this.canvas.addChild(this.canvasImage)},Tg.prototype.initCanvasTools=function(){this.canvasToolsContainer=new PIXI.Container,this.canvasContainer.addChild(this.canvasToolsContainer),this.canvasTools=BFN.PhotoEditorCanvasTools,this.canvasToolsContainer.addChild(this.canvasTools),this.canvasTools.addEventListener(BFN.PhotoEditorCanvasToolsEvents.TOOL_OVER.type,this.handleHoverSurfaceOver.bind(this)),this.canvasTools.addEventListener(BFN.PhotoEditorCanvasToolsEvents.TOOL_OUT.type,this.handleHoverSurfaceOut.bind(this)),this.canvasTools.addEventListener(BFN.PhotoEditorCanvasToolsEvents.START_CANVAS_DRAG.type,this.handleToolStartCanvasDrag.bind(this)),this.canvasTools.addEventListener(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED.type,this.handleToolDimensionsUpdated.bind(this))},Tg.prototype.initTransformCanvas=function(){this.transformCanvas=new PIXI.Container,this.transformCanvas.interactive=!1,this.canvasContainer.addChild(this.transformCanvas)},Tg.prototype.initTransformLayer=function(){this.transformLayer=new BFN.TransformLayer(BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,this),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,this.handleTransformItemsUpdated.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_SELECTED.type,this.handleTransformItemSelected.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED.type,this.handleTransformItemDisplayUpdated.bind(this)),this.canvas.addChild(this.transformLayer)},Tg.prototype.initCanvasPixelGrid=function(){BFN.PhotoEditorCanvasModel.usePixelGrid&&(this.canvasPixelGrid=new BFN.PixelGrid,this.canvas.addChild(this.canvasPixelGrid))},Tg.prototype.initTransformLayerVeil=function(){this.transformLayerVeil=new BFN.CanvasFrame(BFN.AppBackgroundColor,1,BFN.PhotoEditorCanvasModel.imageFitPaddingX,BFN.PhotoEditorCanvasModel.imageFitPaddingY),this.addChild(this.transformLayerVeil)},Tg.prototype.initTransformIndicatorContainer=function(){this.transformIndicatorContainer=new PIXI.Container,this.transformIndicatorContainer.interactiveChildren=!1,this.addChild(this.transformIndicatorContainer)},Tg.prototype.initTransformGuidesContainer=function(){this.transformGuidesContainer=new PIXI.Container,this.addChild(this.transformGuidesContainer)},Tg.prototype.initTransformItemBoundingBoxesContainer=function(){this.transformItemBoundingBoxesContainer=new PIXI.Container,this.addChild(this.transformItemBoundingBoxesContainer)},Tg.prototype.initTransformTool=function(){this.transformTool=new BFN.TransformTool(this.transformLayer),this.addChild(this.transformTool),this.transformLayer.transformTool=this.transformTool},Tg.prototype.initTransformToolSnapGaps=function(){this.transformToolSnapGapsContainer=new PIXI.Container,this.addChild(this.transformToolSnapGapsContainer)},Tg.prototype.initTransformItemIsolator=function(){this.transformItemIsolatorContainer=new PIXI.Container,this.canvasContainer.addChild(this.transformItemIsolatorContainer)},Tg.prototype.initLayerToolContainer=function(){this.layerToolContainer=new PIXI.Container,this.addChild(this.layerToolContainer)},Tg.prototype.initMoveTouchSurface=function(){this.moveTouchSurface=new PIXI.Graphics,this.moveTouchSurface.interactive=!0,this.moveTouchSurface.visible=!1,this.moveTouchSurface.beginFill(0,0),this.moveTouchSurface.drawRect(-50,-50,100,100),this.moveTouchSurface.endFill(),this.moveTouchSurface.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.moveTouchSurface.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.moveTouchSurface.on("pointerdown",this.handleMoveTouchSurfacePressed.bind(this)),this.addChild(this.moveTouchSurface)},Tg.prototype.initCanvasDragger=function(){this.canvasDragger=new BFN.Dragger,this.canvasDragger.pixelDragThreshold=5,this.canvasDragger.pixelDragThresholdPreventEvent=!0,this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasDraggerDraggingComplete.bind(this))},Tg.prototype.initAnimators=function(){this.fitImageAnimator=new BFN.Animator,this.fitImageAnimator.linearSteps=10,this.fitImageAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFitImageAnimatorUpdate.bind(this)),this.fitImageAnimator.addEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleFitImageAnimatorUpdateComplete.bind(this))},Tg.prototype.updateCanvasContainerDisplay=function(){var e=2*BFN.PhotoEditorCanvasModel.imageFitPaddingX,t=2*BFN.PhotoEditorCanvasModel.imageFitPaddingY,i=this.canvasImageOriginal.visible?this.canvasImageOriginal.texture.width:this.canvasImage.imageWidth,r=this.canvasImageOriginal.visible?this.canvasImageOriginal.texture.height:this.canvasImage.imageHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(i-=(i-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,r-=(r-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),!this.canvasImageOriginal.visible&&BFN.PhotoEditorCanvasTools.currentTool&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemWidth")&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemHeight")&&(i=BFN.PhotoEditorCanvasTools.currentTool.itemWidth,r=BFN.PhotoEditorCanvasTools.currentTool.itemHeight),this.canvasImageOriginal.visible&&(this.canvasImageOriginal.x=(this.canvasImage.imageWidth-this.canvasImageOriginal.texture.width)/2,this.canvasImageOriginal.y=(this.canvasImage.imageHeight-this.canvasImageOriginal.texture.height)/2);var a=i?this.scale.x*i:1,n=r?this.scale.y*r:1,o=Math.max(0,i-BFN.StageModel.stageW/a*i+1/this.scale.x*e),s=Math.max(0,r-BFN.StageModel.stageH/n*r+1/this.scale.y*t);this.canvasDragger.setBounds(-o/2,-s/2,o/2,s/2),this.canvasContainer.x=Math.round(Math.min(this.canvasDragger.bounds.maxX,Math.max(this.canvasDragger.bounds.minX,this.canvasContainer.x))),this.canvasContainer.y=Math.round(Math.min(this.canvasDragger.bounds.maxY,Math.max(this.canvasDragger.bounds.minY,this.canvasContainer.y))),this.layerToolContainer.x=this.canvasContainer.x,this.layerToolContainer.y=this.canvasContainer.y,this.transformItemBoundingBoxesContainer.x=this.canvasContainer.x,this.transformItemBoundingBoxesContainer.y=this.canvasContainer.y,this.updateCheckerPanel(),this.updateTransformLayerVeil(),this.updateToolPosition(),BFN.TransformGuides.updateDisplay(),BFN.MainUI.requestRender()},Tg.prototype.updateToolPosition=function(){this.transformTool.x=this.canvasContainer.x,this.transformTool.y=this.canvasContainer.y,this.transformLayerVeil.x=this.canvasContainer.x+this.canvas.x+this.canvasImage.imageWidth/2,this.transformLayerVeil.y=this.canvasContainer.y+this.canvas.y+this.canvasImage.imageHeight/2},Tg.prototype.updateCanvasImage=function(){null==BFN.PhotoEditorModel.currentTexture?(this.canvasImage.texture=PIXI.Texture.EMPTY,this.canvas.x=this.transformCanvas.x=0,this.canvas.y=this.transformCanvas.y=0):(this.canvasImage.texture=BFN.PhotoEditorModel.currentTexture,this.canvas.x=this.transformCanvas.x=-Math.round(this.canvasImage.texture.width/2),this.canvas.y=this.transformCanvas.y=-Math.round(this.canvasImage.texture.height/2)),this.transformLayer.x=-this.canvas.x,this.transformLayer.y=-this.canvas.y,this.canvasPixelGrid&&(this.canvasPixelGrid.x=this.transformLayer.x,this.canvasPixelGrid.y=this.transformLayer.y),this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},Tg.prototype.updateCanvasView=function(){switch(this.canvasImage.visible=BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,this.canvasTools.visible=!this.canvasImage.visible,this.transformLayer.visible=this.canvasImage.visible,this.transformTool.visible=this.canvasImage.visible,BFN.PhotoEditorCanvasModel.viewState){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS:this.transformLayer.visible=!0,this.transformLayer.enableChildren(),this.canvas.addChild(this.transformLayer),this.canvasPixelGrid&&this.canvas.addChild(this.canvasPixelGrid);break;default:this.transformLayer.visible=!1,this.transformLayer.disableChildren(),this.transformCanvas.addChild(this.transformLayer)}this.transformLayerVeil.visible=BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,this.updateTransformLayerVeil(),BFN.ZoomManager.updateZoomRange(),BFN.MainUI&&BFN.MainUI.requestRender()},Tg.prototype.updatePosition=function(){this.x=Math.round(BFN.StageModel.stageW/2),this.y=Math.round(BFN.StageModel.stageH/2),this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.updateTransformLayerVeilOuterDimensions(),this.updateCanvasContainerDisplay()},Tg.prototype.updateScale=function(){this.scale.x=this.scale.y=this.canvasTools.scale=this.transformLayer.canvasScale=this.transformTool.scale=this.canvasDragger.scale=BFN.PhotoEditorCanvasModel.canvasScale,this.transformItemBoundingBoxesContainer.children.includes(BFN.TransformItemBoundingBoxes)&&(BFN.TransformItemBoundingBoxes.lineScale=BFN.PhotoEditorCanvasModel.canvasScale),this.transformGuidesContainer.scale.x=1/this.scale.x,this.transformGuidesContainer.scale.y=1/this.scale.y,this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.canvasImage.currentScale=this.canvasImageOriginal.currentScale=BFN.PhotoEditorCanvasModel.canvasScale,this.transformLayerVeil.canvasScale=BFN.PhotoEditorCanvasModel.canvasScale,this.canvasPixelGrid&&(this.canvasPixelGrid.canvasScale=BFN.PhotoEditorCanvasModel.canvasScale),this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},Tg.prototype.fitImageToFrame=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=2*BFN.PhotoEditorCanvasModel.imageFitPaddingX,i=2*BFN.PhotoEditorCanvasModel.imageFitPaddingY,r=this.canvasImage.width,a=this.canvasImage.height;BFN.TransformItemIsolator.active&&BFN.TransformItemIsolator.itemWidth>0&&BFN.TransformItemIsolator.itemHeight>0&&(r=BFN.TransformItemIsolator.itemWidth,a=BFN.TransformItemIsolator.itemHeight);var n=BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS?BFN.PhotoEditorCanvasTools.currentTool:null;n&&(r=n.hasOwnProperty("itemWidth")?n.itemWidth:r,a=n.hasOwnProperty("itemHeight")?n.itemHeight:a),r<=0||a<=0||(this.fitScale=Math.min(1,(BFN.StageModel.stageW-t)/r,(BFN.StageModel.stageH-i)/a),e?(BFN.PhotoEditorCanvasModel.canvasScaling=!0,this.startScale=BFN.PhotoEditorCanvasModel.canvasScale,Math.abs(this.fitScale-this.startScale)>.001?this.fitImageAnimator.setAnimatorFactor(0):this.fitImageAnimator.setAnimatorFactor(1),this.fitImageAnimator.increase()):(BFN.PhotoEditorCanvasModel.canvasScale=this.fitScale,BFN.PhotoEditorCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()))},Tg.prototype.updateCheckerPanel=function(){this.checkerPanel.x=this.canvasContainer.x+this.canvas.x+this.canvasImage.imageWidth/2,this.checkerPanel.y=this.canvasContainer.y+this.canvas.y+this.canvasImage.imageHeight/2,this.checkerPanel.scale=BFN.PhotoEditorCanvasModel.canvasScale;var e={x:0,y:0};if(this.canvasImageOriginal.visible)this.canvasImageOriginal.texture.width>1&&this.canvasImageOriginal.texture.height>1&&(e.x=this.canvasImageOriginal.texture.width,e.y=this.canvasImageOriginal.texture.height);else if(BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)this.canvasImage.imageWidth>1&&this.canvasImage.imageHeight>1&&(e.x=this.canvasImage.imageWidth,e.y=this.canvasImage.imageHeight);else{var t=BFN.PhotoEditorCanvasTools.currentTool;if(t&&void 0!==t.itemWidth&&void 0!==t.itemHeight){var i=t.itemWidth,r=t.itemHeight;e.x=i,e.y=r}else e.x=this.canvasImage.imageWidth,e.y=this.canvasImage.imageHeight}if(BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)){var a=BFN.TransformItemIsolator.itemWidth,n=BFN.TransformItemIsolator.itemHeight;BFN.TransformItemIsolator.shiftAnimator.animating&&(a=BFN.TransformItemIsolator.shiftParamsEnd.w-(BFN.TransformItemIsolator.shiftParamsEnd.w-BFN.TransformItemIsolator.shiftParamsStart.w)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor),n=BFN.TransformItemIsolator.shiftParamsEnd.h-(BFN.TransformItemIsolator.shiftParamsEnd.h-BFN.TransformItemIsolator.shiftParamsStart.h)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor)),e.x=e.x-(e.x-a)*BFN.TransformItemIsolator.activeFactor,e.y=e.y-(e.y-n)*BFN.TransformItemIsolator.activeFactor}this.checkerPanel.setDimensions(e.x,e.y)},Tg.prototype.updateTransformLayerVeil=function(){if(this.canvasImageOriginal.visible)this.transformLayer.frameWidth=this.canvasImageOriginal.texture.width,this.transformLayer.frameHeight=this.canvasImageOriginal.texture.height,this.transformTool.frameWidth=this.canvasImageOriginal.texture.width,this.transformTool.frameHeight=this.canvasImageOriginal.texture.height;else if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)this.transformLayer.frameWidth=this.canvasImage.imageWidth,this.transformLayer.frameHeight=this.canvasImage.imageHeight,this.transformTool.frameWidth=this.canvasImage.imageWidth,this.transformTool.frameHeight=this.canvasImage.imageHeight;else{var e=BFN.PhotoEditorCanvasTools.currentTool;if(e&&void 0!==e.itemWidth&&void 0!==e.itemHeight){var t=e.itemWidth,i=e.itemHeight;this.transformLayer.frameWidth=t,this.transformLayer.frameHeight=i,this.transformTool.frameWidth=t,this.transformTool.frameHeight=i}else this.transformLayer.frameWidth=this.canvasImage.imageWidth,this.transformLayer.frameHeight=this.canvasImage.imageHeight,this.transformTool.frameWidth=this.canvasImage.imageWidth,this.transformTool.frameHeight=this.canvasImage.imageHeight}var r=this.transformLayer.frameWidth,a=this.transformLayer.frameHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(r=this.transformLayer.frameWidth-(this.transformLayer.frameWidth-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,a=this.transformLayer.frameHeight-(this.transformLayer.frameHeight-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),this.canvasPixelGrid&&(this.canvasPixelGrid.active!=BFN.PhotoEditorCanvasModel.usePixelGrid&&(this.canvasPixelGrid.active=BFN.PhotoEditorCanvasModel.usePixelGrid),this.canvasPixelGrid.setFrameDimensions(r,a)),this.moveTouchSurface.scale.x=r/100,this.moveTouchSurface.scale.y=a/100,this.drawTransformLayerVeil(r,a)},Tg.prototype.updateTransformLayerVeilOuterDimensions=function(){this.transformLayerVeil.setOuterDimensions(BFN.StageModel.stageW+20,BFN.StageModel.stageH+2)},Tg.prototype.drawTransformLayerVeil=function(e,t){e=Math.round(e),t=Math.round(t),this.transformLayerVeil.setInnerDimensions(e,t)},Tg.prototype.getFlattenedImage=function(){if(this.canvasImage.texture&&this.canvasImage.texture.width&&this.canvasImage.texture.height){var e={x:this.canvas.x,y:this.canvas.y};this.canvas.x=this.canvas.y=0,this.transformLayer.toggleHiResTextDisplay(!1),this.transformLayer.toggleItemScaleSmoothing(!1),this.transformLayer.setItemScaleMode(PIXI.SCALE_MODES.NEAREST,["text"]),this.canvasImage.currentScale=1,this.canvasContainer.removeChild(this.canvas);var t=PIXI.RenderTexture.create(this.canvasImage.texture.width,this.canvasImage.texture.height);return BFN.Stage.render(this.canvas,t),this.canvas.x=e.x,this.canvas.y=e.y,this.canvasContainer.addChild(this.canvas),this.canvasImage.currentScale=BFN.PhotoEditorCanvasModel.canvasScale,this.transformLayer.toggleHiResTextDisplay(!0),this.transformLayer.toggleItemScaleSmoothing(!0),this.transformLayer.setItemScaleMode(PIXI.SCALE_MODES.LINEAR,["text"]),t}return null},Tg.prototype.handleStageDimensionsUpdated=function(){this.updatePosition()},Tg.prototype.handleSourceImageUpdated=function(){this.canvasImageOriginal.texture=BFN.PhotoEditorModel.sourceTexture},Tg.prototype.handleCurrentImageUpdated=function(){this.updateCanvasImage()},Tg.prototype.handleCanvasViewStateUpdated=function(){this.updateCanvasView()},Tg.prototype.handleCanvasScaleUpdated=function(){this.updateScale()},Tg.prototype.handleCanvasScalingUpdated=function(){this.canvasTools.scaling=BFN.PhotoEditorCanvasModel.canvasScaling},Tg.prototype.handleFitImageToFrame=function(){this.fitImageToFrame()},Tg.prototype.handleFitImageToFrameAnimated=function(){this.fitImageToFrame(!0)},Tg.prototype.handleItemAdded=function(){BFN.PhotoEditorCanvasModel.addedItem&&(BFN.GlobalHistoryModel.updateGlobalHistoryMenuState(),this.transformLayer.addItem(BFN.PhotoEditorCanvasModel.addedItem),BFN.PhotoEditorCanvasModel.addedItem=null)},Tg.prototype.handleOffsetItems=function(){this.transformLayer.offsetAllItems(BFN.PhotoEditorCanvasModel.itemOffsetPoint.x,BFN.PhotoEditorCanvasModel.itemOffsetPoint.y)},Tg.prototype.handleFlattenItems=function(){var e=this.getFlattenedImage();if(e){BFN.PhotoEditorModel.updateCurrentTexture(e);var t=BFN.PhotoEditorHistoryModel.addTextureToHistory("layers_flattened",BFN.PhotoEditorModel.currentTexture),i=new BFN.UserActionVO;i.eventID="editing_applied",i.eventObject={toolType:"Other",toolName:"Flatten"},i.actionSection="editor",i.actionTimestamp=t,this.transformLayer.children.forEach(e=>{e instanceof BFN.TransformItem&&(i.transformItems||(i.transformItems=[]),i.transformItems.push(e))}),i.register(),this.transformLayer.removeAllItems(),UIMessages.display("layers_flattened")}},Tg.prototype.handleClearItems=function(){this.transformLayer.destroyAllItems()},Tg.prototype.handleCanvasImagePressed=function(e){BFN.CursorScreen.cursor="grabbing",BFN.CursorScreen.cursorLock=!0,this.canvasDragger.drag(this.canvasContainer)},Tg.prototype.handleToolStartCanvasDrag=function(e){this.handleCanvasImagePressed(e)},Tg.prototype.handleToolDimensionsUpdated=function(e){this.updateCanvasContainerDisplay(),BFN.ZoomManager.updateZoomRange()},Tg.prototype.handleTransformItemsUpdated=function(){var e=this.transformLayer.itemsExist;BFN.PhotoEditorCanvasModel.itemsExist!=e&&(BFN.PhotoEditorCanvasModel.itemsExist=e)},Tg.prototype.handleTransformItemSelected=function(){this.transformLayer.selectedItem?(this.transformTool.selectItem(this.transformLayer.selectedItem),BFN.TransformModel.selectedTransformItem!=this.transformLayer.selectedItem&&(BFN.TransformModel.selectedTransformItem=this.transformLayer.selectedItem)):(this.transformTool.deselectItem(),BFN.TransformModel.selectedTransformItem=null)},Tg.prototype.handleTransformItemDisplayUpdated=function(){this.transformTool.updateDisplay()},Tg.prototype.handleHoverSurfaceOver=function(e){setTimeout(function(){this.hoverSurfaceOver=!0,BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"grab"}.bind(this),0)},Tg.prototype.handleHoverSurfaceOut=function(e){this.hoverSurfaceOver=!1,BFN.CursorScreen&&(BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"auto")},Tg.prototype.handleMoveTouchSurfacePressed=function(e){e.stopPropagation(),this.handleCanvasImagePressed(null)},Tg.prototype.handleCanvasMouseOver=function(e){this.mouseOver=!0},Tg.prototype.handleCanvasMouseOut=function(e){this.mouseOver=!1},Tg.prototype.handleCanvasKeyDown=function(e){BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR||BeFunky.isTextBoxFocused()||(32!=e.keyCode||this.moveTouchSurface.visible?79===e.keyCode&&BFN.PhotoEditorModel.currentTexture&&(BFN.PIXITicker.nudge(),document.addEventListener("keyup",this.handleCanvasOKeyUpBind,!0),this.canvasImageOriginal.visible=!0,this.canvasImage.visible=!1,this.canvasTools.visible=!1,this.transformLayer.visible=!1,this.transformTool.visible=!1,this.updateCanvasContainerDisplay()):(BFN.PIXITicker.nudge(),document.addEventListener("keyup",this.handleCanvasSpaceKeyUpBind,!0),this.moveTouchSurface.visible=!0,BFN.MainUI.requestRender(),this.canvasTools.toolPressed&&this.canvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.START_CANVAS_DRAG)))},Tg.prototype.handleCanvasSpaceKeyUp=function(e){this.handleHoverSurfaceOut(),document.removeEventListener("keyup",this.handleCanvasSpaceKeyUpBind,!0),this.moveTouchSurface.visible=!1,BFN.MainUI.requestRender(),this.canvasTools.toolPressed&&this.canvasDragger.stopDrag(),BFN.PIXITicker.nudge()},Tg.prototype.handleCanvasOKeyUp=function(e){this.handleHoverSurfaceOut(),document.removeEventListener("keyup",this.handleCanvasOKeyUpBind,!0),this.canvasImageOriginal.visible=!1,this.canvasImage.visible=null==this.canvasTools.currentTool,this.canvasTools.visible=!this.canvasImage.visible,this.transformLayer.visible=this.canvasImage.visible,this.transformTool.visible=this.canvasImage.visible,this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender(),BFN.PIXITicker.nudge()},Tg.prototype.handleCanvasDraggerDragging=function(){this.updateCanvasContainerDisplay(),BFN.TransformModel.selectedTransformItem&&"group"===BFN.TransformModel.selectedTransformItem.type&&BFN.TransformModel.selectedTransformItem.updateGroupTransform()},Tg.prototype.handleCanvasDraggerDraggingComplete=function(){BFN.CursorScreen.cursorLock=!1,BFN.CursorScreen.cursor=this.hoverSurfaceOver?"grab":"auto"},Tg.prototype.handleFitImageAnimatorUpdate=function(){BFN.PhotoEditorCanvasModel.canvasScale=(this.fitScale-this.startScale)*this.fitImageAnimator.animationSinFactor+this.startScale},Tg.prototype.handleFitImageAnimatorUpdateComplete=function(){BFN.PhotoEditorCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()},BFN.SingletonQueue.add(function(){BFN.PhotoEditorCanvas=new Tg}),bg.prototype=Object.create(PIXI.Sprite.prototype);bg.prototype.init=function(){BeFunky.log("PhotoEditor Init"),this.initDefaultValues(),this.initCanvas()},bg.prototype.initDefaultValues=function(){BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this))},bg.prototype.initCanvas=function(){this.addChild(BFN.PhotoEditorCanvas)},bg.prototype.handleAppReady=function(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIPressed.bind(this))},bg.prototype.handleMainUIPressed=function(e){if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&!BFN.ColorPickerPanel.colorButton&&!BeFunky.isLoadScreenActive()&&BFN.TransformModel.selectedTransformItem){var t=e.data.canvasPressed,i=e.data.originalEvent,r=!(t&&(i.ctrlKey||i.metaKey||i.altKey));BFN.PhotoEditorCanvas.transformLayer.deselectItem(r,i.shiftKey)}},BFN.SingletonQueue.add(function(){BFN.PhotoEditor=new bg}),Sg.prototype=Object.create(PIXI.Container.prototype),Sg.prototype.init=function(){BeFunky.log("CollageMakerCanvasBackground Init"),this.initDefaultValues(),this.initBackgroundGraphic(),this.updateDisplay()},Sg.prototype.initDefaultValues=function(){this._itemWidth=340,this._itemHeight=340,this._color=UITools.getToolValue("collage_customize","background_color"),this.updateDisplayQueued=!1},Sg.prototype.initBackgroundGraphic=function(){this.backgroundGraphic=new PIXI.Graphics,this.addChild(this.backgroundGraphic)},Sg.prototype.queueUpdateDisplay=function(){this.updateDisplayQueued||(this.updateDisplayQueued=!0,requestAnimationFrame(function(){this.updateDisplayQueued=!1,this.updateDisplay()}.bind(this)))},Sg.prototype.updateDisplay=function(){this.backgroundGraphic.clear(),-1!=this._color&&this._itemWidth>0&&this._itemHeight>0&&(this.backgroundGraphic.beginFill(parseInt("0x"+this._color)),this.backgroundGraphic.drawRect(0,0,this._itemWidth,this._itemHeight),this.backgroundGraphic.endFill());try{BFN.MainUI.requestRender()}catch(e){}},Object.defineProperty(Sg.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateDisplay()},get:function(){return this._itemWidth}}),Object.defineProperty(Sg.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateDisplay()},get:function(){return this._itemHeight}}),Object.defineProperty(Sg.prototype,"color",{set:function(e){this._color=e,this.updateDisplay()},get:function(){return this._color}}),BFN.SingletonQueue.add(function(){BFN.CollageMakerCanvasBackground=new Sg}),Cg.prototype=Object.create(PIXI.Container.prototype),Cg.prototype.init=function(){BeFunky.log("PhotoGridChildContentImage Init"),this.initDefaultValues(),this.initFrameSprite(),this.initDragger()},Cg.prototype.initDefaultValues=function(){this._scale=1,this.photoGridDimensions=new PIXI.Point},Cg.prototype.initFrameSprite=function(){this.frameSprite=new BFN.FrameSprite,this.frameSprite.pluginName="smooth_picture",this.frameSprite.expandVertex=0,this.addChild(this.frameSprite)},Cg.prototype.initDragger=function(){this.frameSpriteOffsetFactorStartX=0,this.frameSpriteOffsetFactorStartY=0,this.handleDraggingStartedBind=this.handleDraggingStarted.bind(this),this.handleDraggingCompleteBind=this.handleDraggingComplete.bind(this),this.handleDraggingBind=this.handleDragging.bind(this),this._dragger=new BFN.Dragger,this._dragger.stickyDrag=!0,this._dragger.useBounds=!0,this._dragger.autoDrag=!1,this._dragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStartedBind),this._dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingCompleteBind),this._dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleDraggingBind)},Cg.prototype.setBaseTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{this.frameSprite.texture.destroyGC(!1)}catch(e){}this.frameSprite.texture=PIXI.Texture.EMPTY,e&&this.frameSprite.setTexture(new PIXI.Texture(e)),t?this.reset(i):0!=i&&(this.frameSprite.texture.rotate=i,this.frameSprite.updateDisplay()),this.updateSmoothing()},Cg.prototype.setSize=function(e,t){this._itemWidth=e,this._itemHeight=t,this.frameSprite.frameWidth=this._itemWidth,this.frameSprite.frameHeight=this._itemHeight,this.frameSprite.updateDisplay(),this.updateSmoothing()},Cg.prototype.resize=function(e){this.frameSprite.textureScale=e,this.frameSprite.updateDisplay(),this.updateSmoothing()},Cg.prototype.setPhotoGridDimensions=function(e,t){this.photoGridDimensions.x=e,this.photoGridDimensions.y=t},Cg.prototype.drag=function(){this.updateDragBounds(),this._dragger.drag(this.frameSprite)},Cg.prototype.revertImagePosition=function(){this.frameSprite.offsetFactorX=this.frameSpriteOffsetFactorStartX,this.frameSprite.offsetFactorY=this.frameSpriteOffsetFactorStartY,this.frameSprite.updateDisplay()},Cg.prototype.updateSmoothing=function(){this.frameSprite.currentScale=this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale},Cg.prototype.flip=function(e){switch(e){case"horizontal":this.frameSprite.flipH();break;case"vertical":this.frameSprite.flipV()}},Cg.prototype.rotate=function(e){switch(e){case"left":this.frameSprite.rotateL();break;case"right":this.frameSprite.rotateR()}this.updateSmoothing()},Cg.prototype.reset=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;this.frameSprite&&(this.frameSprite.texture.rotate=e,this.frameSprite.textureScale=t,this.frameSprite.offsetFactorX=i,this.frameSprite.offsetFactorY=r,this.frameSprite.updateDisplay(),this.updateSmoothing())},Cg.prototype.updateDragBounds=function(){this.frameSpriteOffsetFactorStartX=this.frameSprite.offsetFactorX,this.frameSpriteOffsetFactorStartY=this.frameSprite.offsetFactorY;var e=this.frameSprite.excessX*this.frameSprite.offsetFactorX*(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),t=(this.frameSprite.excessX-this.frameSprite.excessX*this.frameSprite.offsetFactorX)*(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),i=this.frameSprite.excessY*this.frameSprite.offsetFactorY*(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),r=(this.frameSprite.excessY-this.frameSprite.excessY*this.frameSprite.offsetFactorY)*(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale);switch(this.frameSprite.texture.rotate){case 0:this._dragger.setBounds(-t,-r,e,i);break;case 2:this._dragger.setBounds(-r,-e,i,t);break;case 4:this._dragger.setBounds(-e,-i,t,r);break;case 6:this._dragger.setBounds(-i,-t,r,e);break;case 8:this._dragger.setBounds(-t,-i,e,r);break;case 10:this._dragger.setBounds(-r,-t,i,e);break;case 12:this._dragger.setBounds(-e,-r,t,i);break;case 14:this._dragger.setBounds(-i,-e,r,t)}},Cg.prototype.destroy=function(){this._dragger.removeEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleDraggingBind),this._dragger=null,this.frameSprite.destroy(),this.removeChild(this.frameSprite),this.frameSprite=null},Cg.prototype.handleDraggingStarted=function(e){BFN.smoothPictureDisabled=!0},Cg.prototype.handleDraggingComplete=function(e){BFN.smoothPictureDisabled=!1},Cg.prototype.handleDragging=function(e){var t=this._dragger.draggedX/(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),i=this._dragger.draggedY/(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),r=t,a=i;switch(this.frameSprite.texture.rotate){case 0:r=t,a=i;break;case 2:r=-i,a=t;break;case 4:r=-t,a=-i;break;case 6:r=i,a=-t;break;case 8:r=t,a=-i;break;case 10:r=i,a=t;break;case 12:r=-t,a=i;break;case 14:r=-i,a=-t}var n=this.frameSpriteOffsetFactorStartX-r/this.frameSprite.excessX,o=this.frameSpriteOffsetFactorStartY-a/this.frameSprite.excessY;this.frameSprite.offsetFactorX=this.frameSprite.excessX?n:this.frameSprite.offsetFactorX,this.frameSprite.offsetFactorY=this.frameSprite.excessY?o:this.frameSprite.offsetFactorY,this.frameSprite.updateDisplay()},Object.defineProperty(Cg.prototype,"texture",{get:function(){return this.frameSprite?this.frameSprite.texture:null}}),Object.defineProperty(Cg.prototype,"dragger",{get:function(){return this._dragger}}),Object.defineProperty(Cg.prototype,"scale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(Cg.prototype,"resizeScale",{get:function(){return this.frameSprite.textureScale}}),Object.defineProperty(Cg.prototype,"resizeScaleX",{get:function(){return this.frameSprite.textureScaleX}}),Object.defineProperty(Cg.prototype,"resizeScaleY",{get:function(){return this.frameSprite.textureScaleY}}),Object.defineProperty(Cg.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(Cg.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.PhotoGridChildContentImage=Cg,BFN.PhotoGridChildContentEvents={SELECT:new Event("EDGE_BAR_HOVERED"),DRAG:new Event("EDGE_BAR_PRESSED"),DELETE:new Event("INSERT_CHILD"),FORCE_ISOLATION_RELEASE:new Event("SELECT_CHILD"),IMAGE_UPDATED:new Event("DRAG_CHILD"),IMAGE_POSITION_UPDATED:new Event("DELETE_CHILD")},Bg.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Bg.prototype.init=function(){BeFunky.log("PhotoGridChildContent Init"),this.initDefaultValues(),this.initContentContainer(),this.initBackground(),this.initContentImage(),this.initHoverVeil(),this.initRoundedRectFilter(),this.initAnimators()},Bg.prototype.initDefaultValues=function(){this.strokeWidth=2,this._isEmpty=!0,this._scale=1,this._rounding=0,this._cleanDelete=!1,this._directSelect=!1,this._awaitingDrop=!1,this._highlightEnabled=!1,this._isolated=!1,this._imageEnabled=!0,this._itemWidth=100,this._itemHeight=100,this._backgroundColor="FFFFFF",this._borderColor="D6D6EE ",this.mouseMoved=!1,this.mouseOver=!1,this.pressed=!1},Bg.prototype.initContentContainer=function(){this.contentContainer=new PIXI.Container,this.addChild(this.contentContainer)},Bg.prototype.initBackground=function(){this.background=new PIXI.Graphics,this.background.beginFill(16777215,.5),this.background.drawRect(0,0,100,100),this.background.endFill(),this.contentContainer.addChild(this.background),this.backgroundColor=this._backgroundColor},Bg.prototype.initContentImage=function(){this.handleContentImageDraggingBind=this.handleContentImageDragging.bind(this),this.handleContentImageDraggingCompleteBind=this.handleContentImageDraggingComplete.bind(this),this._contentImage=new BFN.PhotoGridChildContentImage,this._contentImage.visible=!1,this._contentImage.dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleContentImageDraggingBind),this.contentContainer.addChild(this._contentImage)},Bg.prototype.initHoverVeil=function(){this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.handleMouseDownBind=this.handleMouseDown.bind(this),this.handleMouseMoveBind=this.handleMouseMove.bind(this),this.handleMouseUpBind=this.handleMouseUp.bind(this),this._hoverVeil=new PIXI.Graphics,this._hoverVeil.interactive=!0,this._hoverVeil.beginFill(16777215,.7),this._hoverVeil.drawRect(0,0,100,100),this._hoverVeil.endFill(),this._hoverVeil.on("pointerover",this.handleMouseOverBind),this._hoverVeil.on("pointerout",this.handleMouseOutBind),this._hoverVeil.on("pointerdown",this.handleMouseDownBind),this.contentContainer.addChild(this._hoverVeil)},Bg.prototype.initRoundedRectFilter=function(){this.roundedRectFilter=new BFN.filters.RoundedRectFilter,this.roundedRectFilter.autoFit=!1,this.roundedRectFilter.edgePadding=0,this.roundedRectFilter.strokeWidth=this.strokeWidth,this.roundedRectFilter.useTexture=1,this.roundedRectFilter.roundingDisabled=!0,this.borderColor=this._borderColor},Bg.prototype.initAnimators=function(){this.handleHoverAnimatorUpdateBind=this.handleHoverAnimatorUpdate.bind(this),this.handleFadeAnimatorUpdateBind=this.handleFadeAnimatorUpdate.bind(this),this.hoverAnimator=new BFN.Animator,this.hoverAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleHoverAnimatorUpdateBind),this.hoverAnimator.setAnimatorFactor(0),this.fadeAnimator=new BFN.Animator,this.fadeAnimator.linearSteps=12,this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdateBind),this.fadeAnimator.setAnimatorFactor(1)},Bg.prototype.setImage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e?(this.roundedRectFilter.strokeWidth=0,this.contentContainer.filters=[this.roundedRectFilter],this._isEmpty=!1,this.background.visible=!1,this._contentImage.visible=!0,this._contentImage.setBaseTexture(e.baseTexture,t,r),this.updateSize()):(this.roundedRectFilter.strokeWidth=this.strokeWidth,this.contentContainer.filters=[this.roundedRectFilter],this._isEmpty=!0,this.background.visible=!0,this._contentImage.visible=!1,this._contentImage.setBaseTexture(null)),i||this.dispatchEvent(BFN.PhotoGridChildContentEvents.IMAGE_UPDATED),BFN.MainUI.requestRender()},Bg.prototype.setSize=function(e,t){this._itemWidth=Math.max(0,e),this._itemHeight=Math.max(0,t),this.updateSize()},Bg.prototype.updateSize=function(){this._itemWidth<=1||this._itemHeight<=1?this.visible=!1:(this.visible=!0,this.background.width=this._hoverVeil.width=this._itemWidth,this.background.height=this._hoverVeil.height=this._itemHeight,this.updateRoundedRectFilter(),this._contentImage.setSize(this._itemWidth,this._itemHeight))},Bg.prototype.updateRoundedRectFilter=function(){this.roundedRectFilter.quality=this.roundedRectFilter.cornerRadius?.75:0,this.roundedRectFilter.cornerRadius=this._rounding*Math.min(this._itemWidth,this._itemHeight)/2,this.roundedRectFilter.spriteSize=[this._itemWidth,this._itemHeight],this.contentContainer.filters=[this.roundedRectFilter]},Bg.prototype.flashItem=function(){this.fadeAnimator.setAnimatorFactor(0),this.fadeAnimator.increase()},Bg.prototype.selectItem=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._directSelect=e,this.dispatchEvent(BFN.PhotoGridChildContentEvents.SELECT)},Bg.prototype.deleteItem=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isEmpty?(this._cleanDelete=e,this.dispatchEvent(BFN.PhotoGridChildContentEvents.DELETE)):this.setImage(null)},Bg.prototype.toggleBorder=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.roundedRectFilter.strokeWidth=e&&this._isEmpty?this.strokeWidth:this._isEmpty||!this._imageEnabled?t:0,this.contentContainer.filters=[this.roundedRectFilter]},Bg.prototype.destroy=function(){this.hoverAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleHoverAnimatorUpdateBind),this.hoverAnimator=null,this.fadeAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdateBind),this.fadeAnimator=null,this.filters=[],this.roundedRectFilter=null,this._hoverVeil.off("pointerover",this.handleMouseOverBind),this._hoverVeil.off("pointerout",this.handleMouseOutBind),this._hoverVeil.off("pointerdown",this.handleMouseDownBind),this.removeChild(this._hoverVeil),this._hoverVeil=null,this.contentContainer.removeChild(this._contentImage),this._contentImage.destroy(),this._contentImage=null,this.contentContainer.removeChild(this.background),this.background=null,this.contentContainer.mask=null,this.removeChild(this.contentContainer),this.contentContainer=null},Bg.prototype.handleContentImageDragging=function(e){this._isolated||this.mouseOver||(this._contentImage.revertImagePosition(),this._contentImage.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleContentImageDraggingCompleteBind),this._contentImage.dragger.stopDrag(),this.dispatchEvent(BFN.PhotoGridChildContentEvents.DRAG))},Bg.prototype.handleMouseOver=function(e){setTimeout(function(){this.mouseOver=!0,(!BFN.PhotoGrid.draggedChild||BFN.PhotoGrid.draggedChild&&BFN.PhotoGrid.draggedChild.content!=this)&&(this._awaitingDrop?this.hoverAnimator.increase():this._isEmpty||(BFN.CursorScreen.cursorLock||(BFN.CursorScreen.cursorRotation=0),BFN.CursorScreen.cursor="move"))}.bind(this),0)},Bg.prototype.handleMouseOut=function(e){this.mouseOver=!1,this._highlightEnabled||this.hoverAnimator.decrease(),this._contentImage.dragger.dragging||(BFN.CursorScreen.cursor=null)},Bg.prototype.handleMouseDown=function(e){this.mouseOver=!0,"touch"==e.data.pointerType&&BFN.PhotoGrid.startTouchDragHoverDetection();var t=e.data.originalEvent;this.rightClick=2===t.button,this.mouseDownPoint=BFN.MainUI.getPointerPosition(e),!this._isEmpty&&(t.ctrlKey||t.metaKey||t.altKey)||(BFN.ActiveDraggers.includes(this._contentImage.dragger)||this._isEmpty||BFN.ActiveDraggers.push(this._contentImage.dragger),this.mouseMoved=!1,this.pressed=!0,document.addEventListener(BeFunky.pointermove,this.handleMouseMoveBind),document.addEventListener(BeFunky.pointerup,this.handleMouseUpBind))},Bg.prototype.handleMouseMove=function(e){this.mouseMovePoint=BFN.MainUI.getPointerPosition(BFN.MainUI.pointerEvent);var t=this.mouseMovePoint.x-this.mouseDownPoint.x,i=this.mouseMovePoint.y-this.mouseDownPoint.y;Math.sqrt(Math.pow(t,2)+Math.pow(i,2))>5&&(this.mouseMoved=!0,this.handleMouseUpBind())},Bg.prototype.handleMouseUp=function(e){this.pressed=!1,document.removeEventListener(BeFunky.pointermove,this.handleMouseMoveBind),document.removeEventListener(BeFunky.pointerup,this.handleMouseUpBind),BFN.ActiveDraggers.includes(this._contentImage.dragger)&&BFN.ActiveDraggers.splice(BFN.ActiveDraggers.indexOf(this._contentImage.dragger),1),this.mouseMoved&&!this.rightClick?this._isEmpty||(this._contentImage.dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleContentImageDraggingCompleteBind),this._contentImage.drag()):BFN.PhotoGrid.gridChildIsolated||this.selectItem(!0)},Bg.prototype.handleContentImageDraggingComplete=function(e){this._contentImage.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleContentImageDraggingCompleteBind),BFN.PhotoGrid.gridChildIsolated||this.dispatchEvent(BFN.PhotoGridChildContentEvents.IMAGE_POSITION_UPDATED)},Bg.prototype.handleHoverAnimatorUpdate=function(e){this._hoverVeil.alpha=this.hoverAnimator.animationFactor},Bg.prototype.handleFadeAnimatorUpdate=function(e){this.alpha=this.fadeAnimator.animationFactor},Object.defineProperty(Bg.prototype,"isEmpty",{get:function(){return this._isEmpty}}),Object.defineProperty(Bg.prototype,"image",{get:function(){return this._contentImage}}),Object.defineProperty(Bg.prototype,"veil",{get:function(){return this._hoverVeil}}),Object.defineProperty(Bg.prototype,"backgroundColor",{set:function(e){this._backgroundColor=e,this.background.tint=parseInt("0x"+this._backgroundColor)},get:function(){return this._backgroundColor}}),Object.defineProperty(Bg.prototype,"borderColor",{set:function(e){this._borderColor=e,this.roundedRectFilter.strokeColor=parseInt("0xFF"+this._borderColor),this._hoverVeil.tint=parseInt("0x"+this._borderColor)},get:function(){return this._borderColor}}),Object.defineProperty(Bg.prototype,"rounding",{set:function(e){this._rounding=e,this.updateRoundedRectFilter()},get:function(){return this._rounding}}),Object.defineProperty(Bg.prototype,"cleanDelete",{get:function(){return this._cleanDelete}}),Object.defineProperty(Bg.prototype,"directSelect",{get:function(){return this._directSelect}}),Object.defineProperty(Bg.prototype,"awaitingDrop",{set:function(e){this._awaitingDrop=e,this._awaitingDrop||this.hoverAnimator.decrease()},get:function(){return this._awaitingDrop}}),Object.defineProperty(Bg.prototype,"highlightEnabled",{set:function(e){this._highlightEnabled=e,this._highlightEnabled?this.hoverAnimator.increase():this.hoverAnimator.decrease()},get:function(){return this._highlightEnabled}}),Object.defineProperty(Bg.prototype,"isolated",{set:function(e){this._isolated=e},get:function(){return this._isolated}}),Object.defineProperty(Bg.prototype,"imageEnabled",{set:function(e){this._imageEnabled=e,!this._imageEnabled||this._isEmpty?(this.contentContainer.filters=[this.roundedRectFilter],this.background.visible=!0,this._contentImage.visible=!1):(this.contentContainer.filters=[],this.background.visible=!1,this._contentImage.visible=!0)},get:function(){return this._imageEnabled}}),Object.defineProperty(Bg.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateSize()},get:function(){return this._itemWidth}}),Object.defineProperty(Bg.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateSize()},get:function(){return this._itemHeight}}),BFN.PhotoGridChildContent=Bg,Fg.prototype=Object.create(PIXI.Container.prototype),Fg.prototype.init=function(){BeFunky.log("PhotoGridChildEdgeBar Init"),this.initDefaultValues(),this.initContainer(),this.initShapes(),this.initAnimator(),this.updateDisplay()},Fg.prototype.initDefaultValues=function(){this.interactive=!0,this.showEdgeBar=!1,this.baseSize=50,this.color=13413119,this._id=null,this.cornerAWidth=this.baseSize,this.cornerBWidth=this.baseSize,this.blockWidth=this.baseSize,this._itemWidth=3*this.baseSize,this._itemHeight=this.baseSize,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.on("pointerover",this.handleMouseOverBind),this.on("pointerout",this.handleMouseOutBind)},Fg.prototype.initContainer=function(){switch(this.container=new PIXI.Container,this.container.alpha=0,this.addChild(this.container),this.side){case"left":this.container.rotation=-Math.PI/2;break;case"top":this.container.rotation=0;break;case"right":this.container.rotation=Math.PI/2;break;case"bottom":this.container.rotation=Math.PI}},Fg.prototype.initShapes=function(){this.cornerA=new PIXI.Graphics,this.cornerA.beginFill(this.color),this.cornerA.moveTo(0,0),this.cornerA.lineTo(0,this.baseSize),this.cornerA.lineTo(-this.baseSize,0),this.cornerA.lineTo(0,0),this.cornerA.endFill(),this.container.addChild(this.cornerA),this.cornerAPolygon=[new PIXI.Point(0,0),new PIXI.Point(0,this.baseSize),new PIXI.Point(-this.baseSize,0)],this.cornerATriangle=new BFN.Triangle,this.cornerB=new PIXI.Graphics,this.cornerB.beginFill(this.color),this.cornerB.moveTo(0,0),this.cornerB.lineTo(0,this.baseSize),this.cornerB.lineTo(this.baseSize,0),this.cornerB.lineTo(0,0),this.cornerB.endFill(),this.container.addChild(this.cornerB),this.cornerBPolygon=[new PIXI.Point(0,0),new PIXI.Point(0,this.baseSize),new PIXI.Point(this.baseSize,0)],this.cornerBTriangle=new BFN.Triangle,this.block=new PIXI.Graphics,this.block.beginFill(this.color),this.block.drawRect(-this.baseSize/2,0,this.baseSize,this.baseSize),this.block.endFill(),this.container.addChild(this.block),this.blockPolygon=[new PIXI.Point(-this.baseSize/2,0),new PIXI.Point(this.baseSize/2,0),new PIXI.Point(this.baseSize/2,this.baseSize),new PIXI.Point(-this.baseSize/2,this.baseSize)],this.blockRectangle=new BFN.Rectangle},Fg.prototype.initAnimator=function(){this.showEdgeBar&&(this.handleAnimatorUpdateBind=this.handleAnimatorUpdate.bind(this),this._animator=new BFN.Animator,this._animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdateBind),this._animator.setAnimatorFactor(0))},Fg.prototype.setSize=function(e,t,i,r){this.cornerAWidth=e,this.blockWidth=t,this.cornerBWidth=i,this._itemWidth=this.cornerAWidth+this.blockWidth+this.cornerBWidth,this._itemHeight=r,this.updateDisplay()},Fg.prototype.updateDisplay=function(){this.cornerA.x=-this.blockWidth/2,this.cornerA.width=this.cornerAWidth,this.cornerA.height=this._itemHeight,this.cornerB.x=this.blockWidth/2,this.cornerB.width=this.cornerBWidth,this.cornerB.height=this._itemHeight,this.block.width=this.blockWidth,this.block.height=this._itemHeight},Fg.prototype.destroy=function(){this.showEdgeBar&&(this._animator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdateBind),this._animator=null),this.container.removeChild(this.block),this.block=null,this.container.removeChild(this.cornerB),this.cornerB=null,this.container.removeChild(this.cornerA),this.cornerA=null,this.removeChild(this.container),this.container=null,this.off("pointerover",this.handleMouseOverBind),this.off("pointerout",this.handleMouseOutBind)},Fg.prototype.updateGlobalBounds=function(){this.cornerAPolygon.forEach((e,t)=>{var i=BFN.MainUI.toLocal(e,this.cornerA);this.cornerATriangle["x"+(t+1)]=i.x+BFN.MainUI.x+BFN.CSS.leftMenuBarWidth,this.cornerATriangle["y"+(t+1)]=i.y+BFN.MainUI.y+BFN.CSS.topMenuBarHeight}),this.cornerBPolygon.forEach((e,t)=>{var i=BFN.MainUI.toLocal(e,this.cornerB);this.cornerBTriangle["x"+(t+1)]=i.x+BFN.MainUI.x+BFN.CSS.leftMenuBarWidth,this.cornerBTriangle["y"+(t+1)]=i.y+BFN.MainUI.y+BFN.CSS.topMenuBarHeight}),this.blockRectangle=null,this.blockPolygon.forEach(e=>{var t=BFN.MainUI.toLocal(e,this.block);this.blockRectangle?(this.blockRectangle.left=Math.min(this.blockRectangle.left,t.x),this.blockRectangle.right=Math.max(this.blockRectangle.right,t.x),this.blockRectangle.top=Math.min(this.blockRectangle.top,t.y),this.blockRectangle.bottom=Math.max(this.blockRectangle.bottom,t.y)):this.blockRectangle=new BFN.Rectangle(t.x,t.y)}),this.blockRectangle?(this.blockRectangle.x+=BFN.MainUI.x+BFN.CSS.leftMenuBarWidth,this.blockRectangle.y+=BFN.MainUI.y+BFN.CSS.topMenuBarHeight):this.blockRectangle=new BFN.Rectangle},Fg.prototype.containsGlobalPoint=function(e,t){return this.cornerATriangle.contains(e,t)||this.cornerBTriangle.contains(e,t)||this.blockRectangle.contains(e,t)},Fg.prototype.handleMouseOver=function(e){this.showEdgeBar&&this._animator.increase()},Fg.prototype.handleMouseOut=function(e){this.showEdgeBar&&this._animator.decrease()},Fg.prototype.handleAnimatorUpdate=function(e){this.container.alpha=.8*this._animator.animationFactor+.2},Object.defineProperty(Fg.prototype,"id",{set:function(e){this._id=e},get:function(){return this._id}}),Object.defineProperty(Fg.prototype,"animator",{get:function(){return this._animator}}),Object.defineProperty(Fg.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(Fg.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.PhotoGridChildEdgeBar=Fg,BFN.PhotoGridChildEvents={EDGE_BAR_HOVERED:new Event("EDGE_BAR_HOVERED"),EDGE_BAR_PRESSED:new Event("EDGE_BAR_PRESSED"),INSERT_CHILD:new Event("INSERT_CHILD"),SELECT_CHILD:new Event("SELECT_CHILD"),DRAG_CHILD:new Event("DRAG_CHILD"),DELETE_CHILD:new Event("DELETE_CHILD"),CHILD_IMAGE_UPDATED:new Event("CHILD_IMAGE_UPDATED"),CHILD_IMAGE_POSITION_UPDATED:new Event("CHILD_IMAGE_POSITION_UPDATED"),TRANSITION_COMPLETE:new Event("TRANSITION_COMPLETE")},Eg.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Eg.prototype.init=function(){BeFunky.log("PhotoGridChild Init"),this.initDefaultValues(),this.initBackground(),this.initChildContent(),this.initEdgeBars(),this.initTransitionAnimator()},Eg.prototype.initDefaultValues=function(){this.interactive=!0,this._destroyed=!1,this._id=null,this._gap=0,this._rounding=0,this._scale=1,this._hoveredEdge=null,this._rect=new BFN.Rectangle,this._factorRect=new BFN.Rectangle,this._attemptUngrouping=!1,this._attemptSeparation=!1,this._itemWidth=100,this._itemHeight=100,this._transitionRect=new BFN.Rectangle,this._awaitingDrop=!1,this.globalRect=new BFN.Rectangle,this._menuImageVO=null,this.projectItemVO=new BFN.ProjectItemVO,this.projectItemVO.type="grid_cell",this.handleKeyDownBind=this.handleKeyDown.bind(this),this.handleKeyUpBind=this.handleKeyUp.bind(this)},Eg.prototype.initBackground=function(){this.background=new PIXI.Graphics},Eg.prototype.initChildContent=function(){this.childContentContainer=new PIXI.Container,this.addChild(this.childContentContainer),this.gridChildContentEventHandlers=[{event:BFN.PhotoGridChildContentEvents.SELECT,handler:this.handleChildContentSelect.bind(this)},{event:BFN.PhotoGridChildContentEvents.DRAG,handler:this.handleChildContentDrag.bind(this)},{event:BFN.PhotoGridChildContentEvents.DELETE,handler:this.handleChildContentDelete.bind(this)},{event:BFN.PhotoGridChildContentEvents.IMAGE_UPDATED,handler:this.handleChildContentImageUpdated.bind(this)},{event:BFN.PhotoGridChildContentEvents.IMAGE_POSITION_UPDATED,handler:this.handleChildContentImagePositionUpdated.bind(this)}],this.childContent=new BFN.PhotoGridChildContent;for(var e=0;e<this.gridChildContentEventHandlers.length;e++)this.childContent.addEventListener(this.gridChildContentEventHandlers[e].event.type,this.gridChildContentEventHandlers[e].handler);this.childContentContainer.addChild(this.childContent)},Eg.prototype.initEdgeBars=function(){this.edgeBarData=["left","top","right","bottom"],this.edgeBars={},this.edgeBarContainer=new PIXI.Container,this.addChild(this.edgeBarContainer),this.handleEdgeBarOverBind=this.handleEdgeBarOver.bind(this),this.handleEdgeBarOutBind=this.handleEdgeBarOut.bind(this),this.handleEdgeBarPressedBind=this.handleEdgeBarPressed.bind(this);for(var e=0;e<this.edgeBarData.length;e++){var t=new BFN.PhotoGridChildEdgeBar(this.edgeBarData[e],this);t.id=this.edgeBarData[e],t.on("pointerover",this.handleEdgeBarOverBind),t.on("pointerout",this.handleEdgeBarOutBind),t.on("pointerdown",this.handleEdgeBarPressedBind),this.edgeBarContainer.addChild(t),this.edgeBars[t.id]=t}},Eg.prototype.initTransitionAnimator=function(){this.handleTransitionAnimatorUpdateBind=this.handleTransitionAnimatorUpdate.bind(this),this.handleTransitionAnimatorUpdateCompleteBind=this.handleTransitionAnimatorUpdateComplete.bind(this),this.transitionAnimator=new BFN.Animator,this.transitionAnimator.linearSteps=16,this.transitionAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleTransitionAnimatorUpdateBind),this.transitionAnimator.addEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleTransitionAnimatorUpdateCompleteBind)},Eg.prototype.setSize=function(e,t){this._itemWidth=Math.max(0,e),this._itemHeight=Math.max(0,t),this.updateSize()},Eg.prototype.makeTransition=function(){this.updateRect(),BFN.smoothPictureDisabled=!0,this.transitionAnimator.setAnimatorFactor(0),this.transitionAnimator.increase()},Eg.prototype.updateSize=function(){if(!this.destroyed)if(this._itemWidth<=1||this._itemHeight<=1)this.visible=!1;else{this.visible=!0,this.drawBackground(),this.childContent.isolated||(this.childContent.x=this._gap/2,this.childContent.y=this._gap/2,this.childContent.setSize(Math.max(0,this._itemWidth-this._gap),Math.max(0,this._itemHeight-this._gap)));var e=6/this._scale,t=new BFN.Rectangle(Math.max(e,this.childContent.x),Math.max(e,this.childContent.y),Math.min(this._itemWidth-2*e,this.childContent.itemWidth),Math.min(this._itemHeight-2*e,this.childContent.itemHeight));for(var i in this.edgeBars){var r=this.edgeBars[i];switch(i){case"top":r.x=t.x+t.width/2,r.y=0,r.setSize(t.x,t.width,this._itemWidth-t.x-t.width,t.y);break;case"bottom":r.x=t.x+t.width/2,r.y=this._itemHeight,r.setSize(this._itemWidth-t.x-t.width,t.width,t.x,this._itemHeight-t.y-t.height);break;case"left":r.x=0,r.y=t.y+t.height/2,r.setSize(this._itemHeight-t.y-t.height,t.height,t.y,t.x);break;case"right":r.x=this._itemWidth,r.y=t.y+t.height/2,r.setSize(t.y,t.height,this._itemHeight-t.y-t.height,this._itemWidth-t.x-t.width)}}}},Eg.prototype.drawBackground=function(){},Eg.prototype.updateRounding=function(){this.drawBackground(),this.childContent.rounding=this._rounding},Eg.prototype.handleDrop=function(){this._hoveredEdge?this.dispatchEvent(BFN.PhotoGridChildEvents.INSERT_CHILD):this.childContent&&this.childContent.selectItem()},Eg.prototype.updateProjectItemVO=function(){this.projectItemVO.gridCellImageID=this._menuImageVO?this._menuImageVO.id:null,this.projectItemVO.gridCellRect=this._rect.rectangleObject,this.projectItemVO.gridCellTextureOffsetFactorX=this.content.image.frameSprite.offsetFactorX,this.projectItemVO.gridCellTextureOffsetFactorY=this.content.image.frameSprite.offsetFactorY,this.projectItemVO.gridCellTextureRotate=this.content.image.frameSprite.rotate,this.projectItemVO.gridCellTextureScale=this.content.image.frameSprite.textureScale},Eg.prototype.destroy=function(){if(!this._destroyed){for(var e in this._destroyed=!0,this.transitionAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleTransitionAnimatorUpdateBind),this.transitionAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleTransitionAnimatorUpdateCompleteBind),this.edgeBars){var t=this.edgeBars[e];t.off("pointerover",this.handleEdgeBarOverBind),t.off("pointerout",this.handleEdgeBarOutBind),t.off("pointerdown",this.handleEdgeBarPressedBind),this.edgeBarContainer.removeChild(t),t.destroy(),this.edgeBars[e]=null,delete this.edgeBars[e]}this.edgeBars=null,this.removeChild(this.edgeBarContainer),this.edgeBarContainer=null,this.childContent.isolated&&this.childContent.dispatchEvent(BFN.PhotoGridChildContentEvents.FORCE_ISOLATION_RELEASE),this.childContentContainer.removeChild(this.childContent);for(var i=0;i<this.gridChildContentEventHandlers.length;i++)this.childContent.removeEventListener(this.gridChildContentEventHandlers[i].event.type,this.gridChildContentEventHandlers[i].handler);this.childContent.destroy(),this.childContent=null,this.removeChild(this.childContentContainer),this.childContentContainer=null,this.removeChild(this.background),this.background=null,this._menuImageVO=null,this.projectItemVO=null}},Eg.prototype.updateRect=function(){this._rect.left=Math.round(this.x),this._rect.right=Math.round(this.x+this._itemWidth),this._rect.top=Math.round(this.y),this._rect.bottom=Math.round(this.y+this._itemHeight)},Eg.prototype.updateGlobalBounds=function(){var e=[new PIXI.Point(0,0),new PIXI.Point(this._itemWidth,0),new PIXI.Point(this._itemWidth,this._itemHeight),new PIXI.Point(0,this._itemHeight)];for(var t in this.globalRect=null,e.forEach(e=>{var t=BFN.MainUI.toLocal(e,this);this.globalRect?(this.globalRect.left=Math.min(this.globalRect.left,t.x),this.globalRect.right=Math.max(this.globalRect.right,t.x),this.globalRect.top=Math.min(this.globalRect.top,t.y),this.globalRect.bottom=Math.max(this.globalRect.bottom,t.y)):this.globalRect=new BFN.Rectangle(t.x,t.y)}),this.globalRect?(this.globalRect.x+=BFN.MainUI.x+BFN.CSS.leftMenuBarWidth,this.globalRect.y+=BFN.MainUI.y+BFN.CSS.topMenuBarHeight):this.globalRect=new BFN.Rectangle,this.edgeBars){this.edgeBars[t].updateGlobalBounds()}},Eg.prototype.handleChildContentSelect=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.SELECT_CHILD)},Eg.prototype.handleChildContentDrag=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.DRAG_CHILD)},Eg.prototype.handleChildContentDelete=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.DELETE_CHILD)},Eg.prototype.handleChildContentImageUpdated=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.CHILD_IMAGE_UPDATED)},Eg.prototype.handleChildContentImagePositionUpdated=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.CHILD_IMAGE_POSITION_UPDATED)},Eg.prototype.handleEdgeBarOver=function(e){if(!BeFunky.isPointerDown||BeFunky.isPointerDown&&this._awaitingDrop){var t=e.currentTarget,i=e.data.originalEvent.shiftKey,r=e.data.originalEvent.ctrlKey||e.data.originalEvent.metaKey;this._hoveredEdge=t.id,this._attemptUngrouping=i,this._attemptSeparation=r||this._awaitingDrop,document.addEventListener("keydown",this.handleKeyDownBind),document.addEventListener("keyup",this.handleKeyUpBind),setTimeout(function(){this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)}.bind(this),0)}},Eg.prototype.handleEdgeBarOut=function(e){this._hoveredEdge=null,this._attemptUngrouping=!1,this._attemptSeparation=!1,document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)},Eg.prototype.handleEdgeBarPressed=function(e){var t=e.currentTarget,i=e.data.originalEvent.shiftKey,r=e.data.originalEvent.ctrlKey||e.data.originalEvent.metaKey,a=e.data.originalEvent.altKey;r&&a?(t.showEdgeBar&&t.animator.setAnimatorFactor(0),this.dispatchEvent(BFN.PhotoGridChildEvents.INSERT_CHILD)):("touch"==e.data.pointerType&&(this._hoveredEdge=t.id,this._attemptUngrouping=i,this._attemptSeparation=r,this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)),this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_PRESSED))},Eg.prototype.handleKeyDown=function(e){e.shiftKey&&(this._attemptUngrouping=!0),(e.metaKey||e.ctrlKey)&&(this._attemptSeparation=!0),(e.metaKey||e.ctrlKey||e.shiftKey)&&this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)},Eg.prototype.handleKeyUp=function(e){16==e.keyCode&&(this._attemptUngrouping=!1),17!=e.keyCode&&91!=e.keyCode&&93!=e.keyCode||(this._attemptSeparation=!1),16!=e.keyCode&&17!=e.keyCode&&91!=e.keyCode&&93!=e.keyCode||this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)},Eg.prototype.handleTransitionAnimatorUpdate=function(e){this.x=(this._transitionRect.x-this._rect.x)*this.transitionAnimator.animationSinFactor+this._rect.x,this.y=(this._transitionRect.y-this._rect.y)*this.transitionAnimator.animationSinFactor+this._rect.y,this.setSize((this._transitionRect.width-this._rect.width)*this.transitionAnimator.animationSinFactor+this._rect.width,(this._transitionRect.height-this._rect.height)*this.transitionAnimator.animationSinFactor+this._rect.height)},Eg.prototype.handleTransitionAnimatorUpdateComplete=function(e){this.updateRect(),BFN.smoothPictureDisabled=!1,this.dispatchEvent(BFN.PhotoGridChildEvents.TRANSITION_COMPLETE)},Object.defineProperty(Eg.prototype,"destroyed",{get:function(){return this._destroyed}}),Object.defineProperty(Eg.prototype,"id",{set:function(e){this._id=e},get:function(){return this._id}}),Object.defineProperty(Eg.prototype,"contentContainer",{get:function(){return this.childContentContainer}}),Object.defineProperty(Eg.prototype,"content",{get:function(){return this.childContent}}),Object.defineProperty(Eg.prototype,"backgroundColor",{set:function(e){this.childContent.backgroundColor=e},get:function(){return this.childContent.backgroundColor}}),Object.defineProperty(Eg.prototype,"borderColor",{set:function(e){this.childContent.borderColor=e},get:function(){return this.childContent.borderColor}}),Object.defineProperty(Eg.prototype,"gap",{set:function(e){this._gap=e,this.updateSize()},get:function(){return this._gap}}),Object.defineProperty(Eg.prototype,"rounding",{set:function(e){this._rounding=e,this.updateRounding()},get:function(){return this._rounding}}),Object.defineProperty(Eg.prototype,"scale",{set:function(e){this._scale=e,this.childContent.image.scale=this._scale,this.updateSize()},get:function(){return this._scale}}),Object.defineProperty(Eg.prototype,"hoveredEdge",{get:function(){return this._hoveredEdge}}),Object.defineProperty(Eg.prototype,"hoveredEdgeLocked",{get:function(){return"left"==this._hoveredEdge&&0==this._factorRect.left||"top"==this._hoveredEdge&&0==this._factorRect.top||"right"==this._hoveredEdge&&1==this._factorRect.right||"bottom"==this._hoveredEdge&&1==this._factorRect.bottom}}),Object.defineProperty(Eg.prototype,"rect",{get:function(){return this._rect}}),Object.defineProperty(Eg.prototype,"factorRect",{get:function(){return this._factorRect}}),Object.defineProperty(Eg.prototype,"attemptUngrouping",{get:function(){return this._attemptUngrouping}}),Object.defineProperty(Eg.prototype,"attemptSeparation",{get:function(){return this._attemptSeparation}}),Object.defineProperty(Eg.prototype,"dragPosition",{set:function(e){this._dragPosition=e},get:function(){return this._dragPosition}}),Object.defineProperty(Eg.prototype,"transitionRect",{get:function(){return this._transitionRect}}),Object.defineProperty(Eg.prototype,"awaitingDrop",{set:function(e){this._awaitingDrop=this.childContent.awaitingDrop=e},get:function(){return this._awaitingDrop}}),Object.defineProperty(Eg.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateSize()},get:function(){return this._itemWidth}}),Object.defineProperty(Eg.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateSize()},get:function(){return this._itemHeight}}),Object.defineProperty(Eg.prototype,"menuImageVO",{set:function(e){this._menuImageVO=e,this.updateProjectItemVO()},get:function(){return this._menuImageVO}}),BFN.PhotoGridChild=Eg,Pg.prototype=Object.create(PIXI.Container.prototype),Pg.prototype.init=function(){BeFunky.log("PhotoGridIsolator Init"),this.initDefaultValues(),this.initVeil(),this.initContentContainer(),this.initAnimator()},Pg.prototype.initDefaultValues=function(){this.visible=!1,this._padding=0,this._itemWidth=0,this._itemHeight=0,this.originalPosition=new PIXI.Point,this.hovered=!1,this.dragging=!1,this.gridChild=null,this.handleMainUIMouseDownBind=this.handleMainUIMouseDown.bind(this),this.handleForceIsolationReleaseBind=this.handleForceIsolationRelease.bind(this)},Pg.prototype.initVeil=function(){this.veil=new PIXI.Graphics,this.veil.interactive=!0,this.veil.beginFill(1909805,.7),this.veil.drawRect(0,0,100,100),this.veil.endFill(),this.addChild(this.veil)},Pg.prototype.initContentContainer=function(){this.contentContainer=new PIXI.Container,this.addChild(this.contentContainer)},Pg.prototype.initAnimator=function(){this.handleAnimatorUpdateBind=this.handleAnimatorUpdate.bind(this),this.handleAnimatorDecreaseCompleteBind=this.handleAnimatorDecreaseComplete.bind(this),this.animator=new BFN.Animator,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdateBind),this.animator.addEventListener(BFN.AnimatorEvents.DECREASE_COMPLETE.type,this.handleAnimatorDecreaseCompleteBind),this.animator.setAnimatorFactor(0)},Pg.prototype.captureGridChild=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&!this.gridChild&&(this.gridChild=e,this.gridChild.content.isolated=!0,this.originalPosition.x=this.gridChild.content.x,this.originalPosition.y=this.gridChild.content.y,this.gridChild.content.addEventListener(BFN.PhotoGridChildContentEvents.FORCE_ISOLATION_RELEASE.type,this.handleForceIsolationReleaseBind),this.gridChild.content.x=this.gridChild.x+this.gridChild.content.x,this.gridChild.content.y=this.gridChild.y+this.gridChild.content.y,this.contentContainer.addChild(this.gridChild.content),this.frameSprite=this.gridChild.content.image.frameSprite,this.initialOffsetFactorX=this.frameSprite.offsetFactorX,this.initialOffsetFactorY=this.frameSprite.offsetFactorY,this.initialScale=this.frameSprite.textureScale,this.initialRotate=this.frameSprite.texture.rotate,BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIMouseDownBind),this.visible=!0,t?(this.animator.setAnimatorFactor(1),this.animator.dispatchEvent(BFN.AnimatorEvents.INCREASE_COMPLETE)):this.animator.increase(),document.querySelectorAll(".draggable-panel").addClass("disabled"))},Pg.prototype.releaseGridChild=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];BFN.MainUI.removeEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIMouseDownBind),e?(this.animator.setAnimatorFactor(0),this.animator.dispatchEvent(BFN.AnimatorEvents.DECREASE_COMPLETE)):this.animator.decrease()},Pg.prototype.updateDisplay=function(){this.veil.x=-this._padding,this.veil.y=-this._padding,this.veil.width=this._itemWidth+2*this._padding,this.veil.height=this._itemHeight+2*this._padding},Pg.prototype.revertChanges=function(){this.gridChild&&this.frameSprite&&(this.frameSprite.offsetFactorX=this.initialOffsetFactorX,this.frameSprite.offsetFactorY=this.initialOffsetFactorY,this.frameSprite.textureScale=this.initialScale,this.frameSprite.texture.rotate=this.initialRotate,this.frameSprite.updateDisplay(),this.gridChild.content.image.updateSmoothing())},Pg.prototype.handleMainUIMouseDown=function(e){this.gridChild&&!this.gridChild.content.pressed&&BFN.PhotoGrid.isolateGridChild(null)},Pg.prototype.handleForceIsolationRelease=function(e){this.animator.setAnimatorFactor(0),this.handleAnimatorDecreaseCompleteBind(null)},Pg.prototype.handleAnimatorUpdate=function(e){this.veil.alpha=this.animator.animationFactor},Pg.prototype.handleAnimatorDecreaseComplete=function(e){this.gridChild&&(this.gridChild.content.isolated=!1,this.gridChild.content.removeEventListener(BFN.PhotoGridChildContentEvents.FORCE_ISOLATION_RELEASE.type,this.handleForceIsolationReleaseBind),this.gridChild.content.x=this.originalPosition.x,this.gridChild.content.y=this.originalPosition.y,this.gridChild.contentContainer.addChild(this.gridChild.content),e&&(this.initialOffsetFactorX==this.frameSprite.offsetFactorX&&this.initialOffsetFactorY==this.frameSprite.offsetFactorY&&this.initialScale==this.frameSprite.textureScale&&this.initialRotate==this.frameSprite.texture.rotate||this.gridChild.content.dispatchEvent(BFN.PhotoGridChildContentEvents.IMAGE_UPDATED)),this.gridChild=null,this.frameSprite=null),this.visible=!1,document.querySelectorAll(".draggable-panel").removeClass("disabled"),BFN.HiResTextManager.updateHighResText()},Object.defineProperty(Pg.prototype,"padding",{set:function(e){this._padding=e,this.updateDisplay()},get:function(){return this._padding}}),Object.defineProperty(Pg.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateDisplay()},get:function(){return this._itemWidth}}),Object.defineProperty(Pg.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateDisplay()},get:function(){return this._itemHeight}}),BFN.PhotoGridIsolator=Pg,Ng.prototype=Object.create(PIXI.Container.prototype),Ng.prototype.init=function(){BeFunky.log("PhotoGridDragBar Init"),this.initDefaultValues(),this.initBlock(),this.initIndicator(),this.initAnimator()},Ng.prototype.initDefaultValues=function(){this.baseSize=2,this._direction="horizontal",this._length=this.baseSize,this._scale=1,this._indicatorSide=null},Ng.prototype.initBlock=function(){this.blockContainer=new PIXI.Container,this.addChild(this.blockContainer),this.block=new PIXI.Graphics,this.block.beginFill(0),this.block.drawRect(-this.baseSize/2,-this.baseSize/2,this.baseSize,this.baseSize),this.block.endFill(),this.blockContainer.addChild(this.block),this.block.dashedLineFilter=new BFN.filters.DashedLineFilter,this.block.dashedLineFilter.dashSize=10,this.block.filters=[this.block.dashedLineFilter]},Ng.prototype.initIndicator=function(){this.indicatorContainer=new PIXI.Container,this.addChild(this.indicatorContainer),this.indicator=new PIXI.Graphics,this.indicator.beginFill(0),this.indicator.drawRect(-this.baseSize/2,-this.baseSize/2,this.baseSize,this.baseSize),this.indicator.endFill(),this.indicatorContainer.addChild(this.indicator),this.indicator.dashedLineFilter=new BFN.filters.DashedLineFilter,this.indicator.dashedLineFilter.dashSize=10,this.indicator.filters=[this.indicator.dashedLineFilter]},Ng.prototype.initAnimator=function(){this.handleAnimatorUpdateBind=this.handleAnimatorUpdate.bind(this),this._animator=new BFN.Animator,this._animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdateBind),this._animator.setAnimatorFactor(0)},Ng.prototype.show=function(){this._animator.increase()},Ng.prototype.hide=function(){this._animator.decrease()},Ng.prototype.updateDisplay=function(){this.block.width="horizontal"==this._direction?this._length:this.baseSize,this.block.height="vertical"==this._direction?this._length:this.baseSize,this.indicator.width="horizontal"==this._direction?.96*this._length:this.baseSize,this.indicator.height="vertical"==this._direction?.96*this._length:this.baseSize,this.updateScale()},Ng.prototype.updateScale=function(){if(this.blockContainer.scale.x=this.indicatorContainer.scale.x="vertical"==this._direction?1/this._scale:1,this.blockContainer.scale.y=this.indicatorContainer.scale.y="horizontal"==this._direction?1/this._scale:1,this.indicatorContainer.x=0,this.indicatorContainer.y=0,this._indicatorSide)switch(this.indicator.visible=!0,this._indicatorSide){case"left":this.indicatorContainer.x=4*this.baseSize/this._scale;break;case"top":this.indicatorContainer.y=4*this.baseSize/this._scale;break;case"right":this.indicatorContainer.x=-4*this.baseSize/this._scale;break;case"bottom":this.indicatorContainer.y=-4*this.baseSize/this._scale}else this.indicator.visible=!1},Ng.prototype.handleAnimatorUpdate=function(e){this.blockContainer.alpha=.8*this._animator.animationFactor+.2,this.visible=this._animator.animationFactor>0},Object.defineProperty(Ng.prototype,"animator",{get:function(){return this._animator}}),Object.defineProperty(Ng.prototype,"direction",{set:function(e){this._direction=e,this.updateDisplay()},get:function(){return this._direction}}),Object.defineProperty(Ng.prototype,"length",{set:function(e){this._length=e,this.updateDisplay()},get:function(){return this._length}}),Object.defineProperty(Ng.prototype,"scale",{set:function(e){this._scale=e,this.updateScale()},get:function(){return this._scale}}),Object.defineProperty(Ng.prototype,"indicatorSide",{set:function(e){this._indicatorSide=e,this.updateDisplay()},get:function(){return this._indicatorSide}}),BFN.PhotoGridDragBar=Ng,Mg.prototype=Object.create(PIXI.Container.prototype),Mg.prototype.init=function(){BeFunky.log("PhotoGridEdgeIndicator Init"),this.initDefaultValues(),this.initDisplay(),this.initDashedFilter()},Mg.prototype.initDefaultValues=function(){this.visible=!1,this._direction="horizontal",this._length=100,this._offset=0,this._scale=1},Mg.prototype.initDisplay=function(){this.holder=new PIXI.Container,this.addChild(this.holder),this.outerIndicator=new PIXI.Graphics,this.holder.addChild(this.outerIndicator),this.innerIndicator=new PIXI.Graphics,this.innerIndicator.visible=!1,this.holder.addChild(this.innerIndicator)},Mg.prototype.initDashedFilter=function(){this.dashedLineFilter=new BFN.filters.DashedLineFilter,this.dashedLineFilter.dashSize=10,this.filters=[this.dashedLineFilter]},Mg.prototype.drawIndicators=function(){switch(this.outerIndicator.clear(),this.innerIndicator.clear(),this.holder.scale.x=this.holder.scale.y=1,this.outerIndicator.beginFill(0),this.innerIndicator.beginFill(8421504),this._direction){case"horizontal":this.outerIndicator.drawRect(-50,-1,100,2),this.innerIndicator.drawRect(-50,-1,100,2);break;case"vertical":this.outerIndicator.drawRect(-1,-50,2,100),this.innerIndicator.drawRect(-1,-50,2,100)}this.updateLength(),this.updateOffset(),this.updateScale()},Mg.prototype.updateLength=function(){switch(this._direction){case"horizontal":this.holder.scale.x=(this._length-4*Math.abs(this._offset/this._scale))/100,this.holder.scale.y=1/this._scale;break;case"vertical":this.holder.scale.x=1/this._scale,this.holder.scale.y=(this._length-4*Math.abs(this._offset/this._scale))/100}},Mg.prototype.updateOffset=function(){switch(this.holder.x=this.holder.y=0,this._direction){case"horizontal":this.holder.y=this._offset/this._scale;break;case"vertical":this.holder.x=this._offset/this._scale}this.updateLength()},Mg.prototype.updateScale=function(){this.updateLength()},Object.defineProperty(Mg.prototype,"direction",{set:function(e){"horizontal"!=e&&"vertical"!=e||(this._direction=e,this.drawIndicators())},get:function(){return this._direction}}),Object.defineProperty(Mg.prototype,"length",{set:function(e){this._length=e,this.updateLength()},get:function(){return this._length}}),Object.defineProperty(Mg.prototype,"offset",{set:function(e){this._offset=e,this.updateOffset()},get:function(){return this._length}}),Object.defineProperty(Mg.prototype,"scale",{set:function(e){this._scale=e,this.updateOffset(),this.updateScale()},get:function(){return this._scale}}),Object.defineProperty(Mg.prototype,"showing",{set:function(e){this.visible=e},get:function(){return this.visible}}),Object.defineProperty(Mg.prototype,"selected",{set:function(e){this.outerIndicator=!e,this.innerIndicator.visible=e},get:function(){return this.innerIndicator.visible}}),BFN.PhotoGridEdgeIndicator=Mg,BFN.PhotoGridEvents={PHOTO_GRID_SNAP_SHOT:new Event("PHOTO_GRID_SNAP_SHOT")},Dg.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Dg.prototype.init=function(){BeFunky.log("PhotoGrid Init"),this.initDefaultValues(),this.initGridContainer(),this.initChildContainer(),this.initDragBar(),this.initEdgeIndicators(),this.initMenu(),this.initGridIsolator(),this.initDragger(),this.setSize(0,0)},Dg.prototype.initDefaultValues=function(){this.minSize=2*BFN.minImageSize,this.snapDistance=5,this.maxGap=0,this.maxGapFactor=.1,this._gridChildIsolated=!1,this._scale=1,this._backgroundColor="FFFFFF",this._gap=0,this._rounding=0,this.childBackgroundColor="000000",this.childBorderColor="000000",this._gridChildren=[],this._focusedChild=null,this._targetChild=null,this._selectedChild=null,this._draggedChild=null,this._awaitingDrop=!1,this._matchesTemplate=!1,this.includedChildren=[],this.excludedChildren=[],this.attachedChildren=[],this.transitionChildren=[],this.positions=[],this.intersectRect=new BFN.Rectangle,this.snapCoords=[],this.separationAchieved=!1,this.dragBarPosition=0,this._insertedGridChild=null,this.handleChildMouseOverBind=this.handleChildMouseOver.bind(this),this.handleChildMouseOutBind=this.handleChildMouseOut.bind(this),this.gridChildEventHandlers=[{event:BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED,handler:this.handleEdgeBarHovered.bind(this)},{event:BFN.PhotoGridChildEvents.EDGE_BAR_PRESSED,handler:this.handleEdgeBarPressed.bind(this)},{event:BFN.PhotoGridChildEvents.INSERT_CHILD,handler:this.handleInsertChild.bind(this)},{event:BFN.PhotoGridChildEvents.SELECT_CHILD,handler:this.handleSelectChild.bind(this)},{event:BFN.PhotoGridChildEvents.DRAG_CHILD,handler:this.handleDragChild.bind(this)},{event:BFN.PhotoGridChildEvents.DELETE_CHILD,handler:this.handleDeleteChild.bind(this)},{event:BFN.PhotoGridChildEvents.CHILD_IMAGE_UPDATED,handler:this.handleChildImageUpdated.bind(this)},{event:BFN.PhotoGridChildEvents.CHILD_IMAGE_POSITION_UPDATED,handler:this.handleChildImagePositionUpdated.bind(this)},{event:BFN.PhotoGridChildEvents.TRANSITION_COMPLETE,handler:this.handleChildTransitionComplete.bind(this)}],this.handleEdgeBarReleasedBind=this.handleEdgeBarReleased.bind(this),this.handleDropChildBind=this.handleDropChild.bind(this),this.detectingTouchDragHovers=!1,this.detectHoversManuallyBind=this.detectHoversManually.bind(this),this.stopTouchDragHoverDetectionBind=this.stopTouchDragHoverDetection.bind(this)},Dg.prototype.initGridContainer=function(){this.gridContainer=new PIXI.Container,this.addChild(this.gridContainer)},Dg.prototype.initChildContainer=function(){this.childContainer=new PIXI.Container,this.gridContainer.addChild(this.childContainer)},Dg.prototype.initDragBar=function(){this.dragBar=new BFN.PhotoGridDragBar,this.gridContainer.addChild(this.dragBar)},Dg.prototype.initEdgeIndicators=function(){this.edgeIndicatorData=[{id:"left",direction:"vertical",offset:5},{id:"top",direction:"horizontal",offset:5},{id:"right",direction:"vertical",offset:-5},{id:"bottom",direction:"horizontal",offset:-5}],this.edgeIndicators={},this.edgeIndicatorContainer=new PIXI.Container,this.addChild(this.edgeIndicatorContainer);for(var e=0;e<this.edgeIndicatorData.length;e++){var t=this.edgeIndicatorData[e],i=new BFN.PhotoGridEdgeIndicator;i.direction=t.direction,i.offset=t.offset,this.edgeIndicators[t.id]=i,this.edgeIndicatorContainer.addChild(i)}},Dg.prototype.initMenu=function(){this.contextMenu=document.getElementById("context_menu_collage"),BeFunky.contextMenu(this.contextMenu,{add_image:{onClick:this.handleAddImage.bind(this)},edit_image:{onClick:this.handleEditImage.bind(this)},remove_image:{onClick:this.handleRemoveImage.bind(this)},delete_cell:{onClick:this.handleDeleteCell.bind(this)}}),this.contextMenu.target=document.querySelector("#appStage canvas"),this.contextMenu.enabled=!1,this.contextMenu.addEventListener("SHOW",()=>{this.contextMenu.enabled=!1})},Dg.prototype.initGridIsolator=function(){this.gridIsolator=new BFN.PhotoGridIsolator,this.addChild(this.gridIsolator)},Dg.prototype.initDragger=function(){this.dragger=new BFN.Dragger,this.dragger.autoDrag=!1,this.dragger.stickyDrag=!1,this.dragger.preventSelectionDrag=!0,this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleDragging.bind(this)),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this))},Dg.prototype.setSize=function(e,t){this._itemWidth=e,this._itemHeight=t,this.hitArea=new PIXI.Rectangle(0,0,e,t),this.updateDisplay(),this.updateGaps(),this._matchesTemplate&&(this._matchesTemplate=!1)},Dg.prototype.showEdgeIndicators=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.edgeIndicators.left.showing=e>0,this.edgeIndicators.left.selected=e>1,this.edgeIndicators.top.showing=t>0,this.edgeIndicators.top.selected=t>1,this.edgeIndicators.right.showing=i>0,this.edgeIndicators.right.selected=i>1,this.edgeIndicators.bottom.showing=r>0,this.edgeIndicators.bottom.selected=r>1,BFN.MainUI.requestRender()},Dg.prototype.updateDisplay=function(){this.gridIsolator.itemWidth=this._itemWidth,this.gridIsolator.itemHeight=this._itemHeight,this.edgeIndicators.left.x=-this.gapPixels,this.edgeIndicators.left.y=this._itemHeight/2,this.edgeIndicators.left.length=this._itemHeight+2*this.gapPixels,this.edgeIndicators.left.scale=this._scale,this.edgeIndicators.top.x=this._itemWidth/2,this.edgeIndicators.top.y=-this.gapPixels,this.edgeIndicators.top.length=this._itemWidth+2*this.gapPixels,this.edgeIndicators.top.scale=this._scale,this.edgeIndicators.right.x=this._itemWidth+this.gapPixels,this.edgeIndicators.right.y=this._itemHeight/2,this.edgeIndicators.right.length=this._itemHeight+2*this.gapPixels,this.edgeIndicators.right.scale=this._scale,this.edgeIndicators.bottom.x=this._itemWidth/2,this.edgeIndicators.bottom.y=this._itemHeight+this.gapPixels,this.edgeIndicators.bottom.length=this._itemWidth+2*this.gapPixels,this.edgeIndicators.bottom.scale=this._scale;for(var e=0;e<this._gridChildren.length;e++){var t=this._gridChildren[e];t.x=Math.round(t.factorRect.left*this._itemWidth),t.y=Math.round(t.factorRect.top*this._itemHeight),t.setSize(Math.round(t.factorRect.right*this._itemWidth)-t.x,Math.round(t.factorRect.bottom*this._itemHeight)-t.y),t.content.image.setPhotoGridDimensions(this._itemWidth,this._itemHeight)}},Dg.prototype.setMaxGapFromDimensions=function(e,t){this.maxGap=Math.round(Math.min(e,t)*this.maxGapFactor)},Dg.prototype.updateGaps=function(){for(var e=0;e<this._gridChildren.length;e++){this._gridChildren[e].gap=this._gap*this.maxGap}this.gridIsolator.padding=this._gap*this.maxGap},Dg.prototype.updateRounding=function(){for(var e=0;e<this._gridChildren.length;e++){this._gridChildren[e].rounding=this._rounding}},Dg.prototype.addGridChild=function(e,t,i,r){var a=new BFN.PhotoGridChild;a.x=e,a.y=t,a.setSize(i,r),a.backgroundColor=this.childBackgroundColor,a.borderColor=this.childBorderColor,a.gap=this._gap*this.maxGap,a.rounding=this._rounding,a.scale=this._scale,a.on("pointerover",this.handleChildMouseOverBind),a.on("pointerout",this.handleChildMouseOutBind);for(var n=0;n<this.gridChildEventHandlers.length;n++)a.addEventListener(this.gridChildEventHandlers[n].event.type,this.gridChildEventHandlers[n].handler);return this.childContainer.addChild(a),this._gridChildren.push(a),this.updateRect(a),this.updateFactorRect(a),a.content.image.setPhotoGridDimensions(this._itemWidth,this._itemHeight),this._matchesTemplate&&(this._matchesTemplate=!1),a},Dg.prototype.clearAllGridChildren=function(){for(var e=this._gridChildren.length;--e>-1;){var t=this._gridChildren[e];this.clearGridChild(t)}},Dg.prototype.clearGridChild=function(e){e.menuImageVO=null,e.content.setImage(null)},Dg.prototype.removeAllGridChildren=function(){for(var e=this._gridChildren.length;--e>-1;){var t=this._gridChildren[e];this.removeGridChild(t)}this._gridChildren.splice(0)},Dg.prototype.removeGridChild=function(e){if(-1!==this._gridChildren.indexOf(e)&&-1!==this.childContainer.getChildIndex(e)){e.off("pointerover",this.handleChildMouseOverBind),e.off("pointerout",this.handleChildMouseOutBind);for(var t=0;t<this.gridChildEventHandlers.length;t++)e.removeEventListener(this.gridChildEventHandlers[t].event.type,this.gridChildEventHandlers[t].handler);e.destroy(),this.childContainer.removeChild(e),this._gridChildren.splice(this._gridChildren.indexOf(e),1),e=null,this._matchesTemplate&&(this._matchesTemplate=!1)}},Dg.prototype.isolateGridChild=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?(this._gridChildIsolated=!0,BFN.CollageMakerCanvas.canvasScaleBars.enabled=!1,this.gridIsolator.captureGridChild(e),BFN.CollageMakerCanvas.transformLayer.visible=!1,UIToggler.toggleMainMenu(!1),UIToggler.toggleAlternateMenu(!0,"collage_image_header","collage_image_menu"),UITools.setToolValue("collage_image","size",100*e.content.image.resizeScale),UITools.updateToolControl("collage_image_size")):(this._gridChildIsolated=!1,BFN.CollageMakerCanvas.canvasScaleBars.enabled=!0,this.gridIsolator.releaseGridChild(t),BFN.CollageMakerCanvas.transformLayer.visible=!0,UIToggler.toggleMainMenu(!0),UIToggler.toggleAlternateMenu(!1),this.selectedChild=null)},Dg.prototype.hideDragBar=function(){this.dragBar.hide()},Dg.prototype.getPhotoGridSnapShot=function(){this.dispatchEvent(BFN.PhotoGridEvents.PHOTO_GRID_SNAP_SHOT)},Dg.prototype.toggleEmptyCells=function(e){for(var t=0;t<this._gridChildren.length;t++){var i=this._gridChildren[t];i.visible=!((i.content.isEmpty||!i.content.imageEnabled)&&!e),i.content.background.visible=(i.content.isEmpty||!i.content.imageEnabled)&&e}},Dg.prototype.toggleBorders=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;i<this._gridChildren.length;i++){this._gridChildren[i].content.toggleBorder(e,t)}},Dg.prototype.repair=function(){for(var e={},t={},i=0;i<this._gridChildren.length;i++){var r=this._gridChildren[i];this.updateRect(r),this.updateFactorRect(r),e.hasOwnProperty(r.rect.left)||(e[r.rect.left]=[]),e.hasOwnProperty(r.rect.right)||(e[r.rect.right]=[]),e[r.rect.left].push(r),e[r.rect.right].push(r),t.hasOwnProperty(r.rect.top)||(t[r.rect.top]=[]),t.hasOwnProperty(r.rect.bottom)||(t[r.rect.bottom]=[]),t[r.rect.top].push(r),t[r.rect.bottom].push(r)}var a=this.repairChildren(e,"x"),n=this.repairChildren(t,"y");(a||n)&&(console.log(""),a&&console.log("Repaired Coordinates for ".concat(a," Children on X-Axis")),n&&console.log("Repaired Coordinates for ".concat(n," Children on Y-Axis")))},Dg.prototype.repairChildren=function(e,t){var i=[],r={},a=Object.keys(e);a.sort((e,t)=>e-t);for(var n=a.length;--n>0;){var o=a[n],s=a[n-1];Math.abs(o-s)<=1&&(i=i.concat(e[o]),e[s]=e[s].concat(e[o]),e[o].splice(0),delete e[o],r[o]=parseInt(s),a.splice(n,1))}return(i=i.unique()).forEach(e=>{var i=e.itemWidth,a=e.itemHeight;switch(t){case"x":r.hasOwnProperty(e.rect.left)&&(i+=e.rect.left-r[e.rect.left],e.x=r[e.rect.left]),r.hasOwnProperty(e.rect.right)&&(i+=r[e.rect.right]-e.rect.right),e.setSize(i,a);break;case"y":r.hasOwnProperty(e.rect.top)&&(a+=e.rect.top-r[e.rect.top],e.y=r[e.rect.top]),r.hasOwnProperty(e.rect.bottom)&&(a+=r[e.rect.bottom]-e.rect.bottom),e.setSize(i,a)}this.updateRect(e),this.updateFactorRect(e)}),i.length},Dg.prototype.updateRect=function(e){e.updateRect()},Dg.prototype.updateFactorRect=function(e){e.factorRect.left=Math.max(0,e.x/this._itemWidth),e.factorRect.right=Math.min(1,(e.x+e.itemWidth)/this._itemWidth),e.factorRect.top=Math.max(0,e.y/this._itemHeight),e.factorRect.bottom=Math.min(1,(e.y+e.itemHeight)/this._itemHeight)},Dg.prototype.setChildVeilVisibility=function(e){for(var t=0;t<this._gridChildren.length;t++){this._gridChildren[t].content.veil.visible=e}},Dg.prototype.getGridMenuImageVOs=function(){for(var e=[],t=0;t<this.gridChildren.length;t++){var i=this.gridChildren[t];i.menuImageVO&&e.push(i.menuImageVO)}return e},Dg.prototype.getChildUnderPosition=function(e,t){var i=BFN.CollageMakerCanvas.toLocal(new PIXI.Point,this.childContainer);e-=i.x,t-=i.y;for(var r=0;r<this.gridChildren.length;r++){var a=this.gridChildren[r];if(a.rect.contains(e,t))return a}return null},Dg.prototype.handleAddImage=function(e){this._selectedChild&&!this._selectedChild.destroyed&&(this._targetChild=this._selectedChild,BFN.ImageLibraryManager.uploadImages(e=>{!e.isComplete&&e.menuImageVO&&BFN.ImageLibraryManager.addImageToCanvas(e.menuImageVO)},{allowMultiple:!1}))},Dg.prototype.handleEditImage=function(e){this._selectedChild&&!this._selectedChild.destroyed&&this.isolateGridChild(this._selectedChild)},Dg.prototype.handleRemoveImage=function(e){this._selectedChild&&!this._selectedChild.destroyed&&(this._selectedChild.content.isEmpty||(this._selectedChild.menuImageVO=null,this._selectedChild.content.setImage(null)))},Dg.prototype.handleDeleteCell=function(e){this._selectedChild&&!this._selectedChild.destroyed&&(this._selectedChild.content.isEmpty||(this._selectedChild.menuImageVO=null,this._selectedChild.content.setImage(null,!0,!0)),this._selectedChild.content.deleteItem(e.ctrlKey||e.metaKey))},Dg.prototype.handleDragging=function(e){if(this.dragger.wasDragged){this.dragBar.x=Math.round(this.dragger.draggedX),this.dragBar.y=Math.round(this.dragger.draggedY);for(var t=!0,i=null,r=0;r<this.snapCoords.length;r++){var a=this.snapCoords[r];switch(this.dragBar.direction){case"horizontal":Math.abs(this.dragBar.y-a)<this.snapDistance/this._scale&&(i=Math.round(a));break;case"vertical":Math.abs(this.dragBar.x-a)<this.snapDistance/this._scale&&(i=Math.round(a))}}if(null!==i){for(var n=0;n<this.includedChildren.length;n++){var o=this.includedChildren[n],s=void 0;switch(this.dragBar.direction){case"horizontal":s="after"==o.dragPosition?o.rect.bottom-i:i-o.rect.top;break;case"vertical":s="after"==o.dragPosition?o.rect.right-i:i-o.rect.left}if(s<this.minSize+2*this.gapPixels){t=!1;break}}if(t)switch(this.dragBar.direction){case"horizontal":this.dragBar.y=i;break;case"vertical":this.dragBar.x=i}}for(var l=0;l<this.includedChildren.length;l++){var h=this.includedChildren[l];switch(this.dragBar.direction){case"horizontal":h.y="after"==h.dragPosition?this.dragBar.y:h.y,h.itemHeight="after"==h.dragPosition?h.rect.bottom-this.dragBar.y:this.dragBar.y-h.rect.top;break;case"vertical":h.x="after"==h.dragPosition?this.dragBar.x:h.x,h.itemWidth="after"==h.dragPosition?h.rect.right-this.dragBar.x:this.dragBar.x-h.rect.left}this.updateFactorRect(h)}}},Dg.prototype.handleDraggingComplete=function(e){this.dragBar.hide(),this._matchesTemplate&&(this._matchesTemplate=!1)},Dg.prototype.handleChildMouseOver=function(e){var t=e.currentTarget;setTimeout(()=>{this._focusedChild=t},0)},Dg.prototype.handleChildMouseOut=function(e){this._focusedChild=null},Dg.prototype.handleEdgeBarHovered=function(e){var t=e.dispatcher;if(t.hoveredEdge&&!this.dragger.item){this.includedChildren.splice(0),this.includedChildren.push(t);var i=new BFN.Rectangle,r=null;switch(t.hoveredEdge){case"left":case"right":i.top=t.y,i.bottom=t.y+t.itemHeight,i.left=i.right=t.x+("right"==t.hoveredEdge?t.itemWidth:0),r="vertical";break;case"top":case"bottom":i.left=t.x,i.right=t.x+t.itemWidth,i.top=i.bottom=t.y+("bottom"==t.hoveredEdge?t.itemHeight:0),r="horizontal"}if(this.separationAchieved=!1,t.attemptSeparation)this.separationAchieved=!0;else if(t.attemptUngrouping&&!t.hoveredEdgeLocked)for(var a=0;a<this._gridChildren.length;a++)if(t=this._gridChildren[a],-1==this.includedChildren.indexOf(t))switch(r){case"vertical":t.x!=i.x&&t.x+t.itemWidth!=i.x||t.y==i.top&&t.y+t.itemHeight==i.bottom&&(this.includedChildren.push(t),this.separationAchieved=!0);break;case"horizontal":t.y!=i.y&&t.y+t.itemHeight!=i.y||t.x==i.left&&t.x+t.itemWidth==i.right&&(this.includedChildren.push(t),this.separationAchieved=!0)}if(t=e.dispatcher,!this.separationAchieved&&!t.hoveredEdgeLocked)for(;;){for(var n=!1,o=0;o<this._gridChildren.length;o++)if(t=this._gridChildren[o],-1==this.includedChildren.indexOf(t))switch(r){case"vertical":t.x!=i.x&&t.x+t.itemWidth!=i.x||(t.y>=i.top&&t.y<=i.bottom||t.y+t.itemHeight>=i.top&&t.y+t.itemHeight<=i.bottom||t.y<i.top&&t.y+t.itemHeight>i.bottom)&&(i.top=Math.min(i.top,t.y),i.bottom=Math.max(i.bottom,t.y+t.itemHeight),this.includedChildren.push(t),n=!0);break;case"horizontal":t.y!=i.y&&t.y+t.itemHeight!=i.y||(t.x>=i.left&&t.x<=i.right||t.x+t.itemWidth>=i.left&&t.x+t.itemWidth<=i.right||t.x<i.left&&t.x+t.itemWidth>i.right)&&(i.left=Math.min(i.left,t.x),i.right=Math.max(i.right,t.x+t.itemWidth),this.includedChildren.push(t),n=!0)}if(!n)break}if(t=e.dispatcher,this.separationAchieved||!t.hoveredEdgeLocked){switch(r){case"horizontal":this.intersectRect.left=i.left,this.intersectRect.right=i.right,this.intersectRect.top=0,this.intersectRect.bottom=this._itemHeight;break;case"vertical":this.intersectRect.left=0,this.intersectRect.right=this._itemWidth,this.intersectRect.top=i.top,this.intersectRect.bottom=i.bottom}this.dragBar.direction=r,this.dragBar.length="horizontal"==this.dragBar.direction?i.width:i.height,this.dragBar.indicatorSide=this.separationAchieved&&t.attemptSeparation?t.hoveredEdge:null,this.dragBar.x=i.x+i.width/2,this.dragBar.y=i.y+i.height/2,this.dragBar.show(),t.awaitingDrop||(BFN.CursorScreen.cursor="arrow",BFN.CursorScreen.cursorRotation="horizontal"==this.dragBar.direction?Math.PI/2:0)}else t.hoveredEdgeLocked&&!this.separationAchieved&&(this.dragger.dragging||(this.dragBar.hide(),BFN.CursorScreen.cursor=null))}else this.dragger.dragging||(this.dragBar.hide(),BFN.CursorScreen.cursor=null)},Dg.prototype.handleEdgeBarPressed=function(e){document.addEventListener(BeFunky.pointerup,this.handleEdgeBarReleasedBind),BFN.smoothPictureDisabled=!0,BFN.CursorScreen.cursorLock=!0;var t=e.dispatcher;if(!t.hoveredEdgeLocked||t.hoveredEdgeLocked&&this.separationAchieved){this.excludedChildren.splice(0);for(var i=0;i<this._gridChildren.length;i++)t=this.gridChildren[i],-1==this.includedChildren.indexOf(t)&&this.excludedChildren.push(t);this.snapCoords.splice(0),this.snapCoords.push(0),this.snapCoords.push("horizontal"==this.dragBar.direction?this._itemHeight:this._itemWidth);for(var r=0;r<this.excludedChildren.length;r++){t=this.excludedChildren[r];var a=Math.floor("horizontal"==this.dragBar.direction?t.y:t.x),n=Math.floor("horizontal"==this.dragBar.direction?t.y+t.itemHeight:t.x+t.itemWidth);-1==this.snapCoords.indexOf(a)&&this.snapCoords.push(a),-1==this.snapCoords.indexOf(n)&&this.snapCoords.push(n)}for(var o=new BFN.Rectangle(this.intersectRect.x,this.intersectRect.y,this.intersectRect.width,this.intersectRect.height),s=0;s<this.excludedChildren.length;s++)if((t=this.excludedChildren[s]).rect.x=t.x,t.rect.y=t.y,t.rect.width=t.itemWidth,t.rect.height=t.itemHeight,t.rect.intersects(this.intersectRect))switch(this.dragBar.direction){case"horizontal":t.rect.bottom<=this.dragBar.y?o.top=Math.max(o.top,t.rect.bottom):t.rect.top>=this.dragBar.y&&(o.bottom=Math.min(o.bottom,t.rect.top));break;case"vertical":t.rect.right<=this.dragBar.x?o.left=Math.max(o.left,t.rect.right):t.rect.left>=this.dragBar.x&&(o.right=Math.min(o.right,t.rect.left))}for(var l=0;l<this.includedChildren.length;l++)if((t=this.includedChildren[l]).rect.x=t.x,t.rect.y=t.y,t.rect.width=t.itemWidth,t.rect.height=t.itemHeight,t.rect.intersects(this.intersectRect)){var h=this.minSize+2*this.gapPixels;switch(this.dragBar.direction){case"horizontal":t.rect.top<this.dragBar.y?o.top=Math.max(o.top,t.rect.top+h):t.rect.bottom>this.dragBar.y&&(o.bottom=Math.min(o.bottom,t.rect.bottom-h)),t.rect.bottom==this.dragBar.y?t.dragPosition="before":t.rect.top==this.dragBar.y&&(t.dragPosition="after");break;case"vertical":t.rect.left<this.dragBar.x?o.left=Math.max(o.left,t.rect.left+h):t.rect.right>this.dragBar.x&&(o.right=Math.min(o.right,t.rect.right-h)),t.rect.right==this.dragBar.x?t.dragPosition="before":t.rect.left==this.dragBar.x&&(t.dragPosition="after")}}switch(this.intersectRect.x=o.x,this.intersectRect.y=o.y,this.intersectRect.width=o.width,this.intersectRect.height=o.height,this.dragBar.direction){case"horizontal":this.dragBarPosition=this.dragBar.y,this.intersectRect.top<this.intersectRect.bottom?this.dragger.setBounds(this.dragBar.x,this.intersectRect.top,this.dragBar.x,this.intersectRect.bottom):this.dragger.setBounds(this.dragBar.x,this.dragBar.y,this.dragBar.x,this.dragBar.y);break;case"vertical":this.dragBarPosition=this.dragBar.x,this.intersectRect.left<this.intersectRect.right?this.dragger.setBounds(this.intersectRect.left,this.dragBar.y,this.intersectRect.right,this.dragBar.y):this.dragger.setBounds(this.dragBar.x,this.dragBar.y,this.dragBar.x,this.dragBar.y)}this.dragger.drag(this.dragBar)}},Dg.prototype.handleEdgeBarReleased=function(e){switch(document.removeEventListener(BeFunky.pointerup,this.handleEdgeBarReleasedBind),BFN.smoothPictureDisabled=!1,BFN.CursorScreen.cursorLock=!1,this.dragBar.direction){case"horizontal":this.dragBar.y!=this.dragBarPosition&&(BFN.CollageMakerHistoryModel.historyAction="layout_updated",this.getPhotoGridSnapShot());break;case"vertical":this.dragBar.x!=this.dragBarPosition&&(BFN.CollageMakerHistoryModel.historyAction="layout_updated",this.getPhotoGridSnapShot())}},Dg.prototype.handleInsertChild=function(e){BFN.CollageMakerHistoryModel.historyAction="grid_cell_inserted";var t=e.dispatcher,i=t.hoveredEdge;this.attachedChildren.splice(0),this.attachedChildren.push(t);for(var r,a,n,o,s=new BFN.Rectangle(t.x,t.y,t.itemWidth,t.itemHeight);;){for(var l=!1,h=0;h<this._gridChildren.length;h++){var c=this._gridChildren[h];if(-1==this.attachedChildren.indexOf(c))switch(this.dragBar.direction){case"vertical":c.x!=s.right&&c.x+c.itemWidth!=s.left||c.y==s.top&&c.y+c.itemHeight==s.bottom&&(s.left=Math.min(s.left,c.x),s.right=Math.max(s.right,c.x+c.itemWidth),this.attachedChildren.push(c),l=!0);break;case"horizontal":c.y!=s.bottom&&c.y+c.itemHeight!=s.top||c.x==s.left&&c.x+c.itemWidth==s.right&&(s.top=Math.min(s.top,c.y),s.bottom=Math.max(s.bottom,c.y+c.itemHeight),this.attachedChildren.push(c),l=!0)}}if(!l)break}switch(this._insertedGridChild=null,this.dragBar.direction){case"vertical":this.attachedChildren.sort((e,t)=>e.x-t.x),r=s.width/(this.attachedChildren.length+1),a=(s.width-r)/s.width,r=s.width;for(var u=0;u<this.attachedChildren.length;u++){var d=this.attachedChildren[u];d.transitionRect.width=Math.round(d.itemWidth*a),d.transitionRect.height=d.itemHeight,r-=d.transitionRect.width,d==e.dispatcher&&(n="left"==i?u:u+1)}this._insertedGridChild=this.addGridChild(t.x+("left"==i?0:t.itemWidth),s.y,0,s.height),this._insertedGridChild.content.flashItem(),this._insertedGridChild.content.selectItem(),this.attachedChildren.splice(n,0,this._insertedGridChild),o=s.x;for(var m=0;m<this.attachedChildren.length;m++){var p=this.attachedChildren[m];p==this._insertedGridChild?(p.transitionRect.width=r,p.transitionRect.height=p.itemHeight,p.transitionRect.x=o,p.transitionRect.y=p.y,this.transitionChildren.push(p),p.makeTransition(),o+=p.transitionRect.width):(p.transitionRect.x=o,p.transitionRect.y=p.y,this.transitionChildren.push(p),p.makeTransition(),o+=p.transitionRect.width)}break;case"horizontal":this.attachedChildren.sort((e,t)=>e.y-t.y),r=s.height/(this.attachedChildren.length+1),a=(s.height-r)/s.height,r=s.height;for(var g=0;g<this.attachedChildren.length;g++){var f=this.attachedChildren[g];f.transitionRect.width=f.itemWidth,f.transitionRect.height=Math.round(f.itemHeight*a),r-=f.transitionRect.height,f==e.dispatcher&&(n="top"==i?g:g+1)}this._insertedGridChild=this.addGridChild(s.x,t.y+("top"==i?0:t.itemHeight),s.width,0),this._insertedGridChild.content.flashItem(),this._insertedGridChild.content.selectItem(),this.attachedChildren.splice(n,0,this._insertedGridChild),o=s.y;for(var v=0;v<this.attachedChildren.length;v++){var y=this.attachedChildren[v];y==this._insertedGridChild?(y.transitionRect.width=y.itemWidth,y.transitionRect.height=r,y.transitionRect.x=y.x,y.transitionRect.y=o,this.transitionChildren.push(y),y.makeTransition(),o+=y.transitionRect.height):(y.transitionRect.x=y.x,y.transitionRect.y=o,this.transitionChildren.push(y),y.makeTransition(),o+=y.transitionRect.height)}}this.dragBar.animator.setAnimatorFactor(0)},Dg.prototype.handleSelectChild=function(e){this._selectedChild=e.dispatcher,this._selectedChild.content.directSelect&&(this._selectedChild.content.isEmpty?(this.contextMenu.showButton("add_image"),this.contextMenu.hideButton("edit_image"),this.contextMenu.hideButton("remove_image")):(this.contextMenu.hideButton("add_image"),this.contextMenu.showButton("edit_image"),this.contextMenu.showButton("remove_image")),this._gridChildren.length>1?this.contextMenu.showButton("delete_cell"):this.contextMenu.hideButton("delete_cell"),this.contextMenu.enabled=!0)},Dg.prototype.handleDragChild=function(e){this._draggedChild=e.dispatcher,BFN.DragScreen.show(this._draggedChild.menuImageVO.thumbURL),this.awaitingDrop=!0,document.addEventListener(BeFunky.pointerup,this.handleDropChildBind)},Dg.prototype.handleDropChild=function(e){if(this.awaitingDrop=!1,document.removeEventListener(BeFunky.pointerup,this.handleDropChildBind),this._focusedChild){if(this._draggedChild&&this._draggedChild==this._focusedChild&&!this._draggedChild.hoveredEdge)return void(this.draggedChild=null);if(this._focusedChild.handleDrop(),this._selectedChild&&this._draggedChild){BFN.CollageMakerHistoryModel.ignoreSnapshot=!0;var t=this._draggedChild.content.image.frameSprite.rotate,i=this._draggedChild.menuImageVO;if(this._selectedChild.content.isEmpty)this._draggedChild.menuImageVO=null,this._draggedChild.content.setImage(null);else{var r=this._selectedChild.content.image.frameSprite.rotate;this._draggedChild.menuImageVO=this._selectedChild.menuImageVO,this._draggedChild.content.setImage(this._selectedChild.content.image.texture,!0,!1,r),this._draggedChild.content.image.frameSprite.rotate=r}BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this._selectedChild.menuImageVO=i,this._selectedChild.content.setImage(i.imageTexture,!0,!1,t)}}this.draggedChild=null,this.selectedChild=null},Dg.prototype.handleDeleteChild=function(e){if(this._gridChildren.length>1){BFN.CollageMakerHistoryModel.historyAction="grid_cell_deleted";var t,i,r,a,n=e.dispatcher,o=new BFN.Rectangle(0,n.y,this._itemWidth,n.itemHeight),s=new BFN.Rectangle(n.x,0,n.itemWidth,this._itemHeight),l=[],h=[];for(t=0;t<this._gridChildren.length;t++)r=this._gridChildren[t],this.updateRect(r),r!=n&&(o.intersects(r.rect)&&l.push(r),s.intersects(r.rect)&&h.push(r));var c=!1,u=!1;for(t=l.length;--t>-1;)(r=l[t]).rect.top<o.top||r.rect.bottom>o.bottom?r.rect.right<=n.rect.left?o.left=Math.max(o.left,r.rect.right):r.rect.left>=n.rect.right&&(o.right=Math.min(o.right,r.rect.left)):r.rect.right==n.rect.left?c=!0:r.rect.left==n.rect.right&&(u=!0);var d=!1,m=!1;for(t=h.length;--t>-1;)(r=h[t]).rect.left<s.left||r.rect.right>s.right?r.rect.bottom<=n.rect.top?s.top=Math.max(s.top,r.rect.bottom):r.rect.top>=n.rect.bottom&&(s.bottom=Math.min(s.bottom,r.rect.top)):r.rect.bottom==n.rect.top?d=!0:r.rect.top==n.rect.bottom&&(m=!0);for(o.left=c?o.left:n.rect.left,o.right=u?o.right:n.rect.right,s.top=d?s.top:n.rect.top,s.bottom=m?s.bottom:n.rect.bottom,l.splice(0),h.splice(0),t=0;t<this._gridChildren.length;t++)(r=this._gridChildren[t])==n||r.rect.intersects(n.rect)||(o.intersects(r.rect)&&l.push(r),s.intersects(r.rect)&&h.push(r));var p,g,f,v=null;if(l.sort((e,t)=>e.x-t.x),h.sort((e,t)=>e.y-t.y),l.length&&h.length?v=Math.random()<.5?l:h:l.length?v=l:h.length&&(v=h),v&&v.length&&!n.content.cleanDelete){for(this.positions.splice(0),t=0;t<v.length;t++)if(!(r=v[t]).rect.intersects(n.rect))if(v==l){if(p=Math.round(n.x+n.itemWidth/2),g=o.width/(o.width-n.itemWidth),(f=r.x)>p&&(f-=n.itemWidth),r.transitionRect.x=Math.round((f-o.left)*g)+o.left,r.transitionRect.y=r.y,r.transitionRect.width=Math.round(r.itemWidth*g),r.transitionRect.height=r.itemHeight,-1==this.positions.indexOf(r.transitionRect.x)||-1==this.positions.indexOf(r.transitionRect.x+r.transitionRect.width))for(i=0;i<this.positions.length;i++)a=this.positions[i]-r.transitionRect.x,1==Math.abs(a)&&(console.log("ADJUST HORIZONTAL POSITION"),r.transitionRect.x+=a,r.transitionRect.width-=a);-1==this.positions.indexOf(r.transitionRect.x)&&this.positions.push(r.transitionRect.x),-1==this.positions.indexOf(r.transitionRect.x+r.transitionRect.width)&&this.positions.push(r.transitionRect.x+r.transitionRect.width),this.transitionChildren.push(r),r.makeTransition()}else if(v==h){if(p=Math.round(n.y+n.itemHeight/2),g=s.height/(s.height-n.itemHeight),(f=r.y)>p&&(f-=n.itemHeight),r.transitionRect.x=Math.max(0,r.x),r.transitionRect.y=Math.max(0,Math.round((f-s.top)*g)+s.top),r.transitionRect.width=Math.min(r.itemWidth,this._itemWidth-r.transitionRect.x),r.transitionRect.height=Math.min(Math.round(r.itemHeight*g),this._itemHeight-r.transitionRect.y),-1==this.positions.indexOf(r.transitionRect.y)||-1==this.positions.indexOf(r.transitionRect.y+r.transitionRect.height))for(i=0;i<this.positions.length;i++)a=this.positions[i]-r.transitionRect.y,1==Math.abs(a)&&(console.log("ADJUST VERTICAL POSITION"),r.transitionRect.y+=a,r.transitionRect.height-=a);-1==this.positions.indexOf(r.transitionRect.y)&&this.positions.push(r.transitionRect.y),-1==this.positions.indexOf(r.transitionRect.y+r.transitionRect.height)&&this.positions.push(r.transitionRect.y+r.transitionRect.height),this.transitionChildren.push(r),r.makeTransition()}this.positions.splice(0)}this.removeGridChild(n),this.transitionChildren.length||this.handleChildTransitionCompleteTimeout()}},Dg.prototype.handleChildImageUpdated=function(e){this._insertedGridChild||(BFN.CollageMakerHistoryModel.historyAction="image_updated",this.getPhotoGridSnapShot())},Dg.prototype.handleChildImagePositionUpdated=function(e){BFN.CollageMakerHistoryModel.historyAction="image_position_updated",BFN.CollageMakerHistoryModel.focusedGridChild=e.dispatcher,this.getPhotoGridSnapShot(),BFN.CollageMakerHistoryModel.focusedGridChild=null},Dg.prototype.handleChildTransitionComplete=function(e){var t=e.dispatcher;this.updateFactorRect(t),-1!=this.transitionChildren.indexOf(t)&&(this.transitionChildren.splice(this.transitionChildren.indexOf(t),1),this.transitionChildren.length||setTimeout(this.handleChildTransitionCompleteTimeout.bind(this),10))},Dg.prototype.handleChildTransitionCompleteTimeout=function(e){if(this._insertedGridChild&&(this._insertedGridChild.content.imageEnabled=!1),this.getPhotoGridSnapShot(),this._insertedGridChild&&(this._insertedGridChild.content.imageEnabled=!0),this._insertedGridChild){var t=this._insertedGridChild.content.isEmpty;this._insertedGridChild=null,t||this.handleChildImageUpdated(null)}},Dg.prototype.startTouchDragHoverDetection=function(){this.detectingTouchDragHovers||(this.detectingTouchDragHovers=!0,this.gridChildren.forEach(e=>{e.updateGlobalBounds()}),this.unhoverHoveredItem(),this.detectHoversManuallyBind(BeFunky.globalPointerEvent),document.addEventListener(BeFunky.pointermove,this.detectHoversManuallyBind,!0),document.addEventListener(BeFunky.pointerup,this.stopTouchDragHoverDetectionBind,!0))},Dg.prototype.stopTouchDragHoverDetection=function(){this.detectingTouchDragHovers&&(this.detectingTouchDragHovers=!1,setTimeout(()=>{this.unhoverHoveredItem()},0),document.removeEventListener(BeFunky.pointermove,this.detectHoversManuallyBind,!0),document.removeEventListener(BeFunky.pointerup,this.stopTouchDragHoverDetectionBind,!0))},Dg.prototype.unhoverHoveredItem=function(){if(this.hoveredItem)switch(this.hoveredItemType){case"content":this.hoveredItem.content.handleMouseOutBind();break;case"edge":var e=this.hoveredItem;e.handleMouseOutBind(),e.gridChild.handleEdgeBarOutBind()}this.handleChildMouseOutBind(),this.hoveredItem=null,this.hoveredItemType=null},Dg.prototype.detectHoversManually=function(e){var t=this,i=BeFunky.globalPointerCoords.x,r=BeFunky.globalPointerCoords.y,a=null,n=null;this.gridChildren.forEach(e=>{if(e.globalRect.contains(i,r)){var t=null;for(var o in e.edgeBars){var s=e.edgeBars[o];s.containsGlobalPoint(i,r)&&(t=s)}t?(a=t,n="edge"):(a=e,n="content")}}),function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(i!=t.hoveredItem&&(t.unhoverHoveredItem(),t.hoveredItem=i,t.hoveredItemType=r,t.hoveredItem&&t.hoveredItemType))switch(t.hoveredItemType){case"content":t.hoveredItem.content.handleMouseOverBind(),t.handleChildMouseOverBind({currentTarget:t.hoveredItem});break;case"edge":var a=t.hoveredItem;a.handleMouseOverBind(),a.gridChild.handleEdgeBarOverBind({currentTarget:a,data:{originalEvent:e}}),t.handleChildMouseOverBind({currentTarget:a.gridChild})}}(a,n)},Object.defineProperty(Dg.prototype,"isEmpty",{get(){for(var e=!0,t=0;t<this._gridChildren.length;t++){if(!this._gridChildren[t].content.isEmpty){e=!1;break}}return e}}),Object.defineProperty(Dg.prototype,"gridChildIsolated",{get(){return this._gridChildIsolated}}),Object.defineProperty(Dg.prototype,"scale",{set(e){this._scale=e;for(var t=0;t<this._gridChildren.length;t++){this._gridChildren[t].scale=this._scale}this.dragBar.scale=this._scale,this.edgeIndicators.left.scale=this._scale,this.edgeIndicators.top.scale=this._scale,this.edgeIndicators.right.scale=this._scale,this.edgeIndicators.bottom.scale=this._scale,this.dragger.scale=this._scale},get(){return this._scale}}),Object.defineProperty(Dg.prototype,"backgroundColor",{set(e){if(this._backgroundColor=e,this.childBackgroundColor="000000",this.childBorderColor="000000",-1==this._backgroundColor)this.childBackgroundColor="FFFFFF",this.childBorderColor="000000";else{var t=parseInt("0x".concat(this._backgroundColor)),i=BFN.Util.hex2hsv(t),r=i.v,a=i.v;i.v>.65?(r-=.3*i.v,a-=.4*i.v):(r+=.3*(1-i.v),a+=.4*(1-i.v)),i.v=r,this.childBackgroundColor=BFN.Util.hsv2rgb(i).hex.split("#").join(""),i.v=a,this.childBorderColor=BFN.Util.hsv2rgb(i).hex.split("#").join("")}for(var n=0;n<this._gridChildren.length;n++){var o=this._gridChildren[n];o.backgroundColor=this.childBackgroundColor,o.borderColor=this.childBorderColor}},get(){return this._backgroundColor}}),Object.defineProperty(Dg.prototype,"gap",{set(e){this._gap=e,this.updateGaps()},get(){return this._gap}}),Object.defineProperty(Dg.prototype,"gapPixels",{get(){return Math.round(this._gap*this.maxGap/2)}}),Object.defineProperty(Dg.prototype,"rounding",{set(e){this._rounding=e,this.updateRounding()},get(){return this._rounding}}),Object.defineProperty(Dg.prototype,"gridChildren",{get(){return this._gridChildren}}),Object.defineProperty(Dg.prototype,"focusedChild",{get(){return this._focusedChild}}),Object.defineProperty(Dg.prototype,"targetChild",{set(e){this._targetChild=e},get(){return this._targetChild}}),Object.defineProperty(Dg.prototype,"randomEmptyChild",{get(){for(var e=null,t=[],i=0;i<this.gridChildren.length;i++){var r=this.gridChildren[i];r.content.isEmpty&&t.push(r)}return t.length&&(e=t[Math.floor(Math.random()*t.length)]),t.splice(0),e}}),Object.defineProperty(Dg.prototype,"selectedChild",{set(e){this._selectedChild=e},get(){return this._selectedChild}}),Object.defineProperty(Dg.prototype,"draggedChild",{set(e){this._draggedChild=e},get(){return this._draggedChild}}),Object.defineProperty(Dg.prototype,"awaitingDrop",{set(e){this._awaitingDrop!=e&&(e?"touch"==BeFunky.globalPointerEvent.pointerType&&this.startTouchDragHoverDetection():this.stopTouchDragHoverDetection()),this._awaitingDrop=e;for(var t=0;t<this._gridChildren.length;t++){this._gridChildren[t].awaitingDrop=this._awaitingDrop}},get(){return this._awaitingDrop}}),Object.defineProperty(Dg.prototype,"matchesTemplate",{set(e){this._matchesTemplate=e},get(){return this._matchesTemplate}}),Object.defineProperty(Dg.prototype,"itemWidth",{set(e){this._itemWidth=e,this.setSize(this._itemWidth,this._itemHeight)},get(){return this._itemWidth}}),Object.defineProperty(Dg.prototype,"itemHeight",{set(e){this._itemHeight=e,this.setSize(this._itemWidth,this._itemHeight)},get(){return this._itemHeight}}),BFN.SingletonQueue.add(()=>{BFN.PhotoGrid=new Dg}),BFN.CollageMakerCanvasPhotoGridEvents={RESIZING:new Event("RESIZING"),RESIZING_COMPLETE:new Event("RESIZING_COMPLETE")},wg.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),wg.prototype.init=function(){BeFunky.log("CollageMakerCanvasPhotoGrid Init"),this.initDefaultValues(),this.initPhotoGridContainer(),this.initPatternBackground(),this.initPhotoGrid()},wg.prototype.initDefaultValues=function(){this.interactive=!0,this._canvasScale=1,this._gridWidth=1,this._gridHeight=1,this.longestSide=Math.max(this._gridWidth,this._gridHeight),this.adjustmentScaleFactor=1,this.currentAspectRatio=1,this.manualGridResize=!1,this.lastTemplate=null,this.customizePending=!1,this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this),this.targetGridChildren=[],this.gridImageIDs=[],this.autoFillMenuImageVOIndex=0,this.autoFillMenuImageVOs=null,this.updateCurrentTransition=!1,this.transitionVO=null,this.transitionUpdating=!1,this.uniqueTransitionTags=["background_color","background_pattern"],this.pendingAutoCollageBaseTextures=[],window.addEventListener("INIT_COMPLETE",function(){document.getElementById("collage_customize_width").paramObject.max=BFN.maxImageSize,document.getElementById("collage_customize_height").paramObject.max=BFN.maxImageSize}),BFN.CollageMakerTemplateModel.addEventListener(BFN.CollageMakerTemplateModelEvents.CURRENT_TEMPLATE_UPDATED.type,this.handleCurrentTemplateUpdated.bind(this)),BFN.CollageMakerTemplateModel.addEventListener(BFN.CollageMakerTemplateModelEvents.FREEFORM.type,this.handleFreeformTemplate.bind(this)),BFN.CollageMakerHistoryModel.addEventListener(BFN.CollageMakerHistoryModelEvents.APPLY_CURRENT_SNAPSHOT.type,this.handleApplyCurrentSnapShot.bind(this)),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.COLLAGE_SETTINGS_UPDATED.type,this.handleCollageSettingsUpdated.bind(this)),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.CLEAR_ALL.type,this.handleClearAll.bind(this)),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.AUTO_COLLAGE_LAYOUT_OBJECT.type,this.handleAutoCollageLayoutObject.bind(this))},wg.prototype.initPhotoGridContainer=function(){this.photoGridContainer=new PIXI.Container,this.addChild(this.photoGridContainer)},wg.prototype.initPatternBackground=function(){this.patternBackgroundTextureSourceSprite=new PIXI.Sprite,this.patternBackgroundTextureSourceSprite.pluginName="smooth_picture",this.patternBackgroundTextureSourceSprite.smoothing=!0,this.patternBackgroundTexture=PIXI.RenderTexture.create(32,32),this.patternBackgroundTexture.clear(),this.patternBackground=new BFN.TileContainer(this.patternBackgroundTexture,32,32),this.patternBackground.visible=!1,this.photoGridContainer.addChild(this.patternBackground)},wg.prototype.initPhotoGrid=function(){this.photoGrid=BFN.PhotoGrid,this.photoGrid.addEventListener(BFN.PhotoGridEvents.PHOTO_GRID_SNAP_SHOT.type,this.handlePhotoGridSnapShot.bind(this)),this.photoGridContainer.addChild(this.photoGrid)},wg.prototype.initInitialTemplate=function(){this.resetBackground(),BFN.CollageMakerTemplateModel.currentTemplate=BFN.CollageMakerTemplateData.templateCategoryVOs[0].templateVOs[0]},wg.prototype.handleCustomize=function(){this.customizePending||(this.customizePending=!0,BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)),BFN.MainUI.requestRender()},wg.prototype.handleMainUIPreRender=function(){if(this.customizePending){this.customizePending=!1,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind);var e=UITools.getToolVO("collage_customize");if("lock_aspect_ratio"==e.updating_id)return;if(!this.transitionUpdating){this.transitionUpdating=!0;var t="settings";switch(e.updating_id){case"width":case"height":t="dimensions_changed";break;case"background_color":t=-1==e.background_color?"background_transparent":"background_color";break;case"spacing":t="spacing";break;case"corner_rounding":t="corner_rounding"}this.createHistoryTransition(t)}BFN.CollageMakerCanvasBackground.color!=e.background_color&&(BFN.CollageMakerCanvasBackground.color=e.background_color),"background_color"==e.updating_id&&this.patternBackground.visible&&this.setPatternBackgroundTexture(null),this.photoGrid.backgroundColor==BFN.CollageMakerCanvasBackground.color||this.patternBackground.visible||(this.photoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color);var i=!1;"spacing"==e.updating_id&&this.photoGrid.gap!=e.spacing/100&&(this.photoGrid.gap=e.spacing/100,i=!0);var r=!1;"corner_rounding"==e.updating_id&&this.photoGrid.rounding!=e.corner_rounding/100&&(this.photoGrid.rounding=e.corner_rounding/100,r=!0);var a=!1;if("width"==e.updating_id||"height"==e.updating_id){if(e.width!=this._gridWidth||e.height!=this._gridHeight){var n=e.width,o=e.height;if(!this.manualGridResize){if(e.lock_aspect_ratio)switch(e.updating_id){case"width":o=Math.min(BFN.maxImageSize,Math.max(BFN.minCollageSize,Math.round(n*this.currentAspectRatio))),n=Math.round(o/this.currentAspectRatio);break;case"height":n=Math.min(BFN.maxImageSize,Math.max(BFN.minCollageSize,Math.round(o/this.currentAspectRatio))),o=Math.round(n*this.currentAspectRatio)}UITools.setToolValue("collage_customize","width",n,e.updating),UITools.setToolValue("collage_customize","height",o,e.updating),UITools.updateToolControls("collage_customize"),this.longestSide=Math.max(n,o)}this._gridWidth=n,this._gridHeight=o,this.updatePhotoGridDisplay(),this.updatePatternBackgroundDisplay()}e.updating?this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridEvents.RESIZING):(this.adjustGridSizeToLongestSide(),this.updatePhotoGridDisplay(),this.updatePatternBackgroundDisplay(),a=!0,this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridEvents.RESIZING_COMPLETE),this.adjustmentScaleFactor=1)}a||!i&&!r||this.updatePhotoGridDisplay(!1),!e.updating&&this.transitionUpdating&&(this.transitionUpdating=!1,this.registerHistoryTransition()),!e.updating&&this.manualGridResize&&(this.manualGridResize=!1)}},wg.prototype.handleCollageImage=function(){var e=UITools.getToolVO("collage_image");if(this.photoGrid.selectedChild&&this.photoGrid.selectedChild.content&&this.photoGrid.selectedChild.content.image)switch(e.updating_id){case"size":this.photoGrid.selectedChild.content.image.resize(e.size/100);break;case"rotate_clockwise":this.photoGrid.selectedChild.content.image.rotate("right");break;case"rotate_counter_clockwise":this.photoGrid.selectedChild.content.image.rotate("left");break;case"flip_horizontal":this.photoGrid.selectedChild.content.image.flip("horizontal");break;case"flip_vertical":this.photoGrid.selectedChild.content.image.flip("vertical");break;case"open_in_editor":if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("COLLAGE","EDIT_IMAGE_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Open Grid Image in Editor"]);var t=this.photoGrid.selectedChild;this.photoGrid.isolateGridChild(null,!0);try{BFN.BfnService.track("CREATE","COLLAGE","OPEN_IMAGE_EDITOR")}catch(e){}BFN.PhotoEditorModel.currentTexture&&BFN.IndexedDB.disabledReason?BeFunky.confirm("confirm_edit_image",{onConfirm:()=>{BFN.ImageEditManager.openGridCellInEditor(t)},onCancel:()=>{this.photoGrid.selectedChild=t,this.photoGrid.isolateGridChild(t)},focusConfirmButton:!1}):BFN.ImageEditManager.openGridCellInEditor(t)}BFN.MainUI.requestRender()},wg.prototype.autoFill=function(e){if(e&&e.length){if(!this.autoFillMenuImageVOs){this.autoFillMenuImageVOs=[];for(var t=0;t<e.length;t++)this.autoFillMenuImageVOs.push(e[t])}if(BFN.CollageMakerCanvasPhotoGridModel.freeform)this.autoFillMenuImageVOs.shuffle(),this.autoFillMenuImageVOs.length>3&&this.autoFillMenuImageVOs.splice(3),BFN.BfnService.getTexturesForMenuImageVOs(this.autoFillMenuImageVOs,this.processAutoFillMenuImageVOs.bind(this));else{this.targetGridChildren.splice(0),this.gridImageIDs.splice(0);for(var i=0;i<this.photoGrid.gridChildren.length;i++){var r=this.photoGrid.gridChildren[i];r.content.isEmpty?this.targetGridChildren.push(r):-1==this.gridImageIDs.indexOf(r.menuImageVO.id)&&this.gridImageIDs.push(r.menuImageVO.id)}if(this.targetGridChildren.shuffle(),this.targetGridChildren.length){for(var a=this.autoFillMenuImageVOs.length;--a>-1&&this.autoFillMenuImageVOs.length>this.targetGridChildren.length;){var n=this.autoFillMenuImageVOs[a];this.gridImageIDs.includes(n.id)&&this.autoFillMenuImageVOs.splice(a,1)}this.autoFillMenuImageVOs.length>this.targetGridChildren.length&&this.autoFillMenuImageVOs.splice(this.targetGridChildren.length),this.autoFillMenuImageVOIndex=0,BFN.BfnService.getTexturesForMenuImageVOs(this.autoFillMenuImageVOs,this.processAutoFillMenuImageVOs.bind(this))}else this.autoFillMenuImageVOs.splice(0),this.autoFillMenuImageVOs=null}}},wg.prototype.processAutoFillMenuImageVOs=function(){if(this.autoFillMenuImageVOs&&this.autoFillMenuImageVOs.length)if(BFN.CollageMakerCanvasPhotoGridModel.freeform){for(var e=0;e<this.autoFillMenuImageVOs.length;e++){var t=this.autoFillMenuImageVOs[e],i=Math.round(this._gridWidth/2*Math.random())-this._gridWidth/4,r=Math.round(this._gridHeight/2*Math.random())-this._gridHeight/4;BFN.CollageMakerCanvasModel.addedItem={type:"texture",texture:t.imageTexture,initialCenterPosition:new PIXI.Point(i,r),projectItemAssetID:t.id},BFN.BfnService.storeBlobForMenuImageVO(t,"collage")}BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.selectedTransformItem.deselectItem()}else{if("auto_fill"!=BFN.CollageMakerHistoryModel.historyAction&&(BFN.CollageMakerHistoryModel.ignoreSnapshot=!0,BFN.CollageMakerHistoryModel.historyAction="auto_fill"),this.targetGridChildren.length){var a;for(BFN.PhotoGrid.targetChild=this.targetGridChildren.shift();a=this.autoFillMenuImageVOs[this.autoFillMenuImageVOIndex],this.autoFillMenuImageVOIndex=(this.autoFillMenuImageVOIndex+1)%this.autoFillMenuImageVOs.length,this.gridImageIDs.length&&-1!=this.gridImageIDs.indexOf(a.id);)if(!this.autoFillMenuImageVOIndex){this.gridImageIDs.splice(0);break}return this.autoFillMenuImageVOIndex||this.autoFillMenuImageVOs.shuffle(),void(a&&BFN.ImageLibraryManager.addImageToCanvas(a,{generateTexture:!1}))}"auto_fill"==BFN.CollageMakerHistoryModel.historyAction&&(BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this.photoGrid.getPhotoGridSnapShot(),BFN.CollageMakerHistoryModel.historyAction=null)}this.autoFillMenuImageVOs=null},wg.prototype.assignImageToTargetGridChild=function(e){this.photoGrid.targetChild&&null!=this.photoGrid.targetChild.content&&(BFN.TransformStateModel.safeBaseTextures.includes(e.imageTexture.baseTexture)||BFN.TransformStateModel.safeBaseTextures.push(e.imageTexture.baseTexture),this.photoGrid.targetChild.menuImageVO=e,this.photoGrid.targetChild.content.setImage(e.imageTexture),this.photoGrid.targetChild=null,BFN.TransformStateModel.safeBaseTextures.splice(0)),this.processAutoFillMenuImageVOs()},wg.prototype.preparePhotoGrid=function(e,t,i,r){this.photoGrid.removeAllGridChildren(),this.photoGrid.setSize(e,t),this.photoGrid.gap=i,this.photoGrid.rounding=r},wg.prototype.updatePhotoGridDisplay=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.currentAspectRatio=this._gridHeight/this.gridWidth,this.photoGridContainer.x=-this._gridWidth/2,this.photoGridContainer.y=-this._gridHeight/2,this.photoGrid.setMaxGapFromDimensions(this._gridWidth,this._gridHeight),this.photoGrid.x=this.photoGrid.gapPixels,this.photoGrid.y=this.photoGrid.gapPixels,this.photoGrid.setSize(this._gridWidth-2*this.photoGrid.gapPixels,this._gridHeight-2*this.photoGrid.gapPixels),e&&BFN.CollageMakerCanvasPhotoGridModel.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.GRID_SIZE_CHANGED)},wg.prototype.adjustGridSizeToLongestSide=function(){this.adjustmentScaleFactor=Math.min(this.longestSide/Math.round(this._gridWidth),this.longestSide/Math.round(this._gridHeight)),this._gridWidth=Math.max(BFN.minCollageSize,Math.round(this._gridWidth*this.adjustmentScaleFactor)),this._gridHeight=Math.max(BFN.minCollageSize,Math.round(this._gridHeight*this.adjustmentScaleFactor)),this.updateToolVO(this._gridWidth,this._gridHeight)},wg.prototype.setPatternBackgroundTexture=function(e){this.patternBackground.visible=!1;try{this.patternBackgroundTextureSourceSprite.texture.destroy(!1)}catch(e){}this.patternBackgroundTextureSourceSprite.texture=PIXI.Texture.EMPTY,BFN.CollageMakerCanvasPhotoGridModel.backgroundPatternTexture=e?new PIXI.Texture(e.baseTexture):null,e&&(e.baseTexture.hasOwnProperty("averageColor")&&(this.photoGrid.backgroundColor=e.baseTexture.averageColor.toString(16)),this.patternBackgroundTextureSourceSprite.texture=new PIXI.Texture(e.baseTexture),this.patternBackground.visible=!0),this.updatePatternBackgroundDisplay()},wg.prototype.updatePatternBackgroundDisplay=function(){if(this.patternBackground.visible){var e=Math.max(this._gridWidth/this.patternBackgroundTextureSourceSprite.texture.width,this._gridHeight/this.patternBackgroundTextureSourceSprite.texture.height)/2,t=Math.round(this.patternBackgroundTextureSourceSprite.texture.baseTexture.width*e),i=Math.round(this.patternBackgroundTextureSourceSprite.texture.baseTexture.height*e);this.patternBackgroundTextureSourceSprite.scale.x=this.patternBackgroundTextureSourceSprite.scale.y=this.patternBackgroundTextureSourceSprite.currentScale=e,this.patternBackgroundTexture.resize(t,i),BFN.Stage.render(this.patternBackgroundTextureSourceSprite,this.patternBackgroundTexture),this.patternBackground.width=this._gridWidth,this.patternBackground.height=this._gridHeight,this.patternBackground.updateDisplay()}else this.patternBackgroundTexture.clear(),this.patternBackgroundTexture.resize(32,32),this.patternBackground.width=32,this.patternBackground.height=32,this.patternBackground.updateDisplay()},wg.prototype.resetBackground=function(e){BFN.CollageMakerCanvasBackground.color="FFFFFF",this.setPatternBackgroundTexture(null),this.photoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color},wg.prototype.getScreenCapture=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=PIXI.RenderTexture.create(this._gridWidth,this._gridHeight);return this.patternBackground.visible?(this.patternBackground.smoothScale=1,BFN.Stage.render(this.patternBackground,i),this.patternBackground.smoothScale=this._canvasScale):-1!=BFN.CollageMakerCanvasBackground.color&&i.fillColor(parseInt("0x"+BFN.CollageMakerCanvasBackground.color)),BFN.CollageMakerCanvasPhotoGridModel.freeform||(this.photoGrid.childContainer.x=this.photoGrid.childContainer.y=this.photoGrid.gapPixels,this.photoGrid.setChildVeilVisibility(!1),this.photoGrid.toggleBorders(!1,t),this.photoGrid.toggleEmptyCells(e),this.photoGrid.scale=1,BFN.Stage.render(this.photoGrid.childContainer,i,!1),this.photoGrid.childContainer.x=this.photoGrid.childContainer.y=0,this.photoGrid.setChildVeilVisibility(!0),this.photoGrid.toggleBorders(!0),this.photoGrid.toggleEmptyCells(!0),this.photoGrid.scale=this._canvasScale),i},wg.prototype.updateToolVO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;null!==e&&UITools.setToolValue("collage_customize","width",e),null!==t&&UITools.setToolValue("collage_customize","height",t),null!==i&&UITools.setToolValue("collage_customize","spacing",i),null!==r&&UITools.setToolValue("collage_customize","corner_rounding",r),null!==a&&UITools.setToolValue("collage_customize","background_color",a),null!==n&&UITools.setToolValue("collage_customize","lock_aspect_ratio",n),null!==o&&UITools.toggleControlItem("collage_customize_spacing",o),null!==s&&UITools.toggleControlItem("collage_customize_corner_rounding",s),UITools.updateToolControls("collage_customize")},wg.prototype.updateSettings=function(e){var t=UITools.getToolVO("collage_customize");this.photoGrid.contextMenu.hide(),this.photoGrid.gap=t.spacing/100,this.photoGrid.rounding=t.corner_rounding/100,this._gridWidth=t.width,this._gridHeight=t.height,this.longestSide=Math.max(this._gridWidth,this._gridHeight),BFN.CollageMakerCanvasBackground.color=t.background_color,this.updatePhotoGridDisplay(),this.updatePatternBackgroundDisplay(),BFN.ZoomManager.updateZoomRange(),BFN.CollageMakerCanvas.fitCollageToFrame(),BFN.CollageMakerModel.updateProjectVO()},wg.prototype.createPhotoGridSnapshot=function(){if(!BFN.CollageMakerHistoryModel.ignoreSnapshot){this.photoGrid.repair();var e=new BFN.PhotoGridSnapshotVO;e.historyAction=BFN.CollageMakerHistoryModel.historyAction,e.snapshotWidth=this._gridWidth,e.snapshotHeight=this._gridHeight,e.gridWidth=this.photoGrid.itemWidth,e.gridHeight=this.photoGrid.itemHeight,e.rounding=this.photoGrid.rounding,e.gap=this.photoGrid.gap,e.backgroundColor=BFN.CollageMakerCanvasBackground.color,e.backgroundPatternBaseTexture=this.patternBackground.visible?this.patternBackgroundTextureSourceSprite.texture.baseTexture:null;var t=2/BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize*Math.max(this._gridWidth,this._gridHeight),i=this.getScreenCapture(!0,t);if(e.previewTexture=BFN.Util.getThumbTexture(i,Math.min(Math.max(i.width,i.height),BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize),!1,!1),e.thumbTexture=BFN.Util.getThumbTexture(i,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1),i.destroyGC(!0),!BFN.CollageMakerCanvasPhotoGridModel.freeform)for(var r=0;r<this.photoGrid.gridChildren.length;r++){var a=this.photoGrid.gridChildren[r];a.updateRect(),a.updateProjectItemVO();var n=new BFN.PhotoGridSnapshotChildVO;n.rect=a.rect.clone(),n.menuImageVO=a.menuImageVO,a.content.imageEnabled&&!a.content.isEmpty&&a.content.image.frameSprite.texture.valid&&(n.texture=new PIXI.Texture(a.content.image.frameSprite.texture.baseTexture),n.offsetFactorX=a.content.image.frameSprite.offsetFactorX,n.offsetFactorY=a.content.image.frameSprite.offsetFactorY,n.rotate=a.content.image.frameSprite.rotate,n.textureScale=a.content.image.frameSprite.textureScale),e.snapshotChildren.push(n)}BFN.CollageMakerHistoryModel.addPhotoGridSnapshotToHistory(e),BFN.CollageMakerModel.updateProjectVO()}},wg.prototype.createHistoryTransition=function(e){if(this.updateCurrentTransition=!1,this.transitionVO){if(-1==this.uniqueTransitionTags.indexOf(e)&&this.transitionVO.id==e&&this.transitionVO==BFN.TransformStateModel.currentTransition&&this.transitionVO.timestamp==BFN.UndoManager.getTimestamp())return void(this.updateCurrentTransition=!0);this.transitionVO=null}this.transitionVO||(this.transitionVO=new BFN.TransformItemTransitionVO,this.transitionVO.id=e,this.transitionVO.alternateHistoryAction="collage_settings_updated",this.transitionVO.startState.collageSettings.background_color=BFN.CollageMakerCanvasBackground.color,this.transitionVO.startState.collageSettings.spacing=100*this.photoGrid.gap,this.transitionVO.startState.collageSettings.corner_rounding=100*this.photoGrid.rounding,this.transitionVO.startState.collageSettings.width=this._gridWidth,this.transitionVO.startState.collageSettings.height=this._gridHeight,this.transitionVO.startState.collageSettings.backgroundPatternBaseTexture=this.patternBackground.visible?this.patternBackgroundTextureSourceSprite.texture.baseTexture:null)},wg.prototype.registerHistoryTransition=function(){this.photoGrid.repair();var e=this.updateCurrentTransition&&this.transitionVO&&this.transitionVO==BFN.TransformStateModel.currentTransition&&this.transitionVO.timestamp==BFN.UndoManager.getTimestamp();this.transitionVO.previewTexture&&this.transitionVO.previewTexture.destroyGC(!0),this.transitionVO.previewImage=null,this.transitionVO.thumbTexture&&this.transitionVO.thumbTexture.destroyGC(!0),this.transitionVO.thumbImage=null;var t=null;try{var i=2/BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize*Math.max(this._gridWidth,this._gridHeight);t=this.getScreenCapture(!0,i)}catch(e){}try{this.transitionVO.previewTexture=BFN.Util.getThumbTexture(t,Math.min(Math.max(t.width,t.height),BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize),!1,!1)}catch(e){this.transitionVO.previewTexture=null}try{this.transitionVO.thumbTexture=BFN.Util.getThumbTexture(t,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1)}catch(e){this.transitionVO.thumbTexture=null}try{t.destroyGC(!0)}catch(e){}t=null,this.transitionVO.endState.collageSettings.background_color=BFN.CollageMakerCanvasBackground.color,this.transitionVO.endState.collageSettings.spacing=100*this.photoGrid.gap,this.transitionVO.endState.collageSettings.corner_rounding=100*this.photoGrid.rounding,this.transitionVO.endState.collageSettings.width=this._gridWidth,this.transitionVO.endState.collageSettings.height=this._gridHeight,this.transitionVO.endState.collageSettings.backgroundPatternBaseTexture=this.patternBackground.visible?this.patternBackgroundTextureSourceSprite.texture.baseTexture:null,e?BFN.TransformStateModel.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED):BFN.TransformStateModel.addTransition(this.transitionVO),BFN.CollageMakerModel.updateProjectVO()},wg.prototype.applyCurrentTemplate=function(){BFN.CollageMakerCanvasPhotoGridModel.freeform&&BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),BFN.CollageMakerCanvasPhotoGridModel.freeform=!1;for(var e=this.lastTemplate=BFN.CollageMakerTemplateModel.currentTemplate,t=[],i=0;i<this.photoGrid.gridChildren.length&&t.length<e.preset.matrix.items.length;i++){var r=this.photoGrid.gridChildren[i];r.menuImageVO&&!r.content.isEmpty&&t.push(r.menuImageVO)}this.updateToolVO(e.preset.matrix.width,e.preset.matrix.height,e.preset.gap,e.preset.itemRoundness,BFN.CollageMakerCanvasBackground.color,!1,!0,!0),this.preparePhotoGrid(e.preset.matrix.width,e.preset.matrix.height,e.preset.gap/100,e.preset.itemRoundness/100),this._gridWidth=e.preset.matrix.width,this._gridHeight=e.preset.matrix.height,BFN.CollageMakerHistoryModel.ignoreSnapshot=!0;for(var a=0;a<e.preset.matrix.items.length;a++){var n=e.preset.matrix.items[a];if(n&&n.hasOwnProperty("x")&&n.hasOwnProperty("y")&&n.hasOwnProperty("width")&&n.hasOwnProperty("height")){var o=this.photoGrid.addGridChild(n.x,n.y,n.width,n.height);t.length&&(o.menuImageVO=t.shift(),o.content.setImage(o.menuImageVO.imageTexture)),o.updateProjectItemVO()}}t.splice(0),BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this.longestSide=BFN.defaultCollageSize,this.adjustGridSizeToLongestSide(),this.updateSettings(),BFN.CollageMakerHistoryModel.historyAction="new_grid_template",this.photoGrid.getPhotoGridSnapShot(),this.photoGrid.matchesTemplate=!0;var s=null,l=null;if(BFN.CollageMakerTemplateData.templateCategories.forEach(t=>{s||e.categoryID!==t.id||(s=t.name,l=BFN.CollageMakerHistoryModel.snapshotVOs.length?BFN.CollageMakerHistoryModel.snapshotVOs[BFN.CollageMakerHistoryModel.snapshotVOs.length-1]:null)}),s&&l){var h=new BFN.UserActionVO;h.eventID="collage_layout_selected",h.eventObject={templateType:"Constrained",templateCategory:s},h.actionSection="collage",h.actionTimestamp=l.timestamp,h.register()}},wg.prototype.applyFreeformTemplate=function(){BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),BFN.CollageMakerHistoryModel.resetHistory(),BFN.CollageMakerCanvasPhotoGridModel.freeform=!0,this.updateToolVO(BFN.CollageMakerTemplateModel.freeformWidth,BFN.CollageMakerTemplateModel.freeformHeight,0,0,BFN.CollageMakerCanvasBackground.color,!1,!1,!1),this.preparePhotoGrid(BFN.CollageMakerTemplateModel.freeformWidth,BFN.CollageMakerTemplateModel.freeformHeight,0,0),this._gridWidth=BFN.CollageMakerTemplateModel.freeformWidth,this._gridHeight=BFN.CollageMakerTemplateModel.freeformHeight,this.longestSide=BFN.defaultCollageSize,this.adjustGridSizeToLongestSide(),this.updateSettings();var e=new BFN.UserActionVO;e.eventID="collage_layout_selected",e.eventObject={templateType:"Freeform",templateCategory:"Blank"},e.actionSection="collage",e.actionTimestamp=0,e.register()},wg.prototype.applyAutoCollageLayoutObject=function(){var e=BFN.CollageMakerCanvasPhotoGridModel.autoCollageLayoutObject;if(e){this.updateToolVO(e.width,e.height,0,0,BFN.CollageMakerCanvasBackground.color,!1,!BFN.CollageMakerCanvasPhotoGridModel.freeform,!BFN.CollageMakerCanvasPhotoGridModel.freeform),this.preparePhotoGrid(e.width,e.height,0,0),this._gridWidth=e.width,this._gridHeight=e.height;var t=null;if(BFN.CollageMakerCanvasPhotoGridModel.freeform){this.pendingAutoCollageBaseTextures.splice(0);for(var i=0;i<e.data.length;i++){var r=e.data[i].menuImageVO.imageTexture.baseTexture;this.pendingAutoCollageBaseTextures.includes(r)||this.pendingAutoCollageBaseTextures.push(r)}BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),this.pendingAutoCollageBaseTextures.splice(0),this.longestSide=BFN.defaultCollageSize,this.adjustGridSizeToLongestSide(),this.updateSettings(),BFN.TransformStateModel.blockAddedTransitions=!0;for(var a=this.longestSide/Math.max(e.width,e.height),n=0;n<e.data.length;n++){var o=e.data[n],s=o.rect,l=new PIXI.Point(s.x*a,s.y*a),h=new PIXI.Point(s.width*a,s.height*a);BFN.CollageMakerCanvasModel.addedItem={type:"texture",texture:o.menuImageVO.imageTexture,projectItemAssetID:o.menuImageVO.id,initialPosition:l,initialDimensions:h},BFN.BfnService.storeBlobForMenuImageVO(o.menuImageVO,"collage"),BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.selectedTransformItem.preloadThumbnail(5*n+50)}BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.selectedTransformItem.deselectItem(),BFN.TransformStateModel.blockAddedTransitions=!1,BFN.TransformStateModel.clearTransitions()}else{BFN.CollageMakerHistoryModel.ignoreSnapshot=!0;for(var c=0;c<e.data.length;c++){var u=e.data[c],d=u.rect,m=this.photoGrid.addGridChild(d.x,d.y,d.width,d.height);m.menuImageVO=u.menuImageVO,m.content.setImage(m.menuImageVO.imageTexture),m.updateProjectItemVO()}BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this.longestSide=BFN.defaultCollageSize,this.adjustGridSizeToLongestSide(),this.updateSettings(),BFN.CollageMakerHistoryModel.historyAction="collage_wizard",this.photoGrid.getPhotoGridSnapShot(),t=BFN.CollageMakerHistoryModel.snapshotVOs.length?BFN.CollageMakerHistoryModel.snapshotVOs[BFN.CollageMakerHistoryModel.snapshotVOs.length-1]:null}var p=new BFN.UserActionVO;p.eventID="collage_layout_selected",p.eventObject={templateType:BFN.CollageMakerCanvasPhotoGridModel.freeform?"Freeform":"Constrained",templateCategory:"Collage Wizard"},p.actionSection="collage",p.actionTimestamp=!BFN.CollageMakerCanvasPhotoGridModel.freeform&&t?t.timestamp:0,p.register()}},wg.prototype.applyPhotoGridSnapshot=function(){if(BFN.CollageMakerHistoryModel.currentSnapshotVO){this.photoGrid.hideDragBar();var e=BFN.CollageMakerHistoryModel.currentSnapshotVO;if(this.updateToolVO(e.snapshotWidth,e.snapshotHeight,100*e.gap,100*e.rounding,e.backgroundColor),this.preparePhotoGrid(e.gridWidth,e.gridHeight,e.gap,e.rounding),this._gridWidth=e.snapshotWidth,this._gridHeight=e.snapshotHeight,BFN.CollageMakerCanvasBackground.color!=e.backgroundColor&&(BFN.CollageMakerCanvasBackground.color=e.backgroundColor),e.backgroundPatternBaseTexture){var t=new PIXI.Texture(e.backgroundPatternBaseTexture);this.setPatternBackgroundTexture(t),t.destroyGC(!1)}else this.patternBackground.visible&&this.setPatternBackgroundTexture(null);this.photoGrid.backgroundColor==BFN.CollageMakerCanvasBackground.color||this.patternBackground.visible||(this.photoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color),BFN.CollageMakerHistoryModel.ignoreSnapshot=!0;for(var i=0;i<e.snapshotChildren.length;i++){var r=e.snapshotChildren[i],a=this.photoGrid.addGridChild(r.rect.x,r.rect.y,r.rect.width,r.rect.height);a.menuImageVO=r.menuImageVO,r.texture&&r.texture.valid&&a.content.setImage(r.texture),a.content.image.frameSprite.offsetFactorX=r.offsetFactorX,a.content.image.frameSprite.offsetFactorY=r.offsetFactorY,a.content.image.frameSprite.rotate=r.rotate,a.content.image.frameSprite.textureScale=r.textureScale,a.content.image.frameSprite.offsetFactorX=r.offsetFactorX,a.content.image.frameSprite.offsetFactorY=r.offsetFactorY,a.content.image.frameSprite.updateDisplay(),a.updateProjectItemVO()}BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this.updateSettings()}},wg.prototype.applyCollageSettings=function(){if(BFN.CollageMakerCanvasPhotoGridModel.collageSettings){var e=BFN.CollageMakerCanvasPhotoGridModel.collageSettings;if(this.updateToolVO(e.width,e.height,e.spacing,e.corner_rounding,e.background_color),this._gridWidth=e.width,this._gridHeight=e.height,BFN.CollageMakerCanvasBackground.color!=e.background_color&&(BFN.CollageMakerCanvasBackground.color=e.background_color),e.backgroundPatternBaseTexture){var t=new PIXI.Texture(e.backgroundPatternBaseTexture);this.setPatternBackgroundTexture(t),t.destroyGC(!1)}else this.patternBackground.visible&&this.setPatternBackgroundTexture(null);this.photoGrid.backgroundColor==BFN.CollageMakerCanvasBackground.color||this.patternBackground.visible||(this.photoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color),this.updateSettings()}},wg.prototype.handlePhotoGridSnapShot=function(e){this.createPhotoGridSnapshot()},wg.prototype.handleCurrentTemplateUpdated=function(e){if(!this.photoGrid.matchesTemplate||BFN.CollageMakerTemplateModel.currentTemplate!=this.lastTemplate){var t=BFN.CollageMakerCanvasModel.itemsExist;BFN.CollageMakerCanvasPhotoGridModel.freeform&&t?BeFunky.confirm("confirm_template_mode_change",{onConfirm:this.applyCurrentTemplate.bind(this)}):this.applyCurrentTemplate()}},wg.prototype.handleFreeformTemplate=function(){var e=BFN.CollageMakerCanvasModel.itemsExist||!this.photoGrid.isEmpty;BFN.CollageMakerCanvasPhotoGridModel.freeform?console.log("ALREADY IN FREEFORM MODE"):e?BeFunky.confirm("confirm_template_mode_change",{onConfirm:this.applyFreeformTemplate.bind(this)}):this.applyFreeformTemplate()},wg.prototype.handleAutoCollageLayoutObject=function(e){this.applyAutoCollageLayoutObject()},wg.prototype.handleApplyCurrentSnapShot=function(e){this.applyPhotoGridSnapshot()},wg.prototype.handleCollageSettingsUpdated=function(e){this.applyCollageSettings()},wg.prototype.handleClearAll=function(e){BFN.CollageMakerCanvasPhotoGridModel.freeform?(this.resetBackground(),this.applyFreeformTemplate()):(this.photoGrid.removeAllGridChildren(),BFN.CollageMakerHistoryModel.resetHistory(),this.initInitialTemplate())},Object.defineProperty(wg.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.patternBackground.smoothScale=this._canvasScale,this.photoGrid.scale=this._canvasScale},get:function(){return this._canvasScale}}),Object.defineProperty(wg.prototype,"gridWidth",{get:function(){return this._gridWidth}}),Object.defineProperty(wg.prototype,"gridHeight",{get:function(){return this._gridHeight}}),BFN.SingletonQueue.add(function(){BFN.CollageMakerCanvasPhotoGrid=new wg}),kg.prototype=Object.create(PIXI.Sprite.prototype),kg.prototype.init=function(){BeFunky.log("CollageMakerCanvas Init"),this.initDefaultValues(),this.initCheckerPanel(),this.initCanvas(),this.initBackground(),this.initPhotoGrid(),this.initTransformLayer(),this.initTransformLayerVeil(),this.initCanvasScaleBars(),this.initTransformIndicatorContainer(),this.initTransformGuidesContainer(),this.initTransformItemBoundingBoxesContainer(),this.initTransformTool(),this.initTransformToolSnapGaps(),this.initTransformItemIsolator(),this.initLayerToolContainer(),this.initMoveTouchSurface(),this.initCanvasDragger(),this.initAnimators(),setTimeout(function(){this.updateLayout(),this.updateCanvasView(),this.updateDisplay()}.bind(this),0)},kg.prototype.initDefaultValues=function(){this.interactive=!0,this.mouseOver=!1,this.model=BFN.CollageMakerCanvasModel,BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME.type,this.handleFitCollageToFrame.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME_ANIMATED.type,this.handleFitCollageToFrameAnimated.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.ITEM_ADDED.type,this.handleItemAdded.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS.type,this.handleClearItems.bind(this)),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.GRID_SIZE_CHANGED.type,this.handleGridSizeChanged.bind(this)),this.on("pointerover",this.handleCanvasMouseOver.bind(this)),this.on("pointerout",this.handleCanvasMouseOut.bind(this)),this.handleCanvasKeyDownBind=this.handleCanvasKeyDown.bind(this),this.handleCanvasSpaceKeyUpBind=this.handleCanvasSpaceKeyUp.bind(this),document.addEventListener("keydown",this.handleCanvasKeyDownBind,!1)},kg.prototype.initCheckerPanel=function(){this.checkerPanel=new BFN.CheckerPanel,this.checkerPanel.setDimensions(0,0),this.addChild(this.checkerPanel)},kg.prototype.initCanvas=function(){this.canvasContainer=new PIXI.Sprite,this.canvasContainer.interactive=!0,this.addChild(this.canvasContainer),this.canvas=new PIXI.Sprite,this.canvasContainer.addChild(this.canvas)},kg.prototype.initBackground=function(){this.background=BFN.CollageMakerCanvasBackground,this.canvas.addChild(this.background)},kg.prototype.initPhotoGrid=function(){this.canvasPhotoGrid=BFN.CollageMakerCanvasPhotoGrid,this.canvasPhotoGrid.addEventListener(BFN.CollageMakerCanvasPhotoGridEvents.RESIZING_COMPLETE.type,this.handleCanvasPhotoGridResizingComplete.bind(this)),this.canvas.addChild(this.canvasPhotoGrid)},kg.prototype.initTransformLayer=function(){this.transformLayerContainer=new PIXI.Container,this.canvas.addChild(this.transformLayerContainer),this.transformLayer=new BFN.TransformLayer(BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,this),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,this.handleTransformItemsUpdated.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_SELECTED.type,this.handleTransformItemSelected.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED.type,this.handleTransformItemDisplayUpdated.bind(this)),this.transformLayerContainer.addChild(this.transformLayer)},kg.prototype.initTransformLayerVeil=function(){this.transformLayerVeil=new BFN.CanvasFrame(BFN.AppBackgroundColor,1,BFN.CollageMakerCanvasModel.collageFitPaddingX,BFN.CollageMakerCanvasModel.collageFitPaddingY),this.addChild(this.transformLayerVeil)},kg.prototype.initCanvasScaleBars=function(){this.canvasScaleBars=new BFN.CanvasScaleBars(BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER),this.canvasScaleBars.minSize=BFN.minCollageSize,this.canvasScaleBars.addEventListener(BFN.CanvasScaleBarsEvents.SCALING_STARTED.type,this.handleCanvasScaleBarsScalingStarted.bind(this)),this.canvasScaleBars.addEventListener(BFN.CanvasScaleBarsEvents.SCALING_COMPLETE.type,this.handleCanvasScaleBarsScalingComplete.bind(this)),this.canvasScaleBars.addEventListener(BFN.CanvasScaleBarsEvents.DIMENSIONS_UPDATED.type,this.handleCanvasScaleBarsDimensionsUpdated.bind(this)),this.canvasScaleBars.addEventListener(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.type,this.handleCanvasScaleBarsScaleBarAction.bind(this)),this.addChild(this.canvasScaleBars)},kg.prototype.initTransformIndicatorContainer=function(){this.transformIndicatorContainer=new PIXI.Container,this.transformIndicatorContainer.interactiveChildren=!1,this.addChild(this.transformIndicatorContainer)},kg.prototype.initTransformGuidesContainer=function(){this.transformGuidesContainer=new PIXI.Container,this.addChild(this.transformGuidesContainer)},kg.prototype.initTransformItemBoundingBoxesContainer=function(){this.transformItemBoundingBoxesContainer=new PIXI.Container,this.addChild(this.transformItemBoundingBoxesContainer)},kg.prototype.initTransformTool=function(){this.transformTool=new BFN.TransformTool(this.transformLayer),this.addChild(this.transformTool),this.transformLayer.transformTool=this.transformTool},kg.prototype.initTransformToolSnapGaps=function(){this.transformToolSnapGapsContainer=new PIXI.Container,this.canvasContainer.addChild(this.transformToolSnapGapsContainer)},kg.prototype.initTransformItemIsolator=function(){this.transformItemIsolatorContainer=new PIXI.Container,this.canvasContainer.addChild(this.transformItemIsolatorContainer)},kg.prototype.initLayerToolContainer=function(){this.layerToolContainer=new PIXI.Container,this.addChild(this.layerToolContainer)},kg.prototype.initMoveTouchSurface=function(){this.moveTouchSurface=new PIXI.Graphics,this.moveTouchSurface.interactive=!0,this.moveTouchSurface.visible=!1,this.moveTouchSurface.beginFill(0,0),this.moveTouchSurface.drawRect(-50,-50,100,100),this.moveTouchSurface.endFill(),this.moveTouchSurface.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.moveTouchSurface.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.moveTouchSurface.on("pointerdown",this.handleMoveTouchSurfacePressed.bind(this)),this.addChild(this.moveTouchSurface)},kg.prototype.initCanvasDragger=function(){this.canvasDragger=new BFN.Dragger,this.canvasDragger.pixelDragThreshold=5,this.canvasDragger.pixelDragThresholdPreventEvent=!0,this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasDraggerDraggingComplete.bind(this))},kg.prototype.initAnimators=function(){this.fitCollageAnimator=new BFN.Animator,this.fitCollageAnimator.linearSteps=10,this.fitCollageAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFitCollageAnimatorUpdate.bind(this)),this.fitCollageAnimator.addEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleFitCollageAnimatorUpdateComplete.bind(this))},kg.prototype.handleCustomize=function(){this.canvasPhotoGrid.handleCustomize()},kg.prototype.handleCollageImage=function(){this.canvasPhotoGrid.handleCollageImage()},kg.prototype.updateLayout=function(){this.canvas.x=-this.canvasPhotoGrid.gridWidth/2,this.canvas.y=-this.canvasPhotoGrid.gridHeight/2,this.background.itemWidth=this.canvasPhotoGrid.gridWidth,this.background.itemHeight=this.canvasPhotoGrid.gridHeight,this.canvasScaleBars.canvasWidth=this.canvasPhotoGrid.gridWidth,this.canvasScaleBars.canvasHeight=this.canvasPhotoGrid.gridHeight,this.canvasPhotoGrid.x=-this.canvas.x,this.canvasPhotoGrid.y=-this.canvas.y,this.transformLayer.x=-this.canvas.x,this.transformLayer.y=-this.canvas.y},kg.prototype.updateCanvasContainerDisplay=function(){var e=2*BFN.CollageMakerCanvasModel.collageFitPaddingX,t=2*BFN.CollageMakerCanvasModel.collageFitPaddingY,i=this.canvasPhotoGrid.gridWidth,r=this.canvasPhotoGrid.gridHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(i-=(i-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,r-=(r-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),BFN.PhotoEditorCanvasTools.currentTool&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemWidth")&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemHeight")&&(i=BFN.PhotoEditorCanvasTools.currentTool.itemWidth,r=BFN.PhotoEditorCanvasTools.currentTool.itemHeight);var a=this.scale.x*i,n=this.scale.y*r,o=Math.max(0,i-BFN.StageModel.stageW/a*i+1/this.scale.x*e),s=Math.max(0,r-BFN.StageModel.stageH/n*r+1/this.scale.y*t);this.canvasDragger.setBounds(-o/2,-s/2,o/2,s/2),this.canvasContainer.x=Math.round(Math.min(this.canvasDragger.bounds.maxX,Math.max(this.canvasDragger.bounds.minX,this.canvasContainer.x))),this.canvasContainer.y=Math.round(Math.min(this.canvasDragger.bounds.maxY,Math.max(this.canvasDragger.bounds.minY,this.canvasContainer.y))),this.layerToolContainer.x=this.canvasContainer.x,this.layerToolContainer.y=this.canvasContainer.y,this.transformItemBoundingBoxesContainer.x=this.canvasContainer.x,this.transformItemBoundingBoxesContainer.y=this.canvasContainer.y,this.canvasScaleBars.x=this.canvasContainer.x,this.canvasScaleBars.y=this.canvasContainer.y,this.updateCheckerPanel(),this.updateTransformLayerVeil(),this.updateToolPosition(),BFN.TransformGuides.updateDisplay(),BFN.MainUI.requestRender()},kg.prototype.updateToolPosition=function(){this.transformTool.x=this.transformLayerVeil.x=this.canvasContainer.x,this.transformTool.y=this.transformLayerVeil.y=this.canvasContainer.y},kg.prototype.updateDisplay=function(){this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},kg.prototype.updateCanvasView=function(){this.updateTransformLayerVeil(),BFN.ZoomManager.updateZoomRange(),BFN.MainUI&&BFN.MainUI.requestRender()},kg.prototype.updatePosition=function(){this.x=Math.round(BFN.StageModel.stageW/2),this.y=Math.round(BFN.StageModel.stageH/2),this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.updateTransformLayerVeilOuterDimensions(),this.updateCanvasContainerDisplay()},kg.prototype.updateScale=function(){this.scale.x=this.scale.y=this.transformLayer.canvasScale=this.transformTool.scale=this.canvasDragger.scale=BFN.CollageMakerCanvasModel.canvasScale,this.transformItemBoundingBoxesContainer.children.includes(BFN.TransformItemBoundingBoxes)&&(BFN.TransformItemBoundingBoxes.lineScale=BFN.CollageMakerCanvasModel.canvasScale),this.transformGuidesContainer.scale.x=1/this.scale.x,this.transformGuidesContainer.scale.y=1/this.scale.y,this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.layerToolContainer.children.includes(BFN.PhotoEditorCanvasTools)&&(BFN.PhotoEditorCanvasTools.scale=BFN.CollageMakerCanvasModel.canvasScale),this.canvasPhotoGrid.canvasScale=BFN.CollageMakerCanvasModel.canvasScale,this.canvasScaleBars.canvasScale=BFN.CollageMakerCanvasModel.canvasScale,this.transformLayerVeil.canvasScale=BFN.CollageMakerCanvasModel.canvasScale,this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},kg.prototype.fitCollageToFrame=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=2*BFN.CollageMakerCanvasModel.collageFitPaddingX,i=2*BFN.CollageMakerCanvasModel.collageFitPaddingY,r=this.canvasPhotoGrid.gridWidth,a=this.canvasPhotoGrid.gridHeight;BFN.TransformItemIsolator.active&&(r=BFN.TransformItemIsolator.itemWidth,a=BFN.TransformItemIsolator.itemHeight),r<=0||a<=0||(this.fitScale=Math.min(1,(BFN.StageModel.stageW-t)/r,(BFN.StageModel.stageH-i)/a),e?(BFN.CollageMakerCanvasModel.canvasScaling=!0,BFN.CollageMakerCanvasModel.disregardScaleRange=!0,BFN.CollageMakerCanvasModel.canvasScale/=this.canvasPhotoGrid.adjustmentScaleFactor,this.startScale=BFN.CollageMakerCanvasModel.canvasScale,Math.abs(this.fitScale-this.startScale)>.001?this.fitCollageAnimator.setAnimatorFactor(0):this.fitCollageAnimator.setAnimatorFactor(1),this.fitCollageAnimator.increase()):(BFN.CollageMakerCanvasModel.canvasScale=this.fitScale,BFN.CollageMakerCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()))},kg.prototype.updateCheckerPanel=function(){this.checkerPanel.x=this.canvasContainer.x,this.checkerPanel.y=this.canvasContainer.y,this.checkerPanel.scale=BFN.CollageMakerCanvasModel.canvasScale;var e={x:0,y:0};if(this.canvasPhotoGrid.gridWidth>1&&this.canvasPhotoGrid.gridHeight>1&&(e.x=this.canvasPhotoGrid.gridWidth,e.y=this.canvasPhotoGrid.gridHeight),BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)){var t=BFN.TransformItemIsolator.itemWidth,i=BFN.TransformItemIsolator.itemHeight;BFN.TransformItemIsolator.shiftAnimator.animating&&(t=BFN.TransformItemIsolator.shiftParamsEnd.w-(BFN.TransformItemIsolator.shiftParamsEnd.w-BFN.TransformItemIsolator.shiftParamsStart.w)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor),i=BFN.TransformItemIsolator.shiftParamsEnd.h-(BFN.TransformItemIsolator.shiftParamsEnd.h-BFN.TransformItemIsolator.shiftParamsStart.h)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor)),e.x=e.x-(e.x-t)*BFN.TransformItemIsolator.activeFactor,e.y=e.y-(e.y-i)*BFN.TransformItemIsolator.activeFactor}this.checkerPanel.setDimensions(e.x,e.y)},kg.prototype.updateTransformLayerVeil=function(){this.transformLayer.frameWidth=this.canvasPhotoGrid.gridWidth,this.transformLayer.frameHeight=this.canvasPhotoGrid.gridHeight,this.transformTool.frameWidth=this.canvasPhotoGrid.gridWidth,this.transformTool.frameHeight=this.canvasPhotoGrid.gridHeight;var e=this.transformLayer.frameWidth,t=this.transformLayer.frameHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(e=this.transformLayer.frameWidth-(this.transformLayer.frameWidth-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,t=this.transformLayer.frameHeight-(this.transformLayer.frameHeight-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),this.moveTouchSurface.scale.x=e/100,this.moveTouchSurface.scale.y=t/100,this.drawTransformLayerVeil(e,t)},kg.prototype.updateTransformLayerVeilOuterDimensions=function(){this.transformLayerVeil.setOuterDimensions(BFN.StageModel.stageW+20,BFN.StageModel.stageH+2)},kg.prototype.drawTransformLayerVeil=function(e,t){e=Math.round(e),t=Math.round(t),this.transformLayerVeil.setInnerDimensions(e,t)},kg.prototype.getFlattenedImage=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.canvasPhotoGrid.getScreenCapture(e);return this.transformLayer.itemsExist&&(this.transformLayerContainer.removeChild(this.transformLayer),this.transformLayer.toggleHiResTextDisplay(!1),this.transformLayer.toggleItemScaleSmoothing(!1),this.transformLayer.setItemScaleMode(PIXI.SCALE_MODES.NEAREST,["text"]),BFN.Stage.render(this.transformLayer,t,!1),this.transformLayer.toggleHiResTextDisplay(!0),this.transformLayer.toggleItemScaleSmoothing(!0),this.transformLayer.setItemScaleMode(PIXI.SCALE_MODES.LINEAR,["text"]),this.transformLayerContainer.addChild(this.transformLayer)),t},kg.prototype.handleStageDimensionsUpdated=function(){this.updatePosition()},kg.prototype.handleCanvasScaleUpdated=function(){this.updateScale()},kg.prototype.handleFitCollageToFrame=function(){this.fitCollageToFrame()},kg.prototype.handleFitCollageToFrameAnimated=function(){this.fitCollageToFrame(!0)},kg.prototype.handleItemAdded=function(){BFN.CollageMakerCanvasModel.addedItem&&(BFN.GlobalHistoryModel.updateGlobalHistoryMenuState(),this.transformLayer.addItem(BFN.CollageMakerCanvasModel.addedItem),BFN.CollageMakerCanvasModel.addedItem=null)},kg.prototype.handleClearItems=function(){this.transformLayer.destroyAllItems(),BFN.TransformStateModel.clearTransitions()},kg.prototype.handleGridSizeChanged=function(){this.updateLayout(),this.updateCanvasContainerDisplay(),this.transformLayer.frameWidth=this.canvasPhotoGrid.gridWidth,this.transformLayer.frameHeight=this.canvasPhotoGrid.gridHeight,this.updateTransformLayerVeil()},kg.prototype.handleCanvasPhotoGridResizingComplete=function(e){this.fitCollageToFrame(!0)},kg.prototype.handleCanvasScaleBarsScalingStarted=function(e){this.canvasPhotoGrid.manualGridResize=!0},kg.prototype.handleCanvasScaleBarsScalingComplete=function(e){UITools.setToolValue("collage_customize","width",this.canvasScaleBars.canvasWidth,!1),UITools.setToolValue("collage_customize","height",this.canvasScaleBars.canvasHeight,!1),UITools.updateToolControls("collage_customize"),UITools.applyTool("collage_customize")},kg.prototype.handleCanvasScaleBarsDimensionsUpdated=function(e){UITools.setToolValue("collage_customize","width",this.canvasScaleBars.canvasWidth,!0),UITools.setToolValue("collage_customize","height",this.canvasScaleBars.canvasHeight,!0),UITools.updateToolControls("collage_customize"),UITools.applyTool("collage_customize")},kg.prototype.handleCanvasScaleBarsScaleBarAction=function(e){var t=e.data.id;switch(e.data.action){case"over":BFN.PhotoGrid.showEdgeIndicators("topLeft"==t||"left"==t||"bottomLeft"==t?1:0,"topLeft"==t||"top"==t||"topRight"==t?1:0,"topRight"==t||"right"==t||"bottomRight"==t?1:0,"bottomRight"==t||"bottom"==t||"bottomLeft"==t?1:0);break;case"out":t||BFN.PhotoGrid.showEdgeIndicators();break;case"press":BFN.PhotoGrid.showEdgeIndicators("topLeft"==t||"left"==t||"bottomLeft"==t?2:0,"topLeft"==t||"top"==t||"topRight"==t?2:0,"topRight"==t||"right"==t||"bottomRight"==t?2:0,"bottomRight"==t||"bottom"==t||"bottomLeft"==t?2:0);break;case"release":t?BFN.PhotoGrid.showEdgeIndicators("topLeft"==t||"left"==t||"bottomLeft"==t?1:0,"topLeft"==t||"top"==t||"topRight"==t?1:0,"topRight"==t||"right"==t||"bottomRight"==t?1:0,"bottomRight"==t||"bottom"==t||"bottomLeft"==t?1:0):BFN.PhotoGrid.showEdgeIndicators()}},kg.prototype.handleTransformItemsUpdated=function(){var e=this.transformLayer.itemsExist;BFN.CollageMakerCanvasModel.itemsExist!=e&&(BFN.CollageMakerCanvasModel.itemsExist=e)},kg.prototype.handleTransformItemSelected=function(){this.transformLayer.selectedItem?(this.transformTool.selectItem(this.transformLayer.selectedItem),BFN.TransformModel.selectedTransformItem!=this.transformLayer.selectedItem&&(BFN.TransformModel.selectedTransformItem=this.transformLayer.selectedItem)):(this.transformTool.deselectItem(),BFN.TransformModel.selectedTransformItem=null)},kg.prototype.handleTransformItemDisplayUpdated=function(){this.transformTool.updateDisplay()},kg.prototype.handleHoverSurfaceOver=function(e){setTimeout(function(){this.hoverSurfaceOver=!0,BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"grab"}.bind(this),0)},kg.prototype.handleHoverSurfaceOut=function(e){this.hoverSurfaceOver=!1,BFN.CursorScreen&&(BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"auto")},kg.prototype.handleMoveTouchSurfacePressed=function(e){e.stopPropagation(),this.canvasDragger.drag(this.canvasContainer)},kg.prototype.handleCanvasMouseOver=function(e){this.mouseOver=!0},kg.prototype.handleCanvasMouseOut=function(e){this.mouseOver=!1},kg.prototype.handleCanvasKeyDown=function(e){BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||32!=e.keyCode||this.moveTouchSurface.visible||(BFN.PIXITicker.nudge(),document.addEventListener("keyup",this.handleCanvasSpaceKeyUpBind,!1),this.moveTouchSurface.visible=!0,BFN.MainUI.requestRender(),e.preventDefault())},kg.prototype.handleCanvasSpaceKeyUp=function(e){this.handleHoverSurfaceOut(),document.removeEventListener("keyup",this.handleCanvasSpaceKeyUpBind),this.moveTouchSurface.visible=!1,BFN.MainUI.requestRender(),BFN.PIXITicker.nudge()},kg.prototype.handleCanvasDraggerDragging=function(){this.updateCanvasContainerDisplay(),BFN.TransformModel.selectedTransformItem&&"group"===BFN.TransformModel.selectedTransformItem.type&&BFN.TransformModel.selectedTransformItem.updateGroupTransform()},kg.prototype.handleCanvasDraggerDraggingComplete=function(){BeFunky.log("DRAGGING CANVAS COMPLETED")},kg.prototype.handleFitCollageAnimatorUpdate=function(){BFN.CollageMakerCanvasModel.canvasScale=(this.fitScale-this.startScale)*this.fitCollageAnimator.animationSinFactor+this.startScale},kg.prototype.handleFitCollageAnimatorUpdateComplete=function(){BFN.CollageMakerCanvasModel.canvasScaling=!1,BFN.CollageMakerCanvasModel.disregardScaleRange=!1,BFN.ZoomManager.updateZoomRange()},BFN.SingletonQueue.add(function(){BFN.CollageMakerCanvas=new kg}),Lg.prototype=Object.create(PIXI.Sprite.prototype),Lg.prototype.init=function(){BeFunky.log("CollageMaker Init"),this.initDefaultValues(),this.initCanvas()},Lg.prototype.initDefaultValues=function(){BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this))},Lg.prototype.initCanvas=function(){this.addChild(BFN.CollageMakerCanvas)},Lg.prototype.handleAppReady=function(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIPressed.bind(this))},Lg.prototype.handleMainUIPressed=function(e){if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&!BFN.ColorPickerPanel.colorButton&&!BeFunky.isLoadScreenActive()&&BFN.TransformModel.selectedTransformItem){var t=e.data.canvasPressed,i=e.data.originalEvent,r=!(t&&(i.ctrlKey||i.metaKey||i.altKey));BFN.CollageMakerCanvas.transformLayer.deselectItem(r,i.shiftKey)}},BFN.SingletonQueue.add(function(){BFN.CollageMaker=new Lg}),Og.prototype=Object.create(PIXI.Container.prototype),Og.prototype.init=function(){BeFunky.log("DesignerCanvasBackground Init"),this.initDefaultValues(),this.initBackgroundGraphic(),this.updateDisplay()},Og.prototype.initDefaultValues=function(){this.interactive=!0,this._itemWidth=340,this._itemHeight=340,this._color=UITools.getToolValue("collage_customize","background_color"),this.updateDisplayQueued=!1},Og.prototype.initBackgroundGraphic=function(){this.backgroundGraphic=new PIXI.Graphics,this.addChild(this.backgroundGraphic)},Og.prototype.queueUpdateDisplay=function(){this.updateDisplayQueued||(this.updateDisplayQueued=!0,setTimeout(function(){this.updateDisplayQueued=!1,this.updateDisplay()}.bind(this),0))},Og.prototype.updateDisplay=function(){this.backgroundGraphic.clear(),-1!=this._color&&this._itemWidth>0&&this._itemHeight>0&&(this.backgroundGraphic.beginFill(parseInt("0x"+this._color)),this.backgroundGraphic.drawRect(0,0,this._itemWidth,this._itemHeight),this.backgroundGraphic.endFill());try{BFN.MainUI.requestRender()}catch(e){}},Object.defineProperty(Og.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateDisplay()},get:function(){return this._itemWidth}}),Object.defineProperty(Og.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateDisplay()},get:function(){return this._itemHeight}}),Object.defineProperty(Og.prototype,"color",{set:function(e){this._color=e,this.updateDisplay()},get:function(){return this._color}}),BFN.SingletonQueue.add(function(){BFN.DesignerCanvasBackground=new Og}),Rg.prototype=Object.create(PIXI.Sprite.prototype),Rg.prototype.init=function(){BeFunky.log("DesignerCanvas Init"),this.initDefaultValues(),this.initCheckerPanel(),this.initCanvas(),this.initBackground(),this.initTransformLayer(),this.initTransformLayerVeil(),this.initTransformIndicatorContainer(),this.initTransformGuidesContainer(),this.initTransformItemBoundingBoxesContainer(),this.initTransformTool(),this.initTransformToolSnapGaps(),this.initTransformItemIsolator(),this.initLayerToolContainer(),this.initMoveTouchSurface(),this.initCanvasDragger(),this.initAnimators(),setTimeout(()=>{this.setSize(1,1),BFN.ZoomManager.updateZoomRange()},0)},Rg.prototype.initDefaultValues=function(){this.interactive=!0,this.mouseOver=!1,this._canvasWidth=20,this._canvasHeight=20,this.customizePending=!1,this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this),this.updateCurrentTransition=!1,this.transitionVO=null,this.transitionUpdating=!1,this.uniqueTransitionTags=["background_color","resize_template"],this.fitToFrameAfterResize=!1,this.dimensionsLabel=document.getElementById("designer_settings_dimensions"),this.model=BFN.DesignerCanvasModel,BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME.type,this.handleFitDesignerToFrame.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME_ANIMATED.type,this.handleFitDesignerToFrameAnimated.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.ITEM_ADDED.type,this.handleItemAdded.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CLEAR_ITEMS.type,this.handleClearItems.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.DESIGNER_SETTINGS_UPDATED.type,this.handleDesignerSettingsUpdated.bind(this)),this.on("pointerover",this.handleCanvasMouseOver.bind(this)),this.on("pointerout",this.handleCanvasMouseOut.bind(this)),this.handleCanvasKeyDownBind=this.handleCanvasKeyDown.bind(this),this.handleCanvasSpaceKeyUpBind=this.handleCanvasSpaceKeyUp.bind(this),document.addEventListener("keydown",this.handleCanvasKeyDownBind,!1)},Rg.prototype.initCheckerPanel=function(){this.checkerPanel=new BFN.CheckerPanel,this.checkerPanel.setDimensions(0,0),this.addChild(this.checkerPanel)},Rg.prototype.initCanvas=function(){this.canvasContainer=new PIXI.Sprite,this.canvasContainer.interactive=!0,this.addChild(this.canvasContainer),this.canvas=new PIXI.Sprite,this.canvasContainer.addChild(this.canvas)},Rg.prototype.initBackground=function(){this.background=BFN.DesignerCanvasBackground,this.canvas.addChild(this.background)},Rg.prototype.initTransformLayer=function(){this.transformLayerContainer=new PIXI.Container,this.canvas.addChild(this.transformLayerContainer),this.transformLayer=new BFN.TransformLayer(BFN.AppModelViewStates.VIEWING_DESIGNER,this),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,this.handleTransformItemsUpdated.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_SELECTED.type,this.handleTransformItemSelected.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED.type,this.handleTransformItemDisplayUpdated.bind(this)),this.transformLayerContainer.addChild(this.transformLayer)},Rg.prototype.initTransformLayerVeil=function(){this.transformLayerVeil=new BFN.CanvasFrame(BFN.AppBackgroundColor,1,BFN.DesignerCanvasModel.designerFitPaddingX,BFN.DesignerCanvasModel.designerFitPaddingY),this.addChild(this.transformLayerVeil)},Rg.prototype.initTransformIndicatorContainer=function(){this.transformIndicatorContainer=new PIXI.Container,this.transformIndicatorContainer.interactiveChildren=!1,this.addChild(this.transformIndicatorContainer)},Rg.prototype.initTransformGuidesContainer=function(){this.transformGuidesContainer=new PIXI.Container,this.addChild(this.transformGuidesContainer)},Rg.prototype.initTransformItemBoundingBoxesContainer=function(){this.transformItemBoundingBoxesContainer=new PIXI.Container,this.addChild(this.transformItemBoundingBoxesContainer)},Rg.prototype.initTransformTool=function(){this.transformTool=new BFN.TransformTool(this.transformLayer),this.addChild(this.transformTool),this.transformLayer.transformTool=this.transformTool},Rg.prototype.initTransformToolSnapGaps=function(){this.transformToolSnapGapsContainer=new PIXI.Container,this.canvasContainer.addChild(this.transformToolSnapGapsContainer)},Rg.prototype.initTransformItemIsolator=function(){this.transformItemIsolatorContainer=new PIXI.Container,this.canvasContainer.addChild(this.transformItemIsolatorContainer)},Rg.prototype.initLayerToolContainer=function(){this.layerToolContainer=new PIXI.Container,this.addChild(this.layerToolContainer)},Rg.prototype.initMoveTouchSurface=function(){this.moveTouchSurface=new PIXI.Graphics,this.moveTouchSurface.interactive=!0,this.moveTouchSurface.visible=!1,this.moveTouchSurface.beginFill(0,0),this.moveTouchSurface.drawRect(-50,-50,100,100),this.moveTouchSurface.endFill(),this.moveTouchSurface.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.moveTouchSurface.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.moveTouchSurface.on("pointerdown",this.handleMoveTouchSurfacePressed.bind(this)),this.addChild(this.moveTouchSurface)},Rg.prototype.initCanvasDragger=function(){this.canvasDragger=new BFN.Dragger,this.canvasDragger.pixelDragThreshold=5,this.canvasDragger.pixelDragThresholdPreventEvent=!0,this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasDraggerDraggingComplete.bind(this))},Rg.prototype.initAnimators=function(){this.fitDesignerAnimator=new BFN.Animator,this.fitDesignerAnimator.linearSteps=10,this.fitDesignerAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFitDesignerAnimatorUpdate.bind(this)),this.fitDesignerAnimator.addEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleFitDesignerAnimatorUpdateComplete.bind(this))},Rg.prototype.handleCustomize=function(){this.customizePending||(this.customizePending=!0,BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)),BFN.MainUI.requestRender()},Rg.prototype.handleMainUIPreRender=function(){if(this.customizePending){this.customizePending=!1,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind);var e=UITools.getToolVO("collage_customize");if(!this.transitionUpdating){this.transitionUpdating=!0;var t="settings";switch(e.updating_id){case"background_color":t=-1==e.background_color?"background_transparent":"background_color";break;case"width":case"height":t="resize_template"}this.createHistoryTransition(t)}if(BFN.DesignerCanvasBackground.color!=e.background_color&&(BFN.DesignerCanvasBackground.color=e.background_color),["width","height"].includes(e.updating_id)&&(this._canvasWidth!=e.width||this._canvasHeight!=e.height)){if(e.smart_resize){var i=BFN.TransformLayerManager.smartResizeLayers(e.width,e.height);i&&(this.transitionVO.batchIDPlaceholder=i,this.transitionVO.isSettingsTransition=!0)}this.setSize(e.width,e.height),UITools.setToolValue("collage_customize","width",BFN.CollageMakerCanvas.canvasPhotoGrid.gridWidth),UITools.setToolValue("collage_customize","height",BFN.CollageMakerCanvas.canvasPhotoGrid.gridHeight),UITools.updateToolControls("collage_customize"),this.fitToFrameAfterResize&&(this.fitToFrameAfterResize=!1,this.fitDesignerToFrame(!0))}!e.updating&&this.transitionUpdating&&(this.transitionUpdating=!1,this.registerHistoryTransition())}},Rg.prototype.createHistoryTransition=function(e){if(this.updateCurrentTransition=!1,this.transitionVO){if(-1==this.uniqueTransitionTags.indexOf(e)&&this.transitionVO.id==e&&this.transitionVO==BFN.TransformStateModel.currentTransition&&this.transitionVO.timestamp==BFN.UndoManager.getTimestamp())return void(this.updateCurrentTransition=!0);this.transitionVO=null}this.transitionVO||(this.transitionVO=new BFN.TransformItemTransitionVO,this.transitionVO.id=e,this.transitionVO.alternateHistoryAction="designer_settings_updated",this.transitionVO.startState.designerSettings.background_color=BFN.DesignerCanvasBackground.color,this.transitionVO.startState.designerSettings.width=this._canvasWidth,this.transitionVO.startState.designerSettings.height=this._canvasHeight)},Rg.prototype.registerHistoryTransition=function(){var e=this.updateCurrentTransition&&this.transitionVO&&this.transitionVO==BFN.TransformStateModel.currentTransition&&this.transitionVO.timestamp==BFN.UndoManager.getTimestamp(),t=this.getFlattenedImage();this.transitionVO.previewTexture&&this.transitionVO.previewTexture.destroyGC(!0),this.transitionVO.previewImage=null,this.transitionVO.thumbTexture&&this.transitionVO.thumbTexture.destroyGC(!0),this.transitionVO.thumbImage=null,this.transitionVO.previewTexture=BFN.Util.getThumbTexture(t,Math.min(Math.max(t.width,t.height),BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize),!1,!1),this.transitionVO.thumbTexture=BFN.Util.getThumbTexture(t,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1),t.destroyGC(!0),t=null,this.transitionVO.endState.designerSettings.background_color=BFN.DesignerCanvasBackground.color,this.transitionVO.endState.designerSettings.width=this._canvasWidth,this.transitionVO.endState.designerSettings.height=this._canvasHeight,e?BFN.TransformStateModel.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED):BFN.TransformStateModel.addTransition(this.transitionVO),BFN.DesignerModel.updateProjectVO(!1)},Rg.prototype.setSize=function(e,t){this._canvasWidth=this.background.itemWidth=e,this._canvasHeight=this.background.itemHeight=t,this.dimensionsLabel.innerHTML="".concat(this._canvasWidth," × ").concat(this._canvasHeight,'<span style="padding-left: 2px;">px</span>'),BFN.ZoomManager.updateZoomRange(),this.updateDisplay()},Rg.prototype.updateCanvasContainerDisplay=function(){this.visible=this._canvasWidth>1&&this._canvasHeight>1;var e=2*BFN.DesignerCanvasModel.designerFitPaddingX,t=2*BFN.DesignerCanvasModel.designerFitPaddingY,i=this._canvasWidth,r=this._canvasHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(i-=(i-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,r-=(r-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),BFN.PhotoEditorCanvasTools.currentTool&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemWidth")&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemHeight")&&(i=BFN.PhotoEditorCanvasTools.currentTool.itemWidth,r=BFN.PhotoEditorCanvasTools.currentTool.itemHeight);var a=this.scale.x*i,n=this.scale.y*r,o=Math.max(0,i-BFN.StageModel.stageW/a*i+1/this.scale.x*e),s=Math.max(0,r-BFN.StageModel.stageH/n*r+1/this.scale.y*t);this.canvasDragger.setBounds(-o/2,-s/2,o/2,s/2),this.canvasContainer.x=Math.round(Math.min(this.canvasDragger.bounds.maxX,Math.max(this.canvasDragger.bounds.minX,this.canvasContainer.x))),this.canvasContainer.y=Math.round(Math.min(this.canvasDragger.bounds.maxY,Math.max(this.canvasDragger.bounds.minY,this.canvasContainer.y))),this.layerToolContainer.x=this.canvasContainer.x,this.layerToolContainer.y=this.canvasContainer.y,this.transformItemBoundingBoxesContainer.x=this.canvasContainer.x,this.transformItemBoundingBoxesContainer.y=this.canvasContainer.y,this.updateCheckerPanel(),this.updateTransformLayerVeil(),this.updateToolPosition(),BFN.TransformGuides.updateDisplay(),BFN.MainUI.requestRender()},Rg.prototype.updateToolPosition=function(){this.transformTool.x=this.transformLayerVeil.x=this.canvasContainer.x,this.transformTool.y=this.transformLayerVeil.y=this.canvasContainer.y},Rg.prototype.updateDisplay=function(){this.canvas.x=-this._canvasWidth/2,this.canvas.y=-this._canvasHeight/2,this.transformLayer.x=-this.canvas.x,this.transformLayer.y=-this.canvas.y,this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},Rg.prototype.updatePosition=function(){this.x=Math.round(BFN.StageModel.stageW/2),this.y=Math.round(BFN.StageModel.stageH/2),this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.updateTransformLayerVeilOuterDimensions(),this.updateCanvasContainerDisplay()},Rg.prototype.updateScale=function(){this.scale.x=this.scale.y=this.transformLayer.canvasScale=this.transformTool.scale=this.canvasDragger.scale=BFN.DesignerCanvasModel.canvasScale,this.transformItemBoundingBoxesContainer.children.includes(BFN.TransformItemBoundingBoxes)&&(BFN.TransformItemBoundingBoxes.lineScale=BFN.DesignerCanvasModel.canvasScale),this.transformGuidesContainer.scale.x=1/this.scale.x,this.transformGuidesContainer.scale.y=1/this.scale.y,this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.layerToolContainer.children.includes(BFN.PhotoEditorCanvasTools)&&(BFN.PhotoEditorCanvasTools.scale=BFN.DesignerCanvasModel.canvasScale),this.transformLayerVeil.canvasScale=BFN.DesignerCanvasModel.canvasScale,this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},Rg.prototype.fitDesignerToFrame=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=2*BFN.DesignerCanvasModel.designerFitPaddingX,i=2*BFN.DesignerCanvasModel.designerFitPaddingY,r=this._canvasWidth,a=this._canvasHeight;BFN.TransformItemIsolator.active&&(r=BFN.TransformItemIsolator.itemWidth,a=BFN.TransformItemIsolator.itemHeight),r<=0||a<=0||(this.fitScale=Math.min(1,(BFN.StageModel.stageW-t)/r,(BFN.StageModel.stageH-i)/a),e?(BFN.DesignerCanvasModel.canvasScaling=!0,this.startScale=BFN.DesignerCanvasModel.canvasScale,Math.abs(this.fitScale-this.startScale)>.001?this.fitDesignerAnimator.setAnimatorFactor(0):this.fitDesignerAnimator.setAnimatorFactor(1),this.fitDesignerAnimator.increase()):(BFN.DesignerCanvasModel.canvasScale=this.fitScale,BFN.DesignerCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()))},Rg.prototype.updateCheckerPanel=function(){this.checkerPanel.x=this.canvasContainer.x,this.checkerPanel.y=this.canvasContainer.y,this.checkerPanel.scale=BFN.DesignerCanvasModel.canvasScale;var e={x:0,y:0};if(this._canvasWidth>1&&this._canvasHeight>1&&(e.x=this._canvasWidth,e.y=this._canvasHeight),BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)){var t=BFN.TransformItemIsolator.itemWidth,i=BFN.TransformItemIsolator.itemHeight;BFN.TransformItemIsolator.shiftAnimator.animating&&(t=BFN.TransformItemIsolator.shiftParamsEnd.w-(BFN.TransformItemIsolator.shiftParamsEnd.w-BFN.TransformItemIsolator.shiftParamsStart.w)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor),i=BFN.TransformItemIsolator.shiftParamsEnd.h-(BFN.TransformItemIsolator.shiftParamsEnd.h-BFN.TransformItemIsolator.shiftParamsStart.h)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor)),e.x=e.x-(e.x-t)*BFN.TransformItemIsolator.activeFactor,e.y=e.y-(e.y-i)*BFN.TransformItemIsolator.activeFactor}this.checkerPanel.setDimensions(e.x,e.y)},Rg.prototype.updateTransformLayerVeil=function(){this.transformLayer.frameWidth=this._canvasWidth,this.transformLayer.frameHeight=this._canvasHeight,this.transformTool.frameWidth=this._canvasWidth,this.transformTool.frameHeight=this._canvasHeight;var e=this.transformLayer.frameWidth,t=this.transformLayer.frameHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(e=this.transformLayer.frameWidth-(this.transformLayer.frameWidth-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,t=this.transformLayer.frameHeight-(this.transformLayer.frameHeight-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),this.moveTouchSurface.scale.x=e/100,this.moveTouchSurface.scale.y=t/100,this.drawTransformLayerVeil(e,t)},Rg.prototype.updateTransformLayerVeilOuterDimensions=function(){this.transformLayerVeil.setOuterDimensions(BFN.StageModel.stageW+20,BFN.StageModel.stageH+2)},Rg.prototype.drawTransformLayerVeil=function(e,t){e=Math.round(e),t=Math.round(t),this.transformLayerVeil.setInnerDimensions(e,t)},Rg.prototype.getFlattenedImage=function(){var e=PIXI.RenderTexture.create(this._canvasWidth,this._canvasHeight);return-1!=BFN.DesignerCanvasBackground.color?e.fillColor(parseInt("0x".concat(BFN.DesignerCanvasBackground.color))):e.clear(),this.transformLayer.itemsExist&&(this.transformLayerContainer.removeChild(this.transformLayer),this.transformLayer.toggleHiResTextDisplay(!1),this.transformLayer.toggleItemScaleSmoothing(!1),this.transformLayer.setItemScaleMode(PIXI.SCALE_MODES.NEAREST,["text"]),BFN.Stage.render(this.transformLayer,e,!1),this.transformLayer.toggleHiResTextDisplay(!0),this.transformLayer.toggleItemScaleSmoothing(!0),this.transformLayer.setItemScaleMode(PIXI.SCALE_MODES.LINEAR,["text"]),this.transformLayerContainer.addChild(this.transformLayer)),BFN.MainUI.requestRender(),e},Rg.prototype.getResizedImage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){!BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_DESIGNER&&t(null);var i=(e=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e)))/Math.max(this._canvasWidth,this._canvasHeight),r=Math.round(i*this._canvasWidth),a=Math.round(i*this._canvasHeight),n=e=>{UIHistory.removeEventListener(UIHistoryEvents.HISTORY_ITEMS_UPDATED.type,n),requestAnimationFrame(()=>{var e=this.getFlattenedImage();BFN.UndoManager.undo(),BFN.TransformStateModel.purgeLaterTransitions(),t(e)})};UIHistory.addEventListener(UIHistoryEvents.HISTORY_ITEMS_UPDATED.type,n),UITools.setToolValue("collage_customize","smart_resize",!0),UITools.setToolValue("collage_customize","width",r),UITools.setToolValue("collage_customize","height",a),UITools.applyTool("collage_customize")}},Rg.prototype.handleStageDimensionsUpdated=function(){this.updatePosition()},Rg.prototype.handleCanvasScaleUpdated=function(){this.updateScale()},Rg.prototype.handleFitDesignerToFrame=function(){this.fitDesignerToFrame()},Rg.prototype.handleFitDesignerToFrameAnimated=function(){this.fitDesignerToFrame(!0)},Rg.prototype.handleItemAdded=function(){BFN.DesignerCanvasModel.addedItem&&(BFN.GlobalHistoryModel.updateGlobalHistoryMenuState(),this.transformLayer.addItem(BFN.DesignerCanvasModel.addedItem),BFN.DesignerCanvasModel.addedItem=null)},Rg.prototype.handleClearItems=function(){this.transformLayer.destroyAllItems(),BFN.TransformStateModel.clearTransitions()},Rg.prototype.handleDesignerSettingsUpdated=function(){if(BFN.DesignerCanvasModel.designerSettings){var e=BFN.DesignerCanvasModel.designerSettings,t=UITools.getToolVO("collage_customize");UITools.setToolValue("collage_customize","background_color",e.background_color),UITools.updateToolControls("collage_customize"),BFN.DesignerCanvasBackground.color!=t.background_color&&(BFN.DesignerCanvasBackground.color=t.background_color),e.width&&e.height&&(this._canvasWidth!==e.width||this._canvasHeight!==e.height)&&this.setSize(e.width,e.height),BFN.DesignerModel.updateProjectVO(!1)}else BeFunky.logError("No Designer Settings Available")},Rg.prototype.handleTransformItemsUpdated=function(){var e=this.transformLayer.itemsExist;BFN.DesignerCanvasModel.itemsExist!=e&&(BFN.DesignerCanvasModel.itemsExist=e)},Rg.prototype.handleTransformItemSelected=function(){this.transformLayer.selectedItem?(this.transformTool.selectItem(this.transformLayer.selectedItem),BFN.TransformModel.selectedTransformItem!=this.transformLayer.selectedItem&&(BFN.TransformModel.selectedTransformItem=this.transformLayer.selectedItem)):(this.transformTool.deselectItem(),BFN.TransformModel.selectedTransformItem=null)},Rg.prototype.handleTransformItemDisplayUpdated=function(){this.transformTool.updateDisplay()},Rg.prototype.handleHoverSurfaceOver=function(e){setTimeout(()=>{this.hoverSurfaceOver=!0,BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"grab"},0)},Rg.prototype.handleHoverSurfaceOut=function(e){this.hoverSurfaceOver=!1,BFN.CursorScreen&&(BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"auto")},Rg.prototype.handleMoveTouchSurfacePressed=function(e){e.stopPropagation(),this.canvasDragger.drag(this.canvasContainer)},Rg.prototype.handleCanvasMouseOver=function(e){this.mouseOver=!0},Rg.prototype.handleCanvasMouseOut=function(e){this.mouseOver=!1},Rg.prototype.handleCanvasKeyDown=function(e){BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_DESIGNER||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||32!=e.keyCode||this.moveTouchSurface.visible||(BFN.PIXITicker.nudge(),document.addEventListener("keyup",this.handleCanvasSpaceKeyUpBind,!1),this.moveTouchSurface.visible=!0,BFN.MainUI.requestRender(),e.preventDefault())},Rg.prototype.handleCanvasSpaceKeyUp=function(e){this.handleHoverSurfaceOut(),document.removeEventListener("keyup",this.handleCanvasSpaceKeyUpBind),this.moveTouchSurface.visible=!1,BFN.MainUI.requestRender(),BFN.PIXITicker.nudge()},Rg.prototype.handleCanvasDraggerDragging=function(){this.updateCanvasContainerDisplay(),BFN.TransformModel.selectedTransformItem&&"group"===BFN.TransformModel.selectedTransformItem.type&&BFN.TransformModel.selectedTransformItem.updateGroupTransform()},Rg.prototype.handleCanvasDraggerDraggingComplete=function(){BeFunky.log("DRAGGING CANVAS COMPLETED")},Rg.prototype.handleFitDesignerAnimatorUpdate=function(){BFN.DesignerCanvasModel.canvasScale=(this.fitScale-this.startScale)*this.fitDesignerAnimator.animationSinFactor+this.startScale},Rg.prototype.handleFitDesignerAnimatorUpdateComplete=function(){BFN.DesignerCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()},Object.defineProperty(Rg.prototype,"canvasWidth",{get(){return this._canvasWidth}}),Object.defineProperty(Rg.prototype,"canvasHeight",{get(){return this._canvasHeight}}),BFN.SingletonQueue.add(()=>{BFN.DesignerCanvas=new Rg}),Ag.prototype=Object.create(PIXI.Sprite.prototype),Ag.prototype.init=function(){BeFunky.log("Designer Init"),this.initDefaultValues(),this.initCanvas()},Ag.prototype.initDefaultValues=function(){BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this))},Ag.prototype.initCanvas=function(){this.addChild(BFN.DesignerCanvas)},Ag.prototype.handleAppReady=function(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIPressed.bind(this))},Ag.prototype.handleMainUIPressed=function(e){if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_DESIGNER&&!BFN.ColorPickerPanel.colorButton&&!BeFunky.isLoadScreenActive()&&BFN.TransformModel.selectedTransformItem){var t=e.data.canvasPressed,i=e.data.originalEvent,r=!(t&&(i.ctrlKey||i.metaKey||i.altKey));BFN.DesignerCanvas.transformLayer.deselectItem(r,i.shiftKey)}},BFN.SingletonQueue.add(function(){BFN.Designer=new Ag}),BFN.MainUIEvents={MOUSE_OVER:new Event("MOUSE_OVER"),MOUSE_OUT:new Event("MOUSE_OUT"),MOUSE_DOWN:new Event("MOUSE_DOWN"),MOUSE_WHEEL:new Event("MOUSE_WHEEL"),PRE_RENDER:new Event("PRE_RENDER"),POST_PRE_RENDER:new Event("POST_PRE_RENDER"),RENDERED:new Event("RENDERED")},Vg.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Vg.prototype.init=function(){BeFunky.log("MainUI Init"),this.initDefaultValues(),this.initPhotoEditor(),this.initCollageMaker(),this.initDesigner(),this.initBrushCircle(),this.initEyeDropper(),this.initTransformGuides(),this.initHiResTextViewport(),this.initMainUIMask()},Vg.prototype.initDefaultValues=function(){this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,1e3,1e3),this.renderRequested=!0,this.rendering=!0,this.renderTime=0,this.renderAvailable=!1,this._viewportUpdating=!1,this.animationFrameRequested=!1,this._tooltip=null,this.idleRenderFunctions=[],BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this)),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleViewStateUpdated.bind(this)),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),document.addEventListener(BeFunky.pointerdown,function(e){e.target instanceof HTMLCanvasElement||e.target&&e.target.preventItemDeselect||BeFunky.isModalOpen()||BeFunky.isLoadScreenActive()||(BFN.MainUIEvents.MOUSE_DOWN.data={canvasPressed:!1,originalEvent:e},this.dispatchEvent(BFN.MainUIEvents.MOUSE_DOWN))}.bind(this)),this.on("pointerdown",function(e){var t=e.data.originalEvent;try{if(2==t.button)this.showMainUIContextMenu(e.target,t.pageX,t.pageY);else{var i=e.target;BFN.LongPressManager.initiateLongPress(e=>{BFN.TransformItemGroup.documentMouseMoved=!0,this.showMainUIContextMenu(i,e.pageX,e.pageY)})}}catch(e){}BFN.MainUIEvents.MOUSE_DOWN.data={canvasPressed:!0,originalEvent:t},this.dispatchEvent(BFN.MainUIEvents.MOUSE_DOWN)}.bind(this)),this.on(BeFunky.pointerover,function(e){this.dispatchEvent(BFN.MainUIEvents.MOUSE_OVER)}.bind(this)),this.on(BeFunky.pointerout,function(e){this.dispatchEvent(BFN.MainUIEvents.MOUSE_OUT)}.bind(this)),document.getElementById("appStage").addEventListener("wheel",function(e){e.altKey&&(BFN.MainUIEvents.MOUSE_WHEEL.deltaY=e.deltaY,this.dispatchEvent(BFN.MainUIEvents.MOUSE_WHEEL),e.preventDefault())}.bind(this)),this.pointerEvent=null,BFN.Stage.plugins.interaction.on("pointerdown",function(e){this.pointerEvent=e}.bind(this)),BFN.Stage.plugins.interaction.on("pointermove",function(e){this.pointerEvent=e}.bind(this)),BFN.Stage.plugins.interaction.on("pointerup",function(e){this.pointerEvent=e}.bind(this))},Vg.prototype.showMainUIContextMenu=function(e,t,i){var r=null;e!=BFN.PhotoEditorCanvas&&e!=BFN.PhotoEditorCanvasImage||BFN.PhotoEditorCanvasModel.viewState!=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS?e==BFN.CollageMakerCanvas?r=BFN.CollageMakerCanvasModel.contextMenu:e==BFN.DesignerCanvas&&(r=BFN.DesignerCanvasModel.contextMenu):r=BFN.PhotoEditorCanvasModel.contextMenu,r&&(r.toggleButton("undo",BFN.UndoManager.undoExists),r.toggleButton("redo",BFN.UndoManager.redoExists),r.toggleButton("reset",!!BFN.GlobalHistoryModel.globalHistoryVOs.length),r.toggleButton("save_to_image_manager",!!BFN.GlobalHistoryModel.globalHistoryVOs.length),r.show(t-16,i-16))},Vg.prototype.initPhotoEditor=function(){this.photoEditor=BFN.PhotoEditor,this.photoEditor.visible=!1,this.addChild(this.photoEditor)},Vg.prototype.initCollageMaker=function(){this.collageMaker=BFN.CollageMaker,this.collageMaker.visible=!1,this.addChild(this.collageMaker)},Vg.prototype.initDesigner=function(){this.designer=BFN.Designer,this.designer.visible=!1,this.addChild(this.designer)},Vg.prototype.initBrushCircle=function(){this.addChild(BFN.BrushCircle),this.addChild(BFN.BrushCirclePreview)},Vg.prototype.initEyeDropper=function(){this.eyeDropperContainer=new PIXI.Container,this.addChild(this.eyeDropperContainer)},Vg.prototype.initTransformGuides=function(){this.transformGuides=BFN.TransformGuides,this.addChild(this.transformGuides)},Vg.prototype.initHiResTextViewport=function(){BFN.HiResTextManager.showHiResTextHelpers&&this.addChild(BFN.HiResTextManager.hiResTextViewport)},Vg.prototype.initMainUIMask=function(){this.mainUIMask=new PIXI.Graphics,this.addChild(this.mainUIMask)},Vg.prototype.requestRender=function(){BFN.MainUI.renderRequested=!0},Vg.prototype.addIdleRenderFunction=function(e){if("function"!=typeof e)return BeFunky.logError("Non-function passed to addIdleRenderFunction",e);BFN.MainUI.idleRenderFunctions.push(e)},Vg.prototype.updateAppView=function(){this.photoEditor.visible=BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,this.collageMaker.visible=BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,this.designer.visible=BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_DESIGNER,BFN.MainUI.requestRender()},Vg.prototype.updateDimensions=function(){this.hitArea.width=BFN.StageModel.stageW,this.hitArea.height=BFN.StageModel.stageH,this.mainUIMask.clear(),this.mainUIMask.beginFill(16777215,1),this.mainUIMask.drawRect(0,0,BFN.StageModel.stageW,BFN.StageModel.stageH),this.mainUIMask.endFill(),this.mask=this.mainUIMask,BFN.MainUI.requestRender()},Vg.prototype.animate=function(e){if(BFN.MainUI.viewportUpdating&&BFN.StageModel.updateStageDimensions(),e>=BFN.MainUI.renderTime-1&&(BFN.MainUI.renderTime=e+BFN.frameInterval,BFN.MainUI.renderAvailable=!0),BFN.MainUI.renderRequested&&BFN.MainUI.renderAvailable&&!BFN.MainUI.animationFrameRequested&&(BFN.MainUI.animationFrameRequested=!0,BFN.MainUI.renderRequested=!1,BFN.MainUI.renderAvailable=!1,BFN.MainUI.animationFrameRequested=!1,BFN.MainUI.rendering&&(BFN.MainUI.dispatchEvent(BFN.MainUIEvents.PRE_RENDER),BFN.MainUI.dispatchEvent(BFN.MainUIEvents.POST_PRE_RENDER),BFN.MainUI.renderCanvas(),BFN.MainUI.dispatchEvent(BFN.MainUIEvents.RENDERED))),BFN.MainUI.idleRenderFunctions.length&&!BFN.MainUI.renderRequested&&!BFN.MainUI.animationFrameRequested&&BFN.MainUI.renderAvailable){var t=BFN.MainUI.idleRenderFunctions.shift();requestIdleCallback(t)}requestAnimationFrame(BFN.MainUI.animate)},Vg.prototype.renderCanvas=function(){BFN.Stage.render(BFN.MainUI)},Vg.prototype.getFlattenedImage=function(){var e=PIXI.RenderTexture.create(BFN.StageModel.stageW,BFN.StageModel.stageH);e.fillColor(BFN.AppBackgroundColor);var t=new PIXI.Point(BFN.MainUI.x,BFN.MainUI.y);return BFN.MainUI.x=BFN.MainUI.y=0,BFN.Stage.render(BFN.MainUI,e,!1),BFN.MainUI.x=t.x,BFN.MainUI.y=t.y,e},Vg.prototype.handleAppReady=function(){this.updateAppView()},Vg.prototype.handleViewStateUpdated=function(){this.updateAppView()},Vg.prototype.handleStageDimensionsUpdated=function(){this.updateDimensions()},Object.defineProperty(Vg.prototype,"viewportUpdating",{set:function(e){this._viewportUpdating=e,this._viewportUpdating||BFN.StageModel.updateStageDimensions()},get:function(){return this._viewportUpdating}}),Object.defineProperty(Vg.prototype,"tooltip",{set:function(e){this._tooltip!==e&&(this._tooltip=e,this._tooltip||BFN.TooltipScreen.hide())},get:function(){return this._tooltip}}),BFN.SingletonQueue.add(function(){BFN.MainUI=new Vg,BFN.MainUI.animate()}),BFN.UI.accordionLayout=((e,t)=>{var i=t.sections,r=void 0===i?{}:i,a=t.maxActiveSections;return function(){var e=document.createDocumentFragment(),t=Object.keys(r);t.length?(t.forEach(t=>{var i=r[t],a=i.content,n=void 0===a?"":a,o=i.plusEnabled,s=void 0!==o&&o,l=i.isOpen,h=void 0!==l&&l,c='\n            <div class="panel-header"></div>\n            <div class="accordion__panel">'.concat(n,"</div>\n        "),u=document.createElement("div").addClass("accordion__section");h&&u.addClass("accordion__section--open"),u.innerHTML=c,BFN.UI.panelHeader(u.querySelector(".panel-header"),{name:t,modifier:"accordion",arrowEnabled:!0,plusEnabled:s}),e.appendChild(u)}),this.appendChild(e),this.init=function(){this.initDefaultValues(),this.initAccordion()},this.initDefaultValues=function(){this.sections={};var e=[...this.querySelectorAll(".accordion__section")];t.forEach((t,i)=>{var a=e[i],n=[...a.children],o=n[0],s=n[1],l=o.querySelector(".panel-header__button--arrow"),h=r[t].isOpen||!1;this.sections[t]={container:a,header:o,panel:s,arrowButton:l,isOpen:h},l.setAttribute("data-bfntooltip",h?"collapse":"expand")}),this._activeSections=t.filter(e=>this.sections[e].isOpen),this.headerHeight=36},this.initAccordion=function(){var e=this,t=function(t){var i=!1,r=e.sections[t],n=r.header,o=r.container,s=r.isOpen;n.addEventListener("PLUS",()=>i=!0),n.addEventListener("click",()=>{if(i)i=!1;else{var r=e._activeSections.indexOf(t),n=e._activeSections.slice(0);-1===r?n.unshift(t):n.splice(r,1),a&&n.length>a&&n.splice(a),e.activeSections=n}}),s||o.setStyles({height:"".concat(e.headerHeight,"px")})};for(var i in this.sections)t(i)},this.updateActiveSections=(()=>{for(var e in this.sections){var t=this.sections[e];t.isOpen!==this._activeSections.includes(e)&&this.toggleSection(t)}}),this.toggleSection=(e=>{var t=e.container,i=e.panel,r=e.animationTimeout,n=e.arrowButton;r&&clearTimeout(r),e.isOpen=!e.isOpen,t.toggleClass("accordion__section--open",e.isOpen),n.setAttribute("data-bfntooltip",e.isOpen?"collapse":"expand");var o=i.getBoundingClientRect().height+this.headerHeight,s=a?250:Math.max(100,Math.min(o,300)*(e.isOpen?1.1:.75));t.setStyles({height:"".concat(o,"px"),transition:"height ".concat(s/1e3,"s ease-in-out")}),e.isOpen?e.animationTimeout=setTimeout(()=>t.setStyles({height:""}),s+10):requestAnimationFrame(()=>{setTimeout(()=>t.setStyles({height:"".concat(this.headerHeight,"px")}),0)})}),Object.defineProperty(this,"activeSections",{set(e){if(Array.isArray(e)){var t=Object.keys(this.sections);e=e.filter(e=>!!t.includes(e)||(BeFunky.logError("Invalid accordion active section specified:",e),!1));var i=t.filter(e=>this.sections[e].isOpen);e.length===i.length&&e.every(e=>i.includes(e))||(this._activeSections=e,this.updateActiveSections())}else BeFunky.logError("Accordion active sections must be an array")},get(){return this._activeSections}}),this.init()):BeFunky.logError("No sections provided to accordionLayout() component")}.bind(e)()}),BFN.UI.accountMenu=(e=>(function(){this.init=function(){this.initDefaultValues(),this.updateMenu()},this.initDefaultValues=function(){this._accountMode="non_user",BFN.BfnService.userLoggedIn&&(this._accountMode=BFN.BfnService.userIsPlus?"plus_user":"free_user"),this.feedbackFormSetup=!1,this.getUpgradeButtonMarkup=(()=>{var e=BeFunky.getFreeTrialEnabled()?"start_trial":"upgrade";return'\n            <button id="user_account_upgrade" class="button button--blue-gradient" style="padding: 0 .75rem">\n                <string data-lang='.concat(e,' style="text-transform: capitalize">').concat(BeFunky.LanguageManager.getString(e),"</string>\n            </button>\n        ").trim()}),BeFunky.onFreeTrialEnabledChange(()=>this.updateMenu(),!1),this.feedbackButtonMarkup='\n            <button id="user_account_feedback" class="button button--icon button--transparent button--large" data-bfntooltip="leave_feedback" style="padding: 5px">\n                <svg class="icon icon-size-x-large icon-stroke"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#feedback-icon"></use></svg>\n            </button>\n        ',this.dropdownButtonGenericMarkup='\n            <svg class="icon" style="width: 1.25rem; height: 1rem; margin: 0;"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-menu-icon"></use></svg>\n        ',this.getDropdownButtonUserMarkup=((e,t)=>'\n            <div class="navbar__user-circle '.concat(t?"navbar__user-circle--plus":"",'">').concat(e,'</div>\n            <svg class="icon" style="height: 2rem; margin-left: .25rem"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-arrow-down-icon"></use></svg>\n        ')),this.accountPlusItem=this.querySelector(".account-plus-item"),this.dropdownList=this.querySelector(".navbar-dropdown-items")},this.updateMenu=function(){switch(this._accountMode){case"non_user":case"free_user":this.accountPlusItem.innerHTML=this.getUpgradeButtonMarkup(),UITools.registerControl("user_account_upgrade");break;case"plus_user":this.accountPlusItem.innerHTML=this.feedbackButtonMarkup,UITools.registerControl("user_account_feedback")}var e=document.getElementById("account_dropdown_button");switch(this._accountMode){case"non_user":e.className="navbar-dropdown-button button button--icon button--transparent",e.innerHTML=this.dropdownButtonGenericMarkup;break;case"free_user":case"plus_user":var t=(BFN.userVo.username||"?").charAt(0).toUpperCase();e.className="navbar-dropdown-button button",e.innerHTML=this.getDropdownButtonUserMarkup(t,"plus_user"===this._accountMode),e.setAttribute("data-bfntooltip",BFN.userVo.email)}var i=[],r=[{id:"user_account_sign_in",name:"sign_in",accountModes:["non_user"]},{id:"user_account_sign_up",name:"register",accountModes:["non_user"]},{id:"user_account_account",name:"my_account",type:"link",target:"_blank",href:"".concat(BeFunky.Params.siteUrl,"my-account/?cmfrm=1"),accountModes:["free_user","plus_user"]},{id:"user_account_settings",name:"settings",accountModes:["non_user","free_user","plus_user"]},{id:"user_account_help_support",name:"help_support",type:"link",target:"_blank",href:"https://support.befunky.com/hc/en-us",accountModes:["non_user","free_user","plus_user"]},{id:"user_account_logout",name:"sign_out",accountModes:["free_user","plus_user"]}];this.dropdownList.innerHTML=r.filter(e=>e.accountModes.includes(this.accountMode)).map(e=>e.hasOwnProperty("type")&&"link"===e.type?'\n                        <a id="'.concat(e.id,'" class="dropdown-item button button--list allow-window-event" href="').concat(e.href,'" target="').concat(e.target,'" data-lang="').concat(e.name,'">\n                            ').concat(BeFunky.LanguageManager.getString(e.name),"\n                        </a>\n                    "):(i.push(e.id),'\n                        <button id="'.concat(e.id,'" class="dropdown-item button button--list" data-lang="').concat(e.name,'">\n                            ').concat(BeFunky.LanguageManager.getString(e.name),"\n                        </button>\n                    "))).join(""),i.forEach(e=>{document.getElementById(e).allowEvent=!0,UITools.registerControl(e)})},this.showFeedbackForm=function(){var e=document.getElementById("feedback_form_modal"),t=e.querySelector("textarea"),i=()=>BeFunky.closeModal(e);this.feedbackFormSetup||(this.feedbackFormSetup=!0,e.querySelector(".feedback__cancel").addEventListener("click",i),e.querySelector(".feedback__submit").addEventListener("click",function(e){var r=t.value.trim();if(!r)return;var a=e.currentTarget;a.disabled=!0,BeFunky.requestAPI("auth/send-feedback",{message:r},{showLoadScreen:!0}).then(e=>{if("success"!==e.data)throw"invalid_response";t.value="",i(),UIMessages.display("thank_you_befunky")}).catch(e=>{console.log("Feedback:",r),"invalid_response"===e?BeFunky.throwError("Unable to send feedback",e):BeFunky.logError("Unable to send feedback",e),UIMessages.display(BeFunky.failureReason(e))}).then(()=>{a.disabled=!1})})),BeFunky.openModal(e,{size:"small",onOpen:()=>{t.focus()}})},Object.defineProperty(this,"accountMode",{set(e){this._accountMode!==e&&(this._accountMode=e,this.updateMenu())},get(){return this._accountMode}}),this.init()}).bind(e)()),BFN.UI.applyCancelUpgradeButtons=((e,t)=>{var i=t.id;return function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.upgradeMode=!1,this.cancelButton=document.getElementById("".concat(i,"_cancel")),this.applyButton=document.getElementById("".concat(i,"_apply")),this.upgradeButton=document.getElementById("".concat(i,"_upgrade")),this._alternateApply=!1,this.applyButton.addEventListener("click",this.handleClick),this.upgradeButton.addEventListener("click",this.handleClick),BeFunky.onFreeTrialEnabledChange(e=>{this.upgradeButton.setLang(e?"start_trial_short":"upgrade")})},this.handleClick=(e=>{this._upgradeMode&&(e.stopImmediatePropagation(),BFN.PhotoEditorCanvasTools.applyCurrentTool())}),Object.defineProperty(this,"upgradeMode",{set(e){this._upgradeMode=e,this.toggleClass("button-group--must-upgrade",this._upgradeMode)},get(){return this._upgradeMode}}),Object.defineProperty(this,"alternateApply",{set(e){this._alternateApply=e},get(){return this._alternateApply}}),this.init()}.bind(e)()}),BFN.UI.autocomplete=BeFunky.autocomplete,BFN.UI.batchProcessingIcon=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.iconClass,r=void 0===i?"":i,a=t.size,n=void 0===a?14:a;return function(){this.batchToolID=this.id.replace("batch_processing_",""),this.addClass("batch-processing-icon"),this.init=function(){this.selected=!1},this.updateDisplay=function(){var e="batch-icon".concat(this.selected?"-blue":"-white").concat(14===n?"-14":"");this.innerHTML='<svg class="icon '.concat(r,'"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(e,'"></use></svg>');var t=this.selected?"batch_tool_remove":"batch_tool_add";this.dataset.bfntooltip=t},Object.defineProperty(this,"selected",{set(e){e=!!e,this._selected!==e&&(this._selected=e,this.updateDisplay())},get(){return this._selected}}),this.init()}.bind(e)()},BFN.UI.batchProcessingImageItem=((e,t)=>(function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.batchImageVO=t,this.addClass("batch-item"),this.background=document.createElement("div"),this.background.addClass("batch-item__background"),this.appendChild(this.background),this.image=document.createElement("div"),this.image.addClass("batch-item__image"),this.background.appendChild(this.image),this.imageOverlay=document.createElement("div"),this.imageOverlay.addClass("batch-item__image-overlay"),this.image.appendChild(this.imageOverlay),this.imageOverlayVeil=document.createElement("div"),this.imageOverlayVeil.addClass("batch-item__image-overlay-veil"),this.imageOverlayVeil.innerHTML='<div class="loading-spinner"></div>',this.image.appendChild(this.imageOverlayVeil),this.imageOverlayLoader=this.imageOverlayVeil.querySelector(".loading-spinner"),this.cropControls=document.createElement("div"),this.cropControls.addClass("batch-item__crop-controls"),this.image.appendChild(this.cropControls),this.cropVeilT=this.addCropVeil(this.cropControls,"top"),this.cropVeilL=this.addCropVeil(this.cropControls,"left"),this.cropVeilR=this.addCropVeil(this.cropControls,"right"),this.cropVeilB=this.addCropVeil(this.cropControls,"bottom"),this.cropRegion=this.addCropRegion(this.cropControls),this.label=document.createElement("div"),this.label.addClass("batch-item__label"),this.label.textContent="".concat(t.imageW," x ").concat(t.imageH),this.appendChild(this.label),this.isNew=!0,this.setStyles({display:"none"}),this.updateImageDisplay()},this.setBatchMode=function(e){switch(this.imageOverlay.removeClass("active"),e){case"resize":this.cropControls.removeClass("active");break;case"crop":this.cropControls.addClass("active"),this.resize("none");break;default:this.cropControls.removeClass("active"),this.resize("none"),"dynamic"===e&&this.imageOverlay.addClass("active")}},this.setImageOverlayOpacity=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this.imageOverlay.setStyles({opacity:e/100})},this.setImageOverlaySRC=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.hasOwnProperty("imageOverlayObjectURL")&&(URL.revokeObjectURL(this.imageOverlayObjectURL),delete this.imageOverlayObjectURL),e&&(this.imageOverlayObjectURL=e),this.imageOverlaySRC=e,this.imageOverlayFadeable=t,i||this.applyImageOverlaySRC()},this.applyImageOverlaySRC=function(){if(this.hasOwnProperty("imageOverlaySRC")&&this.hasOwnProperty("imageOverlayFadeable")){var e=this.imageOverlaySRC,t=this.imageOverlayFadeable;delete this.imageOverlaySRC,delete this.imageOverlayFadeable,this.imageOverlay.setStyles({background:e?"url(".concat(e,")"):"",backgroundSize:"100% 100%",width:"100%",height:"100%"}),e&&!t?this.image.setStyles({background:""}):this.image.setStyles({background:"url(".concat(this.batchImageVO.thumbSRC,")"),backgroundSize:"100% 100%",width:"100%",height:"100%"})}},this.setBackgroundColor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.batchImageVO.backgroundColor=e,this.updateBackgroundDisplay()},this.setImageType=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"jpg";["jpg","png"].includes(e)&&(this.batchImageVO.imageType=e)},this.updateBackgroundDisplay=function(){this.background.setStyles({background:-1===this.batchImageVO.backgroundColor?"":"#".concat(this.batchImageVO.backgroundColor)})},this.updateImageDisplay=function(){var e=new Image;e.addEventListener("load",()=>{var i=Math.max(t.imageW,t.imageH);this.background.setStyles({width:"".concat(t.imageW/i*100,"%"),height:"".concat(t.imageH/i*100,"%")}),this.image.setStyles({background:"url(".concat(e.src,")"),backgroundSize:"100% 100%",width:"100%",height:"100%"}),this.isNew&&(this.isNew=!1,this.setStyles({display:""}))}),e.src=t.thumbSRC},this.toggleImageOverlayVeil=function(e,t){this.imageOverlayVeil.toggleClass("active",e),this.imageOverlayLoader.toggleClass("active",e&&t)},this.resize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"none";this.resizeToolVO||(this.resizeToolVO=UITools.getToolVO("batch_resize"));var i=t.imageW,r=t.imageH,a=Math.max(t.imageW,t.imageH),n=r/i,o=i,s=r;switch(e){case"scale":var l=this.resizeToolVO.scale;o=Math.round(i*(l/100)),s=Math.round(r*(l/100));break;case"longest_side":var h=this.resizeToolVO.longest_side;o=Math.round(n>1?h/n:h),s=Math.round(n>1?h:h*n);break;case"width":var c=this.resizeToolVO.width;o=c,s=Math.round(c*n);break;case"height":var u=this.resizeToolVO.height;o=Math.round(u/n),s=u;break;case"exact_size":o=this.resizeToolVO.exact_width,s=this.resizeToolVO.exact_height}var d=Math.min(o,s),m=Math.max(o,s);d<BFN.minImageSize?(o=Math.round(n>1?BFN.minImageSize:BFN.minImageSize/n),s=Math.round(n>1?BFN.minImageSize*n:BFN.minImageSize)):m>BFN.maxImageSize&&(o=Math.round(n>1?BFN.maxImageSize/n:BFN.maxImageSize),s=Math.round(n>1?BFN.maxImageSize:BFN.maxImageSize*n));var p=this.resizeToolVO.use_padding;if("exact_size"===e)if(m=Math.max(o,s),this.background.setStyles({width:"".concat(o/m*100,"%"),height:"".concat(s/m*100,"%")}),p){var g=n/(s/o),f=g>1?100/g:100,v=g>1?100:100*g;this.image.setStyles({width:"".concat(f,"%"),height:"".concat(v,"%")})}else this.image.setStyles({width:"100%",height:"100%"});else this.background.setStyles({width:"".concat(i/a*100,"%"),height:"".concat(r/a*100,"%")}),this.image.setStyles({width:"100%",height:"100%"});var y="".concat(i," x ").concat(r);i===o&&r===s||(y+=" ".concat('<svg class="icon icon-size-small" style="margin-top: -2px;"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-arrow-icon"></use></svg>'," ").concat(o," x ").concat(s)),this.label.innerHTML=y,this.label.setStyles({visibility:"none"===e?"hidden":"visible"}),this.batchImageVO.resizeData.width=o,this.batchImageVO.resizeData.height=s,this.batchImageVO.resizeData.padding=p},this.setCropRatio=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"landscape",r=t.imageW,a=t.imageH/r;-1===e&&(e=a>1?1/a:a),"portrait"===i&&-2!==e&&(e=1/e),-2===e&&(e=a);var n=e/a,o=n>1?100/n:100,s=n>1?100:100*n,l=50-o/2,h=50-s/2;this.cropRegion.setStyles({left:"".concat(l,"%"),top:"".concat(h,"%"),width:"".concat(o,"%"),height:"".concat(s,"%")}),this.updateCropVeil(),this.updateCropData()},this.updateCropVeil=function(){var e=parseFloat(this.cropRegion.style.left.replace("%","")),t=parseFloat(this.cropRegion.style.top.replace("%","")),i=parseFloat(this.cropRegion.style.width.replace("%","")),r=parseFloat(this.cropRegion.style.height.replace("%",""));this.cropVeilT.setStyles({bottom:"".concat(100-t,"%")}),this.cropVeilB.setStyles({top:"".concat(t+r,"%")}),this.cropVeilL.setStyles({top:"".concat(t,"%"),bottom:"".concat(100-t-r,"%"),right:"".concat(100-e,"%")}),this.cropVeilR.setStyles({top:"".concat(t,"%"),bottom:"".concat(100-t-r,"%"),left:"".concat(e+i,"%")})},this.updateCropData=function(){var e=Math.max(0,Math.min(1,parseFloat(this.cropRegion.style.left.replace("%",""))/100)),t=Math.max(0,Math.min(1,parseFloat(this.cropRegion.style.top.replace("%",""))/100)),i=Math.max(0,Math.min(1,parseFloat(this.cropRegion.style.width.replace("%",""))/100)),r=Math.max(0,Math.min(1,parseFloat(this.cropRegion.style.height.replace("%",""))/100)),a=this.batchImageVO.cropData;a.x=Math.round(e*this.batchImageVO.imageW),a.y=Math.round(t*this.batchImageVO.imageH),a.width=Math.round(i*this.batchImageVO.imageW),a.height=Math.round(r*this.batchImageVO.imageH)},this.destroy=function(){if(this.parentNode){this.parentNode.removeChild(this),this.image.setStyles({background:""}),this.imageOverlay.setStyles({background:""});try{this.batchImageVO.thumbTexture.destroyGC(!0)}catch(e){}this.batchImageVO.thumbTexture=null,this.batchImageVO.thumbSRC&&(URL.revokeObjectURL(this.batchImageVO.thumbSRC),this.batchImageVO.thumbSRC=null),this.batchImageVO=null}},this.addCropVeil=function(e,t){var i=document.createElement("div");return i.addClass("batch-item__crop-veil"),i.addClass(t),e.appendChild(i),i},this.addCropRegion=function(e){var t=document.createElement("div");t.addClass("batch-item__crop-region"),t.imageItem=this,t.container=e,t.region=t,e.appendChild(t);var i=["top","middle","bottom"];return["left","center","right"].forEach(r=>{var a=document.createElement("div");a.addClass("batch-item__crop-region-column"),t.appendChild(a),i.forEach(i=>{if("middle"!==i||"center"!==r){var n=document.createElement("div");n.addClass("batch-item__crop-region-handle"),n.addClass(i),n.addClass(r),n.handleID="".concat(i,"_").concat(r),n.handleType="middle"===i||"center"===r?"side":"corner",n.imageItem=this,n.container=e,n.region=t,a.appendChild(n)}})}),t},this.init()}).bind(e)()),BFN.UI.batchProcessingModal=(e=>(function(){this.init=function(){this.initDefaultValues(),this.initSaveModal()},this.initDefaultValues=function(){this.imagesContainerW=0,this.imagesContainerH=0,this.imagesPerRow=0,this.imageItemSize=BFN.BatchProcessingManager.itemSize,this.imageItemMaxSize=this.imageItemSize+4+4,this.toolButtonData=[],this.menu=this.querySelector(".batch-processing__menu");var e=[...this.querySelectorAll(".batch-processing__menu-section")];this.menuToolsSection=e[0],this.menuControlsSection=e[1],this.primaryButtons=this.querySelector(".batch-processing__tool-list"),this.primaryButtons.innerHTML="",BFN.UI.sortableList(this.primaryButtons),this.primaryButtons.addEventListener("LIST_ORDER_UPDATED",this.handlePrimaryButtonListOrderUpdated.bind(this)),this.controlsHeader=this.querySelector(".batch-processing__controls-header"),this.controlsContainer=this.querySelector(".batch-processing__controls-container"),this.controlsCancel=document.getElementById("batch_processing_cancel"),this.batchDynamicControls=this.controlsContainer.querySelector("#batch_dynamic_controls"),this.navbar=this.querySelector(".batch-processing__navbar"),this.clearButton=document.getElementById("batch_processing_clear_images"),this.saveButton=document.getElementById("batch_processing_save_images"),this.imageItems=[],this.imagesContainer=this.querySelector(".batch-processing__images-container"),BFN.UI.scrollStopDispatcher(this.imagesContainer,()=>{BFN.BatchProcessingManager.processVisibleImageItems()}),this.imagesContainer.addEventListener("scroll",e=>{BeFunky.isLoadScreenActive()&&(e.stopImmediatePropagation(),e.preventDefault())},!0),this.dragDropArea=document.getElementById("batch_processing_drag_drop_area"),this.updateImageItems(),this.maxWidth=1280,this.maxHeight=800,BFN.HelpClueManager.setup("batch_processing",{side:"top",positionFactor:.9,left:"auto",right:"3.75rem",top:"2.5rem",zIndex:"1",container:this.querySelector(".popover-placeholder")})},this.initSaveModal=function(){this.saveModal=document.getElementById("batch_processing_save");var e=[...this.saveModal.querySelectorAll(".modal__button")],t=e[1];e[0].addEventListener("click",()=>BeFunky.closeModal(this.saveModal)),t.addEventListener("click",()=>{BeFunky.closeModal(this.saveModal),BFN.BatchProcessingManager.saveImages()})},this.open=function(){BeFunky.openModal(this,{closeOnClickOutside:!1,onOpen:()=>{BFN.AppModel.viewingEditor&&BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),BFN.retrievePresetThumbHelperGraphics("effect"),UITools.setToolValue("batch_processing","section",null,!1),UITools.applyToolControl("batch_processing_section"),this.showWalkthrough()},onClose:()=>{UITools.setToolValue("batch_processing","section",null,!1),UITools.applyToolControl("batch_processing_section")},closeOnEscape:()=>!UITools.getToolValue("batch_processing","section")||(UITools.setToolValue("batch_processing","section",null,!1),UITools.applyToolControl("batch_processing_section"),!1),onWindowResize:this.updateModalSize.bind(this),size:"extra-large"})},this.close=function(){BeFunky.closeModal(this)},this.showWalkthrough=function(){BFN.HelpClueManager.setup("batch_upload",{side:"top",top:"1.5rem",left:"-3.5rem",zIndex:"1",container:()=>document.getElementById("batch_upload_placeholder")}),BFN.HelpClueManager.setup("batch_edit",{side:"left",positionFactor:0,top:"2.5rem",left:"-1.25rem",zIndex:"1",container:()=>document.getElementById("batch_edit_placeholder")}),BFN.HelpClueManager.showWalkthrough(["batch_upload","batch_edit"])},this.updateToolButtons=function(e){e&&(this.toolButtonData.forEach(t=>{e.includes(t)||t.button.parentNode.removeChild(t.button)}),e.forEach(e=>{this.toolButtonData.includes(e)||e.button||(e.button=this.createToolButton(e.id,e.name))}),this.toolButtonData.splice(0),this.toolButtonData.push(...e),this.toolButtonData.forEach(e=>{e.button.string.textContent=BeFunky.LanguageManager.getString(e.name),this.primaryButtons.appendChild(e.button)}),this.primaryButtons.refreshList())},this.createToolButton=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=document.createElement("div").setClass("batch-processing__tool-button-row sortable-list__item");i.dataset.batchId=e;var r=document.createElement("button").setClass("button button--large button--list batch-processing__open-tool  sortable-list__item-drag-image");t=t||e;var a=document.createElement("string").setLang(t);r.appendChild(a),i.string=a,r.addEventListener("click",()=>{UITools.setToolValue("batch_processing","section",e,!1),UITools.applyTool("batch_processing")});var n=document.createElement("button").setClass("button button--large button--icon button--list batch-processing__remove-tool");return n.innerHTML='<svg class="icon icon-size-small"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-cancel-icon"></use></svg>',n.addEventListener("click",()=>{BFN.BatchToolManager.selectedIDs=BFN.BatchToolManager.selectedIDs.filter(t=>t!==e)}),i.appendChild(r),i.appendChild(n),i},this.showControls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){this.controlsHeader.textContent=BeFunky.LanguageManager.getString(t||e);var i="batch_".concat(e,"_controls");[...this.controlsContainer.querySelectorAll(".batch-processing__controls-group")].forEach(e=>{e.setStyles({display:e.id==i?"block":"none"})}),this.menu.addClass("slide"),this.menuToolsSection.addClass("focus-avoid"),this.menuControlsSection.removeClass("focus-avoid")}else this.menu.removeClass("slide"),this.menuToolsSection.removeClass("focus-avoid"),this.menuControlsSection.addClass("focus-avoid")},this.setDynamicControls=function(e,t){if(!e||!t)return!1;for(;this.batchDynamicControls.lastChild;)this.batchDynamicControls.removeChild(this.batchDynamicControls.lastChild);delete this.batchDynamicControls.buttonContainer;var i="batch_effect";UITools.removeToolVO(i);var r=UITools.createToolVO(i);return r.toolID=t,e.forEach(e=>{var t=e.controlID.replace("batch_effect_",""),a=e.controlParamObject,n=e.controlID,o=a.type;UITools.toolControlIDs[i].push(n),UITools.controlToolIDs[n]=i,UITools.controlParamObjects[n]=a;var s=!!a.hasOwnProperty("defaultValue")&&a.defaultValue;switch(UITools.setToolValue(i,t,s),o){case"color":case"color_item":case"color_palette":a.hasOwnProperty("intensityEnabled")&&a.intensityEnabled&&UITools.setToolValue(i,"".concat(a.name,"_intensity"),1)}r.defaultValues[t]=s}),r.updating_id=null,UITools.setupControlItems(e,this.batchDynamicControls),e.forEach(e=>{UITools.registerControl(e.controlID)}),!0},this.setResizeMode=function(e){var t="batch_resize_".concat(e,"_controls");[...this.controlsContainer.querySelectorAll(".batch-resize-control-container")].forEach(e=>{e.setStyles({display:e.id==t?"block":"none"})})},this.addBatchImage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){var t=document.createElement("div");return BFN.UI.batchProcessingImageItem(t,e),this.updateImageItemSize(t),this.imagesContainer.appendChild(t),this.toggleDragArea(!1),t}},this.updateImageItemSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&e.setStyles({width:"".concat(this.imageItemSize,"px"),height:"".concat(this.imageItemSize,"px")})},this.openSaveDialog=function(){BeFunky.openModal(this.saveModal,{closeOnClickOutside:!1,size:"small"}),BFN.WatermarkManager.activate();var e=this.getImageItems();if(e.length){var t=e[0].batchImageVO.imageBlob;BFN.TextureUtils.blobOrBase64ToTexture(t,e=>{var t=e.texture;this.saveModal.querySelector(".watermark-control").sourceTexture=t},{textureSize:BFN.maxImageSize})}},this.toggleDragArea=function(e){this.dragDropArea.toggleClass("drag-drop-area--initial",e)},this.updateImageItems=function(){this.imageItems.splice(0),this.imageItems.push(...this.imagesContainer.querySelectorAll(".batch-item")),this.clearButton.setStyles({display:this.imageItems.length?"block":"none"}),this.saveButton.disabled=!this.imageItems.length,this.toggleDragArea(!this.imageItems.length)},this.getImageItems=function(){return[...this.imageItems]},this.getVisibleImageItems=function(){var e=[];return this.getImageItems().forEach((t,i)=>{var r=Math.floor(i/this.imagesPerRow)*(this.imageItemSize+4+4)+4-this.imagesContainer.scrollTop,a=r+(this.imageItemSize+4+4);(r>0&&r<this.imagesContainerH||a>0&&a<this.imagesContainerH)&&e.push(t)}),e},this.getTotalImageBytes=function(){var e=0;return this.getImageItems().forEach(t=>{var i=t.batchImageVO;i.imageBlob&&(e+=i.imageBlob.size)}),e},this.handleClose=(()=>{this.close()}),this.updateModalSize=(()=>{var e=BeFunky.isWindows&&BeFunky.isFirefox?20:15,t=this.imagesContainer.getBoundingClientRect();this.imagesContainerW=t.width-4-4-e,this.imagesContainerH=t.height,this.imagesPerRow=Math.ceil(this.imagesContainerW/this.imageItemMaxSize),this.imageItemSize=Math.floor(this.imagesContainerW/this.imagesPerRow)-4-4,this.getImageItems().forEach(e=>{this.updateImageItemSize(e)})}),this.handlePrimaryButtonListOrderUpdated=(()=>{var e=this.primaryButtons.listItems.map(e=>e.dataset.batchId);BFN.BatchToolManager._selectedIDs.splice(0),BFN.BatchToolManager._selectedIDs.push(...e),BFN.SettingsManager.updateSetting("batch_processing_fav",e.slice())}),this.init()}).bind(e)()),BFN.UI.buttonBar=((e,t)=>{var i=t.controlID,r=t.paramObject,a=r.name,n=r.defaultValue,o=void 0===n?null:n,s=r.data,l=void 0===s?null:s,h=r.useLabel,c=void 0!==h&&h;return function(){var e='\n        <label class="control-item-label" data-lang="'.concat(a,'">\n            ').concat(BeFunky.LanguageManager.getString(a),"\n        </label>\n    ");this.setAttribute("class","toggle-group"),c&&this.insertAdjacentHTML("beforebegin",e),this.init=function(){if(l){var e=l.length>2?"padding:.25rem; font-size:.75rem;":"",t=l.map(t=>{var r=t.name,a=t.value,n=t.tooltip;return'\n                <label class="toggle-group__label" '.concat(n?'data-bfntooltip="'.concat(n,'"'):"",'>\n                    <input type="radio" name="').concat(i,'" id="').concat(i,"_").concat(r,'" value="').concat(a,'" autocomplete="off" ').concat(o===a?'checked="checked"':"",'>\n                    <span class="toggle-group__button" style="').concat(e,'" data-lang="').concat(r,'">\n                        ').concat(BeFunky.LanguageManager.getString(r),"\n                    </span>\n                </label>\n            ")}).join("");this.insertAdjacentHTML("beforeend",t),UITools.registerRadioControl(i)}},this.init()}.bind(e)()}),BFN.UI.checkboxItem=((e,t)=>{var i=t.controlID,r=t.paramObject,a=r.name,n=r.description,o=r.checkboxColor;return function(){this.datasetClone=this.dataset,this.outerHTML='\n        <div class="checkbox '.concat(o?"checkbox--".concat(o):"",'">\n            <input type="checkbox" id="').concat(i,'">\n                <label class="checkbox__label control-item-label" for="').concat(i,'">\n                <svg class="icon icon-size-medium checkbox__icon checkbox__icon--checked">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkbox-selected"></use>\n                </svg>\n                <svg class="icon icon-size-medium checkbox__icon checkbox__icon--unchecked">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkbox-unselected"></use>\n                </svg>\n                <string data-lang="').concat(a,'">').concat(BeFunky.LanguageManager.getString(a),"</string>\n            </label>\n            ").concat(n?'<p class="checkbox__description" data-lang="'.concat(n,'">').concat(BeFunky.LanguageManager.getString(n),"</p>"):"","\n        </div>\n    "),this.init=function(){Object.assign(document.getElementById(i).dataset,this.datasetClone),UITools.registerCheckBoxControl(i)},this.init()}.bind(e)()}),BFN.UI.collageWizardModal=(e=>(function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.imageGallery=this.querySelector(".image-gallery"),BFN.UI.imageGallery(this.imageGallery,{imagesPerRow:2,imageSelectionHandler:this.handleImageSelection.bind(this),isSelected:this.isSelectedByDefault}),this.selectedMenuImageVOs=[],this.imageGalleryItems=[],this.selectImagesHeader=this.querySelector(".collage-wizard__left-panel .panel-header"),this.selectImagesHeader.selectEnabled=!0,this.selectImagesHeader.deselectEnabled=!0,this.selectImagesHeader.addEventListener("SELECT",this.handleSelectAll),this.selectImagesHeader.addEventListener("DESELECT",this.handleDeselectAll),this.useImagesButton=this.querySelector(".collage-wizard__use-images"),this.useImagesButton.addEventListener("click",this.handleUseImages),this.previewBox=this.querySelector(".collage-wizard__preview-inner"),this.previewImage=this.querySelector(".collage-wizard__preview-image"),this.prevButton=this.querySelector(".collage-wizard__prev-button"),this.prevButton.addEventListener("click",this.handlePrev),this.nextButton=this.querySelector(".collage-wizard__next-button"),this.nextButton.addEventListener("click",this.handleNext),this.selectCollageButton=this.querySelector(".collage-wizard__select-collage"),this.selectCollageButton.addEventListener("click",this.handleSelectCollage),BFN.HelpClueManager.setup("collage_wizard",{side:"right",positionFactor:0,container:this.querySelector(".collage-wizard__popover-placeholder")}),this.maxWidth=960},this.open=function(){BeFunky.openModal(this,{onOpen:()=>{this.toggleSelectCollageButton(!1),this.populateImages(),this.updateUseImagesButton(),this.handleUseImages()},onClose:()=>{this.clearImages(),this.updateUseImagesButton(),BFN.AutoCollage.reset()},onWindowResize:this.updateModalSize.bind(this)})},this.close=function(){BeFunky.closeModal(this)},this.populateImages=function(){var e=BFN.ImageLibraryManager.selectedMenuImageVOs;e.length||(e=BFN.ImageLibraryManager.sampleMenuImageVOs),e=e.map(e=>(e.thumbWidth=e.thumbHeight=Math.min(e.thumbWidth,e.thumbHeight),e)),this.selectedMenuImageVOs=e.filter(e=>{var t=e.id;return this.isSelectedByDefault(t)}),this.imageGallery.images=e,this.imageGalleryItems=[...this.imageGallery.querySelectorAll(".image-gallery__item")]},this.clearImages=function(){this.selectedMenuImageVOs=[],this.imageGallery.images=[]},this.isSelectedByDefault=function(e){return!!BFN.PhotoGrid.getGridMenuImageVOs().find(t=>t.id===e)},this.togglePrevButton=function(e){this.prevButton.disabled=!e},this.toggleNextButton=function(e){this.nextButton.disabled=!e,e&&BFN.HelpClueManager.show("collage_wizard").then(e=>{if(e){var t=()=>{this.nextButton.removeEventListener("click",t),BFN.HelpClueManager.hide("collage_wizard")};this.nextButton.addEventListener("click",t)}})},this.updatePreviewImage=function(e){"string"!=typeof e&&(e=""),requestAnimationFrame(()=>{var t=BFN.CollageMakerCanvasBackground.color;this.previewImage.toggleClass("collage-wizard__preview-image--is-transparent",-1===t).setStyles({backgroundColor:-1===t?"":"#".concat(t)}).src=e,this.previewBox.toggleClass("collage-wizard__preview-inner--has-image",!!e)})},this.toggleSelectCollageButton=function(e){this.selectCollageButton.disabled=!e},this.updateUseImagesButton=function(){this.useImagesButton.disabled=!this.selectedMenuImageVOs.length},this.handleImageSelection=function(e,t){if(t)this.selectedMenuImageVOs.push(e);else{var i=this.selectedMenuImageVOs.findIndex(t=>{return t.id===e.id});-1!==i&&this.selectedMenuImageVOs.splice(i,1)}return this.handleImageSelectionChange(),!0},this.handleImageSelectionChange=BeFunky.debounce(()=>{this.updateUseImagesButton(),BFN.AutoCollage.reset()},0),this.handleSelectAll=(()=>{requestAnimationFrame(()=>{this.imageGalleryItems.forEach(e=>{e.selected=!0})})}),this.handleDeselectAll=(()=>{requestAnimationFrame(()=>{this.imageGalleryItems.forEach(e=>{e.selected=!1})})}),this.handleUseImages=(()=>{if(this.selectedMenuImageVOs.length){this.useImagesButton.disabled=!0;try{BFN.BfnService.track("CREATE","COLLAGE","COLLAGE_WIZARD_USEDIMAGES")}catch(e){}BFN.AutoCollage.generateAutoCollage(this.selectedMenuImageVOs)}}),this.handlePrev=(()=>{BFN.AutoCollage.prevLayout()}),this.handleNext=(()=>{BFN.AutoCollage.nextLayout();try{BFN.BfnService.track("CREATE","COLLAGE","COLLAGE_WIZARD_BROWSED")}catch(e){}}),this.handleSelectCollage=(()=>{if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("COLLAGE","COLLAGE_WIZARD_UPGRADE","collage_wizard"),void BFN.UserActionManager.addUpgradeAction(["Select Collage Wizard Layout"]);BFN.CollageMakerCanvasPhotoGridModel.freeform&&BFN.CollageMakerCanvasModel.itemsExist?BeFunky.confirm("confirm_template_change",{onConfirm:this.selectCurrentLayout}):this.selectCurrentLayout()}),this.selectCurrentLayout=(()=>{BFN.AutoCollage.selectCurrentLayout(),BFN.BfnService.track("CREATE","COLLAGE","COLLAGE_WIZARD_SELECTED"),this.close()}),this.updateModalSize=(e=>{var t,i=e.availableWidth,r=e.availableHeight;t=i-145>=r?Math.min(this.maxWidth,r+145):Math.min(this.maxWidth,i),this.setStyles({width:"".concat(t,"px"),height:"".concat(t-145,"px")})}),this.init()}).bind(e)()),BFN.UI.colorButton=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(){this.addClass("color-button"),this.innerHTML='<div class="color-button-border">'+(t?"<string></string>":"")+"</div>",this.init=function(){this.initDefaultValues(),this.updateButtonDisplay(),BeFunky.isEdgeHTML&&"color_picker_panel_button"!==this.id&&(this.updateButtonDisplay=BeFunky.debounce(this.updateButtonDisplay.bind(this),150,!0))},this.initDefaultValues=function(){this._color=-1,this._hashColor=-1,this._intensity=1,this._intensityEnabled=!1,this._emptyEnabled=!0,this._borderEnabled=!1,this._fineChangeEnabled=!1,this._eyeDropperEnabled=!0,this._pickerName=null,t&&(this.innerString=this.querySelector("string")),this.buttonDisplayUpdatedEvent=new Event("button_display_updated")},this.updateButtonDisplay=(()=>requestAnimationFrame(()=>{this.toggleClass("empty",-1===this.hashColor),this.setStyles({backgroundColor:-1===this.hashColor?"":"#".concat(this.hashColor)}),this.dispatchEvent(this.buttonDisplayUpdatedEvent)})),Object.defineProperty(this,"color",{set(e){this._color!==e&&(this._color=e,this._hashColor=-1===e?-1:e.toString(16),"0"===this._hashColor&&(this._hashColor="000"),this.updateButtonDisplay())},get(){return this._color}}),Object.defineProperty(this,"hashColor",{set(e){this._hashColor!==e&&(t&&(this.innerString.innerHTML=e),this._hashColor=e,this._color=-1===e?-1:parseInt("0x".concat(e)),this.updateButtonDisplay())},get(){return this._hashColor}}),Object.defineProperty(this,"intensity",{set(e){this._intensity=e},get(){return this._intensity}}),Object.defineProperty(this,"intensityEnabled",{set(e){this._intensityEnabled=e},get(){return this._intensityEnabled}}),Object.defineProperty(this,"emptyEnabled",{set(e){this._emptyEnabled=e},get(){return this._emptyEnabled}}),Object.defineProperty(this,"borderEnabled",{set(e){this._borderEnabled!==e&&(this._borderEnabled=e,this.addClass("color-button-picker"))},get(){return this._borderEnabled}}),Object.defineProperty(this,"fineChangeEnabled",{set(e){this._fineChangeEnabled=e},get(){return this._fineChangeEnabled}}),Object.defineProperty(this,"eyeDropperEnabled",{set(e){this._eyeDropperEnabled=e},get(){return this._eyeDropperEnabled}}),Object.defineProperty(this,"pickerName",{set(e){this._pickerName=e},get(){return this._pickerName}}),this.init()}.bind(e)()},BFN.UI.colorItem=((e,t)=>{var i=t.controlID,r=t.paramObject,a=r.name,n=r.colorExistsButtonID,o=void 0===n?null:n;return function(){this.outerHTML='\n            <div id="'.concat(i,'_color_container" class="color-item">\n                <label class="control-item-label" data-lang="').concat(a,'">\n                    ').concat(BeFunky.LanguageManager.getString(a),"\n                </label>\n                ").concat(o?'<span class="color-exists-button-placeholder"></span>':"",'\n                <button id="').concat(i,'"></button>\n            </div>\n        '),this.init=function(){var e=document.getElementById("".concat(i,"_color_container")),t=document.getElementById(i);if(UITools.registerColorControl(i),t.setStyles({width:"1.875rem",height:"1.875rem"}),o){var r=document.getElementById(o);r&&(t.colorExistsButton=r,e.querySelector(".color-exists-button-placeholder").appendChild(r),a())}function a(){t.colorExistsButton&&t.colorExistsButton.setStyles({display:-1==t.color?"none":"block"})}t.addEventListener("button_display_updated",a)},this.init()}.bind(e)()}),BFN.UI.colorPalette=((e,t)=>{var i=t.controlID,r=t.paramObject,a=r.name,n=r.defaultValue,o=r.colors,s=void 0===o?null:o,l=r.presetsOnly,h=void 0!==l&&l,c=r.useLabel,u=void 0!==c&&c,d=r.displayValues,m=void 0!==d&&d,p=r.styleOverrides,g=void 0===p?null:p;return function(){var e='\n        <label class="control-item-label" style="margin-bottom: 0.75rem;" data-lang="'.concat(a,'">\n            ').concat(BeFunky.LanguageManager.getString(a),"\n        </label>\n    ");this.setAttribute("id","".concat(i,"_color_container")),u&&this.insertAdjacentHTML("beforebegin",e),this.init=function(){if(this.colorPresetButtons=[],s){var e=new Event("change"),t=0;s.map((r,a)=>{var o=document.createElement("div").addClass("color-button-row");this.appendChild(o),0===a&&(this.colorButton=document.createElement("button"),this.colorButton.id=i,this.colorButton.hashColor=n,this.colorButton.presetButtons=this,this.colorButton.setStyles({width:"2rem",height:"2rem"}),this.colorButton.addEventListener("change",()=>this.updateColorPresetButtons()),h&&this.colorButton.setStyles({display:"none"}),o.appendChild(this.colorButton),UITools.registerColorControl(i)),r.map((r,n)=>{var s=document.createElement("button").addClass("color-button-preset");s.id="".concat(i,"_preset_").concat(++t),BFN.UI.colorButton(s,m),s.addEventListener("click",t=>{this.colorButton.hashColor=t.currentTarget.hashColor,this.colorButton.dispatchEvent(e)}),s.hashColor=r,s.emptyEnabled=-1===r,g&&(g.global&&s.setStyles(g.global),g.unique&&g.unique[a]&&g.unique[a][n]&&s.setStyles(g.unique[a][n])),this.colorPresetButtons.push(s),o.appendChild(s)})}),this.updateColorPresetButtons()}},this.updateColorPresetButtons=function(){this.colorPresetButtons.map(e=>e.setStyles({boxShadow:e.color===this.colorButton.color?"inset 0 0 0 2px #EDEDED":"none"}))},this.hexToRGB=function(e){return[e>>16&255,e>>8&255,255&e]},this.init()}.bind(e)()}),BFN.UI.colorGroup=((e,t)=>{var i=t.controlID,r=t.paramObject,a=r.name,n=(r.defaultValue,r.colorGroupData),o=void 0===n?null:n,s=r.useLabel,l=void 0!==s&&s,h=r.intensityEnabled,c=void 0!==h&&h,u=r.intensityWhileTransparent,d=void 0!==u&&u,m=r.emptyEnabled,p=void 0===m||m,g=r.hueLocked,f=void 0!==g&&g,v=r.fineChangeEnabled,y=void 0!==v&&v,x=r.eyeDropperEnabled,_=void 0===x||x,I=r.colorsPerRow,T=void 0===I?5:I,b=r.maxVisibleRows,S=void 0===b?2:b;return function(){var e=new Event("change"),t=new Event("finechange"),r='\n        <label class="control-item-label" style="margin-bottom: 0.75rem;" data-lang="'.concat(a,'">\n            ').concat(BeFunky.LanguageManager.getString(a),"\n        </label>\n    ");this.setAttribute("id","".concat(i,"_color_container"));var n=31*S+12*(S-1)+2*Math.min(2,S);this.setStyles({overflowY:"auto",maxHeight:"".concat(n,"px")}),l&&this.insertAdjacentHTML("beforebegin",r),this.init=function(){this.colorButtons=[],this.colorButtonPool=[],this.colorButtonPlaceholders=[],this.colorButtonPlaceholderPool=[],this.colorButtonRows=[],this.colorButtonRowPool=[],this.masterColorButton=document.createElement("button"),this.masterColorButton.id=i,this.masterColorButton.setStyles({display:"none",width:"2rem",height:"2rem"}),this.masterColorButton.colorGroup=this,this.appendChild(this.masterColorButton),UITools.registerColorControl(i),this.setColorGroupData(o)},this.setColorGroupData=function(e){if(this.resetColorGroup(),e&&e.length){e.forEach(e=>{if(e.hasOwnProperty("color")){var t=this.getColorButton();t.index=this.colorButtons.length,t.groupID=e.hasOwnProperty("id")?e.id:t.index,t.pickerName="".concat(BeFunky.LanguageManager.getString("color")," # ").concat(t.index+1),t.hashColor=e.color,t.intensity=c&&e.hasOwnProperty("intensity")?Math.max(0,Math.min(1,e.intensity)):1,this.colorButtons.push(t)}});var t=null;if(this.colorButtons.forEach(e=>{e.index%T==0&&((t=this.getColorButtonRow()).colorsNum=0,this.colorButtonRows.push(t),this.appendChild(t)),t.colorsNum++,t.appendChild(e)}),t)for(var i=t.colorsNum;i<T;i++){var r=this.getColorButtonPlaceholder();this.colorButtonPlaceholders.push(r),t.appendChild(r)}}},this.resetColorGroup=function(){this.colorButtons.forEach(e=>{e.parentElement.removeChild(e)}),this.colorButtonPool.push(...this.colorButtons),this.colorButtons.splice(0),this.colorButtonPlaceholders.forEach(e=>{e.parentElement.removeChild(e)}),this.colorButtonPlaceholderPool.push(...this.colorButtonPlaceholders),this.colorButtonPlaceholders.splice(0),this.colorButtonRows.forEach(e=>{e.parentElement.removeChild(e)}),this.colorButtonRowPool.push(...this.colorButtonRows),this.colorButtonRows.splice(0)},this.getColorButton=function(){return this.colorButtonPool.shift()||this.createColorButton()},this.createColorButton=function(){var r=document.createElement("button");return BFN.UI.colorButton(r),r.intensityEnabled=c,r.intensityWhileTransparent=d,r.emptyEnabled=p,r.hueLocked=f,r.borderEnabled=!0,r.fineChangeEnabled=y,r.eyeDropperEnabled=_,r.addEventListener("click",e=>{var t=e.currentTarget,r=UITools.controlToolIDs[i],a=i.replace("".concat(r,"_"),"");UITools.setToolValue(r,"".concat(a,"_index"),t.index),UITools.setToolValue(r,"".concat(a,"_group_id"),t.groupID),document.getElementById("color_picker_panel").colorButton=t}),r.addEventListener("change",t=>{var i=t.currentTarget;this.masterColorButton.hashColor=i.hashColor,c&&(this.masterColorButton.intensity=i.intensity),this.masterColorButton.dispatchEvent(e)}),y&&r.addEventListener("finechange",e=>{var i=e.currentTarget;this.masterColorButton.hashColor=i.hashColor,c&&(this.masterColorButton.intensity=i.intensity),this.masterColorButton.dispatchEvent(t)}),r},this.getColorButtonPlaceholder=function(){return this.colorButtonPlaceholderPool.shift()||this.createColorButtonPlaceholder()},this.createColorButtonPlaceholder=function(){return document.createElement("div").setStyles({width:"2rem",height:"2rem"})},this.getColorButtonRow=function(){return this.colorButtonRowPool.shift()||this.createColorButtonRow()},this.createColorButtonRow=function(){return document.createElement("div").addClass("color-button-row")},this.init()}.bind(e)()}),BFN.UI.colorPickerGrid=(e=>(function(){this.addClass("color-picker-grid"),this.init=function(){this.initDefaultValues(),this.initCommonSquares(),this.initSpectrumSquares(),this.innerHTML=this.markup,this.changeEvent=new Event("change");var e=document.getElementById("color_picker_panel"),t=document.getElementById("color_picker_panel_input"),i=document.getElementById("color_picker_panel_button"),r=document.getElementById("color_picker_panel_color_picker_hsv");function a(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return(isNaN(e)?"00":t[(e-e%16)/16]+t[e%16]).toUpperCase()}this.addEventListener(BeFunky.pointerover,e=>{if(e.target.hasClass("color-picker-grid-square")){var r=function(e){return a((e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))[1])+a(e[2])+a(e[3])}(getComputedStyle(e.target).getPropertyValue("background-color"));t.value=i.hashColor=r}}),this.addEventListener(BeFunky.pointerout,()=>{var e=r.hashColor.toUpperCase();t.value=i.hashColor=e}),this.addEventListener(BeFunky.pointerdown,()=>{if(r.color=document.getElementById("color_picker_panel_button").color,e.colorButton){var t=r.hashColor.toUpperCase();e.colorButton.hashColor=t,e.colorButton.dispatchEvent(e.fineChangeEvent)}r.dispatchEvent(this.changeEvent)})},this.initDefaultValues=function(){this.markup=""},this.initCommonSquares=function(){for(var e=[],t=0,i=0;i<6;i++)e.push('\n                <div class="color-picker-grid-square" style="background-color:#'.concat((16777216|t).toString(16).slice(1),';"></div>\n            ')),t+=3355443;[16711680,65280,255,16776960,65535,16711935].map(t=>{e.push('\n                <div class="color-picker-grid-square" style="background-color:#'.concat((16777216|t).toString(16).slice(1),';"></div>\n            '))}),this.markup='\n            <div class="color-picker-grid-common">\n                '.concat(e.join(""),"\n            </div>\n        ")},this.initSpectrumSquares=function(){for(var e=[],t=0;t<216;++t){var i=51*(Math.floor(t/6)%3+2*Math.floor(t/108))<<16|Math.floor(t/18)%6*51<<8|t%6*51;e.push('\n                <div class="color-picker-grid-square" style="background-color:#'.concat((16777216|i).toString(16).slice(1),';"></div>\n            '))}this.markup+='\n            <div class="color-picker-grid-spectrum">\n                '.concat([...Array(12).keys()].map(t=>'\n            <div class="color-picker-grid-spectrum-row">\n                '.concat(e.slice(18*t,18*(t+1)).join(""),"\n            </div>\n        ")).join(""),"\n            </div>\n        ")},this.init()}).bind(e)()),BFN.UI.colorPickerHSV=(e=>(function(){var e=this;this.addClass("color-picker-hsv"),this.innerHTML='\n        <div class="color-picker-hsv-h">\n            <div class="color-picker-hsv-h-indicator">\n                <div class="color-picker-hsv-h-indicator-display"></div>\n            </div>\n        </div>\n        <div class="color-picker-hsv-sv">\n            <div class="color-picker-hsv-sv-indicator">\n                <div class="color-picker-hsv-sv-indicator-display"></div>\n            </div>\n        </div>\n    ',this.init=function(){this.initDefaultValues(),this.initPickerHSV(),this.updateIndicators()},this.initDefaultValues=function(){this._color=16711680,this.h=0,this.s=1,this.v=1,this.updating=!1,this.baseRect={width:0,height:0,left:0,top:0,right:0,bottom:0},this.changeEvent=new Event("change")},this.initPickerHSV=function(){function e(e,t,i){var r=document.createElementNS("http://www.w3.org/2000/svg",e);for(var a in t)r.setAttribute(a,t[a]);"[object Array]"!==Object.prototype.toString.call(i)&&(i=[i]);for(var n=0,o=i[0]&&i.length||0;n<o;n++)r.appendChild(i[n]);return r}var t={xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",oncontextmenu:"return false"},i=e("svg",t,[e("defs",{},e("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[e("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),e("stop",{offset:"16.7%","stop-color":"#FF00FF","stop-opacity":"1"}),e("stop",{offset:"33.3%","stop-color":"#0000FF","stop-opacity":"1"}),e("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),e("stop",{offset:"66.7%","stop-color":"#00FF00","stop-opacity":"1"}),e("stop",{offset:"83.3%","stop-color":"#FFFF00","stop-opacity":"1"}),e("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),e("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]);this.pickerH=this.querySelector(".color-picker-hsv-h"),this.pickerH.appendChild(i),this.pickerH.addEventListener(BeFunky.pointerdown,this.handlePickerHPressed),this.pickerH.addEventListener("dragstart",e=>e.preventDefault()),this.pickerIndicatorH=this.querySelector(".color-picker-hsv-h-indicator"),this.pickerIndicatorDisplayH=this.querySelector(".color-picker-hsv-h-indicator-display");var r=e("svg",t,[e("defs",{},[e("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[e("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),e("stop",{offset:"100%","stop-color":"#000000","stop-opacity":"0"})]),e("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[e("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),e("stop",{offset:"100%","stop-color":"#FFFFFF","stop-opacity":"0"})])]),e("rect",{x:"-1%",y:"-1%",width:"102%",height:"102%",fill:"url(#gradient-white)"}),e("rect",{x:"-1%",y:"-1%",width:"102%",height:"102%",fill:"url(#gradient-black)"})]);this.pickerSV=this.querySelector(".color-picker-hsv-sv"),this.pickerSV.appendChild(r),this.pickerSV.addEventListener(BeFunky.pointerdown,this.handlePickerSVPressed),this.pickerSV.addEventListener("dragstart",e=>e.preventDefault()),this.pickerIndicatorSV=this.querySelector(".color-picker-hsv-sv-indicator"),this.pickerIndicatorDisplaySV=this.querySelector(".color-picker-hsv-sv-indicator-display"),this.pickerIndicatorDisplaySV.addEventListener(BeFunky.pointerdown,e=>{this.handlePickerSVPressed(e),e.stopPropagation()})},this.setColor=function(e){this._color=e;var t=this.hex2hsv(e);this.h=t.h,this.s=t.s,this.v=t.v,this.updateIndicators()},this.updateColor=function(){this._color=parseInt(this.hsv2rgb({h:this.h,s:this.s,v:this.v}).hex.replace("#",""),16)},this.updateIndicators=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];cancelAnimationFrame(e.updateIndicatorsAF),e.updateIndicatorsAF=requestAnimationFrame(()=>{if(t){var i=e.hsv2rgb({h:e.h,s:1,v:1}).hex;e.pickerIndicatorDisplayH.setStyles({backgroundColor:i}),e.pickerSV.setStyles({backgroundColor:i}),e.pickerIndicatorH.setStyles({transform:"translateY(".concat(Math.round(e.h/360*120),"px)")})}var r=180,a=120,n=Math.round(e.s*r),o=Math.round((1-e.v)*a);e.pickerIndicatorSV.setStyles({transform:"translateX(".concat(n,"px) translateY(").concat(o,"px)")}),e.pickerIndicatorDisplaySV.setStyles({backgroundColor:"#".concat(e.hashColor)})})},this.hsv2rgb=function(e){var t,i,r,a,n,o=e.h,s=e.s,l=e.v;o=o%360/60,t=i=r=l-(n=l*s),t+=[n,a=n*(1-Math.abs(o%2-1)),0,0,a,n][o=~~o],i+=[a,n,n,a,0,0][o],r+=[0,0,a,n,n,a][o];var h=Math.floor(255*t),c=Math.floor(255*i),u=Math.floor(255*r);return{r:h,g:c,b:u,hex:"#".concat((16777216|u|c<<8|h<<16).toString(16).slice(1))}},this.rgb2hsv=function(e){var t,i,r=e.r,a=e.g,n=e.b;return(r>1||a>1||n>1)&&(r/=255,a/=255,n/=255),{h:(0===(i=(t=Math.max(r,a,n))-Math.min(r,a,n))?null:t===r?(a-n)/i+(a<n?6:0):t===a?(n-r)/i+2:(r-a)/i+4)%6*60,s:0===i?0:i/t,v:t}},this.hex2rgb=function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}},this.hex2hsv=function(e){return this.rgb2hsv(this.hex2rgb(e))},this.handlePickerHPressed=(e=>{document.addEventListener(BeFunky.pointermove,this.handlePickerHMove),document.addEventListener(BeFunky.pointerup,this.handlePickerHReleased);var t=this.pickerH.getBoundingClientRect();this.baseRect.width=0,this.baseRect.height=t.height,this.baseRect.left=t.left,this.baseRect.top=t.top,this.updating=!0,this.handlePickerHMove(e,!1)}),this.handlePickerSVPressed=(e=>{document.addEventListener(BeFunky.pointermove,this.handlePickerSVMove),document.addEventListener(BeFunky.pointerup,this.handlePickerSVReleased);var t=this.pickerSV.getBoundingClientRect();this.baseRect.width=t.width,this.baseRect.height=t.height,this.baseRect.left=t.left,this.baseRect.top=t.top,this.updating=!0,this.handlePickerSVMove(e,!1)}),this.handlePickerHMove=function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=Math.max(0,Math.min(e.baseRect.height,t.pageY-e.baseRect.top));e.h=r/e.baseRect.height*360,e.updateColor(),e.updateIndicators(),i?e.throttleDispatchChangeEvent():e.dispatchEvent(e.changeEvent)},this.handlePickerSVMove=function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=Math.max(0,Math.min(e.baseRect.width,t.pageX-e.baseRect.left)),a=Math.max(0,Math.min(e.baseRect.height,t.pageY-e.baseRect.top));e.s=r/e.baseRect.width,e.v=1-a/e.baseRect.height,e.updateColor(),e.updateIndicators(!1),i?e.throttleDispatchChangeEvent():e.dispatchEvent(e.changeEvent)},this.throttleDispatchChangeEvent=BeFunky.throttle(()=>requestAnimationFrame(()=>{this.updating&&this.dispatchEvent(this.changeEvent)}),BeFunky.isEdgeHTML?66:33,!0),this.handlePickerHReleased=(()=>{document.removeEventListener(BeFunky.pointermove,this.handlePickerHMove),document.removeEventListener(BeFunky.pointerup,this.handlePickerHReleased),this.updating=!1,this.dispatchEvent(this.changeEvent)}),this.handlePickerSVReleased=(()=>{document.removeEventListener(BeFunky.pointermove,this.handlePickerSVMove),document.removeEventListener(BeFunky.pointerup,this.handlePickerSVReleased),this.updating=!1,this.dispatchEvent(this.changeEvent)}),Object.defineProperty(this,"color",{set(e){this.setColor(e)},get(){return this._color}}),Object.defineProperty(this,"hashColor",{get(){return(16777216|this._color).toString(16).slice(1)}}),Object.defineProperty(this,"hLocked",{set(e){e?this.pickerH.addClass("locked"):this.pickerH.removeClass("locked")},get(){return this.pickerH.hasClass("locked")}}),this.init()}).bind(e)()),BFN.UI.colorPickerPanel=(e=>(function(){this.init=function(){this.initDefaultValues(),this.initColorButton(),this.initColorInput(),this.initEmptyButton(),this.initColorPickerHSV(),this.initColorPickerGrid(),this.initSpectrumButton(),this.initEyeDropperButton()},this.initDefaultValues=function(){this._colorButton=null,this._gridEnabled=!1,this.zIndexOverFabric=!0,this.zIndexOverModal=!0,this._strong=!1,this.panelHeader=this.querySelector(".panel-header"),BFN.UI.panelHeader(this.panelHeader,{name:"color_picker",modifier:"alternate"}),this.intensityContainer=document.getElementById("color_picker_panel_intensity_container"),this.emptyButtonClicked=!1,this.changeEvent=new Event("change"),this.fineChangeEvent=new Event("finechange")},this.initColorButton=function(){this.colorButtonInPanel=document.getElementById("color_picker_panel_button"),BFN.UI.colorButton(this.colorButtonInPanel)},this.initColorInput=function(){this.colorInput=document.getElementById("color_picker_panel_input"),this.colorInput.addEventListener("change",this.handleColorInputChange),this.colorInput.addEventListener("click",this.handleColorInputClick)},this.initEmptyButton=function(){this.emptyButton=document.getElementById("color_picker_panel_empty"),BFN.UI.colorButton(this.emptyButton),this.emptyButton.addEventListener("click",this.handleEmptyButtonClick)},this.initColorPickerHSV=function(){this.colorPickerHSV=document.getElementById("color_picker_panel_color_picker_hsv"),BFN.UI.colorPickerHSV(this.colorPickerHSV),this.colorPickerHSV.addEventListener("change",this.handleColorPickerHSVChange)},this.initColorPickerGrid=function(){this.colorPickerGrid=document.getElementById("color_picker_panel_color_picker_grid"),BFN.UI.colorPickerGrid(this.colorPickerGrid)},this.initSpectrumButton=function(){this.spectrumButton=document.getElementById("color_picker_panel_spectrum_button"),this.spectrumButton.addEventListener("click",()=>{this.gridEnabled=!this.gridEnabled})},this.initEyeDropperButton=function(){this.eyeDropperActive=!1,this.eyeDropperButton=document.getElementById("color_picker_panel_eyedropper"),this.eyeDropperButton.addEventListener("click",this.handleEyeDropperClick)},this.handlePicker=function(){if(this._colorButton){var e=UITools.getToolVO("color_picker_panel");"intensity"===e.updating_id&&(this._colorButton.fineChangeEnabled&&e.updating?(this._colorButton.intensity=e.intensity/100,this._colorButton.dispatchEvent(this.fineChangeEvent)):e.updating||(this._colorButton.intensity=e.intensity/100,this._colorButton.dispatchEvent(this.fineChangeEvent),this._colorButton.dispatchEvent(this.changeEvent)))}},this.handleColorButtonUpdated=function(){if(this.hide(),document.removeEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown,!0),this.gridEnabled=!1,this._colorButton){document.addEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown,!0),UITools.setToolValue("color_picker_panel","intensity",Math.round(100*this._colorButton.intensity)),UITools.updateToolControl("color_picker_panel_intensity"),this.updateIntensitySliderDisplay(!1);var e=this._colorButton.getBoundingClientRect(),t=(e.width-31)/2,i=Math.floor(e.left+e.width-t+20),r=Math.floor(e.top+t);this.show(i,r),this.emptyButton.setStyles({display:this._colorButton.emptyEnabled?"block":"none"}),this.eyeDropperButton.setStyles({display:this._colorButton.eyeDropperEnabled&&!BeFunky.isModalOpen()?"block":"none"}),this.colorPickerHSV.hLocked=this._colorButton.hueLocked,this._colorButton.hueLocked?(this.colorInput.setAttribute("readonly",""),this.spectrumButton.addClass("hidden")):(this.colorInput.removeAttribute("readonly"),this.spectrumButton.removeClass("hidden")),-1===this._colorButton.hashColor?(this.colorInput.value="FF0000",this.colorPickerHSV.color=16711680,this.colorButtonInPanel.color=-1):(this.colorInput.value=this._colorButton.hashColor.toUpperCase(),this.colorPickerHSV.color=this._colorButton.color,this.colorButtonInPanel.color=this._colorButton.color),this._colorButton.pickerName?this.panelHeader.headingText=this._colorButton.pickerName:this.panelHeader.headingText="color_picker"}},this.updateGridDisplay=function(){this.spectrumButton.toggleClass("active",!this.gridEnabled),this.colorPickerHSV.toggleClass("active",!this.gridEnabled),this.colorPickerGrid.toggleClass("active",this.gridEnabled)},this.updateIntensitySliderDisplay=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._colorButton.intensityEnabled&&(-1!==this._colorButton.hashColor||this._colorButton.intensityWhileTransparent);if(t!==this.intensityContainer.isEnabled&&(this.intensityContainer.isEnabled=t,this.intensityContainer.setStyles({display:t?"block":"none"}),this._panelSize=null,e)){var i=parseInt(this.style.left.replace("px","")),r=parseInt(this.style.top.replace("px",""));this.setPosition(i,r)}},this.refreshIntensitySlider=function(){this.colorButton&&this.colorButton.intensityEnabled&&(UITools.setToolValue("color_picker_panel","intensity",100*this.colorButton.intensity),UITools.updateToolControl("color_picker_panel_intensity"))},this.handleColorInputChange=(()=>{var e=this.colorInput.value;e.startsWith("#")&&(e=e.slice(1)),e.length>6&&(e=e.slice(0,6)),function(e){var t=parseInt(e,16);t=t.toString(16);for(;t.length<e.length;)t="0".concat(t);return t===e.toLowerCase()}(e)&&(this.colorButtonInPanel.hashColor=function(e){return(16777216|parseInt(e,16)).toString(16).slice(1)}(e),this.colorPickerHSV.setColor(parseInt(this.colorButtonInPanel.hashColor,16))),this.colorInput.value=this.colorPickerHSV.hashColor.toUpperCase(),this._colorButton&&(this._colorButton.hashColor=this.colorPickerHSV.hashColor,this._colorButton.dispatchEvent(this.fineChangeEvent),this._colorButton.dispatchEvent(this.changeEvent),this.updateIntensitySliderDisplay()),this.colorInput.blur()}),this.handleColorInputClick=(()=>{this.colorInput.select()}),this.handleEmptyButtonClick=(()=>{this.colorButtonInPanel.hashColor=-1,this._colorButton&&(this.emptyButtonClicked=!0,this._colorButton.hashColor=-1,this._colorButton.dispatchEvent(this.fineChangeEvent),this._colorButton.dispatchEvent(this.changeEvent),this.emptyButtonClicked=!1,this.updateIntensitySliderDisplay())}),this.handleColorPickerHSVChange=(()=>{var e=this.colorPickerHSV.hashColor.toUpperCase();this.colorInput.value=e,this.colorButtonInPanel.hashColor=e,this._colorButton&&(this._colorButton.fineChangeEnabled&&this.colorPickerHSV.updating?(this._colorButton.hashColor=e,this._colorButton.dispatchEvent(this.fineChangeEvent)):this.colorPickerHSV.updating||(this._colorButton.hashColor=e,this._colorButton.dispatchEvent(this.changeEvent)),this.updateIntensitySliderDisplay())}),this.handleEyeDropperColorChange=(e=>requestAnimationFrame(()=>{this.colorButtonInPanel.hashColor=e,this.colorInput.value=-1===e?"FF0000":e.toUpperCase(),this.colorPickerHSV.color=-1===e?16711680:parseInt(e,16),this._colorButton&&(this._colorButton.hashColor=e,this._colorButton.dispatchEvent(this.fineChangeEvent),this._colorButton.dispatchEvent(this.changeEvent),this.updateIntensitySliderDisplay())})),this.handleDocumentMouseDown=(e=>{this.eyeDropperActive||this.contains(e.target)||(e.target===this.colorButton&&(e.target.disabled=!0,requestAnimationFrame(()=>e.target.disabled=!1)),this.colorButton=null)}),this.handleEyeDropperClick=(()=>{if(this.eyeDropperButton.hasClass("active"))return BeFunky.logError("Eyedropper activated twice. This should never happen.");this.eyeDropperActive=!0,this.eyeDropperButton.addClass("active");var e="1e2024",t=this.colorButton.hashColor,i=BFN.MainUI.getFlattenedImage(),r=i.width,a=i.height,n=BFN.Stage.extract.pixels(i),o=BFN.Stage.view,s=document.querySelector(".upper-canvas"),l=document.getElementById("secondary-panel"),h=t,c=e=>{var i=!1;e.target!==o&&e.target!==s&&(i=!0);var r=BFN.appViewportRect;e.pageX<r.x||e.pageX>r.x+r.width||e.pageY<r.y||e.pageY>r.y+r.height?i=!0:e.pageX<=BFN.CSS.leftMenuBarWidth+230&&e.pageY<=BFN.appRect.height&&(l.hasClass("open")||l.hasClass("fold"))&&(i=!0);var a=g(),n=a.x,c=a.y,u=a.hex;BFN.EyeDropper.update(n,c),h=i?t:u},u=e=>{this.eyeDropperActive=!1,e.type===BeFunky.pointerdown&&(e.preventDefault(),e.stopImmediatePropagation()),document.removeEventListener(BeFunky.pointermove,c,!0),document.removeEventListener(BeFunky.pointerdown,u,!0),window.removeEventListener("resize",u),this.eyeDropperButton.removeClass("active"),this.eyeDropperButton.disabled=!0,setTimeout(()=>this.eyeDropperButton.disabled=!1,300),c(e),BFN.EyeDropper.deactivate(),this.handleEyeDropperColorChange(h)},d=g(),m=d.x,p=d.y;function g(){var t=BFN.MainUI.getPointerPosition(BFN.MainUI.pointerEvent),i=t.x,o=t.y;if(i=Math.round(i),o=Math.round(o),i<0||o<0||i>=r||o>=a)return{hex:e,x:i,y:o};var s=o*r*4+4*i;return{hex:f(...n.slice(s,s+3)),x:i,y:o}}function f(e,t,i){return r(e)+r(t)+r(i);function r(e){var t=e.toString(16);return 1===t.length?"0".concat(t):t}}m-=BFN.MainUI.x,BFN.EyeDropper.activate(i,m,p),document.addEventListener(BeFunky.pointermove,c,!0),document.addEventListener(BeFunky.pointerdown,u,!0),window.addEventListener("resize",u)}),Object.defineProperty(this,"colorButton",{set(e){!e&&this._strong||(this._colorButton=e,this.handleColorButtonUpdated())},get(){return this._colorButton}}),Object.defineProperty(this,"gridEnabled",{set(e){this._gridEnabled=e,this.updateGridDisplay()},get(){return this._gridEnabled}}),Object.defineProperty(this,"strong",{set(e){this._strong=e},get(){return this._strong}}),this.init()}).bind(e)()),BFN.UI.createGroupModal=((e,t)=>(function(){var e=()=>{this.input=this.querySelector(".create-group__input"),this.preventGroupDeselection=(e=>e.stopPropagation())},i=()=>{this.cancelButton=this.querySelector(".create-group__cancel"),this.createButton=this.querySelector(".create-group__create")},r=()=>{this.cancelButton.addEventListener("click",()=>this.close()),this.createButton.addEventListener("click",()=>this.createHandler()),this.input.addEventListener("keydown",a)};this.open=function(){BeFunky.openModal(this,{onOpen:()=>{this.input.value="",this.input.focus(),document.addEventListener(BeFunky.pointerdown,this.preventGroupDeselection,!0)},onClose:()=>{document.removeEventListener(BeFunky.pointerdown,this.preventGroupDeselection,!0)},size:"extra-small"})},this.close=function(){BeFunky.closeModal(this)},this.createHandler=function(){var e=this.input.value.trim();e.length&&(t(e),this.close())};var a=e=>{27===e.keyCode?this.close():13===e.keyCode&&this.createHandler()};e(),i(),r()}).bind(e)()),BFN.UI.cursorScreen=(e=>(function(){var e=this;this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=this.getNativeArrowCursor,t="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cpath id='b' d='M22.86 14v-3L28 16l-5.14 5v-3H9.14v3L4 16l5.14-5v3h13.72z'/%3e %3cfilter id='a' width='137.7%25' height='190.5%25' x='-18.9%25' y='-45.3%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.18' result='shadowSpreadOuter1'/%3e %3cfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' transform='rotate(0 16 16)'%3e %3cuse fill='black' filter='url(%23a)' xlink:href='%23b'/%3e %3cuse fill='black' xlink:href='%23b'/%3e %3cpath stroke='white' d='M22.36 13.5V9.82L28.72 16l-6.36 6.18V18.5H9.64v3.68L3.28 16l6.36-6.18v3.68h12.72z'/%3e %3c/g%3e %3c/svg%3e",i="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cfilter id='a' width='142.5%25' height='142.5%25' x='-21.2%25' y='-21.2%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.18' result='shadowSpreadOuter1'/%3e %3cfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' result='shadowMatrixOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3cfeMerge%3e %3cfeMergeNode in='shadowMatrixOuter1'/%3e %3cfeMergeNode in='SourceGraphic'/%3e %3c/feMerge%3e %3c/filter%3e %3cpath id='b' d='M14.86 20.43h1.85L13 26l-3.71-5.57h1.85v-5.57H5.57v1.85L0 13l5.57-3.71v1.85h5.57V5.57H9.3L13 0l3.71 5.57h-1.85v5.57h5.57V9.3L26 13l-5.57 3.71v-1.85h-5.57v5.57z'/%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' filter='url(%23a)' transform='translate(3 3)'%3e %3cuse fill='black' xlink:href='%23b'/%3e %3cpath stroke='white' d='M15.36 19.93h2.29L13 26.9l-4.65-6.97h2.3v-4.57H6.06v2.29L-.9 13l6.97-4.65v2.3h4.57V6.06H8.35L13-.9l4.65 6.97h-2.3v4.57h4.58V8.35L26.9 13l-6.97 4.65v-2.3h-4.57v4.58z'/%3e %3c/g%3e %3c/svg%3e",r="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cfilter id='a' width='147.9%25' height='138.7%25' x='-21.5%25' y='-21.2%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.18' result='shadowSpreadOuter1'/%3e %3cfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' result='shadowMatrixOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3cfeMerge%3e %3cfeMergeNode in='shadowMatrixOuter1'/%3e %3cfeMergeNode in='SourceGraphic'/%3e %3c/feMerge%3e %3c/filter%3e %3cpath id='b' d='M12.8 8.36a7.5 7.5 0 1 0 5.2 7.55h3a10.5 10.5 0 1 1-8.2-10.66l-3.21-3.2L11.63 0l4.77 4.77 2.05 2.04-6.82 6.81-2.04-2.04 3.22-3.22z'/%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' filter='url(%23a)' transform='translate(5 3)'%3e %3cuse fill='%231E2024' xlink:href='%23b'/%3e %3cpath stroke='white' d='M11.83 8.63a7 7 0 1 0 5.66 7.26l.03-.48h4l-.02.52a11 11 0 1 1-10.13-11.4L8.88 2.04 11.63-.7l4.77 4.77 2.75 2.75-7.52 7.52-2.75-2.75 2.95-2.95z'/%3e %3c/g%3e %3c/svg%3e",a="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cpath id='b' d='M27.07 16.81l1.97-1.22-.98 7.23-6.3-2.72 1.97-1.22C22.48 15.43 19.49 13 16 13c-3.5 0-6.5 2.44-7.74 5.91l1.92 1.2-6.3 2.7-.99-7.22 2.03 1.25C6.77 12.23 11.04 9 16 9c4.95 0 9.21 3.21 11.07 7.81z'/%3e %3cfilter id='a' width='134.8%25' height='164.6%25' x='-17.4%25' y='-32.3%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.18' result='shadowSpreadOuter1'/%3e %3cfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' transform='rotate(0 16 16)'%3e %3cuse fill='black' filter='url(%23a)' xlink:href='%23b'/%3e %3cuse fill='black' xlink:href='%23b'/%3e %3cpath stroke='white' d='M27.3 16.08l2.38-1.48-1.22 8.94-7.78-3.36 2.43-1.5c-1.28-3.13-4.04-5.18-7.11-5.18-3.08 0-5.85 2.06-7.13 5.2l2.38 1.48-7.78 3.36-1.22-8.94 2.44 1.5C6.76 11.52 11.12 8.5 16 8.5c4.87 0 9.22 3 11.3 7.58z'/%3e %3c/g%3e %3c/svg%3e",n="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cpath id='b' d='M17.86 23.6c-.14.33-.39.75-.67 1.31A7.05 7.05 0 0 1 6 26.69l.6-1.33 1.9 1.14c2.4 1.37 5.4.41 6.87-1.98-1.98.57-4.02-.23-4.67-1.89-.35-.9-.22-1.9.27-2.75A6.83 6.83 0 0 1 9.5 15.7c0-4.42 4.48-8 10-8s10 3.58 10 8-4.48 8-10 8c-.56 0-1.1-.04-1.64-.1zm.53-1.96c.37.04.73.06 1.11.06 4.46 0 8-2.73 8-6s-3.54-6-8-6-8 2.73-8 6c0 .98.32 1.91.89 2.74.26-.17.55-.32.86-.43 2.1-.8 4.36 0 5.05 1.76a3 3 0 0 1 .1 1.87zm-4.7-2.45c-1.44.48-2.23 1.76-1.75 2.84.47 1.08 2.03 1.57 3.47 1.08 1.44-.48 2.23-1.76 1.75-2.84-.47-1.08-2.03-1.57-3.47-1.08z'/%3e %3cfilter id='a' width='135.7%25' height='140%25' x='-17.9%25' y='-15.2%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='.9' result='shadowSpreadOuter1'/%3e %3cfeOffset dy='1' in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3cpath id='d' d='M2.5 2.5l7 2.5L6 6 4.5 9.5z'/%3e %3cfilter id='c' width='235.3%25' height='232.9%25' x='-66.4%25' y='-52.1%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.05' result='shadowSpreadOuter1'/%3e %3cfeOffset dy='1' in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd'%3e %3cg fill-rule='nonzero'%3e %3cuse fill='black' filter='url(%23a)' xlink:href='%23b'/%3e %3cuse fill='black' fill-rule='evenodd' xlink:href='%23b'/%3e %3cpath stroke='white' d='M18.16 24.13a14.97 14.97 0 0 1-.53 1.01 7.55 7.55 0 0 1-11.98 1.9l-.25-.24.98-2.16.48.3c.9.55 1.53.92 1.89 1.13a4.52 4.52 0 0 0 5.45-.87c-1.76.04-3.36-.86-3.96-2.39a3.6 3.6 0 0 1 .14-2.89A7.27 7.27 0 0 1 9 15.7c0-4.72 4.72-8.5 10.5-8.5S30 10.98 30 15.7c0 4.72-4.72 8.5-10.5 8.5-.45 0-.9-.02-1.34-.07zm.82-2.94l.52.01c4.17 0 7.5-2.52 7.5-5.5s-3.33-5.5-7.5-5.5-7.5 2.52-7.5 5.5c0 .71.19 1.41.56 2.07.16-.09.34-.16.51-.23 2.34-.88 4.9.01 5.7 2.05.2.51.27 1.05.21 1.6zm-5.13-1.53c-1.19.4-1.8 1.39-1.45 2.17.36.82 1.63 1.22 2.85.8 1.19-.4 1.8-1.38 1.45-2.16-.36-.82-1.63-1.22-2.85-.8z'/%3e %3c/g%3e %3cuse fill='black' filter='url(%23c)' xlink:href='%23d'/%3e %3cuse fill='black' xlink:href='%23d'/%3e %3cpath stroke='white' d='M6.37 6.42L4.4 10.99 1.75 1.7l9.38 3.35-4.76 1.37z'/%3e %3c/g%3e %3c/svg%3e",o="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cpath id='b' d='M17.63 22.9c-.52 1.24-1 2.25-1.44 3.01-2.07 3.57-6.35 4.8-9.75 2.86A7.01 7.01 0 0 1 5 27.7l.6-1.33 1.9 1.14c2.4 1.37 5.4.41 6.87-1.98-1.98.57-4.02-.23-4.67-1.89a3.32 3.32 0 0 1 .8-3.46v-7.71l8.45 2.33L29.5 8.9v14H17.63zm-.16-1.5H27.6v-9.5l-8.55 4.5-6.65-1.5v4.05c2.05-.7 4.22.1 4.9 1.82.08.2.14.42.17.63zm-4.78-1.21c-1.44.48-2.23 1.76-1.75 2.84.47 1.08 2.03 1.57 3.47 1.08 1.44-.48 2.23-1.76 1.75-2.84-.47-1.08-2.03-1.57-3.47-1.08z'/%3e %3cfilter id='a' width='134.3%25' height='140.4%25' x='-17.1%25' y='-15.4%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='.9' result='shadowSpreadOuter1'/%3e %3cfeOffset dy='1' in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3cpath id='d' d='M2.5 2.5l7 2.5L6 6 4.5 9.5z'/%3e %3cfilter id='c' width='235.3%25' height='232.9%25' x='-66.4%25' y='-52.1%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.05' result='shadowSpreadOuter1'/%3e %3cfeOffset dy='1' in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd'%3e %3cuse fill='black' filter='url(%23a)' xlink:href='%23b'/%3e %3cuse fill='black' xlink:href='%23b'/%3e %3cpath stroke='white' d='M17.96 23.4a26.57 26.57 0 0 1-1.34 2.76c-2.2 3.8-6.78 5.13-10.43 3.05a7.51 7.51 0 0 1-1.54-1.17l-.25-.24.98-2.16.48.3c.9.55 1.53.92 1.89 1.13a4.52 4.52 0 0 0 5.45-.87c-1.76.04-3.36-.86-3.96-2.39a3.78 3.78 0 0 1 .76-3.83V11.8l8.89 2.46L30 8.05V23.4H17.96zm-.09-2.5h9.23v-8.17l-7.98 4.2-6.22-1.4v2.77c2.09-.42 4.16.5 4.86 2.29l.11.31zm-5.02-.24c-1.19.4-1.8 1.39-1.45 2.17.36.82 1.63 1.22 2.85.8 1.19-.4 1.8-1.38 1.45-2.16-.36-.82-1.63-1.22-2.85-.8z'/%3e %3cuse fill='black' filter='url(%23c)' xlink:href='%23d'/%3e %3cuse fill='black' xlink:href='%23d'/%3e %3cpath stroke='white' d='M6.37 6.42L4.4 10.99 1.75 1.7l9.38 3.35-4.76 1.37z'/%3e %3c/g%3e %3c/svg%3e";this.cursors={auto:{native:"auto"},arrow:{get native(){return e()},svg:t,svgIsRotated:!0},move:{native:"move",svg:i},rotate:{cur:"".concat(BFN.imagesURL,"cursors/rotate-fallback.cur"),svg:BeFunky.isSafari?r:a,svgIsRotated:!BeFunky.isSafari},select_cross:{native:"crosshair"},select_poly:{cur:"".concat(BFN.imagesURL,"cursors/select-polygon.cur"),svg:o,svgOffset:"0 0"},select_lasso:{cur:"".concat(BFN.imagesURL,"cursors/select-lasso.cur"),svg:n,svgOffset:"0 0"},grab:{native:BeFunky.isChromium||BeFunky.isSafari?"-webkit-grab":"grab"},grabbing:{native:BeFunky.isChromium||BeFunky.isSafari?"-webkit-grabbing":"grabbing"},none:{native:"none"}},this.validCursors=Object.keys(this.cursors),this.cursor=this._cursor=this.defaultNativeCursor="auto",this.cursorRotation=this._cursorRotation=0,this.cursorLock=this._cursorLock=!1,this.lockedCursor=void 0,this.prevCursorStyle=""},this.updateCursor=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];clearTimeout(e.updateCursorST),cancelAnimationFrame(e.updateCursorAF);var i=()=>{e.updateCursorAF=requestAnimationFrame(()=>{var t=e.getCursorStyle();t!==e.prevCursorStyle&&(e.prevCursorStyle=t,e.setStyles(t))})};t?i():e.updateCursorST=setTimeout(i,0)},this.getCursorStyle=(()=>{var e=this.cursors[this.lockedCursor||this._cursor],t=[];if(e.svg&&!BeFunky.isEdgeHTML){var i='url("'.concat(e.svg,'") ').concat(e.svgOffset||"16 16");e.svgIsRotated&&0!==this._cursorRotation&&(i=i.replace("rotate(0 ","rotate(".concat(this._cursorRotation," "))),t.push(i)}return e.cur&&t.push('url("'.concat(e.cur,'")')),t.push(e.native||this.defaultNativeCursor),{cursor:t.join(", ")}}),this.getNativeArrowCursor=(()=>{var e=45*(this._cursorRotation%45>=22.5?Math.ceil:Math.floor)(this._cursorRotation/45);return{0:"ew-resize",45:"nwse-resize",90:"ns-resize",135:"nesw-resize"}[e%=180]}),Object.defineProperty(this,"cursor",{set(e){e&&this.validCursors.includes(e)||(e=this.defaultNativeCursor),e!==this._cursor&&(this._cursor=e,this._cursorLock||this.updateCursor())},get(){return this._cursor}}),Object.defineProperty(this,"cursorRotation",{set(e){"number"!=typeof e&&(e=0),(e=180*e/Math.PI)<0&&(e-=360*Math.floor(e/360)),(e=Math.round(e))!==this._cursorRotation&&(this._cursorRotation=e,this._cursorLock?this.cursors[this.lockedCursor].svgIsRotated&&this.updateCursor(!0):this.cursors[this._cursor].svgIsRotated&&this.updateCursor(!0))},get(){return this._cursorRotation}}),Object.defineProperty(this,"cursorLock",{set(e){(e=!!e)!==this._cursorLock&&(this._cursorLock=e,this._cursorLock?this.lockedCursor=this._cursor:(this.lockedCursor=void 0,this.updateCursor()))},get(){return this._cursorLock}}),this.init()}).bind(e)()),BFN.UI.cutoutOptionsModal=(e=>(function(){var e=()=>{this.fullTexture=null,this.trimTexture=null,this.previewFullSRC="",this.previewTrimSRC="",this._trimTransparency=!1,this.previewImage=document.getElementById("cutout_options_image")};this.open=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&e.baseTexture&&i&&i.baseTexture){this.fullTexture=e,this.trimTexture=i;var r=t(BFN.TextureUtils.getScaledDimensions(this.fullTexture,{maxWidth:544,maxHeight:384}),2),a=r[0],n=r[1],o=t(BFN.TextureUtils.getScaledDimensions(this.trimTexture,{maxWidth:544,maxHeight:384}),2),s=o[0],l=o[1],h=BFN.Util.resizeTexture(this.fullTexture,4*a,4*n),c=BFN.Util.resizeTexture(this.trimTexture,4*s,4*l),u=BFN.Util.getThumbTexture(h,Math.max(a,n)),d=BFN.Util.getThumbTexture(c,Math.max(s,l));u.renderClone().destroyGC(!0),d.renderClone().destroyGC(!0),h.destroyGC(!0),c.destroyGC(!0);var m=BFN.Util.isTransparent(u),p=BFN.Util.isTransparent(d);this.previewFullSRC=BFN.TextureUtils.textureToBase64(u,{isTransparent:m}),this.previewTrimSRC=BFN.TextureUtils.textureToBase64(d,{isTransparent:p}),u.destroyGC(!0),d.destroyGC(!0),BeFunky.openModal(this,{onOpen:()=>{this.updatePreview()},onClose:()=>{this.clearPreview(),this.clearTextures()},size:[960,480]})}},this.close=function(){BeFunky.closeModal(this,!1)},this.updatePreview=function(){this.previewImage.src=this._trimTransparency?this.previewTrimSRC:this.previewFullSRC},this.clearPreview=function(){this.previewFullSRC="",this.previewTrimSRC="",this.previewImage.src=""},this.clearTextures=function(){try{this.fullTexture.destroyGC(!0)}catch(e){}try{this.trimTexture.destroyGC(!0)}catch(e){}this.fullTexture=null,this.trimTexture=null},Object.defineProperty(this,"trimTransparency",{set(e){this._trimTransparency=e,this.updatePreview()},get(){return this._trimTransparency}}),e()}).bind(e)()),BFN.UI.dragScreen=(e=>(function(){this.addClass("drag-screen"),this.innerHTML="<img><div></div>",this.init=function(){this.active=!1,this.image=this.querySelector("img"),this.image.addClass("drag-img"),this.nodeContainer=this.querySelector("div"),this.nodeContainer.setStyles({position:"absolute",left:"0",top:"0"}),this.image.onload=(()=>{this.active&&this.addClass("active")})},this.show=function(e){if(!this.active&&e){this.active=!0,BFN.smoothPictureDisabled=!0,document.addEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUp,!0);var t=this.image.src;this.image.src=e,this.nodeContainer.innerHTML="",this.image.setStyles({width:BeFunky.isFirefox&&e.startsWith("data:image/svg+xml,")?"100px":""}),this.image.src===t&&this.addClass("active")}},this.showNode=function(e){!this.active&&e&&(this.active=!0,document.addEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUp,!0),this.image.src="",this.nodeContainer.appendChild(e),this.addClass("active"))},this.hide=function(){this.nodeContainer.innerHTML="",this.active&&(this.active=!1,BFN.smoothPictureDisabled=!1,document.removeEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.removeEventListener(BeFunky.pointerup,this.handlePointerUp,!0),this.removeClass("active"))},this.setPosition=function(e,t){this.setStyles({left:"".concat(e,"px"),top:"".concat(t,"px")})},this.handlePointerMove=(()=>{var e=BeFunky.globalPointerCoords;this.setPosition(e.x,e.y)}),this.handlePointerUp=(()=>{this.hide()}),this.init()}).bind(e)()),BFN.UI.draggableElement=((e,t)=>(function(){this.init=function(){this.dragging=!1,this.oncontextmenu=(()=>!1),t&&this.setStyles({touchAction:"none"}),this.addEventListener(BeFunky.pointerdown,this.handlePointerDown)},this.handlePointerDown=(e=>{if(0===e.button){this.lastX=this.startX=e.pageX,this.lastY=this.startY=e.pageY,this.startScrollTop=t?t.scrollTop:0;var i=this.getBoundingClientRect();this.centerX=i.left+i.width/2,this.centerY=i.top+i.height/2,this.width=i.width,document.addEventListener(BeFunky.pointermove,this.handlePointerMove),document.addEventListener(BeFunky.pointerup,this.handlePointerUp)}}),this.handlePointerMove=(e=>{if(!this.dragging){var i=e.pageX-this.lastX,r=e.pageY-this.lastY,a=Math.sqrt(Math.pow(i,2)+Math.pow(r,2)),n=Math.abs(r)/a,o=()=>{var i=1.75*this.width,r=t?t.scrollTop:0,a=e.pageX-this.centerX,n=e.pageY-this.centerY+r-this.startScrollTop,o=Math.sqrt(Math.pow(a,2)+Math.pow(n,2)),s=e.pageX-this.startX,l=e.pageY-this.startY+r-this.startScrollTop,h=Math.sqrt(Math.pow(s,2)+Math.pow(l,2));return!(o<5||h<5)&&(!(o>i)&&!(a>0&&e.pageX<this.lastX||a<0&&e.pageX>this.lastX))},s=()=>{this.dragging=!0,this.dispatchEvent(new Event("dragstarted"))};if("mousemove"===e.type||"mouse"===e.pointerType){if(o())return s()}else{if((n<.5||!t)&&o())return s();t&&(t.scrollTop=this.startScrollTop-(e.pageY-this.startY))}this.lastX=e.pageX,this.lastY=e.pageY}}),this.handlePointerUp=(e=>{if(document.removeEventListener(BeFunky.pointermove,this.handlePointerMove),document.removeEventListener(BeFunky.pointerup,this.handlePointerUp),this.dragging){this.dragging=!1;var t="touch"===e.pointerType?document.elementFromPoint(e.pageX,e.pageY):e.target,i=t===BFN.Stage.view?BFN.getCanvasCoordinates(e.pageX,e.pageY):void 0;this.dispatchEvent(new CustomEvent("dragstopped",{detail:{dropTarget:t,canvasCoordinates:i}}))}}),this.cancelDragging=(()=>{document.removeEventListener(BeFunky.pointermove,this.handlePointerMove),document.removeEventListener(BeFunky.pointerup,this.handlePointerUp),this.dragging&&(this.dragging=!1,this.dispatchEvent(new CustomEvent("dragstopped",{detail:{}}))),BFN.DragScreen.hide()}),this.init()}).bind(e)()),BFN.UI.draggablePanel=((e,t)=>(function(){this.init=function(){this.initDefaultValues(),BFN.addFloatingElement(this)},this.initDefaultValues=function(){this.addClass("draggable-panel"),this.addClass("focus-avoid"),setTimeout(()=>{this.addClass("animated")},100),this.panelHeader=t||this.querySelector(".panel-header"),this.panelHeader.addEventListener(BeFunky.pointerdown,this.handleTopBarPress),this.addEventListener(BeFunky.pointerdown,this.handlePanelPress,!0),this.cursorStartPoint={},this.topBarStartPoint={},this.deltaPoint={},this._panelSize=null,this.addEventListener(BeFunky.pointerdown,e=>e.stopPropagation()),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this))},this.show=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.addClass("active"),this.removeClass("focus-avoid"),null!==e&null!==t&&this.setPosition(e,t),BFN.focusFloatingElement(this)},this.hide=function(){this.removeClass("active"),this.addClass("focus-avoid"),setTimeout(()=>{this.hasClass("active")||this.setStyles({zIndex:-1})},300)},this.setPosition=function(e,t){var i=Math.max(0,Math.min(BFN.appRect.width-this.panelSize.width,e)),r=Math.max(0,Math.min(BFN.appRect.height-this.panelSize.height,t));this.setStyles({left:"".concat(i,"px"),top:"".concat(r,"px")})},this.handleTopBarPress=(e=>{document.addEventListener(BeFunky.pointerup,this.handleTopBarRelease),document.addEventListener(BeFunky.pointermove,this.handleTopBarDrag),this.cursorStartPoint.x=e.pageX,this.cursorStartPoint.y=e.pageY;var t=e=>getComputedStyle(this).getPropertyValue(e);this.topBarStartPoint.x=parseInt(t("left").replace("px","")),this.topBarStartPoint.y=parseInt(t("top").replace("px",""))}),this.handleTopBarRelease=(()=>{document.removeEventListener(BeFunky.pointerup,this.handleTopBarRelease),document.removeEventListener(BeFunky.pointermove,this.handleTopBarDrag)}),this.handleTopBarDrag=(e=>{this.deltaPoint.x=e.pageX-this.cursorStartPoint.x,this.deltaPoint.y=e.pageY-this.cursorStartPoint.y,this.setPosition(this.topBarStartPoint.x+this.deltaPoint.x,this.topBarStartPoint.y+this.deltaPoint.y)}),this.handlePanelPress=(e=>{BFN.focusFloatingElement(this),this.hasClass("disabled")&&this.handleTopBarPress(e)}),this.handleStageDimensionsUpdated=function(e){if(this._panelSize){var t=parseInt(this.style.left.replace("px","")),i=parseInt(this.style.top.replace("px",""));this.setPosition(t,i)}},Object.defineProperty(this,"panelSize",{get(){return this._panelSize&&this._panelSize.width||(this._panelSize=this.getBoundingClientRect()),{width:this._panelSize.width,height:this._panelSize.height}}}),this.init()}).bind(e)()),BFN.UI.favoriteStar=(e=>(function(){this.presetID=this.id.replace("favorite_","");var e=BFN.effectPresetMap[this.presetID]||BFN.artsyPresetMap[this.presetID];this.favoriteID=e?this.presetID.replace("".concat(e,"_"),""):null,this.addClass("favorite-star"),this.init=function(){this.selectedMarkup='<svg class="icon icon-size-regular"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#favorite-star-fill"></use></svg>',this.deselectedMarkup='<svg class="icon icon-size-regular"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#favorite-star-empty"></use></svg>',this.selected=!1},this.updateDisplay=function(){this.innerHTML=this._selected?this.selectedMarkup:this.deselectedMarkup,this.dataset.bfntooltip=this._selected?"remove_from_favorites":"add_to_favorites"},Object.defineProperty(this,"selected",{set(e){e=!!e,this._selected!==e&&(this._selected=e,this.updateDisplay())},get(){return this._selected}}),this.init()}).bind(e)()),BFN.UI.graphicManager=(e=>(function(){this.init=function(){this.initDefaultValues(),this.initAccordion(),this.initShapes()},this.initDefaultValues=function(){this.items={}},this.initAccordion=function(){this.accordion=document.querySelector(".graphic-manager__accordion"),BFN.UI.accordionLayout(this.accordion,{sections:{basic_shapes:{isOpen:!0,content:'<p class="graphic-manager__shapes"></p>'},your_graphics:{isOpen:!0,content:'<p class="graphic-manager__empty-message"></p>'}}}),this.graphicsContainer=this.accordion.sections.your_graphics.panel,this.emptyMessage=this.graphicsContainer.firstElementChild,this.emptyMessage.setLang("no_graphics_selected")},this.initShapes=function(){var e=document.createDocumentFragment();[{name:"rectangle",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><rect fill="#EDEDED" width="44" height="44" /></svg>'},{name:"ellipse",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><circle fill="#EDEDED" cx="22" cy="22" r="22" /></svg>'},{name:"triangle",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><polygon fill="#EDEDED" points="0,44 22,0 44,44" /></svg>'},{name:"star",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><path fill="#EDEDED" d="M 22.000 35.000 L 36.107 43.416 L 32.462 27.399 L 44.825 16.584 L 28.466 15.101 L 22.000 0.000 L 15.534 15.101 L -0.825 16.584 L 11.538 27.399 L 7.893 43.416 L 22.000 35.000"/></svg>'},{name:"polygon",svg:'<svg xmlns="http://www.w3.org/2000/svg" style="transform: rotate(180deg)" width="44" height="44"><path fill="#EDEDED"  d="M 22.000 43.000 L 43.874 27.107 L 35.519 1.393 L 8.481 1.393 L 0.126 27.107 L 22.000 43.000"/></svg>'},{name:"line",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><rect fill="#EDEDED" width="44" height="4" y="20" /></svg>'},{name:"arrow",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><rect fill="#EDEDED" width="32" height="4" y="20" /><polygon fill="#EDEDED" points="32,14 44,22 32,30" /></svg>'}].forEach(t=>{var i=t.name,r=t.svg,a=document.createElement("button");BFN.UI.graphicManagerShape(a,i,r,this.accordion),e.appendChild(a)}),this.querySelector(".graphic-manager__shapes").appendChild(e)},this.addItem=(e=>{var t=document.createElement("div");BFN.UI.graphicManagerItem(t,e,this.accordion),this.items[e.id]={element:t},1===Object.keys(this.items).length&&(this.graphicsContainer.removeChild(this.emptyMessage),this.graphicsContainer.appendChild(t)),this.graphicsContainer.insertBefore(t,this.graphicsContainer.firstElementChild)}),this.removeItem=(e=>{var t=this.items[e];t&&(this.graphicsContainer.removeChild(t.element),delete this.items[e],0===Object.keys(this.items).length&&(this.updateEmptyMessage(),this.graphicsContainer.appendChild(this.emptyMessage)))}),this.updateEmptyMessage=(()=>{this.emptyMessage.textContent=BeFunky.LanguageManager.getString("no_graphics_selected")}),this.init()}).bind(e)()),BFN.UI.graphicManagerItem=((e,t,i)=>(function(){var e=BFN.getImageType(t.id);this.setAttribute("class","graphic-manager__item graphic-manager__item--".concat(e)),this.init=function(){this.addGraphic(),this.addButtons(),this.menuImageVO=t,BFN.UI.draggableElement(this,i),this.dataset.bfntooltip="drag_or_double_click",this.addEventListener("dblclick",this.handleDoubleClick),this.addEventListener("dragstarted",this.handleDragStarted),this.addEventListener("dragstopped",this.handleDragStopped)},this.addGraphic=function(){var e=t.thumbURL,i='url("'.concat(e,'") no-repeat center'),r=new Image;r.onload=(()=>{var e=document.createElement("div").addClass("graphic-manager__placeholder").setStyles({background:i,backgroundSize:"contain"}),t=this.firstElementChild;t?this.insertBefore(e,t):this.appendChild(e)}),r.onerror=(()=>{this.hasRetried?BeFunky.logError("Failed to load thumbnail for a second time"):(this.hasRetried=!0,BeFunky.logError("Failed to load thumbnail. Trying again in 3 seconds..."),setTimeout(this.addGraphic.bind(this),3e3))}),r.src=e},this.addButtons=function(){if(t.isRemovable){var e=function(e,t,i){var r=document.createElement("button");r.setAttribute("class","btn graphic-manager__button graphic-manager__button--".concat(e)),i&&(r.dataset.bfntooltip=i);t&&(r.innerHTML='\n                <svg class="icon icon icon-size-medium">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'.concat(t,'"></use>\n                </svg>\n            '));return r}("remove","global-cancel-icon","remove_from_graphic_manager");e.addEventListener("click",this.handleRemoveButtonClick),this.appendChild(e)}},this.handleRemoveButtonClick=(()=>{BFN.GraphicLibraryManager.removeGraphic(t.id)}),this.handleDoubleClick=(()=>{-1!==BFN.GraphicLibraryManager.getIndex(t.id)&&this.addToCanvas()}),this.handleDragStarted=(()=>{BFN.DragScreen.show(t.thumbURL),document.addEventListener("keyup",this.handleEscape)}),this.handleDragStopped=(e=>{var t=e.detail.canvasCoordinates;document.removeEventListener("keyup",this.handleEscape),t&&this.addToCanvas(t)}),this.addToCanvas=(e=>{if(t.isPlus&&!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("GOODIES","".concat(t.trackingID,"_UPGRADE")),void BFN.UserActionManager.addUpgradeAction(["Add Plus Graphic"],!1);BFN.ImageLibraryManager.addImageToCanvas(t,{forceLayer:!0,isGoodie:!0,initialCenterPosition:e}),BFN.BfnService.track("CREATE","GOODIES",t.trackingID)}),this.handleEscape=(e=>{27===e.which&&this.cancelDragging()}),this.init()}).bind(e)()),BFN.UI.graphicManagerShape=((e,t,i,r)=>(function(){this.setClass("graphic-manager__shape"),this.setAttribute("data-bfntooltip",t),this.innerHTML=i,this.init=function(){this.addEventListener("click",()=>this.addToCanvas()),BFN.UI.draggableElement(this,r),this.addEventListener("dragstarted",this.handleDragStarted),this.addEventListener("dragstopped",this.handleDragStopped)},this.handleDragStarted=(()=>{var e="data:image/svg+xml,".concat((e=>e.replace(/#EDEDED/,"white").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/#/g,"%23"))(i));BFN.DragScreen.show(e),document.addEventListener("keyup",this.handleEscape)}),this.handleDragStopped=(e=>{var t=e.detail.canvasCoordinates;document.removeEventListener("keyup",this.handleEscape),t&&this.addToCanvas(t)}),this.addToCanvas=(e=>{BFN.BasicShapeManager.createShape(t,e),BFN.BfnService.track("CREATE","SHAPES",t)}),this.handleEscape=(e=>{27===e.which&&this.cancelDragging()}),this.init()}).bind(e)()),BFN.UI.imageGallery=BeFunky.imageGallery,BFN.UI.imageGalleryItem=BeFunky.imageGalleryItem,BFN.UI.imageManager=(e=>(function(){var e=this;this.init=function(){this.initDefaultValues(),this.initContextMenu()},this.initDefaultValues=function(){this.items={},this.scrollContainer=this.querySelector(".image-manager__scroll-container"),this.imagesContainer=this.querySelector(".image-manager__images"),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleViewstateUpdated),setTimeout(()=>this.handleViewstateUpdated(),0),this.clearButton=document.getElementById("image_manager_clear"),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.FREEFORM_UPDATED.type,this.handleFreeformModeUpdated),this.handleFreeformModeUpdated()},this.initContextMenu=function(){this.contextMenuComponent=document.getElementById("context_menu_image_manager"),this.contextMenuTargetItem=null;var e=e=>({onClick:()=>{e(this.contextMenuTargetItem)}});BeFunky.contextMenu(this.contextMenuComponent,{add_to_cell:e(e=>{BFN.ImageLibraryManager.addImageToCanvas(e.menuImageVO)}),add_as_layer:e(e=>{BFN.ImageLibraryManager.addImageToCanvas(e.menuImageVO,{forceLayer:!0})}),set_as_background:e(e=>{BFN.PhotoEditorModel.confirmEditorLoadImage(()=>{var t=e.menuImageVO,i=!1;UIToggler.toggleLoadScreen(!0,{onCancel:()=>i=!0}),BFN.BfnService.getImageBlobOrSVG(t,e=>{var r=e.blob,a=e.svgString,n=e.error;if(UIToggler.toggleLoadScreen(!1),n)return BeFunky.logError(n);if(!i){var o=BFN.getImageType(t.id);"unsplash"===o&&BFN.ImageLibraryService.reportUnsplashImageDownload(t.id),BFN.BfnService.track("CREATE","PHOTOEDITOR","SET_AS_BACKGROUND"),BFN.BfnService.trackMediaOpened("image",o),r||(r=new Blob([a],{type:"image/svg+xml"})),BFN.PhotoEditorModel.loadBase64OrBlob(r,{filename:t.name})}})})}),save_to_befunky:e(e=>{e.handleSaveButtonClick()}),remove:e(e=>{e.handleRemoveButtonClick()})},{offset:{x:-2,y:-1},onHide:(e,t)=>{if(e&&!(t>400)){var i=2,r=1;if(BeFunky.isSafari&&(i+=16,r+=16),Math.abs(i-e.offsetX)<=2){var a=Object.values(this.contextMenuComponent.items),n=a.reduce((e,t)=>e+(t.hasClass("context-menu__item--hidden")?0:32),0),o=e.offsetY-n;Math.abs(r-o)<=2&&(console.log("Simulating double click"),a.find(e=>!e.hasClass("context-menu__item--hidden")).click())}}}}),this.contextMenuComponent.target=this.imagesContainer,this.contextMenuComponent.enabled=!1,this.contextMenuComponent.addEventListener("SHOW",()=>{this.contextMenuComponent.enabled=!1});var t=e=>{var t,i=!1;e.target&&e.target.hasClass("image-manager__placeholder")&&(t=e.target.parentElement)&&(i=!0),this.contextMenuComponent.enabled=i,this.contextMenuTargetItem=i?t:null,i&&(this.simulateDoubleClick(),this.contextMenuComponent.toggleButton("save_to_befunky",!t.menuImageVO.isSaved&&!t.menuImageVO.isSVG),this.contextMenuComponent.toggleButton("remove",t.menuImageVO.isRemovable),this.contextMenuComponent.toggleButton("add_to_cell",BFN.AppModel.viewingCollage&&!!BFN.PhotoGrid.randomEmptyChild))};this.imagesContainer.addEventListener("click",t),this.imagesContainer.addEventListener("contextmenu",t)},this.addItem=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=document.createElement("div");if(BFN.UI.imageManagerItem(a,t),e.items[t.id]={element:a},e.toggleSampleImages(),r)e.imagesContainer.appendChild(a);else{var n=e.imagesContainer.children;i=Math.min(i,n.length-6),n.length&&n.length>i?e.imagesContainer.insertBefore(a,n[i]):e.imagesContainer.appendChild(a)}},this.removeItem=(e=>{var t=this.items[e];t&&(this.imagesContainer.removeChild(t.element),delete this.items[e],this.toggleSampleImages(),this.contextMenuComponent.hide())}),this.toggleSampleImages=(()=>{this.imagesContainer.toggleClass("image-manager__images--hide-samples",Object.keys(this.items).some(e=>!e.startsWith("sample_")))}),this.simulateDoubleClick=(()=>{var e=this.contextMenuComponent;e.setStyles({opacity:"0",transition:"opacity .15s ease-out"}),document.addEventListener(BeFunky.pointermove,i);var t=setTimeout(i,150);function i(){e.setStyles({opacity:"",transition:""}),clearTimeout(t),document.removeEventListener(BeFunky.pointermove,i)}}),this.handleViewstateUpdated=(()=>{this.toggleClass("image-manager--hide-controls",!BFN.AppModel.viewingCollage),this.contextMenuComponent.toggleButton("set_as_background",BFN.AppModel.viewingEditor)}),this.handleFreeformModeUpdated=(()=>{this.clearButton.disabled=!!BFN.CollageMakerCanvasPhotoGridModel.freeform}),this.init()}).bind(e)()),BFN.UI.imageManagerItem=((e,t)=>(function(){var e=BFN.getImageType(t.id);function i(e,t,i){var r=document.createElement("button");return r.setAttribute("class","btn image-manager__button image-manager__button--".concat(e)),i&&(r.dataset.bfntooltip=i),t&&(r.innerHTML='\n                <svg class="icon icon icon-size-medium">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'.concat(t,'"></use>\n                </svg>\n            ')),r}this.setAttribute("class","image-manager__item image-manager__item--".concat(e)),this.init=function(){this.addImage(),this.addButtons(),this.menuImageVO=t,this.lastPreloadedURL="",BFN.UI.draggableElement(this,BFN.ImageLibraryManager.sidebar.scrollContainer),this.dataset.bfntooltip="drag_or_double_click",this.addEventListener("dragstarted",this.handleDragStarted),this.addEventListener("dragstopped",this.handleDragStopped)},this.addImage=function(){var e=t.id,i=t.thumbURL,r=t.thumbWidth,a=void 0===r?0:r,n=t.thumbHeight,o=void 0===n?0:n,s=t.isTransparent,l=BFN.CSS.imageManagerThumbSize,h='url("'.concat(i,'") no-repeat center'),c=a>=l&&o>=l?"cover":"contain";s&&(h+=", url('".concat(BFN.imagesURL,"app/checker_pattern.jpg') repeat"),c+=", auto");var u=new Image;u.onload=(()=>{var e=document.createElement("div").addClass("image-manager__placeholder").setStyles({background:h,backgroundSize:c}),t=this.firstElementChild;t?this.insertBefore(e,t):this.appendChild(e)}),u.onerror=(()=>{this.hasRetried?BeFunky.logError("Failed to load thumbnail for a second time"):(this.hasRetried=!0,"pixabay"===BFN.getImageType(e)?(BeFunky.logError("Failed to load expired Pixabay image. Trying again..."),BFN.ImageLibraryService.getPixabayImageById(e.replace("pixabay_","")).then(e=>{t.imageURL=e.imageURL,t.thumbURL=e.thumbURL,this.addImage(),requestIdleCallback(()=>BFN.ImageLibraryManager.updateImageStore())}).catch(e=>{BeFunky.throwError("Unable to get updated Pixabay image",e)})):(BeFunky.logError("Failed to load thumbnail. Trying again in 3 seconds..."),setTimeout(this.addImage.bind(this),3e3)))}),u.src=i},this.addButtons=function(){if(!t.isSaved){var e=i("save","global-save-icon","save_to_befunky");e.addEventListener("click",this.handleSaveButtonClick),this.appendChild(e)}if(t.isRemovable){var r=i("remove","global-cancel-icon","remove_from_image_manager");r.addEventListener("click",this.handleRemoveButtonClick),this.appendChild(r)}},this.handleRemoveButtonClick=(()=>{BFN.ImageLibraryManager.removeImage(t.id)}),this.handleSaveButtonClick=(()=>{BFN.ImageLibraryManager.saveImageAsLayer(t)}),this.handleDragStarted=(()=>{BFN.DragScreen.show(t.thumbURL),document.addEventListener("keyup",this.handleEscape),BFN.AppModel.viewingCollage&&!BFN.CollageMakerCanvasPhotoGridModel.freeform&&(BFN.PhotoGrid.awaitingDrop=!0),BFN.TransformModel.awaitingDrop=!t.isSVG,t.imageURL&&t.imageURL!==this.lastPreloadedURL&&(BeFunky.isChromium||BeFunky.isSafari)&&(this.lastPreloadedURL=t.imageURL,BFN.RequestUtils.getBlob(t.imageURL,()=>{}))}),this.handleDragStopped=(e=>{var i=e.detail.canvasCoordinates;document.removeEventListener("keyup",this.handleEscape),i?BFN.ImageLibraryManager.addImageToCanvas(t,{initialCenterPosition:i}):(BFN.PhotoGrid.awaitingDrop=!1,BFN.TransformModel.awaitingDrop=!1,BFN.TransformModel.focusedTransformItem=null,BFN.TransformModel.targetTransformItem=null)}),this.handleEscape=(e=>{27===e.which&&this.cancelDragging()}),this.init()}).bind(e)()),BFN.UI.messageScreen=(e=>(function(){this.addClass("message-screen");this.insertAdjacentHTML("beforeend",'<div class="center-container"></div>'),this.init=function(){this.active=!1,this.messageQueue=[],this.transitionTimeQueue=[],this.centerContainer=this.querySelector(".center-container"),this.messageContainer=document.createElement("div").addClass("message-container"),this.transitionTime=750,this.easeInTransition=(()=>"all ".concat(this.transitionTime,"ms cubic-bezier(0, 0, 0.3, 0.7)")),this.easeOutTransition=(()=>"all ".concat(this.transitionTime,"ms cubic-bezier(0, 0, 0.7, 0.3)"))},this.show=function(e,t){(!(t=parseInt(t))||t<=0)&&(t=750),this.messageQueue.push(e),this.transitionTimeQueue.push(t),this.active||this.processMessageQueue()},this.processMessageQueue=function(){if(this.messageQueue.length){this.active||(this.active=!0,this.addClass("active"));var e=this.messageQueue.shift();this.messageContainer.innerHTML=/^[a-z0-9_]+$/.test(e)?BeFunky.LanguageManager.getString(e):e,this.transitionTime=this.transitionTimeQueue.shift(),this.messageContainer.setStyles({opacity:0,transition:this.easeInTransition()}),this.centerContainer.appendChild(this.messageContainer),this.messageContainerHeight=parseInt(this.messageContainer.getBoundingClientRect().height),this.messageContainer.setStyles({transform:"translateY(-".concat(this.messageContainerHeight/2,"px)"),opacity:1}),setTimeout(()=>requestAnimationFrame(this.handleEaseInEnd),this.transitionTime)}else this.active=!1,this.removeClass("active")},this.handleEaseInEnd=(()=>{this.messageContainer.setStyles({transform:"translateY(-".concat(this.messageContainerHeight,"px)"),opacity:0,transition:this.easeOutTransition()}),setTimeout(()=>requestAnimationFrame(this.handleEaseOutEnd),this.transitionTime)}),this.handleEaseOutEnd=(()=>{this.messageContainer.setStyles({transform:"unset",transition:""}),this.centerContainer.removeChild(this.messageContainer),setTimeout(this.processMessageQueue.bind(this),0)}),this.init()}).bind(e)()),BFN.UI.navbarDropdown=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.onOpen,r=void 0===i?()=>{}:i,a=t.onClose,n=void 0===a?()=>{}:a,o=t.onDisabledClick,s=void 0===o?()=>{}:o;return function(){this.init=function(){this.initDefaultValues(),this.initToggleButton()},this.initDefaultValues=function(){this.toggleButton=this.querySelector(".navbar-dropdown-button"),this.dropdownItems=this.querySelector(".navbar-dropdown-items"),[...this.querySelectorAll(".dropdown-item--has-submenu")].forEach(e=>{e.addEventListener("click",()=>{e.focus()})})},this.initToggleButton=function(){this.toggleButton.addEventListener("click",()=>{var e=this.hasAttribute("disabled"),t=this.hasClass("active");if(e)return s();t?this.close():this.open()})},this.open=(()=>{this.addClass("active"),this.addEventListener("focusout",this.closeOnFocusout),document.addEventListener("click",this.closeOnClick,!0),r()}),this.close=(()=>{this.removeClass("active"),this.removeEventListener("focusout",this.closeOnFocusout),document.removeEventListener("click",this.closeOnClick,!0),n()}),this.closeOnFocusout=(()=>{setTimeout(()=>{this.hasClass("active")&&!this.dropdownItems.contains(document.activeElement)&&this.close()},BeFunky.isEdgeHTML?100:30)}),this.closeOnClick=(e=>{e.target===this.toggleButton||e.target.hasClass("dropdown-item--has-submenu")||this.close()}),this.init()}.bind(e)()},BFN.UI.pagination=((e,t)=>{var i=t.currentPage,r=void 0===i?0:i,a=t.totalPages,n=void 0===a?0:a;return function(){this.innerHTML='\n        <button class="button button--icon button--grey pagination__button pagination__button--prev" data-bfntooltip="previous">\n            <svg class="icon icon-global-arrow-icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-arrow-icon"></use>\n            </svg>\n        </button>\n        <input type="number" step="1" min="1" max="" value="" class="input pagination__input">\n        <span class="pagination__slash">/</span>\n        <span class="pagination__total-pages"></span>\n        <button class="button button--icon button--grey pagination__button pagination__button--next" data-bfntooltip="next">\n            <svg class="icon icon-global-arrow-icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-arrow-icon"></use>\n            </svg>\n        </button>\n    ',this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.prevButton=this.querySelector(".pagination__button--prev"),this.nextButton=this.querySelector(".pagination__button--next"),this.pageInput=this.querySelector(".pagination__input"),this.totalPagesLabel=this.querySelector(".pagination__total-pages"),this.updateEvent=new Event("CURRENT_PAGE_UPDATED"),this.prevButton.addEventListener("click",()=>{this.handlePageChangeAttempt(this.currentPage-1)}),this.nextButton.addEventListener("click",()=>{this.handlePageChangeAttempt(this.currentPage+1)}),this.pageInput.addEventListener("change",()=>{this.handlePageChangeAttempt(this.pageInput.value)}),this.currentPage=r,this.totalPages=n},this.updateDisplay=function(){this.pageInput.value=this.currentPage,this.pageInput.disabled=0===this.currentPage||1===this.currentPage&&1===this.totalPages,this.pageInput.max=this.totalPages,this.totalPagesLabel.textContent=this.totalPages,this.prevButton.disabled=this.currentPage<=1,this.nextButton.disabled=this.currentPage>=this.totalPages},this.handlePageChangeAttempt=(e=>{if(e=parseInt(e,10),isNaN(e))this.pageInput.value=this.currentPage;else{var t=this.currentPage;this.currentPage=Math.max(1,Math.min(this.totalPages,e)),t!==this.currentPage&&this.dispatchEvent(this.updateEvent)}}),Object.defineProperty(this,"currentPage",{set(e){this._currentPage!==e&&(this._currentPage=e,this.updateDisplay())},get(){return this._currentPage}}),Object.defineProperty(this,"totalPages",{set(e){this._totalPages!==e&&(this._totalPages=e,this.updateDisplay())},get(){return this._totalPages}}),this.init()}.bind(e)()}),BFN.UI.panelHeader=BeFunky.panelHeader,BFN.UI.popover=(e=>(function(){for(var e=document.createDocumentFragment();this.firstChild;)e.appendChild(this.firstChild);this.innerHTML='\n        <div class="popover-arrow"></div>\n        <div class="popover-container"></div>\n    ',this.querySelector(".popover-container").appendChild(e),this.setStyles({display:"block"}),this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.isActive=!1,this.panelPressed=!1,this.sides=["left","top","right","bottom"],this._side=this.sides[0],this._positionFactor=.5,this._strong=!1,this._positionEdge=!1,this.arrow=this.querySelector(".popover-arrow"),this.container=this.querySelector(".popover-container"),this.arrowBase=null,this.addEventListener(BeFunky.pointerdown,()=>{this.panelPressed=!0}),this.useTransform=!(this.dataset.transform&&"false"===this.dataset.transform),this.dataset.side&&(this.side=this.dataset.side),this.dataset.position&&(this.positionFactor=Number(this.dataset.position)),this.dataset.strong&&(this._strong=this.dataset.strong),this.dataset.positionEdge&&(this._positionEdge=this.dataset.positionEdge),BFN.MainUI.addIdleRenderFunction(this.updateDisplay.bind(this))},this.show=function(){this.updateDisplay(),this.addClass("active"),document.addEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown),this.isActive=!0},this.bounce=function(){this.addClass("bounce"),setTimeout(()=>{this.removeClass("bounce")},100)},this.hide=function(){this.removeClass("active"),document.removeEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown),this.isActive=!1},this.hideUnlessPressed=function(){this.panelPressed||this.hide(),this.panelPressed=!1},this.updateDisplay=function(){if(null!==this.offsetParent){this.arrowBase=28;var e=this.container.getBoundingClientRect(),t=this._positionEdge?this.arrowBase/2:this.arrowBase,i=-Math.round((e.width-2*t)*this._positionFactor+t),r=-Math.round((e.height-2*t)*this._positionFactor+t);this.arrow.setStyles({transform:"rotate(".concat({left:-45,right:-225,top:-315,bottom:-135}[this._side],"deg)")});var a={left:{x:10,y:r},right:{x:-(e.width+10),y:r},top:{x:i,y:10},bottom:{x:i,y:-(e.height+10)}},n=this.useTransform?{transform:"translateX(".concat(a[this._side].x,"px) translateY(").concat(a[this._side].y,"px)")}:{left:"".concat(a[this._side].x,"px"),top:"".concat(a[this._side].y,"px")};this.container.setStyles(n)}},this.handleDocumentMouseDown=(()=>{this._strong||(this.hideUnlessPressed(),this.panelPressed=!1)}),Object.defineProperty(this,"side",{set(e){-1!==this.sides.indexOf(e)&&(this._side=e,this.isActive&&this.updateDisplay())},get(){return this._side}}),Object.defineProperty(this,"positionFactor",{set(e){this._positionFactor=Math.max(0,Math.min(1,e)),this.isActive&&this.updateDisplay()},get(){return this._positionFactor}}),Object.defineProperty(this,"strong",{set(e){this._strong=e},get(){return this._strong}}),Object.defineProperty(this,"positionEdge",{set(e){this._positionEdge=!!e,this.isActive&&this.updateDisplay()},get(){return this._positionEdge}}),this.init()}).bind(e)()),BFN.UI.popoverContent=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(){this.contentData=t.hasOwnProperty("contentData")?t.contentData:null,this.addClass("popover-content"),this.setStyles({width:t.hasOwnProperty("width")?t.width:"350px"}),this.init=function(){this.initDefaultValues(),this.initContent()},this.initDefaultValues=function(){},this.initContent=function(){if(this.contentData)for(var e=0;e<this.contentData.length;e++){var t=this.contentData[e];switch(t.type){case"spacer":this.addSpacer(t.spaceHeight,t.color,t.alpha,t.marginL,t.marginR,t.hideIfPremium);break;case"header":this.addHeader(t.localeID,t.fontSize,t.color,t.marginL,t.marginR,t.hideIfPremium,t.uppercase,t.bold);break;case"text":this.addText(t.localeID,t.localeReplacements,t.fontSize,t.color,t.marginL,t.marginR,t.lineHeight,t.hideIfPremium);break;case"icon_text":this.addIconText(t.iconID,t.iconSize,t.localeID,t.iconColor,t.fontSize,t.color,t.marginL,t.marginR,t.lineHeight,t.hideIfPremium);break;case"link":this.addLink(t.localeID,t.url,t.fontSize,t.marginL,t.marginR,t.hideIfPremium,t.linkTracking)}}},this.addSpacer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#EDEDED",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=document.createElement("div");o.setStyles({width:"100%",height:"".concat(e,"px"),backgroundColor:t,opacity:i,marginLeft:"".concat(r,"px"),marginRight:"".concat(a,"px")}),n&&o.addClass("hide-if-premium"),this.appendChild(o)},this.addHeader=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#EDEDED",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:12,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=document.createElement("div");o&&l.setStyles({textTransform:"uppercase"}),s&&l.setStyles({fontWeight:"bold"}),l.setStyles({fontSize:"".concat(t,"px"),color:i,marginLeft:"".concat(r,"px"),marginRight:"".concat(a,"px")}),l.setLang(e),n&&l.addClass("hide-if-premium"),this.appendChild(l)},this.addText=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:14,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#EDEDED",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:12,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:12,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=document.createElement("div");l.setLang(e,t),l.setStyles({fontSize:"".concat(i,"px"),color:r,marginLeft:"".concat(a,"px"),marginRight:"".concat(n,"px")}),o&&l.setStyles({lineHeight:"".concat(o,"px")}),s&&l.addClass("hide-if-premium"),this.appendChild(l)},this.addIconText=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#FFFFFF",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#EDEDED",n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:14,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:44,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:12,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]&&arguments[9],c=document.createElement("div");c.addClass("icon-container"),c.setStyles({color:r,left:"-".concat(o,"px"),width:"".concat(o,"px")}),c.innerHTML='<svg class="icon" style="width:'.concat(t||"20px",'"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(e,'"></use></svg>');var u=document.createElement("div");u.setStyles({position:"relative",fontSize:"".concat(n,"px"),color:a,marginLeft:"".concat(o,"px"),marginRight:"".concat(s,"px")}),u.innerHTML='<string data-lang="'.concat(i,'">').concat(BeFunky.LanguageManager.getString(i),"</string>"),u.appendChild(c),l&&u.setStyles({lineHeight:"".concat(l,"px")}),h&&u.addClass("hide-if-premium"),this.appendChild(u)},this.addLink=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:14,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:12,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",s=document.createElement("a");s.addClass("tutorial-link"),s.setLang(e),s.dataset.bfntrack=o,s.href=t,s.target="_blank",s.setStyles({fontSize:"".concat(i,"px")});var l=document.createElement("div");l.setStyles({marginLeft:"".concat(r,"px"),marginRight:"".concat(a,"px")}),l.appendChild(s),n&&l.addClass("hide-if-premium"),this.appendChild(l)},this.addElement=function(e){this.appendChild(e)},this.init()}.bind(e)()},BFN.UI.popoverWalkthrough=((e,t)=>(function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this._index=-1,this.addClass("popover"),this.buttonElement=document.createElement("button").setClass("button walkthrough__button"),this.buttonElement.type="button",this.contentElement=document.createElement("div").addClass("walkthrough-text-container"),this.header=document.createElement("p").addClass("walkthrough__text"),this.bodyElement=document.createElement("p").addClass("walkthrough__text"),this.contentElement.appendChild(this.header),this.contentElement.appendChild(this.bodyElement),this.appendChild(this.contentElement),this.appendChild(this.buttonElement),BFN.UI.popover(this),this.popoverContainer=this.querySelector(".popover-container"),this.popoverContainer.addClass("walkthrough"),this.buttonHandler=null},this.render=function(){if(-1!==this.index){var e=t[this.index],i=e.target,r=e.content,a=e.side,n=e.styles,o=e.positionFactor,s=void 0===o?.5:o,l=e.strong,h=void 0===l||l,c=e.buttonText,u=void 0===c?this.index<t.length-1?"next":"ok_got_it":c,d=e.onButtonClick;this.buttonElement.setLang(u),this.buttonHandler&&this.buttonElement.removeEventListener("click",this.buttonHandler),this.buttonHandler=d||this.handleButtonClick.bind(this),this.buttonElement.addEventListener("click",this.buttonHandler),this.contentElement.innerHTML=r.map(e=>{var t=e.text,i=e.isHeading;return'<p class="walkthrough__'.concat(i?"heading":"text",'" data-lang="').concat(t,'">\n                ').concat(BeFunky.LanguageManager.getString(t),"\n            </p>")}).join("");var m=this.contentElement.children;r.forEach((e,t)=>{var i=e.replacements;i&&BeFunky.LanguageManager.registerElement(m[t],i)});var p=document.getElementById(i);p&&p.insertAdjacentElement("afterend",this),this.positionFactor=s,this.side=a,this.strong=h,this.setStyles(n),this.show()}else this.hide()},this.handleButtonClick=function(e){e.stopPropagation(),this.index+=1},Object.defineProperty(this,"index",{set(e){if(e=parseInt(e),isNaN(e))return BeFunky.throwError("invalid index");e>=t.length&&(e=-1),this._index!==e&&(this._index=e,this.render())},get(){return this._index}}),this.init()}).bind(e)()),BFN.hasOwnProperty("activePresetMenuItem")||(BFN.activePresetMenuItem=null),BFN.UI.presetMenuItem=((e,i)=>(function(){this.addClass("preset-menu-item"),this.options=i,this.useBasicAmount=!this.options.presetObject.hasOwnProperty("useBasicAmount")||this.options.presetObject.useBasicAmount,this.useGeneric=!this.options.presetObject.hasOwnProperty("useGeneric")||this.options.presetObject.useGeneric,this.usePaint=!this.options.presetObject.hasOwnProperty("usePaint")||this.options.presetObject.usePaint,this.useFavoriteIcon=!!i.useFavoriteIcon,this.useBatchProcessingIcon=!!i.useBatchProcessingIcon,this.helpCluePlaceholder=this.options.helpCluePlaceholder,this.helpClueID=this.options.helpClueID,this.paintModeHelpClueID=this.options.paintModeHelpClueID,this.categoryHeader=this.options.header;var e=this.options.presetID,r=!1;this.isSelected=!1,BFN.EDITOR_MENU.presetGenericMenuIDs[e]=this.options.genericMenuID||null,BFN.EDITOR_MENU.presetBrushMenuIDs[e]=this.options.brushMenuID||null,BFN.EDITOR_MENU.applyCancelMenuIDs[e]=this.options.applyCancelMenuID||null;var a=(e,t)=>'\n        <svg class="'.concat(t,'">\n            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(e,'"></use>\n        </svg>\n    ');this.markup='\n        <div id="'.concat(e,'_hover_container" class="preset-menu-item-hover-container active">\n            <div class="preset-menu-item-hover-container__top"></div>\n            <div class="preset-menu-item-hover-container__bottom">\n                ').concat(this.options.presetName,'\n                <span class="badge_holder"></span>\n            </div>\n        </div>\n        <div id="').concat(e,'_basic_settings" class="preset-menu-item-basic-settings">\n            ').concat(this.useFavoriteIcon?'<button id="favorite_'.concat(e,'"></button>'):"","\n            ").concat(this.useBatchProcessingIcon?'<button id="batch_processing_'.concat(e,'"></button>'):"",'\n            <div class="preset-menu-item-basic-settings-buttons preset-menu-btn-group">\n                <button id="').concat(e,'_advanced" class="button button--circle button--dark" data-bfntooltip="settings">\n                    ').concat(a("global-edit-icon","icon icon-size-medium"),'\n                </button>\n                <button id="').concat(e,'_cancel" class="button button--circle button--red" data-bfntooltip="cancel">\n                    ').concat(a("global-cancel-icon","icon icon-size-medium"),'\n                </button>\n                <button id="').concat(e,'_apply" class="button button--circle button--green" data-bfntooltip="apply">\n                    ').concat(a("global-apply-icon","icon icon-size-large"),'\n                </button>\n            </div>\n            <div class="preset-menu-slider slider-handler-original">\n                <div id="').concat(e,'_amount_slider"></div>\n            </div>\n        </div>\n        <div id="').concat(e,'_advanced_settings" class="preset-menu preset-menu-item-advanced-settings">\n            <div class="panel-header"></div>\n            <div class="preset-menu-item-advanced-settings-padding-container">\n                ').concat(this.usePaint?'\n                <div class="tabbed-layout"></div>\n                ':'\n                <div class="generic_menu_container"></div>\n                <div class="custom_controls_container"></div>\n                ','\n                <div class="control-item control-item-bottom">\n                    <div class="apply_cancel_menu_container"></div>\n                </div>\n            </div>\n        </div>\n    '),this.generated=!1,this.generateItem=function(){this.generated||(this.generated=!0,this.innerHTML=this.markup,this.init())},this.init=function(){this.initDefaultValues(),this.initHoverContainer(),this.initFavoriteIcon(),this.updateBadge(),this.options.useThumbImage?this.setBackground(this.options.useThumbImage,!0):this.handleCurrentImageThumbUpdated(),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged)},this.initDefaultValues=function(){this.selectable=!0,this.thumbProcessed=!1,this.useBasicAmount&&(this.presetAmountSlider=document.getElementById(this.options.presetAmountSliderID),this.handlePresetAmountSliderUpdate=(()=>{this.basicAmountSlider.noUiSlider.set(this.presetAmountSlider.noUiSlider.get())})),this.advancedSettings=document.getElementById("".concat(e,"_advanced_settings")),this.basicSettings=document.getElementById("".concat(e,"_basic_settings")),this.usePaint&&(this.tabbedLayout=this.advancedSettings.querySelector(".tabbed-layout"),BFN.UI.tabbedLayout(this.tabbedLayout,{tabs:{adjust:'\n                        <div class="generic_menu_container"></div>\n                        <div class="custom_controls_container"></div>\n                    ',erase:'<div class="brush_menu_container"></div>'},deferLayoutCalc:!0})),this.options.useThumbImage||(BFN.PhotoEditorMenuModel.addEventListener(BFN.PhotoEditorMenuModelEvents.CURRENT_IMAGE_THUMB_UPDATED.type,this.handleCurrentImageThumbUpdated),BFN.PresetMenuItemThumbManager.addEventListener(BFN.PresetMenuItemThumbManagerEvents.PROCESSING_QUEUE_UPDATED.type,this.handleProcessingThumbQueueUpdated)),this.genericMenu=this.useGeneric?document.getElementById(BFN.EDITOR_MENU.presetGenericMenuIDs[e]):null,this.brushMenu=document.getElementById(BFN.EDITOR_MENU.presetBrushMenuIDs[e]),this.applyCancelMenu=this.options.applyCancelMenuID?BFN.applyCancelMenu:null,this.genericMenuContainer=this.advancedSettings.querySelector(".generic_menu_container"),this.brushMenuContainer=this.advancedSettings.querySelector(".brush_menu_container"),this.applyCancelMenuContainer=this.advancedSettings.querySelector(".apply_cancel_menu_container")},this.initHoverContainer=function(){this.hoverContainer=document.getElementById("".concat(e,"_hover_container")),this.hoverContainer.addEventListener("click",()=>{this.selectable&&(UITools.applyTool(e),this.selectItem())})},this.initFavoriteIcon=function(){if(this.useFavoriteIcon){var t=document.getElementById("favorite_".concat(e));BFN.UI.favoriteStar(t),BFN.FavoritesManager.registerFavoriteStar(t)}},this.setupItem=function(){r||(r=!0,this.setupBasicSettings(),this.setupAdvancedSettings(),this.setupCustomControls(),this.setupBatchProcessingIcon())},this.setupBatchProcessingIcon=function(){if(this.useBatchProcessingIcon){var t=document.getElementById("batch_processing_".concat(e));BFN.UI.batchProcessingIcon(t,{iconClass:"icon-size-medium"}),BFN.BatchIconManager.registerButtonIcon(t),this.panelHeader.batchToolID=e,BFN.BatchIconManager.registerPanelHeader(this.panelHeader)}},this.setupBasicSettings=function(){if(document.getElementById("".concat(e,"_advanced")).addEventListener("click",()=>{this.genericMenu&&this.genericMenuContainer.appendChild(this.genericMenu),this.brushMenu&&this.brushMenuContainer&&this.brushMenuContainer.appendChild(this.brushMenu),this.applyCancelMenu&&this.applyCancelMenuContainer.appendChild(this.applyCancelMenu),this.toggleAdvancedSettings(!0),this.togglePaintTab(!1)}),document.getElementById("".concat(e,"_cancel")).addEventListener("click",()=>{BFN.applyCancelMenu.cancelButton.click()}),document.getElementById("".concat(e,"_apply")).addEventListener("click",()=>{BFN.applyCancelMenu.applyButton.click()}),this.useBasicAmount){this.basicAmountSlider=document.getElementById("".concat(e,"_amount_slider"));BFN.UI.slider(this.basicAmountSlider,{start:.5,step:.1,behaviour:"snap",animationDuration:0,connect:[!0,!1],range:{min:0,max:1}},(e,t)=>{var i=this.options.presetAmountSliderID,r="end"!==e;UITools.setControlValue(i,t,r),UITools.applyToolControl(i),UITools.updateToolControl(i)})}},this.setupAdvancedSettings=function(){this.panelHeader=document.querySelector("#".concat(e,"_advanced_settings .panel-header")),BFN.UI.panelHeader(this.panelHeader,{name:this.options.presetName,tag:"h3",modifier:"preset",closeEnabled:!0,helpClueID:this.paintModeHelpClueID}),this.panelHeader.addEventListener("CLOSE",()=>{this.toggleAdvancedSettings(!1)}),this.usePaint&&this.tabbedLayout.addEventListener("TAB_CHANGE",()=>{this.togglePaintTab("erase"===this.tabbedLayout.activeTab)})},this.setupCustomControls=function(){var t=[],i=this.options.presetObject.params,r=e;i.forEach(i=>{var a="".concat(e,"_").concat(i.name),n=i.name;t.push({toolID:r,controlID:a,controlName:n,controlParamObject:Object.assign({},i)})}),UITools.setupControlItems(t,this.advancedSettings.querySelector(".custom_controls_container")),t.forEach(e=>{var t=e.controlID;UITools.registerControl(t)}),this.useBasicAmount||this.useGeneric||this.usePaint||!i.every(e=>"static"===e.type)||(document.getElementById("".concat(e,"_advanced")).disabled=!0)},this.buildItem=function(){if(this.genericMenu&&this.genericMenuContainer.appendChild(this.genericMenu),this.brushMenu&&this.brushMenuContainer&&this.brushMenuContainer.appendChild(this.brushMenu),this.applyCancelMenu){try{this.applyCancelMenu.upgradeMode=!!this.options.presetObject.isPlus&&!BFN.BfnService.userIsPlus}catch(e){}this.applyCancelMenuContainer.appendChild(this.applyCancelMenu)}if(this.helpClueID&&BFN.HelpClueManager.setup(this.helpClueID,{side:"left",positionFactor:0,left:"228px",top:"0px",container:this.helpCluePlaceholder}),this.paintModeHelpClueID&&BFN.HelpClueManager.setup(this.paintModeHelpClueID,{side:"left",positionFactor:0,left:"228px",top:"0px",container:this.helpCluePlaceholder}),!this.usePaint||this.advancedSettingsHeights&&this.advancedSettingsHeights[0]&&this.advancedSettingsHeights[1]||(this.advancedSettingsHeights=[0,0],this.tabbedLayout.panelContainer.addClass("tab__panels--has-not-animated").setStyles({height:""}),this.tabbedLayout._activeTab=this.tabbedLayout.tabNames[1],this.tabbedLayout.handleNewTabSelection(!1),this.advancedSettingsHeights[1]=this.advancedSettings.getBoundingClientRect().height,this.tabbedLayout._activeTab=this.tabbedLayout.tabNames[0],this.tabbedLayout.handleNewTabSelection(!1),this.advancedSettingsHeights[0]=this.advancedSettings.getBoundingClientRect().height),this.parentTop||(this.parentTop=this.parentElement.getBoundingClientRect().top),BFN.activePresetMenuItem){var e=BFN.activePresetMenuItem;e.genericMenu&&e.genericMenuContainer.appendChild(e.genericMenu),e.brushMenu&&e.brushMenuContainer&&e.brushMenuContainer.appendChild(e.brushMenu),e.applyCancelMenu&&e.applyCancelMenuContainer.appendChild(e.applyCancelMenu)}},this.selectItem=function(){if(!this.isSelected){if(this.isSelected=!0,this.previousActiveSibling=null,BFN.activePresetMenuItem){if(BFN.activePresetMenuItem.parentElement===this.parentElement)for(var e=[...this.parentElement.children],t=0;t<e.length&&e[t]!==this;t++)if(e[t]===BFN.activePresetMenuItem){this.previousActiveSibling=BFN.activePresetMenuItem;break}BFN.activePresetMenuItem.deselectItem()}else[...this.parentElement.children].filter(e=>e!==this).forEach(e=>{e.isSelected&&(BeFunky.logError("Selected preset_menu_item sibling found that was not BFN.activePresetMenuItem!",e),e.deselectItem())});this.setupItem(),this.buildItem(),this.hoverContainer.removeClass("active"),BFN.activePresetMenuItem=this,this.toggleBasicSettings(!0),this.togglePaintTab(!1),this.useBasicAmount&&(this.basicAmountSlider.noUiSlider.updateOptions({range:this.presetAmountSlider.noUiSlider.options.range,step:this.presetAmountSlider.noUiSlider.options.step}),this.basicAmountSlider.noUiSlider.set(this.presetAmountSlider.noUiSlider.get()),this.presetAmountSlider.noUiSlider.on("update",this.handlePresetAmountSliderUpdate)),this.helpClueID&&BFN.HelpClueManager.show(this.helpClueID),this.categoryHeader&&(this.categoryHeader.helpEnabled=!0),this.scrollIntoView()}},this.deselectItem=function(){if(this.isSelected){this.isSelected=!1,this.toggleBasicSettings(!1),this.toggleAdvancedSettings(!1),BFN.activePresetMenuItem===this&&(BFN.activePresetMenuItem=null),this.hoverContainer.addClass("active"),this.useBasicAmount&&this.presetAmountSlider.noUiSlider.off("update",this.handlePresetAmountSliderUpdate),this.helpClueID&&BFN.HelpClueManager.hide(this.helpClueID),this.categoryHeader&&(this.categoryHeader.helpEnabled=!1);var e=document.activeElement;this.contains(e)&&e.blur()}},this.toggleBasicSettings=function(e){this.basicSettings.toggleClass("active",e)},this.toggleAdvancedSettings=function(e){this.advancedSettings.toggleClass("active",e),this.togglePaintTab(!1),this.helpClueID&&BFN.HelpClueManager.toggle(this.helpClueID,!e,{force:!1}),this.usePaint||(this.conformToCurrentHeight(),this.scrollIntoView()),this.categoryHeader&&(this.categoryHeader.helpEnabled=!e)},this.togglePaintTab=function(e){this.usePaint&&("erase"===this.tabbedLayout.activeTab===e?(this.paintModeHelpClueID&&(BFN.HelpClueManager.toggle(this.paintModeHelpClueID,e,{force:!1}),this.panelHeader&&(this.panelHeader.helpEnabled=e,this.useBatchProcessingIcon&&(this.panelHeader.batchEnabled=!e))),this.conformToCurrentHeight(this.advancedSettingsHeights?this.advancedSettingsHeights[e?1:0]:void 0),this.scrollIntoView(),BFN.activePresetMenuItem===this&&this.usePaint&&BFN.ImagePainterUndoManager.currentImagePainter&&(BFN.ImagePainterUndoManager.currentImagePainter.paintingEnabled=e,e&&BFN.ImagePainterUndoManager.currentImagePainter.brushSizeChanged&&BFN.ImagePainterUndoManager.currentImagePainter.updateBrush())):this.tabbedLayout.activeTab=this.tabbedLayout.tabNames[e?1:0])},this.conformToCurrentHeight=function(e){var t=this.advancedSettings.hasClass("active")?e||this.advancedSettings.getBoundingClientRect().height:this.hoverContainer.getBoundingClientRect().height;0!==t||this.isSelected||(t=140),this.setStyles({height:"".concat(t,"px")})},this.scrollIntoView=function(){if(this.isSelected&&!this.isAnimatingScroll){this.isAnimatingScroll=!0;var e=this.advancedSettings.hasClass("active")?this.scrollAdvancedSettings():this.scrollBasicSettings();if(0!==e){var i=this.parentElement,r=i.scrollTop;!function(e,i,r){var a=e=>"number"==typeof e?e:null,n=e=>"function"==typeof e?e:e=>e,o=n(r.onComplete),s=n(r.onUpdate),l=n(r.ease),h=Date.now(),c=Object.keys(e).reduce((t,i)=>{var n=a(e[i]),o=a(r[i]);return null!==n&&null!==o&&(t[i]=[n,o]),t},{}),u=Object.keys(c),d=()=>{var a=Date.now(),n=i>0?(a-h)/i:1;u.forEach(r=>{var a=t(c[r],2),o=a[0],s=a[1],h=l(n,o,s,i);e[r]=((e,t,i)=>e+i*(t-e))(o,s,h)}),n>=1?(u.forEach(t=>e[t]=r[t]),s(e),o(e)):(s(e),requestAnimationFrame(d))};d()}({scrollPos:r},300,{scrollPos:r+e,onUpdate:e=>i.scrollTop=e.scrollPos,onComplete:e=>this.isAnimatingScroll=!1,ease:e=>e<.5?2*e*e:(4-2*e)*e-1})}else setTimeout(()=>this.isAnimatingScroll=!1,0)}},this.scrollBasicSettings=function(){var e=0;if(this.previousActiveSibling){var t=this.previousActiveSibling.getBoundingClientRect().height,i=parseInt(this.previousActiveSibling.style.height,10);t&&i&&i<t&&(e=t-i)}var r=this.getBoundingClientRect(),a=this.parentTop-r.top+e,n=r.bottom-BFN.appHeight-e;return a>0?-a:n>0?n:0},this.scrollAdvancedSettings=function(){return this.getBoundingClientRect().top-this.parentTop},this.setBackground=function(e,t){this.setStyles({backgroundImage:'url("'.concat(e,'")')}),this.thumbProcessed=t},this.updateBadge=function(){var e=BFN.BfnService.userIsPlus,t=this.options.presetObject.isPlus,i=this.querySelector(".badge_holder");i.innerHTML=e?"":t?'<span class="badge badge-warning plus-badge"><svg class="icon icon-size-regular"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#upgrade-star"></use></svg></span>':""},this.handleCurrentImageThumbUpdated=(()=>{this.options.useProcessedThumb&&BFN.PhotoEditorMenuModel.currentImageThumbImage&&this.setBackground(BFN.PhotoEditorMenuModel.currentImageThumbImage,!1)}),this.handleProcessingThumbQueueUpdated=(()=>{this.selectable=!BFN.PresetMenuItemThumbManager.processingQueue}),this.handleUserDataChanged=(()=>{this.updateBadge()})}).bind(e)()),BFN.UI.proTip=(e=>(function(){this.init=function(){this.initDefaultValues(),this.initContent()},this.initDefaultValues=function(){},this.initContent=function(){var e=document.createElement("div");if(BFN.UI.popoverContent(e,{width:"100%"}),e.addHeader("pro_tip",14,"#F0D76A",0,12,!1,!1,!1),this.dataset.proTipId&&BFN.ProTipData.hasOwnProperty(this.dataset.proTipId)&&BFN.ProTipData[this.dataset.proTipId]){var t=BFN.ProTipData[this.dataset.proTipId];if(t.length)for(var i=0;i<t.length;i++){var r=t[i];e.addSpacer(),e.addText(r,void 0,12,"#F0D76A",0,0,16)}}this.appendChild(e)},this.init()}).bind(e)()),BFN.UI.resizeTemplateModal=(e=>(function(){this.init=function(){this.initDefaultValues(),this.initAspectRatioDropdown(),this.initDimensionsScrubbers(),this.initCheckboxes(),this.initButtons()},this.initDefaultValues=function(){this.defaultAspectRatio="freeform",this.startSize=Math.min(3300,BFN.maxImageSize),this.panelHeader=this.querySelector(".panel-header"),this.smartResizeGuide=this.querySelector(".guide-text")},this.initAspectRatioDropdown=function(){this.aspectRatioDropdown=document.getElementById("resize_template_aspect_ratio"),this.presetSizes=BFN.DropDownData.resizeTemplateSizes,Tr(this.aspectRatioDropdown,{label:"template_size_presets",initialOptions:this.presetSizes,dropdownMaxHeight:300,onChange:e=>{var i=this.presetSizes.find(t=>{return t.value===e}).value.split("x").map(e=>parseInt(e)).filter(Boolean);if(2===i.length){var r=t(i,2),a=r[0],n=r[1],o=Math.max(n,a);if(o>BFN.maxImageSize){var s=BFN.maxImageSize/o;n=Math.round(n*s),a=Math.round(a*s)}this.widthScrubber.minValue=this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=this.heightScrubber.maxValue=BFN.maxImageSize,this.widthScrubber.currentValue=a,this.heightScrubber.currentValue=n,this.updateLockedAspectRatio()}}})},this.initDimensionsScrubbers=function(){this.widthScrubber=document.getElementById("resize_template_width"),this.heightScrubber=document.getElementById("resize_template_height"),BFN.UI.scrubber(this.widthScrubber),BFN.UI.scrubber(this.heightScrubber),this.widthScrubber.unit=this.heightScrubber.unit="px",this.widthScrubber.minValue=this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=this.heightScrubber.maxValue=BFN.maxImageSize,this.widthScrubber.addEventListener("change",this.switchAspectRatio.bind(this)),this.heightScrubber.addEventListener("change",this.switchAspectRatio.bind(this))},this.initCheckboxes=function(){this.lockAspectRatioCheckbox=document.getElementById("resize_template_lock_aspect_ratio"),BFN.UI.checkboxItem(this.lockAspectRatioCheckbox,{controlID:"resize_template_lock_aspect_ratio",paramObject:{name:"lock_aspect_ratio"}}),this.lockAspectRatioCheckbox=document.getElementById("resize_template_lock_aspect_ratio"),this.lockAspectRatioCheckbox.addEventListener("change",()=>{this.updateLockedAspectRatio()}),this.smartResizeCheckbox=document.getElementById("resize_template_smart_resize"),BFN.UI.checkboxItem(this.smartResizeCheckbox,{controlID:"resize_template_smart_resize",paramObject:{name:"smart_resize"}}),this.smartResizeCheckbox=document.getElementById("resize_template_smart_resize"),this.smartResizeCheckbox.addEventListener("change",()=>{this.toggleSmartResizeGuide()})},this.initButtons=function(){this.swapButton=this.querySelector(".resize-template__swap-dimensions"),this.cancelButton=this.querySelector(".resize-template__cancel"),this.resizeButton=this.querySelector(".resize-template__resize"),this.swapButton.addEventListener("click",()=>this.swapDimensions()),this.cancelButton.addEventListener("click",()=>this.close()),this.resizeButton.addEventListener("click",()=>this.resizeProject())},this.open=function(){BeFunky.openModal(this,{onOpen:()=>{var e=BFN.DesignerModel.projectVO.projectWidth||this.startSize,t=BFN.DesignerModel.projectVO.projectHeight||this.startSize;this.widthScrubber.minValue=this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=this.heightScrubber.maxValue=BFN.maxImageSize,this.widthScrubber.currentValue=e,this.heightScrubber.currentValue=t;var i="".concat(e," x ").concat(t),r=this.presetSizes.find(e=>{return e.value===i}),a=r?r.value:this.defaultAspectRatio;this.switchAspectRatio(a),this.updateLockedAspectRatio(),UITools.toggleControlItem("resize_template_lock_aspect_ratio",!0),this.lockAspectRatioCheckbox.checked=!0,UITools.toggleControlItem("resize_template_smart_resize",!0),this.smartResizeCheckbox.checked=!0,this.resizeButton.setStyles({display:"block"}),this.toggleSmartResizeGuide()},size:"small"})},this.close=function(){BeFunky.closeModal(this)},this.switchAspectRatio=function(e){this.lockAspectRatioCheckbox.checked&&(this.widthScrubber.changing&&(this.heightScrubber.currentValue=Math.round(this.widthScrubber.currentValue*this.lockedAspectRatio)),this.heightScrubber.changing&&(this.widthScrubber.currentValue=Math.round(this.heightScrubber.currentValue/this.lockedAspectRatio))),"string"!=typeof e&&(e=this.defaultAspectRatio),this.aspectRatioDropdown.selectedValue=e},this.updateLockedAspectRatio=function(){this.lockedAspectRatio=this.heightScrubber.currentValue/this.widthScrubber.currentValue,this.lockAspectRatioCheckbox.checked&&1!==this.lockedAspectRatio?this.lockedAspectRatio<1?(this.widthScrubber.minValue=Math.round(BFN.minImageSize/this.lockedAspectRatio),this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=BFN.maxImageSize,this.heightScrubber.maxValue=Math.round(BFN.maxImageSize*this.lockedAspectRatio)):this.lockedAspectRatio>1&&(this.widthScrubber.minValue=BFN.minImageSize,this.heightScrubber.minValue=Math.round(BFN.minImageSize*this.lockedAspectRatio),this.widthScrubber.maxValue=Math.round(BFN.maxImageSize/this.lockedAspectRatio),this.heightScrubber.maxValue=BFN.maxImageSize):(this.widthScrubber.minValue=this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=this.heightScrubber.maxValue=BFN.maxImageSize)},this.swapDimensions=function(){this.widthScrubber.minValue=this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=this.heightScrubber.maxValue=BFN.maxImageSize;var e=this.heightScrubber.currentValue,t=this.widthScrubber.currentValue;this.widthScrubber.currentValue=e,this.heightScrubber.currentValue=t,this.updateLockedAspectRatio()},this.resizeProject=function(){requestIdleCallback(()=>this.close()),BFN.DesignerCanvas.fitToFrameAfterResize=!0;var e=this.smartResizeCheckbox.checked;UITools.setToolValue("collage_customize","smart_resize",e),UITools.setToolValue("collage_customize","width",this.widthScrubber.currentValue),UITools.setToolValue("collage_customize","height",this.heightScrubber.currentValue),UITools.applyTool("collage_customize");var t=this.presetSizes.find(e=>{return e.value===this.aspectRatioDropdown.selectedValue});BFN.DesignerModel.projectVO.printDPI=t.dpi||300;var i=new BFN.UserActionVO;i.eventID="design_layout_resized",i.eventObject={preset:t.name,smartResize:e},i.track()},this.toggleSmartResizeGuide=function(){var e=this.smartResizeCheckbox.checked;this.smartResizeGuide.setStyles({display:"",visibility:e?"":"hidden"})},this.init()}).bind(e)()),BFN.UI.saveShareModal=(e=>(function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this._mode=null,this.modes={save:{computer:{heading:"save_to_computer",useFilename:!0},befunky:{heading:"save_to_befunky",useFilename:!0},google_drive:{heading:"save_to_google_drive",useFilename:!0},google_photos:{heading:"save_to_google_photos",useFilename:!0},dropbox:{heading:"save_to_drop_box",useFilename:!0},project:{heading:"save_as_project",useFilename:!0},complete:{showCloseButton:!0,promptUpgradeOnClose:!0}},share:{facebook:{heading:"share_on_facebook",useTextarea:!0},pinterest:{heading:"share_on_pinterest",useTextarea:!0},tumblr:{heading:"share_on_tumblr",useTextarea:!0},twitter:{heading:"share_on_twitter",useTextarea:!0}}},this.header=document.getElementById("save_and_share_header"),this.leftColumn=this.querySelector(".save-image__left-column"),this.imagePreview=document.getElementById("save_and_share_image_preview"),this.dimensions=document.getElementById("save_and_share_project_dimensions"),this.textareaContainer=document.getElementById("save_and_share_caption_area"),this.textarea=document.getElementById("save_and_share_textarea"),this.filenameContainer=document.getElementById("save_and_share_filename_area"),this.filenameInput=document.getElementById("save_and_share_filename"),this.saveButton=document.getElementById("save_and_share_save"),this.shareButton=document.getElementById("save_and_share_share"),this.qualityGuide=document.getElementById("save_and_share_quality_guide"),this.watermarkControl=this.querySelector(".watermark-control"),this.panelHeader=this.querySelector(".panel-header"),setTimeout(()=>{this.closeButton=this.querySelector(".panel-header__button--close")},0),this.applyCancelButtons=this.querySelector(".save-image__footer"),this.maxPreviewImageWidth=422,this.maxPreviewImageHeight=422,this.filenameInput.addEventListener("keyup",e=>{"Enter"===e.key&&13===e.keyCode&&("share"===this._mode[0]?this.shareButton.click():this.saveButton.click())})},this.updateAndOpen=(()=>{var e="share"===this._mode[0],t=this.modes[this._mode[0]][this._mode[1]],i=t.heading,r=t.useFilename,a=void 0!==r&&r,n=t.useTextarea,o=void 0!==n&&n,s=t.showCloseButton,l=void 0!==s&&s,h=t.promptUpgradeOnClose,c=void 0!==h&&h;this.panelHeader.setStyles({display:l?"flex":""}),this.closeButton&&(this.closeButton.disabled=!l),this.applyCancelButtons.setStyles({display:l?"none":""}),i?(this.header.setLang(i),this.header.setStyles({display:""})):this.header.setStyles({display:"none"}),[...this.classList].forEach(e=>{e.startsWith("save-image--")&&this.removeClass(e)}),this.addClass("save-image--".concat(this.mode[0],"-").concat(this.mode[1].replace(/_/g,"-"))),this.textareaContainer.setStyles({display:o?"block":"none"}),this.filenameContainer.setStyles({display:a?"block":"none"}),this.textarea.value="",this.saveButton.setStyles({display:e?"none":"block"}),this.shareButton.setStyles({display:e?"block":"none"}),a?this.filenameInput.addClass("focus-initially"):o&&this.textarea.addClass("focus-initially"),BeFunky.openModal(this,{closeOnClickOutside:l,onClose:()=>{BFN.UploadSaveShareManager.saveAndShareModalDispose(),this.querySelectorAll(".focus-initially").removeClass("focus-initially"),c&&BFN.UploadSaveShareManager.showUpgradePromptAfterSaving()},onWindowResize:this.updateModalSize.bind(this)})}),this.getText=(()=>{var e,t=this.modes[this._mode[0]][this._mode[1]],i=t.useFilename,r=void 0!==i&&i,a=t.useTextarea,n=void 0!==a&&a;if(r&&(e=this.filenameInput),n&&(e=this.textarea),!e)return BeFunky.logError("All text inputs are hidden in save/share modal"),"";var o=e.value;return o=o.replace(/[\t\f\s\r\n]+/gim," ").replace(/\s{2,}/g,""),r&&(o=o.replace(/^[.\s]+/,"")),o.trim()}),this.close=(()=>{BeFunky.closeModal(this)}),this.updateModalSize=(e=>{var t=e.availableHeight,i=e.availableWidth;this.setStyles({maxHeight:"".concat(t,"px")});var r=Math.min(i-320,Math.round(517.76)),a=Math.min(Math.max(447,t),Math.max(477,r+70));r=Math.min(r,a-70);this.maxPreviewImageWidth=r-48,this.maxPreviewImageHeight=a-70-48;var n=Math.min(this.maxPreviewImageWidth,this.maxPreviewImageHeight)<400?0:48;this.maxPreviewImageWidth-=n,this.maxPreviewImageHeight-=n,this.leftColumn.setStyles({width:"".concat(r,"px"),height:"".concat(a,"px")}),BFN.UploadSaveShareManager.previewCanvas=null,BFN.UploadSaveShareManager.updatePreviewImage()}),this.setPreviewImageSrc=((e,t,i,r)=>{var a,n=this.imagePreview.parentElement,o=this.imagePreview.previousElementSibling,s=Math.min(t,this.maxPreviewImageWidth),l=Math.min(i,this.maxPreviewImageHeight);if(t<s&&i<l)a=t;else{var h=t/s,c=i/l;a=h>c?s:Math.floor(s*h/c)}n.setStyles({width:"".concat(a,"px")}),o.setStyles({paddingBottom:"".concat(100/(t/i),"%")}).toggleClass("save-image__preview-bg--checkered",r),this.imagePreview.setStyles({backgroundImage:'url("'.concat(e,'")'),backgroundSize:"".concat(a,"px"),transform:BeFunky.isChromium&&!BeFunky.isRetina()?"rotate(-1e-10deg)":""})}),Object.defineProperty(this,"mode",{set(e){Array.isArray(e)&&2===e.length&&this.modes[e[0]]&&this.modes[e[0]][e[1]]?(this._mode=e,this.updateAndOpen()):BeFunky.logError("Invalid mode",e)},get(){return this._mode}}),this.init()}).bind(e)()),BFN.UI.scrollStopDispatcher=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.awaitingPointerUp=!1;var e=i=>{this.awaitingPointerUp=!1,document.removeEventListener(BeFunky.pointerup,e),document.removeEventListener("touchend",e),t()},i=t=>{this.awaitingPointerUp=!1,document.removeEventListener(BeFunky.pointerup,e),document.removeEventListener("touchend",e),this.debounceCallback()};this.addEventListener("scroll",()=>{BeFunky.isPointerDown&&!this.awaitingPointerUp&&(this.awaitingPointerUp=!0,document.addEventListener(BeFunky.pointerup,e),document.addEventListener("touchend",i)),this.debounceCallback()})},this.debounceCallback=BeFunky.debounce(function(){this.awaitingPointerUp||t()},i),this.init()}.bind(e)()},BFN.UI.scrubber=((e,t)=>(function(){this.paramObject=t,this.innerHTML='\n        <div class="scrubber-unit"></div>\n        <input type="number" class="input js-scrubber" value="0" />\n        <button class="btn-scrubber btn-scrubber__plus js-scrubber" tabindex="-1">\n            <svg class="icon icon-global-arrow-up-icon input-box-unchecked-info">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-arrow-up-icon"></use>\n            </svg>\n        </button>\n        <button class="btn-scrubber btn-scrubber__minus js-scrubber" tabindex="-1">\n            <svg class="icon icon-global-arrow-down-icon input-box-unchecked-info">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-arrow-down-icon"></use>\n            </svg>\n        </button>\n      ',this.init=function(){this.initDefaultValues(),this.initDisplayElements()},this.initDefaultValues=function(){this._unit="",this._minValue=-2147483648,this._maxValue=2147483647,this._currentValue=0,this._divisor=2,this.arrowsAffectInputValue=!0,this.startValue=0,this.startPoint={},this.deltaPoint={},this.distanceThreshold=5,this.propagateInterval=0,this.propagateStep=0,this.propagating=!1,this.maxLength=-1,this.updating=!1,this.changing=!1,this.wasMixed=!1,this.changed=!1},this.initDisplayElements=function(){this.unitHolder=this.querySelector(".scrubber-unit"),this.numberInput=this.querySelector("input");var e=this.querySelector(".btn-scrubber__plus"),t=this.querySelector(".btn-scrubber__minus");this.numberInput.addEventListener("wheel",this.handleNumberInputWheel),this.numberInput.addEventListener("keypress",this.handleNumberInputKeyPress),this.numberInput.addEventListener("change",this.handleNumberInputChange),this.numberInput.addEventListener("focus",this.handleNumberInputFocus),this.numberInput.addEventListener("blur",this.handleNumberInputBlur),e.addEventListener(BeFunky.pointerdown,this.handleIncreaseButtonPress),t.addEventListener(BeFunky.pointerdown,this.handleDecreaseButtonPress),e.oncontextmenu=(()=>!1),t.oncontextmenu=(()=>!1),this.numberInput.setAttribute("min",this._minValue),this.numberInput.setAttribute("max",this._maxValue),this.numberInput.value=this._currentValue,this.changeEvent=new Event("change"),BeFunky.isEdgeHTML&&this.numberInput.addEventListener("keyup",e=>{38!==e.keyCode&&40!==e.keyCode||this.handleNumberInputChange()})},this.propagate=(()=>{this.propagating&&(setTimeout(this.propagate,this.propagateInterval),50!==this.propagateInterval&&(this.propagateInterval=50),this.currentValue+=this.propagateStep,this.dispatchEvent(this.changeEvent))}),this.handleNumberInputWheel=(e=>(e.preventDefault(),!1)),this.handleNumberInputKeyPress=(e=>{this.mixed&&(this.mixed=!1);if(![37,39,38,40,8,46].includes(e.keyCode)&&!e.ctrlKey&&!e.metaKey){var t="1234567890\r";this._minValue<0&&(t="-".concat(t));var i=String.fromCharCode(e.which);if(t.indexOf(i)<0)return e.preventDefault(),!1;if(!BeFunky.isFirefox){var r=window.getSelection().toString(),a=this.numberInput.value.toString();if(this.numberInput.value.length===this.maxLength&&-1!==this.maxLength&&"\r"!==i&&r!==a)return e.preventDefault(),!1}"\r"===i&&this.wasMixed&&!this.changed&&(this.changed=!0,this.dispatchEvent(this.changeEvent))}}),this.handleNumberInputChange=(e=>{this.mixed&&(this.mixed=!1),this.currentValue=parseInt(this.numberInput.value),e&&e.stopImmediatePropagation(),this.changing||(this.changed=!0,this.changing=!0,this.dispatchEvent(this.changeEvent),this.changing=!1)}),this.handleNumberInputFocus=(()=>{if(this.wasMixed=!!this.mixed,this.changed=!1,this.mixed&&(this.mixed=!1),!BeFunky.isEdgeHTML){var e=this.numberInput;setTimeout(()=>{document.activeElement===e&&e.select()},0)}}),this.handleNumberInputBlur=(()=>{this.wasMixed&&!this.changed&&(this.mixed=!0)}),this.handleIncreaseButtonPress=(e=>{0===e.button&&(this.propagateStep=1,this.handleButtonPress(e))}),this.handleDecreaseButtonPress=(e=>{0===e.button&&(this.propagateStep=-1,this.handleButtonPress(e))}),this.handleButtonPress=(e=>{this.mixed&&(this.mixed=!1),document.addEventListener(BeFunky.pointerup,this.handleButtonRelease),document.addEventListener(BeFunky.pointermove,this.handleButtonDrag),this.startPoint.x=e.pageX,this.startPoint.y=e.pageY,this.propagateInterval=500,this.propagating=!0,this.updating=this.changing=!0,this.propagate()}),this.handleButtonRelease=(()=>{document.removeEventListener(BeFunky.pointerup,this.handleButtonRelease),document.removeEventListener(BeFunky.pointermove,this.handleButtonDrag),this.propagateStep=0,this.propagating=!1,this.updating=this.changing=!1,this.dispatchEvent(this.changeEvent)}),this.handleButtonDrag=(e=>{this.deltaPoint.x=e.pageX-this.startPoint.x,this.deltaPoint.y=e.pageY-this.startPoint.y;var t=Math.sqrt(Math.pow(this.deltaPoint.x,2)+Math.pow(this.deltaPoint.y,2));if(this.propagating&&t>this.distanceThreshold&&(this.propagating=!1,this.startValue=this._currentValue,this.startPoint.x=e.pageX,this.startPoint.y=e.pageY),!this.propagating){var i=parseInt(this.startValue-this.deltaPoint.y/this._divisor);(i<this._minValue||i>this._maxValue)&&(this.startPoint.y=e.pageY,this.startValue=this._currentValue),this.arrowsAffectInputValue?this.currentValue=i:(i=isNaN(i)?0:i,i=Math.max(this._minValue,Math.min(this._maxValue,i)),this._currentValue=i),this.dispatchEvent(this.changeEvent)}}),Object.defineProperty(this,"unit",{set(e){this._unit=e||"",this.unitHolder.textContent=this._unit},get(){return this._unit}}),Object.defineProperty(this,"minValue",{set(e){this._minValue=e,this._maxValue=Math.max(this._maxValue,this._minValue),this.numberInput.setAttribute("min",this._minValue),this.currentValue=this._currentValue},get(){return this._minValue}}),Object.defineProperty(this,"maxValue",{set(e){this._maxValue=e,this._minValue=Math.min(this._minValue,this._maxValue),this.numberInput.setAttribute("max",this._maxValue),this.currentValue=this._currentValue},get(){return this._maxValue}}),Object.defineProperty(this,"currentValue",{set(e){e=isNaN(e)?0:e;var t=Math.max(this._minValue,Math.min(this._maxValue,e));this._currentValue=t,this.numberInput.value=this._currentValue},get(){return this._currentValue}}),Object.defineProperty(this,"divisor",{set(e){this._divisor=Math.max(0,e||0)},get(){return this._divisor}}),Object.defineProperty(this,"mixed",{set(e){this.numberInput.value=e?"":this._currentValue,this.unitHolder.textContent=e?"—":this._unit},get(){return"—"===this.unitHolder.textContent}}),this.init()}).bind(e)()),BFN.UI.selectableList=((e,i,r,a)=>(function(){this.addClass("selectable-list"),this.init=function(){this.initDefaultValues(),this.initFuse(),this.initHeader(),this.initList()},this.initDefaultValues=function(){this._selectedIDs=[],this._choices=[],this.listItems={}},this.initFuse=function(){var e={shouldSort:!0,includeScore:!0,threshold:.2,location:0,distance:100,maxPatternLength:32,minMatchCharLength:this.minValueLength,keys:["translatedName"]};this.setupFuse=(()=>{this.choices.forEach(e=>e.translatedName=BeFunky.LanguageManager.getString(e.name)),this.fuse=new hc(this.choices,e)})},this.initHeader=function(){var e=document.createElement("div").addClass("selectable-list__header");e.innerHTML='\n            <svg class="icon icon-size-medium selectable-list__search-icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-search-icon"></use>\n            </svg>\n            <input type="search" class="input selectable-list__input" placeholder="'.concat(BeFunky.LanguageManager.getString(i),'" data-lang="').concat(i,'">\n            <button class="button button--icon button--transparent selectable-list__clear-search">\n                <svg class="icon icon-size-small">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-cancel-icon"></use>\n                </svg>\n            </button>\n        '),this.appendChild(e),this.input=e.querySelector("input"),this.clearButton=e.querySelector("button");var t=BeFunky.debounce(this.handleTextUpdate.bind(this),25);this.input.addEventListener("change",t),this.input.addEventListener("keyup",t),this.clearButton.addEventListener("click",()=>{this.input.value="",t()}),this.currentValue="",this.minValueLength=2,this.visibleChoices="all";var r=BeFunky.LanguageManager.language.app;BeFunky.LanguageManager.addLanguageUpdateListener(()=>{this.choices.length&&r!==BeFunky.LanguageManager.language.app&&(r=BeFunky.LanguageManager.language.app,this.setupFuse(),this.displayVisibleChoices())})},this.initList=function(){this.list=document.createElement("div").addClass("selectable-list__list"),this.appendChild(this.list),this.noResultsItem=document.createElement("div").setClass("button button--list selectable-list__item selectable-list__item--no-results"),r&&(this.choices=r)},this.generateListItems=function(){this.list.innerHTML="",this.listItems={},this.visibleChoices=this.getVisibleChoiceIDs();var e=document.createDocumentFragment();this.choices.forEach(t=>{var i=t.id,r=t.name,a=document.createElement("button").setClass("button button--list selectable-list__item");"all"===this.visibleChoices||this.visibleChoices.includes(i)||a.setStyles({display:"none"}),a.innerHTML='\n                <string data-lang="'.concat(r,'">').concat(BeFunky.LanguageManager.getString(r),'</string>\n                <svg class="icon icon-size-medium">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-apply-icon"></use>\n                </svg>\n            '),a.addEventListener("click",()=>this.handleItemSelection(i,a)),this.listItems[i]=a,e.appendChild(a)}),e.appendChild(this.noResultsItem),this.list.appendChild(e)},this.updateAllSelections=function(){Object.entries(this.listItems).forEach(e=>{var i=t(e,2),r=i[0];i[1].toggleClass("selectable-list__item--selected",this._selectedIDs.includes(r))})},this.displayVisibleChoices=function(){var e=this.getVisibleChoiceIDs();if(!(this.visibleChoices===e||Array.isArray(this.visibleChoices)&&this.visibleChoices.length&&this.visibleChoices.isIdenticalTo(e))){this.visibleChoices=e;var i="all"===this.visibleChoices?()=>!0:e=>this.visibleChoices.includes(e),r=()=>{Object.entries(this.listItems).forEach(e=>{var r=t(e,2),a=r[0];r[1].setStyles({display:i(a)?"":"none"})})};Array.isArray(this.visibleChoices)&&!this.visibleChoices.length?(this.noResultsItem.innerHTML=BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:'"<strong>'.concat(this.currentValue,'</strong>"')}),this.list.addClass("selectable-list__list--no-results")):requestAnimationFrame(()=>{r(),this.list.removeClass("selectable-list__list--no-results")})}},this.getVisibleChoiceIDs=function(){return this.currentValue.length<this.minValueLength?"all":this.fuse.search(this.currentValue).filter(e=>{return e.score<.5}).map(e=>{return e.item.id})},this.handleTextUpdate=function(){var e=this.input.value;(e=e.toLowerCase().replace(/[^a-z0-9-_ \u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/g,"").trim())!==this.currentValue&&(this.currentValue=e,this.displayVisibleChoices())},this.handleItemSelection=function(e,t){var i="selectable-list__item--selected",r=!t.hasClass(i),n=this._selectedIDs.includes(e);return r&&!n?(this._selectedIDs.splice(0,0,e),this.listItems[e].addClass(i),a(this._selectedIDs)):!r&&n?(this._selectedIDs.splice(this._selectedIDs.indexOf(e),1),this.listItems[e].removeClass(i),a(this._selectedIDs)):void 0},Object.defineProperty(this,"selectedIDs",{set(e){this._selectedIDs.isIdenticalTo(e)||(this._selectedIDs.splice(0),e instanceof Array&&this._selectedIDs.push(...e),this.updateAllSelections())},get(){return this._selectedIDs}}),Object.defineProperty(this,"choices",{set(e){if(Array.isArray(e)&&e.every(e=>e.id&&e.name)){if(!this._choices.isIdenticalTo(e)){this._choices=e.slice();var t=Object.keys(this._choices);this.selectedIDs=this.selectedIDs.filter(e=>t.includes(e)),this.setupFuse(),this.generateListItems()}}else BeFunky.throwError("choices must be an array of objects with id and name properties")},get(){return this._choices}}),this.init()}).bind(e)()),BFN.UI.simpleSelector=((e,t)=>(function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=[...this.querySelectorAll("."+t)];e.forEach(t=>{t.dataset.container&&(t.container=document.getElementById(t.dataset.container)),t.addEventListener(BeFunky.pointerdown,t=>{e.forEach(e=>{e==t.target?(e.addClass("active"),e.container&&e.container.addClass("active")):(e.removeClass("active"),e.container&&e.container.removeClass("active"))})})})},this.init()}).bind(e)()),BFN.UI.slider=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function(){noUiSlider.create(this,t),this.addClass("bfn-slider"),this.init=function(){this.handleElement=this.querySelector(".noUi-handle"),this.handleElement.slider=this,this.noUiSlider.on("slide",this.createUpdateHandler("slide")),this.noUiSlider.on("end",this.createUpdateHandler("end")),r&&this.noUiSlider.on("start",this.createUpdateHandler("start")),this.lastEventValue=null,this.lastEventType="end",this.onUpdate=((e,t)=>{this.lastEventType=e,this.lastEventValue=t,i(e,t)})},this.update=((e,t)=>{({start:this.updateStart,slide:this.updateSlide,end:this.updateEnd})[e](t)}),this.updateStart=(e=>{"slide"!==this.lastEventType&&this.onUpdate("start",e)}),this.updateSlide=BeFunky.throttle(e=>{"end"===this.lastEventType&&this.lastEventValue===e||this.onUpdate("slide",e)},BeFunky.isEdgeHTML?100:66),this.updateEnd=(e=>{"end"===this.lastEventType&&this.lastEventValue===e||this.onUpdate("end",e)}),this.createUpdateHandler=(e=>{var t=document.getElementById("appStage");return(i,r)=>{if(this.update(e,i[r]),"end"===e){this.handleElement.focus();var a=()=>{t.removeEventListener("click",a),document.activeElement===this.handleElement&&this.handleElement.blur()};t.addEventListener("click",a)}"slide"===e||"start"===e?this.addClass("bfn-slider--active"):"end"===e&&this.removeClass("bfn-slider--active")}}),this.init()}.bind(e)()},BFN.UI.sliderItem=((e,t)=>{var i=t.toolID,r=t.paramID,a=t.controlID,n=t.paramObject,o=n.name,s=n.multiplier,l=void 0===s?1:s,h=n.unit,c=void 0===h?"":h,u=n.valueElementIDs,d=void 0===u?[]:u;return function(){var e=document.createElement("div");e.innerHTML='\n        <div class="slider-label">\n            <label class="control-item-label" data-lang="'.concat(o,'">\n                ').concat(BeFunky.LanguageManager.getString(o),'\n            </label>\n            <label class="control-item-label slider-label__value">\n                <span id="').concat(a,'_value_label"></span>\n                ').concat(c,'\n            </label>\n        </div>\n        <div id="').concat(a,'"></div>\n    '),this.parentElement.replaceChild(e,this),this.init=function(){this.slider=UITools.registerSliderControl(a),this.slider.updateValueLabel=this.updateValueLabel.bind(this),this.valueLabel=document.getElementById("".concat(a,"_value_label")),this.labelUpdatePending=!1,this.updateValueLabel(),UITools.addEventListener(UIToolsEvents.TOOL_PARAM_UPDATED.type,this.handleToolParamUpdated)},this.updateValueLabel=(()=>{this.labelUpdatePending||(this.labelUpdatePending=!0,requestAnimationFrame(()=>{var e=UITools.getToolValue(i,r);this.valueLabel.textContent=Math.round(e*l),this.labelUpdatePending=!1,d.forEach(e=>{var t=document.getElementById(e);t&&(t.textContent=this.valueLabel.textContent)})}))}),this.handleToolParamUpdated=(e=>{e.data.toolID===i&&e.data.paramID===r&&this.updateValueLabel()}),this.init()}.bind(e)()}),BFN.UI.sortableList=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.handleTargetIndexUpdated,r=t.handleOrderUpdated;return function(){var t="sortable-list__item",a="drag-over",n="drag-over-down",o="drag-over-up",s="no-pointer",l={targetIndexUpdated:new Event("TARGET_INDEX_UPDATED"),listOrderUpdated:new Event("LIST_ORDER_UPDATED")};this.init=function(){this.initDefaultValues(),this.refreshList()},this.initDefaultValues=function(){this.addClass("sortable-list"),this.isSortableList=!0,e.setStyles({touchAction:"none"}),e.parentNode.setStyles({touchAction:"none"}),this._listItems=[],this._listItemH=0,this._dragging=!1,this._draggedItem=null,this._draggedItemIndex=null,this._targetIndex=null,this._hoveredItem=null,this._hoveredItemIndex=null,this._hoveredItemSide=null,this._scrollable=!1,this._scrollItem=null,this._scrollHeight=0,this._scrollRect=null,this.handleDocumentKeyDownBind=this.handleDocumentKeyDown.bind(this)},this.refreshList=function(){this._listItems.splice(0),this._listItems.push(...e.querySelectorAll(".".concat(t))),!this.hasOwnProperty("paddingTop")&&this._listItems.length&&(this.paddingTop=this._listItems[0].offsetTop),this._listItems.forEach(e=>{e.hasClass(t)&&this.makeListItemSortable(e)})},this.makeListItemSortable=function(e){e.isSortable||(BFN.UI.sortableListItem(e),e.addEventListener("dragpress",this.handleListItemDragPress.bind(this)),e.addEventListener("dragstart",this.handleListItemDragStart.bind(this)),e.addEventListener("drag",this.handleListItemDrag.bind(this)),e.addEventListener("dragend",this.handleListItemDragEnd.bind(this)))},this.updateScrollParams=function(){var t=window.getComputedStyle(e);this._scrollable="scroll"===t.getPropertyValue("overflow-y")||"auto"===t.getPropertyValue("overflow-y"),this._scrollItem=e,this._scrollable||(t=window.getComputedStyle(e.parentNode),this._scrollable="scroll"===t.getPropertyValue("overflow-y")||"auto"===t.getPropertyValue("overflow-y"),this._scrollItem=this._scrollable?e.parentNode:e),this._scrollHeight=this._scrollItem.scrollHeight,this._scrollRect=this._scrollItem.getBoundingClientRect(),this._scrollRect=new BFN.Rectangle(this._scrollRect.left,this._scrollRect.top,this._scrollRect.width,this._scrollRect.height),this._listItems.length>1?this._listItemH=Math.abs(this._listItems[1].offsetTop-this._listItems[0].offsetTop):this._listItems.length&&(this._listItemH=this._listItems[0].offsetHeight)},this.updateDragOverClasses=function(e,t){var i=(e,t)=>{switch(e.addClass(a),t){case"top":e.addClass(o);break;case"bottom":e.addClass(n)}},r=null;this._listItems.forEach((s,l)=>{if(s!==r&&(e=>{e.removeClass(a),e.removeClass(n),e.removeClass(o)})(s),l===e)switch(t){case"top":i(s,"top");break;case"bottom":l<this._listItems.length-1?(r=this._listItems[l+1],i(r,"top")):i(s,"bottom")}})},this.ensureItemVisibility=function(e){var t=this.hasOwnProperty("paddingTop")?this.paddingTop:0,i=e.offsetTop-t,r=e.offsetHeight;i<this._scrollItem.scrollTop?this._scrollItem.scrollTop=i:i+r>this._scrollItem.scrollTop+this._scrollItem.offsetHeight&&(this._scrollItem.scrollTop=Math.max(0,i+r-this._scrollItem.offsetHeight))},this.handleListItemDragPress=function(){this.updateScrollParams()},this.handleListItemDragStart=function(e){this._dragging=!0,this._draggedItem=e.target,this._draggedItem.addClass("dragging"),this._draggedItemIndex=this._listItems.indexOf(this._draggedItem),this._draggedItem.scrollDrag?this.scrollTopStart=this._scrollItem.scrollTop:(this._hoveredItem=null,this._hoveredItemIndex=null,this._hoveredItemSide=null,this.addClass("sortable-list--dragging"),this.addClass(s),BFN.isSortableListDragActive=!0,document.addEventListener("keydown",this.handleDocumentKeyDownBind,!0))},this.handleListItemDrag=function(e){if(this._draggedItem.scrollDrag)this._scrollable&&(this._scrollItem.scrollTop=Math.max(0,Math.min(this._scrollHeight-this._scrollRect.height,this.scrollTopStart+(this._draggedItem.pointerDownPoint.y-e.pageY))));else{var t=e.pageY-this._scrollRect.y;if(this._scrollable){var r=0;t<0?r=-Math.max(1,Math.min(10,Math.round(Math.abs(t)/10))):t>this._scrollRect.height&&(r=Math.max(1,Math.min(10,Math.round((t-this._scrollRect.height)/10)))),r&&(this._scrollItem.scrollTop=Math.max(0,Math.min(this._scrollHeight-this._scrollRect.height,this._scrollItem.scrollTop+r)))}t=Math.max(0,Math.min(this._scrollRect.height,t));var a=Math.floor((this._scrollItem.scrollTop+t)/this._listItemH);if(a>=0&&a<this._listItems.length){var n,o=this._listItems[a],s=t<a*this._listItemH-this._scrollItem.scrollTop+this._listItemH/2?"top":"bottom";if(o!==this._hoveredItem||this._hoveredItemIndex!==a||s!==this._hoveredItemSide)this._hoveredItem=o,this._hoveredItemIndex=a,this._hoveredItemSide=s,this.updateDragOverClasses(this._hoveredItemIndex,this._hoveredItemSide),n=this._hoveredItemIndex===this._draggedItemIndex||this._draggedItemIndex===this._hoveredItemIndex-1&&"top"===this._hoveredItemSide||this._draggedItemIndex===this._hoveredItemIndex+1&&"bottom"===this._hoveredItemSide?this._draggedItemIndex:this._hoveredItemIndex+("bottom"===this._hoveredItemSide?1:0)-(this._draggedItemIndex<this._hoveredItemIndex?1:0),(n=Math.max(0,Math.min(n,this._listItems.length-1)))!==this._targetIndex&&(this._targetIndex=n,i?i(this._draggedItem,this._draggedItemIndex,this._targetIndex):this.dispatchEvent(l.targetIndexUpdated))}}},this.handleListItemDragEnd=function(){if(this._draggedItem.scrollDrag)this.completeDrag();else if(this._dragging&&this._targetIndex!==this._draggedItemIndex){var i,a=this._targetIndex;if(r)i=r(this._draggedItem,this._draggedItemIndex,this._targetIndex);else{switch(this._hoveredItemSide){case"top":e.insertBefore(this._draggedItem,this._hoveredItem);break;case"bottom":e.insertBefore(this._draggedItem,this._hoveredItem.nextSibling||null)}i=Promise.resolve()}i.then(()=>{this._listItems.splice(0),this._listItems.push(...e.querySelectorAll(".".concat(t))),r||this.dispatchEvent(l.listOrderUpdated);var i=this._listItems[a];this.ensureItemVisibility(i),i.addClass("dropped"),setTimeout(()=>{i.removeClass("dropped")},220),this.completeDrag()})}else this.completeDrag()},this.handleDocumentKeyDown=function(e){27===e.keyCode&&this._dragging&&this._draggedItem&&(this._dragging=!1,this._draggedItem.stopDrag(),this._targetIndex!==this._draggedItemIndex&&(this._targetIndex=this._draggedItemIndex,this.dispatchEvent(l.targetIndexUpdated)),e.stopImmediatePropagation(),this.completeDrag())},this.completeDrag=function(){this._dragging=!1,this._draggedItem.removeClass("dragging"),this._draggedItem=null,this._draggedItemIndex=null,this._targetIndex=null,this._hoveredItem=null,this._hoveredItemIndex=null,this._hoveredItemSide=null,this.removeClass("sortable-list--dragging"),this.removeClass(s),this.updateDragOverClasses(),BFN.isSortableListDragActive=!1,document.removeEventListener("keydown",this.handleDocumentKeyDownBind,!0)},Object.defineProperty(this,"draggedItem",{get(){return this._draggedItem}}),Object.defineProperty(this,"targetIndex",{get(){return this._targetIndex}}),Object.defineProperty(this,"listItems",{get(){return this._listItems}}),this.init()}.bind(e)()},BFN.UI.sortableListItem=(e=>(function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.isSortable=!0,this.dragging=!1,this.hovering=!1,this.dragThreshold=10,this.scrollDrag=!1,this.pointerType=null,this.pointerDownPoint=null,this.pointerPosition={x:0,y:0},this.pointerOffset={x:0,y:0},this.pointerDownTime=0,this.handlePointerMoveBind=this.handlePointerMove.bind(this),this.handlePointerUpBind=this.handlePointerUp.bind(this),this.handlePointerOverBind=this.handlePointerOver.bind(this),this.handlePointerOutBind=this.handlePointerOut.bind(this),this.addEventListener(BeFunky.pointerdown,this.handlePointerDown.bind(this),!0)},this.activate=function(){this.addEventListener(BeFunky.pointerover,this.handlePointerOverBind,!0),this.addEventListener(BeFunky.pointerout,this.handlePointerOutBind,!0)},this.deactivate=function(){this.hovering=!1,this.removeEventListener(BeFunky.pointerover,this.handlePointerOverBind,!0),this.removeEventListener(BeFunky.pointerout,this.handlePointerOutBind,!0)},this.stopDrag=function(){this.dragging&&(this.dragging=!1,BFN.DragScreen.hide(),this.handlePointerUp())},this.dragInterval=function(){this.dragging&&(this.dispatchEvent(this.getMouseEvent("drag")),setTimeout(this.dragInterval.bind(this),BFN.frameInterval))},this.overInterval=function(){this.hovering&&(this.pointerPosition.x===BeFunky.globalPointerCoords.x&&this.pointerPosition.y===BeFunky.globalPointerCoords.y||(Object.assign(this.pointerPosition,BeFunky.globalPointerCoords),this.dispatchEvent(this.getMouseEvent("dragover"))),setTimeout(this.overInterval.bind(this),BFN.frameInterval))},this.getMouseEvent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=new Event(e);return t.pageX=BeFunky.globalPointerCoords.x,t.pageY=BeFunky.globalPointerCoords.y,t},this.handlePointerDown=function(e){2!==e.button&&(this.pointerType=e.pointerType,this.pointerDownPoint={x:e.pageX,y:e.pageY},this.pointerDownTime=Date.now(),this.pointerOffset={x:e.offsetX,y:e.offsetY},document.addEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUpBind,!0),this.dispatchEvent(this.getMouseEvent("dragpress")))},this.handlePointerMove=function(e){var t=e.pageX-this.pointerDownPoint.x,i=e.pageY-this.pointerDownPoint.y,r=Math.sqrt(Math.pow(t,2)+Math.pow(i,2)),a=Date.now()-this.pointerDownTime;if(!this.dragging)if("touch"===this.pointerType&&Math.abs(i)>=this.dragThreshold&&a<500)this.dragging=!0,this.scrollDrag=!0,this.pointerDownPoint={x:e.pageX,y:e.pageY},this.dispatchEvent(this.getMouseEvent("dragstart"));else if(r>this.dragThreshold){this.dragging=!0,this.scrollDrag=!1,this.dispatchEvent(this.getMouseEvent("dragstart"));var n=this,o=this.querySelector(".sortable-list__item-drag-image");o&&(n=o);var s=n.cloneNode(!0),l=n.getBoundingClientRect();s.setStyles({pointerEvents:"none",width:"".concat(l.width,"px"),height:"".concat(l.height,"px")});for(var h=n,c=s;h.parentNode;){var u=document.createElement("div");h.parentNode.className&&(u.className=h.parentNode.className.replace(/(^|\s)sortable-list__item($|\s)/,"$1$2").replace(/(^|\s)dragging($|\s)/,"$1$2")),u.appendChild(c),u.setStyles({pointerEvents:"none",overflow:"visible",display:"block",position:"absolute",visibility:"visible",boxShadow:"none",left:0,top:0,width:"".concat(l.width,"px"),height:"".concat(l.height,"px")}),h=h.parentNode,c=u}var d=Math.max(4,Math.min(this.pointerOffset.x,l.width-4)),m=Math.max(4,Math.min(this.pointerOffset.y,l.height-4));c.setStyles({left:"".concat(-d,"px"),top:"".concat(-m,"px")}),BFN.DragScreen.showNode(c)}this.dragging&&(document.removeEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),this.dragInterval())},this.handlePointerUp=function(e){this.dragging&&e&&(e.target&&e.target.isSortable&&e.target.dispatchEvent(this.getMouseEvent("drop")),this.dispatchEvent(this.getMouseEvent("dragend"))),this.dragging=!1,this.hovering=!1,document.removeEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpBind,!0)},this.handlePointerOver=function(e){this.hovering=!0,this.dispatchEvent(this.getMouseEvent("dragenter")),this.overInterval()},this.handlePointerOut=function(e){this.hovering=!1,this.dispatchEvent(this.getMouseEvent("dragleave"))},this.init()}).bind(e)());var Gg=BeFunky.lit.html;function Hg(){var t=e(['\n            <video class="webcam__video" autoplay>\n                <string data-lang="video_stream_not_available">',"</string>\n            </video>"]);return Hg=function(){return t},t}BFN.UI.stockSearchModal=(e=>(function(){function e(e){var t=e.id,i=e.author,r=e.authorURL;if(!i||!r)return"";return Gg(Ug(),r,i,Gg([{pixabay:'<a href="https://pixabay.com/?utm_source=befunky&utm_medium=referral" target="_blank" rel="noopener">Pixabay</a>',unsplash:'<a href="https://unsplash.com/?utm_source=befunky&utm_medium=referral" target="_blank" rel="noopener">Unsplash</a>',pexels:'<a href="https://pexels.com/?utm_source=befunky&utm_medium=referral" target="_blank" rel="noopener">Pexels</a>'}[BFN.getImageType(t)]]))}this.init=function(){this.initDefaultValues(),this.initSearch(),this.initTags(),this.initGallery()},this.initDefaultValues=function(){this.defaultSearch="featured",this.rightPanel=this.querySelector(".stock-search__right-panel"),this.rightPanelScroller=this.querySelector(".modal__right-panel-scroller"),this.resultsHeader=this.querySelector(".stock-search__results-header"),this.resultsHeading=this.querySelector(".stock-search__results-heading"),this.clearResultsButton=this.querySelector(".stock-search__clear-results"),this.clearResultsButton.addEventListener("click",this.handleClearResults),this.modalMaxWidth=1600,this.galleryMaxWidth=this.modalMaxWidth-288-48,document.querySelector(".stock-search__attribution").setLang("stock_image_services",{pexels:'<a href="https://pexels.com/?utm_source=befunky&utm_medium=referral" target="_blank" rel="noopener">Pexels</a>',pixabay:'<a href="https://pixabay.com/?utm_source=befunky&utm_medium=referral" target="_blank" rel="noopener">Pixabay</a>',unsplash:'<a href="https://unsplash.com/?utm_source=befunky&utm_medium=referral" target="_blank" rel="noopener">Unsplash</a>'})},this.initSearch=function(){this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.previousSearchQuery="",this.previousSearchPage="",this.clearButton.addEventListener("click",()=>this.searchInput.focus()),this.searchForm.addEventListener("submit",this.handleSearch)},this.initTags=function(){this.tagsContainer=document.querySelector(".stock-search__tags"),this.tagsContainer.addEventListener("click",e=>{var t=e.target;t&&t.hasClass("stock-search__tag")&&(this.searchInput.value=t.textContent,this.handleSearch())});this.tagButtons={};var e=document.createDocumentFragment();Object.entries({wedding:"Wedding",food:"Food",portrait:"Portrait",landscapes:"Landscapes",travel:"Travel",fine_art:"Fine Art",nature:"Nature",sky:"Sky",water:"Water",people:"People",sunset:"Sunset",dogs:"Dogs",cats:"Cats"}).forEach(i=>{var r=t(i,2),a=r[0],n=r[1],o=document.createElement("button");o.className="button stock-search__tag",o.textContent=n,this.tagButtons[a]={button:o,name:n},e.appendChild(o)}),this.tagsContainer.appendChild(e)},this.initGallery=function(){this.stockGallery=document.querySelector(".stock-search__results-gallery"),this.stockGallery.selectedImageIDs=BFN.ImageLibraryManager.selectedMenuImageVOs.filter(e=>["unsplash","pixabay","pexels"].includes(BFN.getImageType(e.id))).map(e=>e.id),this.stockGallery.onSelectItem=((e,t)=>"UPLOAD_MENU"===BFN.ImageLibraryManager.mode?(this.close(),void BFN.PhotoEditorModel.confirmEditorLoadImage(()=>{BFN.ImageLibraryManager.addImageToPhotoEditorCanvas(e)},()=>{BFN.ImageLibraryManager.mode="UPLOAD_MENU",this.open()})):BFN.ImageLibraryManager.handleImageSelection(e,t)),this.stockGallery.rowHeight=215,this.stockGallery.extendItemTemplate=e,this.stockGallery.addItemClass=(e=>{var t=e.author,i=e.authorURL;return t&&i?"gallery__item--has-content":""}),this.loadSearchResults(this.defaultSearch),this.loadNextPageOnScroll=null;var t=BeFunky.listenForScroll(this.rightPanelScroller,this.handleScroll.bind(this)).recalculateScrollPosition;this.recalculateScrollPosition=t},this.open=function(){BeFunky.openModal(this,{onOpen:()=>{BeFunky.isAndroid||this.searchInput.focus()},onClose:()=>{BFN.ImageLibraryManager.mode="IMAGE_MANAGER"},onWindowResize:this.updateModalSize.bind(this),size:"xxl"})},this.close=function(){BeFunky.closeModal(this)},this.selectGalleryItem=function(e){this.stockGallery.selectedImageIDs=[...this.stockGallery.selectedImageIDs,e].unique()},this.deselectGalleryItem=function(e){this.stockGallery.selectedImageIDs=this.stockGallery.selectedImageIDs.filter(t=>t!==e)},this.loadSearchResults=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!(this.previousSearchQuery===e&&t<=this.previousSearchPage)){this.previousSearchQuery=e,this.previousSearchPage=t,this.loadNextPageOnScroll=null,1===t&&(this.stockGallery.images=[],this.rightPanelScroller.scrollTop=0),this.stockGallery.message="",this.stockGallery.isLoading=!0;var i=e===this.defaultSearch;this.resultsHeader.setStyles({display:""}),i?this.resultsHeading.setLang("featured_images"):this.resultsHeading.setLang("search_results_for",{query:"<strong>".concat(BeFunky.escapeHTML(e),"</strong>")}),this.toggleInteractivity(!1),this.clearResultsButton.setStyles({visibility:"hidden"}),1===t&&this.selectRelatedTag(e),BFN.ImageLibraryService.getStockImages(t,e,r=>{var a=r.data,n=r.totalPages,o=r.error;if(this.stockGallery.isLoading=!1,this.toggleInteractivity(!0),i||this.clearResultsButton.setStyles({visibility:""}),o)return BeFunky.logError("Unable to fetch images",o),void("no_results"===o?(this.resultsHeader.setStyles({display:"none"}),this.stockGallery.message="",this.stockGallery.emptyState={icon:"no-results-icon",text:BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:'"<strong>'.concat(e,'</strong>"')})}):(this.stockGallery.message={isError:!0,text:BeFunky.failureReason(o),buttonText:"try_again",buttonAction:()=>this.loadSearchResults(e,t)},this.previousSearchPage=this.previousSearchPage-1));this.stockGallery.images=[...this.stockGallery.images,...a],this.stockGallery.message="",this.recalculateScrollPosition();var s=()=>this.loadSearchResults(e,t+1);t>=n||(t<=2?this.loadNextPageOnScroll=s:this.stockGallery.message={buttonText:"load_more",buttonAction:s})})}},this.toggleInteractivity=function(e){this.searchButton.disabled=!e,this.clearResultsButton.disabled=!e,this.tagsContainer.setStyles({pointerEvents:e?"":"none"})},this.selectRelatedTag=function(e){Object.values(this.tagButtons).forEach(t=>{var i=t.name;t.button.toggleClass("stock-search__tag--selected",i.toLowerCase()===e.toLowerCase())})},this.updateModalSize=(e=>{var t=e.availableWidth,i=this.galleryMaxWidth+(t-this.modalMaxWidth);this.stockGallery.currentWidth!==i&&(this.stockGallery.currentWidth=i),this.recalculateScrollPosition()}),this.handleSearch=(e=>{e&&e.preventDefault();var t=this.searchInput.value.replace(/[`~!@#$%^&*()_|+=?;:'",.<>{}\[\]\\\/]/gi," ").replace(/ {2,}/g," ").trim();this.searchInput.value=t,t&&this.loadSearchResults(t)}),this.handleClearResults=(()=>{this.loadSearchResults(this.defaultSearch),this.searchInput.value="",this.searchInput.focus()}),this.handleScroll=(e=>{var t=e.scrollHeight,i=e.offsetHeight,r=e.scrollTop;if(this.stockGallery.images.length&&(this.stockGallery.viewport=[r,r+i],this.loadNextPageOnScroll)){t-i-r<=800&&this.loadNextPageOnScroll()}}),this.init()}).bind(e)()),BFN.UI.tabbedLayout=((e,t)=>{var i=t.tabs,r=void 0===i?{}:i,a=t.deferLayoutCalc,n=void 0!==a&&a;return function(){var e=this,t=Object.keys(r);if(t.length){var i=t.map((e,t)=>'\n        <li class="tab__item">\n            <button class="tab__button tab__button--'.concat(o(e),'" data-lang="').concat(e,'">\n                ').concat(BeFunky.LanguageManager.getString(e),"\n            </button>\n            ").concat(0===t?'<div class="tab__underline"></div>':"","\n        </li>\n    ")).join(""),a=t.map(e=>'\n        <div class="tab__panel tab__panel--'.concat(o(e),'">\n            ').concat(r[e],"\n        </div>\n    ")).join("");this.innerHTML='\n        <ul class="tab__nav">'.concat(i,'</ul>\n        <div class="tab__panels tab__panels--has-not-animated">').concat(a,"</div>\n    "),this.init=function(){this.initDefaultValues(),this.initTabs()},this.initDefaultValues=function(){this.tabs={},this.tabNames=t;var e=[...this.querySelectorAll(".tab__button")],i=[...this.querySelectorAll(".tab__panel")];t.forEach((t,r)=>{this.tabs[t]={button:e[r],panel:i[r]}}),this.firstTabButton=e[0],this.firstTabName=t[0],this.underline=this.querySelector(".tab__underline"),this.panelContainer=this.querySelector(".tab__panels"),this.tabChangeEvent=new Event("TAB_CHANGE")},this.initTabs=function(){var e=this,i=function(t){var i=e.tabs[t].button;i.addEventListener("click",()=>{e.activeTab=t,setTimeout(()=>i.focus(),0)})};for(var r in this.tabs)i(r);this.activeTab=t[0]},this.handleNewTabSelection=(e=>{var t=this.tabs[this._activeTab],i=t.button,r=t.panel;this.querySelectorAll(".tab__button.active, .tab__panel.active").removeClass("active"),i.addClass("active"),r.addClass("active");var a=()=>{this.updateTabUnderline(i),e&&this.updatePanelContainerHeight(r)};n?(n=!1,BFN.MainUI.addIdleRenderFunction(()=>{a()})):a(),this.dispatchEvent(this.tabChangeEvent)}),this.updatePanelContainerHeight=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.tabs[e._activeTab].panel;e.panelContainer.removeClass("tab__panels--has-not-animated");var i=()=>{e.panelContainer.setStyles({height:"".concat(t.getBoundingClientRect().height,"px")})};e.prevActiveTab&&!e.panelContainer.style.height?(e.panelContainer.setStyles({height:"".concat(e.tabs[e.prevActiveTab].panel.getBoundingClientRect().height,"px")}),requestAnimationFrame(i)):i()},this.updateTabUnderline=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.tabs[e._activeTab].button;if(t!==e.firstTabButton){var i=t.getBoundingClientRect();e.underline.setStyles({width:"".concat(i.width,"px"),transform:"translateX(".concat(i.left-e.firstTabButton.getBoundingClientRect().left,"px)")})}else(e.underline.style.width||e.underline.style.transform)&&e.underline.setStyles({width:"",transform:""})},this.getTabPanel=(e=>this.querySelector(".tab__panel--".concat(o(e)))),Object.defineProperty(this,"activeTab",{set(e){if(this._activeTab!==e)if(e)if(this.tabs.hasOwnProperty(e)){var t=void 0!==this._activeTab;this.prevActiveTab=this._activeTab,this._activeTab=e,this.handleNewTabSelection(t)}else BeFunky.logError("Invalid active tab specified:",e);else this.activeTab=this.firstTabName},get(){return this._activeTab}}),this.init()}else BeFunky.logError("No tabs provided to tabbedLayout() component");function o(e){return e.replace(/[^0-9a-z-]/gi,"-").replace(/-{2,}/g,"-").replace(/^-|-$/g,"").toLowerCase()}}.bind(e)()}),BFN.UI.toolMenuAdjustAndPaint=((e,t)=>{var i=t.toolID,r=t.menuName,a=t.controlData,n=t.tutorialLink,o=void 0!==n&&n,s=t.tutorialName,l=void 0!==s&&s,h=t.tabIDs,c=void 0===h?["adjust","erase"]:h,u=t.helpClueID,d=void 0===u?"erase_mode":u;return function(){this.addClass("tool-menu");var e=o&&l?'\n        <div class="tutorial">\n            <p data-lang="need_help">\n                '.concat(BeFunky.LanguageManager.getString("need_help"),'\n            </p>\n            <p><a href="').concat(o,'" data-bfntrack="CREATE|HELP|').concat(l,'" class="tutorial-link" target="_blank">\n                <string data-lang="tutorial_link">').concat(BeFunky.LanguageManager.getString("tutorial_link"),"</string>\n            </a></p>\n        </div>\n    "):"";this.innerHTML='\n        <div class="panel-header"></div>\n        <div class="popover-placeholder"></div>\n        <div class="tool-menu__scroll-container">\n            <div class="control-item-set">\n                <div class="tabbed-layout"></div>\n                <div class="control-item control-item-bottom">\n                    <div class="apply_cancel_menu_container"></div>\n                </div>\n            </div>\n            '.concat(e,"\n        </div>\n    "),this.init=function(){this.initDefaultValues(),this.initPanelHeader(),this.initTabbedLayout(),this.initAdjustControls()},this.initDefaultValues=function(){this.panelHeader=this.querySelector(".panel-header"),this.helpCluePlaceholder=this.querySelector(".popover-placeholder"),this.tabbedLayout=this.querySelector(".tabbed-layout")},this.initPanelHeader=function(){var e=r||i;BFN.UI.panelHeader(this.panelHeader,{name:e,modifier:"tertiary",helpClueID:d}),BFN.BatchToolManager.batchEditToolIDs.includes(e)&&(this.panelHeader.batchToolID=e,this.panelHeader.batchEnabled=!0,BFN.BatchIconManager.registerPanelHeader(this.panelHeader))},this.initTabbedLayout=function(){this.tabID1=c&&c[0]?c[0]:"adjust",this.tabID2=c&&c[1]?c[1]:"erase";var e={};e[this.tabID1]='<div class="generic_menu_container"></div>',e[this.tabID2]='<div class="brush_menu_container"></div>',BFN.UI.tabbedLayout(this.tabbedLayout,{tabs:e,deferLayoutCalc:!0}),this.tabbedLayout.addEventListener("TAB_CHANGE",()=>{var e=this.tabbedLayout.activeTab===this.tabID2;this.updateImagePainter(),this.panelHeader.helpEnabled=e,BFN.HelpClueManager.toggle(d,e,{renderOptions:{side:"left",positionFactor:0,left:"228px",top:"0px",container:this.helpCluePlaceholder},force:!1})})},this.updateImagePainter=function(){var e=this.tabbedLayout.activeTab===this.tabID2;BFN.ImagePainterUndoManager.currentImagePainter&&(BFN.ImagePainterUndoManager.currentImagePainter.paintingEnabled=e,e&&BFN.ImagePainterUndoManager.currentImagePainter.brushSizeChanged&&BFN.ImagePainterUndoManager.currentImagePainter.updateBrush())},this.initAdjustControls=function(){var e=[];for(var t in a){var r=t.replace("".concat(i,"_"),""),n=a[t];e.push({toolID:i,controlID:t,controlName:r,controlParamObject:Object.assign({},n)})}var o=this.tabbedLayout.getTabPanel(this.tabID1);UITools.setupControlItems(e,o)},this.init()}.bind(e)()}),BFN.UI.toolMenuTouchupPaint=((e,t)=>{var i=t.toolID,r=t.controlData,a=t.tutorialLink,n=void 0!==a&&a,o=t.tutorialName,s=void 0!==o&&o;return function(){this.addClass("tool-menu");var e=n&&s?'\n        <div class="tutorial">\n            <p data-lang="need_help">\n                '.concat(BeFunky.LanguageManager.getString("need_help"),'\n            </p>\n            <p><a href="').concat(n,'" data-bfntrack="CREATE|HELP|').concat(s,'" class="tutorial-link" target="_blank">\n                <string data-lang="tutorial_link">').concat(BeFunky.LanguageManager.getString("tutorial_link"),"</string>\n            </a></p>\n        </div>\n    "):"";this.innerHTML='\n        <div class="panel-header"></div>\n        <div class="tool-menu__scroll-container">\n            <div class="control-item-set">\n                <div class="generic_menu_container"></div>\n                <div class="control_container"></div>\n                <div class="brush_menu_container"></div>\n                <div class="control-item control-item-bottom">\n                    <div class="apply_cancel_menu_container"></div>\n                </div>\n            </div>\n            '.concat(e,"\n        </div>\n    "),this.init=function(){this.initDefaultValues(),this.initPanelHeader(),this.initControls()},this.initDefaultValues=function(){this.controlContainer=this.querySelector(".control_container"),this.panelHeader=this.querySelector(".panel-header")},this.initPanelHeader=function(){BFN.UI.panelHeader(this.panelHeader,{name:i,modifier:"tertiary"})},this.initControls=function(){var e=[];for(var t in r){var a=t.replace(i+"_",""),n=r[t];e.push({toolID:i,controlID:t,controlName:a,controlParamObject:Object.assign({},n)})}var o=this.controlContainer;UITools.setupControlItems(e,o)},this.init()}.bind(e)()}),BFN.UI.tooltipScreen=(e=>(function(){this.addClass("tooltip-screen"),this.init=function(){this.active=!1,this.mouseEvent=null,this.xOffset=15,this.reserved=!1,this.followMouse=!1,this.message="",this.dimensions=null},this.setMessage=function(e){e&&"string"==typeof e||(e="(no tooltip)"),arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.innerHTML=e:this.textContent=e,this.message.length!==e.length&&(this.dimensions=null),this.message=e},this.setPosition=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.dimensions=this.dimensions||this.getBoundingClientRect();var r=this.dimensions,a=r.width,n=r.height,o=i?0:this.xOffset,s=Math.max(o,Math.min(BFN.appRect.width-a-o,e>BFN.appRect.width-a-o?e-a-o:e+o)),l=t-n/2;this.setStyles({transform:"translate(".concat(s,"px, ").concat(l,"px)")})},this.show=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.setMessage(e,r),this.reserved=t,this.followMouse=i,this.active||(this.active=!0,this.addClass("active"),document.addEventListener(BeFunky.pointermove,this.handleMouseMove))},this.hide=function(){this.reserved=!1,this.active&&(this.active=!1,this.removeClass("active"),document.removeEventListener(BeFunky.pointermove,this.handleMouseMove))},this.handleMouseMove=(e=>{this.followMouse&&(this.mouseEvent=e,this.setPosition(e.pageX,e.pageY))}),this.init()}).bind(e)()),BFN.UI.watermarkControl=(e=>(function(){this.addClass("control-item");var e="watermark_toggle_".concat(BeFunky.randomString(10));this.innerHTML='\n        <div class="checkbox">\n            <input type="checkbox" class="watermark-control-toggle" id="'.concat(e,'">\n            <label class="checkbox__label control-item-label" for="').concat(e,'">\n                <svg class="icon icon-size-medium checkbox__icon checkbox__icon--checked">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkbox-selected"></use>\n                </svg>\n                <svg class="icon icon-size-medium checkbox__icon checkbox__icon--unchecked">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkbox-unselected"></use>\n                </svg>\n                <string data-lang="use_watermark">').concat(BeFunky.LanguageManager.getString("use_watermark"),'</string>\n            </label>\n        </div>\n        <div class="watermark-control-container">\n            <div class="watermark-control-presets"></div>\n            <button class="watermark-control-edit button button--icon button--outline" data-bfntooltip="manage_watermark_presets">\n                <svg class="icon icon-size-medium">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#gear"></use>\n                </svg>\n            </button>\n            <button class="watermark-control-create button button--icon button--outline button" data-bfntooltip="create_watermark_preset">\n                <string class="watermark-control-preset-default" data-lang="create_watermark_preset">').concat(BeFunky.LanguageManager.getString("create_watermark_preset"),'</string>\n                <svg class="icon icon-size-small">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#zoom-plus-icon"></use>\n                </svg>\n            </button>\n        </div>\n    '),this.init=function(){this.checkbox=this.querySelector(".watermark-control-toggle"),this.presetDropdown=this.querySelector(".watermark-control-presets"),Tr(this.presetDropdown,{registerControl:!1,translateOptionNames:!1,onChange:e=>{BFN.WatermarkManager.selectedPresetID!==e&&(BFN.WatermarkManager.selectedPresetID=e)}}),this.manageButton=this.querySelector(".watermark-control-edit"),this.createButton=this.querySelector(".watermark-control-create"),this.watermarkControlContainer=this.querySelector(".watermark-control-container"),this.selected=!1,this.sourceTexture=null,this.selectedPresetID=null,this.checkbox.addEventListener("change",()=>{BFN.WatermarkManager.useWatermark=this.checkbox.checked}),this.manageButton.addEventListener("click",e=>{this._selectedPresetID&&this.sourceTexture&&BFN.WatermarkManager.presetModal.open(this.sourceTexture)}),this.createButton.addEventListener("click",e=>{this.sourceTexture&&BFN.WatermarkManager.editModal.open(this.sourceTexture)})},this.updateDisplay=function(){this.checkbox.checked=this._selected,this.watermarkControlContainer.toggleClass("active",this._selected)},this.updatePresetList=function(e){if(e){var t=[];e.forEach(e=>{t.push({name:e.presetName,value:e.presetID})});var i=t.length?t[t.length-1].value:"";this.presetDropdown.setState({options:t,selectedValue:i}),this.updatePresetSelection()}},this.updatePresetSelection=function(){this._selectedPresetID&&(this.presetDropdown.selectedValue=this._selectedPresetID)},Object.defineProperty(this,"selected",{set(e){e=!!e,this._selected!==e&&(this._selected=e,this.updateDisplay())},get(){return this._selected}}),Object.defineProperty(this,"selectedPresetID",{set(e){var t=e?BFN.WatermarkManager.getPresetObjectById(e):null;this._selectedPresetID=t?e:"",this.updatePresetSelection(),this.presetDropdown.toggleClass("active",!!t),this.manageButton.toggleClass("active",!!t),this.createButton.toggleClass("minified",!!t)},get(){return this._selectedPresetID}}),this.init()}).bind(e)()),BFN.UI.watermarkEditModal=(e=>(function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.isOpen=!1,this.editingPresetID="",this.watermarkUploadPreviewImage=this.querySelector(".watermark-upload-preview-image"),this.watermarkUploadPreviewString=this.querySelector(".watermark-upload-preview-string"),this.watermarkNameInput=this.querySelector("#watermark_name_input"),this.editingExistingPreset=!1,this.watermarkPlacementMap={tl:"top_left",tc:"top_center",tr:"top_right",ml:"middle_left",mc:"middle_center",mr:"middle_right",bl:"bottom_left",bc:"bottom_center",br:"bottom_right"},this.watermarkPlacementString=this.querySelector("#watermark_placement_popover_button string"),this.setPreviewWatermarkParams(UITools.getToolVO("watermark")),this.previewImage=this.querySelector(".watermark-preview-image"),this.previewImageW=0,this.previewImageH=0,this.previewImageReady=!1,this.previewImage.addEventListener("load",e=>{this.previewImage.setStyles({display:"block"}),this.previewImageSrcCallback&&(this.previewImageSrcCallback(),this.previewImageSrcCallback=null),requestAnimationFrame(()=>{var e=this.previewImage.getBoundingClientRect();this.previewImageW=e.width,this.previewImageH=e.height,this.previewImageReady=!0,this.updateWatermarkDisplay()})}),this.previewWatermark=this.querySelector(".watermark-preview-watermark"),this.previewWatermarkW=0,this.previewWatermarkH=0,this.previewWatermarkReady=!1,this.previewWatermark.addEventListener("load",e=>{this.previewWatermark.setStyles({display:"block"}),requestAnimationFrame(()=>{this.previewWatermarkW=this.previewWatermark.naturalWidth,this.previewWatermarkH=this.previewWatermark.naturalHeight,this.previewWatermarkReady=!0,UIToggler.toggleLoadScreen(!1),this.updateWatermarkDisplay()})})},this.open=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&e.baseTexture){e=e.renderClone(),this.editingPresetID=t.hasOwnProperty("presetID")?t.presetID:"",this.editingExistingPreset=!!t.presetName,this.watermarkNameInput.value=this.editingExistingPreset?t.presetName:"",UITools.disableControlItem(this.watermarkNameInput.id,this.editingExistingPreset,"input",.6);var i=Math.min(640/e.width,640/e.height),r=Math.round(e.width*i),a=Math.round(e.height*i),n=BFN.Util.resizeTexture(e,4*r,4*a),o=BFN.Util.getThumbTexture(n,640);o.renderClone().destroyGC(!0);var s=o.determineTransparency(),l=BFN.TextureUtils.textureToBase64(o,{isTransparent:s});e.destroyGC(!0),n.destroyGC(!0),o.destroyGC(!0);var h=UITools.getToolVO("watermark");for(var c in t)switch(c){case"watermarkPlacement":h.placement=t.watermarkPlacement;break;case"watermarkSize":h.size=t.watermarkSize;break;case"watermarkPadding":h.padding=t.watermarkPadding;break;case"watermarkOpacity":h.opacity=t.watermarkOpacity}UITools.updateToolControls("watermark"),this.setPreviewWatermarkParams(h),this.setPreviewImageSRC(l,()=>{BeFunky.openModal(this,{closeOnClickOutside:!1,onOpen:()=>{t.watermarkURL&&(BFN.WatermarkManager.previewWatermarkURL=t.watermarkURL,this.setPreviewWatermarkSRC(t.watermarkURL)),this.isOpen=!0},onClose:()=>{this.resetControls(),BFN.WatermarkManager.clearPreviewWatermark(),this.previewImage.src="",this.isOpen=!1,BFN.WatermarkManager.selectedPresetID||BFN.WatermarkManager.updateSelectedPreset()},onWindowResize:this.updateModalSize.bind(this),size:"large"})})}},this.close=function(){BeFunky.closeModal(this)},this.setPreviewImageSRC=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.previewImageSrcCallback=t,this.previewImageW=0,this.previewImageH=0,this.previewImageReady=!1,this.previewImage.setStyles({display:"none"}),this.previewImage.src=e,!e&&this.previewImageSrcCallback&&(this.previewImageSrcCallback(),this.previewImageSrcCallback=null)},this.setPreviewWatermarkSRC=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e&&UIToggler.toggleLoadScreen(!0,{isCancellable:!1}),this.previewWatermarkW=0,this.previewWatermarkH=0,this.previewWatermarkReady=!1,this.previewWatermark.setStyles({display:"none"}),this.previewWatermark.src=e,this.watermarkUploadPreviewImage.src=e,this.watermarkUploadPreviewImage.toggleClass("active",!!e),this.watermarkUploadPreviewString.toggleClass("active",!e)},this.setPreviewWatermarkParams=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e){var i=e[t];switch(t){case"placement":this.watermarkPlacement=i,this.watermarkPlacementString.setLang(this.watermarkPlacementMap[i]);break;case"size":this.watermarkSize=i;break;case"padding":this.watermarkPadding=i;break;case"opacity":this.watermarkOpacity=i}}this.updateWatermarkDisplay()},this.updateWatermarkDisplay=function(){var e=this;if(this.previewImageReady&&this.previewWatermarkReady){var t=.4*Math.min(this.previewImageW,this.previewImageH),i=Math.round(this.watermarkPadding/100*t),r=this.previewImageW-2*i,a=this.previewImageH-2*i,n=Math.min(this.previewImageW/this.previewWatermarkW,this.previewImageH/this.previewWatermarkH),o=this.watermarkSize/100*n,s=Math.round(this.previewWatermarkW*o),l=Math.round(this.previewWatermarkH*o);if(s>r||l>a){var h=function(){if("padding"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)){var r=2*i;o=Math.min((e.previewImageW-r)/e.previewWatermarkW,(e.previewImageH-r)/e.previewWatermarkH),s=Math.round(e.previewWatermarkW*o),l=Math.round(e.previewWatermarkH*o),e.watermarkSize=Math.round(o/n*100),UITools.setToolValue("watermark","size",e.watermarkSize,!1),UITools.updateToolControl("watermark_size")}else i=Math.round(Math.min((e.previewImageW-s)/2,(e.previewImageH-l)/2)),e.watermarkPadding=Math.round(i/t*100),UITools.setToolValue("watermark","padding",e.watermarkPadding,!1),UITools.updateToolControl("watermark_padding")},c=UITools.getToolVO("watermark");c.updating?h(c.updating_id):h("size")}var u=0,d=0;this.watermarkPlacement.includes("l")&&(u=i),this.watermarkPlacement.includes("c")&&(u=this.previewImageW/2-s/2),this.watermarkPlacement.includes("r")&&(u=this.previewImageW-i-s),this.watermarkPlacement.includes("t")&&(d=i),this.watermarkPlacement.includes("m")&&(d=this.previewImageH/2-l/2),this.watermarkPlacement.includes("b")&&(d=this.previewImageH-i-l);var m={};m.left="".concat(u,"px"),m.top="".concat(d,"px"),m.width="".concat(s,"px"),m.height="".concat(l,"px"),m.opacity=this.watermarkOpacity/100,this.previewWatermark.setStyles(m)}},this.resetControls=function(){this.setPreviewWatermarkSRC();var e=UITools.getToolVO("watermark");for(var t in e.defaultValues){var i=e.defaultValues[t];e[t]=i}UITools.updateToolControls("watermark"),this.setPreviewWatermarkParams(e)},this.getWatermarkData=(()=>{if(!this.previewImageReady||!this.previewWatermarkReady)return null;var e=this.previewImage.getBoundingClientRect(),t=this.previewWatermark.getBoundingClientRect(),i=Math.round(Math.min(t.x-e.x,t.y-e.y,e.x+e.width-(t.x+t.width),e.y+e.height-(t.y+t.height)));return{frameW:Math.round(e.width),frameH:Math.round(e.height),framePadding:i,watermarkW:Math.round(t.width),watermarkH:Math.round(t.height),watermarkNaturalW:this.previewWatermarkW,watermarkNaturalH:this.previewWatermarkH,watermarkAlpha:this.watermarkOpacity/100,watermarkSize:this.watermarkSize,watermarkPadding:this.watermarkPadding,watermarkOpacity:this.watermarkOpacity,watermarkPlacement:this.watermarkPlacement}}),this.handleClose=(()=>{this.close()}),this.updateModalSize=(e=>{e.availableWidth,e.availableHeight}),Object.defineProperty(this,"nameInputValue",{get(){return this.watermarkNameInput.value.trim()}}),this.init()}).bind(e)()),BFN.UI.watermarkPresetModal=(e=>(function(){var e=()=>{this.presetButtons={},this._selectedPresetID=null,this.sourceTexture=null,this.previewSourceTexture=null,this.isEditingPresetName=!1,this.previewImage=document.getElementById("watermark_preset_image"),this.presetList=this.querySelector(".watermark-preset__preset-list"),this.presetList.innerHTML="",BFN.UI.sortableList(this.presetList),this.presetList.addEventListener("LIST_ORDER_UPDATED",this.handlePresetListOrderUpdated.bind(this)),document.getElementById("watermark_preset_done").addEventListener("click",()=>{BeFunky.closeModal(this)}),this.handleWatermarkUpdatedBind=this.handleWatermarkUpdated.bind(this)};this.open=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e&&e.baseTexture){this.sourceTexture=e;var t=Math.min(600/e.width,600/e.height),i=Math.round(e.width*t),r=Math.round(e.height*t),a=BFN.Util.resizeTexture(e,4*i,4*r);this.previewSourceTexture=BFN.Util.getThumbTexture(a,600),this.previewSourceTexture.renderClone().destroyGC(!0),a.destroyGC(!0),BeFunky.openModal(this,{onOpen:()=>{this.updatePreview(),BFN.WatermarkManager.addEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,this.handleWatermarkUpdatedBind)},onClose:()=>{this.clearPreview(),BFN.WatermarkManager.removeEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,this.handleWatermarkUpdatedBind)},closeOnEscape:()=>!this.isEditingPresetName,onWindowResize:e=>{var t=e.availableWidth,i=e.availableHeight;this.setStyles({width:"".concat(Math.min(960,t),"px"),height:"".concat(Math.min(512,i),"px")})}})}},this.close=function(){this.sourceTexture=null,BeFunky.closeModal(this)},this.updatePreview=function(){if(this.previewSourceTexture){var e=this.previewSourceTexture.renderClone();BFN.WatermarkManager.drawWatermark(e),e.renderClone().destroyGC(!0);var t=BFN.Util.isTransparent(e);this.previewImage.src=BFN.TextureUtils.textureToBase64(e,{isTransparent:t}),e.destroyGC(!0)}},this.clearPreview=function(){this.previewSourceTexture&&(this.previewSourceTexture.destroyGC(!0),this.previewSourceTexture=null),this.previewImage.src=""},this.updatePresetButtons=function(e){if(e){var t=e.map(e=>e.presetID);for(var i in this.presetButtons){var r=this.presetButtons[i];t.includes(i)||(r.parentNode.removeChild(r),delete this.presetButtons[i])}e.forEach(e=>{this.presetButtons.hasOwnProperty(e.presetID)||(this.presetButtons[e.presetID]=this.createPresetButton(e.presetID,e.presetName))}),e.forEach(e=>{var t=this.presetButtons[e.presetID];t.string.textContent=e.presetName,this.presetList.appendChild(t)}),this.presetList.refreshList(),this.updatePresetButtonSelection()}},this.updatePresetButtonSelection=function(){for(var e in this.presetButtons){this.presetButtons[e].toggleClass("selected",e===this._selectedPresetID)}},this.editPresetName=function(e,t,i){if(!t.isEditing){t.isEditing=!0,this.isEditingPresetName=!0,t.addClass("watermark-preset__select-preset--is-editing");var r=document.createElement("input").setClass("input watermark-preset__update-name"),a=i.textContent;r.value=a,t.appendChild(r),requestAnimationFrame(()=>{r.focus(),r.select(),n()});var n=()=>{r.addEventListener("keydown",s),r.addEventListener("click",e=>{e.stopPropagation()}),r.addEventListener("blur",l)},o=()=>{t.isEditing&&(t.isEditing=!1,t.removeClass("watermark-preset__select-preset--is-editing"),t.removeChild(r),setTimeout(()=>{this.isEditingPresetName=!1},100))},s=e=>{27===e.keyCode?o():13===e.keyCode&&l()},l=()=>{if(t.isEditing){var i=r.value.trim();i&&i!==a&&BFN.WatermarkManager.renameWatermarkPreset(e,i),o()}}}},this.createPresetButton=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=document.createElement("div").setClass("watermark-preset__preset-button-row sortable-list__item");i.dataset.presetId=e;var r=document.createElement("button").setClass("button button--large button--list button--ellipsis watermark-preset__select-preset  sortable-list__item-drag-image");r.dataset.bfntooltip="select_watermark_preset",t=t||e;var a=document.createElement("string").setClass(" button--ellipsis");a.textContent=t,r.appendChild(a),i.string=a,r.addEventListener("click",t=>{BFN.WatermarkManager.selectedPresetID===e?t.shiftKey||t.ctrlKey||t.metaKey||this.editPresetName(e,r,a):BFN.WatermarkManager.selectedPresetID=e});var n=document.createElement("button").setClass("button button--large button--icon button--list watermark-preset__edit-preset");n.innerHTML='<svg class="icon icon-size-small"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-edit-icon"></use></svg>',n.dataset.bfntooltip="edit_watermark_preset",n.addEventListener("click",e=>{if(this.sourceTexture){var t=BFN.WatermarkManager.getPresetObjectById(this._selectedPresetID);t&&BFN.WatermarkManager.editModal.open(this.sourceTexture,t)}});var o=document.createElement("button").setClass("button button--large button--icon button--list watermark-preset__remove-preset");return o.innerHTML='<svg class="icon icon-size-small"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-cancel-icon"></use></svg>',o.dataset.bfntooltip="delete_watermark_preset",o.addEventListener("click",()=>{BeFunky.confirm("confirm_delete_watermark_preset",{onConfirm:()=>{if(BFN.WatermarkManager.deleteWatermarkPreset(e)){var t=this.presetButtons[e];t&&(t.parentNode.removeChild(t),delete this.presetButtons[e]),BFN.WatermarkManager.watermarkPresets.length||this.close()}},confirmText:"delete",focusConfirmButton:!1})}),i.appendChild(r),i.appendChild(n),i.appendChild(o),i},this.handlePresetListOrderUpdated=function(e){var t=[...this.presetList.querySelectorAll(".sortable-list__item")].map(e=>e.dataset.presetId);BFN.WatermarkManager.updateWatermarkPresetOrder(t)},this.handleWatermarkUpdated=function(e){this.updatePreview()},Object.defineProperty(this,"selectedPresetID",{set(e){this._selectedPresetID=e,this.updatePresetButtonSelection()},get(){return this._selectedPresetID}}),e()}).bind(e)()),BFN.UI.webcamModal=(e=>(function(){this.init=function(){this.initDefaultValues(),this.initButtons()},this.initDefaultValues=function(){this.webcamRecorder=null,this.image=this.querySelector(".webcam__image"),this.error=this.querySelector(".webcam__error"),this.video=BeFunky.lit.elem(Hg(),BeFunky.LanguageManager.getString("video_stream_not_available","modal")),this.image.insertAdjacentElement("beforebegin",this.video)},this.initButtons=function(){this.querySelector(".webcam__cancel").addEventListener("click",this.handleCancel.bind(this)),this.querySelector(".webcam__take-photo").addEventListener("click",this.handleTakePhoto.bind(this)),this.querySelector(".webcam__apply").addEventListener("click",this.handleApply.bind(this)),this.querySelector(".webcam__discard").addEventListener("click",this.handleDiscard.bind(this)),this.querySelector(".webcam__refresh").addEventListener("click",this.handleRefresh.bind(this))},this.open=function(){BeFunky.openModal(this,{onOpen:()=>{this.showVideo(),this.startWebcam()},onClose:()=>{this.webcamRecorder.stop(),this.webcamRecorder=null,this.image.src=""},closeOnClickOutside:!1,size:"medium"})},this.close=function(){BeFunky.closeModal(this)},this.startWebcam=function(){this.webcamRecorder=new BFN.WebcamRecorder(this.video,e=>{BeFunky.logError("Webcam error:",e),this.showError()})},this.showVideo=function(){this.setClass("modal webcam webcam--show-video")},this.showImage=function(){this.setClass("modal webcam webcam--show-image")},this.showError=function(){this.setClass("modal webcam webcam--show-error")},this.handleCancel=function(){this.close()},this.handleTakePhoto=function(){this.webcamRecorder.stop(!0),this.webcamRecorder.getSnapshot(e=>{BFN.BlobUtils.blobToBase64(e).then(e=>{this.image.src=e,this.showImage()},e=>{BeFunky.throwError("Unable to get snapshot",e)})})},this.handleApply=function(){var e=this.image.src;this.close(),BFN.PhotoEditorModel.confirmEditorLoadImage(()=>{BFN.PhotoEditorModel.loadBase64OrBlob(e,{filename:"BeFunky-snapshot"}),BFN.BfnService.track("CREATE","UPLOAD","WEBCAM"),BFN.BfnService.trackMediaOpened("image","webcam")},()=>{this.open()})},this.handleDiscard=function(){this.showVideo(),this.webcamRecorder.start(),this.image.src=""},this.handleRefresh=function(){this.startWebcam()},this.init()}).bind(e)()),BFN.UI.zoomRegion=(e=>(function(){this.innerHTML='\n    <div class="zoom-region-container">\n        <img class="zoom-region-preview-image-background" draggable="false">\n        <div class="zoom-region-viewport">\n            <img class="zoom-region-preview-image-foreground">\n            <div class="zoom-region-viewport-grid-h"></div>\n            <div class="zoom-region-viewport-grid-v"></div>\n        </div>\n    </div>\n  ',this.init=function(){this.initDefaultValues(),this.reset()},this.initDefaultValues=function(){this.previewImageMaxSize=160,this.previewExceptions=[BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER,BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW,BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME,BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE,BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE,BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING,BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT],BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING&&this.previewExceptions.push(BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING),this._validPreview=!1,this._showing=!1,this._active=!1,this.currentPreviewID=null,this.container=this.querySelector(".zoom-region-container"),this.previewImageBackground=this.querySelector(".zoom-region-preview-image-background"),this.viewport=this.querySelector(".zoom-region-viewport"),this.previewImageForeground=this.querySelector(".zoom-region-preview-image-foreground"),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewstateUpdated.bind(this)),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.PhotoEditorCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),BFN.CollageMakerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),BFN.DesignerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIMouseDown.bind(this)),this.addEventListener(BeFunky.pointerdown,this.handleViewportMouseDown.bind(this)),this.addEventListener("transitionend",this.handleTransitionEnd.bind(this)),this.addEventListener("wheel",this.handleMouseWheel.bind(this))},this.updatePreview=BeFunky.debounce(function(){this._validPreview=!1;var e=null,t=!1,i=null,r=null,a=null;BFN.TransformItemIsolator.active&&BFN.TransformItemIsolator.itemTexture.width>0&&BFN.TransformItemIsolator.itemTexture.height>0?e=BFN.TransformItemIsolator.itemTexture:BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage&&(e=BFN.PhotoEditorCanvas.getFlattenedImage(),t=!0);var n=()=>{this.currentPreviewID=BeFunky.randomString(10);var n=BFN.Util.getThumbTexture(e,this.previewImageMaxSize,!1,!1);i=BFN.TextureUtils.textureToBase64(n),r=n.width,a=n.height,n.destroyGC(!0),this.imageW=e.width,this.imageH=e.height,t&&e.destroyGC(!0)};if(e)n();else{var o=BFN.AppModel.sectionID;if(BFN.ProjectManager.savedCanvasThumbs.hasOwnProperty(o)){var s=BFN.ProjectManager.savedCanvasThumbs[o];if(this.currentPreviewID===s.thumbID)return void(this._validPreview=!0);this.currentPreviewID=s.thumbID,i=s.thumbSRC,r=s.thumbW,a=s.thumbH,this.imageW=s.canvasW,this.imageH=s.canvasH}}if(!i&&!BFN.ProjectManager.projectLoading){if(BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture)return this.reset();var l=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);l&&(e=l.getFlattenedImage(),t=!0,n())}if(!i)return this.reset();this._validPreview=!0,this.previewImageBackground.src=i,this.previewImageForeground.src=i,this.previewImageScale=Math.min(1,this.previewImageMaxSize/r,this.previewImageMaxSize/a),this.previewImageW=Math.min(this.previewImageMaxSize,2*Math.round(r*this.previewImageScale/2)),this.previewImageH=Math.min(this.previewImageMaxSize,2*Math.round(a*this.previewImageScale/2)),this.previewImageBackground.setStyles({width:"".concat(this.previewImageW,"px"),height:"".concat(this.previewImageH,"px")}),this.previewImageForeground.setStyles({width:"".concat(this.previewImageW,"px"),height:"".concat(this.previewImageH,"px")}),this.container.setStyles({width:"".concat(this.previewImageW,"px"),height:"".concat(this.previewImageH,"px")}),this.updateViewport()},100),this.updateViewport=function(){if(this._validPreview){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel);this.canvasW=Math.round(this.imageW*t.canvasScale),this.canvasH=Math.round(this.imageH*t.canvasScale),this.viewportW=Math.round(Math.min(1,BFN.StageModel.stageW/this.canvasW)*this.previewImageW),this.viewportH=Math.round(Math.min(1,BFN.StageModel.stageH/this.canvasH)*this.previewImageH),this.viewport.setStyles({width:"".concat(this.viewportW,"px"),height:"".concat(this.viewportH,"px")});var i=(this.previewImageW-this.viewportW)/2-e.canvasContainer.x*(this.previewImageW/this.imageW),r=(this.previewImageH-this.viewportH)/2-e.canvasContainer.y*(this.previewImageH/this.imageH);this.viewport.setStyles({left:"".concat(i,"px"),top:"".concat(r,"px")}),this.previewImageForeground.setStyles({left:"".concat(-i,"px"),top:"".concat(-r,"px")}),this.viewportW<this.previewImageW||this.viewportH<this.previewImageH?this._showing&&!this._active&&(this._active=!0,this.setStyles({display:"block"}),this.classList.add("active")):this._active&&(this._active=!1,this.classList.remove("active"))}},this.reset=function(){this.previewImageBackground.src="",this.previewImageForeground.src="",this.imageW=0,this.imageH=0,this.previewImageScale=0,this.previewImageW=0,this.previewImageH=0,this.canvasW=0,this.canvasH=0,this.viewportW=0,this.viewportH=0,this.hide()},this.show=function(){!this._validPreview||this._showing||this.previewExceptions.includes(BFN.PhotoEditorCanvasModel.viewState)||(this._showing=!0,this.updateViewport())},this.hide=function(){this._showing&&(this._showing=!1,this._active=!1,this.classList.remove("active"))},this.handleAppModelViewstateUpdated=function(e){this.updatePreview()},this.handleStageDimensionsUpdated=function(e){this.updateViewport()},this.handleCanvasScaleUpdated=function(e){this.updateViewport()},this.handleCanvasDraggerDragging=function(e){this.updateViewport()},this.handleMainUIMouseDown=function(){this.hide()},this.handleViewportMouseDown=function(e){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);t.canvasDragger.altScale=-this.previewImageW/this.imageW,t.handleMoveTouchSurfacePressed(e),e.stopPropagation()},this.handleTransitionEnd=function(e){this._active||this.setStyles({display:"none"})},this.handleMouseWheel=function(e){e.altKey&&BFN.ZoomManager.handleMainUIMouseWheel(e)},this.init()}).bind(e)()),BFN.EDITOR_MENU={},BFN.EDITOR_MENU.presetGenericMenuIDs={},BFN.EDITOR_MENU.presetBrushMenuIDs={},BFN.EDITOR_MENU.applyCancelMenuIDs={},BFN.mainMenuStates={editor:{primary:"editor_main_menu",secondary:null,tertiary:null},collage:{primary:"collage_main_menu",secondary:null,tertiary:null},designer:{primary:"designer_main_menu",secondary:null,tertiary:null},edit_layer:{primary:"editor_main_menu",secondary:"editor_edit_menu",tertiary:null}},BFN.activeMenuStateID=void 0;var zg,Xg=[];function jg(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:BFN.AppModel.sectionID,t=BFN.mainMenuStates[e];BFN.activeMenuStateID=e,Wg(t.primary),t.secondary?Wg(t.secondary):document.querySelectorAll(".secondary-panel .tool-menu.active").removeClass("active"),Xg.includes(t.tertiary)&&(console.log("Preventing tertiary menu re-open",t.tertiary),t.tertiary=null),t.tertiary?Wg(t.tertiary):document.querySelectorAll(".tertiary-panel .tool-menu.active").removeClass("active"),t.tertiary?showMenuPanel("tertiary"):t.secondary?showMenuPanel("secondary"):showMenuPanel("primary"),UIToggler.toggleMainMenu(BFN.AppModel.viewingEditor&&null!=BFN.PhotoEditorModel.currentTexture||BFN.AppModel.viewingDesigner||BFN.AppModel.viewingCollage),UIToggler.toggleZoomMenu(BFN.AppModel.viewingEditor&&null!=BFN.PhotoEditorModel.currentTexture||BFN.AppModel.viewingDesigner||BFN.AppModel.viewingCollage)}function Wg(e,i){var r=i||document.getElementById(e);r?([...r.parentElement.children].filter(e=>e!==r).forEach(e=>e.removeClass("active")),r.addClass("active"),cancelIdleCallback(zg),zg=requestIdleCallback(()=>{r.hasClass("active")&&function(e){var i={editor_image_manager_menu:["image_manager",{left:"260px",top:"28px",positionFactor:.25}],designer_templates_menu:["template_search",{left:"260px",top:"30px",positionFactor:0}],editor_graphic_menu:["basic_shapes",{left:"260px",top:"156px",positionFactor:0}],editor_edit_menu:["image_enhancer",{left:"260px",top:"28px",positionFactor:.13}],editor_touch_up_menu:["portrait_enhancer",{left:"260px",top:"28px",positionFactor:.13}],clone_menu:["clone",{left:"228px",top:"86px",positionFactor:.775}],collage_layouts_menu:["collage_layouts",{left:"260px",top:"20px",positionFactor:0}],cutout_menu:["cutout",{left:"228px",top:"86px",positionFactor:.165}],collage_customize_menu:["resize_template",{left:"260px",top:"29px",positionFactor:0}]};if(i[e.id]){var r=t(i[e.id],2),a=r[0],n=r[1];if(n.wasSetup||(BFN.HelpClueManager.setup(a,Object.assign({},n,{container:e.querySelector(".popover-placeholder")})),n.wasSetup=!0),"resize_template"===a&&BFN.AppModel.viewingCollage)return;BFN.HelpClueManager.show(a)}}(r)})):BeFunky.logError("Invalid Menu ID",e)}function Yg(e,t){var i=document.createDocumentFragment(),r=document.createElement("ul");r.innerHTML=t.map(e=>{var t=e.id,i=e.icon,r=e.name;return'\n        <li>\n            <button id="'.concat(t,'" class="primary-panel__button">\n                <svg class="icon icon-size-large"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(i,'"></use></svg>\n            </button>\n            <span class="primary-panel-item-name" data-lang="').concat(r,'">\n                ').concat(BeFunky.LanguageManager.getString(r),"</span>\n        </li>")}).join(""),i.appendChild(r),document.getElementById(e).appendChild(i)}function qg(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.disableButtons,a=void 0!==r&&r,n=i.translateButtons,o=void 0===n||n,s=document.getElementById(e).addClass("category-menu").addClass("tools-scrollable"),l=document.createDocumentFragment();t.forEach(e=>{var t=e.id,i=e.name,r=e.graphicClass,n=e.isNew;l.appendChild(function(e,t,i,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=document.createElement("button");return o.setAttribute("id",e),o.setAttribute("class","category-menu__button ".concat(i)),o.innerHTML="\n        <string ".concat(a?'data-lang="'.concat(t.replace(/"/g,"&quot;"),'"'):"",">").concat(t,"</string>\n        ").concat(n?'<span class="badge badge-danger">New</span>':"","\n    "),o.disabled=r,o}(t,i,r,a,o,n))});var h=s.firstElementChild;h&&h.hasClass("category-menu__loading")&&s.removeChild(h),s.appendChild(l)}function Kg(e,t){var i={};t.forEach(e=>{var t=e.name,r=e.items,a=e.isOpen;i[t]={isOpen:void 0===a||!!a,content:r.map(e=>{var t=e.id,i=e.icon,r=e.name,a=e.isPlus,n=void 0!==a&&a,o=e.isNew,s=void 0!==o&&o,l=e.iconStroke,h=void 0===l||l;return'\n                <button id="'.concat(t,'" class="button button--list accordion__menu-button">\n                    <svg class="icon ').concat(h?"icon-stroke":"",'"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(i,'"></use></svg>\n                    <string data-lang="').concat(r,'">').concat(BeFunky.LanguageManager.getString(r),"</string>\n                    ").concat(n?'<span class="badge badge-warning plus-badge"><svg class="icon icon-size-regular"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#upgrade-star"></use></svg></span>':"","\n                    ").concat(s?'<span class="badge badge-danger">New</span>':"","\n                </button>\n                ")}).join("")}});var r=document.getElementById(e).addClass("accordion");BFN.UI.accordionLayout(r,{sections:i})}function Qg(e,t,i,r,a,n,o,s,l,h,c,u){var d=document.getElementById(e);t.forEach(e=>{!0===l&&null===e.graphic&&(l=!1);var t=e.id,m=e.name,p="".concat(t,"_menu"),g=document.createElement("div");g.setAttribute("id",p),g.setAttribute("class","tool-menu"),g.innerHTML='\n            <div class="panel-header"></div>\n            <div class="popover-placeholder"></div>\n            <div class="menu-content tools-scrollable"></div>\n        ';var f=g.querySelector(".panel-header"),v=g.querySelector(".popover-placeholder"),y=g.querySelector(".menu-content");BFN.UI.panelHeader(f,{name:m,modifier:"tertiary",helpClueID:c}),e.presets.forEach((e,d)=>{var p="".concat(t,"_").concat(e.id),g=e.name||"".concat(m," ").concat(d+1),x=null;null!==s&&e.hasOwnProperty("thumb")&&(x=s+e.thumb);var _=document.createElement("div");_.setAttribute("id","".concat(p,"_menu")),y.appendChild(_),BFN.UI.presetMenuItem(_,{presetID:p,presetName:g,presetObject:e,genericMenuID:i,brushMenuID:r,applyCancelMenuID:a,presetAmountSliderID:n,useProcessedThumb:o,useThumbImage:x,useFavoriteIcon:l,useBatchProcessingIcon:h,helpClueID:c,paintModeHelpClueID:u,helpCluePlaceholder:v,header:c?f:null})}),d.appendChild(g)})}function Zg(e){!function(e){var t=UITools.getToolValue(e,"updating_id");switch(e){case"editor_main":case"collage_main":case"designer_main":(BFN.PhotoEditorCanvasTools.currentTool||BFN.activePresetMenuItem)&&BFN.applyCancelMenu.cancelButton.click();var i="edit_layer"===BFN.activeMenuStateID?"editor":BFN.AppModel.sectionID;["graphic","layer_manager","text","image_manager"].includes(t)?i="editor":["customize","patterns"].includes(t)&&(i="collage"),Wg("".concat(i,"_").concat(t,"_menu")),showMenuPanel("secondary"),"graphic"===t&&BFN.GraphicLibraryManager.loadTagsAndSetupMenu(),"overlay"===t&&BFN.OverlaysManager.loadCategories(),"patterns"===t&&BFN.CollageMakerPatternManager.loadCategories(),"templates"===t&&(BFN.DesignerTemplateManager.setupRecentProjects(),BFN.DesignerTemplateManager.preloadTags()),BFN.retrievePresetThumbHelperGraphics(t);break;case"editor_edit":case"editor_touch_up":case"editor_effect":case"editor_artsy":case"editor_frame":case"editor_texture":case"editor_overlay":case"editor_text":case"collage_layouts":case"collage_patterns":"editor_overlay"===e?t="overlay_".concat(t):"collage_layouts"===e?t="collage_layout_".concat(t):"collage_patterns"===e&&(t="collage_patterns_".concat(t));var r="".concat(t,"_menu"),a=document.getElementById("".concat(t,"_menu"));if("add_text"!==t&&"add_layer"!==t){Wg(r,a),"editor_edit"===e&&BFN.setupAdjustAndPaintMenu(r,a),"editor_touch_up"===e&&BFN.setupTouchupPaintMenu(r,a),showMenuPanel("tertiary");var n=a.querySelectorAll(".preset-menu-item");n.length?([...n].forEach(e=>e.generateItem()),BFN.PresetMenuItemThumbManager.processItems(n)):BFN.AppModel.viewingEditor&&!Xg.includes(r)&&Xg.push(r)}var o=BFN.EDITOR_MENU.presetGenericMenuIDs[t];o&&a.querySelector(".generic_menu_container").appendChild(document.getElementById(o));var s=BFN.EDITOR_MENU.presetBrushMenuIDs[t];if(s){a.querySelector(".brush_menu_container").appendChild(document.getElementById(s));var l=a.querySelector(".tabbed-layout");if(l){l.activeTab===l.tabNames[1]&&(l.activeTab="");try{a.updateImagePainter()}catch(e){}}}if(BFN.EDITOR_MENU.applyCancelMenuIDs[t]){var h=UITools.toolPlusHash[t];BFN.applyCancelMenu.upgradeMode=!!h&&!BFN.BfnService.userIsPlus,a.querySelector(".apply_cancel_menu_container").appendChild(BFN.applyCancelMenu)}"add_text"===t&&BFN.FabricManager.createNewText();break;case"editor_apply_cancel":if("apply"===UITools.getToolVO("editor_apply_cancel").updating_id&&BFN.applyCancelMenu.alternateApply)return;!BFN.AppModel.viewingEditor&&!BFN.TransformItemIsolator.active||BFN.TransformItemIsolator.usingAlternateMenu||(BFN.activePresetMenuItem?BFN.activePresetMenuItem.deselectItem():showMenuPanel("secondary",BFN.TransformItemIsolator.active&&!BFN.TransformItemIsolator.usingAlternateMenu?"edit_layer":"editor"))}}(e.data)}function Jg(){BFN.appContainer.toggleClass("user-is-plus",BFN.BfnService.userIsPlus),[...document.querySelectorAll(".popover")].forEach(e=>e.updateDisplay())}BFN.readyApp=function(e){try{PIXI.utils.skipHello()}catch(e){PIXI.utils._saidHello=!0}try{BFN.PIXIScaleMode=PIXI.settings.SCALE_MODE}catch(e){BFN.PIXIScaleMode=PIXI.SCALE_MODES.DEFAULT}BFN.appContainer=document.getElementById("bfn-app"),window.setupShowMenuPanel();var t=BeFunky.trackUserTiming("App Init","singleton_queue","browser");BFN.SingletonQueue.process(),t();var i=BeFunky.trackUserTiming("App Init","shader_pool","browser");BFN.ShaderManager.createShaderPool(()=>{i();var t=BeFunky.trackUserTiming("App Init","init_ui","browser");window.dispatchEvent(new Event("INIT")),BeFunky.cleanupEnterAppImmediately(),BeFunky.showLoadScreen(),function(){BFN.UI.accountMenu(document.getElementById("account_menu")),function(){UITools.addEventListener(UIToolsEvents.UPDATE_TOOL.type,Zg),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,Jg);var e,t=BFN.appContainer;BFN.BfnService.userIsPlus&&t.addClass("user-is-plus");BeFunky.isDropShadowSupported||t.addClass("drop-shadow-not-supported");BFN.UI.applyCancelUpgradeButtons(BFN.applyCancelMenu,{id:"editor_apply_cancel"}),document.getElementById("primary-panel").addEventListener("click",()=>{(BFN.PhotoEditorCanvasTools.currentTool||BFN.activePresetMenuItem)&&BFN.applyCancelMenu.cancelButton.click(),showMenuPanel("primary")}),document.querySelector(".tertiary-panel__close").addEventListener("click",()=>{(BFN.PhotoEditorCanvasTools.currentTool||BFN.activePresetMenuItem)&&BFN.applyCancelMenu.cancelButton.click(),showMenuPanel("secondary")}),[...document.querySelectorAll("#alternateMenu .panel-header")].forEach(e=>{e.addEventListener("CLOSE",()=>{BFN.ColorPickerPanel.colorButton=null;var e=0;BFN.FabricManager.currentTextTransformItem&&(document.getElementById("appViewportBG").dispatchEvent(new Event(BeFunky.pointerdown)),e=10),setTimeout(()=>{var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);BFN.TransformModel.selectedTransformItem&&e.transformLayer.deselectItem(),BFN.PhotoGrid.gridChildIsolated&&BFN.PhotoGrid.isolateGridChild(null),document.getElementById("appStage").focus()},e)})}),document.getElementById("alternateMenu").addEventListener(BeFunky.pointerdown,e=>{e.stopImmediatePropagation(),BFN.ColorPickerPanel.colorButton=null,"transform_menu_popover_button"!==e.target.id&&document.getElementById("transform_menu_popover").hideUnlessPressed(),"text_edit_font_button"!==e.target.id&&BFN.FontManager.closeFontMenu(),"text_edit_spacing_menu_popover_button"!==e.target.id&&document.getElementById("text_edit_spacing_menu_popover").hideUnlessPressed(),"text_edit_background_padding_popover_button"!==e.target.id&&document.getElementById("text_edit_background_padding_popover").hideUnlessPressed(),"text_edit_outline_width_popover_button"!==e.target.id&&document.getElementById("text_edit_outline_width_popover").hideUnlessPressed()}),BFN.ColorPickerPanel=document.getElementById("color_picker_panel"),BFN.UI.colorPickerPanel(BFN.ColorPickerPanel),BFN.UI.draggablePanel(BFN.ColorPickerPanel),[...document.querySelectorAll(".popover")].forEach(BFN.UI.popover),[...document.querySelectorAll(".pro-tip")].forEach(BFN.UI.proTip),document.getElementById("bfn-app").addEventListener("click",e=>{var t=e.target;if(t&&t.nodeName&&"A"===t.nodeName){var i=t.getAttribute("data-bfntrack");if(i){var r=i.split("|");if(3!==r.length)return BeFunky.logError("Malformed data-bfntrack attribute: ".concat(i),t);BFN.BfnService.track(...r)}}}),document.addEventListener("visibilitychange",()=>{clearTimeout(e),"visible"!==document.visibilityState?BFN.tabRecentlyReopened=!1:(BFN.tabRecentlyReopened=!0,e=setTimeout(()=>{BFN.tabRecentlyReopened=!1},1e4),BeFunky.setLocal("lastAppSection",BFN.AppModel.sectionValue("Photo Editor","Collage Maker","Designer")))}),i=document.getElementById("app_goto_photo_editor"),r=document.getElementById("app_goto_collage_maker"),a=document.getElementById("app_goto_designer"),n=document.querySelectorAll(".navbar-center .editor-include"),o=document.querySelectorAll(".navbar-center .editor-exclude"),window.handleAppViewstateUpdated=function(){(BFN.PhotoEditorCanvasTools.currentTool||BFN.activePresetMenuItem)&&BFN.applyCancelMenu.cancelButton.click(),n.setStyles({display:BFN.AppModel.viewingEditor?"":"none"}),o.setStyles({display:BFN.AppModel.viewingEditor?"none":""}),i.disabled=BFN.AppModel.viewingEditor,r.disabled=BFN.AppModel.viewingCollage,a.disabled=BFN.AppModel.viewingDesigner,BFN.BfnService.track("CREATE","APPMODE",BFN.AppModel.sectionValue("PHOTOEDITOR","COLLAGE","DESIGNER"));var e,t,s=BFN.AppModel.sectionValue("editor","collage","designer"),l=!BFN.openedSections.length;!function(e,t){var i,r=BFN.AppModel.sectionID;if((BFN.AppModel.viewingEditor&&BFN.hasEnteredEditor||BFN.AppModel.viewingCollage&&BFN.hasEnteredCollage||BFN.AppModel.viewingDesigner&&BFN.hasEnteredDesigner)&&(t=(()=>{})),BeFunky.projectToOpenInSection[r]){var a=BeFunky.projectToOpenInSection[r],n=a.projectVO,o=a.userSavedProjectData;delete BeFunky.projectToOpenInSection[r],n?i=(()=>BFN.ProjectManager.loadProject(n).catch(e=>new Promise((t,i)=>{BFN.ProjectManager.handleOpenProjectError(e,r,n.filename).then(()=>i(e))}))):o?i=(()=>BeFunky.SavedProjectManager.openUserSavedProject(o).then(e=>{if("pending_section_change"===e)throw BeFunky.throwError("Unexpected section change",BFN.AppModel.sectionID,o),"pending_section_change"})):BeFunky.throwError("ProjectVO or userSavedProjectData required")}if(BFN.AppModel.viewingEditor&&(!BFN.hasEnteredEditor&&!BFN.ImageEditManager.editingImage||BFN.editorProjectShelved)){if(BFN.hasEnteredEditor=!0,BeFunky.editorExternalImage&&BeFunky.editorExternalImage.ignoreExistingProject)return c(()=>{BFN.DeepLinkManager.handleEditorDeepLink(),t()});h(!1),l(()=>{if(BeFunky.editorExternalImage)return c(()=>{BFN.DeepLinkManager.handleEditorDeepLink()});h(!0),BFN.DeepLinkManager.handleEditorDeepLink(),Promise.all([BFN.ProjectService.clearLocalAssets("editor"),BFN.ProjectService.removeLocalProject("editor")]).catch(e=>{BeFunky.throwError(e,"Unable to clear existing Photo Editor project")})},()=>{BeFunky.editorExternalImage=null})}else h(),BFN.AppModel.viewingEditor&&!BFN.ImageEditManager.editingImage&&(i?i().catch(e=>{"cancelled_by_user"!==e&&BeFunky.logError("Failed to open queued project",e)}):BeFunky.editorExternalImage&&BeFunky.editorExternalImage.ignoreExistingProject?c(()=>{BFN.DeepLinkManager.handleEditorDeepLink()}):BFN.DeepLinkManager.handleEditorDeepLink(),BeFunky.editorExternalImage=null);if(BFN.AppModel.viewingCollage&&!BFN.hasEnteredCollage?(BFN.hasEnteredCollage=!0,UITools.setToolValue("collage_main","image_manager",!0),UITools.applyTool("collage_main"),UITools.setToolValue("collage_main","image_manager",!1),BFN.CollageMakerTemplateData.loadTemplateData(()=>{l(()=>{BFN.ProjectService.clearLocalAssets("collage"),BFN.CollageMakerCanvasPhotoGrid.initInitialTemplate()})},!i)):BFN.AppModel.viewingCollage&&i&&i().catch(e=>{"cancelled_by_user"!==e&&BeFunky.logError("Failed to open queued project",e)}),BFN.AppModel.viewingDesigner&&!BFN.hasEnteredDesigner){BFN.hasEnteredDesigner=!0,UITools.setToolValue("designer_main","templates",!0),UITools.applyTool("designer_main"),UITools.setToolValue("designer_main","templates",!1);var s=()=>{if(BeFunky.testingFlags.includes("set_default_designer_template")){var e=window.location.search.match(/default_designer_template=([a-z0-9_]+)/);if(e)return BFN.DesignerTemplateManager.loadTemplateForTesting(e[1]),!0;BeFunky.logError("Unable to get default designer template ID for testing")}return!1};l(()=>{if(!s()){var e=window.currentDeepLinkParameters,t=e.tag,i=e.template;t||!i?(BFN.DesignerModel.loadBlankProject(),BFN.DeepLinkManager.handleDesignerDeepLink()):BFN.DesignerTemplateManager.applyTemplate({id:i})}},e=>{s()||e||BFN.DeepLinkManager.handleDesignerDeepLink()})}else BFN.AppModel.viewingDesigner&&i?i().catch(e=>{"cancelled_by_user"!==e&&BeFunky.logError("Failed to open queued project",e)}):BFN.AppModel.viewingDesigner&&BFN.DeepLinkManager.handleDesignerDeepLink();function l(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},o="force_use_autosave__".concat(r),s="true"===BeFunky.getLocal(o);if(BeFunky.removeLocal(o),i)i().then(t,e=>{"cancelled_by_user"!==e&&BeFunky.logError("Failed to open queued project",e),BFN.SettingsManager.getSetting("autosave").then(e=>{"no"===e?u():h()})});else{if(s)return BeFunky.logError("Attempting to restore ".concat(r," autosave after prior session crashed.")),h();if(BFN.editorProjectShelved)return BFN.editorProjectShelved=!1,h();BeFunky.showLoadScreen();var l=e?BeFunky.trackUserTiming("App Init","user_settings",BFN.BfnService.userLoggedIn?"network":"IndexedDB"):()=>{};BFN.SettingsManager.getSetting("autosave").then(e=>(l(),BeFunky.hideLoadScreen(),"yes"===e?h():"no"===e?u():void BFN.ProjectService.getLocalProject(r,{excludeAssets:!0,showLoadScreen:!0}).then(e=>{if(!0===e._wasReset)return BeFunky.logError("Loading recently reset project without asking user"),h(e);var t=!1;(function(e){return BFN.ProjectManager.getThumbnailHtmlForDialog(e.thumbBase64,{width:e.projectWidth,height:e.projectHeight}).catch(()=>"").then(e=>"".concat(e,'\n                    <div data-lang="confirm_load_autosave">\n                        ').concat(BeFunky.LanguageManager.getString("confirm_load_autosave"),'\n                    </div>\n                    <div class="checkbox" style="margin-top: 1rem;">\n                        <input type="checkbox" id="persist_autosave_choice">\n                        <label class="checkbox__label control-item-label" for="persist_autosave_choice">\n                            <svg class="icon icon-size-medium checkbox__icon checkbox__icon--checked">\n                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkbox-selected"></use>\n                            </svg>\n                            <svg class="icon icon-size-medium checkbox__icon checkbox__icon--unchecked">\n                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkbox-unselected"></use>\n                            </svg>\n                            <string data-lang="set_default_setting">').concat(BeFunky.LanguageManager.getString("set_default_setting"),"</string>\n                        </label>\n                    </div>\n                "))})(e).then(i=>{BeFunky.confirm(i,{onConfirm:()=>{t&&BFN.SettingsManager.updateSetting("autosave","yes"),h(e,!0)},onCancel:()=>{t&&BFN.SettingsManager.updateSetting("autosave","no"),u()},confirmText:"continue_editing",cancelText:"start_new"});var r=document.getElementById("persist_autosave_choice");r.addEventListener("change",()=>{t=r.checked})})},e=>{c(e)})))}function h(i){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=()=>{},s=i?BFN.ProjectService.addImagesToProject(i,{showLoadScreen:!0,fallbackToCanvas:!1}):BFN.ProjectService.getLocalProject(r,{showLoadScreen:!0,fallbackToCanvas:!1});s.then(t=>(e&&(o=BeFunky.trackUserTiming("App Init","autosaved_project_fonts","network")),BFN.ParseBFD.prepareV2(t))).then(e=>{o();var t=BFN.ProjectManager.getProjectVO(e);return t._isLocalProject=!0,BFN.ProjectManager.loadProject(t)}).then(()=>{var e={editor:BFN.PhotoEditorModel,collage:BFN.CollageMakerModel,designer:BFN.DesignerModel};e[r].hasUnsavedChanges=!0,n(a),t()}).catch(e=>{c(e)})}function c(e){if(BeFunky.hideLoadScreen(),"invalid_editor_image_blob"===e)return BeFunky.confirm("error_load_autosave",{confirmText:"try_again",cancelText:"start_new",onConfirm:()=>{window.onbeforeunload=null,window.location.reload()},onCancel:u});"No saved project exists"!==e&&BeFunky.logError(e),u()}function u(){a(),t()}}function h(e){void 0===e&&(e=BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture),UIToggler.toggleSampleImagePopover(e),UIToggler.toggleSaveButtons(!e)}function c(e){BFN.hasFullyOpenedEditor=!0;var t=BeFunky.editorExternalImage.loadImage;BeFunky.editorExternalImage=null,console.log("Loading external image in Photo Editor"),t(),"function"==typeof e&&e()}}(l,()=>{var e=BFN.AppModel.sectionValue("editor","collage","designer");s===e?BFN.openedSections.includes(s)?BeFunky.throwError("First time ".concat(s," section callback inaccurate.")):(BFN.openedSections.push(s),console.log("".concat(s," opened for the first time")),BFN.AppModel.viewingEditor&&(BFN.hasFullyOpenedEditor=!0),BFN.openedSections.length>1||requestIdleCallback(()=>{BFN.BfnService.onUserLogin(()=>{BeFunky.User&&BeFunky.User.isNewUser||BeFunky.showAnnouncementOnce("ai_image_enhancer").then(e=>{e||function(e){if(!BeFunky.beforeInstallPromptEvent)return e(!1);BeFunky.showAnnouncementOnce("pwa",{onConfirm:()=>{BeFunky.beforeInstallPromptEvent.prompt(),BeFunky.beforeInstallPromptEvent.userChoice.then(e=>{"accepted"===e.outcome?BFN.BfnService.track("PROMOTION","PWA","Accepted - Installed"):BFN.BfnService.track("PROMOTION","PWA","Accepted - Not Installed")})},onCancel:e=>{BFN.BfnService.track("PROMOTION","PWA","Dismissed - ".concat(e?"Ask me later":"Click outside / Escape"))}}).then(t=>{t&&BFN.BfnService.track("PROMOTION","PWA","Shown"),e(t)})}(e=>{e||BeFunky.isPlus()&&BFN.SettingsManager.getSetting("use_case").then(e=>{if(!e)if(BeFunky.isModalOpen())console.log("Not showing survey b/c another modal is open");else{BeFunky.openModal("survey_modal",{size:"small",closeOnClickOutside:!1,addSiteClass:!0});var t=document.getElementById("survey_modal_form");t.addEventListener("submit",e=>{e.preventDefault();var i=t.querySelector('input[name="survey"]:checked');i&&i.value&&(BFN.SettingsManager.updateSetting("use_case",i.value),BeFunky.closeModal("survey_modal"),UIMessages.display("Thank you!"))})}})})})})})):BeFunky.throwError("Section changed while in section opener from ".concat(s," to ").concat(e))}),e=document.querySelector("#app_goto_button string"),t=BFN.AppModel.sectionValue("photo_editor","collage_maker","graphic_designer"),e.setLang(t),jg()},BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,window.handleAppViewstateUpdated);var i,r,a,n,o}(),Yg("editor_main_menu",BFN.UIMenuData.mainMenus.editor),Yg("collage_main_menu",BFN.UIMenuData.mainMenus.collage),Yg("designer_main_menu",BFN.UIMenuData.mainMenus.designer),Kg("editor_edit_accordion_menu",BFN.UIMenuData.accordionMenus.editor_edit),Kg("editor_touch_up_accordion_menu",BFN.UIMenuData.accordionMenus.editor_touch_up),qg("editor_effect_category_menu",BFN.UIMenuData.categoryMenus.editor_effect),qg("editor_artsy_category_menu",BFN.UIMenuData.categoryMenus.editor_artsy),qg("editor_frame_category_menu",BFN.UIMenuData.categoryMenus.editor_frame,{translateButtons:!1}),qg("editor_overlay_category_menu",BFN.UIMenuData.categoryMenus.editor_overlay,{disableButtons:!0}),qg("editor_text_category_menu",BFN.UIMenuData.categoryMenus.editor_text),qg("editor_texture_category_menu",BFN.UIMenuData.categoryMenus.editor_texture),qg("collage_layouts_category_menu",BFN.UIMenuData.categoryMenus.collage_layouts,{disableButtons:!0}),qg("collage_patterns_category_menu",BFN.UIMenuData.categoryMenus.collage_patterns,{disableButtons:!0}),BFN.createCategoryMenu=qg,[...document.querySelectorAll("#secondary-panel .panel-header:empty")].forEach(e=>{var t=e.getAttribute("data-help-clue");BFN.UI.panelHeader(e,{name:e.dataset.panelHeaderLang,modifier:"secondary",helpEnabled:Boolean(t),helpClueID:t})}),[...document.querySelectorAll("#tertiary-panel .panel-header:empty")].forEach(e=>{var t=e.getAttribute("data-help-clue"),i=e.dataset.panelHeaderLang;BFN.UI.panelHeader(e,{name:i,tag:"h3",modifier:"tertiary",helpEnabled:Boolean(t),helpClueID:t}),BFN.BatchToolManager.batchEditToolIDs.includes(i)&&(e.batchToolID=i,e.batchEnabled=!0,BFN.BatchIconManager.registerPanelHeader(e))}),[...document.querySelectorAll("#alternateMenu .panel-header")].forEach(e=>{"layer_isolator_tool_menu_header"!==e.id?BFN.UI.panelHeader(e,{name:e.dataset.panelHeaderLang,tag:"h3",modifier:"alternate",closeEnabled:!0}):BFN.UI.panelHeader(e,{name:e.dataset.panelHeaderLang,tag:"h3",modifier:"alternate",closeEnabled:!1})}),[...document.querySelectorAll("#appModal .panel-header")].forEach(e=>{e.parentElement.hasClass("modal")?BFN.UI.panelHeader(e,{name:e.dataset.panelHeaderLang,tag:"h2",modifier:"modal",helpEnabled:e.hasAttribute("data-help-clue"),closeEnabled:e.hasAttribute("data-panel-header-close"),isPlus:e.hasAttribute("data-panel-header-is-plus")}):BFN.UI.panelHeader(e,{name:e.dataset.panelHeaderLang,tag:"h3",modifier:"modal-section"})}),function(){var e=BFN.UIToolData;for(var t in e){var i=e[t],r=i.controls;if(!i.hasOwnProperty("ignoreInitialControlRegister")||!i.ignoreInitialControlRegister)for(var a in BFN.EDITOR_MENU.presetGenericMenuIDs[t]=i.hasOwnProperty("genericMenuID")?i.genericMenuID:null,BFN.EDITOR_MENU.presetBrushMenuIDs[t]=i.hasOwnProperty("brushMenuID")?i.brushMenuID:null,BFN.EDITOR_MENU.applyCancelMenuIDs[t]=i.hasOwnProperty("applyCancelMenuID")?i.applyCancelMenuID:null,r){var n=r[a];n.hasOwnProperty("type")?"static"!==n.type&&(document.getElementById(a)?UITools.registerControl(a):BeFunky.log(' - - - DOM Element "'.concat(a,'" does not exist'))):BeFunky.log(' - - - Control Object "'.concat(a,'" has no type'))}}}(),Qg("editor_tool_menu_container",BFN.EffectData,"effect_generic_menu","effect_brush_menu","editor_apply_cancel_menu","effect_generic_amount",!0,null,!0,!0,"effect_basic_settings_favorites","erase_mode"),Qg("editor_tool_menu_container",BFN.ArtsyData,"artsy_generic_menu","artsy_brush_menu","editor_apply_cancel_menu","artsy_generic_amount",!1,BFN.artsyThumbURL,!0,!1,"effect_basic_settings_favorites","erase_mode"),Qg("editor_tool_menu_container",BFN.TextureData,"texture_generic_menu","texture_brush_menu","editor_apply_cancel_menu","texture_generic_opacity",!0,null,!1,!1,"effect_basic_settings","erase_mode"),Qg("editor_tool_menu_container",BFN.LensFlareData.menuData,"lens_flare_generic_menu",null,"editor_apply_cancel_menu","lens_flare_generic_intensity",!0,null,!1,!1,"effect_lens_flare",null),Qg("editor_tool_menu_container",BFN.FrameData.crop_rotate,"frame_crop_rotate_generic_menu",null,"editor_apply_cancel_menu","frame_crop_rotate_generic_position",!0,null,!1,!1,"effect_basic_settings_frames",null),Qg("editor_tool_menu_container",BFN.FrameData.crop,"frame_crop_generic_menu",null,"editor_apply_cancel_menu","frame_crop_generic_position",!0,null,!1,!1,"effect_basic_settings_frames",null),Qg("editor_tool_menu_container",BFN.FrameData.full,"frame_full_generic_menu",null,"editor_apply_cancel_menu","frame_full_generic_position",!0,null,!1,!1,"effect_basic_settings_frames",null),function(){try{BFN.isWebCamSupported()||document.getElementById("editor_load_image_webcam").setStyles({display:"none"})}catch(e){}[...document.querySelectorAll(".navbar-dropdown")].forEach(e=>{var t={};"editor_load_image_menu"===e.id?(t.onOpen=(()=>{UIToggler.toggleSampleImagePopover(!1)}),t.onClose=(()=>{setTimeout(()=>{var e=BeFunky.getModal("image_library"),t=BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture&&!(e&&e.isVisible);UIToggler.toggleSampleImagePopover(t,!0)},300)})):["editor_save_image_menu","editor_share_image_menu"].includes(e.id)?t.onDisabledClick=(()=>{BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture&&UIToggler.toggleSampleImagePopover(!0,!0)}):"account_menu_dropdown"===e.id&&(t.onOpen=(()=>{window.zE&&window.zE.hide()})),BFN.UI.navbarDropdown(e,t)}),document.querySelector(".navbar-logo-link").addEventListener("click",()=>{function e(){BFN.AppModel.removeEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,e),BeFunky.confirm("confirm_hide",{onConfirm:BFN.BfnService.hideEditor,confirmText:"yes",cancelText:"no"})}BFN.ImageEditManager.editingImage?(BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,e),BFN.AppModel.viewState=BFN.ImageEditManager.targetViewstate):e()}),BFN.CollageWizardModal=document.getElementById("collage_wizard"),BFN.UI.collageWizardModal(BFN.CollageWizardModal),BFN.ZoomRegion=document.getElementById("zoom_region"),BFN.UI.zoomRegion(BFN.ZoomRegion),function(){[{callback:function(e,t,i){var r=e.slider,a=r.noUiSlider.options.step||1;"keydown"===i.type&&r.noUiSlider.set(parseFloat(r.noUiSlider.get())+a*{left:-1,right:1,up:10,down:-10}[t]);var n="keydown"===i.type?"slide":"end",o=r.noUiSlider.get();r.update(n,o)},condition:e=>!!e.slider}].forEach(e=>BeFunky.addArrowKeyHandler(e))}(),document.addEventListener("keyup",e=>{if("Enter"===e.key||13===e.keyCode){var t=e.target;"INPUT"===t.nodeName&&["checkbox","radio"].includes(t.type)&&BFN.appContainer.contains(t)&&("checkbox"===t.type?(t.checked=!t.checked,t.dispatchEvent(new Event("change"))):t.checked||(t.checked=!0,t.dispatchEvent(new Event("change"))))}})}(),UIToggler.toggleMainMenu(!1),UIToggler.toggleZoomMenu(!1);var e=document.getElementById("alternateMenu"),t=document.getElementById("color_picker_panel"),i=document.getElementById("zoom_menu");document.addEventListener(BeFunky.pointerdown,r=>{var a=r.target;if((!a||!a.preventItemDeselect)&&BFN.TransformModel.selectedTransformItem&&!BFN.ColorPickerPanel.eyeDropperActive&&!(a.hasClass&&a.hasClass("context-menu__item")||e.contains(a)||t.contains(a)||BFN.FontManager.fontMenuComponent&&BFN.FontManager.fontMenuComponent.contains(a)))if(i!==a&&i.contains(a))a.preventItemDeselect=!0;else if(!BeFunky.isModalOpen()&&!BeFunky.isLoadScreenActive()){var n=[...document.querySelectorAll(".draggable-panel")],o=!1;if(n.forEach(e=>{e.hasClass("active")&&e.contains(a)&&(o=!0)}),!o){var s=r.pageX,l=r.pageY,h=BFN.appViewportRect;if(s<h.x||s>h.x+h.width||l<h.y||l>h.y+h.height)return function(){if(Date.now()-UITools.lastClickTime<400)return void console.log("Transform item de-selection ignored on double-click");BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer.deselectItem()}()}}},!0),document.querySelector(".navbar").addEventListener("click",e=>{var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel);t.canvasScaling&&e.stopPropagation()},!0),function(){var e=!1,t=document.getElementById("zendesk_help_button"),i=!1,r=!1;t.addEventListener("click",t=>{if(t.stopPropagation(),!e){if(i)return window.zE("webWidget","close"),void(i=!1);var l=()=>{r=!0,n(),a||(a=!0,BeFunky.LanguageManager.addLanguageUpdateListener(n)),e=!1,BeFunky.hideLoadScreen(),o(),function(){if(s)return;var e=document.getElementById("webWidget");if(!e)return;var t=e.contentDocument.querySelector("style");if(!t)return;t.insertAdjacentHTML("beforebegin",'\n        <style>\n            div[data-embed="ticketSubmissionForm"] [class^="StyledField-"]:nth-child(3) {\n                display: none;\n            }\n            footer > div > a[href^="https://www.zendesk.com/embeddables/"] {\n                visibility: hidden;\n            }\n        </style>'),console.log("custom styles added to zendesk"),s=!0}()};e=!0,BeFunky.showLoadScreen(),window.getSystemInformation(!0).catch(e=>(BeFunky.throwError(e,"Unable to get system information"),"")).then(e=>(console.log("init zendesk",e),window.zESettings={webWidget:{position:{horizontal:"right",vertical:"top"},offset:{horizontal:"-8px",vertical:"64px"},color:{header:"#2D2E37",button:"#387DCD",articleLinks:"#387DCD"},contactForm:{fields:[{id:360004395771,prefill:{"*":e}}]}}},new Promise((e,t)=>{if(window.zE)return r();var i=document.createElement("script");function r(){BeFunky.waitUntil({condition:()=>"function"==typeof window.zE.activate,onSuccess:e,onTimeout:t,maxAttempts:100})}i.id="ze-snippet",i.src="https://static.zdassets.com/ekr/snippet.js?key=9c4d8d68-edce-4ce7-bc08-02c49d971e00",i.onerror=t,i.onload=r,document.head.appendChild(i)}))).then(()=>{r||(window.zE("webWidget:on","close",()=>{i=!1}),window.zE("webWidget:on","userEvent",e=>{"Web Widget Minimised"===e.action&&(i=!1)})),window.zE("webWidget","open"),window.zE("webWidget","show"),i=!0,l()},t=>{BeFunky.throwError("Unable to load Zendesk Widget",t),e=!1,BeFunky.hideLoadScreen()})}});var a=!1;function n(){window.zE.setLocale&&window.zE.setLocale(BeFunky.LanguageManager.language.app)}function o(){BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,o),BFN.userVo&&BFN.userVo.email?window.zE("webWidget","identify",{email:BFN.userVo.email}):BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,o)}var s=!1}()}(),window.dispatchEvent(new Event("INIT_COMPLETE")),t(),"function"==typeof e&&e()})},BFN.updateAppMenuDisplay=jg,BFN.adjustAndPaintMenus={background_menu:{toolID:"background",controlData:BFN.UIToolData.background.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024821391",tutorialName:"BACKGROUND",tabIDs:["fill","erase"],helpClueID:"erase_mode_background"},blur_menu:{toolID:"blur",controlData:BFN.UIToolData.blur.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/210432543",tutorialName:"BLUR"},lens_blur_menu:{toolID:"lens_blur",controlData:BFN.UIToolData.lens_blur.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027639771",tutorialName:"LENS_BLUR"},exposure_menu:{toolID:"exposure",controlData:BFN.UIToolData.exposure.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/208612466",tutorialName:"EXPOSURE"},levels_menu:{toolID:"levels",controlData:BFN.UIToolData.levels.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025676532",tutorialName:"LEVELS"},vibrance_menu:{toolID:"vibrance",controlData:BFN.UIToolData.vibrance.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024933592",tutorialName:"VIBRANCE"},color_menu:{toolID:"color",controlData:BFN.UIToolData.color.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025170471",tutorialName:"COLOR"},replace_color_menu:{toolID:"replace_color",controlData:BFN.UIToolData.replace_color.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360010912612",tutorialName:"REPLACE_COLOR"},fill_light_menu:{toolID:"fill_light",controlData:BFN.UIToolData.fill_light.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360015199512",tutorialName:"FILL_LIGHT"},sharpen_menu:{toolID:"sharpen",controlData:BFN.UIToolData.sharpen.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/210193063",tutorialName:"SHARPEN"},clarity_menu:{toolID:"clarity",controlData:BFN.UIToolData.clarity.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024853032",tutorialName:"CLARITY"},tint_menu:{toolID:"tint",controlData:BFN.UIToolData.tint.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025626252",tutorialName:"TINT"},beautify_menu:{toolID:"beautify",controlData:BFN.UIToolData.beautify.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024868452",tutorialName:"BEAUTIFY"},color_mixer_menu:{toolID:"color_mixer",controlData:BFN.UIToolData.color_mixer.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025732132",tutorialName:"COLOR_MIXER"},auto_enhance_menu:{toolID:"auto_enhance",controlData:BFN.UIToolData.auto_enhance.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024860052",tutorialName:"AUTO_ENHANCE"},glow_menu:{toolID:"glow",controlData:BFN.UIToolData.glow.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024937192",tutorialName:"GLOW"},blur_edges_menu:{toolID:"blur_edges",controlData:BFN.UIToolData.blur_edges.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/210432543",tutorialName:"BLUR_EDGES"},smoothing_menu:{toolID:"smoothing",controlData:BFN.UIToolData.smoothing.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025236791",tutorialName:"SMOOTHING"},soften_menu:{toolID:"soften",controlData:BFN.UIToolData.soften.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024949252",tutorialName:"SOFTEN"},ai_image_menu:{toolID:"ai_image",menuName:BFN.UIToolData.ai_image.name,controlData:BFN.UIToolData.ai_image.controls,tutorialLink:"",tutorialName:"AI_IMAGE"},ai_portrait_menu:{toolID:"ai_portrait",menuName:BFN.UIToolData.ai_portrait.name,controlData:BFN.UIToolData.ai_portrait.controls,tutorialLink:"https://www.befunky.com/learn/ai-portrait-enhancer/",tutorialName:"AI_PORTRAIT"},hdr_dlx_menu:{toolID:"hdr_dlx",menuName:BFN.UIToolData.hdr_dlx.name,controlData:BFN.UIToolData.hdr_dlx.controls},sharpen_dlx_menu:{toolID:"sharpen_dlx",menuName:BFN.UIToolData.sharpen_dlx.name,controlData:BFN.UIToolData.sharpen_dlx.controls},vibrant_colors_dlx_menu:{toolID:"vibrant_colors_dlx",menuName:BFN.UIToolData.vibrant_colors_dlx.name,controlData:BFN.UIToolData.vibrant_colors_dlx.controls},denoise_dlx_menu:{toolID:"denoise_dlx",menuName:BFN.UIToolData.denoise_dlx.name,controlData:BFN.UIToolData.denoise_dlx.controls}},BFN.setupAdjustAndPaintMenu=((e,t)=>{if(!(t=t||document.getElementById(e)).hasClass("tool-menu")){var i=BFN.adjustAndPaintMenus[e];if(!i)throw new Error("Unable to find config for menu id = ".concat(e));BFN.UI.toolMenuAdjustAndPaint(t,i),Object.keys(i.controlData).forEach(e=>UITools.registerControl(e))}}),BFN.touchupPaintMenus={perfectskin_menu:{toolID:"skin_heal",controlData:BFN.UIToolData.perfectskin.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/210192933",tutorialName:"PERFECT_SKIN"},wrinkles_menu:{toolID:"wrinkles",controlData:BFN.UIToolData.wrinkles.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/208811886",tutorialName:"WRINKLES"},bronzer_menu:{toolID:"bronzer",controlData:BFN.UIToolData.bronzer.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027463752",tutorialName:"BRONZER"},blush_menu:{toolID:"blush",controlData:BFN.UIToolData.blush.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027753471",tutorialName:"BLUSH"},flashspot_menu:{toolID:"flashspot",controlData:BFN.UIToolData.flashspot.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027789991",tutorialName:"FLASHSPOT"},mascara_menu:{toolID:"mascara",controlData:BFN.UIToolData.mascara.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/208497686",tutorialName:"MASCARA"},eye_color_menu:{toolID:"eye_color",controlData:BFN.UIToolData.eye_color.controls,tutorialLink:"https://befunky.zendesk.com/hc/en-us/articles/360027513812",tutorialName:"EYE_COLOR"},eye_brighten_menu:{toolID:"eye_brighten",controlData:BFN.UIToolData.eye_brighten.controls,tutorialLink:"https://befunky.zendesk.com/hc/en-us/articles/360027513812",tutorialName:"EYE_BRIGHTEN"},eyebrow_pencil_menu:{toolID:"eyebrow_pencil",controlData:BFN.UIToolData.eyebrow_pencil.controls,tutorialLink:"https://befunky.zendesk.com/hc/en-us/articles/360027513812",tutorialName:"EYEBROW_PENCIL"},fix_redeye_menu:{toolID:"fix_redeye",controlData:BFN.UIToolData.fix_redeye.controls,tutorialLink:"https://befunky.zendesk.com/hc/en-us/articles/360027513812",tutorialName:"FIX_REDEYE"},lipstick_menu:{toolID:"lipstick",controlData:BFN.UIToolData.lipstick.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/208497486",tutorialName:"LIPSTICK"},teeth_whiten_menu:{toolID:"teeth_whiten",controlData:BFN.UIToolData.teeth_whiten.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027892191",tutorialName:"TEETH_WHITEN"},hair_color_menu:{toolID:"hair_color",controlData:BFN.UIToolData.hair_color.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360021913512",tutorialName:"HAIR_COLOR"}},BFN.setupTouchupPaintMenu=((e,t)=>{if(!(t=t||document.getElementById(e)).hasClass("tool-menu")){var i=BFN.touchupPaintMenus[e];if(!i)throw new Error("Unable to find config for menu id = ".concat(e));BFN.UI.toolMenuTouchupPaint(t,i),Object.keys(i.controlData).forEach(e=>UITools.registerControl(e))}}),window.setupShowMenuPanel=(()=>{window.showMenuPanel=function(u,d){d||(d="edit_layer"===BFN.activeMenuStateID?"edit_layer":BFN.AppModel.sectionID,BFN.activeMenuStateID=d);var m=BFN.mainMenuStates[d],p=s!==d||l!==u;if(s!==d&&c!==("edit_layer"===d)){c=!c;["editor_main_image_manager","editor_main_graphic","editor_main_text"].forEach(e=>{document.getElementById(e).setStyles({display:c?"none":""})})}switch(s=d,l=u,u){case"primary":(t.hasClass("open")||i.hasClass("open"))&&(BFN.MainUI.viewportUpdating||p||console.log("viewportUpdating set to true but never set to false",t.hasClass("open"),i.hasClass("open")),t.removeClass("fold").removeClass("open"),i.removeClass("open"),r.removeClass("shift-menu"),a.removeClass("open-ter").removeClass("open-sec"),n.removeClass("open-ter").removeClass("open-sec"),o.removeClass("open-ter-transform").removeClass("open-sec-transform"),BFN.MainUI.viewportUpdating=!0),m.secondary=null,m.tertiary=null;var g=document.getElementById(m.primary).querySelector(".active");g&&g.removeClass("active");break;case"secondary":t.hasClass("open")||(r.addClass("shift-menu"),a.removeClass("open-ter").addClass("open-sec"),n.removeClass("open-ter").addClass("open-sec"),o.removeClass("open-ter-transform").addClass("open-sec-transform"),t.removeClass("fold").addClass("open"),i.removeClass("open")),m.secondary=t.querySelector(".tool-menu.active").id,m.tertiary=null;var f,v=m.secondary.replace(/(editor_|collage_|designer_|_menu)/g,""),y=m.primary.split("_")[0];try{f=BFN.UIMenuData.mainMenus[y].find(e=>{var t=e.id;return t.includes("_".concat(v))}).id}catch(e){throw console.log({secondaryMenuName:v,primaryMenuName:y}),e}var x=document.getElementById(f);x&&(x.parentNode.parentNode.querySelectorAll(".active").removeClass("active"),x.addClass("active"));break;case"tertiary":i.hasClass("open")||(a.removeClass("open-sec").addClass("open-ter"),n.removeClass("open-sec").addClass("open-ter"),o.removeClass("open-sec-transform").addClass("open-ter-transform"),r.addClass("shift-menu"),t.removeClass("open").addClass("fold"),i.addClass("open")),m.secondary=t.querySelector(".tool-menu.active").id,m.tertiary=i.querySelector(".tool-menu.active").id}if([...document.querySelectorAll(".side-panel .popover.active")].forEach(e=>{e.hide()}),p){var _={primary:BFN.CSS.leftMenuBarWidth,secondary:BFN.CSS.leftMenuBarWidth+BFN.CSS.secondaryMenuWidth,tertiary:BFN.CSS.leftMenuBarWidth+BFN.CSS.tertiaryMenuWidth},I=BFN.getAppViewportLeftOffset(),T=_[u],b=Date.now();BFN.getAppViewportLeftOffset=(()=>{if(T===I)return T;var e=Date.now(),t=e-b;return t>=200?T:I+t/200*(T-I)}),BFN.MainUI.viewportUpdating=!0,clearTimeout(e),e=setTimeout(()=>{requestAnimationFrame(()=>{BFN.MainUI.viewportUpdating&&(BFN.MainUI.viewportUpdating=!1)})},200)}var S=BFN.mainMenuStates[BFN.activeMenuStateID],C=[S.primary,S.secondary,S.tertiary].filter(Boolean).map(e=>e.replace(/^(editor|collage|designer)_/,"").replace(/_menu$/,"")),B="".concat(BFN.activeMenuStateID," > ").concat(C.join(" > "));if(B===h)return;h=B,window.Sentry&&Sentry.addBreadcrumb({category:"side_menu",message:B,level:Sentry.Severity.Info})};var e,t=document.getElementById("secondary-panel"),i=document.getElementById("tertiary-panel"),r=document.querySelector(".navbar"),a=document.getElementById("appViewport"),n=document.querySelector(".canvas-footer"),o=document.querySelector(".image-edit__image"),s="editor",l="primary",h="",c=!1}),window.rebuildAppVersion=1}!function t(){if(window.appBundleLoaded=!0,"undefined"!=typeof PIXI&&"undefined"!=typeof BeFunky&&"undefined"!=typeof BfnmaxImageSize)return window.BFN?BeFunky.logError("Not executing app bundle twice"):e();setTimeout(t,50)}()}();

//# sourceMappingURL=bundle.js.map
